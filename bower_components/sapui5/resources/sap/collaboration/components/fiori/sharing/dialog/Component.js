/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)
 * 
 * (c) Copyright 2009-2017 SAP SE. All rights reserved
 */
jQuery.sap.require("sap.collaboration.components.utils.OdataUtil");jQuery.sap.require("sap.collaboration.components.utils.CommonUtil");jQuery.sap.require("sap.collaboration.components.controls.SocialTextArea");jQuery.sap.require("sap.ui.core.UIComponent");jQuery.sap.require("sap.m.MessageToast");jQuery.sap.declare("sap.collaboration.components.fiori.sharing.dialog.Component");sap.ui.core.UIComponent.extend("sap.collaboration.components.fiori.sharing.dialog.Component",{metadata:{includes:["../../../resources/css/Sharing.css"],properties:{attachments:{type:"object"},object:{type:"object"},externalObject:{type:"object"}},aggregations:{},events:{}},systemSettings:{width:"400px",height:"",oDataServiceUrl:"/sap/opu/odata/sap/SM_INTEGRATION_V2_SRV",collaborationHostODataServiceUrl:"/sap/bc/ui2/smi/rest_tunnel/Jam/api/v1/OData",collaborationHostRestService:{url:"/sap/bc/ui2/smi/rest_tunnel/Jam/api/v1",urlParams:""}},init:function(){this.oCommonUtil=new sap.collaboration.components.utils.CommonUtil();this.oLangBundle=this.oCommonUtil.getLanguageBundle();},setSettings:function(s){this.setObject(s.object);this.setAttachments(s.attachments);if(JSON.stringify(s.externalObject)==='{}'){this.setExternalObject(undefined);}else{this.setExternalObject(s.externalObject);}},_createSharingView:function(){var s=this;var o;var O;var a;var b=this.getObject();if(b){a=s._handleObjectId(b.id);o=b.display;O=b.share;}var n=function(){s.close();s.openoNoGroupsDialog(s.oSharingView.getController().sJamUrl);};if(!this.oSharingView){this.oSharingView=sap.ui.view({id:this.getId()+"_SharingView",viewData:{controlId:this.getId(),odataServiceUrl:this.systemSettings.oDataServiceUrl,collaborationHostODataServiceUrl:this.systemSettings.collaborationHostODataServiceUrl,collaborationHostRestService:this.systemSettings.collaborationHostRestService,langBundle:this.oLangBundle,jamGroups:this.aJamGroups,sharingDialog:this._oSharingDialog,noGroupsCallBack:n,objectDisplay:o,objectShare:O,objectId:a,attachments:this.getAttachments(),externalObject:this.getExternalObject()},type:sap.ui.core.mvc.ViewType.JS,viewName:"sap.collaboration.components.fiori.sharing.Sharing"});}else{this.oSharingView.getViewData().objectId=a;this.oSharingView.getViewData().objectShare=O;this.oSharingView.getViewData().objectDisplay=o;this.oSharingView.getViewData().externalObject=this.getExternalObject();this.oSharingView.getViewData().attachments=this.getAttachments();}},_createSharingDialog:function(){var s=new sap.m.Dialog(this.getId()+"_SharingDialog",{title:this.oLangBundle.getText("SHARING_PAGE_TITLE"),contentWidth:this.systemSettings.width,stretch:false,afterClose:function(){}}).addStyleClass("sapUiPopupWithPadding");return s;},createNoGroupsDialog:function(j){if(!this.oNoGroupsView){this.oNoGroupsView=sap.ui.view({id:this.getId()+"_NoGroupsView",viewData:{controlId:this.getId(),langBundle:this.oLangBundle,jamUrl:j},type:sap.ui.core.mvc.ViewType.JS,viewName:"sap.collaboration.components.fiori.sharing.NoGroups"});}var n=new sap.m.Dialog(this.getId()+"_NoGroupsDialog",{title:this.oLangBundle.getText("SHARING_PAGE_TITLE"),stretch:false,content:this.oNoGroupsView,beginButton:new sap.m.Button(this.getId()+"_CloseButton",{text:this.oLangBundle.getText("CLOSE_BUTTON_TEXT"),press:function(){n.close();}})}).addStyleClass("sapUiPopupWithPadding");return n;},open:function(){if(this.bStopRendering===undefined||this.bStopRendering===false){if(!this._oSharingDialog){this._logComponentProperties();this._oSharingDialog=this._createSharingDialog();}try{this._createSharingView();this._oSharingDialog.addAriaLabelledBy(this.getId()+"_SharingView");this._oSharingDialog.addContent(this.oSharingView);this._oSharingDialog.setInitialFocus(this.oSharingView);this._createDialogButtons();if(sap.ui.Device.system.phone){this._oSharingDialog.setStretch(true);}this._oSharingDialog.open();}catch(e){jQuery.sap.log.error(e);this.oCommonUtil.displayError();}}},close:function(){if(this._oSharingDialog){this._oSharingDialog.close();}},openoNoGroupsDialog:function(j){this._oSharingDialog.removeAllContent();if(!this.oNoGroupsDialog){this.oNoGroupsDialog=this.createNoGroupsDialog(j);}this.oNoGroupsDialog.open();},_createDialogButtons:function(){if(!this.oMentionButton){this.oMentionButton=new sap.m.Button(this.getId()+"_mentionButton",{text:"@",enabled:false,press:[function(){this.oSharingView.getController().atMentionsButtonPressed();},this]});this._oSharingDialog.addButton(this.oMentionButton);}if(sap.ui.Device.system.phone){this.oMentionButton.setVisible(false);}if(!this.oLeftButton){this.oLeftButton=new sap.m.Button(this.getId()+"_LeftButton",{text:this.oLangBundle.getText("OK_BUTTON_TEXT"),enabled:false,press:[function(){this.oSharingView.getController().shareToJam();this._oSharingDialog.close();},this]});this._oSharingDialog.addButton(this.oLeftButton);}if(!this.oRightButton){this.oRightButton=new sap.m.Button(this.getId()+"_RightButton",{text:this.oLangBundle.getText("CANCEL_BUTTON_TEXT"),press:[function(){this._oSharingDialog.close();},this]});this._oSharingDialog.addButton(this.oRightButton);}},setDialogButtons:function(){},setCloseButton:function(){this._oSharingDialog.destroyBeginButton();this._oSharingDialog.setEndButton(this.oCloseButton);},_handleObjectId:function(o){var O=typeof o;var s;switch(O){case"undefined":case"":case"string":s=o;break;case"function":s=o();if(typeof s=="string"){break;};default:jQuery.sap.log.error("object->id is not a sting or callback function that returns a string");throw new Error();};return s;},_logComponentProperties:function(){jQuery.sap.log.debug("Share Component properties:","","sap.collaboration.components.fiori.sharing.Component._logComponentProperties()");jQuery.sap.log.debug("width: "+this.systemSettings.width);jQuery.sap.log.debug("height: "+this.systemSettings.height);jQuery.sap.log.debug("oDataServiceUrl: "+this.systemSettings.oDataServiceUrl);jQuery.sap.log.debug("collaborationHostODataServiceUrl: "+this.systemSettings.collaborationHostODataServiceUrl);jQuery.sap.log.debug("collaborationHostRestService: "+this.systemSettings.collaborationHostRestService.url+this.systemSettings.collaborationHostRestService.urlParams);if(this.getObject()){jQuery.sap.log.debug("object->id: "+this.getObject().id);jQuery.sap.log.debug("object->display: "+this.getObject().display);jQuery.sap.log.debug("object->share: "+this.getObject().share);}else{jQuery.sap.log.debug("object: undefined");}if(this.getAttachments()&&this.getAttachments().attachmentsArray){jQuery.sap.log.debug("Attachments:");var a=this.getAttachments().attachmentsArray;for(var i=0;i<a.length;i++){jQuery.sap.log.debug("Attachments"+(i+1)+":");jQuery.sap.log.debug(a[i].mimeType);jQuery.sap.log.debug(a[i].name);jQuery.sap.log.debug(a[i].url);}}else{jQuery.sap.log.debug("attachments: undefined");}if(this.getExternalObject()){jQuery.sap.log.debug("externalObject->appContext: "+this.getExternalObject().appContext);jQuery.sap.log.debug("externalObject->odataServicePath: "+this.getExternalObject().odataServicePath);jQuery.sap.log.debug("externalObject->collection: "+this.getExternalObject().collection);jQuery.sap.log.debug("externalObject->key: "+this.getExternalObject().key);jQuery.sap.log.debug("object->name: "+this.getExternalObject().name);jQuery.sap.log.debug("object->summary: "+this.getExternalObject().summary);}else{jQuery.sap.log.debug("externalObject: undefined");}}});
