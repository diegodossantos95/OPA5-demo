/*!
 * SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2014 SAP AG. All rights reserved
 */
jQuery.sap.require("sap.collaboration.components.socialtimeline.annotations.MetadataException");jQuery.sap.declare("sap.collaboration.components.socialtimeline.annotations.TimelineTermsUtility");sap.ui.base.Object.extend("sap.collaboration.components.socialtimeline.annotations.TimelineTermsUtility",{constructor:function(s,S){this._oLogger=jQuery.sap.log.getLogger("sap.collaboration.components.socialtimeline.annotations.TimelineTermsUtility");this._oServiceMetadata=s;this._oServiceAnnotations=S;this._oEntityMappings={};this.sSchemaNamespace="com.sap.vocabularies.Timeline.v1";var o=this._getIncludedSchema(this.sSchemaNamespace);if(!(o&&o.schemaNamespace===this.sSchemaNamespace)){var e="Schema with namespace "+this.sSchemaNamespace+" wasn't in an Include in the service's metadata document.";this._oLogger.error(e);throw new sap.collaboration.components.socialtimeline.annotations.MetadataException(e);}},getTimelineEntryNavigationPath:function(e){if(!e){var E=new Error('Parameter sEntityCollection is undefined');this._oLogger.error(E.message);throw E;}var m=this._oEntityMappings[e];if(!m){m=this._buildMapping(e);}return m.timelineEntryNavigationPath;},getTimelineEntryFields:function(e){if(!e){var E=new Error('Parameter sEntityCollection is undefined');this._oLogger.error(E.message);throw E;}var m=this._oEntityMappings[e];if(!m){m=this._buildMapping(e);}var t=this._oEntityMappings[e].timelineEntryFields;if(!t){var T=this._oServiceAnnotations[m.timelineEntryEntityTypeFull][this.sSchemaNamespace+".TimelineEntry"];if(!T){T=this._oServiceAnnotations[m.timelineEntryEntityTypeFull][this._getCollaborationAlias()+".TimelineEntry"];}t=this._mapEntityFields(T);this._oEntityMappings[e].timelineEntryFields=t;}return t;},getTimelineEntryDetailFields:function(e){if(!e){var E=new Error('Parameter sEntityCollection is undefined');this._oLogger.error(E.message);throw E;}var m=this._oEntityMappings[e];if(!m){m=this._buildMapping(e);}var t=this._oEntityMappings[e].timelineEntryDetailFields;if(!t){var T=this._oServiceAnnotations[m.timelineEntryDetailEntityTypeFull][this.sSchemaNamespace+".TimelineDetailPropertyValueChange"];if(!T){T=this._oServiceAnnotations[m.timelineEntryDetailEntityTypeFull][this._getCollaborationAlias()+".TimelineDetailPropertyValueChange"];}t=this._mapEntityFields(T);this._oEntityMappings[e].timelineEntryDetailFields=t;}return t;},_buildMapping:function(e){this._oEntityMappings[e]={};this._oEntityMappings[e].entityCollection=e;this._oEntityMappings[e].entityTypeFull=this._getEntityTypeFull(e);this._oEntityMappings[e].namespace=this._oEntityMappings[e].entityTypeFull.split(".")[0];this._oEntityMappings[e].entityType=this._oEntityMappings[e].entityTypeFull.split(".")[1];var E=this._oServiceAnnotations[this._oEntityMappings[e].entityTypeFull][this.sSchemaNamespace+".TimelineNavigationPath"];if(!E){E=this._oServiceAnnotations[this._oEntityMappings[e].entityTypeFull][this._getCollaborationAlias()+".TimelineNavigationPath"];}this._oEntityMappings[e].timelineEntryNavigationPath=E.NavigationPropertyPath;this._oEntityMappings[e].timelineEntryEntityTypeFull=this._getChildEntityTypeFull(this._oEntityMappings[e].entityType,this._oEntityMappings[e].timelineEntryNavigationPath);this._oEntityMappings[e].timelineEntryEntityType=this._oEntityMappings[e].timelineEntryEntityTypeFull.split(".")[1];this._oEntityMappings[e].timelineEntryFields=undefined;var t=this._oServiceAnnotations[this._oEntityMappings[e].timelineEntryEntityTypeFull][this.sSchemaNamespace+".TimelineEntry"];if(!t){t=this._oServiceAnnotations[this._oEntityMappings[e].timelineEntryEntityTypeFull][this._getCollaborationAlias()+".TimelineEntry"];}this._oEntityMappings[e].timelineEntryDetailNavigationPath=t.TimelineDetailNavigationPath.NavigationPropertyPath;this._oEntityMappings[e].timelineEntryDetailEntityTypeFull=this._getChildEntityTypeFull(this._oEntityMappings[e].timelineEntryEntityType,this._oEntityMappings[e].timelineEntryDetailNavigationPath);this._oEntityMappings[e].timelineEntryDetailFields=undefined;return this._oEntityMappings[e];},_getEntityTypeFull:function(e){for(var i=this._oServiceMetadata.dataServices.schema.length-1;i>=0;i--){var m=this._oServiceMetadata.dataServices.schema[i];if(m.entityContainer){var E=m.entityContainer[0].entitySet;for(var j=E.length-1;j>=0;j--){if(E[j].name===e){return E[j].entityType;}}}}throw new Error("Entity collection '"+e+"' could not be found in service");},_getChildEntityTypeFull:function(e,n){var E=this._getEntityTypeObject(e);var N=this._getNavigationProperty(E,n);var a=this._getAssociationEnd(N.toRole);return a.type;},_getEntityTypeObject:function(e){for(var i=this._oServiceMetadata.dataServices.schema.length-1;i>=0;i--){var m=this._oServiceMetadata.dataServices.schema[i];if(m.entityType){var E=m.entityType;for(var j=E.length-1;j>=0;j--){if(E[j].name===e){return E[j];}}}}throw new Error("Entity Type '"+e+"' could not be found in service");},_getNavigationProperty:function(e,n){if(e.navigationProperty){for(var k=e.navigationProperty.length-1;k>=0;k--){if(e.navigationProperty[k].name===n){return e.navigationProperty[k];}}}throw new Error("Navigation property '"+n+"' could not be found for entity '"+e.name+"'.");},_getAssociationEnd:function(r){for(var i=this._oServiceMetadata.dataServices.schema.length-1;i>=0;i--){var m=this._oServiceMetadata.dataServices.schema[i];if(m.association){for(var j=m.association.length-1;j>=0;j--){for(var k=m.association[j].end.length-1;k>=0;k--){if(m.association[j].end[k].role===r){return m.association[j].end[k];}}}}}throw new Error("Association with role '"+r+"' could not be found in service.");},_mapEntityFields:function(e){var f={};for(var p in e){if(e.hasOwnProperty(p)){if(e[p].Path){f[p]=e[p].Path;}else if(e[p].PropertyPath){f[p]=e[p].PropertyPath;}else if(e[p].EnumMember){f[p]=e[p].EnumMember;}else if(e[p].NavigationPropertyPath){f[p]=e[p].NavigationPropertyPath;}}}return f;},_getCollaborationAlias:function(){var a=this._oServiceAnnotations.aliasDefinitions;for(var b in a){if(a[b].indexOf("com.sap.vocabularies.Timeline.v1")>-1){return b;}}},_getIncludedSchema:function(s){var i=0;var j=0;var k=0;var r;var R;var I;var S={schemaNamespace:undefined,schemaAlias:undefined};if(this._oServiceMetadata&&this._oServiceMetadata.extensions){for(i=0;i<this._oServiceMetadata.extensions.length;++i){r=this._oServiceMetadata.extensions[i];for(j=0;j<r.children.length;++j){R=r.children[j];if(R.name=="Include"){for(k=0;k<R.attributes.length;++k){I=R.attributes[k];if(I.name=="Namespace"){S.schemaNamespace=I.value;}if(I.name=="Alias"){S.schemaAlias=I.value;}}if(S.schemaNamespace==s){return S;}}}}return undefined;}return undefined;}});
