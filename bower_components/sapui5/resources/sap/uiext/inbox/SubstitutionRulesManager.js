/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 * 
 * (c) Copyright 2009-2017 SAP SE. All rights reserved
 */
jQuery.sap.declare("sap.uiext.inbox.SubstitutionRulesManager");jQuery.sap.require("sap.uiext.inbox.library");jQuery.sap.require("sap.ui.core.Control");sap.ui.core.Control.extend("sap.uiext.inbox.SubstitutionRulesManager",{metadata:{deprecated:true,publicMethods:["bindSubstitutionRules"],library:"sap.uiext.inbox"}});
/*!
 * @copyright@
 * @deprecated Since version 1.38.0
 */
jQuery.sap.require("sap.uiext.inbox.InboxUtils");jQuery.sap.require("sap.uiext.inbox.InboxConstants");jQuery.sap.require("sap.uiext.inbox.SubstitutionRulesManagerConstants");jQuery.sap.require("sap.uiext.inbox.SubstitutionRulesManagerUtils");jQuery.sap.require("sap.uiext.inbox.TCMMetadata");jQuery.sap.require("sap.ui.core.IconPool");
sap.uiext.inbox.SubstitutionRulesManager.prototype.init=function(){var c=sap.ui.getCore().getConfiguration().getTheme();this._imgResourcePath=sap.ui.resource('sap.uiext.inbox','themes/'+c+'/img/');this._oBundle=sap.ui.getCore().getLibraryResourceBundle("sap.uiext.inbox");this.sUrl="";this.sPath="/SubstitutionRuleCollection";this.inboxUtils=sap.uiext.inbox.InboxUtils;this.substitutionRulesManagerUtils=sap.uiext.inbox.SubstitutionRulesManagerUtils;this.inboxConstants=sap.uiext.inbox.InboxConstants;this.substitutionConstants=sap.uiext.inbox.SubstitutionRulesManagerConstants;this.substitutionRuleCollection=this.substitutionConstants.SubstitutionRuleCollection;this.substitutesRuleCollection=this.substitutionConstants.SubstitutesRuleCollection;this.oTcmMetadata=new sap.uiext.inbox.TCMMetadata();this.constants=sap.uiext.inbox.InboxConstants;this.bUseBatch=false;this.oPendingSearchRequestInSubstitution=undefined;};
sap.uiext.inbox.SubstitutionRulesManager.prototype.exit=function(){this.vLayout.destroy();this.vLayout=null;function r(i){var I=sap.ui.getCore().byId(i);I&&I.destroy();}this._oBundle=undefined;};
sap.uiext.inbox.SubstitutionRulesManager.prototype.getSubstitutionRulesData=function(m){if(this.bUseBatch){this._fetchSubstitutionRuleCollectionData();}else{this.data.substitutionRulesCollection=[];this._fetchEnabledSubstitutionRuleCollection(m);this._fetchDisabledSubstitutionRuleCollection(m);}};
sap.uiext.inbox.SubstitutionRulesManager.prototype._getSubstitutesRulesData=function(m){if(this.bUseBatch){this._fetchSubstitutesRuleCollectionData();}else{this.data.substitutesRulesCollection=[];this._fetchEnabledSubstitutesRuleCollection(m);this._fetchDisabledSubstitutesRuleCollection(m);}};
sap.uiext.inbox.SubstitutionRulesManager.prototype._handleAuthenticationResponse=function(d,r){if(r.statusCode===200&&d===undefined){window.location.reload(true);}};
sap.uiext.inbox.SubstitutionRulesManager.prototype._fetchSubstitutionRuleCollectionData=function(){var p=new Array();p[0]="/SubstitutionRuleCollection";if(this.oTcmMetadata._isEntitySet(this.constants.SystemInfoCollection.name,this.constants.SystemInfoCollection.entityType)){p[1]="/"+this.constants.SystemInfoCollection.name;}this.oDataManager.fireBatchRequest({aPaths:p,sMethod:"GET",sBatchGroupId:"fetchInitialSubstitutionData",numberOfRequests:p.length,fnSuccess:jQuery.proxy(this.processSubstitutionData,this),fnError:jQuery.proxy(this.showSubstitutionErrorMessage,this)});};
sap.uiext.inbox.SubstitutionRulesManager.prototype._fetchSubstitutesRuleCollectionData=function(){var t=this;t.oDataManager.readData("/SubstitutesRuleCollection",{success:function(d,r){t.oSubstitutesRuleCollectionModel.setData({SubstitutesRuleCollection:d.results});},error:function(e){t.showSubstitutionErrorMessage();}});};
sap.uiext.inbox.SubstitutionRulesManager.prototype.processSubstitutionData=function(d,r){var b=d.__batchResponses;var s=true;if(this.oTcmMetadata._isEntitySet(this.constants.SystemInfoCollection.name,this.constants.SystemInfoCollection.entityType)){var S=b[1];if(S&&S.statusCode&&S.statusCode==200){this.oSystemInfoData=S.data.results;}else{s=false;}}var o=b[0];if(o&&o.statusCode&&o.statusCode==200){this._getSubstitutionRuleCollectionModel().setData({SubstitutionRuleCollection:o.data.results});}else{s=false;}if(!s){this.showSubstitutionErrorMessage();}};
sap.uiext.inbox.SubstitutionRulesManager.prototype._fetchEnabledSubstitutionRuleCollection=function(m){var t=this;m.read("/SubstitutionRuleCollection?$filter=IsEnabled%20eq%20true",null,null,true,function(d,r){t._handleAuthenticationResponse(d,r);t.data.substitutionRulesCollection=t.data.substitutionRulesCollection.concat(d.results);t._getSubstitutionRuleCollectionModel().setData({SubstitutionRuleCollection:t.data.substitutionRulesCollection});},function(e){t.showSubstitutionErrorMessage();});};
sap.uiext.inbox.SubstitutionRulesManager.prototype._fetchDisabledSubstitutionRuleCollection=function(m){var t=this;m.read("/SubstitutionRuleCollection?$filter=IsEnabled%20eq%20false",null,null,true,function(d,r){t._handleAuthenticationResponse(d,r);t.data.substitutionRulesCollection=t.data.substitutionRulesCollection.concat(d.results);t._getSubstitutionRuleCollectionModel().setData({SubstitutionRuleCollection:t.data.substitutionRulesCollection});},function(e){t.showSubstitutionErrorMessage();});};
sap.uiext.inbox.SubstitutionRulesManager.prototype._fetchEnabledSubstitutesRuleCollection=function(m){var t=this;m.read("/SubstitutesRuleCollection?$filter=IsEnabled%20eq%20true",null,null,true,function(d,r){t._handleAuthenticationResponse(d,r);t.data.substitutesRulesCollection=t.data.substitutesRulesCollection.concat(d.results);t.oSubstitutesRuleCollectionModel.setData({SubstitutesRuleCollection:t.data.substitutesRulesCollection});},function(e){t.showSubstitutionErrorMessage();});};
sap.uiext.inbox.SubstitutionRulesManager.prototype._fetchDisabledSubstitutesRuleCollection=function(m){var t=this;m.read("/SubstitutesRuleCollection?$filter=IsEnabled%20eq%20false",null,null,true,function(d,r){t._handleAuthenticationResponse(d,r);t.data.substitutesRulesCollection=t.data.substitutesRulesCollection.concat(d.results);t.oSubstitutesRuleCollectionModel.setData({SubstitutesRuleCollection:t.data.substitutesRulesCollection});},function(e){t.showSubstitutionErrorMessage();});};
sap.uiext.inbox.SubstitutionRulesManager.prototype.showSubstitutionErrorMessage=function(){this.showMessage("error",this._oBundle.getText("INBOX_MSG_FETCH_SUBSTITUTION_FAILED"));};
sap.uiext.inbox.SubstitutionRulesManager.prototype.open=function(){var m=this.getModel();if(m instanceof sap.ui.model.odata.ODataModel){var s=m.getServiceMetadata();if(m.sServiceUrl&&s){this.oTcmMetadata.setServiceMetadata(s);}}this.overlayContainer=this.populateOverlayContainer();this.overlayContainer.open();};
sap.uiext.inbox.SubstitutionRulesManager.prototype.populateOverlayContainer=function(){var t=this;var d=this.getId()+'--';var s=sap.ui.getCore().byId(d+'substitutionOverlayContainer');if(s===undefined){s=new sap.ui.ux3.OverlayContainer(d+"substitutionOverlayContainer");s.setOpenButtonVisible(false);s.attachClose(function(E){t.closeNotificationBar1();if(t.bSubstituteDataRefreshed){t.bSubstituteDataRefreshed=false;}});var o=sap.ui.getCore().byId(d+'substitutionVLayout');if(o===undefined){o=new sap.ui.commons.layout.VerticalLayout(d+"substitutionVLayout");}o.setWidth("95%");o.addStyleClass("verticalLayoutStyle");var e=sap.ui.getCore().byId(d+'substDummyLabel0');if(e===undefined){e=new sap.ui.commons.Label(this.getId()+'--'+"substDummyLabel0",{text:""});}var n=sap.ui.getCore().byId(d+'newSubstitutionLink');if(n===undefined){n=new sap.ui.commons.Link(d+'newSubstitutionLink',{text:this._oBundle.getText("SUBSTITUTION_RULE_CREATE_NEW_BUTTON"),tooltip:this._oBundle.getText("SUBSTITUTION_RULE_CREATE_TOOLTIP")});}n.attachPress(t,t.openCreateSubstRulePopup);n.addStyleClass("newSubstitutionLink");var N=sap.ui.getCore().byId(d+'subsNavBar');if(N===undefined){N=new sap.ui.ux3.NavigationBar(d+"subsNavBar",{items:[new sap.ui.ux3.NavigationItem(d+"mySubstitutes",{key:d+"mySubstitutes",text:this._oBundle.getText("SUBSTITUTION_MY_SUBSTITUTES_TAB_TITLE"),tooltip:this._oBundle.getText("SUBSTITUTION_MY_SUBSTITUTES_TAB_TITLE")}),new sap.ui.ux3.NavigationItem(d+"iamSubstituting",{key:d+"iamSubstituting",text:this._oBundle.getText("SUBSTITUTION_I_AM_SUBSTITUTING_TAB_TITLE"),tooltip:this._oBundle.getText("SUBSTITUTION_I_AM_SUBSTITUTING_TAB_TITLE")})]});}N.setSelectedItem(d+"mySubstitutes");N.addStyleClass("navigationBarMargin");N.addStyleClass("sapUiExtInboxSubstitutionNavigationBar");var a=sap.ui.getCore().byId(d+'substDummyLabel');if(a===undefined){a=new sap.ui.commons.Label(this.getId()+'--'+"substDummyLabel",{text:""});}var v=0;o.insertContent(e,v);if(sap.ui.getCore().byId(d+'notificationBar1')===undefined){o.insertContent(this.populateNotificationBar(),++v);}o.insertContent(N,++v);o.insertContent(n,++v);o.insertContent(a,++v);var b=sap.ui.getCore().byId(d+'activeAndinactiveRulesVLayout');if(b===undefined){b=new sap.ui.commons.layout.VerticalLayout(d+"activeAndinactiveRulesVLayout");b.setWidth("100%");b.insertContent(new sap.ui.commons.Label({text:t._oBundle.getText("SUBSTITUTION_ACTIVE_SUBSTITUTION_RULE"),design:sap.ui.commons.LabelDesign.Bold}).addStyleClass("activeLabelFontSize"),0);b.insertContent(new sap.ui.commons.Label({text:""}),1);b.insertContent(new sap.ui.commons.Label({text:""}),2);b.insertContent(new sap.ui.commons.Label({text:""}),3);b.insertContent(new sap.ui.commons.Label({text:t._oBundle.getText("SUBSTITUTION_INACTIVE_SUBSTITUTION_RULE"),design:sap.ui.commons.LabelDesign.Bold}).addStyleClass("activeLabelFontSize"),4);b.insertContent(new sap.ui.commons.Label({text:""}),5);b.insertContent(new sap.ui.commons.Label({text:""}),6);}var m=++v;o.insertContent(t.getOverlayContent(d+"mySubstitutes",b),m);s.addContent(o);N.attachSelect(function(E){var i=E.getParameter("item").getKey();o.removeContent(m);o.insertContent(t.getOverlayContent(i,b),m);});}else{var N=sap.ui.getCore().byId(d+'subsNavBar');N.setSelectedItem(d+"mySubstitutes");var b=sap.ui.getCore().byId(d+'activeAndinactiveRulesVLayout');var o=sap.ui.getCore().byId(d+'substitutionVLayout');o.insertContent(t.getOverlayContent(d+"mySubstitutes",b),m);s.addContent(o);}return s;};
sap.uiext.inbox.SubstitutionRulesManager.prototype.getOverlayContent=function(i,a){var d=this.getId()+'--';var t=this;var s={};var S=sap.ui.getCore().byId(d+'substitutionOverlayContainer');var n=sap.ui.getCore().byId(d+'newSubstitutionLink');var o=sap.ui.getCore().byId(d+'substitutionVLayout');if(s[i])return s[i];if(i===d+"mySubstitutes"){n.setVisible(t.isSubstitutionRuleCreationSupported);a.removeContent(2);a.insertContent(t.createSubtRuleRowReapterContent(i,true),2);a.removeContent(6);a.insertContent(t.createSubtRuleRowReapterContent(i,false),8);s[i]=a}else if(i===d+"iamSubstituting"){n.setVisible(false);a.removeContent(2);a.insertContent(t.createSubtRuleRowReapterContent(i,true),2);a.removeContent(6);a.insertContent(t.createSubtRuleRowReapterContent(i,false),8);s[i]=a;}return s[i];};
sap.uiext.inbox.SubstitutionRulesManager.prototype.openCreateSubstRulePopup=function(e,s){var t=this;var d=s.getId()+'--';var n=sap.ui.getCore().byId(d+'newSubstitutionLink');var c=sap.ui.getCore().byId(d+'createSubsRulePopup');if(c===undefined){c=new sap.ui.ux3.ToolPopup(d+'createSubsRulePopup',{modal:true});var p=new sap.ui.commons.layout.MatrixLayout(d+'popupMainMatrix',{layoutFixed:false,width:'300px',columns:2,widths:["25%","75%"]});var a=new sap.ui.commons.layout.MatrixLayoutCell(d+'popupMainMatrixCell1',{colSpan:2});var b=new sap.ui.commons.layout.MatrixLayoutCell(d+'popupMainMatrixCellMsgBar',{colSpan:2});a.addContent(new sap.ui.commons.TextView(d+'popupCreateSubstRuleTxt',{text:s._oBundle.getText("CREATE_SUBSTITUTION_RULE"),design:sap.ui.commons.TextViewDesign.H3}));p.createRow(a);p.createRow(b);s.populateNotificationBar(s);var f=new sap.ui.commons.layout.MatrixLayoutCell(d+'popupMainMatrixCell2',{colSpan:2});f.addContent(new sap.ui.commons.HorizontalDivider(d+'popHorzDivdr1'));p.createRow(f);var g=new sap.ui.commons.Label(d+'popupSubstLbl',{text:s._oBundle.getText("SUBSTITUTION_RULE_SUBSTITUTE_LABEL")});var h=new sap.ui.commons.ValueHelpField(d+'popupValueHelp',{width:'100%',});h.addDelegate({onAfterRendering:function(){h.$("input").prop("maxLength",0);h.$("input").prop("readonly","readonly");}});h.attachValueHelpRequest(s,s.openUsersDialog);h.setRequired(true);h.setTooltip(s._oBundle.getText("SUBSTITUTION_RULE_SUBSTITUTE_TOOLTIP"));g.setLabelFor(h);p.createRow(g,h);var i=new sap.ui.commons.Label(d+'popupAutoFwdtLbl',{text:s._oBundle.getText("SUBSTITUTION_AUTOMATIC_FORWARDING_LABEL")});var j=new sap.ui.commons.SegmentedButton(d+'popupSegBtn',{buttons:[new sap.ui.commons.Button(d+'popupSegBtnON',{text:s._oBundle.getText("SUBSTITUTION_AUTOMATIC_FORWARDING_ON_STATE_TEXT"),tooltip:s._oBundle.getText("SUBSTITUTION_AUTOMATIC_FORWARDING_ON_STATE")}),new sap.ui.commons.Button(d+'popupSegBtnOFF',{text:s._oBundle.getText("SUBSTITUTION_AUTOMATIC_FORWARDING_OFF_STATE_TEXT"),tooltip:s._oBundle.getText("SUBSTITUTION_AUTOMATIC_FORWARDING_OFF_STATE")})]});j.attachSelect(function(e){if(sap.ui.getCore().byId(e.getParameters().selectedButtonId).getText()==s._oBundle.getText("SUBSTITUTION_AUTOMATIC_FORWARDING_ON_STATE_TEXT")){sap.ui.getCore().byId(d+'popupFromDatePicker').setProperty("visible",true);sap.ui.getCore().byId(d+'popupToDatePicker').setProperty("visible",true);sap.ui.getCore().byId(d+'popupFromLbl').setProperty("visible",true);sap.ui.getCore().byId(d+'popupToLbl').setProperty("visible",true);sap.ui.getCore().byId(d+'popupFromDatePicker').setProperty("required",true);sap.ui.getCore().byId(d+'popupToDatePicker').setProperty("required",true);}else{sap.ui.getCore().byId(d+'popupFromDatePicker').setProperty("visible",false);sap.ui.getCore().byId(d+'popupToDatePicker').setProperty("visible",false);sap.ui.getCore().byId(d+'popupFromLbl').setProperty("visible",false);sap.ui.getCore().byId(d+'popupToLbl').setProperty("visible",false);sap.ui.getCore().byId(d+'popupFromDatePicker').setProperty("required",false);sap.ui.getCore().byId(d+'popupToDatePicker').setProperty("required",false);}p.rerender();});j.setSelectedButton(d+"popupSegBtnON");i.setLabelFor(j);i.setWrapping(true);p.createRow(i,j);if(s.bSubstitutionProfileAvailable){var S=new sap.ui.commons.Label(d+'substProfileLbl',{text:s._oBundle.getText("SUBSTITUTION_RULE_SUBSTITUTION_PROFILE"),wrapping:true});var o=new sap.ui.commons.ValueHelpField(d+'substProfileValueHelp',{width:'100%',}).addDelegate({onAfterRendering:function(){o.$("input").prop("maxLength",0);o.$("input").prop("readonly","readonly");}}).attachValueHelpRequest(s,s.openSubstProfileDialog).setRequired(false).setTooltip(s._oBundle.getText("SUBSTITUTION_RULE_SUBSTITUTION_PROFILE_TOOLTIP"));S.setLabelFor(o);p.createRow(S,o);}var k=new sap.ui.commons.Label(d+'popupFromLbl',{text:s._oBundle.getText("SUBSTITUTION_SUBSTITUTION_FROM_DATE_LABEL")});var l=new sap.ui.commons.DatePicker(d+'popupFromDatePicker',{text:s._oBundle.getText("SUBSTITUTION_SUBSTITUTION_FROM_DATE_LABEL"),width:'100%',tooltip:s._oBundle.getText("SUBSTITUTION_CREATE_FROM_DATE_TOOLTIP")});l.setRequired(true);l.setYyyymmdd(s.substitutionRulesManagerUtils._getTodaysDateinYYYYMMDD());k.setLabelFor(l);p.createRow(k,l);var m=new sap.ui.commons.Label(d+'popupToLbl',{text:s._oBundle.getText("SUBSTITUTION_SUBSTITUTION_TO_DATE_LABEL")});var q=new sap.ui.commons.DatePicker(d+'popupToDatePicker',{text:s._oBundle.getText("SUBSTITUTION_SUBSTITUTION_TO_DATE_LABEL"),width:'100%',tooltip:s._oBundle.getText("SUBSTITUTION_CREATE_TO_DATE_TOOLTIP")});q.setRequired(true);m.setLabelFor(q);p.createRow(m,q);var A=new sap.ui.commons.Label(d+'activateCheckBoxLbl',{text:s._oBundle.getText("SUBSTITUTION_RULE_ACTIVATE")});var r=new sap.ui.commons.CheckBox(d+'activateCheckBox',{tooltip:s._oBundle.getText("SUBSTITUTION_RULE_ACTIVATE_TOOLTIP"),checked:true});A.setLabelFor(r);p.createRow(A,r);var u=new sap.ui.commons.layout.MatrixLayoutCell(d+'popupMainMatrixCell3',{colSpan:2});u.addContent(new sap.ui.commons.HorizontalDivider(d+'popHorzDivdr2'));p.createRow(u);var v=new sap.ui.commons.Button(d+'popupCreateBtn',{text:s._oBundle.getText("SUBSTITUTION_SUBSTITUTIN_RULE_CREATE_BUTTON"),tooltip:s._oBundle.getText("SUBSTITUTION_CREATE_BUTTON_TOOLTIP")});v.attachPress(s,s.createSubstitutionRule);var w=new sap.ui.commons.Button(d+'popupCancelBtn',{text:s._oBundle.getText("SUBSTITUTION_SUBSTITUTIN_RULE_CANCEL_BUTTON"),tooltip:s._oBundle.getText("SUBSTITUTION_CANCEL_BUTTON_TOOLTIP"),press:function(){c.close();c.destroy();}});p.createRow(v,w);c.addContent(p);}s.deleteMessage();c.setPosition(sap.ui.core.Popup.Dock.EndTop,sap.ui.core.Popup.Dock.BeginTop,n.getDomRef(),"-10 -10","fit");c.setInitialFocus(s.getId()+'--popupValueHelp-input');c.open();};
sap.uiext.inbox.SubstitutionRulesManager.prototype.createSubtRuleRowReapterContent=function(a,b){var c=(a===this.getId()+'--'+'mySubstitutes')?true:false;var d=a;if(b){d=d+'active'+'--';}else{d=d+'inactive'+'--';}var t=this;var s=sap.ui.getCore().byId(d+'subsRowRepeater');if(s===undefined){s=new sap.ui.commons.RowRepeater(d+'subsRowRepeater',{});s.attachPage(t,t.deleteMessage);s.setDesign(sap.ui.commons.RowRepeaterDesign.Transparent);t.setNoOfRules(d);jQuery(window).resize(function(i){t.setNoOfRules(d);s.rerender();});s.setNoData(new sap.ui.commons.TextView({text:t._oBundle.getText("SUBSTITUTION_VALIDATION_MESSAGE_NO_SUBSTITUTION_RULES_FOUND")}));var r=new sap.ui.commons.layout.MatrixLayout(d+'rowRepMainMatrix',{layoutFixed:true,});if(t.bSubstitutionProfileAvailable){r.setWidths(['2%','30%','18%','18%','17%','12%','3%']);r.setColumns(7);}else{r.setWidths(['2%','37%','24%','21%','12%','3%']);r.setColumns(6);}if(b){r.addStyleClass('borderFillColorGray');r.addStyleClass('shadowEffectGray');r.addStyleClass('mySapUiMltPadRight');}else{r.addStyleClass('borderFillColorGray');r.addStyleClass('shadowEffectGray');}var e=new sap.ui.commons.layout.MatrixLayoutCell(d+'rowRepEmptyCell');var f=new sap.ui.commons.TextView(d+'substitutionID');f.setVisible(false);f.bindProperty("text","SubstitutionRuleID");e.addContent(f);var g=new sap.ui.commons.layout.MatrixLayout(d+'rowRepSubsDetailMatLyt',{columns:1,layoutFixed:true});var h=new sap.ui.commons.layout.MatrixLayoutRow(d+'rowRepEmptyRow1');var j=new sap.ui.commons.TextView(d+'rowRepEmpltyTxt1',{text:""});var k=new sap.ui.commons.layout.MatrixLayoutCell(d+'rowRepEmpltyCell1',{backgroundDesign:sap.ui.commons.layout.BackgroundDesign.Transparent});k.addContent(j);h.addCell(k);var l=new sap.ui.commons.layout.MatrixLayoutRow(d+'rowRepSubstNameRow');var m;m=new sap.ui.commons.TextView(d+'rowRepSubstNameTxtView');m.bindProperty("text","FullName",function(i){if(i!==null&&i!==""){return i;}});m.addStyleClass('blueFontColor');m.addStyleClass('boldFontWeight');m.addStyleClass('sapUiExtSubstitutionPadding');var n=new sap.ui.commons.layout.MatrixLayoutCell(d+'rowRepSubstNameCell',{backgroundDesign:sap.ui.commons.layout.BackgroundDesign.Transparent});n.addContent(m);l.addCell(n);g.addRow(l);var o=new sap.ui.commons.layout.MatrixLayoutRow(d+'rowRepUsrFriendlyRow');var p=new sap.ui.commons.TextView(d+'rowRepUsrFriendlyTxt');p.addStyleClass('blackFontColor');p.bindProperty("text","FullName",function(i){if(i!==null&&i!==""&&i){var R=this.getModel();return t.substitutionRulesManagerUtils._getText(i,c,R.getProperty('IsEnabled',this.getBindingContext(),false),R.getProperty('SupportsEnableSubstitutionRule',this.getBindingContext(),false),R.getProperty('BeginDate',this.getBindingContext(),false),R.getProperty('EndDate',this.getBindingContext(),false));}});var q=new sap.ui.commons.layout.MatrixLayoutCell(d+'rowRepUsrFriendly');q.addContent(p);o.addCell(q);g.addRow(o);if(t.bSubstitutionProfileAvailable){var u=new sap.ui.commons.layout.MatrixLayout(d+'rowRepSubstProfileMatLyt',{columns:1,layoutFixed:true});var v=new sap.ui.commons.TextView(d+'rowRepSystemInfoTxt').bindText({path:"SAP__Origin",formatter:function(S){var R="";if(S&&t.oSystemInfoData){jQuery.each(t.oSystemInfoData,function(i,T){if(T.SAP__Origin===S){R=t._oBundle.getText("SUBSTITUTION_RULE_SYSTEM_ALIAS")+" : "+T.SystemAlias;return false;}});}return R;}}).addStyleClass('grayFontColor').addStyleClass('sapUiExtSubstitutionPadding');var w=new sap.ui.commons.layout.MatrixLayoutCell(d+'rowRepSystemInfoCell');var x=new sap.ui.commons.layout.MatrixLayoutRow(d+'rowRepSystemInfoRow');w.addContent(v);x.addCell(w);u.addRow(x);var y=new sap.ui.commons.TextView(d+'rowRepSubstProfileTxt').bindText({parts:[{path:"ProfileText",type:new sap.ui.model.type.String()},{path:"Profile",type:new sap.ui.model.type.String()}],formatter:function(i,R){if(i&&R){return t._oBundle.getText("SUBSTITUTION_RULE_SUBSTITUTION_PROFILE")+" : "+i+" ("+R+")";}else{return"";}}}).addStyleClass('grayFontColor');var z=new sap.ui.commons.layout.MatrixLayoutCell(d+'rowRepSubstProfileCell');var A=new sap.ui.commons.layout.MatrixLayoutRow(d+'rowRepSubstProfileRow');z.addContent(y);A.addCell(z);u.addRow(A);}var B=new sap.ui.commons.layout.MatrixLayout(d+'rowRepSinceUntilMatLyt',{columns:1,layoutFixed:true});var C=new sap.ui.commons.layout.MatrixLayoutRow(d+'rowRepSinceDateRow');var D=new sap.ui.commons.TextView(d+'rowRepSinceDateTxt');D.addStyleClass('grayFontColor');D.addStyleClass('sapUiExtSubstitutionPadding');var E=t._oBundle.getText("SUBSTITUTION_RULE_SINCE_LABEL");if(!b){E=t._oBundle.getText("SUBSTITUTION_SUBSTITUTION_FROM_DATE_LABEL");}D.bindText({parts:[{path:"BeginDate"},{path:"Mode"}],formatter:function(i,R){if(R&&R===t.substitutionConstants.MODE_RECEIVE_TASKS){return E+" : "+t.substitutionRulesManagerUtils._getFormattedDate(i);}}});var F=new sap.ui.commons.layout.MatrixLayoutCell(d+'rowRepSinceDate');F.addContent(D);C.addCell(F);B.addRow(C);var G=new sap.ui.commons.layout.MatrixLayoutRow(d+'rowRepUntilDateRow');var H=new sap.ui.commons.TextView(d+'rowRepUntilDateTxt');H.addStyleClass('grayFontColor');H.bindText({parts:[{path:"EndDate"},{path:"Mode"}],formatter:function(i,R){if(R&&R===t.substitutionConstants.MODE_RECEIVE_TASKS){return t._oBundle.getText("SUBSTITUTION_RULE_UNTIL_LABEL")+" : "+t.substitutionRulesManagerUtils._getFormattedDate(i);}}});var I=new sap.ui.commons.layout.MatrixLayoutCell(d+'rowRepUntilDateCell');I.addContent(H);G.addCell(I);B.addRow(G);var J=new sap.ui.commons.layout.MatrixLayout(d+'rowRepActiveTimeMatLyt',{columns:1,layoutFixed:true});var K=new sap.ui.commons.layout.MatrixLayoutRow(d+'rowRepActiveRow');var L=new sap.ui.commons.TextView(d+'rowRepActiveTxt');L.addStyleClass('grayFontColor');L.addStyleClass('boldFontWeight');L.addStyleClass('sapUiExtSubstitutionPadding');L.bindText({parts:[{path:"Mode"},{path:"IsEnabled"},{path:"BeginDate"},{path:"EndDate"}],formatter:function(i,R,S,T){if(i&&i===t.substitutionConstants.MODE_RECEIVE_TASKS){return t.substitutionRulesManagerUtils._getStatus(c,R,S,T);}}});var M=new sap.ui.commons.layout.MatrixLayoutCell(d+'rowRepActiveCell',{backgroundDesign:sap.ui.commons.layout.BackgroundDesign.Transparent});M.addContent(L);K.addCell(M);J.addRow(K);var N=new sap.ui.commons.SegmentedButton(d+'rowRepOnOffSegBtn',{visible:false,buttons:[new sap.ui.commons.Button(d+'rowRepOnSegBtn',{text:t._oBundle.getText("SUBSTITUTION_AUTOMATIC_FORWARDING_ON_STATE_TEXT"),tooltip:t._oBundle.getText("SUBSTITUTION_AUTOMATIC_FORWARDING_ON_STATE_TEXT")}),new sap.ui.commons.Button(d+'rowRepOffSegBtn',{text:t._oBundle.getText("SUBSTITUTION_AUTOMATIC_FORWARDING_OFF_STATE_TEXT"),tooltip:t._oBundle.getText("SUBSTITUTION_AUTOMATIC_FORWARDING_OFF_STATE_TEXT")})]});N.bindProperty("visible",{parts:[{path:"Mode"},{path:"SupportsEnableSubstitutionRule"}],formatter:function(i,R){if(!c)return R;else return(i&&i===t.substitutionConstants.MODE_RECEIVE_TASKS&&R);}});N.bindProperty("enabled","IsEnabled",function(i){if(i!=null&&i!==""){if(i){this.setSelectedButton(this.getButtons()[0].getId());}else{this.setSelectedButton(this.getButtons()[1].getId());}}return true;});N.attachSelect(this,function(i,t){var R=true;if((i.mParameters.selectedButtonId.indexOf("rowRepOnSegBtn"))==-1){R=false;}t.updateSubstitutionRule(i,t,R);});if(c){var O=new sap.ui.commons.Button(d+'rowRepDeleteImg',{tooltip:this._oBundle.getText("SUBSTITUTION_RULE_DELETE"),icon:this.constants.iconPool.getIconURI("delete"),lite:true});O.bindProperty("visible","SupportsDeleteSubstitutionRule",function(i){return i;});O.attachPress(this,this.deleteSubstitutionRule);if(t.bSubstitutionProfileAvailable){r.createRow(e,g,u,B,J,N,O);}else{r.createRow(e,g,B,J,N,O);}}else{if(t.bSubstitutionProfileAvailable){r.createRow(e,g,u,B,J,N);}else{r.createRow(e,g,B,J,N);}}var P=new sap.ui.commons.layout.MatrixLayout(d+'rowRepMainMatrixWapperMatrix',{layoutFixed:true});P.createRow(r);P.createRow(new sap.ui.commons.TextView(d+'rowRepWapperMatEmptyTxt',{text:""}));var Q;if(a===(this.getId()+'--iamSubstituting')){Q=this.substitutesRuleCollection;s.setModel(this._getSubstitutesRuleCollectionModel());}else{Q=this.substitutionRuleCollection;s.setModel(this._getSubstitutionRuleCollectionModel());}s.bindRows("/"+Q,P,null,this._getFilters(b));}else{this._refreshBindings(a,b);}return s;};
sap.uiext.inbox.SubstitutionRulesManager.prototype.formatUserName=function(v){if(v!==null&&v!==""){var i=v.indexOf(",");var l=v.substring(i+1);if(l===" ")v=v.substring(0,i);return v;}};
sap.uiext.inbox.SubstitutionRulesManager.prototype.setNoOfRules=function(d){var s=sap.ui.getCore().byId(d+'subsRowRepeater');var w=jQuery(window).height();var p=Math.floor((w-230)/180);if(p>0){s.setNumberOfRows(p);}};
sap.uiext.inbox.SubstitutionRulesManager.prototype.bindSubstitutionRules=function(p){};
sap.uiext.inbox.SubstitutionRulesManager.prototype.deleteMessage=function(e,s){if(s===undefined)s=this;var n=sap.ui.getCore().byId(s.getId()+'--'+'notificationBar1');var d=sap.ui.ux3.NotificationBarStatus.Default;if(n!=undefined&&n.hasItems()){n.setVisibleStatus(d);}};
sap.uiext.inbox.SubstitutionRulesManager.prototype.closeNotificationBar1=function(){var n=sap.ui.getCore().byId(this.getId()+'--'+'notificationBar1');var N=sap.ui.ux3.NotificationBarStatus.None;if(n!=undefined)n.setVisibleStatus(N);};
sap.uiext.inbox.SubstitutionRulesManager.prototype.showMessage=function(m,a){var n=sap.ui.getCore().byId(this.getId()+'--'+'notificationBar1');var M=sap.ui.getCore().byId(this.getId()+'--'+'messageNotifier1');var N=sap.ui.ux3.NotificationBarStatus.None;if(n===undefined){this.populateNotificationBar();}if(n!=undefined){n.setVisibleStatus(N);var b=new Date();var d=sap.ui.core.format.DateFormat.getDateTimeInstance({style:"medium"});var f=d.format(b);var o=new sap.ui.core.Message({text:a,timestamp:f});if(m==="success"){o.setLevel(sap.ui.core.MessageType.Success);}else if(m==="info"){o.setLevel(sap.ui.core.MessageType.Information);}else if(m==="error"){o.setLevel(sap.ui.core.MessageType.Error);}else if(m==="warning"){o.setLevel(sap.ui.core.MessageType.Warning);}M.addMessage(o);n.setMessageNotifier(M);}};
sap.uiext.inbox.SubstitutionRulesManager.prototype._getComponent=function(c){return sap.ui.getCore().byId(this.getId()+'--'+c);};
sap.uiext.inbox.SubstitutionRulesManager.prototype.deleteSubstitutionRule=function(e,t){var m=e.getSource().getModel();var c=e.getSource().getBindingContext();var r=m.getProperty("SubstitutionRuleID",c);var s=m.getProperty("SAP__Origin",c);var d={};d.SubstitutionRuleID=decodeURIComponent(r);d.SAP__Origin=s;t.oDataManager.callFunctionImport(t.substitutionConstants.deleteRuleExecutionFunctionImport,{method:"POST",success:function(a,b){var p=c.getPath();var P=p.split("/");m.oData[P[1]].splice(P[2],1);m.checkUpdate(false);t.showMessage("success",t._oBundle.getText("SUBSTITUTION_VALIDATION_MESSAGE_SUBSTITUTION_RULE_DELETED_SUCCESSFULLY"));},error:function(a){if(a.response===undefined||a.response.statusCode!=205){t.showMessage("error",t._oBundle.getText("SUBSTITUTION_VALIDATION_MESSAGE_SUBSTITUTION_RULE_DELETION_FAILURE_CONTACT_ADMIN"));}else if(a.response.statusCode==205){var b={statusCode:a.response.statusCode,statusText:a.response.statusText};m.fireRequestFailed(b);}},urlParameters:d},true);};
sap.uiext.inbox.SubstitutionRulesManager.prototype.updateSubstitutionRule=function(e,t,E){var m=e.getSource().getModel();var c=e.getSource().getBindingContext();var r=m.getProperty("SubstitutionRuleID",c);var s=m.getProperty("SAP__Origin",c);var u={};u.SubstitutionRuleID=decodeURIComponent(r);u.SAP__Origin=s;u.Enabled=E;t.oDataManager.callFunctionImport(t.substitutionConstants.updateRuleExecutionFunctionImport,{method:"POST",success:function(d,a){var n=sap.ui.getCore().byId(t.getId()+'--subsNavBar');var b=n.getSelectedItem();var p=c.getPath();var P=p.split("/");m.oData[P[1]][P[2]].IsEnabled=d.IsEnabled;m.checkUpdate(true);t.showMessage("success",t._oBundle.getText("SUBSTITUTION_VALIDATION_MESSAGE_SUBSTITUTION_RULE_UPDATED_SUCCESSFULLY"));},error:function(a){if(a.response===undefined||a.response.statusCode!=205){t.showMessage("error",t._oBundle.getText("SUBSTITUTION_VALIDATION_MESSAGE_SUBSTITUTION_RULE_UPDATION_FAILURE_CONTACT_ADMIN"));}else if(a.response.statusCode==205){var b={statusCode:a.response.statusCode,statusText:a.response.statusText};m.fireRequestFailed(b);}},urlParameters:u},true);};
sap.uiext.inbox.SubstitutionRulesManager.prototype.isSubstitutionDatesDateTimeType=function(){var b,e;var t=false;b=this.oTcmMetadata.getParameterTypeForFunctionImport(this.substitutionConstants.CREATE_SUBSTITUTION_RULE,"BeginDate");if(b==="Edm.DateTime"){t=true;}return t;};
sap.uiext.inbox.SubstitutionRulesManager.prototype.createSubstitutionRule=function(e,s){var a=s.validate(s);if(a===false){var m=s.getModel();var E={};var b=s.isSubstitutionDatesDateTimeType();var f=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyyMMdd"});var c;var d;var g=s._getComponent('popupToDatePicker').getYyyymmdd();if(g!=undefined&&g!==""){var h=g.substr(0,4);var i=g.substr(4,2);var j=g.substr(6,8);var o=s.substitutionRulesManagerUtils._getTimeZoneOffset();if(o!==undefined){o=o/(60*1000);d=new Date(Date.UTC(h,i-1,j,23,59-o,59,59))}else{d=f.parse(g);d.setHours(23,59,59,59);}}else{d=null;}var k=s._getComponent('popupFromDatePicker').getYyyymmdd();if(k!=undefined&&k!==""){var l=k.substr(0,4);var n=k.substr(4,2);var p=k.substr(6,8);var o=s.substitutionRulesManagerUtils._getTimeZoneOffset();if(o!==undefined){o=o/(60*1000);c=new Date(Date.UTC(l,n-1,p,0,-o,0,0))}else{c=f.parse(k);}}else{c=new Date();c.setHours(0,0,0,0);}b?E.BeginDate=c.getTime():E.BeginDate="\/Date("+c.getTime()+")\/";var q=s._getComponent('popupValueHelp');E.FullName=q.getValue();E.User=q.data("uniqueName");var r=s._getComponent('popupSegBtn');var t=r.getSelectedButton();if(t.indexOf("popupSegBtnON")>=0){E.Mode=s.substitutionConstants.MODE_RECEIVE_TASKS;b?E.EndDate=d.getTime():E.EndDate="\/Date("+d.getTime()+")\/";}else{E.Mode=s.substitutionConstants.MODE_TAKE_OVER;var u=new Date(9999,11,31);b?E.EndDate=u.getTime():E.EndDate="\/Date("+u.getTime()+")\/";}var C=s._getComponent('activateCheckBox');E.IsEnabled=C.getChecked();if(s.bSubstitutionProfileAvailable){var P=s._getComponent('substProfileValueHelp');if(P!=undefined){E.Profile=P.data("Profile");E.ProfileText=P.data("ProfileText");}s._sendCreateRuleRequestWithProfile(s,E);}else{s._sendCreateRuleRequest(s,E);}var v=sap.ui.getCore().byId(s.getId()+'--createSubsRulePopup');v.close();v.destroy();}};
sap.uiext.inbox.SubstitutionRulesManager.prototype.openUsersDialog=function(e,s){var d=s.getId()+'--';var u=sap.ui.getCore().byId(d+"usersDialog");var t=sap.ui.getCore().byId(d+"userTable");if(u===undefined){var l=new sap.ui.commons.layout.MatrixLayout({id:d+'dLayout',layoutFixed:true,width:'100%'});var S=new sap.ui.commons.SearchField({id:d+'oSearch',enableListSuggest:false,startSuggestion:0,tooltip:s._oBundle.getText("SUBSTIUTION_RULE_SEARCH_FOR_USERS"),editable:true,width:'100%'});S.addDelegate({onAfterRendering:function(){var T=sap.ui.getCore().byId(d+'oSearch-tf');T.prop('placeholder',s._oBundle.getText("SUBSTITUTION_USERS_PICKLIST_SEARCH_LABEL"));}});S.attachSearch(s,function(e,s){t.setBusy(true);s._handleSearchUsersClickforCreateSubstitution(e);});S.attachSuggest(s,function(e,s){if(e.getParameter("value")===""){t.clearSelection();t.bindRows("");}});l.createRow(S);var a={collection:"UserInfoCollection",propertiesLabel:[s._oBundle.getText("SUBSTITUTION_USERS_PICKLIST_LOGONID"),s._oBundle.getText("SUBSTITUTION_USERS_PICKLIST_NAME")],properties:["UniqueName","DisplayName"]};if(t===undefined){t=new sap.ui.table.Table(d+"userTable",{selectionMode:sap.ui.table.SelectionMode.Single});}t.setModel(s.getModel());t.setVisibleRowCount(5);t.attachRowSelectionChange(function(){if(t.getSelectedIndices().length!==0){sap.ui.getCore().byId(d+"usersDialogOKBtn").setEnabled(true);}else{sap.ui.getCore().byId(d+"usersDialogOKBtn").setEnabled(false);}});t.bDynamic=true;for(var i=0;i<=a.properties.length-1;i++){t.addColumn(new sap.ui.table.Column().setLabel(new sap.ui.commons.Label({text:a.propertiesLabel[i],design:sap.ui.commons.LabelDesign.Bold})).setTemplate(new sap.ui.commons.TextField({editable:false,value:{path:a.properties[i]}})));}var L=new sap.ui.commons.layout.VerticalLayout(d+"userDialogVLayout",{width:"100%"});L.insertContent(l,0);L.insertContent(t,1);u=new sap.ui.commons.Dialog(d+"usersDialog",{modal:true,title:s._oBundle.getText("SUBSTIUTION_RULE_SEARCH_FOR_USERS"),content:[L],buttons:[new sap.ui.commons.Button(d+"usersDialogOKBtn",{enabled:false,text:s._oBundle.getText("INBOX_BUTTON_OK_TEXT"),tooltip:s._oBundle.getText("SUBSTITUTE_SEARCH_USERS_OK_BUTTON_TOOLTIP"),press:function(){var b=sap.ui.getCore().byId(d+"userTable");var c=b.getSelectedIndex();var r=b.getContextByIndex(c);var f=sap.ui.getCore().byId(d+'userTable').getModel();var g=f.getProperty("DisplayName",r);if(g===null)g="";var h=f.getProperty("UniqueName",r);var p=s._getComponent('popupValueHelp');p.setValue(g);p.data("uniqueName",h);u.close();}})]});}u.setWidth("400px");u.open();u.attachClosed(s,function(e,s){u.destroy();});u.setInitialFocus(S);};
sap.uiext.inbox.SubstitutionRulesManager.prototype.validate=function(s){var t=this;var v=false;var r="";var a,f;var F=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyyMMdd"});var e=s._getComponent('popupToDatePicker').getYyyymmdd();var b=s._getComponent('popupFromDatePicker').getYyyymmdd();if(e!=undefined&&e!==""){var c=e.substr(0,4);var d=e.substr(4,2);var g=e.substr(6,8);var o=s.substitutionRulesManagerUtils._getTimeZoneOffset();if(o!==undefined){o=o/(60*1000);a=new Date(Date.UTC(c,d-1,g,23,59-o,59,59))}else{a=F.parse(e);a.setHours(23,59,59,59);}}if(b!=undefined&&b!==""){var h=b.substr(0,4);var i=b.substr(4,2);var j=b.substr(6,8);var o=s.substitutionRulesManagerUtils._getTimeZoneOffset();if(o!==undefined){o=o/(60*1000);f=new Date(Date.UTC(h,i-1,j,0,-o,0,0))}else{f=F.parse(b);}}var k=s._getComponent('popupValueHelp').getValue();var p=s._getComponent('popupFromDatePicker').getProperty("required");if(k===null||k===""){v=true;r=s._oBundle.getText("SUBSTITUTION_VALIDATION_MESSAGE_SELECT_SUBSTITUTE");}if(v!=true&&p===true){if(a===null||f===null||a===""||f===""||isNaN(a)||isNaN(f)){v=true;r=s._oBundle.getText("SUBSTITUTION_VALIDATION_MESSAGE_ENTER_VALID_DATE_RANGE");}if(v!=true){if(a<f){v=true;r=s._oBundle.getText("SUBSTITUTION_VALIDATION_MESSAGE_FROM_DATE_AFTER_TODATE");}}}if(v!=true&&p!=true){if(a!=null&&f!=null){if(v!=true&&a<f){v=true;r=s._oBundle.getText("SUBSTITUTION_VALIDATION_MESSAGE_FROM_DATE_AFTER_TODATE");}}}if(v===true){s.showMessage("error",r);}return v;};
sap.uiext.inbox.SubstitutionRulesManager.prototype.populateNotificationBar=function(){var n=sap.ui.getCore().byId(this.getId()+'--'+"notificationBar1");if(n===undefined){var N=new sap.ui.ux3.NotificationBar({id:this.getId()+'--'+"notificationBar1",visibleStatus:"None"});N.attachDisplay(function(e){var s=N.getVisibleStatus();var a=sap.ui.ux3.NotificationBarStatus.None;var d=sap.ui.ux3.NotificationBarStatus.Default;if(s===a){N.setVisibleStatus(d);}else{N.setVisibleStatus(a);}});var m=new sap.ui.ux3.Notifier({id:this.getId()+'--'+"messageNotifier1",title:this._oBundle.getText("INBOX_NOTIFICATIONS"),});N.setMessageNotifier(m);N.addStyleClass("sapUiExtInboxNotificationBar");return N;var c=this._getComponent('popupMainMatrixCellMsgBar');c.addContent(N);}};
sap.uiext.inbox.SubstitutionRulesManager.prototype._refreshBindings=function(i,a){var d=i;var c=(i===(this.getId()+'--iamSubstituting'))?this.substitutesRuleCollection:this.substitutionRuleCollection;if(c===this.substitutesRuleCollection&&!this.bSubstituteDataRefreshed){this._getSubstitutesRulesData(this.getModel());this.bSubstituteDataRefreshed=true;}if(a===undefined){this._refreshBindings(i,true);this._refreshBindings(i,false);}else if(a){var w=sap.ui.getCore().byId(d+'active'+'--'+'rowRepMainMatrixWapperMatrix');var s=sap.ui.getCore().byId(d+'active'+'--'+'subsRowRepeater');s.bindRows("/"+c,w,null,this._getFilters(a));}else{var b=sap.ui.getCore().byId(d+'inactive'+'--'+'rowRepMainMatrixWapperMatrix');var S=sap.ui.getCore().byId(d+'inactive'+'--'+'subsRowRepeater');S.bindRows("/"+c,b,null,this._getFilters(a));}};
sap.uiext.inbox.SubstitutionRulesManager.prototype.getSubstitutionRulesManagerUtils=function(){return this.substitutionRulesManagerUtils;};
sap.uiext.inbox.SubstitutionRulesManager.prototype._searchUsers=function(s){var t=this;var f=this.oTCMModel.getFunctionImportHandler();var d=t.getId()+'--';var T=sap.ui.getCore().byId(d+"userTable");f.setServiceURL(this.sUrl);f.setHeaders({Accept:this.inboxConstants.acceptHeaderforJSON,"x-csrf-token":this.getModel().oHeaders["x-csrf-token"]});var S=s.sSearchTerm;var m=s.iMaxResults;var a=s.sSAPOrigin;var r;this.oPendingSearchRequestInSubstitution=f.callSearchUsers({SearchPattern:jQuery.sap.encodeURL(S),MaxResults:m,SAP__Origin:a},function(D,b){T.setBusy(false);r=D;t.displaySubstitesSearchResults(r,T,m);t.oPendingSearchRequestInSubstitution=undefined;},function(e){T.setBusy(true);if(e.response!==undefined){t.showMessage("error",t._oBundle.getText("INBOX_MSG_NO_USER_FOUND",[S]));T.setBusy(false);}t.oPendingSearchRequestInSubstitution=undefined;});};
sap.uiext.inbox.SubstitutionRulesManager.prototype.displaySubstitesSearchResults=function(r,t,m){if(r){var M=new sap.ui.model.json.JSONModel();M.setData(r);t.clearSelection();t.setModel(M);t.bindRows("/results");if(r.results.length>0){t.setSelectedIndex(0);}}if(r.results.length===m){this.showMessage("warning",this._oBundle.getText("INBOX_TOP_MAX_USER",[m]));}if(r.results.length===0){this.showMessage("error",this._oBundle.getText("INBOX_MSG_FOR_NO_DATA"));}};
sap.uiext.inbox.SubstitutionRulesManager.prototype._handleSearchUsersClickforCreateSubstitution=function(e){var m=this.oConfiguration?this.oConfiguration.getSearchUersMaxLimit():100;var s="";var S=e.getParameter("query").trim();if(this.bSystemInfoAvailable===undefined){var o=this.constants.SystemInfoCollection;this.bSystemInfoAvailable=this.oTcmMetadata._isEntitySet(o.name,o.entityType);}if(this.bSystemInfoAvailable){s=this.oSystemInfoData[0].SAP__Origin;}if(this.oPendingSearchRequestInSubstitution!==undefined){this.oPendingSearchRequestInSubstitution.abort();}this._searchUsers({sSearchTerm:S,iMaxResults:m,sSAPOrigin:s});};
sap.uiext.inbox.SubstitutionRulesManager.prototype._sendCreateRuleRequestWithProfile=function(s,e){var c=jQuery.proxy(function(S){if(S.length==0){this._sendCreateRuleRequest(s,e);}else{e.BeginDate="/Date("+e.BeginDate+")/";e.EndDate="/Date("+e.EndDate+")/";if(S.length===1){this._createSubRuleWithProfile(e,S[0]);}else if(S.length>1){this._createSubRuleWithProfileBatch(e,S);}}},this);this._getProvidersForCreateSubstitution(e,c);};
sap.uiext.inbox.SubstitutionRulesManager.prototype._sendCreateRuleRequest=function(s,e){var p="Profile";if(!e[p]){delete e[p];}var m=this.getModel();var S=this._getSubstitutionRuleCollectionModel();if(this.oTcmMetadata._isFunctionImport(this.substitutionConstants.CREATE_SUBSTITUTION_RULE)){m.callFunction("CreateSubstitutionRule","POST",e,null,function(d,r){s.showMessage("success",s._oBundle.getText("SUBSTITUTION_VALIDATION_MESSAGE_SUBSTITUTION_RULE_CREATED_SUCCESSFULLY"));S.oData.SubstitutionRuleCollection.push(d);S.checkUpdate(false);},function(a){s.showMessage("error",s._oBundle.getText("SUBSTITUTION_VALIDATION_MESSAGE_SUBSTITUTION_RULE_CREATION_FAILURE_CONTACT_ADMIN"));});}else{m.create(s.sPath,e,null,function(d,r){s.showMessage("success",s._oBundle.getText("SUBSTITUTION_VALIDATION_MESSAGE_SUBSTITUTION_RULE_CREATED_SUCCESSFULLY"));S.oData.SubstitutionRuleCollection.push(d);S.checkUpdate(false);m.oHeaders["DataServiceVersion"]="2.0";},function(a){s.showMessage("error",s._oBundle.getText("SUBSTITUTION_VALIDATION_MESSAGE_SUBSTITUTION_RULE_CREATION_FAILURE_CONTACT_ADMIN"));});}};
sap.uiext.inbox.SubstitutionRulesManager.prototype._getSubstitutionRuleCollectionModel=function(){if(!this.oSubstitutionRuleCollectionModel)this.oSubstitutionRuleCollectionModel=new sap.ui.model.json.JSONModel();return this.oSubstitutionRuleCollectionModel;};
sap.uiext.inbox.SubstitutionRulesManager.prototype._getSubstitutesRuleCollectionModel=function(){if(!this.bSubstituteDataRefreshed){if(!this.oSubstitutesRuleCollectionModel)this.oSubstitutesRuleCollectionModel=new sap.ui.model.json.JSONModel();this._getSubstitutesRulesData(this.getModel());this.bSubstituteDataRefreshed=true;}return this.oSubstitutesRuleCollectionModel;};
sap.uiext.inbox.SubstitutionRulesManager.prototype.openSubstProfileDialog=function(e,s){var d=s.getId()+'--';var o=function(S){var D={};jQuery.each(S.results,function(i,f){var I={};I.Profile=f.Profile;I.ProfileText=f.ProfileText;D[f.Profile+" - "+f.ProfileText]=I;});var p=[];var k=0;jQuery.each(D,function(j,i){p[k++]=i;});var a={};a.results=p;var m=new sap.ui.model.json.JSONModel();m.setData(a);var t=sap.ui.getCore().byId(d+"substProfileTable");if(t===undefined){t=new sap.ui.table.Table(d+"substProfileTable",{selectionMode:sap.ui.table.SelectionMode.Single});}t.clearSelection();t.setModel(m);t.bindRows("/results");t.setVisibleRowCount(5);t.bDynamic=true;t.addColumn(new sap.ui.table.Column().setLabel(new sap.ui.commons.Label({text:s._oBundle.getText("SUBSTITUTION_RULE_SUBSTITUTION_PROFILE"),design:sap.ui.commons.LabelDesign.Bold})).setTemplate(new sap.ui.commons.TextField({editable:false,}).bindValue({parts:[{path:"ProfileText",type:new sap.ui.model.type.String()},{path:"Profile",type:new sap.ui.model.type.String()}],formatter:function(P,f){if(P&&f){return P+" ("+f+")";}else{return null;}}})));var b=sap.ui.getCore().byId(d+"substProfileDialog");if(b===undefined){var l=new sap.ui.commons.layout.MatrixLayout({id:d+'searchSubstProfileLayout',layoutFixed:true,width:'100%'});var c=new sap.ui.commons.SearchField({id:d+'substProfileSearch',enableListSuggest:false,startSuggestion:0,tooltip:s._oBundle.getText("SUBSTIUTION_RULE_SEARCH_FOR_SUBSTITUTION_PROFILE"),editable:true,width:'100%'});c.addDelegate({onAfterRendering:function(){var T=sap.ui.getCore().byId(d+'substProfileSearch-tf');T.prop('placeholder',s._oBundle.getText("SUBSTITUTION_USERS_PICKLIST_SEARCH_LABEL"));}});c.attachSuggest(function(e){var v=e.getParameter("value");var f=[];f.push(new sap.ui.model.Filter("ProfileText",sap.ui.model.FilterOperator.Contains,v));f.push(new sap.ui.model.Filter("Profile",sap.ui.model.FilterOperator.Contains,v));var F=new sap.ui.model.Filter(f,false);t.getBinding("rows").filter(F,sap.ui.model.FilterType.Application);});l.createRow(c);var L=new sap.ui.commons.layout.VerticalLayout(d+"substProfileDialogVLayout",{width:"100%"});L.insertContent(l,0);L.insertContent(t,1);b=new sap.ui.commons.Dialog(d+"substProfileDialog",{width:'400px',modal:true,title:s._oBundle.getText("SUBSTIUTION_RULE_SEARCH_FOR_SUBSTITUTION_PROFILE"),content:[L],buttons:[new sap.ui.commons.Button(d+"substProfileDialogOKBtn",{text:s._oBundle.getText("INBOX_BUTTON_OK_TEXT"),tooltip:s._oBundle.getText("SUBSTIUTION_RULE_SEARCH_SUBSTITUTION_PROFILE_OK_BUTTON_TOOLTIP"),press:function(){var f=sap.ui.getCore().byId(d+"substProfileTable");var g=f.getSelectedIndex();var r=f.getContextByIndex(g);var h=f.getModel();var i=h.getProperty("ProfileText",r);var j=h.getProperty("Profile",r);var n=s._getComponent('substProfileValueHelp');n.setValue(i);n.data("Profile",j);n.data("ProfileText",i);b.close();}})]});}b.open();b.attachClosed(s,function(e,s){b.destroy();});b.setInitialFocus(c);};s._getSubstProfileData(o);};
sap.uiext.inbox.SubstitutionRulesManager.prototype._getSubstProfileData=function(o){if(!m){var m=this.getModel();}var t=this;if(!this.oSubstitutionProfileData){this.oDataManager.readData("/SubstitutionProfileCollection",{success:function(d,r){t.oSubstitutionProfileData=d;o(t.oSubstitutionProfileData);},error:function(e){t.showMessage("error",t._oBundle.getText("INBOX_MSG_FETCH_SUBSTITUTION_PROFILE_FAILED"));}});}else{o(this.oSubstitutionProfileData);}};
sap.uiext.inbox.SubstitutionRulesManager.prototype._getProvidersForCreateSubstitution=function(e,c){var s=[];var p=this._getComponent('substProfileValueHelp').getValue();if(p!=null&&p!==""){jQuery.each(this.oSubstitutionProfileData.results,function(i,b){if(b.Profile===e.Profile&&b.ProfileText===e.ProfileText){s.push(b.SAP__Origin);}});}else{var S=this.oSystemInfoData;for(var a in S){s.push(S[a].SAP__Origin);};}c(s);};
sap.uiext.inbox.SubstitutionRulesManager.prototype._createSubRuleWithProfile=function(e,p){var m=this.getModel();var s=this._getSubstitutionRuleCollectionModel();var f=s.oData.SubstitutionRuleCollection.length>0;var t=this;var T={};T=jQuery.extend(true,{},e);T.SAP__Origin=p;m.create(this.sPath,T,{success:function(d,r){t.showMessage("success",t._oBundle.getText("SUBSTITUTION_VALIDATION_MESSAGE_SUBSTITUTION_RULE_CREATED_SUCCESSFULLY"));if(f)t._fetchSubstitutionRuleCollectionData();else s.oData.SubstitutionRuleCollection.push(d);s.checkUpdate(false);},error:function(a){if(a.response===undefined||a.response.statusCode!=205){t.showMessage("error",t._oBundle.getText("SUBSTITUTION_VALIDATION_MESSAGE_SUBSTITUTION_RULE_CREATION_FAILURE_CONTACT_ADMIN"));}else if(a.response.statusCode==205){var b={statusCode:a.response.statusCode,statusText:a.response.statusText};m.fireRequestFailed(b);}}});};
sap.uiext.inbox.SubstitutionRulesManager.prototype._createSubRuleWithProfileBatch=function(e,s){var S=this._getSubstitutionRuleCollectionModel();var f=S.oData.SubstitutionRuleCollection.length>0;var t=this;var E=[];jQuery.each(s,function(i,a){var T={};T=jQuery.extend(true,{},e);T.SAP__Origin=a;E.push(T);});this.oDataManager.fireBatchRequest({sPath:t.sPath,sMethod:"POST",aProperties:E,numberOfRequests:s.length,sBatchGroupId:"createSubRule",fnSuccess:function(d,r){var b=d.__batchResponses;var a=[],c=[];jQuery.each(b,function(i,o){var C=o.__changeResponses;if(C){if(C[0].statusCode==="201"&&C[0].statusText==="Created"){if(!f)S.oData.SubstitutionRuleCollection.push(C[0].data);c.push(i);}else{a.push(i);}}else{a.push(i);}});if(f)t._fetchSubstitutionRuleCollectionData();if(a.length>0){if(c.length<1){t.showMessage("error",t._oBundle.getText("SUBSTITUTION_VALIDATION_MESSAGE_SUBSTITUTION_RULE_CREATION_FAILURE_CONTACT_ADMIN"));}else{t.showMessage("warning",t._oBundle.getText("INBOX_MSG_CREATE_SUBSTITUTION_SUCCESS_AND_ERROR",[c.length,s.length]));}}else{t.showMessage("success",t._oBundle.getText("SUBSTITUTION_VALIDATION_MESSAGE_SUBSTITUTION_RULE_CREATED_SUCCESSFULLY"));}S.checkUpdate(false);},fnError:function(o){t.showMessage("error",t._oBundle.getText("SUBSTITUTION_VALIDATION_MESSAGE_SUBSTITUTION_RULE_CREATION_FAILURE_CONTACT_ADMIN"));}});};
sap.uiext.inbox.SubstitutionRulesManager.prototype._getFilters=function(i){var t=this.substitutionRulesManagerUtils._getTodaysDate();var T=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0);var o=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),23,59,59,59);var f,F,a;var e=i;if(i){f=new sap.ui.model.Filter("IsEnabled",sap.ui.model.FilterOperator.EQ,true);F=new sap.ui.model.Filter("BeginDate",sap.ui.model.FilterOperator.LE,o);a=new sap.ui.model.Filter("EndDate",sap.ui.model.FilterOperator.GE,T);}else{f=new sap.ui.model.Filter("IsEnabled",sap.ui.model.FilterOperator.EQ,false);F=new sap.ui.model.Filter("BeginDate",sap.ui.model.FilterOperator.GT,o);a=new sap.ui.model.Filter("EndDate",sap.ui.model.FilterOperator.LT,T);}var b=[f,F,a];var c=new sap.ui.model.Filter(b,e);var d=[c];return d;};
