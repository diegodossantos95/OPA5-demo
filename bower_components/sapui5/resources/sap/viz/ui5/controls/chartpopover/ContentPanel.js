/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2017 SAP SE. All rights reserved
 */
sap.ui.define(['jquery.sap.global','./ShapeMarker','sap/ui/core/Control','sap/ui/layout/form/SimpleForm','sap/ui/layout/Grid','sap/m/Text','sap/m/ObjectNumber','sap/m/Label','sap/ui/core/TextAlign','../common/utils/SelectionDetailUtil'],function(q,S,C,a,G,T,O,L,b,c){"use strict";var d=C.extend('sap.viz.ui5.controls.chartpopover.ContentPanel',{metadata:{properties:{'showLine':'boolean'},publicMethods:["setContentData"]},renderer:{render:function(r,o){r.write('<div');r.addClass("viz-controls-chartPopover-contentPanel");r.writeClasses();r.writeControlData(o);r.writeAttribute("aria-labelledby",o._oDimLabel.getId()+" "+o._oForm.getId());r.writeAttribute('tabindex',-1);r.write('>');r.renderControl(o._oShapeLabel);r.renderControl(o._oPanel);r.write('</div>');}}});d.prototype.init=function(){this._measureItemsLen=0;this._maxMeasureLableLen=15;this._maxMeasureValueLen=12;this._oShapeLabel=new S(this._createId('vizShapeMarker'),{}).addStyleClass('viz-controls-chartPopover-dimension-marker');this._oDimLabel=new T(this._createId('vizDimensionLabel'),{}).addStyleClass('viz-controls-chartPopover-dimension-label');this._oForm=new a({editable:false,maxContainerCols:2,layout:"ResponsiveGridLayout",labelSpanL:6,labelSpanM:6,labelSpanS:6,emptySpanL:0,emptySpanM:0,emptySpanS:0,columnsL:2,columnsM:2,content:[]});this._oPanel=new G({width:'100%',defaultSpan:"L12 M12 S12",content:[this._oDimLabel,this._oForm]}).addStyleClass('viz-controls-chartPopover-Vlt');};d.prototype.setContentData=function(e){var v=e.val,f='',m,g,h={},n;this._measureItemsLen=0;if(v){this._oForm.removeAllContent();var j=false,i,k;for(i=0;i<v.length;i++){if(v[i].type&&v[i].type.toLowerCase()==='dimension'){if(e.isTimeSeries&&v.hasOwnProperty("timeDimensions")&&v.timeDimensions.indexOf(i)>-1){g=v[i].value;var l=(v[i].timeAxis&&v[i].timeAxis.getFiscalUnitLabels&&v[i].timeAxis.getFiscalUnitLabels());if(l&&l.length>0){k=g.fiscalperiod;if(g.fiscalyear){if(!k||k.length<g.fiscalyear.length){k=g.fiscalyear;}}}else{k=g.time;if(g.day){if(!k||k.length<g.day.length){k=g.day;}}}if(v[i].name.length>this._maxMeasureLableLen||k.length>this._maxMeasureValueLen){j=true;break;}else{if(l&&l.length>0&&l[0].length>this._maxMeasureLableLen){j=true;break;}if(l&&l.length>1&&l[1].length>this._maxMeasureLableLen){j=true;break;}}}}else if(v[i].type&&v[i].type.toLowerCase()==='measure'){m=v[i].value;if(m==null){m=this._getNoValueLabel();}if((v[i].dataName||v[i].name).length>this._maxMeasureLableLen||m.toString().length>this._maxMeasureValueLen){j=true;break;}}}for(i=0;i<v.length;i++){n=v[i].dataName||v[i].name;if(v[i].type&&v[i].type.toLowerCase()==='dimension'){g=v[i].value;if(e.isTimeSeries&&v.hasOwnProperty("timeDimensions")&&v.timeDimensions.indexOf(i)>-1){var l=(v[i].timeAxis&&v[i].timeAxis.getFiscalUnitLabels&&v[i].timeAxis.getFiscalUnitLabels());if(l&&l.length>0){h.name=l[0];h.value=g.fiscalyear;this._renderLabels(j,h,e.isTimeSeries);if(l.length>1){h.name=l[1];h.value=g.fiscalperiod;this._renderLabels(j,h,e.isTimeSeries);}}else{if(g.time){h.name=n;h.value=g.time;this._renderLabels(j,h,e.isTimeSeries);}if(g.day){h.name=g.time?"":n;h.value=g.day;this._renderLabels(j,h,e.isTimeSeries);}}}else{if(f==null){f=this._getNoValueLabel();}else if(f.length>0){if(g===null){f=f+' - '+this._getNoValueLabel();}else{f=f+' - '+g;}}else{if(g===null){f=this._getNoValueLabel();}else{f=g.toString();}}}}else if(v[i].type&&v[i].type.toLowerCase()==='measure'){h.name=n;h.value=v[i].value;h.unit=v[i].unit;this._renderLabels(j,h);}}var o=function(e){var r=false;if(e.selectByTimeAxisGroup&&e.val){var s=0;for(var i=0;i<e.val.length;i++){if(e.val[i].type==='Measure'){s++;}}if(s>1){r=true;}}return r;};if(!o(e)&&typeof e.color==='string'){var p=this._oDimLabel.$().css('margin-left');if(p){p=parseInt(p.substr(0,p.length-2),10);this._oShapeLabel.setMarkerSize(p);}this._oShapeLabel.setColor(e.color).setType((e.shape?e.shape:'square'));if(this.getShowLine()){this._oShapeLabel.setShowWithLine(e.type).setLineInfo(e.lineInfo);}else{this._oShapeLabel.setShowWithLine(undefined);}if(e.stroke&&e.stroke.visible){this._oShapeLabel.setStroke(e.stroke);}}else{this._oShapeLabel.setType(null);this._oShapeLabel.setShowWithLine(undefined);}if(e.pattern){this._oShapeLabel.setPattern(e.pattern);}else{this._oShapeLabel.setPattern(null);}if(f&&f.length>0){this._oDimLabel.setVisible(true);this._oDimLabel.setText(f);}else{this._oDimLabel.setVisible(false);}this._measureItemsLen=e.val.length;}};d.prototype._renderLabels=function(i,e,f){var v;if(i){this._oForm.setLabelSpanS(12);if(e.name!==''){this._oForm.addContent(new T({text:e.name}).addStyleClass('viz-controls-chartPopover-measure-labels viz-controls-chartPopover-measure-labels-wrapper-name'));}v=new O({number:e.value,unit:e.unit,textAlign:b.Begin}).addStyleClass('viz-controls-chartPopover-measure-labels viz-controls-chartPopover-measure-labels-wrapper-value');this._oForm.addContent(v);if(f&&(e.name==='')){v.addStyleClass('viz-controls-chartPopover-timeDayDimValue');}}else{this._oForm.setLabelSpanS(6);this._oForm.addContent(new L({text:e.name}).addStyleClass('viz-controls-chartPopover-measure-labels viz-controls-chartPopover-measure-name'));if(e.value!==null){v=new O({number:e.value,unit:e.unit,textAlign:b.End}).addStyleClass('viz-controls-chartPopover-measure-labels viz-controls-chartPopover-measure-value');}else{v=new O({number:this._getNoValueLabel(),textAlign:b.End}).addStyleClass('viz-controls-chartPopover-measure-labels viz-controls-chartPopover-measure-value');}if(f&&(e.name==='')){v.addStyleClass('viz-controls-chartPopover-timeDayValue');}this._oForm.addContent(v);}};d.prototype.isMultiSelected=function(){return this._measureItemsLen===0;};d.prototype._createId=function(i){return this.getId()+"-"+i;};d.prototype._getNoValueLabel=function(){return sap.viz.extapi.env.Language.getResourceString("IDS_ISNOVALUE");};d.prototype.exit=function(i){if(this._oForm){this._oForm.destroy();this._oForm=null;}if(this._oShapeLabel){this._oShapeLabel.destroy();this._oShapeLabel=null;}if(this._oDimLabel){this._oDimLabel.destroy();this._oDimLabel=null;}if(this._oPanel){this._oPanel.destroy();this._oPanel=null;}};return d;});
