/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2017 SAP SE. All rights reserved
 */
sap.ui.define(['sap/viz/ui5/controls/common/utils/Constants'],function(C){"use strict";function a(i){return Object.prototype.toString.call(i)==='[object Array]';}function c(f,m,g,h,F){var r={dataset:null,context:null};if(!g||g.length===0){return r;}var A=[],k=[],M=[],n=[],o=[];jQuery.each(f,function(i,l){if(l.getAxis()===1){A.push({def:l,adapter:l._getAdapter()});}else if(l.getAxis()===2){k.push({def:l,adapter:l._getAdapter()});}else{throw new Error("currently, only axis 1 and 2 are supported");}});jQuery.each(m,function(i,l){M.push({def:l,adapter:l._getAdapter()});n.push([]);});function p(y,z,B){var l=y.length,V,i;if(l===0){return 0;}V=[];for(i=0;i<l;i++){V.push(y[i].adapter(B));}for(i=0,l=z.length;i<l;i++){if(jQuery.sap.equal(z[i],V)){return i;}}z.push(V);return z.length-1;}var q=[];var s=[];jQuery.each(g,function(I,l){var y=p(A,q,l);var z=p(k,s,l);for(var i=0;i<M.length;i++){var B=M[i].adapter(l);if(A.length===0&&k.length===0){if(n[i][0]===undefined){n[i][0]=[];}n[i][0].push(B);}else{(n[i][z]=(n[i][z]||[]))[y]=B;}}if(A.length===0&&k.length===0){y=I;}(o[z]||(o[z]=[]))[y]=l;});var L=q.length;var t=Math.max(s.length,1);for(var j=0;j<t;j++){for(var i=0;i<M.length;i++){var d=n[i][j];if(!d){d=n[i][j]=[];}if(d.length<L){d[L-1]=undefined;}}if(!o[j]){o[j]=[];}if(!o[j].length<L){o[j][L]=undefined;}}var u={};if(A.length>0){if(u.analysisAxis===undefined){u.analysisAxis=[];}var v={index:1,data:[]};for(var i=0;i<A.length;i++){var w=[];for(var j=0;j<q.length;j++){w[j]=q[j][i];}v.data.push({name:A[i].def.getName(),values:w});}u.analysisAxis.push(v);}if(k.length>0){if(u.analysisAxis===undefined){u.analysisAxis=[];}var v={index:2,data:[]};for(var i=0;i<k.length;i++){var w=[];for(var j=0;j<s.length;j++){w[j]=s[j][i];}v.data.push({name:k[i].def.getName(),values:w});}u.analysisAxis.push(v);}if(M.length>0){u.measureValuesGroup=[];for(var i=0;i<M.length;i++){if(!u.measureValuesGroup[M[i].def.getGroup()-1]){u.measureValuesGroup[M[i].def.getGroup()-1]={index:M[i].def.getGroup(),data:[]};}u.measureValuesGroup[M[i].def.getGroup()-1].data.push({name:M[i].def.getName(),values:n[i]});}for(var i=0,x=u.measureValuesGroup.length;i<x;i++){if(u.measureValuesGroup[i]===undefined){throw new Error("Measure Group "+(i+1)+" is missing.");}}}r.dataset=F?new sap.viz.data.CrosstableDataset():new sap.viz.api.data.CrosstableDataset();r.dataset.data(u);if(h){r.dataset.info(h);}r.context=o;return r;}function b(d,m,f,g,p,h){var r={dataset:null,context:null};var k=['_context_row_number'];if(f){if(!a(f)){f=[f];}for(var i=0;i<f.length;++i){var n=f[i];var s=!(n.showInTooltip===false);if(n.id){n=n.id;}k.push({id:n,showInTooltip:s});}}var A=[],M=[],l=[],o={'metadata':{'fields':[]},'context':k,'data':[]},q=[];jQuery.each(d,function(i,j){A.push({def:j,vAdapter:j._getAdapter(),dAdapter:j._getDisplayValueAdapter()});var t=j.getDataType();o.metadata.fields.push({'id':j.getIdentity()||j.getName(),'name':j.getName()||j.getIdentity(),'semanticType':'Dimension','dataType':t,'inResult':j._getInResult(),'timeUnitType':j._getTimeUnit()});});jQuery.each(m,function(i,j){M.push({def:j,adapter:j._getAdapter()});var t={'id':j.getIdentity()||j.getName(),'name':j.getName()||j.getIdentity(),'semanticType':'Measure'};t.formatString=j.getFormat();if(j.getUnit()){t.unit=j.getUnit();}t.unitBinding=j._getUnitBinding();var R=j.getRange();if(R&&R.length){t.min=R[0];t.max=R[1];}o.metadata.fields.push(t);});if(p){if(p.bEnabled){o.metadata.options={pagination:{mode:p.sMode,ratio:p.thumbRatio}};}}if(!g||g.length===0){r.dataset=new sap.viz.api.data.FlatTableDataset(o);return r;}if(p&&(!h||p.sMode==="reset")){h=[];}jQuery.each(g,function(I,t){if(!o.data[I]){o.data[I]=[];}for(var i=0;i<A.length;i++){var v=A[i].vAdapter(t);if(v instanceof Date){v=v.getTime();}var V=A[i].dAdapter(t);o.data[I].push(V.enableDisplayValue?{v:v,d:V.value}:v);}for(var j=0;j<M.length;j++){var v=M[j].adapter(t);o.data[I].push(v);var u=M[j].def._getUnitBinding();var U=t.getProperty(u);if(u){if(l[j]){if(l[j]==="*"||l[j]!==U||(p&&h[j]!==U)){throw C.ERROR_MESSAGE.MULTIPLEUNITS;}}else{l[j]=U;if(p&&!h[j]){h[j]=U;}}}}q[I]=t;});r.context=q;o.metadata.fields.filter(function(j){return(j.semanticType==="Measure");}).forEach(function(j,t){if(j.unitBinding&&l[t]){j.unit=l[t];delete j.unitBinding;}});r.dataset=new sap.viz.api.data.FlatTableDataset(o);return r;}var e=function(){this._oCVOMDataset=null;this._aContext=null;this._sDatasetType=null;this._pagingUnit=null;};e.prototype.getDataset=function(o){if(this._sDatasetType===o.type&&this._oCVOMDataset){return this._oCVOMDataset;}this.invalidate();this._sDatasetType=o.type;var r=null;if(this._sDatasetType===C.DATASET_TYPES.FLATTABLEDATASET){r=b(o.dimensions,o.measures,o.contexts,o.dataContexts,o.pagingOption,this._pagingUnit);}else{r=c(o.dimensions,o.measures,o.dataContexts,o.additionalInfo,this._sDatasetType==C.DATASET_TYPES.CROSSTABLEDATASET?false:true);}this._oCVOMDataset=r.dataset;this._aContext=r.context;return this._oCVOMDataset;};e.prototype.findContext=function(o){if(this._sDatasetType===C.DATASET_TYPES.FLATTABLEDATASET){if(this._aContext&&typeof o==='object'&&o._context_row_number!==undefined){return this._aContext[o._context_row_number];}}else{if(this._aContext&&typeof o==='object'){return this._aContext[o.dii_a2]&&this._aContext[o.dii_a2][o.dii_a1];}}return null;};e.prototype.invalidate=function(){this._oCVOMDataset=null;this._aContext=null;};return e;},true);
