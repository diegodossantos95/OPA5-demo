jQuery.sap.declare("sap.zen.crosstab.dragdrop.DragDropHoverManager");
sap.zen.crosstab.dragdrop.DragDropHoverManager=function(c){"use strict";var t=this;var d={};var j=null;var D;var m=false;var C;this.init=function(p){D=p;};this.getCellFromId=function(i){var o=sap.ui.getCore().getControl(i);return o;};this.getCellFromJqCell=function(J){var i=$(J).attr("id");return this.getCellFromId(i);};this.findAllDroppableCells=function(){var a;var J;var p;p=sap.zen.Dispatcher.instance.getDragDropPayload();if(!p){return[];}if(p.oDragDropInfo.bIsMemberDrag){J=p.oDragDropInfo.sAxisName==="ROWS"?c.getRowHeaderAreaDiv():c.getColHeaderAreaDiv();}else{J=c.getDimHeaderAreaDiv();}a=J.find("td .ui-droppable, .ui-droppable-disabled");return a;};this.getDropCell=function(e){var a;var o;var b;a=this.findAllDroppableCells();$.each(a,function(i,f){o=f.getBoundingClientRect();if(e.clientX>o.left&&e.clientX<o.right){if(e.clientY>o.top&&e.clientY<o.bottom){b=t.getCellFromJqCell(f);return false;}}});return b;};this.getCellsForDimensionDrop=function(o){var a;var p;var b;var e=null;a=c.getHeaderInfo().getDimensionInfoByRowCol(o);p=sap.zen.Dispatcher.instance.getDragDropPayload();if(!D.isExternalDropOnNonRemovableStructure(a,p)){b=p.oDragDropInfo;if(b.sDimensionName!==a.sDimensionName&&!sap.zen.Dispatcher.instance.isDragDropCanceled()&&!o.isRevertDrop()){e=c.getHeaderInfo().getCellsWithSameDimension(o);}}return e;};this.getCellsForMemberDrop=function(o){var a;var b;var e;a=c.getHeaderInfo().getDimensionInfoForMemberCell(o);b=sap.zen.Dispatcher.instance.getDragDropPayload().oDragDropInfo;if(b.sDimensionName===a.sDimensionName&&!sap.zen.Dispatcher.instance.isDragDropCanceled()&&!o.isRevertDrop()){if(c.getPropertyBag().isRepeatTexts()){e=D.getAllMemberCellsInRowOrCol(o);}else{e=c.getHeaderInfo().getMemberCellsForSameDimension(o);}}return e;};this.provideDropCellHoverEffect=function(o){var a;var i;var b;var J;var e;var f;var p;var s;p=sap.zen.Dispatcher.instance.getDragDropPayload();if(!p){return;}if(o){if(!p.oDragDropInfo.bIsMemberDrag){a=this.getCellsForDimensionDrop(o);}else{a=this.getCellsForMemberDrop(o);}s=this.getDropCellClassName();if(a){for(i=0;i<a.length;i++){b=a[i];J=$(document.getElementById(b.getId()));J.addClass(s);if(J.hasClass("sapzencrosstab-HeaderCellAlternating")){J.removeClass("sapzencrosstab-HeaderCellAlternating");J.data("bAlternating",true);}J.removeClass("sapzencrosstab-HeaderCellAlternating");}}}};this.cleanupDropCells=function(){var s=t.getDropCellClassName();var J;var M=c.getRenderSizeDiv().find("."+s);$.each(M,function(i,o){J=$(o);J.removeClass(s);if(J.data("bAlternating")===true){J.addClass("sapzencrosstab-HeaderCellAlternating");}});};this.getDropCellClassName=function(){var p=sap.zen.Dispatcher.instance.getDragDropPayload();if(!p){return null;}if(p.oDragDropInfo.bIsMemberDrag){return"sapzencrosstab-DropMemberCell";}else{return"sapzencrosstab-DropHeaderCell";}};this.doOnDropCellOver=function(o,e){var J;if(!j){J=$(document.getElementById(o.getId()));if(D.checkMouseInRenderSizeDiv(e)){if(!J.hasClass(t.getDropCellClassName())){t.cleanupDropCells();t.provideDropCellHoverEffect(o);}}else{J.droppable().trigger("mouseout");}}};this.onDropCellOver=function(e,u){C=t.getCellFromId(e.target.id);C=D.getEffectiveCell(C);t.doOnDropCellOver(C,e);};this.doOnDropCellOut=function(o){var J;if(!j){t.cleanupDropCells();if(o){J=$(document.getElementById(o.getId()));if(!J.hasClass(t.getDropCellClassName())){t.provideDropCellHoverEffect(o);}}}};this.onDropCellOut=function(e,u){var o=t.getDropCell(e);o=D.getEffectiveCell(o);t.doOnDropCellOut(o);};this.disableDropCell=function(o){var J;if(!d[o.getId()]){J=$(document.getElementById(o.getId()));if(J.hasClass("ui-droppable")){J.droppable("disable");J.removeClass(this.getDropCellClassName());d[o.getId()]=J;}}};this.getDisableDimHeaderDropCellsForArea=function(s,a){var b;var r;var M=c.getTableMaxDimHeaderRow();var e=c.getTableMaxDimHeaderCol();var i;var o;var f;f=c.getHeaderInfo().getCellsWithSameDimension(a);if(!f){return[];}if(s==="droparea_above"||s==="droparea_below"){r=a.getTableRow();i=0;while(i<=e){o=c.getTableCellWithColSpan(r,i);if(o){i=i+o.getColSpan();f.push(o);}else{i++;}}}else if(s==="droparea_before"||s==="droparea_after"){b=a.getTableCol();i=0;while(i<=M){o=c.getTableCellWithRowSpan(i,b);if(o){i=i+o.getRowSpan();f.push(o);}else{i++;}}}return f;};this.getDisableMemberDropCellsForArea=function(s,a){var b;var r;var o;var S;var e;var i;var E;var R;var f;var g;b=c.getHeaderInfo().getMemberCellsForSameDimension(a);if((s==="droparea_above"||s==="droparea_below")&&c.hasRowHeaderArea()){r=c.getRowHeaderArea();R=Math.max(a.getRow(),r.getRenderStartRow());i=r.getRenderStartCol();E=i+r.getRenderColCnt()-1;f=i;while(f<=E){g=r.getCellWithRowSpan(R,f);if(g){if(s==="droparea_below"){if(a.getRow()===(g.getRow()+g.getRowSpan()-1)){b.push(g);}}else{if(a.getRow()===g.getRow()){b.push(g);}}f=f+g.getColSpan();}else{f++;}}}else if((s==="droparea_before"||s==="droparea_after")&&c.hasColHeaderArea()){o=c.getColumnHeaderArea();f=Math.max(a.getCol(),o.getRenderStartCol());S=o.getRenderStartRow();e=S+o.getRenderRowCnt()-1;R=S;while(R<=e){g=o.getCellWithColSpan(R,f);if(g){if(s==="droparea_after"){if(a.getCol()===(g.getCol()+g.getColSpan()-1)){b.push(g);}}else{if(a.getCol()===g.getCol()){b.push(g);}}R=R+g.getRowSpan();}else{R++;}}}return b;};this.disableDropCellsForArea=function(s,a){var b;var o;var i;var p;p=sap.zen.Dispatcher.instance.getDragDropPayload();if(!p){return;}if(p.oDragDropInfo.bIsMemberDrag){b=this.getDisableMemberDropCellsForArea(s,a);}else{b=this.getDisableDimHeaderDropCellsForArea(s,a);}for(i=0;i<b.length;i++){o=b[i];this.disableDropCell(o);}};this.cleanupDropAreas=function(){if(j){$.each(d,function(i,o){if(o.hasClass("ui-droppable-disabled")){o.droppable("enable");}});d={};j=null;}};this.onDropAreaOver=function(e,u){var s;var o;var a;t.cleanupDropAreas();j=$(document.getElementById(e.target.id));if(!D.isOnlyMeasuresMode()){t.cleanupDropCells();s=j.data("xtabcellid");a=D.getDropAreaTypeFromDropAreaId(e.target.id);o=sap.ui.getCore().getControl(s);t.disableDropCellsForArea(a,o);}};this.onDropAreaOut=function(e,u){var o;if(!D.isOnlyMeasuresMode()){t.cleanupDropCells();}if(j){$.each(d,function(i,a){if(a.hasClass("ui-droppable-disabled")){a.droppable("enable");}});if(!D.isOnlyMeasuresMode()){o=t.getDropCell(e);if(o){t.provideDropCellHoverEffect(o);}}d={};j=null;}};this.getCurrentDropArea=function(){return j;};this.provideDraggableCellCursor=function(J){J.mouseenter(function(){$(this).css("cursor","move");$(this).find("div").not(".sapzencrosstab-HeaderCellDivSortable, .sapzencrosstab-columnResizeHandle, .sapzencrosstab-columnResizeHandleWithSort, .sapzencrosstab-HeaderCellDivHierarchy").css("cursor","move");});J.mouseleave(function(){$(this).css("cursor","default");$(this).find("div").not(".sapzencrosstab-HeaderCellDivSortable, .sapzencrosstab-columnResizeHandle, .sapzencrosstab-columnResizeHandleWithSort, .sapzencrosstab-HeaderCellDivHierarchy").css("cursor","default");});J.draggable("option","drag",function(e,u){var i=D.checkMouseInRenderSizeDiv(e);var a;var o;D.setCurrentDragHelper($(u.helper));if(!i){a=u.helper.find(".sapzencrosstab-HeaderCellAlternating");jQuery.each(a,function(I,b){if(b){$(b).removeClass("sapzencrosstab-HeaderCellAlternating");$(b).addClass("sapzencrosstab-AlternatingDummy");}});$(u.helper).find(".sapzencrosstab-Trashcan").show();if(!m){t.cleanupDropCells();m=true;}}else{$(u.helper).find(".sapzencrosstab-Trashcan").hide();a=u.helper.find(".sapzencrosstab-AlternatingDummy");jQuery.each(a,function(I,b){if(b){$(b).addClass("sapzencrosstab-HeaderCellAlternating");$(b).removeClass("sapzencrosstab-AlternatingDummy");}});if(m){if(C){o=D.findCell($(e.toElement));if(o&&o.getId()===C.getId()){t.doOnDropCellOver(C,e);}}m=false;}}});};};
