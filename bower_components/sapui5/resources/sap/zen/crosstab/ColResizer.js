jQuery.sap.declare("sap.zen.crosstab.ColResizer");
sap.zen.crosstab.ColResizer=function(c){"use strict";var t=this;var d=c.getDataArea();var r=c.getRowHeaderArea();var C=c.getColumnHeaderArea();var D=c.getDimensionHeaderArea();var R=null;var o=null;var a=null;var j=null;var J=null;var b=null;var m=0;var i=0;var f=false;var u;var I=false;this.initialize=function(){u=c.getUtils();I=c.getPropertyBag().isRtl();J=c.getTableDiv();b=c.getRenderSizeDiv();a=u.getRtlAwareBoundingClientRect(b[0]);j=$(document.getElementById(c.getId()+"_colResizeRuler"));this.attachEvents();};this.attachEvents=function(){J.unbind("dblclick");J.bind("dblclick",this.onDoubleClick);j.unbind("mousemove",this.onMouseMove);j.bind("mousemove",this.onMouseMove);var e=J.find(".sapzencrosstab-columnResizeHandleWithSort, .sapzencrosstab-columnResizeHandle");$.each(e,function(g,h){var k=$(h);k.unbind("mousedown",t.onMouseDown);k.bind("mousedown",t.onMouseDown);k.unbind("mouseup",t.executeonMouseUp);k.bind("mouseup",t.executeonMouseUp);k.unbind("mousemove",t.onMouseMove);k.bind("mousemove",t.onMouseMove);});};this.onDoubleClick=function(e){t.determineResizeCell(e,true);if(R){t.resizeCol(R,-1);R=null;sap.zen.crosstab.utils.Utils.cancelEvent(e);}};this.onMouseUp=function(e){var n;if(R&&o){n=t.calculateNewColWidth(e);if(n>0){t.resizeCol(R,n);}R=null;o=null;j.css("visibility","hidden");f=false;$(document).off("mouseup",t.onMouseUp);sap.zen.crosstab.utils.Utils.cancelEvent(e);}};this.onMouseDown=function(e){if(!R){t.determineResizeCell(e);if(R){o=u.getRtlAwareBoundingClientRect(document.getElementById(R.getId()));m=e.clientX;j.outerHeight(b.outerHeight());i=o.end-j.outerWidth()-a.begin;j.css(I?"right":"left",i+"px");$(document).on("mouseup",t.onMouseUp);sap.zen.crosstab.utils.Utils.cancelEvent(e);}}};this.onMouseMove=function(e){var g;if(R&&o){g=i+t.getDelta(e);if(g!==i){g=Math.max(g,(o.begin-a.begin));if(!f){j.css("visibility","visible");f=true;}j.css(I?"right":"left",g+"px");}sap.zen.crosstab.utils.Utils.cancelEvent(e);}};this.isResizeAction=function(){if(R&&o){return true;}return false;};this.determineResizeCell=function(e,g){var l;var A;R=sap.ui.getCore().byId(e.target.id.slice(5));if(!g&&R.getColSpan()>1){l=R.getCol()+R.getColSpan()-1;A=R.getArea();R=A.getCellWithColSpan(A.getRowCnt()-1,l);if(!R){R=A.getCellWithRowSpan(A.getRowCnt()-1,l);}}};this.calculateNewColWidth=function(e){var g;var n=-1;if(R&&o){g=t.getDelta(e);if(g!==0){n=o.width+g;n=Math.max(1,n);}}return n;};this.getDelta=function(e){if(I){return(m-e.clientX);}else{return(e.clientX-m);}};this.resizeCol=function(e,w){var U=e.getArea();if(U.isColHeaderArea()){this.setColWidths(e,U,d,w);}else if(U.isDimHeaderArea()){this.setColWidths(e,U,r,w);}this.sendUpdateColWidthCommand(e,w);c.invalidate();};this.setColWidths=function(e,U,l,w){var E;var g;var h;E=e.getCol()+e.getColSpan()-1;if(w>0){U.setColWidth(E,w);U.setUserResizedCol(E);l.setColWidth(E,w);l.setUserResizedCol(E);}else{g=0;h=e.getCol()+e.getColSpan()-e.getEffectiveColSpan();for(g=E;g>=h;g--){U.resetColWidth(g);l.resetColWidth(g);U.setUserResizedCol(g);l.setUserResizedCol(g);}}};this.sendUpdateColWidthCommand=function(e,w){var s=c.getUpdateColWidthCommand();if(s!=null&&s.length>0){var T=e.getTableCol();s=s.replace("__COL__",T);s=s.replace("__WIDTH__",Math.round(w));var A=new Function(s);A();}};};
