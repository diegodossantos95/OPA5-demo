jQuery.sap.declare("sap.zen.crosstab.TouchHandler");jQuery.sap.require("sap.zen.crosstab.utils.Utils");
sap.zen.crosstab.TouchHandler=function(E,c){var d=c.getDataArea();var r=c.getRowHeaderArea();var C=c.getColumnHeaderArea();var D=c.getDimensionHeaderArea();var l=0;var L=0;var t=false;var m=false;var o=$(document.getElementById(d.getId()));var a=$(document.getElementById(r.getId()));var b=$(document.getElementById(C.getId()));var f=$(document.getElementById(D.getId()));var T="";var g=null;var h="800";var v=0;var H=0;var R=0;var j=0;var n=0;var N=0;var O=0;var k=0;var p=null;var P=null;var I=2;var q=null;var V=null;var s=null;var u=false;var w;function x(e){var Q=null;var i=0;var S=sap.ui.getCore().getControl(e.target.id);var U=null;var W=null;if(S&&(S.isMobileResize&&S.isMobileResize())){Q=S;}else{var X=$(e.target).parents("td");if(X){for(i=0;i<X.length;i++){U=$(X[i]);W=U.attr("id");if(W&&W.length>0){S=sap.ui.getCore().getControl(W);if(S&&(S.isMobileResize&&S.isMobileResize())){Q=S;break;}}}}}return Q;}function y(e){if(w){var i=e.getParameter("item").oSelectedCell;if(i){w.resizeCol(i,-1);}}}function z(){if(!q){q=sap.ui.getCore().getControl("resizemenu");if(q){q.getItems()[0].destroy();q.destroy();}if(sap.zen.crosstab.utils.Utils.isDispatcherAvailable()===true&&sap.zen.Dispatcher.instance.isMainMode()){$.sap.require("sap.ui.unified.Menu");q=new sap.ui.unified.Menu("resizemenu",{ariaDescription:"Crosstab Menu",tooltip:"Menu containing crosstab related actions"});}else{q=new sap.ui.commons.Menu("resizemenu",{ariaDescription:"Crosstab Menu",tooltip:"Menu containing crosstab related actions"});}q.addStyleClass("sapzencrosstab-MenuStyle");var e=null;if(sap.zen.crosstab.utils.Utils.isDispatcherAvailable()===true&&sap.zen.Dispatcher.instance.isMainMode()){e=new sap.ui.unified.MenuItem("item1",{text:c.getPropertyBag().getText(sap.zen.crosstab.TextConstants.MOBILE_MENUITEM_COLWIDTH_ADJUST_TEXT_KEY)});}else{e=new sap.ui.commons.MenuItem("item1",{text:c.getPropertyBag().getText(sap.zen.crosstab.TextConstants.MOBILE_MENUITEM_COLWIDTH_ADJUST_TEXT_KEY)});}e.attachSelect(y);q.addItem(e);}}function A(){R=(d.getRowCnt()+"").length;j=(d.getColCnt()+"").length;p=new sap.ui.core.Popup();var e=null;if(sap.zen.crosstab.utils.Utils.isDispatcherAvailable()===true&&sap.zen.Dispatcher.instance.isMainMode()){e=new sap.m.Text();}else{e=new sap.ui.commons.TextView()}p.setContent(e);p.setDurations(125,500);p.setAutoClose(true);P=p.getContent();P.addStyleClass("sapzencrosstab-ScrollPopup");P.setWrapping(false);var i=sap.ui.core.Popup.Dock;p.setPosition(i.CenterCenter,i.CenterCenter,document.getElementById(c.getId()+"_renderSizeDiv"),"0");}function B(){var e=c.getPropertyBag().getText(sap.zen.crosstab.TextConstants.ROW_TEXT_KEY)+": "+sap.zen.crosstab.utils.Utils.padWithZeroes(n+1,R)+"/"+r.getRowCnt();var i=c.getPropertyBag().getText(sap.zen.crosstab.TextConstants.COL_TEXT_KEY)+": "+sap.zen.crosstab.utils.Utils.padWithZeroes(N+1,j)+"/"+C.getColCnt();var Q=e+" "+i;p.getContent().setProperty("text",Q,true);p.getContent().rerender();}function F(e){sap.zen.crosstab.utils.Utils.cancelEvent(e);v=0;H=0;n=0;N=0;if(q){q.close();}T=e.currentTarget.getAttribute("id");oCurrentlyHoveredCell=null;if(e.originalEvent.touches&&e.originalEvent.touches.length){e=e.originalEvent.touches[0];}else if(e.originalEvent.changedTouches&&e.originalEvent.changedTouches.length){e=e.originalEvent.changedTouches[0];}l=e.pageX;L=e.pageY;t=true;m=false;if(g){window.clearTimeout(g);g=null;}g=setTimeout(function(){t=false;m=false;var i=x(e);if(i){z();var Q=$(document.getElementById(i.getId()));if(Q.length>0){var S=sap.ui.core.Popup.Dock;q.getItems()[0].oSelectedCell=i;q.open(false,Q,S.BeginBottom,S.BeginTop,Q,0+" "+0,sap.ui.core.Collision.flip);}}},h);}function G(i,e){var Q=c.getHorizontalHeaderScrollbar();if(Q){k=Q.getScrollPosition();N=Math.max(k-i,0);if(e>0){c.scrollHeaderHorizontal(N);}}}function J(i,e,Q,S){if(c.getPropertyBag().isPixelScrolling()){if(V){O=V.getScrollPosition();n=Math.max(O-e,0);}if(s){k=s.getScrollPosition();N=Math.max(k-i,0);}if(V&&S>0){c.scrollVertical(n);}if(s&&Q>0){c.scrollHorizontal(N);}}else{if(p.getOpenState()===sap.ui.core.OpenState.CLOSED){p.open(-1);}if(V){if(c.getRenderEngine().isVScrolledToEnd()){if(sap.zen.crosstab.utils.Utils.sign(e)>0){v-=sap.zen.crosstab.utils.Utils.sign(e);}else{v=0;}}else{v-=sap.zen.crosstab.utils.Utils.sign(e);}O=r.getRenderStartRow();n=Math.max(Math.floor(v/I)+O,0);n=Math.min(d.getRowCnt()-1,n);}if(s){if(c.getRenderEngine().isHScrolledToEnd()){if(sap.zen.crosstab.utils.Utils.sign(i)>0){H-=sap.zen.crosstab.utils.Utils.sign(i);}else{H=0;}}else{H-=sap.zen.crosstab.utils.Utils.sign(i);}k=C.getRenderStartCol();N=Math.max(Math.floor(H/I)+k,0);N=Math.min(d.getColCnt()-1,N);}B();}}function K(e){sap.zen.crosstab.utils.Utils.cancelEvent(e);if(t==false){return true;}if(e.originalEvent.touches&&e.originalEvent.touches.length){e=e.originalEvent.touches[0];}else if(e.originalEvent.changedTouches&&e.originalEvent.changedTouches.length){e=e.originalEvent.changedTouches[0];}var i=e.pageX;var Q=e.pageY;var S=i-l;var U=Q-L;var W=Math.abs(U);var X=Math.abs(S);if(W>X&&X<10){S=0;X=0;}else if(X>W&&W<10){U=0;W=0;}if(S==0&&U==0){m=false;return true;}m=true;if(g){window.clearTimeout(g);g=null;}V=c.getVScrollbar();s=c.getHScrollbar();u=false;if(T===r.getId()){u=c.isHeaderHScrolling()&&(S!==0);if(!u){S=0;X=0;}}else if(T===C.getId()){U=0;W=0;}else if(T===D.getId()){u=c.isHeaderHScrolling()&&(S!==0);if(!u){S=0;X=0;}U=0;W=0;}if(u===true){G(S,X);}else{J(S,U,X,W);}l=e.pageX;L=e.pageY;}function M(e){sap.zen.crosstab.utils.Utils.cancelEvent(e);if(g){window.clearTimeout(g);g=null;}if(t==false){return true;}if(!m){E.executeOnClickAction(e);}t=false;m=false;if(!u){if(!c.getPropertyBag().isPixelScrolling()){if((p.getOpenState()===sap.ui.core.OpenState.OPEN)||(p.getOpenState()===sap.ui.core.OpenState.OPENING)){p.close();}var i=false;if(n!==O){c.scrollVertical(n);i=true;}if(N!==k){c.scrollHorizontal(N);i=true;}if(i===true){E.attachEvents();}}v=0;H=0;}}this.registerTouchEvents=function(e){A();var i="touchstart";if(c.getPropertyBag().isTestMobileMode()&&!c.getPropertyBag().isMobileMode()){i="mousedown";}o.unbind(i);o.bind(i,F);a.unbind(i);a.bind(i,F);b.unbind(i);b.bind(i,F);f.unbind(i);f.bind(i,F);i="touchmove";if(c.getPropertyBag().isTestMobileMode()&&!c.getPropertyBag().isMobileMode()){i="mousemove";}e.unbind(i);e.bind(i,K);i="touchend";if(c.getPropertyBag().isTestMobileMode()&&!c.getPropertyBag().isMobileMode()){i="mouseup";}e.unbind(i);e.bind(i,M);};this.setColResizer=function(e){w=e;};}
