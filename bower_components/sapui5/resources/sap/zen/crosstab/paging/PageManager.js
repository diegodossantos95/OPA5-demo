jQuery.sap.declare("sap.zen.crosstab.paging.PageManager");jQuery.sap.require("sap.zen.crosstab.paging.Page");jQuery.sap.require("sap.zen.crosstab.paging.PagingConstants");jQuery.sap.require("sap.zen.crosstab.paging.RequestHandler");jQuery.sap.require("sap.zen.crosstab.paging.CellMerger");jQuery.sap.require("sap.zen.crosstab.datahandler.JsonDataHandler");
sap.zen.crosstab.paging.PageManager=function(c){"use strict";var j=new sap.zen.crosstab.datahandler.JsonDataHandler(c);var C=new sap.zen.crosstab.paging.CellMerger(this);var r=null;var p={};var h={};var P=0;var a=0;var R="";var b=0;var d=0;var H=false;var e=[];var f=false;var n=true;var o={};var A={};var g={};var k={};var l={};var m={};var q={};var s={};function t(){v();if(f||n){f=false;n=false;u();}}function u(){var i=c.getDataArea();var G=i.getRenderRowCnt();var I=i.getRenderColCnt();var J=Math.round(I/a)+1;var V=Math.round(G/P)+1;var M=Math.max(1,J*V*2);if(r){r.setMaxQueueRequests(M);}}this.enableTimeout=function(i){if(r){r.enableTimeout(i);}};this.getRequestStackSize=function(){var i=-1;if(r){i=r.getMaxQueueRequests();}return i;};this.resizeEvent=function(){f=true;if(r){r.unlimitStack();}};this.checkResponseConsistency=function(i){if(i.pvcheck||i.removeselection){return true;}if(P>0&&a>0){return(i.tilerows===P&&i.tilecols===a);}return true;};this.receiveData=function(i){var I=this.checkResponseConsistency(i);if(I){z(i);var G={};G.iRow=b;G.iCol=d;var J=null;var K=y();if(K){J=this.createPage(G);H=true;}else{J=this.getPage(G);}if(J){J.receiveData(i,K);}if(c.getPropertyBag().isDebugMode()){var L=J.getPosition();var M=L.iRow+"_"+L.iCol;o[M]={};o[M].component=i;}}};function v(){var i=0;var G=null;var I="";for(i=0;i<e.length;i++){G=e[i];if(G){G.removeData();I=G.getPageKey();delete p[I];}}e=[];}c.getRenderEngine().addAfterFinishRenderingHandler(t);this.removeRequest=function(i){e.push(i);};this.getRequestCommandTemplate=function(){return R;};this.removeHeaderTileRequest=function(i,T,G){var I=h[i.getAreaType()];if(I){var J=I[T];if(J){var K=$.inArray(G,J.aRequestingPages);if(K!==-1){J.aRequestingPages.splice(K,1);if(J.aRequestingPages.length===0){J.iStatus=sap.zen.crosstab.paging.PagingConstants.PAGE_STATUS_UNKNOWN;}}}}};this.getHeaderTileInfo=function(i,T){return x(i,T);};this.setHeaderTileInfo=function(i,T,G){var I=w(i);I[T]=G;};function w(i){var T=h[i.getAreaType()];if(!T){T={};h[i.getAreaType()]=T;}return T;}function x(i,T){var G=w(i);var I=G[T];if(!I){I={};I.iStatus=sap.zen.crosstab.paging.PagingConstants.PAGE_STATUS_UNKNOWN;I.iRefCnt=0;G[T]=I;}return I;}this.ensureCellAvailable=function(i,G,I){var J=null;var T=sap.zen.crosstab.paging.PagingConstants.PAGE_STATUS_UNKNOWN;var K=false;var L=false;var M=i.getAreaType()+"/"+G+"/"+I;if(!A[M]){var N=B(G,I,i);if(N){if(i.isRowHeaderArea()){T=this.getHeaderTileInfo(i,N.iRow).iStatus;K=true;}else if(i.isColHeaderArea()){T=this.getHeaderTileInfo(i,N.iCol).iStatus;K=true;}J=this.getPage(N);if(K){if(T===sap.zen.crosstab.paging.PagingConstants.PAGE_STATUS_UNKNOWN){L=true;}}else{L=!J;}if(L){J=this.createPage(N);J.provideLoadingCells(i);if(!r){r=new sap.zen.crosstab.paging.RequestHandler(this);}r.sendPageRequest(J);}else{if((J&&J.getStatus()===sap.zen.crosstab.paging.PagingConstants.PAGE_STATUS_LOADED)||T&&T===sap.zen.crosstab.paging.PagingConstants.PAGE_STATUS_LOADED){A[M]=true;D(i,G,I);}}}}};this.reset=function(){p={};h={};H=false;if(r){r.reset();}n=true;o={};A={};g={};k={};l={};m={};q={};s={};P=0;a=0;};this.getDataHandler=function(){return j;};this.getTileRowCnt=function(){return P;};this.getTileColCnt=function(){return a;};this.getPageKeyFromPos=function(i){return this.getPageKeyFromRowCol(i.iRow,i.iCol);};this.getPageKeyFromRowCol=function(i,G){return i+"/"+G;};this.getPagePosFromKey=function(K){var i={};var G=K.split("/");i.iRow=parseInt(G[0],10);i.iCol=parseInt(G[1],10);return i;};this.getCrosstab=function(){return c;};this.createPage=function(i){var G=null;var I=this.getPageKeyFromPos(i);if(I){G=new sap.zen.crosstab.paging.Page(i,I,this);p[I]=G;}return G;};this.getPage=function(i){return this.getPageFromRowCol(i.iRow,i.iCol);};this.getPageFromRowCol=function(i,G){var I=null;var J=this.getPageKeyFromRowCol(i,G);if(J){I=p[J];}return I;};this.getCellMerger=function(){return C;};function y(){return(b===0&&d===0)||!H;}function z(J){P=J.tilerows;a=J.tilecols;R=J.scrollaction;b=J.v_pos;if(b){b=Math.floor(b/P);}else{b=0;}d=J.h_pos;if(d){d=Math.floor(d/a);}else{d=0;}}function B(i,G,I){var J={iRow:0,iCol:0};if(I.isRowHeaderArea()){J.iRow=Math.floor(i/P);J.iCol=Math.floor(c.getColumnHeaderArea().getRenderStartCol()/a);}else if(I.isColHeaderArea()){J.iRow=Math.floor(c.getRowHeaderArea().getRenderStartRow()/P);J.iCol=Math.floor(G/a);}else if(I.isDataArea()){J.iRow=Math.floor(i/P);J.iCol=Math.floor(G/a);}return J;}this.getReceivedPages=function(){return JSON.stringify(o);};function D(i,G,I){if(i.isRowHeaderArea()){E(g,G,I);E(k,I,G);}else if(i.isColHeaderArea()){E(l,G,I);E(m,I,G);}else if(i.isDataArea()){E(q,G,I);E(s,I,G);}}function E(L,K,V){if(!L[K]){L[K]=[];}L[K].push(V);}function F(i,I){var L=null;if(i.isDataArea()){L=I?q:s;}else if(i.isRowHeaderArea()){L=I?g:k;}else if(i.isColHeaderArea()){L=I?l:m;}return L;}this.getLoadedCellColumnsByRow=function(i,G){var I=[];var L=F(i,true);if(L){I=L[G];}return I;};this.getLoadedCellRowsByCol=function(i,G){var I=[];var L=F(i,false);if(L){I=L[G];}return I;};this.getPages=function(){return p;};this.isCellLoaded=function(i,G,I){var J=i.getAreaType()+"/"+G+"/"+I;if(A[J]){return true;}return false;};};
