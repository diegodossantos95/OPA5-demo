jQuery.sap.declare("sap.zen.crosstab.rendering.ScrollManager");jQuery.sap.require("sap.zen.crosstab.utils.Measuring");jQuery.sap.require("sap.ui.core.Popup");jQuery.sap.require("sap.ui.core.OpenState");jQuery.sap.require("sap.zen.crosstab.TextConstants");jQuery.sap.require("sap.zen.crosstab.utils.Utils");
sap.zen.crosstab.rendering.ScrollManager=function(c,r){"use strict";var C=c.getColumnHeaderArea();var R=c.getRowHeaderArea();var d=c.getDimensionHeaderArea();var D=c.getDataArea();var m=r.getMeasuringHelper();var i=0;var a=0;var h=false;var v=false;var H=0;var V=0;var l=null;var o=null;var L=null;var b=null;var p=new sap.ui.core.Popup();var t=null;if(sap.zen.crosstab.utils.Utils.isMainMode()){t=new sap.m.Text();}else{t=new sap.ui.commons.TextView();t.setWrapping(false);}p.setContent(t);p.setDurations(125,500);p.setAutoClose(true);p.getContent().addStyleClass("sapzencrosstab-ScrollPopup");var e=(D.getRowCnt()+"").length;var f=(D.getColCnt()+"").length;var g=0;var j=0;var B=false;var k=false;var n=this;this.destroy=function(){p.destroy();};this.setHScrollPos=function(N){a=N;};this.setVScrollPos=function(N){i=N;};function q(N){var O=0;if(N){O=$(document.getElementById(N.getId())).children("tbody").children("tr").length;}return O;}function s(){var N="";var O=1;var P=q(R);var Q=q(D);var S=P-Q;if(S>0){r.beginRendering();r.appendTopRows(D,S);R.setRenderStartRow(D.getRenderStartRow());R.setRenderRowCnt(D.getRenderRowCnt());r.adjustColWidths(d,R);r.adjustColWidths(C,D);r.adjustRowHeights(R,D);r.finishRendering(true);}}function u(N){c.getPageManager().enableTimeout(true);o=null;var P=null;if(!N){P=l;}else{P=N.getParameters();}if(P){c.postPlanningValue();var O=c.getHScrollbar();var Q=O.getSteps();h=P.newScrollPos===Q;a=P.newScrollPos;n.sendClientScrollPosUpdate();var S=P.newScrollPos;if(S!==C.getRenderStartCol()){if(S!==C.getColCnt()){r.beginRendering();r.renderColHeaderArea(S);r.renderDataArea();r.adjustColWidths(C,D);r.adjustRowHeights(R,D);r.adjustRowHeights(d,C);r.finishRendering(true);}var T=m.getAreaWidth(C);var U=m.getUpperRightScrollDivWidth();var W=T<U;var X=C.getRenderColCnt()+C.getRenderStartCol()===C.getColCnt();if(h||W&&X){if(W&&S>0){r.beginRendering();r.appendLeftCols(C,4);r.appendLeftCols(D,4);r.adjustColWidths(C,D);r.adjustRowHeights(R,D);r.adjustRowHeights(d,C);r.finishRendering(true);}if(!h&&P.forward){w(0,true);}x(true);}else{x(false);}}else{if(h){x(true);}}if(v){s();M(true);}if(P.newScrollPos===0){x(false);}}p.close();if(c.isScrollInvalidate()===true&&!c.hasLoadingPages()){c.setInvalidateCalledByScrolling();c.invalidate();}}this.hScrollHandler=function(N,O){if(!B){if(O){u(N);}else{l=N.getParameters();if(o){clearTimeout(o);o=null;y(l.newScrollPos);}o=setTimeout(u,200,null);a=l.newScrollPos;}}else{B=false;}};function w(S,N){var O=c.getHScrollbar();var P=O.getScrollPosition();var Q;if(N){S=O.getSteps();if(c.getPropertyBag().isRtl()&&c.getUtils().isMozilla()){O.setScrollPosition(0);O.setScrollPosition(S);}h=true;}if(P!==S){O.setScrollPosition(S);B=true;}a=S;Q=c.getRenderEngine().getCrossRequestManager();if(Q){Q.setHScrollInfo(a,h);}}function x(S){n.positionHScrollDiv(S);}this.positionHScrollDiv=function(S){var U=$(document.getElementById(c.getId()+"_upperRight_scrollDiv"));var N=$(document.getElementById(c.getId()+"_lowerRight_scrollDiv"));var O;if(typeof(S)==="undefined"){S=h;}H=S?N[0].scrollWidth:0;if(c.getPropertyBag().isRtl()){if($.browser.webkit){O=S?0:N[0].scrollWidth;}else if(c.getUtils().isMozilla()){O=S?-N[0].scrollWidth:0;}else{O=S?N[0].scrollWidth:0;}}else{O=S?N[0].scrollWidth:0;}N.scrollLeft(O);U.scrollLeft(O);};this.vScrollHandler=function(N,O){if(!k){if(O){I(N);}else{L=N.getParameters();if(b){clearTimeout(b);b=null;A(L.newScrollPos);}b=setTimeout(I,200,null);i=L.newScrollPos;}}else{k=false;}};this.sendClientScrollPosUpdate=function(){c.getUtils().sendClientScrollPosUpdate(a,h,i,v);};function y(S){var C=c.getColumnHeaderArea();var N=null;var O=[];for(var P=0;P<1;P++){N=C.getCellWithColSpan(P,S,true);if(N){O.push(N.getUnescapedText());}else{O.push("?");}}var Q=c.getPropertyBag().getText(sap.zen.crosstab.TextConstants.COL_TEXT_KEY)+" "+sap.zen.crosstab.utils.Utils.padWithZeroes(S+1,f)+"/"+C.getColCnt();if(!j){if(sap.zen.crosstab.utils.Utils.isMainMode()){p.getContent().setWrapping(false);}z(Q);if(sap.zen.crosstab.utils.Utils.isMainMode()){j=$(document.getElementById(p.getContent().getId())).outerWidth();}else{j=$(document.getElementById(p.getContent().getId())).innerWidth();}}if(sap.zen.crosstab.utils.Utils.isMainMode()){p.getContent().setMaxLines(O.length+1);p.getContent().setWrapping(true);}Q=Q+"\n"+O.join("\n");z(Q);}function z(N){p.getContent().setProperty("text",N,true);var O=sap.ui.core.Popup.Dock;if(j){p.getContent().setWidth(j+"px");}var P=c.getHScrollbar();var W=m.getRenderSizeDivSize().iWidth-m.getAreaWidth(c.getRowHeaderArea());var Q=$(document.getElementById(p.getContent().getId())).outerWidth();W=W-Q;var S=P.getScrollPosition()/P.getSteps();var X=(W*S)+" ";p.setPosition(O.BeginBottom,O.BeginTop,document.getElementById(c.getHScrollbar().getId()),X+"-20");if(p.getOpenState()===sap.ui.core.OpenState.CLOSED){p.open(-1);}p.getContent().rerender();}function A(S){var R=c.getRowHeaderArea();var N=null;var O=[];for(var P=0;P<1;P++){N=R.getCellWithRowSpan(S,P,true);if(N){O.push(N.getUnescapedText());}else{O.push("?");}}var Q=c.getPropertyBag().getText(sap.zen.crosstab.TextConstants.ROW_TEXT_KEY)+" "+sap.zen.crosstab.utils.Utils.padWithZeroes(S+1,e)+"/"+R.getRowCnt();if(!g){if(sap.zen.crosstab.utils.Utils.isMainMode()){p.getContent().setWrapping(false);}E(Q);if(sap.zen.crosstab.utils.Utils.isMainMode()){g=$(document.getElementById(p.getContent().getId())).outerWidth();}else{g=$(document.getElementById(p.getContent().getId())).innerWidth();}}Q=Q+"\n"+O.join("\n");if(sap.zen.crosstab.utils.Utils.isMainMode()){p.getContent().setMaxLines(O.length+1);p.getContent().setWrapping(true);}E(Q);}function E(N){p.getContent().setProperty("text",N,true);var O=sap.ui.core.Popup.Dock;var P=c.getVScrollbar();var Q=m.getRenderSizeDivSize().iHeight-m.getAreaHeight(c.getColumnHeaderArea());var S=$(document.getElementById(p.getContent().getId())).outerHeight();Q=Q-S;var T=P.getScrollPosition()/P.getSteps();var Y=" "+(Q*T);p.setPosition(O.EndTop,O.BeginTop,document.getElementById(c.getVScrollbar().getId()),"-20"+Y);if(g){p.getContent().setWidth(g+"px");}if(p.getOpenState()===sap.ui.core.OpenState.CLOSED){p.open(-1);}p.getContent().rerender();}function F(N){var O="";var P=1;var Q=0;$(document.getElementById(N.getId())).children("tbody").children("tr:last").children("td").each(function(S,T){O=$(T).attr("colspan");if(!O){P=1;}else{P=parseInt(O,10);}Q=Q+P;});return Q;}function G(){var N="";var O=1;var P=F(C);var Q=F(D);var S=P-Q;if(S>0){r.beginRendering();r.appendLeftCols(D,S);C.setRenderStartCol(D.getRenderStartCol());C.setRenderColCnt(D.getRenderColCnt());r.adjustColWidths(C,D);r.adjustRowHeights(R,D);r.adjustRowHeights(d,C);r.finishRendering(true);}}function I(N){c.getPageManager().enableTimeout(true);b=null;var P=null;if(!N){P=L;}else{P=N.getParameters();}if(P){c.postPlanningValue();var O=c.getVScrollbar();var Q=O.getSteps();v=P.newScrollPos===Q;i=P.newScrollPos;n.sendClientScrollPosUpdate();var S=P.newScrollPos;if(S!==R.getRenderStartRow()){if(S!==R.getRowCnt()){r.beginRendering();r.renderRowHeaderArea(S);r.renderDataArea();r.adjustColWidths(d,R);r.adjustColWidths(C,D);r.adjustRowHeights(R,D);r.finishRendering(true);}var T=m.getAreaHeight(R);var U=m.getLowerScrollDivHeight();var W=T<U;var X=R.getRenderRowCnt()+R.getRenderStartRow()===R.getRowCnt();if(v||W&&X){if(W&&S>0){r.beginRendering();r.appendTopRows(R,2);r.appendTopRows(D,2);r.adjustColWidths(d,R);r.adjustColWidths(C,D);r.adjustRowHeights(R,D);r.finishRendering(true);}if(!v&&P.forward){K(0,true);}M(true);}else{M(false);}}else{if(v){M(true);}}if(P.newScrollPos===0){M(false);}if(h){G();x(true);}}p.close();J();}function J(){var N=c.getRenderEngine().getHeaderScrollManager();if(N){N.moveScrollbars();}}function K(S,N){var O=c.getVScrollbar();var P=O.getScrollPosition();var Q;if(N){S=O.getSteps();v=true;}if(P!==S){O.setScrollPosition(S);k=true;}i=S;Q=c.getRenderEngine().getCrossRequestManager();if(Q){Q.setVScrollInfo(i,v);}}function M(S){n.positionVScrollDiv(S);}this.positionVScrollDiv=function(S){var N=$(document.getElementById(c.getId()+"_lowerRight_scrollDiv"));var O=$(document.getElementById(c.getId()+"_lowerLeft_scrollDiv"));if(typeof(S)==="undefined"){S=v;}V=S?N[0].scrollHeight:0;N.scrollTop(V);O.scrollTop(V);};this.moveScrollbars=function(S,N,O,P){var Q=c.getHScrollbar();if(Q){if(O!==undefined){h=O;}else{h=(Q.getSteps()<=a)&&(C.getRenderStartCol()+C.getRenderColCnt()>=C.getColCnt());}if(h){x(true);w(0,true);}else{w(a,false);}}var T=c.getVScrollbar();if(T){if(P!==undefined){v=P;}else{v=(T.getSteps()<=i)&&(R.getRenderStartRow()+R.getRenderRowCnt()>=R.getRowCnt());}if(v){K(0,true);M(true);}else{K(i,false);}}};this.commandHScrolledToEnd=function(){h=true;};this.commandVScrolledToEnd=function(){v=true;};this.isVScrolledToEnd=function(){return v;};this.isHScrolledToEnd=function(){return h;};this.setVScrolledToEnd=function(N){v=N;};this.setHScrolledToEnd=function(N){h=N;};};
