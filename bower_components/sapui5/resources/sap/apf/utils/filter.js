/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
(function(){'use strict';jQuery.sap.declare('sap.apf.utils.filter');jQuery.sap.require("sap.apf.core.utils.filterTerm");jQuery.sap.require("sap.apf.core.utils.filter");jQuery.sap.require("sap.apf.utils.hashtable");sap.apf.utils.Filter=function(m){var t;var a=this;var b=function(){t=new sap.apf.utils.FilterAnd(m,sap.apf.utils.Filter.topAndId);};this.getById=function(i){if(t){if(i===sap.apf.utils.Filter.topAndId){return t;}return t.getById(i);}return undefined;};this.type="filter";this.getExpressions=function(){if(t){return t.getExpressions();}return[];};this.getInternalFilter=function(){return t.getInternalFilter();};this.getTopAnd=function(){return t;};this.updateExpression=function(i,e){m.check(i===e.id,"sId differs from oExpression.id");var E=this.getById(i);E.update(e);};this.updateValue=function(i,v,h){m.check(i!==undefined,"Filter updateValue: parameter id required");m.check(v!==undefined,"Filter updateValue: parameter value is required");var e=this.getById(i);m.check(e!==undefined,"Filter updateValue: id for expression not valid");e.updateValue(v,h);};this.serialize=function(){function g(c,T){var s={id:T.getId(),type:T.type,expressions:[],terms:[]};c.forEach(function(d,i){if(d instanceof Array){if(T.type==="filterAnd"){s.terms.push(g(d,T.getAndTerms()[i]));}else if(T.type==="filterOr"){s.terms.push(g(d,T.getOrTerms()[i]));}}else{s.expressions.push(d);}});return s;}return g(this.getTopAnd().getExpression(),this.getTopAnd());};this.deserialize=function(s){t=undefined;b();function g(s,T){if(s.type==="filterAnd"&&s.id!==sap.apf.utils.Filter.topAndId){T=T.addAnd(s.id);}else if(s.type==="filterOr"&&s.id!==sap.apf.utils.Filter.topAndId){T=T.addOr(s.id);}s.expressions.forEach(function(e){T.addExpression(e);});s.terms.forEach(function(c){g(c,T);});}g(s,this.getTopAnd());return this;};this.addAnd=function(i){jQuery.sap.log.error("Method 'addAnd' is deprecated since 1.23.0","Will be discarded with 1.26.0.");};this.intersectWith=function(c){var i=0;var f=[];var F;var r=new sap.apf.utils.Filter(m);var R=a.serialize();s(R);switch(arguments.length){case 1:F=arguments[0];if(F instanceof Array){f=F;}else{f.push(F);}break;default:f=Array.prototype.slice.call(arguments,0);}f.forEach(function(o){m.check((o instanceof sap.apf.utils.Filter),"Parameter value is not of type sap.apf.utils.Filter");var I=o.serialize();s(I);Array.prototype.push.apply(R.expressions,I.expressions);Array.prototype.push.apply(R.terms,I.terms);});r.deserialize(R);return r;function s(S){if(S.id!==sap.apf.utils.Filter.topAndId){S.id='#'+i++ +'#';}S.terms.forEach(s);}};b();return this;};sap.apf.utils.Filter.createFilterFromSapUi5FilterJSON=function(m,s){var r=new sap.apf.utils.Filter(m);function a(f,l,b){var c;l++;if(b.aFilters){if(b.bAnd){if(l!==1){c=f.addAnd();}else{c=f;}}else{c=f.addOr();}b.aFilters.forEach(function(e){a(c,l,e);});}else if(b.sOperator){f.addExpression({name:b.sPath,operator:b.sOperator,value:b.oValue1,high:b.oValue2});}}a(r.getTopAnd(),0,s);return r;};sap.apf.utils.Filter.getOperators=function(){return sap.apf.core.constants.FilterOperators;};sap.apf.utils.Filter.prototype.getOperators=sap.apf.utils.Filter.getOperators;sap.apf.utils.Filter.topAndId='filterTopAnd';sap.apf.utils.FilterAnd=function(m,I){var a=I;var A=[];var t=this;this.type="filterAnd";this.getById=function(I){if(I===a){return this;}var T;var i;for(i=0;i<A.length;i++){T=A[i].getById(I);if(T!==undefined){return T;}}return undefined;};this.getExpressions=function(){var e=[];var T;var i;for(i=0;i<A.length;i++){T=A[i].getExpression();if(T instanceof Array&&T.length===0){continue;}if(T instanceof Array){e.push(T);}else{e.push([T]);}}return e;};this.getExpression=function(){var e=[];var T;var i;for(i=0;i<A.length;i++){T=A[i].getExpression();if(T instanceof Array&&T.length===0){continue;}e.push(T);}return e;};this.getCompoundExpressions=function(){jQuery.sap.log.error("Method 'getExpressions' is deprecated since 1.23.0","Will be discarded with 1.26.0.");};this.getId=function(){return I;};this.getInternalFilter=function(){var f=new sap.apf.core.utils.Filter(m);var l=A.length;var i;for(i=0;i<l;i++){f.addAnd(A[i].getInternalFilter());}return f;};this.addAndTerm=function(T){jQuery.sap.log.error("Method 'addAndTerm' is deprecated since 1.23.0","Will be discarded with 1.26.0.");};this.getAndTerms=function(){return A;};this.addOr=function(I){m.check((I===undefined||this.getById(I)===undefined),"Filter includes duplicated identifiers (IDs)");var o=new sap.apf.utils.FilterOr(m,I,t);A.push(o);return o;};this.addExpression=function(e){if(e.operator.length==2){e.operator=e.operator.toUpperCase();}m.check((e.id===undefined||this.getById(e.id)===undefined),"Filter includes duplicated identifiers (IDs)");m.check((e.operator!==undefined),"sap.apf.utils.Filter oExpression.operator undefined");m.check((jQuery.inArray(e.operator,sap.apf.core.constants.aSelectOpt)>-1),"sap.apf.core.utils.Filter oExpression.operator "+e.operator+" not supported");A.push(new sap.apf.utils.FilterExpression(m,e));return this;};};sap.apf.utils.FilterOr=function(m,I,a){var b=I;var o=[];var A=a;this.type="filterOr";this.getById=function(I){if(I===b){return this;}var t;for(var i=0;i<o.length;i++){t=o[i].getById(I);if(t!==undefined){return t;}}return undefined;};this.getExpression=function(){var e=[];var t;for(var i=0;i<o.length;i++){t=o[i].getExpression();if(t instanceof Array&&t.length===0){continue;}e.push(t);}return e;};this.getId=function(){return I;};this.getInternalFilter=function(){var f=new sap.apf.core.utils.Filter(m);for(var i=0;i<o.length;i++){f.addOr(o[i].getInternalFilter());}return f;};this.getAndObject=function(){return A;};this.addOrTerm=function(t){jQuery.sap.log.error("Method 'addOr' is deprecated since 1.23.0","Will be discarded with 1.26.0.");};this.getOrTerms=function(){return o;};this.addExpression=function(e){if(e.operator.length==2){e.operator=e.operator.toUpperCase();}m.check((e.id===undefined||this.getAndObject().getById(e.id)===undefined),"Filter includes duplicated identifiers (IDs)");m.check((e.operator!==undefined),"sap.apf.utils.Filter oExpression.operator undefined");m.check((jQuery.inArray(e.operator,sap.apf.core.constants.aSelectOpt)>-1),"sap.apf.core.utils.Filter oExpression.operator "+e.operator+" not supported");o.push(new sap.apf.utils.FilterExpression(m,e));return this;};this.addAnd=function(I){m.check((I===undefined||this.getById(I)===undefined),"Filter includes duplicated identifiers (IDs)");var c=new sap.apf.utils.FilterAnd(m,I);o.push(c);return c;};};sap.apf.utils.FilterExpression=function(m,e){c(e.high,e.operator);var i=e.id;var n=e.name;var o=e.operator;var v=e.value;var h=e.high;this.getById=function(a){if(i===a){return this;}return undefined;};this.getExpression=function(){if(!o||o!==sap.apf.core.constants.FilterOperators.BT){return{name:n,operator:o,value:v};}return{name:n,operator:o,value:v,high:h};};this.getInternalFilter=function(){return new sap.apf.core.utils.Filter(m,n,o,v,h);};this.update=function(e){c(e.high,e.operator);n=e.name;o=e.operator;v=e.value;h=e.high;};this.updateValue=function(a,b){v=a;if(b!==undefined){h=b;}c(h,o);};function c(a,b){if(!b){return;}if(b===sap.apf.core.constants.FilterOperators.BT&&(a===null||a===undefined)){m.check(false,"sap.apf.utils.FilterExpression: High value needed for 'between' selection");}else if(b!==sap.apf.core.constants.FilterOperators.BT&&(a!==null&&a!==undefined)){m.check(false,"sap.apf.utils.FilterExpression: High value only needed for 'between' selection");}}};}());
