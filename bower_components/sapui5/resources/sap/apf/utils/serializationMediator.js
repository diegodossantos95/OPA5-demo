/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.apf.utils.serializationMediator");jQuery.sap.require("sap.apf.core.constants");(function(){'use strict';sap.apf.utils.SerializationMediator=function(i){this.savePath=function(a,b,c){this.serialize(false).done(function(s){if(typeof a==='string'&&typeof b==='function'){i.instances.coreApi.savePath(a,b,s);}else if(typeof a==='string'&&typeof b==='string'&&typeof c==='function'){i.instances.coreApi.savePath(a,b,c,s);}});};this.openPath=function(p,c,a){i.instances.coreApi.openPath(p,b.bind(this));function b(r,m,d){i.instances.coreApi.resetPath();i.instances.messageHandler.setCallbackForTriggeringFatal(e);this.deserialize(r.path.SerializedAnalysisPath,a).done(function(){i.instances.messageHandler.setCallbackForTriggeringFatal(undefined);c({},m);});function e(d){if(d.getSeverity()!==sap.apf.core.constants.message.severity.warning){var f=i.instances.messageHandler.createMessageObject({code:'5210'});f.setPrevious(d);i.instances.messageHandler.putMessage(f);}}}};this.deletePath=function(p,c){i.instances.coreApi.deletePath(p,c);};this.readPaths=function(c){i.instances.coreApi.readPaths(c);};this.serialize=function(a,k){var r=jQuery.Deferred();var s={};i.instances.startFilterHandler.serialize(undefined,k).done(function(b){var c=i.instances.coreApi.serialize();s.startFilterHandler=b;s.filterIdHandler=i.instances.filterIdHandler.serialize();s.path=c.path;s.smartFilterBar=c.smartFilterBar;if(a){s.pathName=i.instances.coreApi.getPathName();s.dirtyState=i.instances.coreApi.isDirty();}r.resolve(s);});return r;};this.deserialize=function(s,a){var d=jQuery.Deferred();var b;if(s.dirtyState!==undefined){i.instances.coreApi.setDirtyState(s.dirtyState);}if(s.pathName!==undefined){i.instances.coreApi.setPathName(s.pathName);}b={path:s.path,smartFilterBar:s.smartFilterBar};if(a!==undefined){b.path.indicesOfActiveSteps[0]=a;}i.instances.coreApi.getApplicationConfigProperties().done(function(){i.instances.coreApi.deserialize(b);i.instances.filterIdHandler.deserialize(s.filterIdHandler);i.instances.startFilterHandler.getStartFilters().done(function(){if(s.startFilterHandler){i.instances.startFilterHandler.deserialize(s.startFilterHandler).done(function(){d.resolve();});}else{d.resolve();}});});return d.promise();};};}());
