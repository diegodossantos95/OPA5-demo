jQuery.sap.declare('sap.apf.utils.sbAdapter');jQuery.sap.declare('sap.apf.utils.sbAdapter.getConfigurations');jQuery.sap.require('sap.ui.fl.LrepConnector');jQuery.sap.require("sap.ui.thirdparty.datajs");(function(){'use strict';var s={semanticObject:"FioriApplication",action:"executeAPFConfiguration"};var a={semanticObject:"FioriApplication",action:"editAPFConfiguration"};var b={semanticObject:"FioriApplication",action:"executeAPFConfigurationS4HANA"};var c={semanticObject:"FioriApplication",action:"editAPFConfigurationS4HANA"};var h="/sap/hba/r/apf/core/odata/modeler/AnalyticalConfiguration.xsodata/AnalyticalConfigurationQueryResults";sap.apf.utils.sbAdapter._hanaConfigurations=undefined;sap.apf.utils.sbAdapter._lrepConfigurations=undefined;sap.apf.utils.sbAdapter.getConfigurations=function(k,l){var m=jQuery.Deferred();var n=[];jQuery.when(d(),r()).then(function(o,p){n=p.concat(o);var q=j(k,l);if(q&&!i(q,s)&&!i(q,b)){n.forEach(function(t){t.runtimeIntent=q;});}m.resolve(n);});return m.promise();};sap.apf.utils.sbAdapter.getConfigurationNameById=function(k){var l=jQuery.Deferred();if(!k){return l.resolve("");}if(k.indexOf(".")>-1){d().done(m);}else{r().done(m);}return l.promise();function m(n){n.forEach(function(o){if(o.id===k){l.resolve(o.title);}});if(l.state!=="resolved"){l.resolve("");}}};function r(){var k=jQuery.Deferred();if(!sap.apf.utils.sbAdapter._hanaConfigurations){var l={requestUri:h+"?$select=AnalyticalConfiguration,AnalyticalConfigurationName,Application",async:true,method:"GET"};OData.request(l,m,n);}else{k.resolve(jQuery.extend(true,[],sap.apf.utils.sbAdapter._hanaConfigurations));}return k.promise();function m(o){var p=[];o.results.forEach(function(q){p.push({title:q.AnalyticalConfigurationName,id:q.AnalyticalConfiguration,runtimeIntent:s,modelerIntent:a,configurationId:q.AnalyticalConfiguration,applicationId:q.Application});});sap.apf.utils.sbAdapter._hanaConfigurations=jQuery.extend(true,[],p);k.resolve(p);}function n(){sap.apf.utils.sbAdapter._hanaConfigurations=[];k.resolve([]);}}function d(){var k=jQuery.Deferred();if(!sap.apf.utils.sbAdapter._lrepConfigurations){e().then(function(l){var m=[];l.response.forEach(function(n){var o;var p;if(n.fileType&&n.fileType==="apfconfiguration"){o=g(n);p=n.name;m.push({title:f(n,'apfdt-configname'),id:o+"."+p,runtimeIntent:b,modelerIntent:c,configurationId:p,applicationId:o});}});sap.apf.utils.sbAdapter._lrepConfigurations=jQuery.extend(true,[],m);k.resolve(m);},function(){k.resolve([]);sap.apf.utils.sbAdapter._lrepConfigurations=[];});}else{k.resolve(jQuery.extend(true,[],sap.apf.utils.sbAdapter._lrepConfigurations));}return k.promise();}function e(){var k=sap.ui.fl.LrepConnector.createConnector();var o={async:true,contentType:'application/json'};var p=[];p.push({name:"deep-read",value:true});p.push({name:"metadata",value:true});p.push({name:"layer",value:"CUSTOMER"});var R="/sap/bc/lrep/content/sap/apf/dt/";R+=k._buildParams(p);return k.send(R,'GET',{},o);}function g(k){var n=k.ns.split('/');return n[n.length-2];}function f(k,l){var v;k.metadata.forEach(function(m){if(m.name===l){v=m.value;}});return v;}function i(k,l){if(k.semanticObject===l.semanticObject&&k.action===l.action){return true;}return false;}function j(k,l){if(k&&l){return{semanticObject:k,action:l};}}}());
