/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
jQuery.sap.declare("sap.apf.modeler.core.textPool");jQuery.sap.require("sap.apf.utils.hashtable");jQuery.sap.require("sap.apf.core.utils.filter");jQuery.sap.require("sap.ui.core.format.DateFormat");jQuery.sap.require('sap.apf.utils.utils');(function(){'use strict';sap.apf.modeler.core.TextPool=function(a,b,e){var m=a.instances.messageHandler;var p=a.instances.persistenceProxy;var H=a.constructors.Hashtable;var h=new H(m);var k=new H(m);var g=new H(m);var c=0;var d={TextElement:sap.apf.core.constants.textKeyForInitialText,Language:sap.apf.core.constants.developmentLanguage,TextElementType:"XFLD",TextElementDescription:"",MaximumLength:10,Application:b,TranslationHint:""};function f(t,j){var n=h.getKeys();var i,o=n.length;var q=j.MaximumLength||10;var r=j.TranslationHint||"";var s;for(i=0;i<o;i++){s=h.getItem(n[i]);if((s.TextElementDescription===t)&&(s.MaximumLength===q)&&(s.TranslationHint===r)){return n[i];}}return undefined;}this.removeTexts=function(t,n,o){var q=[];var i,r;function s(u){var j;if(!u){for(j=0;j<r;j++){h.removeItem(t[j]);}}o(u);}r=t.length;if(r===0){o(undefined);return;}for(i=0;i<r;i++){if(t[i]===sap.apf.core.constants.textKeyForInitialText){continue;}q.push({method:"DELETE",entitySetName:"texts",inputParameters:[{name:'TextElement',value:t[i]},{name:'Language',value:sap.apf.core.constants.developmentLanguage}]});}p.doChangeOperationsInBatch(q,s,n);};this.isInitialTextKey=function(t){return(t===sap.apf.core.constants.textKeyForInitialText);};this.addTextsAndSave=function(t,j,n){function o(x,y){return(x.TextElement===y.TextElement&&x.TextElementDescription===y.TextElementDescription&&x.MaximumLength===y.MaximumLength&&x.Language===y.Language&&x.TranslationHint===y.TranslationHint);}var i;var q=t.length;var r;var s=[];var u=[];var v=[];var w;for(i=0;i<q;i++){if(t[i]===sap.apf.core.constants.textKeyForInitialText){continue;}r=h.getItem(t[i].TextElement);if(r){if(!o(r,t[i])){s.push(t[i]);h.setItem(t[i].TextElement,t[i]);}}else{u.push(t[i]);h.setItem(t[i].TextElement,t[i]);}}q=s.length;for(i=0;i<q;i++){w=[{name:'TextElement',value:s[i].TextElement},{name:'Language',value:s[i].Language}];s[i].MaximumLength=parseInt(s[i].MaximumLength,10);v.push({method:"PUT",entitySetName:"texts",data:s[i],inputParameters:w});}q=u.length;for(i=0;i<q;i++){u[i].MaximumLength=parseInt(u[i].MaximumLength,10);v.push({method:"POST",entitySetName:"texts",data:u[i]});}if(v.length>0){p.doChangeOperationsInBatch(v,j,n);}else{j(undefined);}};this.exportTexts=function(i){var t=sap.apf.utils.renderHeaderOfTextPropertyFile(b,m);var j={TextElement:"AnalyticalConfigurationName",Language:sap.apf.core.constants.developmentLanguage,TextElementType:"XTIT",TextElementDescription:i,MaximumLength:250,Application:b,TranslationHint:""};return t+sap.apf.utils.renderTextEntries(h,m)+sap.apf.utils.renderEntryOfTextPropertyFile(j,m);};this.get=function(i){var j,n;if(i===sap.apf.core.constants.textKeyForInitialText){return d;}if(h.hasItem(i)){return h.getItem(i);}if(k.hasItem(i)){j=k.getItem(i);if(j.TextElementDescription){return j;}return h.getItem(j);}n=jQuery.extend({},true,d);n.TextElement=i;n.TextElementDescription=i;return n;};this.getPersistentKey=function(i){return i;};this.setTextAsPromise=function(t,i){var j;var n=jQuery.Deferred();var u=function(q,r,s){if(s){m.putMessage(s);}if(q){h.setItem(q.TextElement,q);j=q.TextElement;}n.resolve(q&&q.TextElement);};var o={TextElement:"",Language:sap.apf.core.constants.developmentLanguage,TextElementType:i.TextElementType,TextElementDescription:t,MaximumLength:i.MaximumLength||10,Application:b,TranslationHint:i.TranslationHint||""};if(!t){n.resolve(sap.apf.core.constants.textKeyForInitialText);}j=f(t,i);if(j){n.resolve(j);}else{c++;p.create('texts',o,u,true);}return n.promise();};this.getTextKeys=function(t){var j=h.getKeys();var i,n,o=j.length;var q=[];for(i=0;i<o;i++){n=h.getItem(j[i]);if(t&&n.TextElementType!==t){continue;}if(g.hasItem(j[i])){q.push(g.getItem(j[i]));}else{q.push(j[i]);}}return q;};this.getTextsByTypeAndLength=function(t,j){var n=h.getKeys();var i,o,q=n.length;var r=[];for(i=0;i<q;i++){o=h.getItem(n[i]);if(o.TextElementType===t&&o.MaximumLength===j){if(g.hasItem(n[i])){r.push({TextElement:g.getItem(n[i]),TextElementDescription:o.TextElementDescription});}else{r.push({TextElement:n[i],TextElementDescription:o.TextElementDescription});}}}return r;};function l(){var i,j;j=e.length;for(i=0;i<j;i++){if(e[i].TextElement){h.setItem(e[i].TextElement,e[i]);}}}l();};}());
