/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
jQuery.sap.require("sap.apf.core.constants");jQuery.sap.require("sap.apf.modeler.ui.utils.displayOptionsValueBuilder");jQuery.sap.require("sap.apf.modeler.ui.controller.propertyType");jQuery.sap.require("sap.apf.modeler.ui.utils.textManipulator");(function(){"use strict";var r=sap.apf.core.constants.representationMetadata;var t=new sap.apf.modeler.ui.utils.TextManipulator();sap.apf.modeler.ui.controller.propertyType.extend("sap.apf.modeler.ui.controller.representationDimension",{setLabelDisplayOptionTypeAsPromise:function(o){var d=jQuery.Deferred();var a,l,m,p,L,c=this,b=[];a=new sap.apf.modeler.ui.utils.DisplayOptionsValueBuilder(c.oTextReader,o);l=sap.apf.core.constants.representationMetadata.labelDisplayOptions;p=t.removePrefixText(c.byId("idPropertyType").getSelectedKey(),c.oTextReader(sap.apf.modeler.ui.utils.CONSTANTS.texts.NOTAVAILABLE));L=c.oRepresentation.getLabelDisplayOption(p);m=a.getLabelDisplayOptions();c.oStepPropertyMetadataHandler.getEntityTypeMetadataAsPromise().done(function(e){if((L===l.KEY_AND_TEXT||L===l.TEXT)&&!c.oStepPropertyMetadataHandler.hasTextPropertyOfDimension(e,p)){m=a.getValidatedLabelDisplayOptions();b=t.addPrefixText([L],c.oTextReader);L=b[0];}c.byId("idLabelDisplayOptionType").setModel(m);c.byId("idLabelDisplayOptionType").setSelectedKey(L);d.resolve();});return d.promise();},getAllPropertiesAsPromise:function(){var c=this,a,s,p,A,d=[];var S=c.oStepPropertyMetadataHandler.oStep;var C=sap.apf.modeler.ui.utils.CONSTANTS;var b=jQuery.Deferred();c.oStepPropertyMetadataHandler.getEntityTypeMetadataAsPromise().done(function(e){S.getConsumablePropertiesForRepresentation(c.oRepresentation.getId()).done(function(R){a=R.consumable;a.forEach(function(P){if(c.oStepPropertyMetadataHandler.getPropertyMetadata(e,P)){A=c.oStepPropertyMetadataHandler.getPropertyMetadata(e,P)["aggregation-role"];if(A===C.aggregationRoles.DIMENSION){d.push(P);}}});s=c.getSelectedProperty();if(s!==undefined){p=d.indexOf(s)!==-1?d:d.concat(s);d=R.available.indexOf(s)!==-1?p:d.concat(t.addPrefixText([s],c.oTextReader));s=R.available.indexOf(s)!==-1?s:t.addPrefixText([s],c.oTextReader)[0];}b.resolve({aAllProperties:d,sSelectedKey:s});});});return b.promise();},getPropertyTextLabelKey:function(p){var c=this;return c.oRepresentation.getDimensionTextLabelKey(p);},removeProperties:function(){var c=this;c.getView().getViewData().oRepresentationHandler.getActualDimensions().forEach(function(p){c.oRepresentation.removeDimension(p.sProperty);});},updateProperties:function(p){var c=this;c.removeProperties();p.forEach(function(P){c.oRepresentation.addDimension(P.sProperty);c.oRepresentation.setDimensionKind(P.sProperty,P.sKind);c.oRepresentation.setLabelDisplayOption(P.sProperty,P.sLabelDisplayOption);c.oRepresentation.setDimensionTextLabelKey(P.sProperty,P.sTextLabelKey);});},createNewPropertyInfoAsPromise:function(n){var d=jQuery.Deferred();var c=this,N={};c.oStepPropertyMetadataHandler.getEntityTypeMetadataAsPromise().done(function(e){var i=c.oStepPropertyMetadataHandler.hasTextPropertyOfDimension(e,n);N.sProperty=n;N.sKind=c.getView().getViewData().oPropertyTypeData.sContext;N.sLabelDisplayOption=i?r.labelDisplayOptions.KEY_AND_TEXT:r.labelDisplayOptions.KEY;N.sTextLabelKey=undefined;d.resolve(N);});return d.promise();},createCurrentProperiesInfo:function(d){var c={},C=this;c.sProperty=d;c.sKind=C.oRepresentation.getDimensionKind(d);c.sLabelDisplayOption=C.oRepresentation.getLabelDisplayOption(d);c.sTextLabelKey=C.oRepresentation.getDimensionTextLabelKey(d);return c;},setPropertyTextLabelKey:function(p,l){var c=this;c.oRepresentation.setDimensionTextLabelKey(p,l);},setNextPropertyInParentObject:function(){var c=this;var p=c.getView().getViewData().oPropertyTypeData.sProperty;c.updatePropertyTypeAsPromise(p).done(function(){c.setDetailData();});},enableDisableLabelDisplayOptionTypeAsPromise:function(){var i,c=this;var d=jQuery.Deferred();var a=c.byId("idLabelDisplayOptionType");var p=t.removePrefixText(c.byId("idPropertyType").getSelectedKey(),c.oTextReader(sap.apf.modeler.ui.utils.CONSTANTS.texts.NOTAVAILABLE));c.oStepPropertyMetadataHandler.getEntityTypeMetadataAsPromise().done(function(e){var I=c.oStepPropertyMetadataHandler.hasTextPropertyOfDimension(e,p);for(i=0;i<a.getItems().length;i++){a.getItems()[i].setEnabled(true);if(i>0&&!I){a.getItems()[i].setEnabled(false);}}d.resolve();});return d.promise();},changeDisplayOptionsLabel:function(l){var c=this;var p=t.removePrefixText(c.byId("idPropertyType").getSelectedKey(),c.oTextReader(sap.apf.modeler.ui.utils.CONSTANTS.texts.NOTAVAILABLE));c.oRepresentation.setLabelDisplayOption(p,l);},removePropertyFromParentObject:function(){var c=this;c.oRepresentation.removeDimension(t.removePrefixText(c.byId("idPropertyType").getSelectedKey(),c.oTextReader(sap.apf.modeler.ui.utils.CONSTANTS.texts.NOTAVAILABLE)));},addPropertyAsPromise:function(){var d=jQuery.Deferred();var c=this,a,D=[];var s=c.oStepPropertyMetadataHandler.oStep;var C=sap.apf.modeler.ui.utils.CONSTANTS;c.oStepPropertyMetadataHandler.getEntityTypeMetadataAsPromise().done(function(e){s.getConsumablePropertiesForRepresentation(c.oRepresentation.getId()).done(function(R){R.consumable.forEach(function(p){if(c.oStepPropertyMetadataHandler.getPropertyMetadata(e,p)){a=c.oStepPropertyMetadataHandler.getPropertyMetadata(e,p)["aggregation-role"];if(a===C.aggregationRoles.DIMENSION){D.push(p);}}});c.getView().fireEvent(C.events.ADDPROPERTY,{"sProperty":D[0],"sContext":c.getView().getViewData().oPropertyTypeData.sContext});c.oConfigurationEditor.setIsUnsaved();d.resolve();});});return d.promise();}});}());
