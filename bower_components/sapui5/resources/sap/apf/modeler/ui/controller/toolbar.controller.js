/*!
* SAP APF Analysis Path Framework
*
* (c) Copyright 2012-2014 SAP SE. All rights reserved
*/
(function(){'use strict';sap.ui.controller("sap.apf.modeler.ui.controller.toolbar",{onInit:function(){this.oCoreApi=this.getView().getViewData().oConfigListInstance.oCoreApi;this.oConfigListInstance=this.getView().getViewData().oConfigListInstance;this._setDisplayText();},_setDisplayText:function(){this.byId("idAddButton").setText(this.oCoreApi.getText("addButton"));this.byId("idCopyButton").setText(this.oCoreApi.getText("copyButton"));this.byId("idDeleteButton").setText(this.oCoreApi.getText("deleteButton"));this.byId("idMoveUp").setTooltip(this.oCoreApi.getText("moveUp"));this.byId("idMoveDown").setTooltip(this.oCoreApi.getText("moveDown"));},enableCopyDeleteButton:function(){if(!this.byId("idCopyButton").getEnabled()){this.byId("idCopyButton").setEnabled(true);}if(!this.byId("idDeleteButton").getEnabled()){this.byId("idDeleteButton").setEnabled(true);}},disableCopyDeleteButton:function(){if(this.byId("idCopyButton").getEnabled()){this.byId("idCopyButton").setEnabled(false);}if(this.byId("idDeleteButton").getEnabled()){this.byId("idDeleteButton").setEnabled(false);}},_setAddMenuText:function(){sap.ui.core.Fragment.byId("idAddMenuFragment","idNewConfig").setText(this.oCoreApi.getText("newConfiguration"));sap.ui.core.Fragment.byId("idAddMenuFragment","idNewFacetFilter").setText(this.oCoreApi.getText("newFacetFilter"));sap.ui.core.Fragment.byId("idAddMenuFragment","idNewCategory").setText(this.oCoreApi.getText("newCategory"));sap.ui.core.Fragment.byId("idAddMenuFragment","idNewNavigationTarget").setText(this.oCoreApi.getText("newNavigationTarget"));sap.ui.core.Fragment.byId("idAddMenuFragment","idStep").setText(this.oCoreApi.getText("step"));sap.ui.core.Fragment.byId("idAddMenuFragment","idNewStep").setText(this.oCoreApi.getText("newStep"));sap.ui.core.Fragment.byId("idAddMenuFragment","idExistingStep").setText(this.oCoreApi.getText("existingStep"));sap.ui.core.Fragment.byId("idAddMenuFragment","idHierarchicalStep").setText(this.oCoreApi.getText("hierarchicalStep"));sap.ui.core.Fragment.byId("idAddMenuFragment","idNewRepresentation").setText(this.oCoreApi.getText("newRepresentation"));},_setExistingStepDialogText:function(){sap.ui.core.Fragment.byId("idExistingStepDialogFragment","idExistingStepDialog").setTitle(this.oCoreApi.getText("existingStepDialogTitle"));},_enableDisableAddMenuItems:function(s,a){var f;var A=a.getItems();var n,m={};if(this.oConfigListInstance.configEditor){f=Object.keys(this.oConfigListInstance.configEditor.getFilterOption())[0];}if(this.oConfigListInstance.configurationHandler.getList().length===0||s===null){n="default";}else{n=s.nodeObjectType;}m["default"]=1;m[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION]=4;m[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER]=4;m[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.SMARTFILTERBAR]=4;m[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY]=5;m[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP]=6;m[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION]=6;m[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET]=4;A.forEach(function(M,i){if(i<m[n]){M.setEnabled(true);if(f!==sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER&&i===1){M.setEnabled(false);}}else{M.setEnabled(false);}});},_handlePressAddButton:function(e){var s;var S=this,i=true;if(this.oConfigListInstance.getView().byId("idConfigDetailData").getContent().length>=1){s=(typeof this.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController==="function")?this.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController():undefined;}e.getSource().$().blur();var n=sap.apf.modeler.ui.utils.navigationHandler.getInstance();if(s!==undefined){i=typeof s.getValidationState==="function"?s.getValidationState.call(s):true;}var c=this.oConfigListInstance.configEditor?jQuery.extend(true,{},this.oConfigListInstance.configEditor):undefined;this.oConfigListInstance.bIsSaved=c?c.isSaved():undefined;var a=false;var o=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(this.oConfigListInstance.oTreeInstance.getSelection());var A=e.getSource();var b=function(){if(!this.addMenu){this.addMenu=new sap.ui.xmlfragment("idAddMenuFragment","sap.apf.modeler.ui.fragment.addMenu",this);this.getView().addDependent(this.addMenu);this._setAddMenuText();}var d=sap.ui.core.Popup.Dock;this._enableDisableAddMenuItems(o,this.addMenu);this.addMenu.open(false,A,d.BeginTop,d.BeginBottom,A);};if(!i){n.throwMandatoryPopup(S.oConfigListInstance,{yes:function(){var p=S.oConfigListInstance.oTreeInstance.getParentNodeContext(o);S.oConfigListInstance.configEditor=S.oConfigListInstance.configurationHandler.restoreMemorizedConfiguration(p.configId);if(S.oConfigListInstance.bIsSaved===false&&S.oConfigListInstance.configEditor){S.oConfigListInstance.configEditor.setIsUnsaved();}var N=S.oConfigListInstance._navMandatoryResetState(S.oConfigListInstance);if(!N.isNewView){b.call(S);}}});a=true;}if(!a){b.call(S);}},_handleAddMenuItemPress:function(e){var i=this.addMenu.getItems();var a=e.getParameters("item");var n;var N={"idAddMenuFragment--idNewFacetFilter":sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER,"idAddMenuFragment--idNewCategory":sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY,"idAddMenuFragment--idNewStep":sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP,"idAddMenuFragment--idHierarchicalStep":sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP,"idAddMenuFragment--idNewRepresentation":sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION,"idAddMenuFragment--idNewConfig":sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION,"idAddMenuFragment--idNewNavigationTarget":sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET,"default":sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION};i.forEach(function(o){if(o.getId()===a.id){n=N[o.getId()];}else if(o.getSubmenu()){o.getSubmenu().getItems().forEach(function(o){if(o.getId()===a.id){n=N[o.getId()];}});}});var I=false;if(a.id==="idAddMenuFragment--idExistingStep"){this._handleAddExistingStepPress();}else if(a.id!=="idAddMenuFragment--idStep"&&n!==undefined){if(a.id==="idAddMenuFragment--idHierarchicalStep"){I=true;}this.oConfigListInstance.oTreeInstance.addNodeInTree(n,undefined,I);}},_copyConfiguration:function(c,n){var C=this.oConfigListInstance.configurationHandler.getConfiguration(c);var o={},a;o.AnalyticalConfiguration=C.AnalyticalConfiguration;o.name="< "+C.AnalyticalConfigurationName+" >";o.Application=C.Application;o.type=sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION;o.bIsLoaded=false;o.bToggleState=false;o.isSelected=true;o.expanded=true;o.selectable=true;o.hasExpander=true;this.oConfigListInstance.oModel.getData().aConfigDetails.push(o);this.oConfigListInstance.oModel.updateBindings();a=this.oConfigListInstance.oTreeInstance.getModel().getContext(n);this.oConfigListInstance.selectedNode=this.oConfigListInstance.oTreeInstance.getNodeByContext(a);this.oConfigListInstance.modelUpdateDeferred[this.oConfigListInstance.oModel.getData().aConfigDetails.length-1]=new jQuery.Deferred();var b={appId:this.oConfigListInstance.appId,configId:c};sap.ui.core.UIComponent.getRouterFor(this.oConfigListInstance).navTo(o.type,b,true);},_handlePressCopyButton:function(e){var d=jQuery.Deferred();var s,a;var S=this,b=true;if(this.oConfigListInstance.getView().byId("idConfigDetailData").getContent().length>=1){s=(typeof this.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController==="function")?this.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController():undefined;}e.getSource().$().blur();var n=sap.apf.modeler.ui.utils.navigationHandler.getInstance();if(s!==undefined){b=typeof s.getValidationState==="function"?s.getValidationState.call(s):true;}var c=this.oConfigListInstance.configEditor?jQuery.extend(true,{},this.oConfigListInstance.configEditor):undefined;this.oConfigListInstance.bIsSaved=c?c.isSaved():undefined;var f=false;var g=function(){var C=this;var N;var l=this.oTreeInstance.getAPFTreeNodeContext(this.oTreeInstance.getSelection()||this.selectedNode);this.selectedNode=this.oTreeInstance.getSelection()||this.selectedNode;var m,p,q,r,O,t,u,v,w,x;q=l.nodeContext;switch(l.nodeObjectType){case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER:var F=this.oCoreApi.getText("copyOf")+"  "+l.nodeTitle;var y=this.configEditor.copyFacetFilter(l.nodeAPFId);var z=this.configEditor.getFacetFilter(y);var T=sap.apf.modeler.ui.utils.TranslationFormatMap.FACETFILTER_LABEL;this.oTextPool.setTextAsPromise(F,T).done(function(i){z.setLabelKey(i);O=q.split("/");a=O[2];t=O[6];var j=this.oModel.getData().aConfigDetails[a].configData[0].filters[t];j.isSelected=false;var f1=jQuery.extend(true,{},j);f1.id=y;f1.name="< "+F+" >";f1.isSelected=true;r=this.oModel.getData().aConfigDetails[a].configData[0].filters.length;this.oModel.getData().aConfigDetails[a].configData[0].filters.push(f1);O[6]=r;p=O.join("/");e1();}.bind(this));break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY:var A=this.oCoreApi.getText("copyOf")+"  "+l.nodeTitle;var B=this.configEditor.copyCategory(l.nodeAPFId);var D=sap.apf.modeler.ui.utils.TranslationFormatMap.CATEGORY_TITLE;this.oTextPool.setTextAsPromise(A,D).done(function(f1){var g1={labelKey:f1};this.configEditor.setCategory(g1,B);O=q.split("/");a=O[2];u=O[6];var h1=[];var i1=this.configEditor.getSteps();i1.forEach(function(m1){if(C.configEditor.getCategoriesForStep(m1.getId())[0]===B){h1.push(m1.getId());}});var j1=this.oModel.getData().aConfigDetails[a].configData[1].categories[u];j1.isSelected=false;var k1=jQuery.extend(true,{},j1);if(k1.steps){for(var i=0;i<k1.steps.length;i++){k1.steps[i].id=h1[i];var l1=C.configEditor.getStep(h1[i]);N=l1.getRepresentations();if(k1.steps[i].representations){for(var j=0;j<k1.steps[i].representations.length;j++){k1.steps[i].representations[j].id=N[j].getId();}}}}k1.id=B;k1.name="< "+A+" >";k1.isSelected=true;r=this.oModel.getData().aConfigDetails[a].configData[1].categories.length;this.oModel.getData().aConfigDetails[a].configData[1].categories.push(k1);O[6]=r;p=O.join("/");e1();}.bind(this));break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET:var E=this.oCoreApi.getText("copyOf")+"  "+l.nodeTitle;var G=this.configEditor.copyNavigationTarget(l.nodeAPFId);O=q.split("/");a=O[2];v=O[6];var H=this.oModel.getData().aConfigDetails[a].configData[2].navTargets[v];H.isSelected=false;var I=jQuery.extend(true,{},H);I.id=G;I.name="< "+E+" >";I.isSelected=true;r=this.oModel.getData().aConfigDetails[a].configData[2].navTargets.length;this.oModel.getData().aConfigDetails[a].configData[2].navTargets.push(I);O[6]=r;p=O.join("/");e1();break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP:var J=this.oCoreApi.getText("copyOf")+"  "+l.nodeTitle;var K=this.configEditor.copyStep(l.nodeAPFId);var L=this.configEditor.getCategoriesForStep(K);var M=this.configEditor.getStep(K);var P=sap.apf.modeler.ui.utils.TranslationFormatMap.STEP_TITLE;this.oTextPool.setTextAsPromise(J,P).done(function(i){var j;M.setTitleId(i);O=q.split("/");a=O[2];u=O[6];w=O[8];var f1=this.oModel.getData().aConfigDetails[a].configData[1].categories[u].steps[w];f1.isSelected=false;var g1=jQuery.extend(true,{},f1);N=M.getRepresentations();g1.id=K;g1.name="< "+J+" >";if(g1.representations){for(j=0;j<g1.representations.length;j++){g1.representations[j].id=N[j].getId();}}r=this.oModel.getData().aConfigDetails[a].configData[1].categories[u].steps.length;O[8]=r;p=O.join("/");for(var h1=0;h1<L.length;h1++){var i1=jQuery.extend(true,{},g1);var j1={arguments:{configId:S.oConfigListInstance.configId,categoryId:L[h1]}};var k1=S.oConfigListInstance.getSPathFromURL(j1).sPath.split("/");var l1=k1[6];this.oModel.getData().aConfigDetails[a].configData[1].categories[l1].steps.push(i1);}this.oModel.getData().aConfigDetails[a].configData[1].categories[u].steps[r].isSelected=true;e1();}.bind(this));break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION:O=q.split("/");a=O[2];u=O[6];w=O[8];x=O[10];var Q=this.oModel.getData().aConfigDetails[a].configData[1].categories[u].steps[w].id;var R=this.configEditor.getStep(Q);var U=this.configEditor.getCategoriesForStep(Q);this.oModel.getData().aConfigDetails[a].configData[1].categories[u].steps[w].representations[x].isSelected=false;var V=this.oModel.getData().aConfigDetails[a].configData[1].categories[u].steps[w].representations[x];var W=jQuery.extend(true,{},V);var X=R.copyRepresentation(W.id);W.id=X;r=this.oModel.getData().aConfigDetails[a].configData[1].categories[u].steps[w].representations.length;O[10]=r;p=O.join("/");for(var Y=0;Y<U.length;Y++){var Z=jQuery.extend(true,{},W);var $={arguments:{configId:S.oConfigListInstance.configId,categoryId:U[Y],stepId:Q}};var _=S.oConfigListInstance.getSPathFromURL($).sPath.split("/");var a1=_[6];var b1=_[8];this.oModel.getData().aConfigDetails[a].configData[1].categories[a1].steps[b1].representations.push(Z);}this.oModel.getData().aConfigDetails[a].configData[1].categories[u].steps[w].representations[r].isSelected=true;e1();break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION:var c1=this.oCoreApi.getText("copyOf")+"  "+l.nodeTitle;O=q.split("/");a=O[2];var d1=this.oModel.getData().aConfigDetails[a];d1.isSelected=false;O[2]=this.oModel.getData().aConfigDetails.length;p=O.join("/");this.configurationHandler.copyConfiguration(l.nodeAPFId,function(i){var j={AnalyticalConfigurationName:c1};var f1=C.configurationHandler.setConfiguration(j,i);C.configTitle=c1;C.configurationHandler.loadConfiguration(f1,function(g1){var c1=C.configTitle;var h1=sap.apf.modeler.ui.utils.TranslationFormatMap.APPLICATION_TITLE;C.configurationHandler.getTextPool().setTextAsPromise(c1,h1).done(function(i1){g1.setApplicationTitle(i1);});});S._copyConfiguration(i,p);});break;default:break;}function e1(){C.oModel.updateBindings();m=C.oTreeInstance.getModel().getContext(p);C.selectedNode=C.oTreeInstance.getNodeByContext(m);var i=C.oTreeInstance.getAPFTreeNodeContext(C.selectedNode);var j=C.oTreeInstance.getParentNodeContext(i);C.navigateToDifferntView(j,i);C.configEditor.setIsUnsaved();d.resolve();}};var h=function(){var i=new sap.m.Label().addStyleClass("noConfigSelected");i.setText(S.oConfigListInstance.oCoreApi.getText("noConfigSelected"));i.placeAt(S.oConfigListInstance.byId("idConfigDetailData"));S.oConfigListInstance.toolbarController.disableCopyDeleteButton();S.oConfigListInstance._enableDisableExportAndExecuteButton();};var o;if(!b){n.throwMandatoryPopup(S.oConfigListInstance,{yes:function(){var i=S.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(S.oConfigListInstance.oTreeInstance.getSelection());var p=S.oConfigListInstance.oTreeInstance.getParentNodeContext(i);S.oConfigListInstance.bIsDifferntConfig=S.oConfigListInstance.oTreeInstance.isConfigurationSwitched(S.oConfigListInstance.oPreviousSelectedNode,S.oConfigListInstance.selectedNode);S.oConfigListInstance.configEditor=S.oConfigListInstance.configurationHandler.restoreMemorizedConfiguration(p.configId);if(S.oConfigListInstance.bIsSaved===false&&S.oConfigListInstance.configEditor){S.oConfigListInstance.configEditor.setIsUnsaved();}if(S.oConfigListInstance.bIsDifferntConfig===false){var s=(typeof S.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController==="function")?S.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController():undefined;var j=S.oConfigListInstance._isNewSubView(s.getView().getViewData().oParams);if(!j){g.call(S.oConfigListInstance);S.oConfigListInstance._navHandleExpandDelete.call(S.oConfigListInstance,S.oConfigListInstance.oSelectedNodeDetails,p);}else{S.oConfigListInstance.handleConfirmDeletion();}}else{var N=S.oConfigListInstance._navMandatoryResetState(S.oConfigListInstance);if(!N.isNewView){if(N.bIsSaved===false){o(S.oConfigListInstance);}else{g.call(S.oConfigListInstance);}}}}});f=true;}var k;if(s.getView().getViewData().oParams.name==="configuration"){k=true;}o=function(i){n.throwLossOfDataPopup(i,{yes:function(j){S.oConfigListInstance._navSaveState(function(){j(function(l){if(S.oConfigListInstance.selectedNode){var B=S.oConfigListInstance.selectedNode.getBindingContext().sPath;var C=B.split("/");var a=C[2];}S.oConfigListInstance.oModel.getData().aConfigDetails[a].AnalyticalConfiguration=S.oConfigListInstance.configId;S.oConfigListInstance.oModel.updateBindings();g.call(S.oConfigListInstance);});});},no:function(){var i={appId:S.oConfigListInstance.appId,configId:S.oConfigListInstance.configId};var s=(typeof S.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController==="function")?S.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController():undefined;var k=(s.getView().getViewData().oParams.name==="configuration")?true:false;if(S.oConfigListInstance.configId.indexOf(sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.ISNEWCONFIG)===0){S.oConfigListInstance._navHandleExpandDelete.call(S.oConfigListInstance,{},i,k);S.oConfigListInstance.clearTitleAndBreadCrumb();S.oConfigListInstance.byId("idConfigDetailData").removeAllContent();h();}else{S.oConfigListInstance._navConfigResetState(S.oConfigListInstance,function(){g.call(S.oConfigListInstance);});}}});};if(S.oConfigListInstance.bIsSaved===false&&b&&k){o(S.oConfigListInstance);f=true;}if(!f){g.call(S.oConfigListInstance);}return d.promise();},_handlePressDeleteButton:function(e){var d;var s=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(this.oConfigListInstance.oTreeInstance.getSelection());var n=this.oCoreApi.getText(s.nodeObjectType);e.getSource().$().blur();if(s.nodeObjectType===sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP){d=this.oCoreApi.getText("confirmStepDeletion",[s.nodeTitle]);}else{d=this.oCoreApi.getText("confirmDeletion",[n,s.nodeTitle]);}this._openDeleteConfirmationDialog(d);},_openDeleteConfirmationDialog:function(d){var s=this;var c=jQuery.extend(s.oConfigListInstance,{closeDialog:s.closeDialog.bind(s)});if(!this.confirmationDialog){this.confirmationDialog=sap.ui.xmlfragment("idConfigConfirmationDialogFragment","sap.apf.modeler.ui.fragment.deleteConfirmationDialog",c);this.getView().addDependent(this.confirmationDialog);this._setConfirmationDialogText();}var a=new sap.m.Label();a.addStyleClass("dialogText");a.setText(d);this.confirmationDialog.removeAllContent();this.confirmationDialog.addContent(a);jQuery.sap.syncStyleClass("sapUiSizeCompact",this.getView(),this.confirmationDialog);this.confirmationDialog.open();},closeDialog:function(){if(this.confirmationDialog&&this.confirmationDialog.isOpen()){this.confirmationDialog.close();}},_setConfirmationDialogText:function(){sap.ui.core.Fragment.byId("idConfigConfirmationDialogFragment","idDeleteConfirmation").setTitle(this.oCoreApi.getText("confirmation"));sap.ui.core.Fragment.byId("idConfigConfirmationDialogFragment","idDeleteButton").setText(this.oCoreApi.getText("deleteButton"));sap.ui.core.Fragment.byId("idConfigConfirmationDialogFragment","idCancelButtonDialog").setText(this.oCoreApi.getText("cancel"));},_handlePressMoveUpButton:function(){this.bIsDown=false;var s=this.oConfigListInstance.oTreeInstance.getSelection();if(s!==null){var a=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(s);if(a!==undefined){this._moveUpOrDown(a,this.bIsDown);}}},_handlePressMoveDownButton:function(){this.bIsDown=true;var s=this.oConfigListInstance.oTreeInstance.getSelection();if(s!==null){var a=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(s);if(a!==undefined){this._moveUpOrDown(a,this.bIsDown);}}},_moveUpOrDown:function(s,i){var a=s.nodeObjectType;var b=s.nodeAPFId;var n=s.nodeContext;var c=n.split('/')[2];var o,d,t,T,l;var S=false;var e=n.split('/')[n.split('/').length-1];switch(a){case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER:o=this.oConfigListInstance.oModel.getData().aConfigDetails[c].configData[0].filters;l=o.length;if(i){if(parseInt(e,10)!==(l-1)){this.oConfigListInstance.configEditor.moveFacetFilterUpOrDown(b,1);d=parseInt(e,10)+1;S=true;}}else{if(parseInt(e,10)!==0){this.oConfigListInstance.configEditor.moveFacetFilterUpOrDown(b,-1);d=parseInt(e,10)-1;S=true;}}break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY:o=this.oConfigListInstance.oModel.getData().aConfigDetails[c].configData[1].categories;l=o.length;if(i){if(parseInt(e,10)!==(l-1)){this.oConfigListInstance.configEditor.moveCategoryUpOrDown(b,1);d=parseInt(e,10)+1;S=true;}}else{if(parseInt(e,10)!==0){this.oConfigListInstance.configEditor.moveCategoryUpOrDown(b,-1);d=parseInt(e,10)-1;S=true;}}break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET:o=this.oConfigListInstance.oModel.getData().aConfigDetails[c].configData[2].navTargets;l=o.length;if(i){if(parseInt(e,10)!==(l-1)){this.oConfigListInstance.configEditor.moveNavigationTargetUpOrDown(b,1);d=parseInt(e,10)+1;S=true;}}else{if(parseInt(e,10)!==0){this.oConfigListInstance.configEditor.moveNavigationTargetUpOrDown(b,-1);d=parseInt(e,10)-1;S=true;}}break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP:var f=n.split('/')[6];var g=this.oConfigListInstance.oModel.getData().aConfigDetails[c].configData[1].categories[f];o=g.steps;l=o.length;if(i){if(parseInt(e,10)!==(l-1)){this.oConfigListInstance.configEditor.moveCategoryStepAssignmentUpOrDown(g.id,b,1);d=parseInt(e,10)+1;S=true;}}else{if(parseInt(e,10)!==0){this.oConfigListInstance.configEditor.moveCategoryStepAssignmentUpOrDown(g.id,b,-1);d=parseInt(e,10)-1;S=true;}}break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION:var h=this.oConfigListInstance.oTreeInstance.getSelection();var j=sap.ui.getCore().byId(h.getId());var k=j.getParent();var m=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(k).nodeAPFId;var p=this.oConfigListInstance.configEditor.getStep(m);f=n.split('/')[6];var q=n.split('/')[8];o=this.oConfigListInstance.oModel.getData().aConfigDetails[c].configData[1].categories[f].steps[q].representations;l=o.length;if(i){if(parseInt(e,10)!==(l-1)){p.moveRepresentationUpOrDown(b,1);d=parseInt(e,10)+1;S=true;}}else{if(parseInt(e,10)!==0){p.moveRepresentationUpOrDown(b,-1);d=parseInt(e,10)-1;S=true;}}break;default:break;}if(S){t=o[e];T=o[d];o[d]=t;o[e]=T;this.oConfigListInstance.oModel.updateBindings();this.oConfigListInstance.configEditor.setIsUnsaved();}},_handleAddExistingStepPress:function(){var s=this;var a=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(this.oConfigListInstance.oTreeInstance.getSelection());var c=this.oConfigListInstance.oTreeInstance.getParentNodeContext(a).categoryId;var S=this.oConfigListInstance.configEditor.getStepsNotAssignedToCategory(c);var b;var d=[];S.forEach(function(e){var o={};var f=s.oConfigListInstance.configEditor.getStep(e);b=s.oConfigListInstance.oTextPool.get(f.getTitleId()).TextElementDescription;o.id=e;o.name=b;d.push(o);});var m=new sap.ui.model.json.JSONModel({existingStepData:d});if(!this.addExistingStepDialog){this.addExistingStepDialog=sap.ui.xmlfragment("idExistingStepDialogFragment","sap.apf.modeler.ui.fragment.existingStepDialog",this);this._setExistingStepDialogText();}this.getView().addDependent(this.addExistingStepDialog);this.addExistingStepDialog.setModel(m);this.addExistingStepDialog.open();},_handleExistingStepDialogOK:function(e){var n=sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP;var s=e.getParameters("listItem").selectedItems;var a=s.length;var b=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(this.oConfigListInstance.oTreeInstance.getSelection());var c=this.oConfigListInstance.oTreeInstance.getParentNodeContext(b).categoryId;var E=[];for(var i=0;i<a;i++){var p=e.getParameters("selectedItems").selectedContexts[i].sPath.split('/')[2];var o=e.getSource().getModel().getData().existingStepData[p];var d=this.oConfigListInstance.configEditor.getStep(o.id);this.oConfigListInstance.configEditor.addCategoryStepAssignment(c,o.id);var r=d.getRepresentations();var f=r.length;var R=[];for(var j=0;j<f;j++){var g={};g.id=r[j].getId();g.name=r[j].getRepresentationType();g.icon=this._getRepresentationIcon(g.name);R.push(g);}var S={};S.step=o;S.representations=R;S.noOfReps=f;E.push(S);}if(a!==0){var h={noOfSteps:a,aExistingStepsToBeAdded:E};this.oConfigListInstance.oTreeInstance.addNodeInTree(n,h);}},_getRepresentationIcon:function(r){var i;var R=this.oCoreApi.getRepresentationTypes();for(var a=0;a<R.length;a++){if(r===R[a].id){i=R[a].picture;break;}}return i;},_handleExistingStepDialogSearch:function(e){var v=e.getParameter("value");var f=new sap.ui.model.Filter("name",sap.ui.model.FilterOperator.Contains,v);var b=e.getSource().getBinding("items");b.filter([f]);},_handleExistingStepDialogClose:function(e){if(this.addExistingStepDialog){e.getSource().getBinding("items").filter([]);}}});}());
