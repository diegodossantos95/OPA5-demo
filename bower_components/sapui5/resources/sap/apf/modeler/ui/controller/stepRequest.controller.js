/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
jQuery.sap.require("sap.apf.modeler.ui.controller.requestOptions");sap.ui.define(["sap/apf/modeler/ui/controller/requestOptions"],function(B){"use strict";var o=new sap.apf.modeler.ui.utils.OptionsValueModelBuilder();var t=new sap.apf.modeler.ui.utils.TextManipulator();var n=new sap.apf.modeler.ui.utils.NullObjectChecker();return B.extend("sap.apf.modeler.ui.controller.stepRequest",{onBeforeRendering:function(){var c=this;c.byId("idOptionalRequestFieldLabel").setVisible(true);c.byId("idOptionalRequestField").setVisible(true);},onAfterRendering:function(){var c=this;c.addOrRemoveMandatoryFieldsAndRequiredFlag(true);},setDisplayText:function(){var c=this;var T=c.getView().getViewData().oTextReader;c.byId("idSourceLabel").setText(T("source"));c.byId("idEntityLabel").setText(T("entity"));c.byId("idSelectPropertiesLabel").setText(T("selectProperties"));c.byId("idOptionalRequestFieldLabel").setText(T("requiredFilters"));},setOptionalRequestFieldProperty:function(){var c=this;var p,m,f,N,v=[];N=[c.getView().getViewData().oTextReader("none")];p=c.byId("idSelectProperties").getSelectedKeys();f=c.oParentObject.getFilterProperties();m=o.convert(N.concat(p));c.byId("idOptionalRequestField").setModel(m);c.byId("idOptionalRequestField").setSelectedKey(N[0]);if(n.checkIsNotNullOrUndefinedOrBlank(f)){v=c.validateSelectedValues(c,f,p);f=v.aSelectedValues;c.byId("idOptionalRequestField").setSelectedKey(f[0]);}},addOrRemoveMandatoryFieldsAndRequiredFlag:function(r){var c=this;if(r===false){return;}c.byId("idSourceLabel").setRequired(r);c.byId("idEntityLabel").setRequired(r);c.byId("idSelectPropertiesLabel").setRequired(r);c.viewValidator.addFields(["idSource","idEntity","idSelectProperties"]);},fireRelevantEvents:function(e){var c=this,f,s;if(e.getSource()!==c.byId("idOptionalRequestField")){f=[t.removePrefixText(c.byId("idOptionalRequestField").getSelectedKey(),c.getView().getViewData().oTextReader(sap.apf.modeler.ui.utils.CONSTANTS.texts.NOTAVAILABLE))];if(n.checkIsNotNullOrUndefinedOrBlank(f)){c.updateOptionalRequestFieldProperty(f);}if(c.getSelectProperties().length===0){c.oParentObject.resetTopN();}c.getView().fireEvent(sap.apf.modeler.ui.utils.CONSTANTS.events.step.SETDATAREDUCTIONSECTION);}if(e.getSource()===c.byId("idOptionalProperty")){c.setOptionalRequestFieldProperty();}s=(c.byId("idOptionalRequestField").getSelectedKey()!==c.getView().getViewData().oTextReader("none"))?true:false;c.getView().fireEvent(sap.apf.modeler.ui.utils.CONSTANTS.events.step.SETVISIBILITYOFFILTERMAPPINGFIELDS,{"bShowFilterMappingLayout":s});c.getView().fireEvent(sap.apf.modeler.ui.utils.CONSTANTS.events.step.UPDATEFILTERMAPPINGFIELDS);},getSource:function(){return this.oParentObject.getService();},getAllEntitiesAsPromise:function(s){return this.oConfigurationEditor.getAllEntitySetsOfServiceAsPromise(s);},getEntity:function(){return this.oParentObject.getEntitySet();},getAllEntitySetPropertiesAsPromise:function(s,e){return this.oConfigurationEditor.getAllPropertiesOfEntitySetAsPromise(s,e);},resetEntityAndProperties:function(){var c=this;c.clearEntity();c.byId("idEntity").setModel(null);c.byId("idEntity").setSelectedKey(undefined);c.clearSelectProperties();c.byId("idSelectProperties").setModel(null);c.byId("idSelectProperties").setSelectedKeys([]);c.byId("idOptionalRequestField").setModel(null);c.byId("idOptionalRequestField").setSelectedKey(undefined);},clearSource:function(){var c=this;c.oParentObject.setService(undefined);c.clearEntity();},clearEntity:function(){var c=this;c.oParentObject.setEntitySet(undefined);c.clearSelectProperties();},clearSelectProperties:function(){var c=this;var O=c.oParentObject.getSelectProperties();O.forEach(function(p){c.oParentObject.removeSelectProperty(p);});c.clearOptionalRequestFieldProperty();},clearOptionalRequestFieldProperty:function(){var c=this;var O=c.oParentObject.getFilterProperties();O.forEach(function(p){c.oParentObject.removeFilterProperty(p);});},removeSelectProperties:function(p){var c=this;p.forEach(function(a){c.oParentObject.removeSelectProperty(a);});},removeOptionalRequestFieldProperty:function(p){var c=this;p.forEach(function(a){c.oParentObject.removeFilterProperty(a);});},updateSource:function(s){var c=this;c.oParentObject.setService(s);},updateEntity:function(e){var c=this;c.oParentObject.setEntitySet(e);},updateSelectProperties:function(s){var c=this;c.removeSelectProperties(c.oParentObject.getSelectProperties());s.forEach(function(p){c.oParentObject.addSelectProperty(p);});},updateOptionalRequestFieldProperty:function(f){var c=this;c.removeOptionalRequestFieldProperty(c.oParentObject.getFilterProperties());f.forEach(function(p){if(p!==c.getView().getViewData().oTextReader("none")){c.oParentObject.addFilterProperty(p);}});},getSelectProperties:function(){var c=this;return c.oParentObject.getSelectProperties();},getOptionalRequestFieldProperty:function(){var c=this;return c.oParentObject.getFilterProperties();},getValidationState:function(){var c=this;return c.viewValidator.getValidationState();}});});
