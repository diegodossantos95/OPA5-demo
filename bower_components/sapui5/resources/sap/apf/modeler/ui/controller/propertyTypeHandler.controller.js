/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
jQuery.sap.require('sap.apf.modeler.ui.utils.propertyTypeFactory');jQuery.sap.require('sap.apf.modeler.ui.utils.propertyTypeState');jQuery.sap.require('sap.apf.modeler.ui.utils.constants');jQuery.sap.require("sap.apf.modeler.ui.utils.nullObjectChecker");(function(){'use strict';var v,p;var P=new sap.apf.modeler.ui.utils.PropertyTypeFactory();var c=sap.apf.modeler.ui.utils.CONSTANTS.events;var n=new sap.apf.modeler.ui.utils.NullObjectChecker();function _(C,g,s){var V=C.byId("idPropertyTypeVBox");if(n.checkIsNotUndefined(V)){V.getItems().forEach(function(o,i){if(i!==g){o.fireEvent(c.REMOVEADDEDPROPERTY,{"sProperty":s});}});}}function a(C,s,g){var V=C.byId("idPropertyTypeVBox");if(n.checkIsNotUndefined(V)){V.getItems().forEach(function(o,i){if(!n.checkIsNotUndefined(g)){o.fireEvent(c.ADDREMOVEDPROPERTY,{"sProperty":s});return;}if(i!==g){o.fireEvent(c.ADDREMOVEDPROPERTY,{"sProperty":s});}});}}function b(C,s,E){var B=C.getView().getViewData().oViewDataForPropertyType.oBasicDataLayout;var g=B.indexOfItem(C.getView());B.getItems().forEach(function(i,h){var o=sap.apf.modeler.ui.utils.CONSTANTS.propertyTypes;var j=i.getViewData().oViewDataForPropertyType.sPropertyType;if(j===o.DIMENSION||j===o.LEGEND){if(g!==h){var V=i.byId("idPropertyTypeVBox");if(n.checkIsNotUndefined(V)){V.getItems().forEach(function(k){k.fireEvent(E,{"sProperty":s});});}}}});}function d(o,g){g.attachEvent(c.ADDPROPERTY,o.handlePressOfAdd.bind(o));g.attachEvent(c.REMOVEPROPERTY,o.handlePressOfRemove.bind(o));g.attachEvent(c.SETNEXTPROPERTYINPARENTOBJECT,g.getController().setNextPropertyInParentObject.bind(g.getController()));g.attachEvent(c.REMOVEADDEDPROPERTY,g.getController().removeAddedProperty.bind(g.getController()));g.attachEvent(c.ADDREMOVEDPROPERTY,g.getController().addRemovedProperty.bind(g.getController()));g.attachEvent(c.UPDATEPROPERTY,o.handleChangeOfProperty.bind(o));o.getView().attachEvent(c.SETNEXTPROPERTYINPARENTOBJECT,g.getController().setNextPropertyInParentObject.bind(g.getController()));g.attachEvent(c.REMOVECURRENTPROPERTYFROMPARENTOBJECT,g.getController().removePropertyFromParentObject.bind(g.getController()));g.attachEvent(c.REMOVEPROPERTYFROMPARENTOBJECT,g.getController().removePropertyFromParentObject.bind(g.getController()));g.attachEvent(c.UPDATEPROPERTYVALUESTATE,o.updatePropertyValueState.bind(o));g.attachEvent(c.FOCUSONREMOVE,o.handleFocusOnRemove.bind(o));g.attachEvent(c.SETFOCUSONREMOVEICON,g.getController().setFocusOnRemoveIcons.bind(g.getController()));g.attachEvent(c.REMOVEADDEDPROPERTYFROMOTHERPROPERTYTYPE,o.handleRemovalOfAddedProperty.bind(o));g.attachEvent(c.ADDREMOVEDPROPERTYFROMOTHERPROPERTYTYPE,o.handleAdditionOfRemovedProperty.bind(o));}function e(C){p=C.getView().getViewData().aPropertiesToBeCreated;p.forEach(function(o){f(C,o,C.nCounter);});}function f(C,o,g){var V,s;v=jQuery.extend(true,{},C.getView().getViewData().oViewDataForPropertyType);v.oPropertyTypeState=C.oPropertyTypeState;v.oPropertyTypeData=o;s=C.createId("id"+v.sPropertyType+"View"+C.nCounter);C.oPropertyTypeState.addPropertyAt(o.sProperty,g);C.oPropertyTypeState.addPropertyTypeViewIdAt(s,g);V=P.createPropertyTypeView(v,s);d(C,V);C.byId("idPropertyTypeVBox").insertItem(V,g);C.nCounter++;return V;}sap.ui.controller("sap.apf.modeler.ui.controller.propertyTypeHandler",{nCounter:0,oPropertyTypeState:{},onInit:function(){var C=this;C.oPropertyTypeState=new sap.apf.modeler.ui.utils.PropertyTypeState();e(C);},handlePressOfAdd:function(E){var C=this,o={},V,s,S,g;var h=sap.apf.modeler.ui.utils.CONSTANTS.propertyTypes;s=C.getView().getViewData().oViewDataForPropertyType.sPropertyType;S=E.getSource();g=C.byId("idPropertyTypeVBox").indexOfItem(S)+1;o.sProperty=E.getParameter("sProperty");o.sContext=E.getParameter("sContext");if(n.checkIsNotUndefined(o.sProperty)){V=f(C,o,g);V.fireEvent(c.SETNEXTPROPERTYINPARENTOBJECT);_(C,g,E.getParameter("sProperty"));if(s===h.DIMENSION||s===h.LEGEND){S.fireEvent(c.REMOVEADDEDPROPERTYFROMOTHERPROPERTYTYPE,{"sProperty":E.getParameter("sProperty")});}}},handleFocusOnRemove:function(E){var C=this;var V=C.byId("idPropertyTypeVBox");var s=E.getSource();var g=V.indexOfItem(s);var F=C.byId(C.oPropertyTypeState.aPropertyTypeViewIds[g-1]);F.fireEvent(c.SETFOCUSONREMOVEICON);},handlePressOfRemove:function(E){var C=this;var o=sap.apf.modeler.ui.utils.CONSTANTS.propertyTypes;var s=C.getView().getViewData().oViewDataForPropertyType.sPropertyType;var V=C.byId("idPropertyTypeVBox");var S=E.getSource();var g=V.indexOfItem(S);var h=C.oPropertyTypeState.getPropertyValueState()[g];if(C.oPropertyTypeState.isPropertyPresentExactlyOnce(h)){S.fireEvent(c.REMOVECURRENTPROPERTYFROMPARENTOBJECT);}V.removeItem(S);C.oPropertyTypeState.removePropertyAt(g);C.oPropertyTypeState.removePropertyTypeViewIdAt(g);a(C,h);if(s===o.DIMENSION||s===o.LEGEND){S.fireEvent(c.ADDREMOVEDPROPERTYFROMOTHERPROPERTYTYPE,{"sProperty":h});}},handleChangeOfProperty:function(E){var C=this;var o=sap.apf.modeler.ui.utils.CONSTANTS.propertyTypes;var s=C.getView().getViewData().oViewDataForPropertyType.sPropertyType;var V=C.byId("idPropertyTypeVBox");var S=E.getSource();var g=V.indexOfItem(S);var h=C.oPropertyTypeState.getPropertyValueState()[g];_(C,g,h);a(C,E.getParameter("sOldProperty"),g);if(s===o.DIMENSION||s===o.LEGEND){S.fireEvent(c.REMOVEADDEDPROPERTYFROMOTHERPROPERTYTYPE,{"sProperty":h});S.fireEvent(c.ADDREMOVEDPROPERTYFROMOTHERPROPERTYTYPE,{"sProperty":E.getParameter("sOldProperty")});}},updatePropertyValueState:function(E){var C=this;var s=E.getSource();var g=E.getParameter("sProperty");var h=C.byId("idPropertyTypeVBox").indexOfItem(s);C.oPropertyTypeState.updatePropertyAt(g,h);},handleRemoveOfProperty:function(){var C=this;var V=C.byId("idPropertyTypeVBox");if(n.checkIsNotUndefined(V)){V.getItems().forEach(function(o){o.fireEvent(c.REMOVEPROPERTYFROMPARENTOBJECT);});}},handleSettingTopNProperties:function(){var C=this;C.getView().fireEvent(c.SETNEXTPROPERTYINPARENTOBJECT);},handleRemovalOfAddedProperty:function(E){var C=this;var s=E.getParameter("sProperty");b(C,s,c.REMOVEADDEDPROPERTY);},handleAdditionOfRemovedProperty:function(E){var C=this;var s=E.getParameter("sProperty");b(C,s,c.ADDREMOVEDPROPERTY);}});})();
