/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
(function(){'use strict';jQuery.sap.declare('sap.apf.api');jQuery.sap.require('sap.apf.core.messageHandler');jQuery.sap.require('sap.apf.core.instance');jQuery.sap.require('sap.apf.utils.filter');jQuery.sap.require('sap.apf.utils.externalContext');jQuery.sap.require('sap.apf.utils.startFilterHandler');jQuery.sap.require('sap.apf.utils.startFilter');jQuery.sap.require('sap.apf.utils.filterIdHandler');jQuery.sap.require('sap.apf.utils.serializationMediator');jQuery.sap.require('sap.apf.utils.startParameter');jQuery.sap.require('sap.apf.utils.navigationHandler');jQuery.sap.require('sap.apf.ui.instance');jQuery.sap.require('sap.apf.ui.representations.representationInterface');jQuery.sap.require("sap.apf.ui.representations.lineChart");jQuery.sap.require("sap.apf.ui.representations.columnChart");jQuery.sap.require("sap.apf.ui.representations.scatterPlotChart");jQuery.sap.require("sap.apf.ui.representations.table");jQuery.sap.require("sap.apf.ui.representations.stackedColumnChart");jQuery.sap.require("sap.apf.ui.representations.pieChart");jQuery.sap.require("sap.apf.ui.representations.percentageStackedColumnChart");jQuery.sap.require('sap.apf.ui.representations.bubbleChart');jQuery.sap.require("sap.apf.ui.representations.treeTable");jQuery.sap.require('sap.apf.messageCallbackForStartup');jQuery.sap.require("sap.ui.thirdparty.datajs");sap.apf.Api=function(c,i,m){var M;var C;var s;var n;var S;var E;var f;var a;var b;var d;var o;var u;var g;var h=true;var j=jQuery.Deferred();var k=new jQuery.Deferred();var l;this.type='api';this.constants={};this.constants.eventTypes=sap.apf.core.constants.eventTypes;this.destroy=function(){M.activateOnErrorHandling(false);M.setMessageCallback(undefined);M.setLifeTimePhaseShutdown();if(u&&u.destroy){u.destroy();}if(C){C.destroy();}u=undefined;C=undefined;M=undefined;s=undefined;n=undefined;};this.activateOnErrorHandling=function(H){return C.activateOnErrorHandling(H);};this.getStartParameterFacade=function(){return C.getStartParameterFacade();};this.getLogMessages=function(){return C.getLogMessages();};this.createStep=function(e,r,R){return C.createStep(e,r,R);};this.getActiveStep=function(){return C.getActiveStep();};this.getCategories=function(){return C.getCategories();};this.getSteps=function(){return C.getSteps();};this.getStepTemplates=function(){return C.getStepTemplates();};this.getFacetFilterConfigurations=function(){return C.getFacetFilterConfigurations();};this.getApplicationConfigProperties=function(){return C.getApplicationConfigProperties();};this.moveStepToPosition=function(e,r,t){return C.moveStepToPosition(e,r,t);};this.removeStep=function(e,r){return C.removeStep(e,r);};this.resetPath=function(){return C.resetPath();};this.setActiveStep=function(e){return C.setActiveStep(e);};this.stepIsActive=function(e){return C.stepIsActive(e);};this.updatePath=function(e){return C.updatePath(e);};this.getApfLocation=function(){return C.getUriGenerator().getApfLocation();};this.readPaths=function(e){return C.readPaths(e);};this.savePath=function(P,N,e){C.savePath(P,N,e);};this.openPath=function(P,e,r){return C.openPath(P,e,r);};this.deletePath=function(P,e){return C.deletePath(P,e);};this.addFacetFilter=function(e){u.getLayoutView().getController().addFacetFilter(e);};this.getEventCallback=function(e){return u.getEventCallback(e);};this.putMessage=function(e){return C.putMessage(e);};this.createMessageObject=function(e){return C.createMessageObject(e);};this.getTextHtmlEncoded=function(L,P){return C.getTextHtmlEncoded(L,P);};this.getTextNotHtmlEncoded=function(L,P){return C.getTextNotHtmlEncoded(L,P);};if(!m){this.loadApplicationConfig=function(F){C.loadApplicationConfig(F);};}else{this.loadApplicationConfig=function(F){};}this.createFilter=function(){return C.createFilter();};this.addPathFilter=function(e){return f.add(e);};this.updatePathFilter=function(e,r){f.update(e,r);};this.getPathFilter=function(e){return f.get(e);};this.createReadRequest=function(r){return C.createReadRequest(r);};this.createReadRequestByRequiredFilter=function(r){return C.createReadRequestByRequiredFilter(r);};this.selectionChanged=function(r){u.selectionChanged(r);};this.createApplicationLayout=function(){if(!l){l=new sap.m.App().addStyleClass("sapApf");}return l;};this.startApf=function(){var r;var t=this;var v=this.createApplicationLayout();k.done(function(){try{if(this.fnBeforeApfStartupCallback&&typeof this.fnBeforeApfStartupCallback==="function"){this.fnBeforeApfStartupCallback.apply(c,[this]);}j.resolve();u.createApplicationLayout(v);r=n.checkMode();var w=u.handleStartup(r);w.done(function(){if(t.fnAfterApfStartupCallback&&typeof t.fnAfterApfStartupCallback==="function"){t.fnAfterApfStartupCallback.apply(c,[t]);}M.setLifeTimePhaseRunning();});}catch(e){h=false;}}.bind(this));return v;};this.addMasterFooterContent=function(e){return u.addMasterFooterContentRight(e);};this.setEventCallback=function(e,r){switch(e){case sap.apf.core.constants.eventTypes.contextChanged:u.setEventCallback(e,r);return true;case sap.apf.core.constants.eventTypes.printTriggered:u.setEventCallback(e,r);return true;case sap.apf.core.constants.eventTypes.format:this.customFormat(r);return true;default:return false;}};this.customFormat=function(e){u.setCustomFormatExit(e);};this.setCallbackBeforeApfStartup=function(e){this.fnBeforeApfStartupCallback=e;};this.setCallbackAfterApfStartup=function(e){this.fnAfterApfStartupCallback=e;};this.getPropertyValuesOfExternalContext=function(e){var r=jQuery.Deferred();E.getCombinedContext().then(function(t){var v=t.getFilterTermsForProperty(e);var w=[];v.forEach(function(x){var y={Low:x.getValue(),Option:x.getOp(),High:x.getHighValue()};w.push(y);});r.resolve(w);});return r.promise();};this.startupSucceeded=function(){return h;};if(c&&c.getInjections instanceof Function){if(!i){i={};}jQuery.extend(i,i,c.getInjections());}s=new(i&&i.constructors&&i.constructors.StartParameter||sap.apf.utils.StartParameter)(c,m);M=new(i&&i.constructors&&i.constructors.MessageHandler||sap.apf.core.MessageHandler)();M.activateOnErrorHandling(true);M.setLifeTimePhaseStartup();M.loadConfig(sap.apf.core.messageDefinition,true);g=i&&i.functions&&i.functions.messageCallbackForStartup||sap.apf.messageCallbackForStartup;M.setMessageCallback(g);try{C=new(i&&i.constructors&&i.constructors.CoreInstance||sap.apf.core.Instance)({functions:{getCumulativeFilter:function(){return S.getCumulativeFilter();},getCombinedContext:function(){return E.getCombinedContext();},ajax:(i&&i.functions&&i.functions.ajax),serializeApfState:function(e,r){return o.serialize(e,r);},deserializeApfState:function(e){return o.deserialize(e);},odataRequest:(i&&i.functions&&i.functions.odataRequest),getComponentName:function(){if(m&&m.manifest&&m.manifest["sap.app"]){return m.manifest["sap.app"].id;}return c.getMetadata().getComponentName();}},instances:{messageHandler:M,startParameter:s,datajs:(i&&i.instances&&i.instances.datajs)||OData},constructors:{Request:(i&&i.constructors&&i.constructors.Request),Metadata:(i&&i.constructors&&i.constructors.Metadata),MetadataFactory:(i&&i.constructors&&i.constructors.MetadataFactory),ResourcePathHandler:(i&&i.constructors&&i.constructors.ResourcePathHandler),TextResourceHandler:(i&&i.constructors&&i.constructors.TextResourceHandler),SessionHandler:(i&&i.constructors&&i.constructors.SessionHandler),Persistence:(i&&i.constructors&&i.constructors.Persistence)},manifests:m,exits:(i&&i.exits),coreProbe:(i&&i.coreProbe),corePromise:k});b={instances:{startParameter:s,component:c,messageHandler:M},functions:{getConfigurationProperties:C.getApplicationConfigProperties,ajax:C.ajax}};E=new((i&&i.constructors&&i.constructors.ExternalContext)||sap.apf.utils.ExternalContext)(b);a={functions:{getFacetFilterConfigurations:this.getFacetFilterConfigurations,getReducedCombinedContext:C.getReducedCombinedContext,createRequest:C.getFunctionCreateRequest()},instances:{messageHandler:M,onBeforeApfStartupPromise:j.promise()},constructors:{StartFilter:sap.apf.utils.StartFilter}};S=new((i&&i.constructors&&i.constructors.StartFilterHandler)||sap.apf.utils.StartFilterHandler)(a);d={functions:{setRestrictionByProperty:S.setRestrictionByProperty,getRestrictionByProperty:S.getRestrictionByProperty},instances:{messageHandler:M}};f=new((i&&i.constructors&&i.constructors.FilterIdHandler)||sap.apf.utils.FilterIdHandler)(d);o=new((i&&i.constructors&&i.constructors.SerializationMediator)||sap.apf.utils.SerializationMediator)({instances:{coreApi:C,filterIdHandler:f,startFilterHandler:S,messageHandler:M}});var p={functions:{getCumulativeFilterUpToActiveStep:C.getCumulativeFilterUpToActiveStep,getNavigationTargets:C.getNavigationTargets,getActiveStep:C.getActiveStep,createRequest:C.getFunctionCreateRequest(),getXappStateId:C.getStartParameterFacade().getXappStateId,isFilterReductionActive:C.getStartParameterFacade().isFilterReductionActive,getAllParameterEntitySetKeyProperties:C.getMetadataFacade().getAllParameterEntitySetKeyProperties},instances:{messageHandler:M,component:c,serializationMediator:o}};n=new((i&&i.constructors&&i.constructors.NavigationHandler)||sap.apf.utils.NavigationHandler)(p);u=new(i&&i.constructors&&i.constructors.UiInstance||sap.apf.ui.Instance)({oCoreApi:C,oFilterIdHandler:f,oSerializationMediator:o,oNavigationHandler:n,oComponent:c,oStartParameter:s,oStartFilterHandler:S,exits:i&&i.exits||{}});}catch(q){h=false;this.startApf=function(){return new sap.m.Text({text:""});};this.loadApplicationConfig=function(){return"";};jQuery.sap.log.error("Caught exception during creation of APF API");}if(C){C.createRepresentation=function(r,e){var t=new sap.apf.ui.representations.RepresentationInterfaceProxy(C,u);var R=sap.apf.utils.extractFunctionFromModulePathString(r);return new R(t,e);};}if(i&&i.probe&&typeof i.probe==='function'){i.probe({apfApi:this,coreApi:C,component:c,uiApi:u,messageHandler:M,serializationMediator:o,navigationHandler:n,startParameter:s,injectedFunctionsNavigationHandler:p&&p.functions,startFilterHandler:S,externalContext:E,filterIdHandler:f,corePromise:k});}};}());
