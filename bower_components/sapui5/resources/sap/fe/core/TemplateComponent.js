/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2017 SAP SE. All rights reserved
    
 */
jQuery.sap.require("sap.ui.core.CustomizingConfiguration");(function(){"use strict";sap.ui.define(["jquery.sap.global","sap/ui/core/mvc/ViewType","sap/ui/core/UIComponent","sap/ui/model/json/JSONModel","sap/ui/model/resource/ResourceModel","sap/ui/Device"],function(q,V,U,J,R,D){function e(C){var p=[];var i=new R({bundleName:"sap/fe/messagebundle",async:true});p.push(i.getResourceBundle());Promise.all(p).then(function(){i.getResourceBundle().then(function(r){i.getResourceBundle=function(){return r;};C.setModel(i,"sap.fe.i18n");});});return p;}function d(C){if(C.getAppComponent().getMetadata().getComponentName()===""||C.getTemplateName()===""||C.getEntitySet()===""){return false;}return C.getAppComponent().getMetadata().getComponentName()+"::"+C.getTemplateName()+"::"+C.getEntitySet();}function c(E,C,m){var s=null;var A=C.getComponentContainer().getSettings();s=q.extend({},A);delete s.appComponent;delete s.entitySet;delete s.navigationProperty;return new J({entitySet:C.getEntitySet(),"sap-ui-debug":window["sap-ui-debug"],"settings":s,"manifest":C.getAppComponent().getMetadata().getManifest(),metaModel:m});}function a(C){var o=C.oComponent,f=C.createViewController;var v=null,b;var m=o.getModel();var M=m.getMetaModel();var E=M.getObject("/$EntityContainer/"+o.getEntitySet());var s=d(o);if(!E||!s){C.oTemplateUtils.getNavigationController().navigateToMessagePage({text:C.oTemplateUtils.getText("SAPFE_APPSTART_TECHNICAL_ISSUES"),description:C.oTemplateUtils.getText("SAPFE_APPSTART_WRONG_CONFIGURATION")});return Promise.reject();}v=sap.ui.getCore().byId(s);if(v){q.sap.log.warning("View with ID: "+s+" already exists - old view is getting destroyed now!");try{v.destroy();}catch(g){q.sap.log.warning("Error destroying view: "+g);}v=null;}var h=new J(sap.ui.Device);h.setDefaultBindingMode("OneWay");var p=c(E.$Type,o,M);var i=new Promise(function(r,j){var P={oParameterModel:p.createBindingContext("/")};Promise.all(o.preTemplater(P)).then(function(k){o.runAsOwner(function(){b={async:true,preprocessors:{xml:{bindingContexts:{entitySet:M.createBindingContext("/"+o.getEntitySet())},models:{entitySet:M,'sap.fe.metaModel':M,device:h,parameter:p},preprocessorsData:o.getComponentData().preprocessorsData}},id:s,type:V.XML,viewName:o.getTemplateName(),height:"100%"};if(f){var l=f();b.controller=new l();}v=sap.ui.view(b);v.loaded().then(function(v){r(v);}).catch(function(n){C.oTemplateUtils.getNavigationController().navigateToMessagePage({text:C.oTemplateUtils.getText("SAPFE_APPSTART_TECHNICAL_ISSUES"),description:C.oTemplateUtils.getText("SAPFE_APPSTART_TEMPLATING_ISSUE"),technicalMessage:n.message||(n.messages&&n.messages[0]&&n.messages[0].text)||"",technicalDetails:n.stack||n});j(n);});});}).catch(o.preTemplaterReject.bind(C.oComponent));});return i;}return U.extend("sap.fe.core.TemplateComponent",{metadata:{properties:{templateName:{type:"string",defaultValue:null},entitySet:{type:"string",defaultValue:null}}},getAppComponent:function(){var C;if(!this._oAppComponent){C=this.getComponentContainer();while(C&&!(C instanceof sap.fe.AppComponent)){C=C.getParent();}this._oAppComponent=C;}return this._oAppComponent;},init:function(){(U.prototype.init||q.noop).apply(this,arguments);var u=new J({editable:false,enabled:false,busyControls:{},outdatedControls:{}});this.setModel(u,"ui");var p=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService("URLParsing");var t=new J({generic:{crossAppNavSupport:!!p&&p.isIntentUrl(document.URL),draftIndicatorState:sap.m.DraftIndicatorState.Clear,listCommons:{functionEnabled:{}}},viewLevel:this.getComponentData().registryEntry.viewLevel});t.setDefaultBindingMode("TwoWay");this.setModel(t,"_templPriv");},getComponentContainer:function(){return this.oContainer;},onBeforeRendering:function(C){if(C&&!C.createViewStarted){C.createViewStarted=true;C.aI18nLoadPromises=e(C.oComponent);var o=C.oComponent.getComponentContainer();var m=o&&o.getModel();if(m){m.getMetaModel().requestObject("/$EntityContainer/").then(function(){a(C).then(function(v){Promise.all(C.aI18nLoadPromises).then(function(){C.oComponent.setAggregation("rootControl",v);o.invalidate();});},function(){C.fnViewRegisteredResolve();});});}}}});});})();
