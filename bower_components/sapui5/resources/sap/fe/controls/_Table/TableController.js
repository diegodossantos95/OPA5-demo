/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2017 SAP SE. All rights reserved
    
 */
sap.ui.define(["jquery.sap.global","sap/ui/base/Object","sap/fe/core/CommonUtils","sap/fe/Action","sap/ui/model/json/JSONModel","sap/ui/model/Sorter"],function(q,B,C,A,J,S){"use strict";var T=B.extend("sap.fe.controls._Table.TableController",{constructor:function(t){B.apply(this,arguments);this.oTable=t;this.oInnerTable=t.getInnerTable();}});T.prototype.attachToFilterBar=function(){var Q,t=this;var e;if(this.oTable.getFilterBarId()){var v=C.getParentViewOfControl(this.oTable);var f=v.byId(this.oTable.getFilterBarId());f.attachSearch(function(){var Q;Q=f.getQueryParameters(e);t.updateQueryParameters(Q);});if(f.isReady()){Q=f.getQueryParameters(e);t.updateQueryParameters(Q);}}};T.prototype.updateQueryParameters=function(Q){var t=this.oTable;var c;var l=t.getListBinding();if(Q){c=Q.conditionModel;}var f=function(){var F=true;if(!l){l=t.getListBinding();}if(c){F=c.applyFilters();}if(F){if(Q){delete Q.conditionModel;l.changeParameters(Q);}}t.getInnerTable().setShowOverlay(!F);};var m=function(){f();t.detachModelContextChange(m);};if(l){f();}else{t.attachModelContextChange(m);}};T.prototype.handleDataRequested=function(e){this.oInnerTable.setBusy(true);};T.prototype.handleCallAction=function(e){var a=e.getParameters();var o=e.getSource();a.mode=o.getMode();if(a.mode==='Inline'){a.contexts=[o.getBindingContext()];}else{a.contexts=this.oTable.getSelectedContexts();}a.setBusy=true;a.checkBusy=true;this.oTable.fireCallAction(a);};T.prototype.getToolbarActions=function(t){var a=[];for(var i=0;i<t.length;i++){if(t[i]instanceof A){a.push(t[i]);}}return a;};T.prototype.enableDisableActionsUtil=function(s,t){var f,a,o;if(s!=null){for(var i=0;i<t.length;i++){o=t[i];f=o.getMultiplicityFrom();a=o.getMultiplicityTo();if((!f||(s>=f)&&(!a||s<=a))){o.setEnabled(true);}else{o.setEnabled(false);}}}};T.prototype.bindTableCountUtil=function(t){if(t!=null){t.setModel(this.oInnerTable.getModel(),"headerContext");}var b=this.oTable.getListBinding();if(b){t.setBindingContext(b.getHeaderContext(),"headerContext");}};T.prototype.createAndOpenViewSettingsDialog=function(v,s,c,d){if(this.oViewSettingsPropertyModel==null&&this.oViewSettingsPropertyModel==undefined){var a=this.oInnerTable.getModel("sap.fe.i18n").getResourceBundle().getText("SAPFE_VIEWSETTINGS_COLUMN_SELECTALL",[s,c]);v["selectAllText"]=a;v["sortDesecending"]=false;v["groupDescending"]=false;this.oViewSettingsPropertyModel=new J(v);}var V=new sap.ui.view("viewSettingsXMLView",{viewName:"sap.fe.controls._ViewSettings.ViewSettings",type:"XML",async:true,preprocessors:{xml:{bindingContexts:{propertiesModel:this.oViewSettingsPropertyModel.createBindingContext("/"),dialogProperties:d.createBindingContext("/")},models:{propertiesModel:this.oViewSettingsPropertyModel,dialogProperties:d}}}});V.setModel(this.oViewSettingsPropertyModel);this.oTable.addDependent(V);V.loaded().then(function(){var b=(d.getData().InitialVisiblePanel==="columns")?"viewSettingsXMLView--columns":d.getData().InitialVisiblePanel;var o=V.getController();o.oTableController=this;V.byId("viewSettingsDialog").open(b);}.bind(this));};T.prototype.createAndOpenP13nSettingsDialog=function(p,d){if(this.oP13nSettingsPropertyModel==null&&this.oP13nSettingsPropertyModel==undefined){p["p13nSortItems"]=[];p["p13nGroupItems"]=[];this.oP13nSettingsPropertyModel=new J(p);}var P=new sap.ui.view("p13nSettingsXMLView",{viewName:"sap.fe.controls._P13nSettings.P13nSettings",type:"XML",async:true,preprocessors:{xml:{bindingContexts:{propertiesModel:this.oP13nSettingsPropertyModel.createBindingContext("/"),dialogProperties:d.createBindingContext("/")},models:{propertiesModel:this.oP13nSettingsPropertyModel,dialogProperties:d}}}});P.setModel(this.oP13nSettingsPropertyModel);this.oTable.addDependent(P);P.loaded().then(function(){var c=P.getController();c.oTableController=this;P.byId("p13nDialog").open();}.bind(this));};T.prototype.onStandardActionClick=function(e){var a=e.getSource().getText(),i=this.oInnerTable.getModel().getMetaModel(),E=i.getObject("/"+this.oTable.getEntitySet()+"/"),b=false,t=this.oInnerTable.getColumns(),c=t.length,d=[],s=0,f=[],g=[],h=[],j=this.oTable.getSettingsDialogType(),k=this.oInnerTable.getModel().getMetaModel().getMetaContext(this.oTable.getContext()).getObject();for(var l=0;l<c;l++){var o=t[l];var m=o.getId().split("::");d.push(m[m.length-1]);}for(var p in E){if(typeof(E[p])=="object"&&E[p].$kind&&E[p].$kind==="Property"){var _=i.getObject("/"+this.oTable.getEntitySet()+"/"+p+"@com.sap.vocabularies.Common.v1.Label");s=(d.indexOf(p)>-1)?s+1:s;var I={"name":(_!=null&&_!=undefined)?_:p,"columnKey":p,"selected":false};f.push(JSON.parse(JSON.stringify(I)));g.push(JSON.parse(JSON.stringify(I)));var n=JSON.parse(JSON.stringify(I));n.selected=!!(d.indexOf(p)>-1);h.push(n);}}for(var r in k){if(typeof(k[r])=="object"&&k[r].$Type&&k[r].$Type=="com.sap.vocabularies.UI.v1.DataFieldForAction"){s=(d.indexOf(k[r].Action)>-1)?s+1:s;var u={"name":(k[r].Label)?k[r].Label:k[r].Action,"columnKey":k[r].Action,"selected":false};u.selected=!!(d.indexOf(k[r].Action)>-1);h.push(u);}}var P={"sortPanelItems":f,"groupPanelItems":g,"columnPanelItems":h.sort(function(x,y){if(x.selected===y.selected){return 0;}else if(x.selected){return-1;}else{return 1;}})};var D=new J({"InitialVisiblePanel":a,"showSortPanel":!!(b||a==="sort"),"showGroupPanel":!!((b||a==="group")&&(this.oInnerTable.getMetadata().getName()==="sap.m.Table")),"showColumnPanel":!!(b||a==="column")});if(j==="P13nDialog"){this.createAndOpenP13nSettingsDialog(P,D);}else{this.createAndOpenViewSettingsDialog(P,s,h.length,D);}};T.prototype.applyGroupAndSort=function(s){if(s.length>0){var b=this.getListBinding();b.sort(s);this.updateQueryParameters();}};return T;});
