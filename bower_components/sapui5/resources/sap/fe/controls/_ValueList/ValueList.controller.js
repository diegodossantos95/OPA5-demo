/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2017 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/mdc/ConditionModel","sap/ui/mdc/ODataSuggestProvider","sap/ui/mdc/OperatorSuggestProvider","sap/m/SearchField","sap/ui/model/json/JSONModel"],function(C,a,O,b,S,J){"use strict";return C.extend("sap.fe.controls._ValueList.ValueList",{handleSearch:function(e){var v=this.getView().byId("valueListTable");var s=e.getParameter("query")||e.getParameter("newValue");v.getBinding("items").changeParameters({$search:s||undefined});},onInit:function(){var f=new J({visible:false,listView:false,tableView:true,sSelectedRowCount:0});this.oValueListTable=this.getView().byId("valueListTable");var l=this.oValueListTable.getBinding("items");this.oValueListTableConditionModel=a.getFor(l);var c=this.oValueListTableConditionModel.bindProperty("/",this.oValueListTableConditionModel.getContext("/"));c.attachChange(this.handleChange.bind(this));var l=this.getView().byId("valueListTable").getBinding("items");l.attachChange(this.updateTableSelections.bind(this));this.getView().setModel(this.oValueListTableConditionModel,"vltcm");this.getView().setModel(f,"FilterLayoutFlag");},onAfterRendering:function(){this.updateTableSelections();},handleFilter:function(){if(this.getView().getModel("FilterLayoutFlag").getProperty("/visible")){this.getView().getModel("FilterLayoutFlag").setProperty("/visible",false);}else{this.getView().getModel("FilterLayoutFlag").setProperty("/visible",true);}},handleChange:function(){this.oValueListTableConditionModel.applyFilters();},handleConditionButtonVisibility:function(){var g=this.getView().byId("template::DefineConditions");var c=this.getView().getModel("cm");var l=c.getConditions().length;var o=[];for(var i=0;i<l;i++){if(c.getConditions()[i].operator!=="EEQ"){o.push(c.getConditions()[i]);}}if(o.length===0){c.addCondition(c.createCondition(this.getView().getController().fieldPath,"EQ",[]));}else{var d=g.getContent();d[d.length-1].getContent()[4].getContent()[1].setVisible(true);}},onResetValueHelp:function(c,m){var v=this.getView();v.setModel(m,"cm");},handleToggleButton:function(e){var i=e.getSource().getId();if(i.indexOf("template::ListView")!==-1){this.getView().getModel("FilterLayoutFlag").setProperty("/listView",true);this.getView().getModel("FilterLayoutFlag").setProperty("/tableView",false);}else if(i.indexOf("template::TableView")!==-1){this.getView().getModel("FilterLayoutFlag").setProperty("/tableView",true);this.getView().getModel("FilterLayoutFlag").setProperty("/listView",false);}},removeCondition:function(e){var s=e.oSource.getId();var c=this.oView.getModel("cm");var d=c.getConditions();var l=d.length;var o=[];for(var i=0;i<l;i++){if(d[i].operator!=="EEQ"){o.push({items:d[i],index:i});}}var f=s.substr(s.lastIndexOf("-")+1,s.length);var r=[];r.push(o[f]);c.removeCondition(this.getView().getController().fieldPath,parseInt(r[0].index,10));if(l===0){c.addCondition(c.createCondition(this.getView().getController().fieldPath,"EQ",[]));}},addCondition:function(e){var c=this.oView.getModel("cm");var i=c.getConditions().length;c.insertCondition(i,c.createCondition(this.getView().getController().fieldPath,"EQ",[]));if(i<c.getConditions().length){e.getSource().setVisible(false);}},handleSelectionChange:function(e){var v=this.getView();var c=v.getModel("cm");var f=v.getController().fieldPath;var V=v.getModel("valueList").getObject("/");var I,k,d,B;var s=e.getParameter("listItem").getSelected();if(s===true){for(var i=0;i<e.getParameter("listItems").length;i++){B=e.getParameter("listItems")[i].getBindingContext();I=B.getObject();k=I[V.__sapfe.keyPath];d=I[V.__sapfe.descriptionPath];c.addCondition(c.createCondition(f,"EEQ",[k,d,B.getCanonicalPath()]));}}else{for(var j=0;j<e.getParameter("listItems").length;j++){var g=c.getConditions().filter(function(o){return o.operator==="EEQ";});B=e.getParameter("listItems")[j].getBindingContext();for(var i=0;i<g.length;i++){if(g[i].values&&g[i].values[2]===B.getCanonicalPath()){c.removeCondition(f,i);break;}}}}},handleTokenUpdate:function(e){var v=this.getView();var c=v.getModel("cm");var f=v.getController().fieldPath;var r=e.getParameter("removedTokens");var t=v.byId("template::Tokenizer").getTokens();for(var i=0;i<t.length;i++){if(t[i].getKey()===r[0].getKey()){var T=v.byId("valueListTable");var o=T.getSelectedContexts();for(var j=0;j<o.length;j++){if(o[j].getCanonicalPath()===c.getConditions()[i].values[2]){T.getItems()[o[j].iIndex].setSelected(false);break;}}c.removeCondition(f,i);break;}}},updateTableSelections:function(e){var t,I;t=this.getView().byId("valueListTable");t.removeSelections(true);I=t.getItems();var c,d,f;c=this.getView().getModel("cm");d=c.getConditions();f=d.filter(function(o){return o.operator==="EEQ";});var i,j,o,g;for(i=0;i<f.length;i++){o=f[i];for(j=0;j<I.length;j++){g=I[j];if(g.getBindingContext().getCanonicalPath()===o.values[2]){t.setSelectedItem(g,true);break;}}}}});});
