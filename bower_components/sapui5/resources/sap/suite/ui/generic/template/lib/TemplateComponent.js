sap.ui.define(["jquery.sap.global","sap/ui/core/CustomizingConfiguration","sap/ui/core/mvc/ViewType","sap/ui/core/Component","sap/ui/core/UIComponent","sap/ui/model/json/JSONModel","sap/ui/model/resource/ResourceModel","sap/ui/Device"],function(q,C,V,a,U,J,R,D){"use strict";function g(o){var s=o&&typeof o==="string"?o:(o&&a.getOwnerIdFor(o));var i=s&&sap.ui.component(s);if(i instanceof T){i=i.getAppComponent();}return i;}var G=C.getViewExtension;C.getViewExtension=function(v,s,o){var i=g(o),k=i&&i.getId(),r=G.call(C,v,s,k);return r;};var f=C.getControllerExtension;C.getControllerExtension=function(s,o){var i=g(o),k=i&&i.getId(),r=f.call(C,s,k);return r;};function e(o){var I=new R({bundleName:"sap/suite/ui/generic/template/lib/i18n/i18n"});var k=[];var m=o.getAppComponent().getModel("i18n|"+o.getMetadata().getComponentName()+"|"+o.getEntitySet());if(m){k.push(m);}var t=o.getModel("i18n");if(t){k.push(t);}var p=true;for(var P="i18n";p;){P=P+"||Parent";p=o.getModel(P);if(p){k.push(p);}}for(var i=k.length-1;i>=0;i--){I.enhance(k[i].getResourceBundle());}o.setModel(I,"i18n");}function E(o,m){var M=o.getAppComponent().getManifestEntry("sap.ui5");var i=M.extends&&M.extends.extensions&&M.extends.extensions["sap.ui.controllerExtensions"];var t=o.getTemplateName();var k=i&&i[t]&&i[t]["sap.ui.generic.app"];var s=o.getEntitySet();var B=k&&k[s]&&k[s].Actions;var l={};var n=b(o);if(B){if(n){A(l,B,n);}else{c(l,B);}}else{var S=k&&k[s];for(var p in S){B=S[p]["Actions"];if(B){c(l,B);}}}o.getModel("_templPriv").setProperty("/generic/listCommons/breakoutActionsEnabled",l);}function b(o){var r;var i=o.getAppComponent().getConfig();var s=i&&i.pages[0]&&i.pages[0].component&&i.pages[0].component.settings;if(s&&s.quickVariantSelectionX){r=s.quickVariantSelectionX.variants;}if(s&&s._quickVariantSelectionX){r=s._quickVariantSelectionX.variants;}return r;}function A(B,o,t){var k;for(var s in o){k=true;if(o[s].requiresSelection){k=false;}for(var i in t){var l=o[s].id;var m=t[i];var S=sap.suite.ui.generic.template.js.AnnotationHelper.getSuffixFromIconTabFilterKey(m);if(S){l=l.concat(S);}B[l]={enabled:k};}}}function c(B,o){var i;for(var s in o){i=true;if(o[s].requiresSelection){i=false;}B[o[s].id]={enabled:i};}}function d(o){if(o.getAppComponent().getMetadata().getComponentName()===""||o.getTemplateName()===""||o.getEntitySet()===""){}return o.getAppComponent().getMetadata().getComponentName()+"::"+o.getTemplateName()+"::"+o.getEntitySet();}function h(s,o,m,t){var i=o.oComponent;var k=i.getAppComponent();var l=i.getEntitySet();var n=o.utils.isDraftEnabled();var S=null;var p=i.getComponentContainer().getSettings();S=q.extend({},p);delete S.appComponent;delete S.entitySet;delete S.navigationProperty;S.subPages=o.routeConfig.pages;S.routeConfig=o.routeConfig;return new J({entitySet:l,entityType:s,routingSpec:o.routingSpec,"sap-ui-debug":window["sap-ui-debug"],isDraftEnabled:n,settings:S,manifest:k.getInternalManifest(),metaModel:m,templateSpecific:t&&t(),appComponentName:i.getAppComponent().getMetadata().getComponentName(),helper:{bool:{"true":true,"false":false}}});}function j(o,i){var k=o.oComponent,l=o.createViewController,t=o.methods&&o.methods.getTemplateSpecificParameters,m=k.getModel(),M,s,n,p,r,N=o.routingSpec&&o.routingSpec.noOData;if(N){M=new J({entitySet:{},entityType:{}});p=M.createBindingContext("/entitySet");r=M.createBindingContext("/entityType");}else{M=m&&m.getMetaModel();s=m&&k.getEntitySet();var u=s&&M.getODataEntitySet(s);n=u&&u.entityType;if(!n){return null;}p=M.createBindingContext(M.getODataEntitySet(s,true));r=M.createBindingContext(M.getODataEntityType(n,true));}e(k);E(k,m);q.sap.require("sap.ui.model.odata.AnnotationHelper");var S=d(k);var v=sap.ui.getCore().byId(S);if(v){q.sap.log.warning("View with ID: "+S+" already exists - old view is getting destroyed now!");try{v.destroy();}catch(w){q.sap.log.warning("Error destroying view: "+w);}v=null;}var x=new J(D);x.setDefaultBindingMode("OneWay");o.oParameterModel=h(n,o,M,t);k.runAsOwner(function(){var P=o.preprocessorsData;var y={async:true,preprocessors:{xml:{bindingContexts:{entitySet:p,entityType:r},models:{device:x,entitySet:M,entityType:M,parameter:o.oParameterModel},preprocessorsData:P}},id:S,type:V.XML,viewName:k.getTemplateName(),height:"100%",cache:{keys:i,additionalData:[P]}};if(l){var z=l();y.controller=new z();}v=sap.ui.view(y);});return v;}var T=U.extend("sap.suite.ui.generic.template.lib.TemplateComponent",{metadata:{properties:{templateName:{type:"string",defaultValue:null},entitySet:{type:"string",defaultValue:null},navigationProperty:{type:"string",defaultValue:null},appComponent:{type:"object",defaultValue:null},isRefreshRequired:{type:"boolean",defaultValue:false},isLeaf:{type:"boolean"}},library:"sap.suite.ui.generic.template"},init:function(){(U.prototype.init||q.noop).apply(this,arguments);var u=new J({editable:false,enabled:false});this.setModel(u,"ui");var p=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService("URLParsing");var t=new J({generic:{crossAppNavSupport:!!p&&p.isIntentUrl(document.URL),draftIndicatorState:sap.m.DraftIndicatorState.Clear,listCommons:{functionEnabled:{}},viewLevel:this.getComponentData().registryEntry.viewLevel,controlProperties:{},supportedIntents:{},embeddedComponents:{}}});t.setDefaultBindingMode("TwoWay");this.setModel(t,"_templPriv");},getManifestEntry:function(k){var v=U.prototype.getManifestEntry.apply(this,arguments);if(/^\/sap\.ui5\/componentUsages(\/.+)?$/.test(k)){v=q.extend(true,{},v,U.prototype.getManifestEntry.apply(this.getAppComponent(),arguments));}return v;},getComponentContainer:function(){return this.oContainer;},onBeforeRendering:function(o){if(o){var k=o.oComponent.getComponentContainer();var m=!o.createViewStarted&&k&&k.getModel();if(m){m.getMetaModel().loaded().then(function(){if(!o.createViewStarted){var l=[];var p=m.metadataLoaded().then(function(P){var s;if(P&&P.lastModified){s=new Date(P.lastModified).getTime()+"";}else{q.sap.log.error("TemplateComponent: no valid cache key segment last modification date provided by the OData Model");s=new Date().getTime()+"";}return s;});l.push(p);var n=m.annotationsLoaded().then(function(P){var r=0;if(P){for(var i=0;i<P.length;i++){if(P[i].lastModified){var L=new Date(P[i].lastModified).getTime();if(L>r){r=L;}}else{q.sap.log.error("TemplateComponent: no valid cache key segment last modification date provided by OData annotations");r=new Date().getTime()+"";}}}if(r===0){q.sap.log.error("TemplateComponent: no valid cache key segment last modification date provided by OData annotations");r=new Date().getTime();}return r+"";});l.push(n);o.createViewStarted=true;j(o,l).loaded().then(function(v){o.oComponent.setAggregation("rootControl",v);k.invalidate();});}});}}},setContainer:function(){U.prototype.setContainer.apply(this,arguments);},getRouter:function(){if(this.getAppComponent()){return this.getAppComponent().getRouter();}return U.prototype.getRouter.apply(this,arguments);}});return T;});
