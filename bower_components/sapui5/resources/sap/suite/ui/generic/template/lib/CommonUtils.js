sap.ui.define(["jquery.sap.global","sap/ui/base/Object","sap/ui/Device","sap/ui/model/Context","sap/ui/model/json/JSONModel","sap/ui/comp/smarttable/SmartTable","sap/ui/table/Table","sap/m/Table","sap/m/ListBase","sap/m/MessageBox","sap/ui/generic/app/navigation/service/NavigationHandler","sap/ui/generic/app/navigation/service/NavError","sap/suite/ui/generic/template/lib/testableHelper"],function(q,B,D,C,J,S,U,R,L,M,N,a,t){"use strict";function g(p,e){for(var i in p){var E=p[i];if(E.entitySet===e&&E.component.list&&E.navigationProperty){return E.navigationProperty;}else if(E.pages){var r=g(E.pages,e);if(r){return r;}}}}function b(c,s,o){var n;function A(i){s.oApplication.attachControlToParent(i,c.getView());}function d(i,j,h1,i1){return s.oApplication.getDialogFragmentForView(c.getView(),i,j,h1,i1);}var r;function e(){r=r||c.getOwnerComponent().getModel("i18n").getResourceBundle();return r.getText.apply(r,arguments);}function f(j){var h1=[];if(j instanceof S){j=j.getTable();}else if(j instanceof sap.ui.comp.smartchart.SmartChart){j=j.getChart();if(j&&j.getMetadata().getName()==="sap.chart.Chart"){var i1=j.getSelectedDataPoints();if(i1&&i1.count>0){var j1=i1.dataPoints;for(var i=0;i<j1.length;i++){h1.push(j1[i].context);}}}}if(j instanceof L){h1=j.getSelectedContexts();}else if(j instanceof U){var k1=j.getSelectedIndices();for(var i=0;i<k1.length;i++){h1.push(j.getContextByIndex(k1[i]));}}return h1;}function h(i){var j={};if(i instanceof sap.ui.core.Element){i.getCustomData().forEach(function(h1){j[h1.getKey()]=h1.getValue();});}return j;}function k(j){var h1,i1,j1,k1,l1,m1;var n1=E(j);var o1=n1.getMetadata().getName();if(o1!=="sap.ui.comp.smarttable.SmartTable"&&o1!=="sap.ui.comp.smartchart.SmartChart"){n1=n1.getParent();o1=n1.getMetadata().getName();}var p1=f(n1);var q1=n1.getModel();var r1=q1.getMetaModel();var s1=c.getView();if(o1==="sap.ui.comp.smarttable.SmartTable"){h1=n1.getCustomToolbar()&&n1.getCustomToolbar().getContent();i1=w(n1);F(i1,p1,q1);}else if(o1==="sap.ui.comp.smartchart.SmartChart"){h1=n1.getToolbar()&&n1.getToolbar().getContent();var t1=c.getOwnerComponent().getAppComponent();var u1=t1.getConfig();if(u1&&u1.pages[0]&&u1.pages[0].component&&u1.pages[0].component.settings&&u1.pages[0].component.settings._quickVariantSelectionX){i1=x(n1);F(i1,p1,q1);}}if(h1&&h1.length>0){for(var i=0;i<h1.length;i++){l1=undefined;j1=h1[i];if(j1.getMetadata().getName()==="sap.m.Button"&&j1.getVisible()){m1=h(j1);if(m1&&m1.Type){k1=s1.getLocalId(j1.getId());if(m1.Type==="CRUDActionDelete"){l1=u(q1,r1,p1,n1);n1.getModel("_templPriv").setProperty("/listReport/deleteEnabled",l1);}else if(m1.Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"||m1.Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){l1=p(q1,r1,p1,m1.Type,m1.Action);}}if(/generic\/controlProperties/.test(j1.getBindingPath("enabled"))&&l1!==undefined){m(k1,"enabled",l1);}}}}}function l(i){var j=y();var h1=f(i);var i1=i.getModel();F(j,h1,i1);}function m(i,j,h1){var i1=c.getView().getModel("_templPriv");var j1=i1.getProperty("/generic/controlProperties/"+i);if(!j1){j1={};j1[j]=h1;i1.setProperty("/generic/controlProperties/"+i,j1);}else{i1.setProperty("/generic/controlProperties/"+i+"/"+j,h1);}}function p(i,h1,i1,j1,k1){var l1,m1,n1,o1;var p1=false;if(j1==="com.sap.vocabularies.UI.v1.DataFieldForAction"){l1=h1.getODataFunctionImport(k1);n1=l1&&l1["sap:action-for"];if(n1&&n1!==""&&n1!==" "){if(i1.length>0){o1=l1["sap:applicable-path"];if(o1&&o1!==""&&o1!==" "){for(var j=0;j<i1.length;j++){m1=i.getObject(i1[j].getPath());if(m1&&m1[o1]===true){p1=true;break;}}}else{p1=true;}}}else{p1=true;}}else if(j1==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"&&i1.length>0){p1=true;}return p1;}function u(j,h1,i1,j1){var k1=G(j1);var l1=false;var m1=h1.getODataEntitySet(j1.getEntitySet());if(sap.suite.ui.generic.template.js.AnnotationHelper.areDeleteRestrictionsValid(h1,m1.entityType,k1)){if(i1.length>0){var n1=k1&&k1.Deletable&&k1.Deletable.Path;if(n1){for(var i=0;i<i1.length;i++){if(j.getProperty(n1,i1[i])){l1=true;break;}}}else{l1=true;}}}return l1;}function G(i){var j=i.getModel()&&i.getModel().getMetaModel();var h1=j&&j.getODataEntitySet(i.getEntitySet());var i1=h1&&h1["Org.OData.Capabilities.V1.DeleteRestrictions"];return i1;}function F(i,j,h1){var i1=z(h1);var j1=c.getView().getModel("_templPriv");var k1=j1.getProperty("/generic/listCommons/breakoutActionsEnabled");if(i1){var l1=c.byId("template::IconTabBar");var m1="";if(l1){m1=l1.getSelectedKey();}v(k1,i1,i,j,h1,m1);}j1.setProperty("/generic/listCommons/breakoutActionsEnabled",k1);}function v(i,j,h1,i1,j1,k1){var l1;for(var m1 in j){var n1=j[m1].id;if(k1&&!j[m1].determining){n1=n1.concat("-",k1);}if(q.inArray(n1,h1)!==-1){l1=true;if(j[m1].requiresSelection){if(i1.length>0){if(j[m1].applicablePath!==undefined&&j[m1].applicablePath!==""){l1=false;for(var o1=0;o1<i1.length;o1++){var p1="";var q1=j[m1].applicablePath.split("/");if(q1.length>1){for(var r1=0;r1<q1.length-1;r1++){p1+="/"+q1[r1];}}var s1=j1.getObject(i1[o1].getPath()+p1);var t1=q1[q1.length-1];if(s1[t1]===true){l1=true;break;}}}}else{l1=false;}}i[n1]={enabled:l1};}}}function w(i){var j=[];var h1=q.grep(i.getCustomToolbar().getContent(),function(k1){return k1.getMetadata().getName()==="sap.m.Button";});for(var i1=0;i1<h1.length;i1++){var j1=h1[i1].getId().split("--");j.push(j1[j1.length-1]);}return j;}function x(i){var j=[];var h1=q.grep(i.getToolbar().getContent(),function(k1){return k1.getMetadata().getName()==="sap.m.Button";});for(var i1=0;i1<h1.length;i1++){var j1=h1[i1].getId().split("--");j.push(j1[j1.length-1]);}return j;}function y(){var i=[];var j=[];var h1=c.byId("page");if(h1&&h1.getFooter()){j=q.grep(h1.getFooter().getContent(),function(k1){return k1.getMetadata().getName()==="sap.m.Button";});}for(var i1=0;i1<j.length;i1++){var j1=j[i1].getId().split("--");i.push(j1[j1.length-1]);}return i;}function z(i){var j=c.getOwnerComponent().getAppComponent().getManifestEntry("sap.ui5");var h1=j.extends&&j.extends.extensions&&j.extends.extensions["sap.ui.controllerExtensions"];if(h1){var i1=(h1[c.getOwnerComponent().getTemplateName()]||{})["sap.ui.generic.app"]||{};var j1=i.getMetaModel();var k1=(i1[j1.getODataEntitySet(c.getOwnerComponent().getEntitySet()).name]||{})["Actions"];if(!k1){k1={};var l1=(i1[j1.getODataEntitySet(c.getOwnerComponent().getEntitySet()).name]||{})["Sections"];if(l1){for(var m1 in l1){k1=q.extend(k1,l1[m1]["Actions"]);}}}return k1;}}function E(i){var j=i;while(j){if(j instanceof R||j instanceof U||j instanceof S||j instanceof sap.ui.comp.smartchart.SmartChart){return j;}if(j.getParent){j=j.getParent();}else{return null;}}return null;}function H(i){if(i instanceof S){i=i.getTable();}if(i instanceof U){return i.getBindingInfo("rows");}else if(i instanceof R){return i.getBindingInfo("items");}return null;}function I(i){var j=H(i);if(j&&j.binding){j.binding.refresh();}else{i.rebindTable();}}function K(i,j){var h1=i.getPath();var i1=c.getOwnerComponent();var j1=i1.getComponentContainer().getElementBinding();var k1=j1?j1.getPath():"";var l1=null;if(h1.indexOf(k1)!==0){l1=H(j).path;}var m1=!s.oApplication.isNewHistoryEntryRequired(i,l1);var n1;if(o.isDraftEnabled()){n1=s.oDraftController.isActiveEntity(i)?1:6;}else{n1=i1.getModel("ui").getProperty("/editable")?6:1;}var o1=o.getViewLevel();if(o1===0){var p1=s.oApplication.getForwardNavigationProperty(o1);}if(p1){var q1=new Promise(function(s1){i.getModel().createBindingContext(p1,i,null,function(t1){if(t1){s.oNavigationController.navigateToContext(t1,l1,m1,n1);s1();}else{o.navigateToDataLoadedFailedPage();s1();}});});var r1=s.oApplication.getBusyHelper();r1.setBusy(q1);}else{s.oNavigationController.navigateToContext(i,l1,m1,n1);}}function O(i,j){if(i instanceof C){s.oNavigationController.navigateToContext(i,j&&j.navigationProperty,j&&j.replaceInHistory);return;}var h1=j&&j.routeName;if(h1){o.navigateRoute(h1,i,null,j&&j.replaceInHistory);return;}q.sap.log.warning("navigateToContext called without context or route");}function P(i){if(i instanceof a){if(i.getErrorCode()==="NavigationHandler.isIntentSupported.notSupported"){M.show(e("ST_NAV_ERROR_NOT_AUTHORIZED_DESC"),{title:e("ST_GENERIC_ERROR_TITLE")});}else{M.show(i.getErrorCode(),{title:e("ST_GENERIC_ERROR_TITLE")});}}}function Q(i,j){Z(function(){n=e1();var h1={semanticObject:i.semanticObject,action:i.action};var i1=n.mixAttributesAndSelectionVariant(i.parameters);c.adaptNavigationParameterExtension(i1,h1);n.navigate(i.semanticObject,i.action,i1.toJSONString(),j.getCurrentAppState&&j.getCurrentAppState()||{},P);},q.noop,j,"LeavePage");}function T(h1,i1,c){var j1,k1,l1,m1,n1,o1,p1;var q1={semanticObject:"",action:""};n=e1();for(m1 in h1.semanticAttributesOfSemanticObjects){j1=n.mixAttributesAndSelectionVariant({},i1);for(l1 in h1.semanticAttributesOfSemanticObjects[m1]){if(!j1.getSelectOption(l1)){j1.addParameter(l1,"");}}n1=j1.getPropertyNames();q1.semanticObject=m1;c.adaptNavigationParameterExtension(j1,q1);o1=j1.getSelectOptionsPropertyNames();p1=j1.getParameterNames();for(var i=0,r1=n1.length;i<r1;i++){if(o1.indexOf(n1[i])<0&&p1.indexOf(n1[i])<0){delete h1.semanticAttributesOfSemanticObjects[m1][n1[i]];j1.removeSelectOption(n1[i]);}}if(m1===h1.semanticObject){var s1=h1.semanticAttributesOfSemanticObjects[""];for(var j=0,r1=p1.length;j<r1;j++){if(p1[j]in s1){j1.removeParameter(p1[j]);}else{j1.removeParameter(p1[j]);j1.addParameter(p1[j],h1.semanticAttributesOfSemanticObjects[h1.semanticObject][p1[j]]);}}j1=n.mixAttributesAndSelectionVariant(h1.semanticAttributesOfSemanticObjects[m1],i1);k1=j1.toJSONString();}}delete h1.semanticAttributes;n.processBeforeSmartLinkPopoverOpens(h1,k1);}function V(i,j,h1){if(!i){return e("DRAFT_OBJECT");}else if(j){return e(h1?"LOCKED_OBJECT":"UNSAVED_CHANGES");}else{return"";}}function W(){var i=d("sap.suite.ui.generic.template.fragments.DraftAdminDataPopover",{formatText:function(){var j=Array.prototype.slice.call(arguments,1);var h1=arguments[0];if(!h1){return"";}if(j.length>0&&(j[0]===null||j[0]===undefined||j[0]==="")){if(j.length>3&&(j[3]===null||j[3]===undefined||j[3]==="")){return(j.length>2&&(j[1]===null||j[1]===undefined||j[1]===""))?"":j[2];}else{return e(h1,j[3]);}}else{return e(h1,j[0]);}},closeDraftAdminPopover:function(){i.close();},formatDraftLockText:V},"admin");return i;}function X(i,j,h1,i1,j1,k1){var l1=s.oApplication.getBusyHelper();if(!j1&&l1.isBusy()){return;}if(!o.isDraftEnabled()){var m1=false;if(h1&&h1.aUnsavedDataCheckFunctions){m1=h1.aUnsavedDataCheckFunctions.some(function(q1){return q1();});}var n1=c.getView();var o1=n1.getModel();if(m1||o1.hasPendingChanges()){var p1;_(function(){n1.setBindingContext(null);o1.resetChanges();n1.setBindingContext();o.fire(c,"AfterCancel",{});p1=i();},function(){p1=j();},i1,k1);return p1;}}return i();}function Y(i,j,h1,i1){var j1=false;if(h1&&h1.aUnsavedDataCheckFunctions){j1=h1.aUnsavedDataCheckFunctions.some(function(l1){return l1();});}if(j1||c.getView().getModel().hasPendingChanges()){var k1;b1(function(){c.getView().getModel().resetChanges();o.fire(c,"AfterCancel",{});k1=i();},function(){k1=j();},i1);return k1;}return i();}function Z(i,j,h1,i1,j1,k1){if(j1){return X(i,j,h1,i1,true,k1);}s.oApplication.performAfterSideEffectExecution(X.bind(null,i,j,h1,i1,false,k1));}var $;function _(i,j,h1,i1){var j1;$=i;if(!h1||!i1){var k1=d("sap.suite.ui.generic.template.fragments.DataLoss",{onDataLossOK:function(){k1.close();$();},onDataLossCancel:function(){k1.close();j();}},"dataLoss");if(!h1){h1="LeavePage";}j1=k1.getModel("dataLoss");j1.setProperty("/mode",h1);k1.open();}else{var l1=d("sap.suite.ui.generic.template.fragments.DiscardDraftPopover",{onDiscardConfirm:function(){$();}},"discard");j1=l1.getModel("discard");j1.setProperty("/placement",sap.m.PlacementType.Top);if(h1!=="Proceed"){j1.setProperty("/isCreateDraft",true);}else{j1.setProperty("/isCreateDraft",false);}j1.setProperty("/mode",h1);l1.openBy(i1.getSource());}}var a1;function b1(i,j,h1){a1=i;if(!h1){h1="LeavePage";}var i1=d("sap.suite.ui.generic.template.fragments.DataLossTechnicalError",{onDataLossOK:function(){i1.close();a1();},onDataLossCancel:function(){i1.close();j();}},"dataLoss");var j1=i1.getModel("dataLoss");j1.setProperty("/mode",h1);i1.open();}function c1(i,j,h1,i1,j1,k1){if(j.busy.check&&i1.isBusy()){k1();return;}var l1=j.busy.set?function(){i1.setBusy(Promise.resolve());return i();}:i;var m1=(j.dataloss.popup?Z(l1,k1,h1,(j.dataloss.navigation?"LeavePage":"Proceed"),true):l1());if(m1 instanceof Promise){m1.then(j1,k1);}else{j1();}}function d1(i,j,h1){j=q.extend(true,{busy:{set:true,check:true},dataloss:{popup:true,navigation:false}},j);var i1=s.oApplication.getBusyHelper();var j1=new Promise(function(k1,l1){s.oApplication.performAfterSideEffectExecution(c1.bind(null,i,j,h1,i1,k1,l1));});if(j.busy.set){i1.setBusy(j1);}return j1;}function e1(){n=n||new N(c);return n;}function f1(j,h1){var i1,j1,k1,l1,m1,n1=[],o1=[],i,p1,q1,r1,s1,t1,u1;var v1,w1;i1=c.getOwnerComponent().getAppComponent();j1=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService&&sap.ushell.Container.getService("CrossApplicationNavigation");k1=h1.getProperty("/generic/supportedIntents/");l1=j.getCustomToolbar().getContent();m1=l1.length;for(i=0;i<m1;i++){p1=h(l1[i]);if(p1.hasOwnProperty("SemanticObject")&&p1.hasOwnProperty("Action")){q1=p1.SemanticObject;r1=p1.Action;s1={semanticObject:q1,action:r1,ui5Component:i1};n1.push([s1]);t1=q.extend({},s1);t1.bLinkIsSupported=false;o1.push(t1);}}if(n1.length>0&&!!j1){u1=j1.getLinks(n1);u1.done(function(x1){k1=h1.getProperty("/generic/supportedIntents/");v1=x1.length;for(i=0;i<v1;i++){if(x1[i][0].length>0){o1[i].bLinkIsSupported=true;}q1=o1[i].semanticObject;r1=o1[i].action;w1=h1.getProperty("/generic/supportedIntents/"+q1);if(!w1){k1[q1]={};k1[q1][r1]={"visible":o1[i].bLinkIsSupported};}else if(!w1[r1]){w1[r1]={"visible":o1[i].bLinkIsSupported};}else{w1[r1]["visible"]=o1[i].bLinkIsSupported;}}h1.updateBindings();});}}function g1(h1,i1){var j1=[],k1;var l1=h(h1).variantAnnotationPath;if(!l1&&i1){l1=h(i1).variantAnnotationPath;}if(l1){var m1=h1.getModel();var n1=m1.getMetaModel();var o1=h1.getEntitySet();var p1=n1.getODataEntitySet(o1);var q1=n1.getODataEntityType(p1.entityType);var r1=q1[l1];if(!r1.SelectOptions&&r1.SelectionVariant){r1=r1.SelectionVariant;}if(r1.AnnotationPath){k1=r1.AnnotationPath.split("@")[1];r1=q1[k1];}for(var i in r1.SelectOptions){if(r1.SelectOptions[i].PropertyName){var s1=r1.SelectOptions[i].PropertyName.PropertyPath;for(var j in r1.SelectOptions[i].Ranges){var t1=r1.SelectOptions[i].Ranges[j].Option;t1.EnumMember=t1.EnumMember.replace("com.sap.vocabularies.UI.v1.SelectionRangeOptionType/","");var u1=r1.SelectOptions[i].Ranges[j].Low;var v1=r1.SelectOptions[i].Ranges[j].High;var w1=Object.keys(u1)[0];if(v1){var x1=Object.keys(v1)[0];j1.push(new sap.ui.model.Filter(s1,t1.EnumMember,u1[w1],v1[x1]));}else{j1.push(new sap.ui.model.Filter(s1,t1.EnumMember,u1[w1]));}}}}}return j1;}var e1=t.testable(e1,"getNavigationHandler");var F=t.testable(F,"fillEnabledMapForBreakoutActions");var w=t.testable(w,"getBreakoutActionsForTable");var E=t.testable(E,"getOwnerControl");var f=t.testable(f,"getSelectedContexts");return{getNavigationProperty:g,getText:e,getNavigationHandler:e1,executeGlobalSideEffect:function(){if(o.isDraftEnabled()){var i=c.getView();i.attachBrowserEvent("keyup",function(j){var h1=(j.target.type==="search")?true:false;var i1=(j.target.type==="textarea")?true:false;if(j.keyCode===13&&i.getModel("ui").getProperty("/editable")&&!h1&&!i1){var j1=c.getOwnerComponent().getAppComponent().getConfig();var k1=j1.settings&&j1.settings.forceGlobalRefresh;var l1=s.oApplicationController.executeSideEffects(i.getBindingContext(),null,null,k1);l1.then(setTimeout(function(){document.getElementById(j.target.id).focus();},0));}});}},setEnabledToolbarButtons:k,setEnabledFooterButtons:l,fillEnabledMapForBreakoutActions:F,getBreakoutActionsForTable:w,getBreakoutActionsFromManifest:z,getSelectedContexts:f,getDeleteRestrictions:G,setPrivateModelControlProperty:m,navigateFromListItem:K,navigateToContext:O,navigateExternal:Q,semanticObjectLinkNavigation:T,getSelectionVariantFilters:g1,getCustomData:function(j){var h1=j.getSource().getCustomData();var i1={};for(var i=0;i<h1.length;i++){i1[h1[i].getKey()]=h1[i].getValue();}return i1;},formatDraftLockText:V,showDraftPopover:function(i,j){var h1=W();var i1=h1.getModel("admin");i1.setProperty("/IsActiveEntity",i.getProperty("IsActiveEntity"));i1.setProperty("/HasDraftEntity",i.getProperty("HasDraftEntity"));h1.bindElement({path:i.getPath()+"/DraftAdministrativeData"});if(h1.getBindingContext()){h1.openBy(j);}else{h1.getObjectBinding().attachDataReceived(function(){h1.openBy(j);});}},getContentDensityClass:function(){return s.oApplication.getContentDensityClass();},attachControlToView:A,getDialogFragment:d,processDataLossConfirmationIfNonDraft:Z,processDataLossTechnicalErrorConfirmation:Y,securedExecution:d1,getOwnerControl:E,getTableBindingInfo:H,refreshSmartTable:I,getElementCustomData:h,triggerAction:function(i,j,h1,i1,j1){Z(function(){s.oCRUDManager.callAction({functionImportPath:h1.Action,contexts:i,sourceControl:i1,label:h1.Label,operationGrouping:"",navigationProperty:""}).then(function(k1){if(k1&&k1.length>0){var l1=k1[0];if(l1.response&&l1.response.context&&(!l1.actionContext||l1.actionContext&&l1.response.context.getPath()!==l1.actionContext.getPath())){s.oViewDependencyHelper.setMeToDirty(c.getOwnerComponent(),j);}}});},q.noop,j1,"Proceed");},checkToolbarIntentsSupported:f1};}return B.extend("sap.suite.ui.generic.template.lib.CommonUtils",{constructor:function(c,s,o){q.extend(this,b(c,s,o));}});});
