sap.ui.define(["jquery.sap.global","sap/ui/base/Object"],function(q,B){"use strict";function g(s,c,t){var I;var p;var b;var o=q.noop;var m;var C={};function u(){var M=s.oSmartTable.getModel();var T=s.oSmartTable.getEntitySet();var S=s.oSmartFilterbar.getBasicSearchValue();var i={};if(S!==""){i={"search":S};}for(var k in m){var j=m[k];j.numberOfUpdates++;j.updateStartFunction(j.numberOfUpdates);var F=C.filters.concat(j.selectionVariantFilters);M.read("/"+T+"/$count",{urlParameters:i,filters:F,groupId:"updateMultipleViewSingleTableModeItemCounts",success:j.updateSuccessFunction.bind(null,j.numberOfUpdates),error:j.errorFunction.bind(null,j.numberOfUpdates)});}}function a(E){if(!I){return;}var j=E.getParameter("bindingParams");C.filters=j.filters.slice(0);var k=I.getSelectedKey();var l=m[k];var S=l.selectionVariantFilters;for(var i in S){j.filters.push(S[i]);}}function d(E){if(b){var S=E.getSource();var i=S.getParent();i.setSelectedKey(S.getKey());}var j=s.oIappStateHandler.areDataShownInTable();if(j){s.oSmartTable.rebindTable();t.oCommonUtils.refreshSmartTable(s.oSmartTable);}s.oIappStateHandler.changeIappState(true,j);}function D(){if(!I){return null;}var k=I.getSelectedKey();var i=m[k];return i.templateSortOrder;}function e(){return I&&{selectedKey:I.getSelectedKey()};}function r(i){if(!i||!I||!i.selectedKey){return;}I.setSelectedKey(i.selectedKey);}function f(){return I&&I.getSelectedKey();}function h(i){if(!i){return"";}if(i.state==="error"){return t.oCommonUtils.getText("SEG_BUTTON_ERROR",i.text);}return t.oCommonUtils.getText("SEG_BUTTON_TEXT",[i.text,i.state==="busy"?"...":i.count]);}(function(){var j=c.getOwnerComponent().getAppComponent().getConfig();var S=j&&j.pages[0]&&j.pages[0].component&&j.pages[0].component.settings;var Q=S&&S.quickVariantSelection;if(!Q){return;}if(!Q.variants){throw new Error("Defining QuickVariantSelection without variants in the manifest is not allowed.");}if(S.quickVariantSelectionX){throw new Error("Defining both QuickVariantSelection and QuickVariantSelectionX in the manifest is not allowed.");}I=c.byId("template::VariantSelect");b=!I;I=I||c.byId("template::SegmentedButton");p=I.getItems();q.sap.log.info("This list supports multiple views with single table");var T=t.oComponentUtils.getTemplatePrivateModel();var k=Object.create(null);m=Object.create(null);var l=function(P,v){return function(w,N,x){if(v.numberOfUpdates!==N){return;}var y=q.extend({},T.getProperty(P));y.state=w;if(!w){y.count=x;}T.setProperty(P,y);};};for(var i=0;i<p.length;i++){var n=p[i];var K=n.getKey();var v={selectionVariantFilters:t.oCommonUtils.getSelectionVariantFilters(s.oSmartTable,n),templateSortOrder:t.oCommonUtils.getElementCustomData(n).TemplateSortOrder};m[K]=v;if(Q.showCounts){var U=l("/listReport/multipleViewsSingleTableMode/"+K,v);v.numberOfUpdates=0;v.updateStartFunction=U.bind(null,"busy");v.updateSuccessFunction=U.bind(null,"");v.errorFunction=U.bind(null,"error");k[K]={text:t.oCommonUtils.getElementCustomData(n).text,count:0,state:""};}}if(Q.showCounts){setTimeout(T.setProperty.bind(T,"/listReport/multipleViewsSingleTableMode",k),0);o=u;}})();return{onDataReceived:o,onBeforeRebindTable:a,onAfterVariantChanged:d,determineSortOrder:D,formatItemTextForMultipleView:h,getState:e,restoreState:r,getVariantSelectionKey:f};}return B.extend("sap.suite.ui.generic.template.ListReport.controller.MultipleViewsSingleTableModeHelper",{constructor:function(s,c,t){q.extend(this,g(s,c,t));}});});
