sap.ui.define(["jquery.sap.global","sap/ui/base/Object","sap/f/FlexibleColumnLayoutSemanticHelper","sap/f/LayoutType"],function(q,B,F,L){"use strict";function o(i){sap.ui.require(["sap/suite/ui/generic/template/lib/routingHelper"],i);}var r=Promise.resolve();var d=2;var c=["begin","mid","end"];var m=["messagePageBeginColumn","messagePageMidColumn","messagePageEndColumn"];var O=null;function t(v){return c[v]?v:d;}function a(v){return t(v)===v;}function g(v){return c[t(v)]+"ColumnPages";}function b(C){for(var i=0;i<c.length;i++){C(m[i],g(i));}}function e(v){return m[t(v)];}function f(v){return c[t(v)];}function h(R){return R.name.length>5&&R.name.lastIndexOf("query")===R.name.length-"query".length;}function l(T){var i;if(T instanceof sap.ui.table.Table){i=T.getRows();}else if(T instanceof sap.m.Table){i=T.getItems();}return i;}function n(T){var i=l(T);var R=i?i[0]:false;return R;}function p(T,C){var I=l(T);for(var i=0;i<I.length;i++){if(I[i].getBindingContextPath()===C){return I[i];}}}function s(u,N){var M=N.oTemplateContract.oAppComponent.getConfig();var v=M.settings&&M.settings.flexibleColumnLayout;var w=F.getInstanceFor(u,v);var D=w.getDefaultLayouts();var R;var x;var U;var C;var S;var y=-1;var E;var T=N.oTemplateContract,z=N.oRouter;var A=v&&v.maxColumnCountInFCL||3;var G=v&&v.initialColumnsCount&&v.initialColumnsCount===2||false;var H=v&&v.displayNextObjectAfterDelete&&v.displayNextObjectAfterDelete===true;function I(i){if(i>=A||sap.ui.Device.system.phone){return 1;}else{var j=v&&v.initialColumnsCount||1;var k=Math.max(i+1,j);if(sap.ui.Device.system.tablet&&k>2){k=2;}return k;}}function J(i,j,k){i.showBeginColumn=i.viewLevel<3;i.showMidColumn=i.viewLevel===0&&G||i.viewLevel===1||i.viewLevel===2;i.showEndColumn=i.viewLevel>1;var I1=I(i.viewLevel);if(G&&i.viewLevel===0){if(I1===1){i.target=[i.name];i.showMidColumn=false;}else{i.target=[i.name,i.pages[0].entitySet];}}else if(G&&i.viewLevel===1){if(I1===1){i.target=[i.name];i.showBeginColumn=false;}else{i.target=k;}}else{i.target=i.showMidColumn?k.concat([j]):j;}return g(i.viewLevel);}function K(i){if(i==="OneColumn"&&G){return false;}return i===D.defaultLayoutType||i===D.defaultTwoColumnLayoutType||i===D.defaultThreeColumnLayoutType;}function P(i,j,k){var I1=T.mRouteToTemplateComponentPromise[k];if(I1){return I1.then(function(J1){return N.activateOneComponent(j,i,J1);});}return r;}function Q(i){var j=i.substring(i.length-5,i.length);if(j==="query"){return i.substring(0,i.length-5);}return i;}function V(i){return Promise.all(i).then(N.afterActivation);}function W(i,j){var k=K(i);if(x&&h(x)){x.arguments.query=x.arguments["?query"];if(k){delete x.arguments.query.FCLLayout;if(q.isEmptyObject(x.arguments.query)){delete x.arguments.query;x.name=Q(x.name);}}else{x.arguments.query.FCLLayout=i;}}else if(!k){x.name=x.name+"query";x.arguments.query={FCLLayout:i};}var I1=z.getURL(x.name,x.arguments);I1=I1.replace("/?","?");N.navigate(I1,j);}function X(i,j){return new Promise(function(k){o(function(I1){k(I1.determinePath(i,j,T.routeViewLevel1.pattern));});});}function Y(){var i=function(j,k){var I1={};if(!x){k();return;}var J1=x.event.getParameter("config").viewLevel;if(J1<3){I1.begin={route:"root",path:"",isVisible:U.columnsVisibility.beginColumn};if(J1===0){j(I1);return;}}var K1=Q(x.name);if(J1>0){var L1=f(J1);I1[L1]={route:K1,path:x.path,isVisible:J1>2||(J1===1&&U.columnsVisibility.midColumn)||(J1===2&&U.columnsVisibility.endColumn)};}if(J1===2){X(x.routeConfig,x.event).then(function(M1){I1.mid={route:T.routeViewLevel1.name,path:M1,isVisible:U.columnsVisibility.midColumn};j(I1);});}else{j(I1);}};return new Promise(i);}function Z(i){var j=Y();j.then(function(k){var I1=[];var J1=[k.begin,k.mid,k.end];var K1=N.performPseudoHashChange(J1);for(var L1 in i){if(i[L1]){var M1=k[L1];if(M1){I1.push(P(K1,M1.path,M1.route));}}}V(I1);},q.noop);}function $(){return!(U.columnsVisibility.beginColumn?U.columnsVisibility.midColumn:U.columnsVisibility.midColumn&&U.columnsVisibility.endColumn);}function _(i){var j=w.getCurrentUIState();var k={};k.end=U&&(U.columnsVisibility.endColumn!==j.columnsVisibility.endColumn);k.mid=U&&(U.columnsVisibility.midColumn!==j.columnsVisibility.midColumn);k.begin=U&&(U.columnsVisibility.beginColumn!==j.columnsVisibility.beginColumn);U=j;T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/midActionButtons",{fullScreen:U.actionButtonsInfo.midColumn.fullScreen!==null,exitFullScreen:U.actionButtonsInfo.midColumn.exitFullScreen!==null,closeColumn:U.actionButtonsInfo.midColumn.closeColumn!==null});T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/endActionButtons",{fullScreen:U.actionButtonsInfo.endColumn.fullScreen!==null,exitFullScreen:U.actionButtonsInfo.endColumn.exitFullScreen!==null,closeColumn:U.actionButtonsInfo.endColumn.closeColumn!==null});T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/isVisuallyFullScreen",$());var I1;if(U.columnsVisibility.endColumn){I1=T.oTemplatePrivateGlobalModel.getProperty("/generic/routeLevel");}else if(U.columnsVisibility.midColumn){I1=1;}else{I1=0;}T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/highestViewLevel",I1);var J1;if(U.columnsVisibility.midColumn){J1=1;}else{J1=T.oTemplatePrivateGlobalModel.getProperty("/generic/routeLevel");}T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/lowestDetailViewLevel",J1);if(x&&C!==U.layout){W(U.layout,true);}else if((k.begin||k.mid||k.end)&&!i){Z(k);}}function a1(i,j,k,I1){return new Promise(function(J1){_(true);var K1=Y();K1.then(function(L1){E=L1;var M1=[];for(var N1 in L1){var O1=L1[N1];if(O1.isVisible){M1.push(P(I1,O1.path,O1.route));}}V(M1).then(J1);});});}function b1(i){i=q.extend({},i);x={name:i.getParameter("name"),arguments:i.getParameter("arguments"),event:i};var j=i.getParameter("config").viewLevel;var k=i.getParameter("arguments")["?query"];if(a(j)){C=(k&&k.FCLLayout);if(!C){switch(j){case 0:var I1=w.getNextUIState(0).columnsVisibility;if(I1.midColumn){C=D.defaultTwoColumnLayoutType;}else{C=D.defaultLayoutType;if(I(j)>1){W(D.defaultLayoutType,true);}}break;case 1:C=D.defaultTwoColumnLayoutType;break;case 2:C=D.defaultThreeColumnLayoutType;}}}else{C=L.EndColumnFullScreen;}u.setLayout(C);}function c1(i,j,k,I1){y=-1;var J1=T.oTemplatePrivateGlobalModel.getProperty("/generic/routeLevel");R=J1===2?i:null;x.path=k;x.routeConfig=j;return a1(i,j,k,I1);}function d1(i){return K(i)?{}:{FCLLayout:[i]};}function e1(i){return i===L.EndColumnFullScreen||i===L.MidColumnFullScreen;}function f1(i,j){if(!a(i)){return N.getParStringPromise(j,false);}var k=S||w.getNextUIState(i).layout;q.extend(j,d1(k));S=null;if(e1(k)){return N.getParStringPromise(j,false);}var I1=(i===2)?N.addUrlParameterInfoForRoute(T.routeViewLevel1.name,j):r;return new Promise(function(J1){I1.then(function(){N.getParStringPromise(j,true).then(J1);});});}function g1(){S=U.actionButtonsInfo.midColumn.closeColumn;N.navigateToRoot(true);}function h1(){S=U.actionButtonsInfo.endColumn.closeColumn;var i=R.getParameter("config");X(i,R).then(function(j){N.navigateToContext(j,null,true,0);});}function i1(i,j){var k=N.oHashChanger.getHash()||"";k=k.split("?")[0];var I1=N.getParStringPromise(i,j);N.navigateToParStringPromise(k,I1,false);}function j1(i){if(i===0&&A1()){return L.OneColumn;}else if(i===1){return L.MidColumnFullScreen;}else if(i===2){return L.EndColumnFullScreen;}else{return"";}}function k1(){var j=U.actionButtonsInfo.midColumn.fullScreen;var k;if(j===null){j=U.actionButtonsInfo.endColumn.fullScreen;var I1=N.getActiveComponents();for(var i=0;i<I1.length;i++){var J1=T.componentRegistry[I1[i]];if(J1.viewLevel===2){k=J1.route;break;}}}else{k=T.routeViewLevel1.name;}var K1=d1(j);N.addUrlParameterInfoForRoute(k,K1).then(function(){i1(K1,false);});}function l1(){var i=U.actionButtonsInfo.midColumn.exitFullScreen;var j;var k;if(i===null){i=U.actionButtonsInfo.endColumn.exitFullScreen;}var I1=d1(i);if(i===U.actionButtonsInfo.endColumn.exitFullScreen){var J1=N.getActiveComponents();var K1=J1[0];var L1=T.componentRegistry[K1];if(L1){j=N.addUrlParameterInfoForRoute(L1.route,I1);k=X(x.routeConfig,x.event);}}(j||r).then(function(){(k||r).then(function(M1){var N1=N.addUrlParameterInfoForRoute(T.routeViewLevel1.name,I1,M1);N1.then(function(){i1(I1,true);});});});}function m1(i){return a(i)&&{onCloseColumnPressed:i===1?g1:h1,onFullscreenColumnPressed:k1,onExitFullscreenColumnPressed:l1};}function n1(i){return T.oApplicationProxy.getDraftSiblingPromise(i);}function o1(i){if(T.oTemplatePrivateGlobalModel.getProperty("/generic/FCL/highestViewLevel")===2){var j=R.getParameter("config");var k=T.mRouteToTemplateComponentPromise[Q(j.name)];var I1=new Promise(function(J1,K1){k.then(function(L1){var M1=L1.getBindingContext();var N1=n1(M1,true);N1.then(function(O1){o(function(P1){var Q1=j.navigationProperty;var R1=i.getPath()+"/"+P1.determineNavigationPath(O1,Q1).path;S=U.layout;N.navigateToContext(R1,null,true,2);J1();});},K1);},K1);});T.oBusyHelper.setBusy(I1);}else{N.navigateToContext(i,null,true,2);}}function p1(i){if(T.oTemplatePrivateGlobalModel.getProperty("/generic/FCL/highestViewLevel")!==2){return Promise.resolve(i);}var j=new Promise(function(k){var I1=R.getParameter("config");var J1=T.mRouteToTemplateComponentPromise[Q(I1.name)];J1.then(function(K1){var L1=K1.getBindingContext();var M1=n1(L1,true);M1.then(function(N1){if(!N1){k(i);return;}o(function(O1){var P1=I1.navigationProperty;var Q1=i.getPath()+"/"+O1.determineNavigationPath(N1,P1).path;k(Q1);});});});});T.oBusyHelper.setBusy(j);return j;}function q1(i,j){var k=E.mid&&i.indexOf(E.mid.path)>=0&&!H;var I1=E.end&&i.indexOf(E.end.path)>=0;if(k){N.navigateToRoot(true);}else if(I1){N.navigateToContext(E.mid.path,null,true);}}T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL",{});function r1(i){var j=N.getTargetLevel(i);switch(j){case 1:return!U.columnsVisibility.midColumn;case 2:return!U.columnsVisibility.endColumn;default:return true;}}function s1(i){C=w.getNextUIState(i).layout;u.setLayout(C);}function t1(){return!$();}function u1(j){y=t(j.viewLevel);s1(j.viewLevel);var k=N.oRouter.getTargets();var I1=e(j.viewLevel);k.display(I1);var J1;if(j.viewLevel===y){J1=[];for(var i=0;i<j.viewLevel;i++){J1.push(true);}}return J1;}function v1(i){if(i<y||y<0){return U.columnsVisibility[f(i)+"Column"];}return false;}function w1(i,j){if(!a(j)){return i;}var k=w.getNextUIState(j).layout;if(K(k)){return i;}return i+"?FCLLayout="+k;}function x1(){return A;}function y1(j,k,I1){var J1;var K1=F1();if(B1()&&K1&&K1.length>0&&!$()){for(var i=0;i<K1.length;i++){J1=p(j,K1[i]);if(J1&&J1.getBindingContextPath()===K1[i]){G1();I1.oCommonEventHandlers.onListNavigate(J1,k);break;}}}else{J1=n(j);T.oApplicationProxy.setListReportTable(j);if(A1&&A1()){z1(J1,function(){setTimeout(function(){I1.oCommonEventHandlers.onListNavigate(J1,k);},0);});}}}function z1(i,j){if(!G){return;}var k=false;var I1=w.getNextUIState(0).columnsVisibility;if(I1.midColumn){var J1=x.event.getParameter("config").viewLevel;if(J1===0){k=true;if(h(x)){x.arguments.query=x.arguments["?query"];if(x.arguments.query.FCLLayout==="OneColumn"){k=false;}}}}if(k){if(i){j(i);}else{N.navigateToRoot(true);}}else{return;}}function A1(){return G;}function B1(){return H;}function C1(){var i=x.event.getParameter("config").viewLevel;return i===1&&H&&!$();}function D1(){S=L.OneColumn;}function E1(i,I1){O=[];var J1;var K1=[];var L1;var M1;if(i instanceof sap.ui.table.Table){M1=i.getRows();}else if(i instanceof sap.m.Table){M1=i.getItems();}for(var k=0;k<M1.length;k++){L1=M1[k].getBindingContextPath();K1.push(L1);}for(var j=0;j<K1.length;j++){if(K1[j]===I1){O.push(K1[j]);J1=j;break;}}if(J1>=0){var N1=K1.slice(J1+1,K1.length);var O1;if(J1>0){O1=K1.slice(0,J1);O1.reverse();}O=O.concat(N1,O1);}else{O=K1;}}function F1(){return O;}function G1(){O=null;}function H1(i){return{oActionButtonHandlers:m1(i),navigateToDraft:o1,getMaxColumnCountInFCL:x1,isListAndFirstEntryLoadedOnStartup:A1,isNextObjectLoadedAfterDelete:B1,handleListReceived:z1,storeTableToShowObjectPageAfterDelete:E1,getOrderToShowObjectPageAfterDelete:F1,resetOrderToShowObjectPageAfterDelete:G1,supressNavigationUpAfterDeletion:C1,handleDataReceived:y1};}u.attachStateChange(_.bind(null,false));return{adaptRoutingInfo:J,createMessagePageTargets:b,displayMessagePage:u1,isLevelActive:v1,handleBeforeRouteMatched:b1,handleRouteMatched:c1,getAppStateParStringForNavigation:f1,getActionButtonHandlers:m1,navigateToDraft:o1,getTargetAfterCancelPromise:p1,adaptAfterDeletion:q1,isNewHistoryEntryRequired:r1,adaptBreadCrumbUrl:w1,isAppTitlePrefered:t1,getFullscreenLayout:j1,getMaxColumnCountInFCL:x1,isListAndFirstEntryLoadedOnStartup:A1,isNextObjectLoadedAfterDelete:B1,getFclProxyForView:H1,setStoredTargetLayoutToOneColumn:D1};}return B.extend("sap.suite.ui.generic.template.lib.FlexibleColumnLayoutHandler",{constructor:function(i,N){q.extend(this,s(i,N));}});});
