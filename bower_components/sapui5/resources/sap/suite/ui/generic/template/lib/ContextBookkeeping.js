sap.ui.define(["jquery.sap.global","sap/ui/base/Object"],function(q,B){"use strict";function g(a){var p={};function c(C){var D=a.getTransactionController().getDraftController();var o=D.getDraftContext();var i=C.getObject();var I=o.hasDraft(C);var n=I&&!i.IsActiveEntity;var s=n&&!i.HasActiveEntity;return{bIsDraft:n,bIsDraftSupported:I,bIsCreate:s};}function r(C){var P=C.getPath();var o=c(C);p[P]={oContextInfo:o,oContext:C};return o;}function b(C){var P=C.getPath();var R=p[P];if(!R){r(C);R=p[P];}return R;}function d(C,R,i){var o=b(C);if(!o.oContextInfo.bIsCreate||!i){o.oRemovalPromise=R;}R.then(function(n){if(!o.oContextInfo.bIsCreate||!i){var D=n.context.getPath();var s=p[D];if(s){delete s.oEditingPromise;}}o.oContext=null;},function(){delete o.oRemovalPromise;});}function e(C,o){d(C,o,false);}function f(C,o){d(C,o,true);}function h(C,E){var o=b(C);o.oEditingPromise=new Promise(function(R,i){var n=function(){delete o.oEditingPromise;i();};E.then(function(s){if(s.draftAdministrativeData){n();}else{R(s);}},n);});o.oEditingPromise.catch(q.noop);}function A(P){var C=p[P];if(C){C.oContext=null;}}function j(D){for(var i=0;i<D.length;i++){A(D[i]);}}function k(M,P){return new Promise(function(R,i){M.read(P+"/SiblingEntity",{success:function(o){var n=M.getContext("/"+M.getKey(o));R(n);},error:function(E){i(E);}});});}function l(C){var o=b(C);if(o.oContextInfo.bIsCreate){return Promise.resolve();}var s=o.oSiblingPromise;if(!s){s=o.oContextInfo.bIsDraftSupported?k(C.getModel(),C.getPath()):Promise.resolve(C);if(o.oContextInfo.bIsDraft||!o.oContextInfo.bIsDraftSupported){o.oSiblingPromise=s;}}return s;}function m(P){var C=p[P];if(!C){return Promise.resolve();}return new Promise(function(R){var o=null;var i=function(){R(o);};var H=function(E){E.then(function(n){var s=n.context.getPath();var t=p[s];if(!t||t.oContext){o={context:n.context,iDisplayMode:2};}i();},i);};if(C.oRemovalPromise){C.oRemovalPromise.then(function(n){o={context:n.context,iDisplayMode:1};var D=n.context.getPath();var s=p[D];var E=s&&s.oEditingPromise;if(E){H(E);}else{i();}},i);}else if(C.oEditingPromise){H(C.oEditingPromise);}else{i();}});}return{registerContext:r,adaptAfterDeletion:j,activationStarted:e,cancellationStarted:f,editingStarted:h,getDraftSiblingPromise:l,getAlternativeContextPromise:m};}return B.extend("sap.suite.ui.generic.template.lib.ContextBookkeeping",{constructor:function(a){q.extend(this,g(a));}});});
