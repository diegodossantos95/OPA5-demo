sap.ui.define(["jquery.sap.global","sap/ui/base/Object","sap/m/MessagePopover","sap/m/MessagePopoverItem","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/suite/ui/generic/template/lib/testableHelper"],function(q,B,M,a,F,b,t){"use strict";F=t.observableConstructor(F,true);var p=new F({path:"persistent",operator:b.EQ,value1:false});var v=new F({path:"validation",operator:b.EQ,value1:true});var I=new F({path:"validation",operator:b.EQ,value1:"bla"});function g(c,C,d){var m;var s;var o=C.byId("showMessages");var e=c.getDialogFragment("sap.suite.ui.generic.template.fragments.MessagePopover");e.setModel(sap.ui.getCore().getMessageManager().getMessageModel(),"msg");var f;var E;(function(){var i=C.getOwnerComponent();E=new F({path:"target",operator:b.EQ,value1:"/"+i.getEntitySet()});f=e.getBinding("items");var T=i.getModel("_templPriv");T.setProperty("/generic/messageCount",0);var L=c.getText("MESSAGE_BUTTON_TOOLTIP_P",0);T.setProperty("/generic/messageButtonTooltip",L);f.attachChange(function(){var N=f.getLength();T.setProperty("/generic/messageCount",N);L=c.getText(N===1?"MESSAGE_BUTTON_TOOLTIP_S":"MESSAGE_BUTTON_TOOLTIP_P",N);T.setProperty("/generic/messageButtonTooltip",L);});})();var h=[];var j;var k=0;var n;var l;function r(L){if(q.isArray(L)){var N=false;for(var i=0;i<L.length;i++){N=r(L[i])||N;}return N;}if(L instanceof Promise){L.then(n);return false;}l.push(L);return true;}function u(){var L=l;if(s){for(var i=0;i<s.length;i++){L=L.concat(s[i].filters);}}return L;}function A(){var i=u();if(m){m.propagateFilters(i);}else if(s){var L=new F(i.concat(v),false);var N=[L,p];f.filter(N);}}function R(i,L){if(i===k&&r(L)){A();}}function w(i){var L=i();return r(L);}function x(){h.forEach(w);}function y(i){j=i;k++;n=R.bind(null,k);l=d?[new F({path:"target",operator:b.StartsWith,value1:j}),E]:[];x();A();}function z(i){h.push(i);if(j!==undefined&&w(i)){A();}}var S;function D(){if(m){m.showMessagePopover();return;}if(s){S=S||function(){if(f.getLength()>0){e.openBy(o);}};setTimeout(S,0);}}function G(){m=null;if(s){for(var i=0;i<s.length;i++){s[i].free();}s=null;l=null;f.filter(I);}}function P(i,L){if(s){s[i].filters=L;if(l){A();}}}function H(L){s=[];for(var i=0;i<L.length;i++){var N={showMessagePopover:D,propagateFilters:P.bind(null,i)};var O=L[i].serve(N);s.push(O);}if(l){A();}}function J(){m=null;}function K(i){m=i;f.filter(I);return{filters:l?u():[],free:J};}return{adaptToContext:y,toggleMessagePopover:e.toggle.bind(e,o),showMessagePopover:D,registerMessageFilterProvider:z,suspend:G,resume:H,serve:K};}return B.extend("sap.suite.ui.generic.template.lib.MessageButtonHelper",{constructor:function(c,C,i){q.extend(this,(t.testableStatic(g,"MessageButtonHelper"))(c,C,i));}});});
