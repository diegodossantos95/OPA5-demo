sap.ui.define(["jquery.sap.global","sap/ui/core/Fragment","sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/thirdparty/d3","sap/suite/ui/generic/template/AnalyticalListPage/util/KpiUtil","sap/suite/ui/generic/template/AnalyticalListPage/util/V4Terms"],function(q,F,C,J,D,K,V){"use strict";q.sap.require("sap.suite.ui.generic.template.AnalyticalListPage.util.KpiAnnotationFormatter");var n,s;var c=C.extend("sap.suite.ui.generic.template.AnalyticalListPage.controller.KpiCardController",{onInit:function(e){q.sap.require("sap.ovp.cards.CommonUtils");},onExit:function(){},onBeforeRendering:function(){var o=sap.ovp.cards.CommonUtils;var d,S;var v=this.getView();var a=v.data("qualifierSettings");var Q=a.qualifier;var m=v.getModel();var M=m.getMetaModel();var e=M.getODataEntitySet(a.entitySet);var E=M.getODataEntityType(e.entityType);var b="kpiCard"+Q;var f={"cards":{}};S=V.SelectionPresentationVariant+(Q?"#"+Q:"");var p=E[S].PresentationVariant&&E[S].PresentationVariant.Path;if(!p){q.sap.log.error("PresentationVariant does not have Path.");return;}var g=E[p.split("@")[1]].Visualizations;g.forEach(function(A){if(A.AnnotationPath.indexOf("DataPoint")>0){d=A.AnnotationPath.split("@")[1];}});f["cards"][b]={"model":a.model,"template":"sap.ovp.cards.charts.analytical","settings":{"entitySet":a.entitySet,"selectionPresentationAnnotationPath":S,"dataPointAnnotationPath":d,"navigation":"chartNav"}};o.createCardComponent(v,f,"template::ALPcardContainer");o.onHeaderClicked=function(h){var N=v.getModel("detailNavigation");this.handleNavigationPress(N);}.bind(this);},handleNavigationPress:function(N){if(N){var t=N.getProperty("/target");var a=N.getProperty("/action");var p=N.getProperty("/parameters");if(t&&a){if(!n){n=s.getNavigationHandler();}n.navigate(t,a,JSON.parse(p),null,function(e){if(e instanceof sap.ui.generic.app.navigation.service.NavError){if(e.getErrorCode()==="NavigationHandler.isIntentSupported.notSupported"){sap.m.MessageBox.show(s.getText("ST_NAV_ERROR_NOT_AUTHORIZED_DESC"),{title:s.getText("ST_GENERIC_ERROR_TITLE")});}else{sap.m.MessageBox.show(e.getErrorCode(),{title:s.getText("ST_GENERIC_ERROR_TITLE")});}}});}}},_assignCommonUtils:function(o){s=o;n=s.getNavigationHandler();}});return c;});
