sap.ui.define(["sap/m/Button","sap/m/ButtonType","sap/m/Label","sap/m/Dialog","sap/m/Bar","sap/m/SearchField","sap/m/Toolbar","sap/m/ToolbarSpacer","sap/m/Title","sap/m/VBox","sap/m/HBox","sap/m/CheckBox","sap/m/Link","sap/m/List","sap/m/TextArea","sap/m/Text","sap/m/StandardListItem","sap/m/ListSeparators","sap/m/Popover","sap/ui/layout/form/SimpleForm","sap/ui/layout/GridData","sap/ui/core/mvc/Controller","sap/suite/ui/generic/template/AnalyticalListPage/util/FilterUtil","sap/m/SegmentedButton","sap/m/SegmentedButtonItem","sap/suite/ui/generic/template/AnalyticalListPage/util/V4Terms"],function(B,a,L,D,b,S,T,c,d,V,H,C,e,f,g,h,j,k,P,l,G,m,F,n,o,p){"use strict";var q="_BASIC";var r="100%";var s=0.33;var t=0.5;var v=m.extend("sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController",{init:function(i){this.oState=i;this.oRb=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");this.bIsTimeBasedLine;this.bSortOrder;},_createForm:function(){this.sJsonModel=this.oState.alr_visualFilterBar.getModel('_visualFilterConfigModel').getJSON();this.oConfig=JSON.parse(this.sJsonModel);this._filterModified=false;this.filterCompList=[];this.filterChartList=[];this._buildFiltersFromConfig();this.oVerticalBox=new V();this.oVerticalBox.setModel(this.oState.oController.getView().getModel("_templPriv"),"_templPriv");this.oVerticalBox.setModel(this.oState.oController.getView().getModel());this.oVerticalBox.setModel(this.oState.oController.getView().getModel("i18n"),"i18n");this.oVerticalBox.setModel(this.oState.oController.getOwnerComponent().getModel("_filter"),"_filter");this.oVerticalBox.setModel(this.oState.alr_visualFilterBar.getModel('_visualFilterConfigModel'),"_visualFilterConfigModel");this._addFilterSwitch();this._addGroupsAndFilters();return this.oVerticalBox;},_toggle:function(){var i=this.oState.oSmartFilterbar.getFilterDialogContent();if(i&&(i.length===2)){if(i[0].getVisible()){i[0].setVisible(false);i[1].setVisible(true);}else{i[0].setVisible(true);i[1].setVisible(false);}}},_addFilterSwitch:function(){var i=[new sap.m.SegmentedButtonItem({icon:"sap-icon://filter-fields",width:"inherit",key:"compact",tooltip:"{i18n>FILTER_COMPACT}"}),new sap.m.SegmentedButtonItem({icon:"sap-icon://filter-analytics",width:"inherit",key:"visual",tooltip:"{i18n>FILTER_VISUAL}"})];var u=new n({width:"inherit",selectedKey:"visual",items:i});u.attachSelect(function(E){var x=E.getSource();x.setSelectedKey("visual");this._toggle();}.bind(this));var w=new sap.m.OverflowToolbar({design:sap.m.ToolbarDesign.Transparent,content:[new sap.m.ToolbarSpacer(),u]}).addStyleClass("sapSmartTemplatesAnalyticalListPageFilterDialogToolbar");this.oVerticalBox.addItem(w);},_searchDialog:function(){this.oState.alr_visualFilterBar._setVariantModified();},_restoreDialog:function(){this.oState.alr_visualFilterBar.getModel('_visualFilterConfigModel').setData(JSON.parse(this.sJsonModel));this.oConfig=JSON.parse(this.sJsonModel);this._reloadForm();this._filterModified=false;},_cancelDialog:function(){if(this._filterModified){var i=this.oState.alr_visualFilterBar.getModel('_visualFilterConfigModel');i.setData(JSON.parse(this.sJsonModel));this.oState.alr_visualFilterBar.updateVisualFilterBindings(true);}},_buildFiltersFromConfig:function(){var i;this.filterCompList=[];this.filterChartList=[];for(i=0;i<this.oConfig.filterCompList.length;i++){var u=this.oConfig.filterCompList[i].component.properties.sortOrder;if(u.constructor===Object&&u.value){this.oConfig.filterCompList[i].component.properties.sortOrder=u.value;}this.filterCompList.push({obj:{shownInFilterBar:this.oConfig.filterCompList[i].shownInFilterBar,shownInFilterDialog:this.oConfig.filterCompList[i].shownInFilterDialog,cellHeight:this.oConfig.filterCompList[i].cellHeight,component:{type:this.oConfig.filterCompList[i].component.type,cellHeight:this.oConfig.filterCompList[i].component.cellHeight},group:{label:this.oConfig.filterCompList[i].group.label,name:this.oConfig.filterCompList[i].group.name}},searchVisible:this.oConfig.filterCompList[i].searchVisible===undefined||this.oConfig.filterCompList[i].searchVisible});}},_rebuildConfig:function(){var i;var u={filterCompList:[]};for(i=0;i<this.filterCompList.length;i++){u.filterCompList.push({shownInFilterBar:this.filterCompList[i].obj.shownInFilterBar&&this.filterCompList[i].obj.shownInFilterDialog,shownInFilterDialog:this.filterCompList[i].obj.shownInFilterDialog,cellHeight:this.filterCompList[i].obj.cellHeight,group:{label:this.filterCompList[i].obj.group.label,name:this.filterCompList[i].obj.group.name},component:{type:this.filterCompList[i].obj.component.type,cellHeight:this.filterCompList[i].obj.component.cellHeight,properties:{scaleFactor:this.filterChartList[i].getScaleFactor(),numberOfFractionalDigits:this.filterChartList[i].getNumberOfFractionalDigits(),sortOrder:this.filterChartList[i].getSortOrder(),filterRestriction:this.oConfig.filterCompList[i].component.properties.filterRestriction,entitySet:this.filterChartList[i].getEntitySet(),width:this.oConfig.filterCompList[i].component.properties.width,height:this.oConfig.filterCompList[i].component.properties.height,dimensionField:this.filterChartList[i].getDimensionField(),dimensionFieldDisplay:this.filterChartList[i].getDimensionFieldDisplay(),dimensionFieldIsDateTime:this.filterChartList[i].getDimensionFieldIsDateTime(),dimensionFilter:this.filterChartList[i].getDimensionFilter(),unitField:this.filterChartList[i].getUnitField(),isCurrency:this.filterChartList[i].getIsCurrency(),isMandatory:this.oConfig.filterCompList[i].component.properties.isMandatory,measureField:this.filterChartList[i].getMeasureField(),outParameter:this.oConfig.filterCompList[i].component.properties.outParameter,inParameters:this.oConfig.filterCompList[i].component.properties.inParameters,parentProperty:this.oConfig.filterCompList[i].component.properties.parentProperty,chartQualifier:this.oConfig.filterCompList[i].component.properties.chartQualifier}}});}return u;},_reloadForm:function(){this.oVerticalBox.destroyItems();this._buildFiltersFromConfig();this._addFilterSwitch();this._addGroupsAndFilters();},_addGroupsAndFilters:function(){var i;var u;var w;var x=[];var y=0;for(i=0;i<this.filterCompList.length;i++){if(!Array.isArray(this.filterCompList[i])){if(this.filterCompList[i].searchVisible===false){continue;}if(!(x.indexOf(this.filterCompList[i].obj.group.name)>-1)){if(w){this.oVerticalBox.addItem(w);}u=this.filterCompList[i].obj.group.name;x.push(u);w=new V();w.setWidth("100%");w.setLayoutData(new G({span:"L12 M12 S12"}));w.addStyleClass("sapUiSmallMarginTop");y++;this._addGroupToolbar(w,this.filterCompList[i].obj.group.label,this.filterCompList[i].obj.group.name);}if(this.filterCompList[i].obj.shownInFilterDialog){this.filterCompList[i].toolbar=this._addChartCustomToolbar(this.oConfig.filterCompList[i],i);this.filterCompList[i].overlay=this._addChartOverlay(this.oConfig.filterCompList[i],i);this.filterChartList[i]=this._addChart(this.oConfig.filterCompList[i].component.type,this.oConfig.filterCompList[i].component.properties,i);var z=this,A=this.filterChartList[i].getParentProperty().replace(/[^\w]/gi,'')+"checkBox";var E=new H({items:[new V({items:[z.filterCompList[i].toolbar,z.filterCompList[i].overlay,z.filterChartList[i]]}).setWidth("100%").addStyleClass("sapUiSmallMarginEnd"),new V({items:[new L({text:"{i18n>SHOW_ON_FILTER_BAR}",labelFor:A}).addStyleClass("sapUiTinyMarginTop"),new C({id:A,text:"",selected:z.oConfig.filterCompList[i].shownInFilterBar}).data("idx",i).attachSelect(null,z._onCheckBoxSelect,z)]}).setAlignItems("Center")]}).addStyleClass("sapUiSmallMarginTop").setWidth("100%");w.addItem(E);}}if(w){this.oVerticalBox.addItem(w);}}if(y==1&&u===q){F.executeFunction(w,"mAggregations.items.0.setVisible",[false]);}},_onCheckBoxSelect:function(E){var i=E.getSource().data("idx");this.selectCheckBox(i,E.getSource().getSelected());},_addGroupToolbar:function(i,u,w){var x=new d({text:u});var y=new T({content:[x,new c()]});if(w!=q){y.addContent(this._createMoreFiltersLink(w,x));}i.addItem(y);},selectCheckBox:function(i,u){this._filterModified=true;var w=this.oState.alr_visualFilterBar.getModel('_visualFilterConfigModel'),x=jQuery.extend(true,{},w);x.setProperty('/filterCompList/'+i+'/shownInFilterBar',u);w.setData(x.getData());this.oConfig=JSON.parse(w.getJSON());this.oState.alr_visualFilterBar.updateVisualFilterBindings(true);this.oState.oSmartFilterbar._oVariantManagement.currentVariantSetModified(true);},_addChartOverlay:function(i,u){var w=new V({width:"100%",height:i.component.properties.height,items:[new sap.m.Label({text:{path:'_visualFilterConfigModel>/filterCompList/'+u+'/overlayMessage',formatter:function(O){return this.getModel("i18n").getResourceBundle().getText(O);}}})],visible:{path:'_visualFilterConfigModel>/filterCompList/'+u+'/showChartOverlay',formatter:function(x){return x;}}});w.addStyleClass("sapUiOverlay");w.addStyleClass("sapSmartTemplatesAnalyticalListPageVFOverflow");return w;},_addChartCustomToolbar:function(i,u){var w=this;var x=i.component.properties.parentProperty,M=x.replace(/[^\w]/gi,''),y=this.oState.alr_visualFilterBar._oMetadataAnalyser.getEntityTypeNameFromEntitySetName(i.component.properties.entitySet),z=i.component.properties.sortOrder[0].Descending.Boolean,I=F.readProperty(i,"component.type")==="Line"&&F.readProperty(i,"component.properties.dimensionFieldIsDateTime"),A=this.oState.alr_visualFilterBar._resolveChartType(i.component.type),E=this._getChartTypeIconLink(A),J=new H({items:[new L({text:w._getChartTitle(i,u)})]});if(this.oConfig.filterCompList[u].component.properties.isMandatory){J.getItems()[0].addStyleClass("sapMLabelRequired");}var K=this.oState.oSmartFilterbar.getControlByKey(i.component.properties.parentProperty);this.oState.oSmartFilterbar.ensureLoadedValueHelp(i.component.properties.parentProperty);var N=K&&K.getShowValueHelp&&K.getShowValueHelp();var O;var Q=this.oVerticalBox.getModel("i18n").getResourceBundle();var R=[new B({type:"Transparent",icon:"sap-icon://line-chart-time-axis",visible:false,press:function(W){w._showLineChartTimeAxisPopup(W);}}).data("idx",u),new B({type:"Transparent",icon:N?"sap-icon://value-help":"",visible:{path:"_filter>/"+x,formatter:function(W){if(N){return true;}else{if(!W){return false;}if(typeof W==="object"){return(W.value||(W.items&&W.items.length)||(W.ranges&&W.ranges.length))?true:false;}return true;}}},text:{path:"_filter>/"+x,formatter:function(W){O="";if(W){var X=0;if(typeof W==="object"){if(W.value){X++;}if(W.items){X+=W.items.length;}if(W.ranges){X+=W.ranges.length;}}else{X++;}}if(X){O=(X===1)?Q.getText("SINGLE_SELECTED",X):Q.getText("MULTI_SELECTED",X);}return X?"("+X+")":"";}},press:function(W){if(N){K.fireValueHelpRequest.call(K);}else{sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController.launchAllFiltersPopup(W.getSource(),w.filterChartList[W.getSource().data("idx")],W.getSource().getModel('i18n'));}},tooltip:{path:"_filter>/"+x,formatter:function(){return F.getTooltipForValueHelp(N,Q,O);}}}).data("idx",u),new B({type:"Transparent",icon:(z?"sap-icon://sort-descending":"sap-icon://sort-ascending"),visible:!I,tooltip:"{i18n>VISUAL_FILTER_SORT_ORDER}",press:function(W){w._showChartSortPopup(W);}}).data("idx",u),new B({type:"Transparent",icon:E,tooltip:"{i18n>VISUAL_FILTER_CHART_TYPE}",press:function(W){w._showChartTypesPopup(W);}}).data("idx",u),new B({id:"template::VisualFilterDialog::MeasureChangeButton::"+y+"::"+M,type:"Transparent",icon:"sap-icon://measure",tooltip:"{i18n>VISUAL_FILTER_MEASURE}",press:function(W){w._showChartMeasuresPopup(W);}}).data("idx",u)];var U=new H({items:R});U.setWidth("100%");U.setJustifyContent(sap.m.FlexJustifyContent.End);J.getItems()[0].addStyleClass("sapUiTinyMarginTop");J.getItems()[0].addStyleClass("sapSmartTemplatesAnalyticalListPageVFDialogChartTitle");J.setWidth("100%");J.addItem(U);return J;},_addChart:function(i,u,w){var x;var y=this;var z={scaleFactor:u.scaleFactor,numberOfFractionalDigits:u.numberOfFractionalDigits,sortOrder:u.sortOrder,filterRestriction:u.filterRestriction,width:r,height:u.height,labelWidthPercent:s,entitySet:u.entitySet,dimensionField:u.dimensionField,dimensionFieldDisplay:u.dimensionFieldDisplay,dimensionFieldIsDateTime:u.dimensionFieldIsDateTime,unitField:u.unitField,isCurrency:u.isCurrency,isMandatory:u.isMandatory,measureField:u.measureField,dimensionFilter:u.dimensionFilter,outParameter:u.outParameter,inParameters:u.inParameters,parentProperty:u.parentProperty,textArrangement:u.textArrangement,chartQualifier:u.chartQualifier};var A="/filterCompList/"+w;if(i==="Donut"){z.labelWidthPercent=t;}i=this.oState.alr_visualFilterBar._resolveChartType(i);var x=this.oState.alr_visualFilterBar._createFilterItemOfType(i,z);x.data("idx",w);x.addCustomData(new sap.ui.core.CustomData({key:'sPath',value:A}));x.bindProperty('visible',{path:'_visualFilterConfigModel>/filterCompList/'+w+'/showChartOverlay',formatter:function(J){return!J;}});x.bindProperty('dimensionFilter',{path:'_filter>/'+x.getParentProperty()});var I=x.getInParameters(),E=[];if(I&&I.length>0){I.forEach(function(J){E.push({path:"_filter>/"+J.localDataProperty});});}if(y.oState.alr_visualFilterBar.getEntitySet()===x.getEntitySet()){var M=y.oState.alr_visualFilterBar._smartFilterContext.determineMandatoryFilterItems();if(M&&M.length>0){M.forEach(function(J){E.push({path:'_filter>/'+J.getName()});});}}if(E&&E.length>0){x.bindProperty('dimensionFilterExternal',{parts:E,formatter:function(){var I=this.getInParameters(),J=this.getParentProperty(),K,N;if(!(y.oState.alr_visualFilterBar.getEntitySet()===this.getEntitySet()&&y.oState.oSmartFilterbar.getAnalyticBindingPath()!=="")&&(y.oState.oSmartFilterbar.getAnalyticBindingPath()===""||((y.oState.oSmartFilterbar.getAnalyticBindingPath().indexOf("P_DisplayCurrency"))!=-1))){var O=y.oState.alr_visualFilterBar.getProperty("displayCurrency");if(O){var Q=this.getMeasureField();var R=y.oState.alr_visualFilterBar.getModel();var U=R.getMetaModel();var W=U.getODataEntityType(y.oState.alr_visualFilterBar._oMetadataAnalyser.getEntityTypeNameFromEntitySetName(this.getEntitySet()));var X=U.getODataProperty(W,Q);if(X){var Y=X[p.ISOCurrency];if(Y){var Z=Y.Path;for(var $=(I.length-1);$>-1;$--){var _=I[$].valueListProperty;var a1=I[$].localDataProperty;if(_===Z){var b1=y.oState.oSmartFilterbar.getFilterData();if(!b1[a1]){N=U.getODataProperty(W,Z);if(N&&N["sap:filterable"]!=="false"){K=new sap.ui.model.Filter({aFilters:[new sap.ui.model.Filter({path:Z,operator:"EQ",value1:O,value2:undefined})],and:false});}}break;}}}}}}return y.oState.alr_visualFilterBar._getFiltersForFilterItem(I,J,K,Z);}});}x._updateBinding();x._bAllowBindingUpdateOnPropertyChange=true;x.attachFilterChange(function(J){y._filterModified=true;y.oState.alr_visualFilterBar.fireFilterChange();});x.attachTitleChange(function(J){var w=J.getSource().data("idx");if(y.filterCompList[w].toolbar.getItems().length>0){if(z.isMandatory){y.filterCompList[w].toolbar.getItems()[0].addStyleClass("sapMLabelRequired");}y.filterCompList[w].toolbar.getItems()[0].setText(y._getChartTitle(y.filterCompList[w].obj,w));}});return x;},_createMoreFiltersLink:function(u,w){var x=this;var y=0;var i;var z=new e();for(i=0;i<this.filterCompList.length;i++){if(this.filterCompList[i].searchVisible&&this.filterCompList[i].obj.group.name===u&&!this.filterCompList[i].obj.shownInFilterDialog){y++;}}if(y>0){z.setText(this.oRb.getText("FILTER_BAR_SHOW_MORE_FILTERS",[y]));}else{z.setText(this.oRb.getText("FILTER_BAR_SHOW_CHANGE_FILTERS"));}z.attachPress(function(A){x._createAddRemoveFiltersDialog(u,z);});if(w){z.addAriaLabelledBy(w);}return z;},_showChartMeasuresPopup:function(E){var i=this;var u=E.getSource().data("idx");var w=this.filterChartList[u].getProperty("entitySet");var x=sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createPopoverDialog(E.getSource().getModel('i18n'),"VISUAL_FILTER_MEASURES");var y=new f({mode:sap.m.ListMode.SingleSelectLeft,includeItemInSelection:true});y.data("idx",u);x.addContent(y);var z=this.oState.alr_visualFilterBar._getMeasureMap()[w];y.addStyleClass("sapUiSizeCompact");if(z){for(var A in z){var I=new j({title:z[A].label}).data("measureName",z[A].name);y.addItem(I);if(this.filterChartList[u].getMeasureField()===z[A].name){y.setSelectedItem(I);}}}y.attachSelectionChange(function(E){var u=E.getSource().data("idx"),M=E.getSource().getSelectedItem().data("measureName");i.filterChartList[u].setProperty("unitField",z[M].fieldInfo.unit);i.filterCompList[u].toolbar.getItems()[0].setText(i._getChartTitle(i.filterCompList[u].obj,u));i.oConfig.filterCompList[u].component.properties.measureField=M;if(!i.filterChartList[u]._chart.getPoints){var J=jQuery.extend(true,[],i.filterChartList[u].getSortOrder());J[0].Field.String=M;i.filterChartList[u].setSortOrder(J);i._updateVisualFilterConfigModel(u,'/component/properties/sortOrder',J);}var K={bUpdateBinding:true,value:M};i.filterChartList[u].setMeasureField(K);i._updateVisualFilterConfigModel(u,'/component/properties/measureField',K);i._updateVisualFilterConfigModel(u,'/component/properties/measureField',M);i._updateVisualFilterConfigModel(u,'/component/properties/unitField',z[M].fieldInfo.unit);i._filterModified=true;x.close();});x.attachAfterClose(function(){x.destroy();x=null;});x.openBy(E.getSource());},_showChartTypesPopup:function(E){var u=this;var w=E.getSource();var x=sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createPopoverDialog(E.getSource().getModel('i18n'),"VISUAL_FILTER_CHART_TYPES");var y=this.oState.alr_visualFilterBar._getSupportedFilterItemList();var z=[];var A=false;for(var i=0;i<y.length;i++){var I=y[i];var J=new j({title:"{i18n>"+I.textKey+"}",icon:I.iconLink,selected:w.getIcon()===I.iconLink}).data("type",I.type);z.push(J);}var K=new f({mode:sap.m.ListMode.SingleSelectMaster,items:z});K.data("button",w);K.addStyleClass("sapUiSizeCompact");x.addContent(K);K.attachSelectionChange(function(E){var M=E.getSource().data("button").data("idx"),N=E.getSource().getSelectedItem().data("type"),O=u.filterChartList[M],Q=O.getDimensionField(),R=O.getMeasureField(),U=O.getDimensionFieldIsDateTime(),W=F.readProperty(u.oConfig,"filterCompList."+M+".component.properties.sortOrder.0.Field.String"),X=u.oState.alr_visualFilterBar.getModel('_visualFilterConfigModel'),Y=jQuery.extend(true,{},X.getProperty('/filterCompList/'+M)),Z=F.readProperty(Y,"component.properties.sortOrder.0.Field.String");u.oConfig.filterCompList[M].component.type=N;E.getSource().data("button").setIcon(u._getChartTypeIconLink(N));if(W&&Z){if(N==="Line"){u.oConfig.filterCompList[M].component.properties.sortOrder[0].Field.String=Q;Y.component.properties.sortOrder[0].Field.String=Q;if(U){u.bSortOrder=u.oConfig.filterCompList[M].component.properties.sortOrder[0].Descending.Boolean;u.oConfig.filterCompList[M].component.properties.sortOrder[0].Descending.Boolean=true;Y.component.properties.sortOrder[0].Descending.Boolean=true;u.bIsTimeBasedLine=true;}}else{u.oConfig.filterCompList[M].component.properties.sortOrder[0].Field.String=R;Y.component.properties.sortOrder[0].Field.String=R;if(u.bIsTimeBasedLine){u.oConfig.filterCompList[M].component.properties.sortOrder[0].Descending.Boolean=u.bSortOrder;Y.component.properties.sortOrder[0].Descending.Boolean=u.bSortOrder;u.bIsTimeBasedLine=false;}}}Y.component.type=N;X.setProperty('/filterCompList/'+M,Y);u.oState.oSmartFilterbar._oVariantManagement.currentVariantSetModified(true);u.oState.alr_visualFilterBar.updateVisualFilterBindings(true);A=true;x.close();});x.attachBeforeClose(function(){if(A){u._filterModified=true;u._reloadForm();}});x.attachAfterClose(function(){x.destroy();x=null;});x.openBy(E.getSource());},_showLineChartTimeAxisPopup:function(E){var i=E.getSource().data("idx");var u=E.getSource();var w=sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createPopoverDialog(E.getSource().getModel('i18n'),"VISUAL_FILTER_LINE_CHART_TIME_LINE");var x=new f({mode:sap.m.ListMode.SingleSelectLeft,items:[new j({title:"{i18n>VISUAL_FILTER_LINE_CHART_TIME_LINE_DAYS}"}).data("idx",i),new j({title:"{i18n>VISUAL_FILTER_LINE_CHART_TIME_LINE_MONTH}"}).data("idx",i),new j({title:"{i18n>VISUAL_FILTER_LINE_CHART_TIME_LINE_QUARTERS}"}).data("idx",i),new j({title:"{i18n>VISUAL_FILTER_LINE_CHART_TIME_LINE_YEARS}"}).data("idx",i)]});x.data("button",u);x.addStyleClass("sapUiSizeCompact");w.addContent(x);x.attachSelectionChange(function(E){w.close();});w.attachAfterClose(function(){w.destroy();w=null;});w.openBy(E.getSource());},_showChartSortPopup:function(E){var i=this;var u=E.getSource().data("idx");var w=E.getSource();var x=E.getSource().getModel('i18n');var y=sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createPopoverDialog(x,"VISUAL_FILTER_SORTING");var z=new f({mode:sap.m.ListMode.SingleSelectLeft,includeItemInSelection:true,items:[new j({title:x.getResourceBundle().getText("VISUAL_FILTER_SORTING_ASCENDING")}).data("idx",u),new j({title:x.getResourceBundle().getText("VISUAL_FILTER_SORTING_DESCENDING")}).data("idx",u)]});z.data("button",w);z.addStyleClass("sapUiSizeCompact");if(this.filterChartList[u].getSortOrder()[0].Descending.Boolean){z.setSelectedItem(z.getItems()[1],true);}else{z.setSelectedItem(z.getItems()[0],true);}y.addContent(z);z.attachSelectionChange(function(E){var w=E.getSource().data("button");var u=w.data("idx");var A=jQuery.extend(true,[],i.filterChartList[u].getSortOrder());A[0].Descending.Boolean=E.getSource().getItems()[1].isSelected();if(A[0].Descending.Boolean){w.setIcon("sap-icon://sort-descending");}else{w.setIcon("sap-icon://sort-ascending");}var I={bUpdateBinding:true,value:A};i.filterChartList[u].setSortOrder(I);i._updateVisualFilterConfigModel(u,'/component/properties/sortOrder',I);i._updateVisualFilterConfigModel(u,'/component/properties/sortOrder',A);i._filterModified=true;y.close();});y.attachAfterClose(function(){y.destroy();y=null;});y.openBy(E.getSource());},_createAddRemoveFiltersDialog:function(u,w){var i;var x=this;var y=new sap.m.Dialog();y.setTitle(this.oRb.getText("SELECT_FILTER_FIELDS"));y.addStyleClass("sapUiPopupWithPadding");y.addStyleClass("sapUiCompAddRemoveFilterDialog");y.addStyleClass("sapUiSizeCompact");y.setVerticalScrolling(true);var z=new b();var A=new S({placeholder:this.oRb.getText("FILTER_BAR_SEARCH")});this._oSearchField=A;A.attachLiveChange(function(J){x._onAddRemoveFiltersSearch(J);});z.addContentRight(A);y.setSubHeader(z);this.addRemoveList=new f({mode:sap.m.ListMode.MultiSelect});this.addRemoveList.setShowSeparators(k.None);y.addContent(this.addRemoveList);for(i=0;i<this.filterCompList.length;i++){if(this.filterCompList[i].obj.group.name===u&&this.filterCompList[i].searchVisible){var E=new j({title:this._getChartTitle(this.filterCompList[i].obj,i,true)}).data("idx",i);this.addRemoveList.addItem(E);if(this.filterCompList[i].obj.shownInFilterDialog){this.addRemoveList.setSelectedItem(E,true);}}}this.addRemoveList.attachSelectionChange(function(J){if(J){var K=J.getParameters();if(K){var E=K.listItem;var M=E.data("idx");if(E){var N={bVisible:K.selected,propertyName:x.oConfig.filterCompList[M].component.properties.parentProperty};x.oState.alr_visualFilterBar.fireFilterChange(N);}}}});var O=new B({text:this.oRb.getText("FORM_PERS_DIALOG_OK")});O.attachPress(function(){var i;var J=x.addRemoveList.getItems();var K=x.oState.alr_visualFilterBar.getModel('_visualFilterConfigModel'),M=jQuery.extend(true,{},K);for(i=0;i<J.length;i++){var N=J[i].data("idx");var Q=J[i].isSelected();M.setProperty('/filterCompList/'+N+'/shownInFilterBar',Q);M.setProperty('/filterCompList/'+N+'/shownInFilterDialog',Q);}K.setData(M.getData());x.oConfig=JSON.parse(K.getJSON());x.oState.alr_visualFilterBar.updateVisualFilterBindings(true);x.oState.oSmartFilterbar._oVariantManagement.currentVariantSetModified(true);x._filterModified=true;x._reloadForm();y.close();});y.addAggregation("buttons",O);y.setInitialFocus(this._oSearchField);y.setContentHeight("23.25rem");var I=new B({text:this.oRb.getText("FORM_PERS_DIALOG_CANCEL"),press:function(){y.close();}});y.addAggregation("buttons",I);y.attachAfterClose(function(){y.destroy();y=null;});y.open();},_onAddRemoveFiltersSearch:function(E){var i;if(!E){return;}var u=E.getParameters();if(!u){return;}var w=(u.newValue?u.newValue:"").toLowerCase();var x=this.addRemoveList.getItems();for(i=0;i<x.length;i++){var y=(x[i].getTitle()).toLowerCase();x[i].setVisible(y.indexOf(w)>=0);}},_getChartTypeIconLink:function(i){var u=this.oState.alr_visualFilterBar._getSupportedFilterItemMap();var w=u[i];return!w?"":w.iconLink;},_getChartTitle:function(i,u,w){var x="";if(this.filterChartList[u]){if(w){i.component.properties=this.filterChartList[u].getP13NConfig();x=this.oState.alr_visualFilterBar.getTitleByFilterItemConfig(i);}else{x=this.filterChartList[u].getTitle();}}else{i.component.properties=this.oConfig.filterCompList[u].component.properties;x=this.oState.alr_visualFilterBar.getTitleByFilterItemConfig(i);}return x;},_adjustToolbarIcons:function(i){if(this.filterCompList[i].obj.component.type==="Line"){this.filterCompList[i].toolbar.getItems()[1].getItems()[1].setVisible(true);this.filterCompList[i].toolbar.getItems()[1].getItems()[2].setVisible(false);}else{this.filterCompList[i].toolbar.getItems()[1].getItems()[1].setVisible(false);this.filterCompList[i].toolbar.getItems()[1].getItems()[2].setVisible(true);}},_updateVisualFilterConfigModel:function(i,u,w,I){var x=this.oState.alr_visualFilterBar.getModel('_visualFilterConfigModel');x.setProperty('/filterCompList/'+i+u,w);if(I){var M=jQuery.extend(true,{},x.getProperty('/filterCompList/'+i));x.setProperty('/filterCompList/'+i,M);this.oState.alr_visualFilterBar.updateVisualFilterBindings(true);}this.oConfig=JSON.parse(x.getJSON());this.oState.oSmartFilterbar._oVariantManagement.currentVariantSetModified(true);},_triggerSearchInFilterDialog:function(E){var i;if(!E){return;}var u=E.getParameters();if(!u){return;}var w=(u.newValue?u.newValue:"").toLowerCase();for(i=0;i<this.oConfig.filterCompList.length;i++){var x=this.oConfig.filterCompList[i].component.properties;this.oConfig.filterCompList[i].searchVisible=(x.parentProperty.toLowerCase().indexOf(w)>=0)||(x.measureField.toLowerCase().indexOf(w)>=0);}this._reloadForm();}});sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createPopoverDialog=function(i,u){if(this._oPopoverDialog){this._oPopoverDialog.destroy();}this._oPopoverDialog=new sap.m.Popover();this._oPopoverDialog.setTitle(i.getResourceBundle().getText(u));this._oPopoverDialog.setPlacement(sap.m.PlacementType.PreferredBottomOrFlip);this._oPopoverDialog.addStyleClass("sapUiPopupWithPadding");return this._oPopoverDialog;};sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createFilterItemSelectedList=function(u,w){var x=new f({mode:sap.m.ListMode.Delete}),y,z=u.getFilterRestriction();x.data("chart",u);if(z==='multiple'){y=jQuery.extend(true,{},u.getDimensionFilter());var A=(y&&y.items)?y.items:undefined,E=(y&&y.ranges)?y.ranges:undefined,I=(y&&y.value)?y.value:null;y=jQuery.extend(true,{},u.getDimensionFilter());if(A){for(var i=0;i<A.length;i++){var J=new j({title:A[i].text?A[i].text:A[i].key});if(J){J.addCustomData(new sap.ui.core.CustomData({key:'items',value:i}));}x.addItem(J);}}if(E){for(var i=0;i<E.length;i++){var J=new j({title:E[i].tokenText?E[i].tokenText:F.createTitleFromCode(E[i])});J.addCustomData(new sap.ui.core.CustomData({key:'ranges',value:i}));x.addItem(J);}}if(I){var J=new j({title:I});J.addCustomData(new sap.ui.core.CustomData({key:'value'}));x.addItem(J);}}else{x.addItem(new j({title:u.getDimensionFilter()}));}x.attachDelete(function(K){var M=K.getParameter("listItem"),N=x.data('chart'),O;if(z==='single'){O=null;}else{O=jQuery.extend(true,{},N.getDimensionFilter());var Q=M.getCustomData()[0],R=Q.getKey(),U=O[R];if(R!=='value'){var W=Q.getValue();U.splice(W,1);}else{O.value=null;}}x.removeItem(M);N.setDimensionFilter(O);N.fireFilterChange();w.removeContent(x);var X=sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createFilterItemSelectedList(N,w);if(X.getItems().length>0){w.addContent(X);w.focus();}else{w.close();}});return x;};sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController.launchAllFiltersPopup=function(i,u,w){var x=sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createPopoverDialog(w,"VISUAL_FILTER_ALL_SELECTED_FILTERS"),y=sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createFilterItemSelectedList(u,x);x.addContent(y);x.addStyleClass("sapUiSizeCompact");x.addStyleClass("sapSmartTemplatesAnalyticalListPageSelectedLinkDialog");var z=new sap.m.Bar();var A=new B({text:w.getResourceBundle().getText("CLEAR_FILTERS_ALL"),press:function(E){var I=y.data('chart'),J=I.getFilterRestriction(),K;if(J==='multiple'){K=jQuery.extend(true,{},I.getDimensionFilter());K.items=[];K.ranges=[];K.value=null;}else{K=null;}x.removeContent(y);I.setDimensionFilter(K);I.fireFilterChange();x.close();}});z.addContentRight(A);x.setFooter(z);x.attachAfterClose(function(){x.destroy();x=null;});x.openBy(i);};return v;});
