/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2017 SAP SE. All rights reserved
 */
sap.ui.define(['jquery.sap.global','./library','sap/m/library','sap/ui/core/Control','sap/ui/Device'],function(q,l,M,C,D){"use strict";var H=C.extend("sap.suite.ui.microchart.HarveyBallMicroChart",{metadata:{library:"sap.suite.ui.microchart",properties:{total:{group:"Misc",type:"float",defaultValue:null},totalLabel:{group:"Misc",type:"string"},totalScale:{group:"Misc",type:"string"},formattedLabel:{group:"Misc",type:"boolean",defaultValue:false},showTotal:{group:"Misc",type:"boolean",defaultValue:true},showFractions:{group:"Misc",type:"boolean",defaultValue:true},size:{group:"Misc",type:"sap.m.Size",defaultValue:"Auto"},colorPalette:{type:"string[]",group:"Appearance",defaultValue:[]},width:{group:"Misc",type:"sap.ui.core.CSSSize"},isResponsive:{type:"boolean",group:"Appearance",defaultValue:false}},events:{press:{}},defaultAggregation:"items",aggregations:{"items":{multiple:true,type:"sap.suite.ui.microchart.HarveyBallMicroChartItem",bindable:"bindable"}}}});H._iSmallestChartSize=24;H._iSmallestFontSize=12;H.prototype.getAltText=function(){var a="";var I=true;var b=this.getItems();for(var i=0;i<b.length;i++){var o=b[i];var c=(this.getColorPalette().length==0)?this._rb.getText(("SEMANTIC_COLOR_"+o.getColor()).toUpperCase()):"";var L=o.getFractionLabel();var s=o.getFractionScale();if(!L&&s){L=o.getFormattedLabel()?o.getFraction():o.getFraction()+o.getFractionScale().substring(0,3);}else if(!o.getFormattedLabel()&&o.getFractionLabel()){L+=o.getFractionScale().substring(0,3);}a+=(I?"":"\n")+L+" "+c;I=false;}if(this.getTotal()){var t=this.getTotalLabel();if(!t){t=this.getFormattedLabel()?this.getTotal():this.getTotal()+this.getTotalScale().substring(0,3);}else if(!this.getFormattedLabel()){t+=this.getTotalScale().substring(0,3);}a+=(I?"":"\n")+this._rb.getText("HARVEYBALLMICROCHART_TOTAL_TOOLTIP")+" "+t;}return a;};H.prototype.getTooltip_AsString=function(){var t=this.getTooltip();var T=this.getAltText();if(typeof t==="string"||t instanceof String){T=t.split("{AltText}").join(T).split("((AltText))").join(T);return T;}else if(this.isBound("tooltip")&&!t){return T;}return t?t:"";};H.prototype.init=function(){this._rb=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.microchart");this.setAggregation("tooltip","{AltText}",true);D.media.attachHandler(this.rerender,this,D.media.RANGESETS.SAP_STANDARD);this._sChartResizeHandlerId=null;this._$Control=null;this._$ParentContainer=null;this._bThemeApplied=true;if(!sap.ui.getCore().isInitialized()){this._bThemeApplied=false;sap.ui.getCore().attachInit(this._handleCoreInitialized.bind(this));}else{this._handleCoreInitialized();}};H.prototype.setSize=function(s){if(this.getSize()!==s){if(s===M.Size.Responsive){this.setProperty("isResponsive",true,true);}else{this.setProperty("isResponsive",false,true);}this.setProperty("size",s,false);}return this;};H.prototype._handleCoreInitialized=function(){this._bThemeApplied=sap.ui.getCore().isThemeApplied();if(!this._bThemeApplied){sap.ui.getCore().attachThemeChanged(this._handleThemeApplied,this);}};H.prototype._handleThemeApplied=function(){this._bThemeApplied=true;this.invalidate();sap.ui.getCore().detachThemeChanged(this._handleThemeApplied,this);};H.prototype.onBeforeRendering=function(){if(l._isInGenericTile(this)){this.setIsResponsive(true);l._removeStandardMargins(this);}this._unbindMouseEnterLeaveHandler();};H.prototype.onAfterRendering=function(){if(this.getIsResponsive()){this._adjustToParent();}l._checkControlIsVisible(this,this._onControlIsVisible);this._bindMouseEnterLeaveHandler();};H.prototype._onControlIsVisible=function(){if(this.$().width()<H._iSmallestChartSize||this.$().height()<H._iSmallestChartSize){this.$().hide();}this._hideLabels();};H.prototype._adjustToParent=function(){if(!q.isFunction(this.getParent)){return;}var p=this.getParent();if(q.isFunction(p.getHeight)){var P=parseFloat(p.$().height())-2;this.$().height(P);this.$().find("svg").height(P);}if(q.isFunction(p.getWidth)){var s=parseFloat(p.$().width())-2;this.$().width(s);this.$().find("svg").width(s);}};H.prototype._hideLabels=function(){var t;var T;var $=this.$().find("#sapSuiteHBMCTopText");var a=this.$().find("#sapSuiteHBMCBottomText");if($.length>0){t=$[0].getBoundingClientRect().height;}if(a.length>0){T=a[0].getBoundingClientRect().height;}if(t<H._iSmallestFontSize||T<H._iSmallestFontSize){this.$().find("text").hide();}};H.prototype._parseFormattedValue=function(v){return{scale:v.replace(/.*?([^+-.,\d]*)$/g,"$1").trim(),value:v.replace(/(.*?)[^+-.,\d]*$/g,"$1").trim()};};H.prototype.ontap=function(e){if(D.browser.msie){this.$().focus();}this.firePress();};H.prototype.onkeydown=function(e){if(e.which==q.sap.KeyCodes.SPACE){e.preventDefault();}};H.prototype.onkeyup=function(e){if(e.which==q.sap.KeyCodes.ENTER||e.which==q.sap.KeyCodes.SPACE){this.firePress();e.preventDefault();}};H.prototype.attachEvent=function(e,d,f,L){C.prototype.attachEvent.call(this,e,d,f,L);if(this.hasListeners("press")){this.$().attr("tabindex",0).addClass("sapSuiteUiMicroChartPointer");}return this;};H.prototype.detachEvent=function(e,f,L){C.prototype.detachEvent.call(this,e,f,L);if(!this.hasListeners("press")){this.$().removeAttr("tabindex").removeClass("sapSuiteUiMicroChartPointer");}return this;};H.prototype.exit=function(e){D.media.detachHandler(this.rerender,this,D.media.RANGESETS.SAP_STANDARD);};H.prototype._addTitleAttribute=function(){if(!this.$().attr("title")){this.$().attr("title",this.getTooltip_AsString());}};H.prototype._removeTitleAttribute=function(){if(this.$().attr("title")){this.$().removeAttr("title");}};H.prototype._bindMouseEnterLeaveHandler=function(){this.$().bind("mouseenter.tooltip",this._addTitleAttribute.bind(this));this.$().bind("mouseleave.tooltip",this._removeTitleAttribute.bind(this));};H.prototype._unbindMouseEnterLeaveHandler=function(){this.$().unbind("mouseenter.tooltip");this.$().unbind("mouseleave.tooltip");};return H;});
