/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(['jquery.sap.global','sap/m/Image','./library','sap/ui/core/Control','sap/ui/core/IconPool','sap/ui/Device','sap/ui/core/Icon'],function(q,I,l,C,a,D,b){"use strict";var P=C.extend("sap.suite.ui.commons.ProcessFlowLaneHeader",{metadata:{library:"sap.suite.ui.commons",properties:{text:{type:"string",group:"Misc",defaultValue:null},iconSrc:{type:"sap.ui.core.URI",group:"Misc",defaultValue:null},position:{type:"int",group:"Misc",defaultValue:null},laneId:{type:"string",group:"Misc",defaultValue:null},state:{type:"object",group:"Misc",defaultValue:null},zoomLevel:{type:"sap.suite.ui.commons.ProcessFlowZoomLevel",group:"Misc",defaultValue:null}},events:{press:{parameters:{oEvent:{type:"object"}}}}}});P.prototype._oResBundle=null;P.prototype._mergedLanePosition=null;P.symbolType={startSymbol:"startSymbol",endSymbol:"endSymbol",processSymbol:"processSymbol",standardType:"standardType"};P._constants={halfGapSize:0.0241,minPercentage:0.025,ringThickness:5,ringInnerRadius:24,positionX:32,positionY:32,outerCircleRadius:32,outerCircleStrokeColor:"OuterCircleStrikeColor",outerCircleStrokeWidth:1,sectorPositiveColor:"suiteUiCommonsProcessFlowHeaderPositiveColor",sectorNegativeColor:"suiteUiCommonsProcessFlowHeaderNegativeColor",sectorNeutralColor:"suiteUiCommonsProcessFlowHeaderNeutralColor",sectorCriticalColor:"suiteUiCommonsProcessFlowHeaderCriticalColor",sectorPlannedColor:"suiteUiCommonsProcessFlowHeaderPlannedColor",ellipsis:'...',ellipsisLength:3};P.prototype.init=function(){this._virtualTableSpan=1;if(!this._oResBundle){this._oResBundle=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons");}};P.prototype.exit=function(){this._destroyImage();this.$().unbind("click",this.ontouchend);};P.prototype.onBeforeRendering=function(){this.$("lh-icon").off('click',q.proxy(this.ontouchend,this));this.$().unbind("click",this.ontouchend);};P.prototype.onAfterRendering=function(){var t=this.$();var $=this.$("lh-icon");var c='click';if(D.support.touch){c='touchend';}if($.length>0){$.on(c,q.proxy(this.ontouchend,this));$.css("cursor","inherit");}this.$().bind("click",q.proxy(this.ontouchend,this));if(this._isHeaderMode()){t.addClass("suiteUiProcessFlowLaneHeaderPointer");}else{t.removeClass("suiteUiProcessFlowLaneHeaderPointer");}if(D.browser.msie||D.browser.mozilla){this.$("lh-text").css("word-break","break-all");}if(!this._ellipsisDisabled&&!P._hasNativeLineClamp){this._clampText();}};P.prototype.ontouchend=function(e){if(e&&!e.isDefaultPrevented()){e.preventDefault();}if(this){this.firePress(this);}if(e&&!e.isPropagationStopped()){e.stopPropagation();}if(e&&!e.isImmediatePropagationStopped()){e.stopImmediatePropagation();}};P.prototype._setMergedPosition=function(p){this._mergedLanePosition=p;};P.prototype._getSymbolType=function(){return this._oSymbolType?this._oSymbolType:P.symbolType.standardType;};P.prototype._setSymbolType=function(s,c){c._oSymbolType=s;};P.prototype._getImage=function(i,s){this._destroyImage();if(this._oImageControl){this._oImageControl.setSrc(s);}else{this._oImageControl=a.createControlByURI(s,I);this._oImageControl.sId=i;this._oImageControl.setParent(this,null,true);}if(this._oImageControl instanceof b){this._oImageControl.setUseIconTooltip(false);}return this._oImageControl;};P.prototype._setHeaderMode=function(i){this._bHeaderMode=i;};P._setVirtualTableSpan=function(e){this._virtualTableSpan=e;};P._getVirtualTableSpan=function(){return this._virtualTableSpan;};P.prototype._isHeaderMode=function(){return this._bHeaderMode;};P.prototype._clampValues=function(c,m,d){var i=c.length-1,e=false,v;while(i>=0){v=c[i];if(v<m){c[i]=d;e=true;}i--;}return e;};P.prototype._rescaleToUnit=function(r,m){var R,i,v,V,c,d;if(!m){m=0;}i=r.length-1;R=0;v=V=0;while(i>=0){c=r[i];if(c>0){if(c<=m){V++;}else{R+=r[i];}v++;}i--;}R-=(v-V)*m;d=(1-v*m)/R;i=r.length-1;while(i>=0){c=r[i];if(c>0){if(c<=m){r[i]=m;}else{r[i]=(c-m)*d+m;}}i--;}};P.prototype._countGaps=function(c){var i=c.length-1,g=0;while(i>=0){if(c[i]>0){g++;}i--;}if(g===1){g=0;}return g;};P.prototype._rescaleByFactor=function(r,f){var i=r.length-1;while(i>=0){r[i]*=f;i--;}};P.prototype._colorMap=[P._constants.sectorPositiveColor,P._constants.sectorNegativeColor,P._constants.sectorNeutralColor,P._constants.sectorPlannedColor,P._constants.sectorCriticalColor];P.prototype._calculateSectorRangeDefinitions=function(c,f){var d=[],e=-Math.PI/2,g,h=c.length,i=0;while(i<h){if(c[i]>0){g=e+2*Math.PI*c[i];d.push({start:e,end:g,color:this._colorMap[i]});e=g+f;}i++;}return d;};P.prototype._renderDonutPercentages=function(r){var s=this.getState(),g=0,S,p=[0,0,0,0],f,c,h=P._constants.halfGapSize,R=P._constants.ringInnerRadius,i=P._constants.ringThickness,d=P._constants.ringInnerRadius+i,o=P._constants.outerCircleStrokeColor,O=P._constants.outerCircleStrokeWidth,e=P._constants.outerCircleRadius,j=P._constants.positionX,k=P._constants.positionY,m=P._constants.minPercentage;if(s&&Object.prototype.toString.call(s)==='[object Array]'&&(s.length>0)){s.forEach(function(n){switch(n.state){case l.ProcessFlowNodeState.Positive:p[0]=n.value;break;case l.ProcessFlowNodeState.Negative:p[1]=n.value;break;case l.ProcessFlowNodeState.Neutral:p[2]=n.value;break;case l.ProcessFlowNodeState.Planned:p[3]=n.value;break;case l.ProcessFlowNodeState.Critical:p[4]=n.value;break;default:p[3]=n.value;}});this._clampValues(p,0,0);this._rescaleToUnit(p);this._rescaleToUnit(p,m);g=this._countGaps(p);f=(1-g*h/Math.PI);this._rescaleByFactor(p,f);this._renderCircle(r,o,O,j,k,e);if(g>0){S=this._calculateSectorRangeDefinitions(p,2*h);this._renderDonutSectors(r,S,j,k,R,d);}else{c=this._selectColor(p);this._renderCircle(r,c,i,j,k,R+i/2);}}else{this._renderCircle(r,o,O,j,k,e);}};P.prototype._renderCircle=function(r,s,c,p,d,e){r.write("<circle");r.writeAttribute("id",this.getId()+"-donut-circle");if(s!==P._constants.outerCircleStrokeColor){r.writeAttributeEscaped("class","suiteUiCommonsProcessFlowHeaderIconFill "+s);}else{r.writeAttribute("class","suiteUiCommonsProcessFlowHeaderIconFill");}r.writeAttributeEscaped("stroke-width",c);r.writeAttributeEscaped("cx",p);r.writeAttributeEscaped("cy",d);r.writeAttributeEscaped("r",e);r.write("></circle>");};P.prototype._renderDonutSectors=function(r,s,p,c,d,e){var i=0,f=s.length,S,g;while(i<f){S=s[i];g=this._getDonutSectorPath(p,c,S.start,S.end,d,e);r.write("<path");r.writeAttribute("id",this.getId()+"-donut-segment-"+i);r.writeAttributeEscaped("d",g);r.writeAttributeEscaped("class",S.color);r.writeAttribute("opacity","1");r.write("></path>");i++;}};P.prototype._selectColor=function(p){var c;if(p[0]){c=P._constants.sectorPositiveColor;}else if(p[1]){c=P._constants.sectorNegativeColor;}else if(p[2]){c=P._constants.sectorNeutralColor;}else if(p[3]){c=P._constants.sectorPlannedColor;}else if(p[4]){c=P._constants.sectorCriticalColor;}else{c=P._constants.sectorNeutralColor;}return c;};P.prototype._getDonutSectorPath=function(p,c,s,e,r,d){var o=0,f,g,h,i,S,j,E,k,m;if((e-s)%(Math.PI*2)>Math.PI){o=1;}j=Math.cos(s);E=Math.cos(e);k=Math.sin(s);m=Math.sin(e);f=(p+r*j).toFixed(3)+','+(c+r*k).toFixed(3);g=(p+d*j).toFixed(3)+','+(c+d*k).toFixed(3);h=(p+d*E).toFixed(3)+','+(c+d*m).toFixed(3);i=(p+r*E).toFixed(3)+','+(c+r*m).toFixed(3);S="M"+f+"L"+g+"A"+d+','+d+" 0 "+o+" 1 "+h+"L"+i+"A"+r+','+r+" 0 "+o+" 0 "+f+"z";return S;};P.prototype._destroyImage=function(){if(this._oImageControl){this._oImageControl.destroy();}this._oImageControl=null;};P.prototype._clampText=function(){var $=this.$("lh-text").length?this.$("lh-text"):null,t=this.getText(),L="",e=P._constants.ellipsis,E=P._constants.ellipsisLength,s=E+1,m,i=t.length,M,v;if($){M=parseInt($.css("height").slice(0,-2),10);if($[0].scrollHeight>M){v=$.css("visibility");$.css("visibility","hidden");L=t;do{m=(s+i)>>1;$.textContent=t.slice(0,m-E)+e;if($.scrollHeight>M){i=m;}else{s=m;L=$.textContent;}}while(i-s>1);$.css("visibility",v);}if($.scrollHeight>M){$.textContent=L;}}};P._hasNativeLineClamp=(function(){return document.documentElement.style.webkitLineClamp!==undefined;}());P.prototype._getAriaText=function(){var A="";var s=this.getState();if(s){var c=[];for(var i in s){c.push(s[i].value);}this._clampValues(c,0,0);this._rescaleToUnit(c);A=this._oResBundle.getText('PF_ARIA_STATUS');for(var j in s){if(s[j].value!==0){var v=" "+Math.round(c[j]*100)+"% "+s[j].state+",";A=A.concat(v);}}A=A.slice(0,-1);}return A;};P.prototype._getSymbolAriaText=function(){var A="";switch(this._getSymbolType()){case P.symbolType.startSymbol:A=this._oResBundle.getText('PF_ARIA_SYMBOL_LANE_START');break;case P.symbolType.endSymbol:A=this._oResBundle.getText('PF_ARIA_SYMBOL_LANE_END');break;case P.symbolType.processSymbol:A=this._oResBundle.getText('PF_ARIA_SYMBOL_LANE_PROCESS');break;default:}return A;};P.createNewStartSymbol=function(i){var s=new P({laneId:"processFlowLaneStart"});s._setSymbolType(P.symbolType.startSymbol,s);s._setHeaderMode(i);return s;};P.createNewEndSymbol=function(i){var e=new P({laneId:"processFlowLaneEnd"});e._setSymbolType(P.symbolType.endSymbol,e);e._setHeaderMode(i);return e;};P.createNewProcessSymbol=function(i){var p=new P({laneId:"processFlowLaneProcess",iconSrc:"sap-icon://process"});p._setSymbolType(P.symbolType.processSymbol,p);p._setHeaderMode(i);return p;};P.enableEllipsisSupportForText=function(i){this._ellipsisDisabled=!i;};P.prototype.getPosition=function(){if(this._mergedLanePosition){return this._mergedLanePosition;}else{return this.getProperty("position");}};return P;});
