/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["jquery.sap.global","./library","sap/suite/ui/commons/util/HtmlElement","sap/ui/core/format/DateFormat","sap/ui/core/Icon"],function(q,l,H,D,I){"use strict";var T=l.TimelineAlignment;var a={};var r=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons"),M=24*60*60*1000;a.render=function(R,t){this._getTimelineItemElement(t).getRenderer().render(R);};a._getTimelineItemElement=function(t){if(t._orientation==="V"){return this._getVerticalTimelineItemElement(t);}else{return this._getHorizontalTimelineItemElement(t);}};a._getFormatedDateTime=function(t,A){A=A||{};var R=A.resBundle||r,d=A.dateFormat||D.getDateInstance({style:"short"}),o=A.timeFormat||D.getTimeInstance({style:"short"}),b=t.getDateTimeWithoutStringParse(),c,e,i,C;if(!(b instanceof Date)){return b;}c=Date.UTC(b.getFullYear(),b.getMonth(),b.getDate());e=new Date();e=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate());i=Math.floor((e-c)/M);switch(i){case 0:C=R.getText("TIMELINE_TODAY");break;case 1:C=R.getText("TIMELINE_YESTERDAY");break;default:C=d.format(b);}return C+" "+R.getText("TIMELINE_AT")+" "+o.format(b);};a._getHorizontalTimelineItemElement=function(t){var i=(t._placementLine==="top"),s=i?"sapSuiteUiCommonsTimelineItemHTop":"sapSuiteUiCommonsTimelineItemHBottom",b=t.getText()==="GroupHeader",g=t._groupID,A,o;if(b){return this._getGroupHeaderElement(t);}var e=new H("li"),c=new H("div"),d=new H("div"),f=new H("div"),h=new H("div"),j=new H("div"),k=new H("div"),m=this._getTimelineItemShell(t);if(g){e.setAttribute("groupid",t._groupID);}if(t._isFirstGroupEvenItem){e.setAttribute("firstgroupevenitem",t._isFirstGroupEvenItem);}e.addControlData(t);e.addClass("sapSuiteUiCommonsTimelineItemLiWrapperV");e.addClass(q.sap.encodeHTML(s));c.addClass("sapSuiteUiCommonsTimelineItemWrapperH sapSuiteUiCommonsTimelineItemBaseLength");e.addChild(c);d.addClass("sapSuiteUiCommonsTimelineItemBubbleSpacer");c.addChild(d);f.addClass("sapSuiteUiCommonsTimelineItemBubble");d.addChild(f);h.addClass("sapSuiteUiCommonsTimelineItemOutline");h.setId(t.getId()+"-outline");h.setAttribute("tabindex","0");h.setAttribute("data-sap-ui-fastnavgroup",true);this._addAccessibilityTags(h,t);j.addClass("sapSuiteUiCommonsTimelineItemBox");h.addChild(j);k.addClass("sapSuiteUiCommonsTimelineItemArrow");if(i){f.addChild(h);f.addChild(k);}else{f.addChild(k);f.addChild(h);}if(!t._callParentFn("_isGrouped")&&t._callParentFn("getEnableDoubleSided")&&t._index===1){o=t.getParent();A="margin-left";if(o&&o._bRtlMode){A="margin-right";}e.addStyle(q.sap.encodeCSS(A),"100px");}j.addChild(m);if(t._isGroupCollapsed()){e.addStyle("display","none");}return e;};a._getGroupHeaderElement=function(t){var e=new H("li"),b=new H("div"),c=new H("div"),d=new H("div"),f=new H("div"),g=new H("div"),h=new H("span"),i=new H("div"),j=new H("div"),k=new H("div"),m=t._orientation==="V"?c:d,n=new H("div"),o=new H("div"),p=new H("div");var s=t._isGroupCollapsed(),S=t._callParentFn("getShowIcons"),u;if(t._groupID){e.setAttribute("groupid",t._groupID);}if(t._isLastGroup){e.addClass("sapSuiteUiCommonsTimelineLastItem");}e.addControlData(t);e.addClass("sapSuiteUiCommonsTimelineGroupHeader");this._addAccessibilityTags(e,t,true);e.addChild(b);b.addChild(c);b.addClass("sapSuiteUiCommonsTimelineGroupHeaderDirectChild");c.addClass("sapSuiteUiCommonsTimelineGroupHeaderMainWrapper");c.setId(t.getId()+"-outline");c.setAttribute("tabindex","0");c.setAttribute("data-sap-ui-fastnavgroup",true);c.addChild(d);e.addChild(k);e.setAttribute("nodeType","GroupHeader");f.addClass("sapSuiteUiCommonsTimelineGroupHeaderSpanWrapper");if(t._orientation==="V"){e.addClass(t._position===T.Left?"sapSuiteUiCommonsTimelineItemWrapperVLeft":"sapSuiteUiCommonsTimelineItemWrapperVRight");}d.addClass("sapSuiteUiCommonsTimelineGroupHeaderWrapper");d.addClass("sapSuiteUiCommonsTimelineGroupHeaderPointer");m.addChild(g);d.addChild(j);d.addChild(f);e.addClass(s?"sapSuiteUiCommonsTimelineGroupCollapsed":"sapSuiteUiCommonsTimelineGroupExpanded");j.addClass("sapSuiteUiCommonsTimelineGroupHeaderIconWrapper");u=t._getCorrectGroupIcon();t._objects.register("groupCollapseIcon",function(){var v=new I(t.getId()+"-groupCollapseIcon",{src:u,decorative:true});v.addStyleClass("sapSuiteUiCommonsTimelineGroupHeaderPointer");v.setParent(t);return v;});j.addChild(t._objects.getGroupCollapseIcon());g.addClass("sapSuiteUiCommonsTimelineItemArrow");k.addClass("sapSuiteUiCommonsTimelineGroupHeaderLineWrapper");i.addClass("sapSuiteUiCommonsTimelineGroupHeaderLine");k.addChild(i);f.addChild(h);h.addClass("sapSuiteUiCommonsTimelineGroupHeaderSpan");h.addChildEscaped(" "+t.getTitle());if(t._orientation==="V"){e.addChild(n);o.addChild(t._getLineIcon());n.addChild(o);o.addClass("sapSuiteUiCommonsTimelineItemBarIconWrapperV");n.addClass("sapSuiteUiCommonsTimelineGroupHeaderBarWrapper");if(!t._isGroupCollapsed()){n.addStyle("display","none");}p.addClass("sapSuiteUiCommonsTimelineItemBarV");if(!S){p.addClass("sapSuiteUiCommonsTimelineItemBarNoIcon");}n.addChild(p);if(t._additionalBarClass){p.addClass(q.sap.encodeHTML(t._additionalBarClass));}}return e;};a._getVerticalTimelineItemElement=function(t){var e=new H("li"),b=new H("div"),c=new H("div"),d=new H("div"),f=new H("div"),g=new H("div"),h=new H("div"),i=new H("div"),j=new H("div"),k=new H("div"),m=new H("div"),n;var s=t._callParentFn("getShowIcons"),G=t._groupID,o=t.getText()==="GroupHeader",S=t._getStatusColorClass();if(o){return this._getGroupHeaderElement(t);}if(G){e.setAttribute("groupID",G);}e.addControlData(t);e.addClass("sapSuiteUiCommonsTimelineItem");e.setAttribute("role","presentation");if(t._isLast){e.addClass("sapSuiteUiCommonsTimelineLastItem");}b.addClass(o?"sapSuiteUiCommonsTimelineItemWrapperGrp":"sapSuiteUiCommonsTimelineItemWrapperV");e.addChild(b);b.addClass(t._position===T.Left?"sapSuiteUiCommonsTimelineItemWrapperVLeft":"sapSuiteUiCommonsTimelineItemWrapperVRight");b.addChild(f);b.addChild(c);c.addClass("sapSuiteUiCommonsTimelineItemBarWrapperV");d.addClass("sapSuiteUiCommonsTimelineItemBarIconWrapperV");if(S){d.addClass(q.sap.encodeHTML(S));}else{d.addClass("sapSuiteUiCommonsTimelineNoStatus");}if(s){c.addChild(d);d.addChild(t._getLineIcon('',G));}else{m.addChild(k);m.addClass("sapSuiteUiCommonsTimelineItemNoIconWrapper");k.addClass("sapSuiteUiCommonsTimelineItemNoIcon");c.addChild(m);if(S){k.addClass(q.sap.encodeHTML(S));}g.addClass("sapSuiteUiCommonsTimelineItemBarNoIcon");}g.addClass("sapSuiteUiCommonsTimelineItemBarV");c.addChild(g);if(t._additionalBarClass){g.addClass(q.sap.encodeHTML(t._additionalBarClass));}f.addClass("sapSuiteUiCommonsTimelineItemBubble");j.addClass("sapSuiteUiCommonsTimelineItemArrow");f.addChild(j);f.addChild(i);i.addClass("sapSuiteUiCommonsTimelineItemOutline");i.setId(t.getId()+"-outline");i.setAttribute("tabindex","0");i.setAttribute("data-sap-ui-fastnavgroup",true);this._addAccessibilityTags(i,t);h.addClass("sapSuiteUiCommonsTimelineItemBox");i.addChild(h);n=this._getTimelineItemShell(t);h.addChild(n);if(t._isGroupCollapsed()){e.addStyle("display","none");}return e;};a._getTimelineItemShell=function(t){var e=new H("div"),b=new H("div"),c=new H("div"),d=new H("span"),u,U,f=new H("span"),g=new H("div"),h=new H("div"),i=new H("div"),j=new H("span"),k=new H("div"),m=new H("span"),n=new H("div"),o;var E=t.getEmbeddedControl();e.setId(t.getId()+"-shell");e.addClass("sapSuiteUiCommonsTimelineItemShell");e.addChild(t._objects.getInfoBar());e.addChild(b);b.addClass("sapSuiteUiCommonsTimelineItemHeaderWrapper");u=t._getUserPictureControl();if(u){u.addStyleClass("sapSuiteUiCommonsTimelineItemUserPicture");b.addChild(u);}c.setId(t.getId()+"-header");c.addClass("sapSuiteUiCommonsTimelineItemHeader");c.addClass("sapSuiteUiCommonsTimelineItemTextLineClamp");d.setId(t.getId()+"-username");d.addClass("sapSuiteUiCommonsTimelineItemShellUser");c.addChild(d);U=t._getUserNameLinkControl();if(U){d.addChild(U);}else{d.addChildEscaped(t.getUserName());d.addClass("sapUiSelectable");}b.addChild(c);f.addClass("sapSuiteUiCommonsTimelineItemShellHdr");f.addClass("sapUiSelectable");f.addChildEscaped(" "+t.getTitle());c.addChild(f);g.addClass("sapSuiteUiCommonsTimelineItemShellDateTime");g.addClass("sapUiSelectable");g.addChildEscaped(this._getFormatedDateTime(t));c.addChild(g);h.addClass("sapSuiteUiCommonsTimelineItemShellBody");e.addChild(h);if(E!==null){h.addChild(E);}else if(t.getText()){i.addChild(j);i.addClass("sapSuiteUiCommonsTimelineItemTextWrapper");j.setId(t.getId()+"-realtext");j.addClass("sapUiSelectable");h.addChild(i);o=t._checkTextIsExpandable();if(o){m.setId(t.getId()+"-threeDots");m.addClass("sapMFeedListItemTextString");m.addChildEscaped(" ");i.addChild(m);j.addChildEscaped(t._getCollapsedText(),true);m.addChildEscaped("... ");i.setAttribute("expandable",true);}else{j.addChildEscaped(t.getText(),true);k.addStyle("display","none");}h.addChild(k);k.addClass("sapSuiteUiCommonsTimelineItemShowMore");k.addChild(t._getButtonExpandCollapse());}if(t.getParent()&&t.getParent()._aFilterList&&(t._callParentFn("getEnableSocial")||t.getCustomAction().length>0)){n.addClass("sapSuiteUiCommonsTimelineItemShellBottom");n.addChild(t._objects.getSocialBar());e.addChild(n);}return e;};a._addAccessibilityTags=function(e,t,i){var g;e.setAttribute("role","option");if(typeof t._index==="number"){e.setAttribute("aria-posinset",t._index+1);e.setAttribute("aria-setsize",t._callParentFn("_getItemsCount"));}e.setAttribute("aria-live","polite");if(i){e.setAttribute("aria-expanded",!t._isGroupCollapsed());g=r.getText("TIMELINE_ACCESSIBILITY_GROUP_HEADER")+": "+t.getTitle();e.setAttribute("aria-label",g);}};return a;},true);
