/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(['jquery.sap.global','./library','sap/ui/core/Control','sap/suite/ui/commons/util/FeedItemUtils'],function(q,l,C,F){"use strict";var a=C.extend("sap.suite.ui.commons.FeedTile",{metadata:{deprecated:true,library:"sap.suite.ui.commons",properties:{displayDuration:{type:"int",group:"Misc",defaultValue:5},displayArticleImage:{type:"boolean",group:"Behavior",defaultValue:true},source:{type:"string",group:"Misc",defaultValue:null},defaultImages:{type:"sap.ui.core.URI[]",group:"Misc",defaultValue:null}},aggregations:{items:{type:"sap.suite.ui.commons.FeedItem",multiple:true,singularName:"item"}},events:{press:{}}}});a.prototype.init=function(){this._currentItemIndex=0;this._stagedModel=null;this._defaultImageIndex=-1;};a.prototype.cycle=function(){if(this._stagedModel){q.sap.log.debug("FeedTile: Updating news tile with new model");this.setModel(this._stagedModel);this._stagedModel=null;var n=this.getItems().length;if(this._currentItemIndex>=n){this._currentItemIndex=0;}return;}var i=this.getItems();this._currentItemIndex=(this._currentItemIndex+1)%i.length;var $=q("#"+this.getId()+"-next-feedTileImage");var b=q("#"+this.getId()+"-feedTileImage");if(q.support.cssTransitions){$.addClass("sapSuiteFTItemRight").removeClass('sapSuiteFTItemHidden');b.addClass('sapSuiteFTItemCenter');setTimeout(function(){var o=false;var A=null;A=function(){q(this).unbind("webkitTransitionEnd transitionend");if(!o){o=true;}else{$.removeClass("sapSuiteFTItemSliding");b.removeClass("sapSuiteFTItemSliding").addClass("sapSuiteFTItemHidden").removeClass("sapSuiteFTItemLeft").addClass("sapSuiteFTItemRight");b.detach();$.after(b);this.flipIds($,b);setTimeout(function(){this.setNextItemValues(this);}.bind(this),100);this._timeoutId=setTimeout(function(){this.cycle();}.bind(this),this.getDisplayDuration()*1000);}};b.bind("webkitTransitionEnd transitionend",A.bind(this));$.bind("webkitTransitionEnd transitionend",A.bind(this));b.addClass('sapSuiteFTItemSliding').removeClass('sapSuiteFTItemCenter').addClass('sapSuiteFTItemLeft');$.addClass('sapSuiteFTItemSliding').removeClass('sapSuiteFTItemRight').addClass('sapSuiteFTItemCenter');}.bind(this),60);}else{$.css("left","100%");$.removeClass("sapSuiteFTItemHidden");$.animate({left:"0%"},400);b.animate({left:"-100%"},400,function(){b.addClass("sapSuiteFTItemHidden");b.css("left","0");this.flipIds($,b);setTimeout(function(){this.setNextItemValues(this);}.bind(this),100);this._timeoutId=setTimeout(function(){this.cycle();}.bind(this),this.getDisplayDuration()*1000);}.bind(this));}};a.prototype.onAfterRendering=function(){var d=this.getDisplayDuration()*1000;if(this.getItems().length>1){if(typeof this._timeoutId==="number"){clearTimeout(this._timeoutId);delete this._timeoutId;}this._timeoutId=setTimeout(function(){this.cycle();}.bind(this),d);}};a.prototype.onclick=function(e){var c=this.getCurrentItem();var i="";if(c&&c.getId()){i=c.getId();}this.firePress({itemId:i});};a.prototype.getCurrentItem=function(){var i=this.getItems();if(i.length){return i[this._currentItemIndex];}};a.prototype.getNextItem=function(){var i=this.getItems();if(i.length&&i.length>1){return i[(this._currentItemIndex+1)%i.length];}};a.prototype.setNextItemValues=function(){var n=this.getNextItem();var i=this.getId();var b=n.getImage();if(!b||!this.getDisplayArticleImage()){b=this.getDefaultImage();}q("#"+i+"-next-feedTileImage").css("background-image","url("+q.sap.encodeCSS(b)+")");q("#"+i+"-next-feedTileTitle").html(q.sap.encodeHTML(n.getTitle()));q("#"+i+"-next-feedTileSource").html(q.sap.encodeHTML(n.getSource()));q("#"+i+"-next-feedTileAge").html(q.sap.encodeHTML(F.calculateFeedItemAge(n.getPublicationDate())));};a.prototype.flipIds=function($,b){var i=this.getId();b.attr("id",i+"-next-feedTileImage");b.find("#"+i+"-feedTileText").attr("id",i+"-next-feedTileText");b.find("#"+i+"-feedTileTitle").attr("id",i+"-next-feedTileTitle");b.find("#"+i+"-feedTileSource").attr("id",i+"-next-feedTileSource");b.find("#"+i+"-feedTileAge").attr("id",i+"-next-feedTileAge");$.attr("id",i+"-feedTileImage");$.find("#"+i+"-next-feedTileText").attr("id",i+"-feedTileText");$.find("#"+i+"-next-feedTileTitle").attr("id",i+"-feedTileTitle");$.find("#"+i+"-next-feedTileSource").attr("id",i+"-feedTileSource");$.find("#"+i+"-next-feedTileAge").attr("id",i+"-feedTileAge");};a.prototype.setDisplayDuration=function(d){if(d<3){d=3;q.sap.log.error("FeedTile: displayDuration should be equal or more than 3 seconds.");}this.setProperty("displayDuration",d);};a.prototype.stageModel=function(m){this._stagedModel=m;};a.prototype.getDefaultImage=function(){var d="";var D=this.getDefaultImages();if(D&&D.length>0){var L=D.length;if(this._defaultImageIndex===-1){var r=Math.floor(Math.random()*L);this._defaultImageIndex=r;d=D[r];}else{var i=(this._defaultImageIndex+1)>=L?0:this._defaultImageIndex+1;this._defaultImageIndex=i;d=D[i];}}return d;};a.prototype.setDefaultImages=function(d){if(d&&d.length>0){var v=[];var D=null;for(var i=0;i<d.length;i++){D=d[i];var b=q.sap.validateUrl(D);if(b){v.push(D);}else{q.sap.log.error("Invalid Url:'"+D);}}if(v.length<=0){q.sap.log.error("Default Images are not set because supplied Urls are invalid");}else{this.setProperty("defaultImages",v);}}};return a;});
