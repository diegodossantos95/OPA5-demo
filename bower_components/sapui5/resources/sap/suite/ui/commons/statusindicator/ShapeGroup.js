/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["jquery.sap.global","sap/ui/core/Control","sap/ui/core/Core","sap/ui/core/Configuration","sap/suite/ui/commons/statusindicator/util/ProgressHandler"],function(q,C,a,b,P){"use strict";var S=C.extend("sap.suite.ui.commons.statusindicator.ShapeGroup",{metadata:{library:"sap.suite.ui.commons",properties:{weight:{type:"int",defaultValue:10}},defaultAggregation:"shapes",aggregations:{shapes:{type:"sap.suite.ui.commons.statusindicator.Shape",multiple:true}}}});S.prototype.init=function(){this._iTargetValue=0;this._oAnimationPropertiesResolver=null;};S.prototype._injectAnimationPropertiesResolver=function(A){this._oAnimationPropertiesResolver=A;this.getShapes().forEach(function(s){s._injectAnimationPropertiesResolver(A);});};S.prototype.addShape=function(s){this.addAggregation("shapes",s,true);s._injectAnimationPropertiesResolver(this._oAnimationPropertiesResolver);};S.prototype._setValue=function(v){var t=this;this._iTargetValue=v;if(!this._isAnimationAllowed()){this.getShapes().forEach(function(s){s._updateDom(t._iTargetValue);});return Promise.resolve();}if(this.oCurrentProgressHandler&&this.oCurrentProgressHandler.isInProgress()){this.oCurrentProgressHandler.cancel();}this.oCurrentProgressHandler=new P(function(p){var n=performance.now();t._animationStep(t._getAnimationDelayHandler(n),n,p,n);});return this.oCurrentProgressHandler.start();};S.prototype._getAnimationDelayHandler=function(A){if(!this._postStartupAnimationDelayHandler){this._postStartupAnimationDelayHandler={delayAnimation:function(){return false;}};return{delayAnimation:function(s,c){return s.getAnimationOnStartup()&&(A+s.getAnimationOnStartupDelay()>c);}};}return this._postStartupAnimationDelayHandler;};S.prototype._animationStep=function(d,l,p,c){c=Math.max(c,l);if(p.isCanceled()){p.stop({cancelled:true});return;}var A=true;var t=this._iTargetValue;this.getShapes().forEach(function(s){var D=s.getDisplayedValue();if(D===t){return;}if(d.delayAnimation(s,c)){A=false;return;}var T=l+s.getFullAnimationDuration()*Math.abs(t-D)/100;if(c>=T){s._updateDom(t);}else{var i=t-D;var e=T-l;var f=(c-l)/e;s._updateDom(i*f+D);A=false;}});if(A){p.finish();}else{window.requestAnimationFrame(this._animationStep.bind(this,d,c,p));}};S.prototype._showsFullProgress=function(){return!this.getShapes().some(function(s){return s.getDisplayedValue()!==100;});};S.prototype._setInitialValue=function(i){this._iTargetValue=i;this.getShapes().forEach(function(s){if(!s.getAnimationOnStartup()){s._setInitialValue(i);}});};S.prototype._getHtmlElements=function(){var r=[];this.getShapes().forEach(function(s){r=r.concat(s._getHtmlElements());});return r;};S.prototype._isAnimationAllowed=function(){var A=a.getConfiguration();var s=A.getAnimationMode();return s===b.AnimationMode.full;};return S;});
