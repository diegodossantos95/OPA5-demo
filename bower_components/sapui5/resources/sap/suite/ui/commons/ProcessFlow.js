/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["jquery.sap.global","./library","sap/m/library","sap/ui/core/Control","sap/suite/ui/commons/ProcessFlowConnection","sap/suite/ui/commons/ProcessFlowLaneHeader","sap/ui/Device","sap/ui/core/ResizeHandler"],function(q,l,M,C,P,a,D,R){"use strict";var b=C.extend("sap.suite.ui.commons.ProcessFlow",{metadata:{library:"sap.suite.ui.commons",properties:{foldedCorners:{type:"boolean",group:"Misc",defaultValue:false},scrollable:{type:"boolean",group:"Misc",defaultValue:true},wheelZoomable:{type:"boolean",group:"Behavior",defaultValue:true},showLabels:{type:"boolean",group:"Appearance",defaultValue:false}},defaultAggregation:"lanes",aggregations:{_connections:{type:"sap.suite.ui.commons.ProcessFlowConnection",multiple:true,singularName:"_connection",visibility:"hidden"},nodes:{type:"sap.suite.ui.commons.ProcessFlowNode",multiple:true,singularName:"node"},lanes:{type:"sap.suite.ui.commons.ProcessFlowLaneHeader",multiple:true,singularName:"lane"}},events:{nodeTitlePress:{deprecated:true,parameters:{oEvent:{type:"object"}}},nodePress:{parameters:{oEvent:{type:"object"}}},labelPress:{parameters:{oEvent:{type:"object"}}},headerPress:{parameters:{oEvent:{type:"object"}}},onError:{parameters:{oEvent:{type:"object"}}}}}});b.prototype._resBundle=null;b._cellEdgeConstants={"LU":"tl","LD":"lb","DU":"tb","LR":"rl","DR":"rt","UR":"rb"};b._constants={scrollContainer:"scrollContainer",counterLeft:"counterLeft",counterRight:"counterRight",arrowScrollRight:"arrowScrollRight",arrowScrollRightMinus:"-arrowScrollRight",arrowScrollLeft:"arrowScrollLeft",arrowScrollLeftMinus:"-arrowScrollLeft",top:"top",px:"px",parents:"parents",left:"left",right:"right"};b._mouseEvents={mouseMove:"mousemove",mouseDown:"mousedown",mouseUp:"mouseup",mouseLeave:"mouseleave",mouseEnter:"mouseenter",touchStart:"touchstart",sapTouchStart:"saptouchstart",touchEnd:"touchend",sapTouchCancel:"saptouchcancel"};b._enumMoveDirection={"LEFT":"left","RIGHT":"right","UP":"up","DOWN":"down"};b.prototype._zoomLevel=l.ProcessFlowZoomLevel.Two;b.prototype._wheelTimeout=null;b.prototype._isFocusChanged=false;b.prototype._wheelTimestamp=null;b.prototype._wheelCalled=false;b.prototype._internalCalcMatrix=false;b.prototype._internalConnectionMap=null;b.prototype._internalLanes=false;b.prototype._jumpOverElements=5;b.prototype._lastNavigationFocusElement=null;b.prototype._bHighlightedMode=false;b.prototype._isLayoutOptimized=false;b.prototype._defaultCursorClass="sapSuiteUiDefaultCursorPF";if(D.browser.msie||D.browser.edge){b.prototype._grabCursorClass="sapSuiteUiGrabCursorIEPF";b.prototype._grabbingCursorClass="sapSuiteUiGrabbingCursorIEPF";}else{b.prototype._grabCursorClass="sapSuiteUiGrabCursorPF";b.prototype._grabbingCursorClass="sapSuiteUiGrabbingCursorPF";}b.prototype._mousePreventEvents="contextmenu dblclick";b.prototype._mouseEvents="contextmenu mousemove mouseleave mousedown mouseup mouseenter";b.prototype._mouseWheelEvent=D.browser.mozilla?"DOMMouseScroll MozMousePixelScroll":"mousewheel wheel";b.prototype._headerHasFocus=false;b.prototype._isInitialZoomLevelNeeded=true;b.prototype._bDoScroll=!D.system.desktop||D.os.windows&&D.os.version>=8;b.prototype._scrollStep=192;b.prototype._bPreviousScrollForward=false;b.prototype._bPreviousScrollBack=false;b.prototype._iInitialArrowTop=undefined;b.prototype._iInitialCounterTop=undefined;b.prototype._bRtl=false;b.prototype._arrowScrollable=null;b.prototype._iTouchStartScrollTop=undefined;b.prototype._iTouchStartScrollLeft=undefined;b.prototype._bSetFocusOnce=true;b.prototype.init=function(){this._bRtl=sap.ui.getCore().getConfiguration().getRTL();if(!this._resBundle){this._resBundle=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons");}this._internalLanes=[];if(this._getScrollContainer()){this._getScrollContainer().bind("keydown",q.proxy(this.onkeydown,this));}};b.prototype.exit=function(){var n=this.getNodes(),i;if(n){for(i=0;i<n.length;i++){if(n[i]){n[i].destroy();}}n=null;}if(this._internalLanes){for(i=0;i<this._internalLanes.length;i++){this._internalLanes[i].destroy();}this._internalLanes=null;}var I=this.getAggregation("_connections");if(I){for(i=0;i<I.length;i++){I[i].destroy();}I=null;}if(this._oArrowLeft){this._oArrowLeft.destroy();}if(this._oArrowRight){this._oArrowRight.destroy();}if(this._resizeRegId){R.deregister(this._resizeRegId);}if(this._internalCalcMatrix){delete this._internalCalcMatrix;this._internalCalcMatrix=null;}if(this._getScrollContainer()){this._getScrollContainer().unbind(this._mousePreventEvents,this._handlePrevent);this._getScrollContainer().unbind(this._mouseEvents,q.proxy(this._registerMouseEvents,this));this._getScrollContainer().unbind(this._mouseWheelEvent,q.proxy(this._registerMouseWheel,this));this._getScrollContainer().unbind("keydown",q.proxy(this.onkeydown,this));this._getScrollContainer().unbind("scroll",q.proxy(this._onScroll,this));}};b.prototype.onBeforeRendering=function(){if(this._getScrollContainer()){this._getScrollContainer().unbind(this._mousePreventEvents,this._handlePrevent);this._getScrollContainer().unbind(this._mouseEvents,q.proxy(this._registerMouseEvents,this));this._getScrollContainer().unbind(this._mouseWheelEvent,q.proxy(this._registerMouseWheel,this));this._getScrollContainer().unbind("keydown",q.proxy(this.onkeydown,this));this._getScrollContainer().unbind("scroll",q.proxy(this._onScroll,this));}};b.prototype.onAfterRendering=function(){var s=false,$=this.$("scroll-content"),h,w,S,i;this._checkOverflow(this._getScrollContainer().get(0),this.$());this.iCursorPositionX=0;this.iCursorPositionY=0;if($&&$.length){this._getScrollContainer().find(".sapSuiteUiCommonsProcessFlowNode .sapUiIcon").css("cursor","inherit");if(this.getScrollable()){h=parseInt(this._getScrollContainer().css("height").slice(0,-2),10);w=parseInt(this._getScrollContainer().css("width").slice(0,-2),10);i=$[0].scrollHeight;S=$[0].scrollWidth;if(i<=h&&S<=w){this._clearHandlers(this._getScrollContainer());this._switchCursors(this._getScrollContainer(),this._grabCursorClass,this._defaultCursorClass);}else{this._switchCursors(this._getScrollContainer(),this._defaultCursorClass,this._grabCursorClass);s=true;}}else{this._clearHandlers(this._getScrollContainer());this._switchCursors(this._getScrollContainer(),this._grabCursorClass,this._defaultCursorClass);$.css("position","static");}if(s){if(!this._iInitialArrowTop||!this._iInitialCounterTop){this._iInitialArrowTop=parseInt(this.$(b._constants.arrowScrollRight).css(b._constants.top),10);this._iInitialCounterTop=parseInt(this.$(b._constants.counterRight).css(b._constants.top),10);}if(D.os.windows&&D.system.combi&&D.browser.chrome){this._getScrollContainer().bind(this._mouseEvents,q.proxy(this._registerMouseEvents,this));this._getScrollContainer().css("overflow","auto");}else if(D.os.windows&&(D.browser.msie&&(D.browser.version>9)||D.browser.edge)){this._getScrollContainer().bind(this._mouseEvents,q.proxy(this._registerMouseEvents,this));this._getScrollContainer().css("overflow","auto");this._getScrollContainer().css("-ms-overflow-style","none");}else if(!D.support.touch&&!q.sap.simulateMobileOnDesktop){this._getScrollContainer().bind(this._mouseEvents,q.proxy(this._registerMouseEvents,this));}else{this._clearHandlers(this._getScrollContainer());this._getScrollContainer().css("overflow","auto");}}else if(this._bDoScroll){this._getScrollContainer().css("overflow","auto");}else{this._getScrollContainer().css("overflow","hidden");}if(this.getWheelZoomable()&&D.system.desktop&&!this._isHeaderMode()){this._getScrollContainer().bind(this._mouseWheelEvent,q.proxy(this._registerMouseWheel,this));}if(this._bDoScroll){this._getScrollContainer().bind("scroll",q.proxy(this._onScroll,this));}this._resizeRegId=R.register(this,q.proxy(b.prototype._onResize,this));if(this._isInitialZoomLevelNeeded){this._initZoomLevel();}if(this._headerHasFocus){this._headerHasFocus=false;var c=this.$("scroll-content").children().children().children(1).children("td[tabindex='0']").first().children();var n=sap.ui.getCore().byId(c[0].id);this._changeNavigationFocus(null,n);}}};b.prototype.ontouchend=function(e){if(e.target&&e.target.id.indexOf("arrowScroll")!==-1){this._onArrowClick(e);}else{if(!D.support.touch&&!q.sap.simulateMobileOnDesktop){this.onAfterRendering();}else{this._adjustAndShowArrow();}if(e===null||e.oSource===undefined){return;}e.preventDefault();if(this._isHeaderMode()){this._internalLanes=[];this.fireHeaderPress(this);}}};b.prototype._handlePrevent=function(e){if(e&&!e.isDefaultPrevented()){e.preventDefault();}if(e&&!e.isPropagationStopped()){e.stopPropagation();}if(e&&!e.isImmediatePropagationStopped()){e.stopImmediatePropagation();}};b.prototype._onResize=function(){var A=new Date().getTime();if(!this._iLastResizeEventTime||((A-this._iLastResizeEventTime)<50)){if(!this._iLastResizeHandlingTime||(A-this._iLastResizeHandlingTime>500)){this.onAfterRendering();this._iLastResizeHandlingTime=new Date().getTime();}}else{this._iLastResizeHandlingTime=null;}this._iLastResizeEventTime=new Date().getTime();};b.prototype._registerMouseEvents=function(e){if(e&&!e.isDefaultPrevented()){e.preventDefault();}switch(e.type){case b._mouseEvents.mouseMove:if(this._getScrollContainer().hasClass(this._grabbingCursorClass)){if(sap.ui.getCore().getConfiguration().getRTL()){this._getScrollContainer().scrollLeftRTL(this.iCursorPositionX-e.pageX);}else{this._getScrollContainer().scrollLeft(this.iCursorPositionX-e.pageX);}this._getScrollContainer().scrollTop(this.iCursorPositionY-e.pageY);this._adjustAndShowArrow();}break;case b._mouseEvents.mouseDown:this._switchCursors(this._getScrollContainer(),this._defaultCursorClass,this._grabbingCursorClass);if(sap.ui.getCore().getConfiguration().getRTL()){this.iCursorPositionX=this._getScrollContainer().scrollLeftRTL()+e.pageX;}else{this.iCursorPositionX=this._getScrollContainer().scrollLeft()+e.pageX;}this.iCursorPositionY=this._getScrollContainer().scrollTop()+e.pageY;if(D.system.combi){this._iTouchStartScrollLeft=this._getScrollContainer().scrollLeft();if(this.getScrollable()){this._iTouchStartScrollTop=this._getScrollContainer().scrollTop();}}break;case b._mouseEvents.mouseUp:this._switchCursors(this._getScrollContainer(),this._grabbingCursorClass,this._grabCursorClass);break;case b._mouseEvents.mouseLeave:this._getScrollContainer().removeClass(this._grabbingCursorClass);this._getScrollContainer().removeClass(this._grabCursorClass);this._getScrollContainer().addClass(this._defaultCursorClass);break;case b._mouseEvents.mouseEnter:this._getScrollContainer().removeClass(this._defaultCursorClass);if(e.buttons===null){if(e.which===1){this._getScrollContainer().addClass(this._grabbingCursorClass);}else{this._getScrollContainer().addClass(this._grabCursorClass);}}else if(e.buttons===0){this._getScrollContainer().addClass(this._grabCursorClass);}else if(e.buttons===1){this._getScrollContainer().addClass(this._grabbingCursorClass);}break;default:}if(e.target&&e.target.parentElement&&e.target.parentElement.parentElement&&e.target.parentElement.parentElement.getMetadata&&e.target.parentElement.parentElement.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnectionLabel"){if(e&&!e.isPropagationStopped()){e.stopPropagation();}if(e&&!e.isImmediatePropagationStopped()){e.stopImmediatePropagation();}}};b.prototype.onfocusin=function(e){var t;if(e&&e.target&&e.target.id){t=sap.ui.getCore().byId(e.target.id);}if(this._isHeaderMode()){this._setFocusOnHeader(true);}else if(this._bSetFocusOnce&&!(t&&e.target.id.indexOf("arrowScroll"))){this._bSetFocusOnce=false;if(t&&t.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnectionLabel"){this._changeNavigationFocus(null,t);}else if(!this._lastNavigationFocusElement){var $=this.$("scroll-content").children().children().children(1).children("td[tabindex='0']").first().children();var n=sap.ui.getCore().byId($[0].id);this._changeNavigationFocus(null,n);}else if(this._lastNavigationFocusElement){this._changeNavigationFocus(null,this._lastNavigationFocusElement);}}};b.prototype.onfocusout=function(){this._bSetFocusOnce=true;if(this._lastNavigationFocusElement&&this._lastNavigationFocusElement._getNavigationFocus()){this._lastNavigationFocusElement._setNavigationFocus(false);if(this._lastNavigationFocusElement.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){this._lastNavigationFocusElement.rerender();}}};b.prototype.onsapplus=function(){this._isFocusChanged=true;this.zoomIn();};b.prototype.onsapminus=function(){this._isFocusChanged=true;this.zoomOut();};b.prototype.onsaptabnext=function(e){var f=true;var $=e.target;var A=sap.ui.getCore().byId($.id);if(!A&&$&&$.childElementCount>0){$=$.childNodes[0];A=sap.ui.getCore().byId($.id);}if(!A||(A.getMetadata().getName()!=="sap.suite.ui.commons.ProcessFlowNode"&&A.getMetadata().getName()!=="sap.suite.ui.commons.ProcessFlowConnectionLabel")){if(!this._isHeaderMode()&&!this._lastNavigationFocusElement){var c=this.$("scroll-content").children().children().children(1).children("td[tabindex='0']").first().children();var n=sap.ui.getCore().byId(c[0].id);this._changeNavigationFocus(null,n);f=false;}else if(this._lastNavigationFocusElement){this._changeNavigationFocus(null,this._lastNavigationFocusElement);f=false;}}if(this._isHeaderMode()&&f){if(!this._headerHasFocus){this._setFocusOnHeader(true);}else{this._setFocusOnHeader(false);}}else if(this._lastNavigationFocusElement&&this._lastNavigationFocusElement.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){this._lastNavigationFocusElement.rerender();}var N;if(f){N=this.$().nextAll().find(":focusable").first();if(N.length===0){s.apply(this);}N.focus();q.sap.log.debug("saptabnext: Keyboard focus has been changed to element:  id='"+N.id+"' outerHTML='"+N.outerHTML+"'");N=null;}e.preventDefault();function s(){var d=this.$().parent();do{N=d.next(":focusable");if(N.length===0){N=d.nextAll().find(":focusable").first();}d=d.parent();}while((d.length!==0)&&(N.length===0));}};b.prototype.onsaptabprevious=function(e){var p=null;var $=e.target;if((!this._lastNavigationFocusElement||!this._lastNavigationFocusElement._getNavigationFocus())&&e.target&&e.target.childElementCount>0){$=e.target.childNodes[0];}var A=sap.ui.getCore().byId($.id);if(A&&(A.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"||A.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode")){if(!this._isHeaderMode()&&!this._lastNavigationFocusElement){var c=this.$("scroll-content").children().children().children(1).children("td[tabindex='0']").first().children();var n=sap.ui.getCore().byId(c[0].id);this._changeNavigationFocus(null,n);}else if(this._lastNavigationFocusElement){this._changeNavigationFocus(null,this._lastNavigationFocusElement);e.preventDefault();return;}}if(this._isHeaderMode()){if(!this._headerHasFocus){this._setFocusOnHeader(true);}else{this._setFocusOnHeader(false);p=this.$().prevAll().find(":focusable").first();}}else{p=this.$().prev(":focusable");if(p.length===0){p=this.$().prevAll().find(":focusable").first();}if(this._lastNavigationFocusElement){this._lastNavigationFocusElement._setNavigationFocus(false);}if(this._lastNavigationFocusElement&&this._lastNavigationFocusElement.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){this._lastNavigationFocusElement.rerender();}}if(p){if(p.length===0){s.apply(this);}else if(p.first().length!==0){p=q(p.first());}p.focus();q.sap.log.debug("saptabnext: Keyboard focus has been set on element:  id='"+p.id+"' outerHTML='"+p.outerHTML+"'");p=null;}e.preventDefault();function s(){var d=this.$();do{p=d.prev(":focusable");if(p.length===0){p=d.prevAll().find(":focusable").last();}d=d.parent();}while((d.length!==0)&&(p.length===0));}};b.prototype._handleKeySelect=function(e){if(this._isHeaderMode()){this._internalLanes=[];this.fireHeaderPress(this);var $=this.$("scroll-content").children().children().children(1).children("td[tabindex='0']").first().children();var n=sap.ui.getCore().byId($[0].id);this._changeNavigationFocus(null,n);}else if(this._lastNavigationFocusElement&&this._lastNavigationFocusElement.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"&&this._lastNavigationFocusElement._getNavigationFocus()){var f=this._lastNavigationFocusElement;f._handleEvents(e);}};b.prototype.onkeyup=function(e){var k=e.keyCode?e.keyCode:e.which;switch(k){case q.sap.KeyCodes.ENTER:case q.sap.KeyCodes.SPACE:var f=this._lastNavigationFocusElement;if(f){this.fireNodePress(this._lastNavigationFocusElement);f._handleEvents(e);}break;default:break;}};b.prototype.onkeydown=function(e){var k=(e.keyCode?e.keyCode:e.which);q.sap.log.debug("ProcessFlow::keyboard input has been catched and action going to start: keycode="+k);var E=false;var c=e.ctrlKey;var d=e.altKey;var p=this._lastNavigationFocusElement;switch(k){case q.sap.KeyCodes.ARROW_RIGHT:E=this._moveToNextElement(b._enumMoveDirection.RIGHT);break;case q.sap.KeyCodes.ARROW_LEFT:E=this._moveToNextElement(b._enumMoveDirection.LEFT);break;case q.sap.KeyCodes.ARROW_DOWN:E=this._moveToNextElement(b._enumMoveDirection.DOWN);break;case q.sap.KeyCodes.ARROW_UP:E=this._moveToNextElement(b._enumMoveDirection.UP);break;case q.sap.KeyCodes.PAGE_UP:E=this._moveOnePage(b._enumMoveDirection.UP,d);break;case q.sap.KeyCodes.PAGE_DOWN:E=this._moveOnePage(b._enumMoveDirection.DOWN,d);break;case q.sap.KeyCodes.HOME:E=this._moveHomeEnd(b._enumMoveDirection.LEFT,c);break;case q.sap.KeyCodes.END:E=this._moveHomeEnd(b._enumMoveDirection.RIGHT,c);break;case q.sap.KeyCodes.NUMPAD_0:case q.sap.KeyCodes.DIGIT_0:this._initZoomLevel();break;case q.sap.KeyCodes.ENTER:case q.sap.KeyCodes.SPACE:this._handleKeySelect(e);e.preventDefault();return;default:return;}e.preventDefault();if(E){this._changeNavigationFocus(p,this._lastNavigationFocusElement);}};b.prototype._onArrowClick=function(e){var t=e.target.id;if(t){var i=this.getId();e.preventDefault();if(t===i+b._constants.arrowScrollLeftMinus&&D.system.desktop){this._scroll(-this._scrollStep,500);}else if(t===i+b._constants.arrowScrollRightMinus&&D.system.desktop){this._scroll(this._scrollStep,500);}}};b.prototype._onScroll=function(){var s=this._getScrollContainer().scrollLeft();var d=Math.abs(s-this._iTouchStartScrollLeft);if(d>(this._scrollStep/4)&&!this._isFocusChanged){this._adjustAndShowArrow();this._iTouchStartScrollLeft=s;}else if(this.getScrollable()){var S=this._getScrollContainer().scrollTop();var i=Math.abs(S-this._iTouchStartScrollTop);if(i>10){this._moveArrowAndCounterVertical();this._iTouchStartScrollTop=S;}}};b.prototype.ontouchstart=function(){this._iTouchStartScrollLeft=this._getScrollContainer().scrollLeft();if(this.getScrollable()){this._iTouchStartScrollTop=this._getScrollContainer().scrollTop();}};b.prototype.ontouchmove=function(e){e.setMarked();};b.prototype._handleLabelClick=function(e){if(e){var c=e.getSource();if(c&&c.getMetadata().getName()==="sap.ui.core.Icon"){c=c.getParent();}if(c&&c.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnectionLabel"){var r=this._getConnectionMapEntries(c);var d=this._createLabelPressEventArgs(c,r);this.fireLabelPress(d);}}};b.prototype._onFocusChanged=function(){var f=this._lastNavigationFocusElement,$=f?f.$():null,s,S,i,c,d,e,g,E,h,p,j,k,m,n,o,r,t=500;if(f&&this.getScrollable()){q.sap.log.debug("The actually focused element is "+f.getId());if(f.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnectionLabel"){E=$.parent().parent().parent().outerWidth();h=$.parent().parent().parent().outerHeight();p=$.parent().parent().parent().position();}else{E=$.outerWidth();h=$.outerHeight();p=$.position();}q.sap.log.debug("Element outer width x height ["+E+" x "+h+"]");q.sap.log.debug("Position of element in the content is ["+p.left+", "+p.top+"]");d=this.$("scroll-content");s=this._getScrollContainer().innerWidth();S=this._getScrollContainer().innerHeight();q.sap.log.debug("Scroll container inner width x height ["+s+" x "+S+"]");i=this._getScrollContainer().scrollLeft();c=this._getScrollContainer().scrollTop();q.sap.log.debug("Current scroll offset is ["+i+", "+c+"]");e=d.innerWidth();g=d.innerHeight();q.sap.log.debug("Scroll content inner width x height ["+e+" x "+g+"]");j=-i+p.left;m=j+E;k=-c+p.top;n=k+h;if((m>s)||(j<0)||(n>S)||(k<0)){o=Math.round((s-E)/2);o=Math.max(s-e+p.left,o);o=Math.min(p.left,o);r=Math.round((S-h)/2);r=Math.max(S-g+p.top,r);r=Math.min(p.top,r);q.sap.log.debug("Element lies outside the scroll container, scrolling from ["+j+","+k+"] to ["+o+","+r+"]");this._isFocusChanged=true;this._getScrollContainer().animate({scrollTop:p.top-r,scrollLeft:p.left-o},t,"swing",q.proxy(this._adjustAndShowArrow,this));}else{q.sap.log.debug("Element lies inside the scroll container, no scrolling happens.");this._setFocusToNode(f);}}else{this._setFocusToNode(f);this._adjustAndShowArrow();}};b.prototype._setScrollWidth=function(){switch(this.getZoomLevel()){case(l.ProcessFlowZoomLevel.One):this._scrollStep=240;break;case(l.ProcessFlowZoomLevel.Two):this._scrollStep=192;break;case(l.ProcessFlowZoomLevel.Three):this._scrollStep=168;break;case(l.ProcessFlowZoomLevel.Four):this._scrollStep=128;break;default:this._scrollStep=192;}};b.prototype._getLastNavigationFocusElement=function(){return this._lastNavigationFocusElement;};b.prototype._getNode=function(n,c){for(var i=0;i<c.length;i++){if(c[i].getNodeId()===n.toString()){return c[i];}}};b.prototype._getLane=function(c){for(var i=0;i<this._internalLanes.length;i++){if(this._internalLanes[i].getLaneId()===c){return this._internalLanes[i];}}};b._getChildIdByElement=function(c){if(typeof c==="object"){return c.nodeId;}else{return c;}};b.prototype._isHeaderMode=function(){var n=this.getNodes();return!n||(n.length===0);};b.prototype._getScrollContainer=function(){return this.$(b._constants.scrollContainer);};b.prototype._handleException=function(e){var t=this._resBundle.getText("PF_ERROR_INPUT_DATA");this.fireOnError({text:t});q.sap.log.error("Error loading data for the process flow with id : "+this.getId());if(e instanceof Array){for(var i=0;i<e.length;i++){q.sap.log.error("Detailed description ("+i+") :"+e[i]);}}else{q.sap.log.error("Detailed description  :"+e);}};b.prototype._getAriaText=function(){return this._resBundle.getText("PF_ARIA_PROCESS_FLOW");};b.prototype._updateLanesFromNodes=function(){b.NodeElement._createNodeElementsFromProcessFlowNodes(this.getNodes(),this.getLanes());var i=this._arrangeNodesByParentChildRelation(this.getNodes());this._internalLanes=b.NodeElement._updateLanesFromNodes(this.getLanes(),i).lanes;};b.prototype._getOrCreateLaneMap=function(){if(!this._internalLanes||this._internalLanes.length<=0){this._updateLanesFromNodes();}return b.NodeElement._createMapFromLanes(this._internalLanes,q.proxy(this.ontouchend,this),this._isHeaderMode()).positionMap;};b.prototype._arrangeNodesByParentChildRelation=function(c){var I=c?c.length:0;var d=[];var i,j;if(I>0){this._setParentForNodes(c);for(i=0;i<I;i++){d=c[i].getChildren();if(d){var e=d.length;for(j=0;j<e;j++){d[j]=b._getChildIdByElement(d[j]).toString();}}for(j=0;j<i;j++){if(q.inArray(c[j].getNodeId(),d)>-1&&c[j].getLaneId()===c[i].getLaneId()){c.splice(j,0,c[i]);c.splice(i+1,1);c=this._arrangeNodesByParentChildRelation(c);break;}}}}return c;};b.prototype._getOrCreateProcessFlow=function(){if(!this._internalLanes||this._internalLanes.length<=0){this._updateLanesFromNodes();}this.applyNodeDisplayState();var I=this.getNodes();var r=b.NodeElement._createNodeElementsFromProcessFlowNodes(I,this._internalLanes);var e=r.elementById;var E=r.elementsByLane;var c=this._calculateMatrix(e);c=this._addFirstAndLastColumn(c);b.NodeElement._calculateLaneStatePieChart(E,this._internalLanes,I,this);for(var i=0;i<c.length;i++){for(var j=0;j<c[i].length;j++){if(c[i][j]instanceof b.NodeElement){c[i][j]=e[c[i][j].nodeId].oNode;}}}this._internalCalcMatrix=c;return c;};b.prototype._addFirstAndLastColumn=function(c){if(!c||c.length<=0){return[];}var o=c.length;for(var i=0;i<o;i++){c[i].unshift(null);c[i].push(null);}return c;};b.prototype._calculateMatrix=function(n){var I,e,L,r,c;if(!n||(n.length===0)){return[];}I=new b.InternalMatrixCalculation(this);I.checkInputNodeConsistency(n);e=I._retrieveInfoFromInputArray(n);I._resetPositions();L=e.highestLanePosition+1;r=Math.max(Object.keys(n).length,2);c=I._createMatrix(r,L);for(var i=0;i<e.rootElements.length;i++){I.iPositionY=e.rootElements[i].lane;c=I.processCurrentElement(e.rootElements[i],n,c);}if(this._isLayoutOptimized){I._optimizeMatrix(c,n);}c=I._doubleColumnsInMatrix(c);c=I._calculatePathInMatrix(c);c=I._removeEmptyLines(c);return c;};b.NodeElement=function(i,c,n,d){this.nodeId=i;this.lane=c;this.state=n.getState();this.displayState=n._getDisplayState();this.isProcessed=false;if(q.isArray(d)){this.aParent=d;}else{this.oParent=d;}this.oNode=n;};b.NodeElement._initNodeElement=function(i,c,n,d){return new b.NodeElement(i,c,n,d);};b.NodeElement.prototype={toString:function(){return this.nodeId;},containsChildren:function(e){if(!e){return false;}if(!(e instanceof b.NodeElement)){return false;}if(this.oNode.getChildren()&&e.oNode.getChildren()&&this.oNode.getChildren().length&&e.oNode.getChildren().length){for(var i=0;i<this.oNode.getChildren().length;i++){if(e.oNode.getChildren().indexOf(this.oNode.getChildren()[i])>=0){return true;}}}return false;}};b.NodeElement._calculateLaneStatePieChart=function(c,d,e,p){if(!c||!d||!e){return;}var i;for(i=0;i<e.length;i++){p._bHighlightedMode=e[i].getHighlighted();if(p._bHighlightedMode){break;}}var f,n,N,g,h;for(i=0;i<d.length;i++){var L=d[i];var o=c[L.getLaneId()];if(!o){continue;}f=0;n=0;N=0;g=0;h=0;for(var j=0;j<o.length;j++){if(!p._bHighlightedMode||(o[j].oNode._getDisplayState()===l.ProcessFlowDisplayState.Highlighted||o[j].oNode._getDisplayState()===l.ProcessFlowDisplayState.HighlightedFocused||o[j].oNode._getDisplayState()===l.ProcessFlowDisplayState.SelectedHighlighted||o[j].oNode._getDisplayState()===l.ProcessFlowDisplayState.SelectedHighlightedFocused)){switch(o[j].oNode.getState()){case l.ProcessFlowNodeState.Positive:f++;break;case l.ProcessFlowNodeState.Negative:case l.ProcessFlowNodeState.PlannedNegative:n++;break;case l.ProcessFlowNodeState.Planned:g++;break;case l.ProcessFlowNodeState.Critical:h++;break;case l.ProcessFlowNodeState.Neutral:default:N++;}}}var s=[{state:l.ProcessFlowNodeState.Positive,value:f},{state:l.ProcessFlowNodeState.Negative,value:n},{state:l.ProcessFlowNodeState.Neutral,value:N},{state:l.ProcessFlowNodeState.Planned,value:g},{state:l.ProcessFlowNodeState.Critical,value:h}];L.setState(s);}};b.NodeElement._updateLanesFromNodes=function(p,c){var r=b.NodeElement._createMapFromLanes(p,null,false);var L=r.positionMap;var d=r.idMap;var n={};var t=p.slice();var e;var T={};var f=0;var i;for(i=0;i<c.length;i++){n[c[i].getNodeId()]=c[i];}for(i=0;i<c.length;i++){var o=c[i];var g=o.getChildren()||[];var h=1;var N=null;var k=null;for(var j=0;j<g.length;j++){var m=b._getChildIdByElement(g[j]);var s=n[m];if(s){if(o.getLaneId()===s.getLaneId()){N=s.getLaneId()+h;k=d[N];if(!k){var u=d[o.getLaneId()];k=b.NodeElement._createNewProcessFlowElement(u,N,u.getPosition()+h);d[k.getLaneId()]=k;t.splice(k.getPosition(),0,k);}s._setMergedLaneId(k.getLaneId());}b.NodeElement._changeLaneOfChildren(o.getLaneId(),s,n);}}if(k){T={};e=false;for(var K in L){if(k.getLaneId()===L[K].getLaneId()){e=true;break;}if(parseInt(K,10)>=k.getPosition()){var w=L[K];T[w.getPosition()+h]=w;}}if(!e){for(var x in T){f=parseInt(x,10);T[f]._setMergedPosition(f);}T[k.getPosition()]=k;for(var v=0;v<k.getPosition();v++){T[v]=L[v];}L=T;}}}return{lanes:t,nodes:c};};b.NodeElement._changeLaneOfChildren=function(c,d,n){var e=d.getChildren();if(e){for(var i=0;i<e.length;i++){var s=b._getChildIdByElement(e[i]);var o=n[s];if(o&&o.getLaneId()===c){o._setMergedLaneId(d.getLaneId());b.NodeElement._changeLaneOfChildren(c,o,n);}}}};b.NodeElement._createNewProcessFlowElement=function(o,n,c){return new a({laneId:n,iconSrc:o.getIconSrc(),text:o.getText(),state:o.getState(),position:c,zoomLevel:o.getZoomLevel()});};b.NodeElement._createMapFromLanes=function(p,t,c){var L,d={},e={},f=p?p.length:0,i=0;if(!f){return{};}else{while(i<f){L=p[i];if(L&&L.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowLaneHeader"){d[L.getPosition()]=L;e[L.getLaneId()]=L;if(t){L.attachPress(t);}L._setHeaderMode(c);}i++;}return{positionMap:d,idMap:e};}};b.NodeElement._createNodeElementsFromProcessFlowNodes=function(p,c){var L={},d={},e={},n,N=p?p.length:0,s,o,f=c?c.length:0,g,h=[],k,m,r,t,i,j,I={};if(N===0){return{elementById:{},elementsByLane:{}};}if(f===0){throw["No lane definition although there is a node definition."];}i=0;while(i<f){o=c[i];g=o.getLaneId();k=o.getPosition();if(L[g]){throw["The lane with id: "+g+" is defined at least twice. (Lane error)"];}L[g]=k;if(q.inArray(k,h)>-1){throw["The position "+k+" is defined at least twice. (Lane error)."];}else{h.push(k);}d[g]=[];i++;}i=0;while(i<N){n=p[i];if(n&&n.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){s=n.getNodeId();g=n.getLaneId();m=n.getChildren()||[];t=m.length;j=0;while(j<t){r=b._getChildIdByElement(m[j]);e[r]=e[r]||[];e[r].push(s);j++;}}i++;}i=0;while(i<N){n=p[i];if(n&&n.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){s=n.getNodeId();if(!s){throw["There is a node which has no node id defined. (Title="+n.getTitle()+") and array position: "+i];}g=n.getLaneId();k=L[g];if(q.type(k)!=="number"){throw["For the node "+s+" position (lane) is not defined."];}if(!I[s]){I[s]=b.NodeElement._initNodeElement(s,k,n,e[s]);d[g].push(I[s]);}else{throw["The node id "+s+" is used second time."];}}i++;}return{elementById:I,elementsByLane:d};};b.InternalMatrixCalculation=function(){this.iPositionX=0;this.iPositionY=0;this.nodePositions={};this.mapChildToNode={};};b.InternalMatrixCalculation.prototype._optimizeMatrix=function(m,e){var L;do{L=false;for(var c=0;c<m[0].length;c++){for(var d=0;d<m.length-1;d++){if(!m[d][c]){var n=false;for(var i=d+1;i<m.length;i++){if(m[i][c]){n=true;break;}}if(!n){break;}if(this._optimizeLane(m,d,c,e)){L=true;}}}}}while(L);};b.InternalMatrixCalculation.prototype._optimizeLane=function(m,r,c,e){for(var i=r+1;i<m.length;i++){if(m[i][c]){var n=m[i][c];if(this._verifyOptimizeLane(m,r,i,c,e)){m[r][c]=n;this.nodePositions[n.nodeId].x=r;m[i][c]=null;return true;}else{return false;}}}return false;};b.InternalMatrixCalculation.prototype._verifyOptimizeLane=function(m,r,c,d,n){var N=m[c][d].oNode;var i,j,e,s;if(N&&N.getChildren()){e=m[c][d].oNode.getChildren();for(i=0;i<e.length;i++){s=b._getChildIdByElement(e[i]);var f=n[s].lane;for(j=d+1;j<f;j++){if(m[r][j]){return false;}}}}var o=m[c][d].nodeId;var O=this.nodePositions[o];var p=m[c][d].aParent;if(p){for(i=0;i<p.length;i++){s=b._getChildIdByElement(p[i]);if(d-1!==n[s].lane){return false;}var g=this.nodePositions[s];if(g.x>=O.x){return false;}}}for(i=0;i<d;i++){for(j=0;j<m.length;j++){if(m[j][i]&&m[j][i].oNode){s=m[j][i].nodeId;var h=this.nodePositions[s];e=m[j][i].oNode.getChildren();if(e){for(var k=0;k<e.length;k++){var t=b._getChildIdByElement(e[k]);var u=this.nodePositions[t];if(n[t].lane>d&&!((h.x<r&&u.x<r)||((h.x>r&&u.x>r)))){return false;}}}}}}if(N._hasChildren()){for(i=0;i<r;i++){if(m[i][d]){e=m[i][d].oNode.getChildren();if(e){for(j=0;j<e.length;j++){s=b._getChildIdByElement(e[j]);var E=n[s];var v=this.nodePositions[s];if(E.lane>d&&v.x>=r&&!N._hasChildrenWithNodeId(s)){return false;}}}}}}return true;};b.InternalMatrixCalculation.prototype._resetPositions=function(){this.iPositionX=0;this.iPositionY=0;delete this.nodePositions;delete this.mapChildToNode;this.nodePositions={};this.mapChildToNode={};};b.InternalMatrixCalculation.prototype._createMatrix=function(c){c=parseInt(c,10);var d=new Array(c||0);var i=c;if(arguments.length>1){var e=Array.prototype.slice.call(arguments,1);while(i--){d[c-1-i]=this._createMatrix.apply(this,e);}}return d;};b.InternalMatrixCalculation.prototype._retrieveInfoFromInputArray=function(e){var L=0,r=[],E;Object.keys(e).forEach(function(s){E=e[s];if(!E.oParent&&!E.aParent){r.push(E);}if(L<E.lane){L=E.lane;}});return{"highestLanePosition":L,"rootElements":r};};b.InternalMatrixCalculation.prototype._doubleColumnsInMatrix=function(c){var m=0,i;for(i=0;i<c.length;i++){m=m>c[i].length?m:c[i].length;}var t=new Array(c.length||0);for(i=0;i<t.length;i++){t[i]=new Array(m*2-1);for(var j=0;j<m;j++){if(c[i][j]){t[i][2*j]=c[i][j];}}}return t;};b.InternalMatrixCalculation.prototype._removeEmptyLines=function(o){var L=0,i,j;for(i=0;i<o.length;i++){for(j=0;j<o[i].length;j++){if(o[i][j]){L++;break;}}}var r=this._createMatrix(L,o[0].length);for(i=0;i<L;i++){for(j=0;j<o[i].length;j++){r[i][j]=null;if(o[i][j]){r[i][j]=o[i][j];}}}return r;};b.InternalMatrixCalculation.prototype._sortBasedOnChildren=function(n,e){var E={},c,L=null,d,i,f,s=[],S,g,p;if(n){n.forEach(function(o){var j=b._getChildIdByElement(o);c=E[e[j].lane];if(!c){E[e[j].lane]=c=[];}c.push(e[j]);});}else{return[];}var h=function(j,k){i=(j.oNode.getChildren()||[]).length;f=(k.oNode.getChildren()||[]).length;return f-i;};d=[];for(L in E){d.push(L);E[L].sort(h);}d=d.sort(function(j,k){return k-j;});var A=function(o){if(p.containsChildren(o)){g.push(o);}};d.forEach(function(j){S=E[j];if(S.length>1){g=[];p=S.shift();while(p){if(g.indexOf(p)<0){g.push(p);}S.forEach(A);p=S.shift();}s=s.concat(g);}else{s=s.concat(S);}});return s;};b.InternalMatrixCalculation.prototype._calculatePathInMatrix=function(o){var c=null;for(var k in this.nodePositions){if(this.nodePositions.hasOwnProperty(k)){c=this.nodePositions[k];var d=c.c.oNode.getChildren();for(var i=0;d&&i<d.length;i++){var s=b._getChildIdByElement(d[i]);var p=this.nodePositions[s];o=this._calculateSingleNodeConnection(c,p,c.x,c.y,p.x,p.y,o);}}}return o;};b.InternalMatrixCalculation.prototype._calculateSingleNodeConnection=function(n,c,p,d,e,f,o){var h=f-d;var v=e-p;if(h<0){throw["Problem with negative horizontal movement","Parent node is "+n.c.toString(),"Children node is "+c.c.toString(),"Coordinates : '"+p+"','"+d+"','"+e+"','"+f+"'"];}else if(v<=-1){var N=this._checkIfHorizontalLinePossible(o,e,d+2,f);var i=f-1;if(N){i=d+1;}var g=p;if(N){g=e;}o[p][i]=this._createConnectionElement(o[p][i],b._cellEdgeConstants.LU,n,c,false);o=this._writeVerticalLine(o,p,e,i,n,c);o[e][i]=this._createConnectionElement(o[e][i],b._cellEdgeConstants.UR,n,c,(i===f-1));var s=d+2;var E=f;if(!N){s=d+1;E=i+1;}o=this._writeHorizontalLine(o,g,s,E,n,c);}else if(v===0){o=this._writeHorizontalLine(o,p,d+1,f,n,c);}else if(v===1){o[p][d+1]=this._createConnectionElement(o[p][d+1],b._cellEdgeConstants.LD,n,c,false);o[e][d+1]=this._createConnectionElement(o[e][d+1],b._cellEdgeConstants.DR,n,c,(d+1)===(f-1));o=this._writeHorizontalLine(o,e,d+2,f,n,c);}else{o[p][d+1]=this._createConnectionElement(o[p][d+1],b._cellEdgeConstants.LD,n,c,false);o=this._writeVerticalLine(o,e,p,d+1,n,c);o[e][d+1]=this._createConnectionElement(o[e][d+1],b._cellEdgeConstants.DR,n,c,(d+1)===(f-1));o=this._writeHorizontalLine(o,e,d+2,f,n,c);}return o;};b.InternalMatrixCalculation.prototype._writeVerticalLine=function(o,f,c,d,n,e){for(var j=f-1;j>c;j--){o[j][d]=this._createConnectionElement(o[j][d],b._cellEdgeConstants.DU,n,e,false);}return o;};b.InternalMatrixCalculation.prototype._checkIfHorizontalLinePossible=function(o,r,f,c){var L=true;for(var i=f;i<c;i++){if(o[r][i]instanceof b.NodeElement){L=false;break;}}return L;};b.InternalMatrixCalculation.prototype._writeHorizontalLine=function(o,r,f,c,n,d){var p=(r===d.x);if(!p){c--;}for(var i=f;i<c;i++){o[r][i]=this._createConnectionElement(o[r][i],b._cellEdgeConstants.LR,n,d,(i===(c-1))&&p);}return o;};b.InternalMatrixCalculation.prototype._createConnectionElement=function(o,f,s,t,h){var n=o;if(!n){n=new P();}if(n.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){var d=this._calculateConnectionDisplayStateBySourceAndTargetNode(s.c.oNode,t.c.oNode);var c={flowLine:f,targetNodeState:t.c.state,displayState:d,hasArrow:h};n.addConnectionData(c);}return n;};b.InternalMatrixCalculation.prototype._calculateConnectionDisplayStateBySourceAndTargetNode=function(s,t){var S=s.getHighlighted();var c=s.getSelected();var d=s._getDimmed();var T=t.getHighlighted();var e=t.getSelected();var f=t._getDimmed();var o=l.ProcessFlowDisplayState.Regular;if(c&&e){o=l.ProcessFlowDisplayState.Selected;}else if(S&&T){o=l.ProcessFlowDisplayState.Highlighted;}else if((d||f)||S&&e||c&&T){o=l.ProcessFlowDisplayState.Dimmed;}return o;};b.prototype.addNode=function(n){return this.addAggregation("nodes",n,false);};b.prototype._switchCursors=function($,c,d){if($.hasClass(c)){$.removeClass(c);}if(!$.hasClass(d)){$.addClass(d);}};b.prototype._clearHandlers=function($){$.bind(this._mousePreventEvents,q.proxy(this._handlePrevent,this));};b.prototype._initZoomLevel=function(){if(this.$()){var w=this.$().width();if(w){if(w<M.ScreenSizes.tablet){this.setZoomLevel(l.ProcessFlowZoomLevel.Four);}else if(w<M.ScreenSizes.desktop){this.setZoomLevel(l.ProcessFlowZoomLevel.Three);}else{this.setZoomLevel(l.ProcessFlowZoomLevel.Two);}}}};b.prototype._registerMouseWheel=function(e){var d=e.originalEvent.wheelDelta||-e.originalEvent.detail;if(d===0){d=-e.originalEvent.deltaY;}if(e&&!e.isDefaultPrevented()){e.preventDefault();e.originalEvent.returnValue=false;}var w=300;var f=function(){var i=new Date()-this._wheelTimestamp;if(i<w){this._wheelTimeout=q.sap.delayedCall(w-i,this,f.bind(this));}else{this._wheelTimeout=null;this._wheelCalled=false;}};if(!this._wheelCalled){this._wheelCalled=true;if(d<0){this._isFocusChanged=true;this.zoomOut();}else{this._isFocusChanged=true;this.zoomIn();}}if(!this._wheelTimeout){this._wheelTimestamp=new Date();this._wheelTimeout=q.sap.delayedCall(w,this,f.bind(this));}if(e&&!e.isPropagationStopped()){e.stopPropagation();}if(e&&!e.isImmediatePropagationStopped()){e.stopImmediatePropagation();}};b.prototype._setFocusToNode=function(n){if(n){if(n.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){q("#"+n.sId).parent().focus();n._setNavigationFocus(true);n.rerender();}else if(n.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnectionLabel"){n.$().focus();n._setNavigationFocus(true);}}else if(this._lastNavigationFocusElement){if(this._lastNavigationFocusElement.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){q("#"+this._lastNavigationFocusElement.sId).parent().focus();this._lastNavigationFocusElement._setNavigationFocus(true);this._lastNavigationFocusElement.rerender();}else if(this._lastNavigationFocusElement.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnectionLabel"){this._lastNavigationFocusElement.$().focus();this._lastNavigationFocusElement._setNavigationFocus(true);}}};b.prototype._changeNavigationFocus=function(n,c){if(n&&c&&(n.getId()!==c.getId())){q.sap.log.debug("Rerendering PREVIOUS node with id '"+n.getId()+"' navigation focus : "+n._getNavigationFocus());n._setNavigationFocus(false);if(n.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){n.rerender();}}if(c){q.sap.log.debug("Rerendering CURRENT node with id '"+c.getId()+"' navigation focus : "+c._getNavigationFocus());c._setNavigationFocus(true);if(c.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){c.rerender();}this._lastNavigationFocusElement=c;this._onFocusChanged();}};b.prototype._moveOnePage=function(d,c){d=d||b._enumMoveDirection.UP;c=c||false;var p=0,e=0;var f=0,g=0;var n=0;var N=false,i,j,L;for(i=0;i<this._internalCalcMatrix.length;i++){for(j=0;j<this._internalCalcMatrix[i].length;j++){if(this._internalCalcMatrix[i][j]&&this._internalCalcMatrix[i][j].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"&&this._internalCalcMatrix[i][j]._getNavigationFocus()){p=i;e=j;break;}else if(this._internalCalcMatrix[i][j]&&this._internalCalcMatrix[i][j].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){L=this._internalCalcMatrix[i][j]._getVisibleLabel();if(L&&L._getNavigationFocus()){p=i;e=j;break;}}}}if(c){if(d===b._enumMoveDirection.UP){for(j=e-1;j>=0&&n<this._jumpOverElements;j--){if(this._internalCalcMatrix[p][j]&&this._internalCalcMatrix[p][j].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"&&(!this._bHighlightedMode||this._internalCalcMatrix[p][j].getHighlighted())){n++;f=p;g=j;N=true;}else if(this._internalCalcMatrix[p][j]&&this._internalCalcMatrix[p][j].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){L=this._internalCalcMatrix[p][j]._getVisibleLabel();if(this._labelCanGetFocus(L)){n++;f=p;g=j;N=true;}}}}else if(d===b._enumMoveDirection.DOWN){for(j=e+1;j<this._internalCalcMatrix[p].length&&n<this._jumpOverElements;j++){if(this._internalCalcMatrix[p][j]&&this._internalCalcMatrix[p][j].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"&&(!this._bHighlightedMode||this._internalCalcMatrix[p][j].getHighlighted())){n++;f=p;g=j;N=true;}else if(this._internalCalcMatrix[p][j]&&this._internalCalcMatrix[p][j].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){L=this._internalCalcMatrix[p][j]._getVisibleLabel();if(this._labelCanGetFocus(L)){n++;f=p;g=j;N=true;}}}}}else if(d===b._enumMoveDirection.UP){for(i=p-1;i>=0&&n<this._jumpOverElements;i--){if(this._internalCalcMatrix[i][e]&&this._internalCalcMatrix[i][e].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"&&(!this._bHighlightedMode||this._internalCalcMatrix[i][e].getHighlighted())){n++;f=i;g=e;N=true;}else if(this._internalCalcMatrix[i][e]&&this._internalCalcMatrix[i][e].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){L=this._internalCalcMatrix[i][e]._getVisibleLabel();if(this._labelCanGetFocus(L)){n++;f=i;g=e;N=true;}}}}else if(d===b._enumMoveDirection.DOWN){for(i=p+1;i<this._internalCalcMatrix.length&&n<this._jumpOverElements;i++){if(this._internalCalcMatrix[i][e]&&this._internalCalcMatrix[i][e].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"&&(!this._bHighlightedMode||this._internalCalcMatrix[i][e].getHighlighted())){n++;f=i;g=e;N=true;}else if(this._internalCalcMatrix[i][e]&&this._internalCalcMatrix[i][e].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){L=this._internalCalcMatrix[i][e]._getVisibleLabel();if(this._labelCanGetFocus(L)){n++;f=i;g=e;N=true;}}}}if(N){if(this._internalCalcMatrix[p][e]&&this._internalCalcMatrix[p][e].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){this._internalCalcMatrix[p][e]._getVisibleLabel()._setNavigationFocus(false);}else{this._internalCalcMatrix[p][e]._setNavigationFocus(false);}if(this._internalCalcMatrix[f][g]&&this._internalCalcMatrix[f][g].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){L=this._internalCalcMatrix[f][g]._getVisibleLabel();L._setNavigationFocus(true);this._lastNavigationFocusElement=L;}else{this._internalCalcMatrix[f][g]._setNavigationFocus(true);this._lastNavigationFocusElement=this._internalCalcMatrix[f][g];}}return N;};b.prototype._moveHomeEnd=function(d,c){d=d||b._enumMoveDirection.RIGHT;c=c||false;var p=0,e=0;var f=0,g=0;var n=false,i,j,L;for(i=0;i<this._internalCalcMatrix.length;i++){for(j=0;j<this._internalCalcMatrix[i].length;j++){if(this._internalCalcMatrix[i][j]&&this._internalCalcMatrix[i][j].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"&&this._internalCalcMatrix[i][j]._getNavigationFocus()){p=i;e=j;break;}else if(this._internalCalcMatrix[i][j]&&this._internalCalcMatrix[i][j].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){L=this._internalCalcMatrix[i][j]._getVisibleLabel();if(L&&L._getNavigationFocus()){p=i;e=j;break;}}}}if(c){if(d===b._enumMoveDirection.LEFT){for(i=0;i<p;i++){if(this._internalCalcMatrix[i][e]&&this._internalCalcMatrix[i][e].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"&&(!this._bHighlightedMode||this._internalCalcMatrix[i][e].getHighlighted())){f=i;g=e;n=true;break;}else if(this._internalCalcMatrix[i][e]&&this._internalCalcMatrix[i][e].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){L=this._internalCalcMatrix[i][e]._getVisibleLabel();if(this._labelCanGetFocus(L)){f=i;g=e;n=true;break;}}}}else if(d===b._enumMoveDirection.RIGHT){for(i=this._internalCalcMatrix.length-1;i>p;i--){if(this._internalCalcMatrix[i][e]&&this._internalCalcMatrix[i][e].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"&&(!this._bHighlightedMode||this._internalCalcMatrix[i][e].getHighlighted())){f=i;g=e;n=true;break;}else if(this._internalCalcMatrix[i][e]&&this._internalCalcMatrix[i][e].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){L=this._internalCalcMatrix[i][e]._getVisibleLabel();if(this._labelCanGetFocus(L)){f=i;g=e;n=true;break;}}}}}else if(d===b._enumMoveDirection.LEFT){for(j=0;j<e;j++){if(this._internalCalcMatrix[p][j]&&this._internalCalcMatrix[p][j].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"&&(!this._bHighlightedMode||this._internalCalcMatrix[p][j].getHighlighted())){f=p;g=j;n=true;break;}else if(this._internalCalcMatrix[p][j]&&this._internalCalcMatrix[p][j].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){L=this._internalCalcMatrix[p][j]._getVisibleLabel();if(this._labelCanGetFocus(L)){f=p;g=j;n=true;break;}}}}else if(d===b._enumMoveDirection.RIGHT){for(j=this._internalCalcMatrix[p].length-1;j>e;j--){if(this._internalCalcMatrix[p][j]&&this._internalCalcMatrix[p][j].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"&&(!this._bHighlightedMode||this._internalCalcMatrix[p][j].getHighlighted())){f=p;g=j;n=true;break;}else if(this._internalCalcMatrix[p][j]&&this._internalCalcMatrix[p][j].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){L=this._internalCalcMatrix[p][j]._getVisibleLabel();if(this._labelCanGetFocus(L)){f=p;g=j;n=true;break;}}}}if(n){if(this._internalCalcMatrix[p][e]&&this._internalCalcMatrix[p][e].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){this._internalCalcMatrix[p][e]._getVisibleLabel()._setNavigationFocus(false);}else{this._internalCalcMatrix[p][e]._setNavigationFocus(false);}if(this._internalCalcMatrix[f][g]&&this._internalCalcMatrix[f][g].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){L=this._internalCalcMatrix[f][g]._getVisibleLabel();L._setNavigationFocus(true);this._lastNavigationFocusElement=L;}else{this._internalCalcMatrix[f][g]._setNavigationFocus(true);this._lastNavigationFocusElement=this._internalCalcMatrix[f][g];}}return n;};b.prototype._moveToNextElement=function(d,s){d=d||b._enumMoveDirection.RIGHT;if(sap.ui.getCore().getConfiguration().getRTL()){if(d===b._enumMoveDirection.RIGHT){d=b._enumMoveDirection.LEFT;}else if(d===b._enumMoveDirection.LEFT){d=b._enumMoveDirection.RIGHT;}}s=s||1;var f=false;var n=false;var p=0,c=1,i,j,L;if(!this._internalCalcMatrix){return false;}var e=0,g=0;for(i=0;i<this._internalCalcMatrix.length;i++){for(j=0;j<this._internalCalcMatrix[i].length;j++){if(this._internalCalcMatrix[i][j]){if(this._internalCalcMatrix[i][j]&&this._internalCalcMatrix[i][j].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"&&this._internalCalcMatrix[i][j]._getNavigationFocus()){p=e=i;c=g=j;f=true;break;}else if(this._internalCalcMatrix[i][j]&&this._internalCalcMatrix[i][j].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){L=this._internalCalcMatrix[i][j]._getVisibleLabel();if(L&&L._getNavigationFocus()&&L.getEnabled()){p=e=i;c=g=j;f=true;break;}}}}if(f){break;}}if(d===b._enumMoveDirection.RIGHT){for(i=e;i<this._internalCalcMatrix.length;i++){for(j=g+1;j<this._internalCalcMatrix[i].length;j++){if(this._internalCalcMatrix[i][j]&&this._internalCalcMatrix[i][j].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){if(f&&(!this._bHighlightedMode||this._internalCalcMatrix[i][j].getHighlighted())){this._internalCalcMatrix[i][j]._setNavigationFocus(true);this._lastNavigationFocusElement=this._internalCalcMatrix[i][j];n=true;break;}}else if(this._internalCalcMatrix[i][j]&&this._internalCalcMatrix[i][j].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){L=this._internalCalcMatrix[i][j]._getVisibleLabel();if(f&&this._labelCanGetFocus(L)){L._setNavigationFocus(true);this._lastNavigationFocusElement=L;n=true;break;}}}g=0;if(n){break;}}}if(d===b._enumMoveDirection.LEFT){for(i=e;i>=0;i--){for(j=g-1;j>=0;j--){if(this._internalCalcMatrix[i][j]&&this._internalCalcMatrix[i][j].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){if(f&&(!this._bHighlightedMode||this._internalCalcMatrix[i][j].getHighlighted())){this._lastNavigationFocusElement=this._internalCalcMatrix[i][j]._setNavigationFocus(true);this._lastNavigationFocusElement=this._internalCalcMatrix[i][j];n=true;break;}}else if(this._internalCalcMatrix[i][j]&&this._internalCalcMatrix[i][j].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){L=this._internalCalcMatrix[i][j]._getVisibleLabel();if(f&&this._labelCanGetFocus(L)){L._setNavigationFocus(true);this._lastNavigationFocusElement=L;n=true;break;}}}if(i>0){g=this._internalCalcMatrix[i-1].length;}if(n){break;}}}var h,k,m;if(d===b._enumMoveDirection.UP){for(i=e-1;i>=0;i--){h=0;while(!n){k=g-h;m=g+h;if(k>=0&&this._internalCalcMatrix[i][k]&&this._internalCalcMatrix[i][k].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){if(f&&(!this._bHighlightedMode||this._internalCalcMatrix[i][k].getHighlighted())){this._internalCalcMatrix[i][k]._setNavigationFocus(true);this._lastNavigationFocusElement=this._internalCalcMatrix[i][k];n=true;break;}}else if(k>=0&&this._internalCalcMatrix[i][k]&&this._internalCalcMatrix[i][k].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){L=this._internalCalcMatrix[i][k]._getVisibleLabel();if(f&&this._labelCanGetFocus(L)){L._setNavigationFocus(true);this._lastNavigationFocusElement=L;n=true;break;}}if(m<this._internalCalcMatrix[i].length&&this._internalCalcMatrix[i][m]&&this._internalCalcMatrix[i][m].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){if(f&&(!this._bHighlightedMode||this._internalCalcMatrix[i][m].getHighlighted())){this._internalCalcMatrix[i][m]._setNavigationFocus(true);this._lastNavigationFocusElement=this._internalCalcMatrix[i][m];n=true;break;}}else if(m>=0&&this._internalCalcMatrix[i][m]&&this._internalCalcMatrix[i][m].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){L=this._internalCalcMatrix[i][m]._getVisibleLabel();if(f&&this._labelCanGetFocus(L)){L._setNavigationFocus(true);this._lastNavigationFocusElement=L;n=true;break;}}if(k<0&&m>this._internalCalcMatrix[i].length){break;}h++;}}}if(d===b._enumMoveDirection.DOWN){for(i=e+1;i<this._internalCalcMatrix.length;i++){h=0;while(!n){k=g-h;m=g+h;if(k>=0&&this._internalCalcMatrix[i][k]&&this._internalCalcMatrix[i][k].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){if(f&&(!this._bHighlightedMode||this._internalCalcMatrix[i][k].getHighlighted())){this._lastNavigationFocusElement=this._internalCalcMatrix[i][k]._setNavigationFocus(true);this._lastNavigationFocusElement=this._internalCalcMatrix[i][k];n=true;break;}}else if(k>=0&&this._internalCalcMatrix[i][k]&&this._internalCalcMatrix[i][k].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){L=this._internalCalcMatrix[i][k]._getVisibleLabel();if(f&&this._labelCanGetFocus(L)){L._setNavigationFocus(true);this._lastNavigationFocusElement=L;n=true;break;}}if(m<this._internalCalcMatrix[i].length&&this._internalCalcMatrix[i][m]&&this._internalCalcMatrix[i][m].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){if(f&&(!this._bHighlightedMode||this._internalCalcMatrix[i][m].getHighlighted())){this._lastNavigationFocusElement=this._internalCalcMatrix[i][m]._setNavigationFocus(true);this._lastNavigationFocusElement=this._internalCalcMatrix[i][m];n=true;break;}}else if(m>=0&&this._internalCalcMatrix[i][m]&&this._internalCalcMatrix[i][m].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){L=this._internalCalcMatrix[i][m]._getVisibleLabel();if(f&&this._labelCanGetFocus(L)){L._setNavigationFocus(true);this._lastNavigationFocusElement=L;n=true;break;}}if(k<0&&m>this._internalCalcMatrix[i].length){break;}h++;}}}if(n){if(this._internalCalcMatrix[p][c]&&this._internalCalcMatrix[p][c].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){this._internalCalcMatrix[p][c]._setNavigationFocus(false);}else{this._internalCalcMatrix[p][c]._getVisibleLabel()._setNavigationFocus(false);}}return n;};b.prototype._getScrollContainerOnZoomChanged=function(s,$){s.scrollLeft=Math.round($.context.scrollWidth/s.scrollWidth*s.scrollLeft);s.scrollTop=Math.round($.context.scrollHeight/s.scrollHeight*s.scrollTop);s.scrollWidth=$.context.scrollWidth;s.scrollHeight=$.context.scrollHeight;return s;};b.prototype._mergeLaneIdNodeStates=function(c){var p=0;var n=0;var N=0;var i=0;var d=0;for(var s=0;s<5;s++){for(var e=0;e<c.length;e++){switch(c[e][s].state){case l.ProcessFlowNodeState.Positive:p=p+c[e][s].value;break;case l.ProcessFlowNodeState.Negative:n=n+c[e][s].value;break;case l.ProcessFlowNodeState.Neutral:N=N+c[e][s].value;break;case l.ProcessFlowNodeState.Planned:i=i+c[e][s].value;break;case l.ProcessFlowNodeState.PlannedNegative:n=n+c[e][s].value;break;case l.ProcessFlowNodeState.Critical:d=d+c[e][s].value;break;default:break;}}}return[{state:l.ProcessFlowNodeState.Positive,value:p},{state:l.ProcessFlowNodeState.Negative,value:n},{state:l.ProcessFlowNodeState.Neutral,value:N},{state:l.ProcessFlowNodeState.Planned,value:i},{state:l.ProcessFlowNodeState.Critical,value:d}];};b.prototype._setFocusOnHeader=function(n){var t=q.sap.byId(this.getId()+"-thead");if(n){t.focus();t.addClass("sapSuiteUiCommonsPFHeaderFocused");this._headerHasFocus=true;}else{t.removeClass("sapSuiteUiCommonsPFHeaderFocused");this._headerHasFocus=false;}};b.prototype._scroll=function(d,c){var o=this._getScrollContainer().get(0);var s=o.scrollLeft;if(!D.browser.msie&&!D.browser.edge&&this._bRtl){d=-d;}var S=s+d;q(o).stop(true,true).animate({scrollLeft:S},c,q.proxy(this._adjustAndShowArrow,this));};b.prototype._adjustAndShowArrow=function(){this._checkOverflow(this._getScrollContainer().get(0),this.$());if(this.getScrollable()){this._moveArrowAndCounterVertical();}if(this._isFocusChanged){this._setFocusToNode(this._lastNavigationFocusElement);this._isFocusChanged=false;}};b.prototype._getScrollingArrow=function(d){var s;if(D.system.desktop){s="sap-icon://navigation-"+d+"-arrow";}else{s="sap-icon://slim-arrow-"+d;}var p={src:s};var L="sapPFHArrowScrollLeft";var r="sapPFHArrowScrollRight";var c=["sapPFHArrowScroll",L];var e=["sapPFHArrowScroll",r];if(d===b._constants.left){if(!this._oArrowLeft){this._oArrowLeft=M.ImageHelper.getImageControl(this.getId()+b._constants.arrowScrollLeftMinus,null,this,p,c);}return this._oArrowLeft;}if(d===b._constants.right){if(!this._oArrowRight){this._oArrowRight=M.ImageHelper.getImageControl(this.getId()+b._constants.arrowScrollRightMinus,null,this,p,e);}return this._oArrowRight;}};b.prototype._checkScrolling=function(s,$){var S=false;if(s){if(s.scrollWidth>s.clientWidth){S=true;}}if(this._arrowScrollable!==S){$.toggleClass("sapPFHScrollable",S);$.toggleClass("sapPFHNotScrollable",!S);this._arrowScrollable=S;}return S;};b.prototype._updateLeftCounter=function(){var s;if(!this._bRtl){s=this._getScrollContainer().scrollLeft();}else{s=this._getScrollContainer().scrollRightRTL();}var c=Math.round(s/this._scrollStep);this.$(b._constants.counterLeft).text(c.toString());return c;};b.prototype._updateRightCounter=function(s,c){var S;var i;if(!this._bRtl){S=this._getScrollContainer().scrollLeft();i=Math.round((c-S-s)/this._scrollStep);}else{S=this._getScrollContainer().scrollLeftRTL();i=Math.round(S/this._scrollStep);}this.$(b._constants.counterRight).text(i.toString());return i;};b.prototype._moveArrowAndCounterVertical=function(){var s=this._getScrollContainer().scrollTop();if(s>0){var A=this._iInitialArrowTop-s;var c=this._iInitialCounterTop-s;var d=this._iInitialCounterTop-this._iInitialArrowTop;if(A>0){this.$(b._constants.arrowScrollRight).css(b._constants.top,A+b._constants.px);this.$(b._constants.arrowScrollLeft).css(b._constants.top,A+b._constants.px);}else{this.$(b._constants.arrowScrollRight).css(b._constants.top,"0px");this.$(b._constants.arrowScrollLeft).css(b._constants.top,"0px");}if(c>d){this.$(b._constants.counterRight).css(b._constants.top,c+b._constants.px);this.$(b._constants.counterLeft).css(b._constants.top,c+b._constants.px);}else{this.$(b._constants.counterRight).css(b._constants.top,d+b._constants.px);this.$(b._constants.counterLeft).css(b._constants.top,d+b._constants.px);}}else{this.$(b._constants.arrowScrollRight).css(b._constants.top,this._iInitialArrowTop+b._constants.px);this.$(b._constants.arrowScrollLeft).css(b._constants.top,this._iInitialArrowTop+b._constants.px);this.$(b._constants.counterRight).css(b._constants.top,this._iInitialCounterTop+b._constants.px);this.$(b._constants.counterLeft).css(b._constants.top,this._iInitialCounterTop+b._constants.px);}};b.prototype._checkOverflow=function(s,$){if(this._checkScrolling(s,$)&&s){this._setScrollWidth();var S=false;var c=false;var o=20;var i=this._getScrollContainer().scrollLeft();var d=s.scrollWidth;var e=s.clientWidth;if(Math.abs(d-e)===1){d=e;}if(!this._bRtl){if(i>o){S=true;}if((d>e)&&(i+e+o<d)){c=true;}}else{var f=q(s);if(f.scrollLeftRTL()>o){c=true;}if(f.scrollRightRTL()>o){S=true;}}this._updateLeftCounter();this._updateRightCounter(e,d);if(c!==this._bPreviousScrollForward||(S!==this._bPreviousScrollBack)){this._bPreviousScrollForward=c;this._bPreviousScrollBack=S;$.toggleClass("sapPFHScrollBack",S);$.toggleClass("sapPFHNoScrollBack",!S);$.toggleClass("sapPFHScrollForward",c);$.toggleClass("sapPFHNoScrollForward",!c);}}else{this._bPreviousScrollForward=false;this._bPreviousScrollBack=false;}};b.prototype._setParentForNodes=function(c){var I=c?c.length:0;var d;var i,j;for(var o in c){c[o].removeAllAssociation(b._constants.parents,true);}for(i=0;i<I;i++){d=c[i].getChildren();if(d){for(j=0;j<d.length;j++){var e=this._getNode(b._getChildIdByElement(d[j]),c);if(e){e.addAssociation(b._constants.parents,c[i],true);}}}}};b.prototype._getConnectionsMap=function(){var c=[];var n=this.getNodes();for(var i=0;i<n.length;i++){var p=this._getPositionOfNodeInMatrix(this._internalCalcMatrix,n[i]);var d=n[i].getChildren();if(d){for(var j=0;j<d.length;j++){var o={};o.sourceNode=n[i];var e=b._getChildIdByElement(d[j]);var f=this._getNode(e,n);if(f){if(typeof d[j]==="object"){o.label=d[j].connectionLabel;}o.targetNode=f;var g=this._getPositionOfNodeInMatrix(this._internalCalcMatrix,o.targetNode);o.connectionParts=this._calculateConnectionParts(p,g);c.push(o);}}}}this._internalConnectionMap=c;return c;};b.prototype._getPositionOfNodeInMatrix=function(m,n){var p={};for(var i=0;i<m.length;i++){var c=m[i];for(var j=0;j<c.length;j++){var d=c[j];if(d&&d.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"&&d.getNodeId()===n.getNodeId()){p.y=i;p.x=j;return p;}}}return p;};b.prototype._calculateConnectionParts=function(p,c){var d=[];var s=p.y;var S=p.x;S++;d.push({x:S,y:s});if(c.y>=p.y){while(s<c.y){s++;d.push({x:S,y:s});}}else{while(s>c.y){s--;d.push({x:S,y:s});}}while(S<c.x-1){S++;d.push({x:S,y:s});}return d;};b.prototype._getConnectionMapEntries=function(c){var f=[];var o=null;var e=null;if(this._internalConnectionMap){for(var i=0;i<this._internalConnectionMap.length;i++){e=this._internalConnectionMap[i];if(e.label&&e.label.getId()===c.getId()){o=e;break;}}e=null;for(var j=0;j<this._internalConnectionMap.length;j++){e=this._internalConnectionMap[j];if(e.targetNode&&e.targetNode.getNodeId()===o.targetNode.getNodeId()){f.push(e);}}}return f;};b.prototype._createLabelPressEventArgs=function(c,d){var e={};var E=[];if(d){for(var i=0;i<d.length;i++){var o={sourceNode:d[i].sourceNode,targetNode:d[i].targetNode,label:d[i].label};E.push(o);}}e.selectedLabel=c;e.connections=E;return e;};b.prototype.applyNodeDisplayState=function(){var I=this.getNodes(),n=I?I.length:0,i=0;if(n!==0){while(i<n){I[i]._setRegularState();i++;}i=0;while((i<n)&&!I[i].getHighlighted()&&!I[i].getSelected()){i++;}if(i<n){i=0;while(i<n){if(!I[i].getHighlighted()&&!I[i].getSelected()){I[i]._setDimmedState();}i++;}}}};b.InternalMatrixCalculation.prototype.checkInputNodeConsistency=function(e){var E=[],j,c,i,d,o,f=0;Object.keys(e).forEach(function(s){o=e[s];d=o.oNode.getChildren();i=d?d.length:0;if(o.oNode.getFocused()){f++;}j=0;while(j<i){c=b._getChildIdByElement(d[j]);if(!e[c]){E.push("Node identificator "+c+" used in children definition is not presented as the node itself. Element : "+o.nodeId);}j++;}});if(E.length>0){throw E;}return f>1;};b.InternalMatrixCalculation.prototype.processCurrentElement=function(c,e,m){var E,d,n=true,f=true;if(c.isProcessed){return m;}this.nodePositions[c.nodeId]={"c":c,"x":this.iPositionX,"y":this.iPositionY*2};m[this.iPositionX][this.iPositionY++]=c;E=c.oNode.getChildren();c.isProcessed=true;d=this._sortBasedOnChildren(E,e);if(d){d.forEach(function(o){if(!o.isProcessed){f=false;while(this.iPositionY<o.lane){m[this.iPositionX][this.iPositionY++]=null;}m=this.processCurrentElement(o,e,m);}else if(n&&f){this.iPositionX++;n=false;}}.bind(this));}if(!E||f){if(n){this.iPositionX++;}this.iPositionY=0;}return m;};b.prototype.getZoomLevel=function(){return this._zoomLevel;};b.prototype.setZoomLevel=function(z){if(!this._getScrollContainer()){return;}var $=this._getScrollContainer();var s=null;var S;if($.context){s={scrollWidth:$.context.scrollWidth,scrollHeight:$.context.scrollHeight,scrollLeft:$.context.scrollLeft,scrollTop:$.context.scrollTop};S=s;if(this._zoomLevel===z){this._isInitialZoomLevelNeeded=false;return;}}if(!(z in l.ProcessFlowZoomLevel)){this._handleException("\""+z+"\" is not a valid entry of the enumeration for property zoom level of ProcessFlow");return;}this._zoomLevel=z;if(this._isInitialZoomLevelNeeded){this._isInitialZoomLevelNeeded=false;this.invalidate();}else{this.rerender();}if(s){if(D.support.touch||q.sap.simulateMobileOnDesktop){var h=parseInt(this._getScrollContainer().css("height").slice(0,-2),10);var w=parseInt(this._getScrollContainer().css("width").slice(0,-2),10);var i=this._getScrollContainer()[0].scrollHeight;var c=this._getScrollContainer()[0].scrollWidth;if(this.getScrollable()&&(i>h||c>w)){this._switchCursors(this._getScrollContainer(),this._defaultCursorClass,this._grabCursorClass);this._getScrollContainer().css("overflow","auto");}}$=this._getScrollContainer();S=this._getScrollContainerOnZoomChanged(s,$);$.scrollLeft(S.scrollLeft);$.scrollTop(S.scrollTop);this._adjustAndShowArrow();if(this._isFocusChanged){this._setFocusToNode();this._isFocusChanged=false;}}};b.prototype.zoomOut=function(){var c=this.getZoomLevel();var n=c;switch(c){case(l.ProcessFlowZoomLevel.One):n=l.ProcessFlowZoomLevel.Two;break;case(l.ProcessFlowZoomLevel.Two):n=l.ProcessFlowZoomLevel.Three;break;case(l.ProcessFlowZoomLevel.Three):n=l.ProcessFlowZoomLevel.Four;break;default:break;}this.setZoomLevel(n);return this.getZoomLevel();};b.prototype.zoomIn=function(){var c=this.getZoomLevel();var n=c;switch(c){case(l.ProcessFlowZoomLevel.Four):n=l.ProcessFlowZoomLevel.Three;break;case(l.ProcessFlowZoomLevel.Three):n=l.ProcessFlowZoomLevel.Two;break;case(l.ProcessFlowZoomLevel.Two):n=l.ProcessFlowZoomLevel.One;break;default:break;}this.setZoomLevel(n);return this.getZoomLevel();};b.prototype.updateModel=function(){var n=this.getNodes();n.forEach(function(c){c._mergedLaneId=false;});var L=this.getLanes();L.forEach(function(c){c._mergedLanePosition=false;});this._internalLanes=[];if(this._isHeaderMode()){var o=this.getBindingInfo("lanes");this.getModel(o.model).refresh();}else{var N=this.getBindingInfo("nodes");this.getModel(N.model).refresh();}this.rerender();};b.prototype.optimizeLayout=function(i){if(i===undefined){i=true;}if(this._isLayoutOptimized!==i){this._isLayoutOptimized=i;this.updateModel();}return this;};b.prototype.getFocusedNode=function(){return this._lastNavigationFocusElement&&this._lastNavigationFocusElement.sId;};b.prototype.updateNodesOnly=function(){var n=this.getBindingInfo("nodes");this.getModel(n.model).refresh();this.rerender();};b.prototype.setSelectedPath=function(s,t){var n=this.getNodes(),i;if(n){if(s&&t){var c=0;for(i=0;i<n.length;i++){if(n[i].getNodeId()===s||n[i].getNodeId()===t){n[i].setSelected(true);c++;}else{n[i].setSelected(false);}}if(c===2){this.rerender();}}else if(!s&&!t){for(i=0;i<n.length;i++){n[i].setSelected(false);}this.rerender();}}};b.prototype.setShowLabels=function(v){var o=this.getShowLabels();if(o&&!v){this.setProperty("showLabels",v,true);if(!this.getShowLabels()){this.setSelectedPath(null,null);}}else{this.setProperty("showLabels",v);}};b.prototype.setFocusToLabel=function(c){this._changeNavigationFocus(this._lastNavigationFocusElement,c);};b.prototype._labelCanGetFocus=function(c){return c&&c.getEnabled()&&(!this._bHighlightedMode||c._bHighlighted);};b.prototype.getNode=function(n){var N=this.getNodes();for(var i=0;i<N.length;i++){if(N[i].getProperty("nodeId")===n){return N[i];}}};b.prototype.getLane=function(L){var c=this.getLanes();for(var i=0;i<c.length;i++){if(c[i].getProperty("laneId")===L){return c[i];}}};return b;});
