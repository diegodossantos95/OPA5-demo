/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(['jquery.sap.global','./library','sap/m/library','sap/ui/comp/library','sap/ui/core/Control','sap/m/ComboBox','sap/m/Popover','sap/m/Link','sap/m/StandardListItem','sap/ui/core/delegate/ItemNavigation','sap/m/Button','sap/m/SelectDialog','sap/ui/model/Filter','sap/ui/model/FilterOperator','sap/ui/core/Element','sap/m/Text','sap/m/Bar','sap/ui/model/Sorter','sap/ui/Device','sap/m/Label','sap/m/List','sap/m/ScrollContainer','sap/m/HBox','sap/m/VBox','sap/ui/comp/variants/VariantManagement','sap/m/GroupHeaderListItem','sap/ui/core/Item'],function(q,l,M,S,C,a,P,L,b,I,B,c,F,d,E,T,f,g,D,h,j,k,H,V,m,G,n){"use strict";var p=C.extend("sap.suite.ui.commons.TargetFilter",{metadata:{deprecated:true,library:"sap.suite.ui.commons",properties:{entitySet:{type:"string",group:"Misc",defaultValue:null}},aggregations:{columns:{type:"sap.suite.ui.commons.TargetFilterColumn",multiple:true,singularName:"column"},_countDisplay:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},_quad0:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},_quad1:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},_quad2:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},_quad3:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},measureColumn:{type:"sap.suite.ui.commons.TargetFilterMeasureColumn",multiple:false}},associations:{selectedColumns:{type:"sap.suite.ui.commons.TargetFilterColumn",multiple:true,singularName:"selectedColumn"}},events:{search:{},filterChange:{},cancel:{}}}});var r=a.extend("sap.suite.ui.commons.TargetFilterComboBox",{metadata:{properties:{popoverPlacement:{type:"sap.m.PlacementType",group:"Misc",defaultValue:"Bottom"}}},_createPopover:function(){var o=new P({showHeader:false,placement:this.getPopoverPlacement(),offsetX:0,offsetY:0,initialFocus:this,bounce:false});o.addStyleClass("TFComboBox");this._decoratePopover(o);return o;},renderer:"sap.m.ComboBoxRenderer"});var s=L.extend("sap.suite.ui.commons.TargetFilterLink",{metadata:{properties:{count:{type:"int"},key:{type:"string"}}},onmouseover:function(e){if(this.$()[0].scrollWidth>this.$().innerWidth()){this.firePress();}},renderer:"sap.m.LinkRenderer"});var t=b.extend("sap.suite.ui.commons.TargetFilterListItem",{metadata:{properties:{index:{type:"int"},key:{type:"string"}}},ontap:function(e){if(!q(e.target).hasClass("sapMCbMarkChecked")){this.setSelected(!this.getSelected());this.informList("Select",!this.getSelected());}this.firePress();},onkeyup:function(e){if(e.which===q.sap.KeyCodes.ENTER||e.which===q.sap.KeyCodes.SPACE){this.firePress();}},renderer:"sap.m.StandardListItemRenderer"});var u=C.extend("sap.suite.ui.commons.TargetFilterLinksCloud",{metadata:{properties:{index:{type:"int"}},aggregations:{links:{cardinality:"0..n",type:"sap.suite.ui.commons.TargetFilterLink"}}},init:function(){var e=this;this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons");this._oOthersLink=new s(this.getId()+"-others-link",{text:"+000 "+e._oRb.getText("TARGETFILTER_MORE_TEXT"),press:function(){var o=e.getParent();var y=Object.getOwnPropertyNames(o._oFilters);var z=0;for(var i=0;i<y.length;i++){if(!o._oFilters[y[i]].linkId){delete o._oFilters[y[i]];z++;}}this.setCount(this.getCount()-z);o.fireFiltersChanged();}});this._oOthersLink.addStyleClass("sapSuiteUiTFOthersLine");this._oOthersLink.setEmphasized(true).setSubtle(false);this._oOthersLink.setCount=function(i){this.setProperty("count",i,true);if(i>0){this.$().removeClass("Hidden");this.setText("+"+i+" "+e._oRb.getText("TARGETFILTER_MORE_TEXT"));}else{this.$().addClass("Hidden");}};},exit:function(){this._oOthersLink.destroy();},_setFontSizes:function(e){var i=["Large","Medium","Small","Smallest"];var O=q.unique(e.map(function(o){return o.getCount();}));switch(O.length){case 1:for(var A=0;A<e.length;A++){e[A].addStyleClass(i[1]);}break;case 2:for(var A=0;A<e.length;A++){if(O[0]===e[A].getCount()){e[A].addStyleClass(i[1]);}else{e[A].addStyleClass(i[2]);}}break;default:var y=Math.min.apply(null,O);var z=Math.max.apply(null,O);for(var A=0;A<e.length;A++){var J=Math.floor(3.99*(z-e[A].getCount())/(z-y));e[A].addStyleClass(i[J]);}}},renderer:function(R,o){var e=o.getLinks();R.write("<div");R.writeControlData(o);R.addClass("sapSuiteUiTFLinksCloud");R.writeClasses();R.write(">");o._setFontSizes(e);for(var i=0;i<e.length;i++){if(!!e[i].getText()){R.renderControl(e[i]);}}o._oOthersLink.addStyleClass("Quad"+o.getIndex()).addStyleClass("Hidden");R.renderControl(o._oOthersLink);R.write("</div>");},updateVisibleLinks:function(){var o=this.getParent();var e=this.$().find(".sapSuiteUiTFLine:not(.Hidden)");var y=0;var z=Object.getOwnPropertyNames(o._oFilters);for(var i=0;i<z.length;i++){delete o._oFilters[z[i]].linkId;}e.each(function(){var A=sap.ui.getCore().byId(this.id);var J=o._oFilters[A.getKey()];if(J){A.setEmphasized(true).setSubtle(false);J.linkId=A.getId();y++;}else{A.setEmphasized(false).setSubtle(true);}});this._oOthersLink.setCount(z.length-y);},onAfterRendering:function(){if(this.getLinks().length!==0){this.drawCloudCircle();this.updateVisibleLinks();}},drawCloudCircle:function(){var R=sap.ui.getCore().getConfiguration().getRTL();var o=Math.ceil(parseFloat(q(".sapSuiteUiTFOuterCircle").width()/2))-5;var e=Math.ceil(parseFloat(q(".sapSuiteUiTFCentralCircle").outerWidth()/2));var y=Math.ceil(parseFloat(q(".sapSuiteUiTFOuterCont").outerHeight()/2));var z=q("html").hasClass("sapUiMedia-Std-Phone");var A=Math.ceil(parseFloat(q(".sapSuiteUiTFBox").outerHeight()));var J=Math.ceil(parseFloat(q(".sapSuiteUiTFBox").outerWidth()));if(!z){J+=Math.ceil(parseFloat(q(".sapSuiteUiTFBox.Quad0").css("right")));}var K=8;this.initQuadArea(o-K,y,e+K,A,J,K);var N=this;var Q=this.getIndex();var X=((Q===0||Q===3)!==R)?"left":"right";var Y=(Q===0||Q===1)?"bottom":"top";var O=this.getLinks();for(var i=0;i<O.length;i++){var U=O[i].$();if(U.length>0){var W=U[0].scrollWidth;if(O.length<=5&&this.isCompact()){var Z=[0,2,[1,3][i],[1,2,3][i],[0,1,2,3][i],[0,1,2,3,4][i]][O.length];if(U.width()>this._bgArea[Z].width){U.width(this._bgArea[Z].width);}this._bgArea[Z].placed.push(U);}else if(O.length<=3&&!this.isCompact()){var Z=[0,1,[0,2][i],[0,1,2][i]][O.length];if(U.width()>this._bgArea[Z].width){U.width(this._bgArea[Z].width);}this._bgArea[Z].placed.push(U);}else{var $=48;if(O[i].getText().length<3){W=Math.ceil(O[i].getText().length*$/3);}U.width(W);var _=U.outerWidth();var a1=-1;var b1=1000;var c1=-1;var d1=0;for(var e1=0;e1<N._bgArea.length;e1++){var f1=N._bgArea[e1].width-_;if(f1>=0&&f1<b1){b1=f1;a1=e1;}if(f1<0&&f1<d1){d1=f1;c1=e1;}}if(a1!==-1){this._bgArea[a1].placed.push(U);this._bgArea[a1].width-=_;}else if(c1!==-1&&N._bgArea[c1].width>=$){if(U.width()>this._bgArea[c1].width){U.width(this._bgArea[c1].width);}_=U.outerWidth();this._bgArea[c1].width-=_;this._bgArea[c1].placed.push(U);}else{U.addClass("Hidden");}}}}for(var e1=0;e1<this._bgArea.length;e1++){var g1=this._bgArea[e1].start;var h1=this._bgArea[e1].placed.length;var i1=Math.max(0,this._bgArea[e1].width);for(var j1=0;j1<h1;j1++){var k1=2.0*i1/h1;var l1=this._bgArea[e1].placed[j1];l1.css(Y,this._bgArea[e1].offset+"px");l1.css(X,g1+"px");g1+=l1.outerWidth()+Math.ceil(k1*Math.random());}}this.initItemNavigation();},onsappageup:function(){var N=this.oItemNavigation.getFocusedIndex()-this.oItemNavigation.iPageSize;if(N<0||!this.oItemNavigation.getItemDomRefs()[N]){for(var i=0;i<this.oItemNavigation.getItemDomRefs().length;i++){if(this.oItemNavigation.getItemDomRefs()[i]){this.oItemNavigation.setFocusedIndex(i);q.grep(this.oItemNavigation.getItemDomRefs(),function(o){return o;})[0].focus();return;}}}},initItemNavigation:function(){var Q=this.getIndex();var o=this.getDomRef();var e=this.getLinks();if(e){var i=new Array(e.length);if(this._bgArea){var R=(Q===0||Q===1)?this._bgArea.reverse():this._bgArea;R.forEach(function(A){var y=A.placed;if(y){y=(Q===1||Q===2)?y.reverse():y;y.forEach(function(z){i.push(z);});}});}if(!this.oItemNavigation){this.oItemNavigation=new I();this.addDelegate(this.oItemNavigation);}this.oItemNavigation.setRootDomRef(o);this.oItemNavigation.setItemDomRefs(i);this.oItemNavigation.setCycling(false);this.oItemNavigation.setPageSize(5);}},isCompact:function(){return this.$().closest(".sapUISizeCompact").length>0;},initQuadArea:function(o,i,e,y,z,A){var J=q("html").hasClass("sapUiMedia-Std-Phone");if(i<0){i=0;}var R=this.isCompact()?5:3;this._bgArea=new Array(R);var Y=(i-A-y)/R;var O=y;for(var K=0;K<R;K++){var N=e*e-O*O;var Q=((N>0)?Math.ceil(parseFloat(Math.sqrt(N))):0)+A;this._bgArea[K]={start:Q,width:(J?o:Math.ceil(parseFloat(Math.sqrt(o*o-(O+Y)*(O+Y)))))-Q,offset:O,placed:[]};O+=Math.ceil(Y);}}});var v=C.extend("sap.suite.ui.commons.TargetFilterQuadrant",{metadata:{properties:{index:{type:"int"}},aggregations:{linkClouds:{multiple:true,type:"sap.suite.ui.commons.TargetFilterLinksCloud"},dialog:{multiple:true,type:"sap.m.SelectDialog"}},events:{filtersChanged:{}}},init:function(){var e=this;this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons");this._oFilters={};this._assignedFilters=[];this._oFilterCb=new r(this.getId()+"-cb",{selectionChange:function(){e.setColumn(this.getSelectedKey(),true);}});this._oValueHelpBtn=new B(this.getId()+"-btn",{icon:"sap-icon://search",press:function(){e.fnShowValueHelper();}});this.addLinkCloud(new u(this.getId()+"-links"));this._oSelectDialog=new c(this.getId()+"-browser",{multiSelect:true,liveChange:function(o){var i=o.getParameter("value");var y=o.getParameter("itemsBinding");var z=[];try{if(i!==undefined&&i.length){z.push(new F(e._oColumn.getPath(),e._oColumn.getType().getName()==="String"?d.Contains:d.EQ,e._oColumn.getType().parseValue(i,"string")));}y.filter(z);}catch(A){q.sap.log.warning("'"+i+"' is not valid "+e._oColumn.getType().getName(),this);this.removeAllItems();}},confirm:function(o){var i=o.getParameter("selectedContexts");e._oFilters={};for(var y in e.oSelectedDialogSaveItems){if(e.oSelectedDialogSaveItems[y]){e._oFilters[y]={filter:new F(e._oColumn.getPath(),d.EQ,y),text:e._oColumn.getType().formatValue(y,"string")};}}e.oSelectedDialogSaveItems={};e.fireFiltersChanged();e.getLinkClouds()[0].updateVisibleLinks();},cancel:function(o){e.oSelectedDialogSaveItems={};}});this.addAggregation("dialog",this._oSelectDialog);},hasFilters:function(){return Object.getOwnPropertyNames(this._oFilters).length!==0;},hasFilter:function(e){return this._oFilters.hasOwnProperty(e);},getFiltersSet:function(){var e=[];var o=Object.getOwnPropertyNames(this._oFilters);for(var i=0;i<o.length;i++){e.push({key:o[i],text:this._oFilters[o[i]].text});}return e;},getFilters:function(){var e=[];var o=Object.getOwnPropertyNames(this._oFilters);for(var i=0;i<o.length;i++){e.push(this._oFilters[o[i]].filter);}if(e.length){return new F(e,false);}},filter:function(e){this._assignedFilters=e;this._oFilters={};var o=this.getLinkClouds()[0].getBinding("links");o.filter(this._assignedFilters);},removeFilter:function(e){var o=this._oFilters[e];if(o.linkId){sap.ui.getCore().byId(o.linkId).setEmphasized(false).setSubtle(true);}else{this.getLinkClouds()[0]._oOthersLink.setCount(this.getLinkClouds()[0]._oOthersLink.getCount()-1);}delete this._oFilters[e];this.fireFiltersChanged();},setProperty:function(e,i,o){E.prototype.setProperty.apply(this,arguments);if(e==="index"){if(i===0||i===1){this._oFilterCb.setPopoverPlacement(l.VerticalPreferedTop).addStyleClass("sapSuiteTFCBTop");}else{this._oFilterCb.setPopoverPlacement(l.VerticalPreferedBottom);}if(i===0||i===3){this._oFilterCb.addStyleClass("sapSuiteTFCBArrowBeforeVal");}this.getLinkClouds()[0].setIndex(i);}},setColumn:function(e,i){this._oColumn=sap.ui.getCore().byId(e);if(this._oColumn){if(!i){this._oFilterCb.setSelectedKey(e);}var o=this.getParent();var y=this;var R=new s({key:"{"+this._oColumn.getPath()+"}",text:{path:this._oColumn.getPath(),type:this._oColumn.getType()},count:{path:o.getMeasureColumn().getPath()},press:function(A){if(this.$()[0].scrollWidth>this.$().innerWidth()){var J=this;var K=this.getParent().getParent().getId();if(sap.ui.getCore().byId(K+"-popover"))y._selectPopover.destroy();y._selectPopover=new P(K+"-popover",{title:sap.ui.getCore().byId(K+"-cb").getValue(),content:[new T({text:this.getText(),wrapping:true}).addStyleClass("sapSuiteUiTFPopoverText")],footer:[new f({contentRight:[new B({text:y._oRb.getText(this.getEmphasized()?"TARGETFILTER_BUTTON_DESELECT":"TARGETFILTER_BUTTON_SELECT"),type:"Emphasized",press:function(){y.toggleLinkSelection(J);y._selectPopover.close();}}),new B({text:y._oRb.getText("TARGETFILTER_BUTTON_CANCEL"),press:function(){y._selectPopover.close();}})]})],placement:M.PlacementType.Vertical,afterClose:function(N){if(N)N.getSource().destroy();}}).addStyleClass("sapSuiteUiTFPopover");y._selectPopover.openBy(this);y._selectPopover.$().attr("role","alert").removeAttr("aria-label");return;}y.toggleLinkSelection(this);}});R.addStyleClass("sapSuiteUiTFLine");R.addStyleClass("Quad"+this.getIndex());this.getLinkClouds()[0].bindAggregation("links",{path:"/"+o.getEntitySet(),parameters:{select:this._oColumn.getPath()+","+o.getMeasureColumn().getPath()},template:R,length:this._oColumn.getLength(),sorter:[new g(o.getMeasureColumn().getPath(),true),new g(this._oColumn.getPath(),false)],filters:this._assignedFilters});var z=this.hasFilters();this._oFilters={};if(z){this.fireFiltersChanged();}}else{this.getLinkClouds()[0].removeAllLinks();}},toggleLinkSelection:function(o){if(this._oFilters[o.getKey()]){delete this._oFilters[o.getKey()];o.setEmphasized(false).setSubtle(true);}else{this._oFilters[o.getKey()]={filter:new F(this._oColumn.getPath(),d.EQ,o.getKey()),linkId:o.getId(),text:o.getText()};o.setEmphasized(true).setSubtle(false);}this.fireFiltersChanged();},fnShowValueHelper:function(){var o=this.getParent();var e=this;var i=" "+e._oRb.getText("TARGETFILTER_ENTRIES_TEXT");this._oSelectDialog.bindAggregation("items",{path:"/"+o.getEntitySet(),parameters:{select:this._oColumn.getPath()+","+o.getMeasureColumn().getPath()},sorter:[new g(o.getMeasureColumn().getPath(),true),new g(this._oColumn.getPath(),false)],filters:this._assignedFilters,factory:function(y,z){var A=new t({key:{path:e._oColumn.getPath()},title:{type:e._oColumn.getType(),path:e._oColumn.getPath()},description:{path:o.getMeasureColumn().getPath(),formatter:function(N){return N+i;}},selected:e.fnSelectDialogItemSelection(z),press:function(J){e.oSelectedDialogSaveItems[this.getProperty("key")]=this.getSelected();}});return A;}});this._oSelectDialog.setTitle(this._oColumn.getTitle()),this._oSelectDialog.open();},oSelectedDialogSaveItems:{},fnSelectDialogItemSelection:function(o){var e=o.getProperty(this._oColumn.getPath());if(this.oSelectedDialogSaveItems[e]===undefined){this.oSelectedDialogSaveItems[e]=this.hasFilter(e);}return this.oSelectedDialogSaveItems[e];},rebindColumns:function(){var o=this.getParent();this._oFilterCb.removeAllItems();for(var i=0;i<o.getColumns().length;i++){var e=o.getColumns()[i];var y=new n({key:e.getId(),text:e.getTitle()});this._oFilterCb.addItem(y);}if(o.getSelectedColumns()&&o.getSelectedColumns()[this.getIndex()]){this.setColumn(o.getSelectedColumns()[this.getIndex()]);}else if(o.getColumns()[this.getIndex()]){this.setColumn(o.getColumns()[this.getIndex()].getId());}else{this.setColumn();}},exit:function(){if(this.oItemNavigation){this.removeDelegate(this.oItemNavigation);this.oItemNavigation.destroy();}this._oFilterCb.destroy();this._oValueHelpBtn.destroy();},renderer:function(R,o){var Q=o.getIndex();R.write("<div");R.writeControlData(o);R.addClass("sapSuiteUiTFQuadrant");R.addClass("Quad"+Q);R.writeClasses();R.write(">");R.write("<div");R.addClass("sapSuiteUiTFBox");R.addClass("Quad"+Q);R.writeClasses();R.write(">");R.write("<div");R.addClass("sapSuiteUiTFParCont");R.addClass("Quad"+Q);R.writeClasses();R.write(">");R.renderControl(o._oFilterCb);R.write("</div>");R.write("<div");R.addClass("sapSuiteUiTFValHel");R.addClass("Quad"+Q);R.writeClasses();R.write(">");R.renderControl(o._oValueHelpBtn);R.write("</div>");R.write("</div>");R.write("<div");R.addClass("sapSuiteUiTFHorizontalLineBg");R.addClass("Quad"+Q);R.writeClasses();R.write(">");R.write("<div");R.addClass("sapSuiteUiTFHorizontalLine");R.addClass("Quad"+Q);R.writeClasses();R.write(">");R.write("</div>");R.write("</div>");R.renderControl(o.getLinkClouds()[0]);R.write("</div>");}});var w=C.extend("sap.suite.ui.commons.TargetFilterCountDisplay",{metadata:{aggregations:{counts:{multiple:true,type:"sap.suite.ui.commons.TargetFilterCount"}}},init:function(){this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons");},renderer:function(R,o){R.write("<div");R.writeControlData(o);R.addClass("sapSuiteUiTFCentralLabel");R.writeClasses();R.write(">");if(o.getCounts().length){R.write(o.getCounts()[0].getCount());}R.write("</div>");},filter:function(e){this.getBinding("counts").filter(e);this.getParent()._oShowSelectedLink.setText(this._oRb.getText((this.getParent().iCountFilters>0)?"TARGETFILTER_SHOW_SELECTED_TEXT":"TARGETFILTER_SHOW_ALL_TEXT"));}});var x=E.extend("sap.suite.ui.commons.TargetFilterCount",{metadata:{properties:{count:{type:"string"}},events:{countUpdated:{}}},setProperty:function(e,o,i){E.prototype.setProperty.apply(this,arguments);if(e==="count"){this.fireCountUpdated({});}}});p.prototype.init=function(){D.media.attachHandler(this.rerender,this,D.media.RANGESETS.SAP_STANDARD);this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons");var o=this;this._aQuadrants=[];this._aSelectionHistory=[];for(var i=0;i<4;i++){var Q=new v(this.getId()+"-quad"+i,{index:i,filtersChanged:function(){o._handleFiltersChange(this.getIndex());}});this._aQuadrants.push(Q);this.setAggregation("_quad"+i,Q);}this._aQuadrants[0].getLinkClouds()[0].addDelegate({onAfterRendering:function(e){o._setVariantsFilterItems(0);}});this._aQuadrants[1].getLinkClouds()[0].addDelegate({onAfterRendering:function(e){o._setVariantsFilterItems(1);}});this._aQuadrants[2].getLinkClouds()[0].addDelegate({onAfterRendering:function(e){o._setVariantsFilterItems(2);}});this._aQuadrants[3].getLinkClouds()[0].addDelegate({onAfterRendering:function(e){o._setVariantsFilterItems(3);}});this._oSearchBtn=new B(this.getId()+"-search",{icon:"sap-icon://initiative",press:function(){o.search();}}).addStyleClass("sapSuiteUiTFSearchBtn");this._oSettingsBtn=new B(this.getId()+"-master-settings-button",{icon:"sap-icon://action-settings"});this._oSelLstLbl=new h(this.getId()+"-selection-list-label",{text:this._oRb.getText("TARGETFILTER_YOUR_SELECTION_TEXT")+" (0)",labelFor:this.getId()+"-selection-list"}).addStyleClass("sapSuiteUiTFSelLstLbl");this._oSelLst=new j(this.getId()+"-selection-list",{mode:"Delete","delete":function(e){this.attachEventOnce("updateFinished",this.focus,this);var y=e.getParameter("listItem");o._aQuadrants[y.getIndex()].removeFilter(y.getKey());},growing:true});this._oScrollCont=new k(this.getId()+"-scrl-cntnr",{horizontal:false,vertical:true,height:"17rem",content:this._oSelLst}).addStyleClass("sapSuiteUiTFScroll");this._oShowSelLbl=new L(this.getId()+"-show-selected-label",{press:function(){o.search();}}).addStyleClass("sapSuiteUiTFShowSelLbl");this._oShowSelBox=new H(this.getId()+"-selection-box",{items:[this._oSearchBtn,this._oShowSelLbl]}).addStyleClass("sapSuiteUiTFShowSelBox");this._oRightPanel=new V(this.getId()+"-right-panel-box",{items:[this._oSelLstLbl,this._oScrollCont,this._oShowSelBox]}).addStyleClass("sapSuiteUiTFRightPanelBox");this._oCountDisplay=new w();this.setAggregation("_countDisplay",this._oCountDisplay);this._oShowSelectedLink=new L(this.getId()+"-show-selected-link",{text:this._oRb.getText("TARGETFILTER_SHOW_ALL_TEXT"),press:function(){o.search();}});this._oSavedFiltersSet={};this._oVariants={};this.oVariantManagement=new m({enabled:true,showExecuteOnSelection:true,showShare:true,save:function(e){o._oVariants.sSelectedId=e.getParameters().key;o._oVariants[e.getParameters().key]={links:o._getFiltersSet(),aQuadrantsHistory:[],aQuadrantsCBSelected:[]};for(var i=0;i<4;i++){o._oVariants[e.getParameters().key].aQuadrantsCBSelected.push(o._aQuadrants[i]._oColumn.getPath());}if(o._aSelectionHistory.length!==0){for(var i in o._aSelectionHistory){o._oVariants[e.getParameters().key].aQuadrantsHistory[i]=o._aSelectionHistory[i];}}},select:function(e){o._oVariants.sSelectedId=e.getParameters().key;o._oVariants[o._oVariants.sSelectedId].iQHIndex=0;var y=o._oVariants[o._oVariants.sSelectedId].aQuadrantsHistory;if(y.length!==0){o._oVariants.steps=[];for(var i in y){o._oVariants.steps[y[i]]=2;}o._setVariantsFilterItems(y[0]);}else{var z=o._oVariants[o._oVariants.sSelectedId].aQuadrantsCBSelected;for(var i=0;i<z.length;i++){o.setQuadCBoxItem(i,z[i]);}var A=o._aSelectionHistory[0];if(o._aSelectionHistory.length!==0){o._aQuadrants[A]._oFilters={};o._aQuadrants[A].getLinkClouds()[0].updateVisibleLinks();o._handleFiltersChange(A);}}}});D.resize.attachHandler(this._calcWidthTargetWidthRPanel);this.addDelegate({onAfterRendering:function(e){o._calcWidthTargetWidthRPanel();}});this.data("sap-ui-fastnavgroup","true",true);};p.prototype._calcWidthTargetWidthRPanel=function(e){var i=1024;var o=16;var R=Math.min(3,Math.max(0,(parseInt(q('.sapMFlexItem').css("width"))-i)/o));q('.sapUiMedia-Std-Desktop .sapSuiteUiTFRightPanel').css("margin-left",R+"rem");};p.prototype._setVariantsFilterItems=function(Q){if(this._oVariants.steps&&this._oVariants.steps[Q]!==null){if(this._oVariants[this._oVariants.sSelectedId].iQHIndex>4||this._aQuadrants[Q].getLinkClouds()[0].getLinks().length===0||this._oVariants[this._oVariants.sSelectedId].aQuadrantsHistory[this._oVariants[this._oVariants.sSelectedId].iQHIndex]!==Q){return;}switch(this._oVariants.steps[Q]){case 2:this._oVariants.steps[Q]=1;if(!this.setQuadCBoxItem(Q,this._oVariants[this._oVariants.sSelectedId].aQuadrantsCBSelected[Q])){this._setVariantsFilterItems(Q);}break;case 1:this._oVariants.steps[Q]=null;this._oVariants[this._oVariants.sSelectedId].iQHIndex++;var o=this._oVariants[this._oVariants.sSelectedId].links[this._oVariants[this._oVariants.sSelectedId].aQuadrantsCBSelected[Q]];if(!o){break;}this._aQuadrants[Q]._oFilters={};var e=this._aQuadrants[Q].getLinkClouds()[0].getLinks();for(var y in o){for(var i in e){if(e[i].getKey()===y){this._aQuadrants[Q]._oFilters[y]={filter:new F(this._aQuadrants[Q]._oColumn.getPath(),d.EQ,y),linkId:e[i].getId(),text:e[i].getText()};e[i].setEmphasized(true).setSubtle(false);}}}this._aQuadrants[Q].getLinkClouds()[0].updateVisibleLinks();this._handleFiltersChange(Q);break;}}};p.prototype.setQuadCBoxItem=function(Q,N){if(this._aQuadrants[Q]._oColumn.getPath()===N){return false;}var o={};var e=this._aQuadrants[Q]._oFilterCb.getItems();for(var i=0;i<e.length;i++){o[sap.ui.getCore().byId(e[i].getKey()).getPath()]=e[i].getKey();}if(o[N]){this._aQuadrants[Q].setColumn(o[N]);return true;}return false;};p.prototype.search=function(){this.fireSearch();this._oSavedFiltersSet=this._getFiltersSet();return this;};p.prototype._getFiltersSet=function(){var o={};for(var i=0;i<this._aQuadrants.length;i++){var e=this._aQuadrants[i].getFiltersSet();var Q={};for(var y=0;y<e.length;y++){Q[e[y].key]={};}if(e.length){o[this._aQuadrants[i]._oColumn.getPath()]=Q;}}return o;};p.prototype.getParameters=function(){return{};};p.prototype.getFilters=function(){var e=[];for(var i=0;i<this._aSelectionHistory.length;i++){var o=this._aQuadrants[this._aSelectionHistory[i]].getFilters();if(o){e.push(o);}}if(e.length){return[new F(e,true)];}else{return e;}};p.prototype._handleFiltersChange=function(Q){this.iCountFilters=0;var e=this._aSelectionHistory.indexOf(Q);if(e===-1){this._aSelectionHistory.push(Q);}else{this._aSelectionHistory.splice(this._aQuadrants[Q].hasFilters()?e+1:e);}this._oSelLst.removeAllItems();for(var i=0;i<this._aSelectionHistory.length;i++){var o=this._aQuadrants[this._aSelectionHistory[i]].getFiltersSet();if(o.length){var z=new G({title:this._aQuadrants[this._aSelectionHistory[i]]._oColumn.getTitle(),upperCase:false});this._oSelLst.addItem(z);for(var y=0;y<o.length;y++){var z=new t({title:o[y].text,key:o[y].key,index:this._aSelectionHistory[i]});this._oSelLst.addItem(z);this.iCountFilters++;}}}this._oSelLst.rerender();var o=this.getFilters();for(var i=0;i<this._aQuadrants.length;i++){e=this._aSelectionHistory.indexOf(i);if(e===-1&&Q!==i){this._aQuadrants[i].filter(o);}}this._oCountDisplay.filter(o);this.fireFilterChange();var A=this._getFiltersSet();if(this.equalFiltersSet(A,this._oSavedFiltersSet)){this.fireCancel();}this._oSelLstLbl.setText(this._oRb.getText("TARGETFILTER_YOUR_SELECTION_TEXT")+" ("+this.iCountFilters+")");};p.prototype.equalFiltersSet=function(o,e){var y=Object.getOwnPropertyNames(o);var z=Object.getOwnPropertyNames(e);if(y.length!==z.length){return false;}for(var i=0;i<y.length;i++){var A=y[i];if(!e.hasOwnProperty(A)||!this.equalFiltersSet(o[A],e[A])){return false;}}return true;};p.prototype._bindModel=function(){if(this._bBindModel){this._bBindModel=false;for(var i=0;i<this._aQuadrants.length;i++){this._aQuadrants[i].rebindColumns();}var e=this;this._oCountDisplay.bindAggregation("counts",{path:"/"+this.getEntitySet(),parameters:{select:this.getMeasureColumn().getPath()},length:1,template:new x({count:{path:this.getMeasureColumn().getPath(),type:this.getMeasureColumn().getType()},countUpdated:function(){e._oShowSelLbl.setText(e._oRb.getText((e.iCountFilters>0)?"TARGETFILTER_SHOW_SELECTED_TEXT":"TARGETFILTER_SHOW_ALL_TEXT")+" ("+this.getCount()+")");}})});}};p.prototype._callMethodInManagedObject=function(e,i){if(i==="columns"||i==="entitySet"||i==="measureColumnName"){this._bBindModel=true;}var o=Array.prototype.slice.call(arguments);return C.prototype[e].apply(this,o.slice(1));};p.prototype.setProperty=function(e,o,i){this._callMethodInManagedObject("setProperty",e,o,i);return this;};p.prototype.insertAggregation=function(A,o,i,e){this._callMethodInManagedObject("insertAggregation",A,o,i,e);return this;};p.prototype.addAggregation=function(A,o,e){this._callMethodInManagedObject("addAggregation",A,o,e);return this;};p.prototype.removeAggregation=function(A,o,e){return this._callMethodInManagedObject("removeAggregation",A,o,e);};p.prototype.removeAllAggregation=function(A,e){return this._callMethodInManagedObject("removeAllAggregation",A,e);};p.prototype.destroyAggregation=function(A,e){this._callMethodInManagedObject("destroyAggregation",A,e);return this;};p.prototype.onBeforeRendering=function(){this._bindModel();};p.prototype.onAfterRendering=function(){var e=this;this._oShowSelBox.$().attr("tabindex","0");this._oShowSelBox.addDelegate({onkeypress:function(o){if(o.which===q.sap.KeyCodes.ENTER||o.which===q.sap.KeyCodes.SPACE){e._oSearchBtn.firePress();o.preventDefault();}}});this._oShowSelLbl.$().attr("tabindex","-1");this._oSearchBtn.$().attr("tabindex","-1");};p.prototype.exit=function(){D.media.detachHandler(this.rerender,this,D.media.RANGESETS.SAP_STANDARD);this._oSearchBtn.destroy();this._oSettingsBtn.destroy();this._oSelLstLbl.destroy();this._oSelLst.destroy();this._oScrollCont.destroy();this._oShowSelLbl.destroy();this._oShowSelBox.destroy();this._oRightPanel.destroy();this._oShowSelectedLink.destroy();};return p;});
