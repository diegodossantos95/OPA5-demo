jQuery.sap.declare("sap.rules.ui.parser.businessLanguage.lib.conversionUtils");jQuery.sap.require("sap.rules.ui.parser.infrastructure.errorHandling.hrfException");jQuery.sap.require("sap.rules.ui.parser.businessLanguage.lib.constants");jQuery.sap.require("sap.rules.ui.parser.businessLanguage.lib.localeConversion");jQuery.sap.require("sap.rules.ui.parser.businessLanguage.lib.parseUtils");jQuery.sap.require("sap.rules.ui.parser.resources.vocabulary.lib.constantsBase");sap.rules.ui.parser.businessLanguage.lib.conversionUtils=sap.rules.ui.parser.businessLanguage.lib.conversionUtils||{};sap.rules.ui.parser.businessLanguage.lib.conversionUtils.lib=(function(){var h=sap.rules.ui.parser.infrastructure.errorHandling.hrfException.lib;var c=sap.rules.ui.parser.businessLanguage.lib.constants.lib;var l=sap.rules.ui.parser.businessLanguage.lib.localeConversion.lib;var p=sap.rules.ui.parser.businessLanguage.lib.parseUtils.lib;var a=new p.parseUtilsLib();var v=sap.rules.ui.parser.resources.vocabulary.lib.constantsBase.lib;function b(){}function d(n,e,m){var f={args:[]};if(n===null){f.key="error_in_expression_invalid_value_from_list_message";f.args[0]=e.token.slice(1,-1);f.args[1]=e.info.key;m.parseResult.cursorPosition=e.start;m.parseResult.convertedExpression=null;a.handleError(f.key,f.args,m);throw new h.HrfException();}}function t(e,f,m){var g={args:[]};g.key="techincal_error";g.args[0]=e.message;m.parseResult.cursorPosition=f.start;m.parseResult.convertedExpression=null;a.handleError(g.key,g.args,m);throw new h.HrfException();}b.prototype.needsNativeValueListConversion=function(m){return m.hasOwnProperty(c.propertiesEnum.flags)&&m.flags.hasOwnProperty(c.propertiesEnum.conversionOutput)&&((m.flags[c.propertiesEnum.conversionOutput]===c.conversionOutputEnum.toKeys)||(m.flags[c.propertiesEnum.conversionOutput]===c.conversionOutputEnum.toDescriptions));};b.prototype.needsLocaleConversion=function(m){return m.hasOwnProperty(c.propertiesEnum.flags)&&m.flags.hasOwnProperty(c.propertiesEnum.locale)&&m.flags.locale.hasOwnProperty(c.propertiesEnum.convert)&&m.flags.locale.convert.hasOwnProperty(c.propertiesEnum.source)&&m.flags.locale.convert.hasOwnProperty(c.propertiesEnum.target)&&m.flags.locale.convert.source!==m.flags.locale.convert.target;};b.prototype.needsTermConversion=function(m){return m.hasOwnProperty(c.propertiesEnum.flags)&&m.flags.hasOwnProperty(c.propertiesEnum.termMode)&&m.flags.termMode.hasOwnProperty(c.propertiesEnum.convert)&&m.flags.termMode.convert.hasOwnProperty(c.propertiesEnum.source)&&m.flags.termMode.convert.hasOwnProperty(c.propertiesEnum.target)&&m.flags.termMode.convert.source!==m.flags.termMode.convert.target;};b.prototype.isConvertRequested=function(m){return m.hasOwnProperty(c.propertiesEnum.flags)&&m.flags.hasOwnProperty(c.propertiesEnum.locale)&&m.flags.locale.hasOwnProperty(c.propertiesEnum.convert);};b.prototype.needsConversion=function(m){return this.needsNativeValueListConversion(m)||this.isConvertRequested(m);};b.prototype.convertValueNativeList=function(e,f,m,g){var i=m.flags[c.propertiesEnum.conversionOutput];var j=(i===c.conversionOutputEnum.toKeys);var n="";var k;if(g.tokenType===c.tokenTypesEnum.valueList&&e.IsValueListDescriptionExist(f,g.info.key)){k=g.info.key;try{n=(j?e.GetValueFromValueListDescription(f,k,g.token):e.GetDescriptionFromValueListValue(f,k,g.token));}catch(o){t(o,g,m);}d(n,g,m);n=(n.indexOf("'")!==0)?"'"+n+"'":n;}else{n=g.token;}return n;};b.prototype.convertLocale=function(m,e){var n=l.convertLocaleFormat(e.token,m,e.info.type);d(n,e,m);return n;};b.prototype.convertTerm=function(m,e,s){var f=null;var g=null;var i=null;var j=m.flags.termMode.convert.source;var w='';var k=null;if(j===c.DISPLAY_TEXT){g=v.TermModeRelated.TERM_MODE_BY_DESCRIPTION;i=v.TermModeRelated.TERM_PROPERTY_DESCRIPTION;}else{g=v.TermModeRelated.TERM_MODE_BY_NAME;i=v.TermModeRelated.TERM_PROPERTY_FRIENDLY_TERM;}while(e[e.length-1]===' '){w=w+' ';e=e.slice(0,e.length-1);}f=m.vocaRTServ.getTerm(m.vocabulary,e,g);if(f){k=f[i];if(w.length){k+=w;}}else{var n=null;var o=m.getTokenContext(s,e);if(o){n=m.vocaRTServ.getAttributeByTermMode(m.vocabulary,o,e,g);if(n){k=g===v.TermModeRelated.TERM_MODE_BY_DESCRIPTION?n.name:n.description;if(w.length){k+=w;}}}}return k;};b.prototype.convert=function(e,f,m,g,o){var j=o;var k=0;var n="";var q="";var i;var r;var s;var u;var w=null;var x=0;var y=0;for(i=0;i<g.length;i++){r=false;s=g[i];u=0;w="";q="";switch(s.tokenType){case c.tokenTypesEnum.valueList:if(this.needsNativeValueListConversion(m)){r=true;x=s.start;y=s.end;q=s.token;n=this.convertValueNativeList(e,f,m,s);}break;case c.tokenTypesEnum.constant:if(this.needsLocaleConversion(m)){switch(s.info.type){case c.TYPE_DATE:case c.TYPE_TIMESTAMP:case c.TYPE_TIME:case c.TYPE_NUMERIC:r=true;x=s.start;y=s.end;q=s.token;n=this.convertLocale(m,s);break;}}break;case c.tokenTypesEnum.vocabulary:if(this.needsTermConversion(m)){x=s.start;while((i+u)<g.length&&(g[i+u].tokenType===c.tokenTypesEnum.vocabulary||g[i+u].tokenType===c.tokenTypesEnum.whitespace)){if(g[i+u].tokenType===c.tokenTypesEnum.whitespace){w+=" ";}else{w+=g[i+u].token;}q+=g[i+u].token;u++;}u--;i+=u;s=g[i];y=s.end;r=true;n=this.convertTerm(m,w,x);}break;}if(r&&n){j=j.slice(0,x+k)+n+j.slice(y+1+k);k+=n.length-q.length;}}return j;};return{conversionUtilsLib:b};}());
