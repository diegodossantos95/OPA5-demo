jQuery.sap.declare("sap.rules.ui.parser.businessLanguage.lib.termsUtils");jQuery.sap.require("sap.rules.ui.parser.businessLanguage.lib.constants");jQuery.sap.require("sap.rules.ui.parser.businessLanguage.lib.parseUtils");jQuery.sap.require("sap.rules.ui.parser.businessLanguage.lib.parseModel");jQuery.sap.require("sap.rules.ui.parser.businessLanguage.lib.utils");jQuery.sap.require("sap.rules.ui.parser.businessLanguage.lib.parserTokens");jQuery.sap.require("sap.rules.ui.parser.businessLanguage.lib.vocabularyUtils");sap.rules.ui.parser.businessLanguage.lib.termsUtils=sap.rules.ui.parser.businessLanguage.lib.termsUtils||{};sap.rules.ui.parser.businessLanguage.lib.termsUtils.lib=(function(){var p=sap.rules.ui.parser.businessLanguage.lib.parseUtils.lib;var a=new p.parseUtilsLib();var c=sap.rules.ui.parser.businessLanguage.lib.constants.lib;var b=sap.rules.ui.parser.businessLanguage.lib.parseModel.lib;var d=new b.parseModelLib();var u=new sap.rules.ui.parser.businessLanguage.lib.utils.lib();var e=sap.rules.ui.parser.businessLanguage.lib.parserTokens.lib;var v=sap.rules.ui.parser.businessLanguage.lib.vocabularyUtils.lib;var f=new v.vocabularyUtilsLib();function t(){}t.prototype.TermInfo=function(){try{this.init=function(){this.start=null;this.end=null;this.type=e.NAVIGATION;this.key=null;this.term=null;this.expression=null;this.isCalculatedType=false;this.isSet=function(){return this.isCalculatedType;};};this.init();this.setKey=function(){var m=d.getModelManger();this.key=m.expression.substring(this.start,this.end);};this.calculateTermType=function(){var m=d.getModelManger();if(!m.vocaRTServ){return;}this.isCalculatedType=true;this.setKey();var r=m.getCurrentNavigationObject(this.key);if(r===null){r=a.getNavigationObjectFromPath(this.term,this.key,m);}var h=a.getNavigationObjectType(r);if(h!==null){this.type=h;}else{if(m[c.propertiesEnum.unknownTokens].hasOwnProperty(this.key)){m[c.propertiesEnum.unknownTokens][this.key]++;}else{m[c.propertiesEnum.unknownTokens][this.key]=1;}}};}catch(g){jQuery.sap.log.error("TermnInfo failure - \n"+g);}};t.prototype.setTerm=function(){var m=d.getModelManger();var g=m.terms;g[g.length-1].calculateTermType();m.clearCurrentTerm();};t.prototype.createTerm=function(s,g,h){this.getTermMode();var m=d.getModelManger();m.setCurrentTerm(h);var i=new this.TermInfo();i.start=s;i.end=g;i.term=h;m.terms.push(i);};t.prototype.updateTerm=function(g,h){var m=d.getModelManger();m.setCurrentTerm(h);var i=m.terms;i[i.length-1].term=h;i[i.length-1].end=g;};t.prototype.updateTermsTokenType=function(g){var m=d.getModelManger();var h=m.terms;if(u.isEmptyArray(h)){return;}if(!h[h.length-1].isSet()){this.setTerm();a.updateTokenType(h[h.length-1],m);}var i,j=0;for(i=0;i<g.length&&j<h.length;i++){if(g[i].start===h[j].start){g[i].type=h[j].type;g[i].setText(h[j].key);j++;}}m.clearTermsArray();};t.prototype.getTermMode=function(){var g=null;var m=d.getModelManger();var h=null;if(!m[c.propertiesEnum.termMode]&&m.vocaRTServ){h=m.vocaRTServ.getTermModes();if(m.hasOwnProperty(c.propertiesEnum.flags)&&m[c.propertiesEnum.flags].hasOwnProperty(c.propertiesEnum.termMode)){if(m[c.propertiesEnum.flags][c.propertiesEnum.termMode].hasOwnProperty(c.propertiesEnum.convert)&&m[c.propertiesEnum.flags][c.propertiesEnum.termMode][c.propertiesEnum.convert].hasOwnProperty(c.propertiesEnum.source)){g=m[c.propertiesEnum.flags][c.propertiesEnum.termMode][c.propertiesEnum.convert];}}if(g){m[c.propertiesEnum.termMode]=g[c.propertiesEnum.source];}else if(h.indexOf("byDescription")>-1){m[c.propertiesEnum.termMode]=c.DISPLAY_TEXT;}else{m[c.propertiesEnum.termMode]=c.CODE_TEXT;}}if(m[c.propertiesEnum.termMode]){return m[c.propertiesEnum.termMode];}return null;};t.prototype.isTermPrefix=function(g){var m=d.getModelManger();return f.isTermPrefix(g,m.vocaRTServ,m.vocabulary,this.getTermMode());};return{termsUtilsLib:t};}());
