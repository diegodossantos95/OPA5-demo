jQuery.sap.declare("sap.rules.ui.parser.businessLanguage.lib.localeConversion");jQuery.sap.require("sap.rules.ui.parser.infrastructure.locale.lib.moment_JS_min");jQuery.sap.require("sap.rules.ui.parser.businessLanguage.lib.parseUtils");jQuery.sap.require("sap.rules.ui.parser.businessLanguage.lib.constants");jQuery.sap.require("sap.rules.ui.parser.businessLanguage.lib.numberConversion");jQuery.sap.require("sap.rules.ui.parser.infrastructure.errorHandling.hrfException");jQuery.sap.require("sap.rules.ui.parser.businessLanguage.lib.parseUtils");sap.rules.ui.parser.businessLanguage.lib.localeConversion=sap.rules.ui.parser.businessLanguage.lib.localeConversion||{};sap.rules.ui.parser.businessLanguage.lib.localeConversion.lib=(function(){var m=sap.rules.ui.parser.infrastructure.locale.lib.moment_JS_min.lib;var c=sap.rules.ui.parser.businessLanguage.lib.constants.lib;var n=sap.rules.ui.parser.businessLanguage.lib.numberConversion.lib;var h=sap.rules.ui.parser.infrastructure.errorHandling.hrfException.lib;var p=sap.rules.ui.parser.businessLanguage.lib.parseUtils.lib;var a=new p.parseUtilsLib();var H="YYYY-MM-DD";var N=["D/M/YYYY","D-M-YYYY","D.M.YYYY"];var b="HH:mm:ss.SSSSSS";var d=["H:mm:ss","TH:mm:ss"];var e="YYYY-MM-DD HH:mm:ss.SSSSSS";var f=["YYYY-MM-DD HH:mm:ss","D/M/YYYY H:mm:ss","D-M-YYYY H:mm:ss","D.M.YYYY H:mm:ss","D/M/YYYYTH:mm:ss","D-M-YYYYTH:mm:ss","D.M.YYYYTH:mm:ss"];var t={toUTC:"toUTC",toTimeZone:"toTimeZone"};var s={"DD.MM.YYYY":null,"D.M.Y":null,"DD.MM.YY":null,"D.M.YY":null,"D.M.YY.":null,"D.MM.YY":null,"D.MM.Y":null,"D.M.Y.":null,"DD.MM.Y":null,"DD.MM.Y.":null,"DD.MM.YY.":null,"DD. MM. YY":null,"DD.MM.YY Г.":null,"YYYY.MM.DD":null,"YY. M. D.":null,"Y. MM. DD.":null,"Y.MM.DD":null,"Y.MM.DD.":null,"DD-MM-YY":null,"DD-MM-YYYY":null,"MM-DD-YYYY":null,"YYYY-MM-DD":null,"Y-MM-DD":null,"DD-MM-Y":null,"DD/MM/Y":null,"D/M/Y":null,"DD/MM/YY":null,"D/M/YY":null,"MM/DD/YY":null,"M/D/YY":null,"DD/MM/YYYY":null,"MM/DD/YYYY":null,"YYYY/MM/DD":null,"Y/M/D":null,"Y/MM/DD":null,"M/D/Y":null};var g={"hh:mm:ss a":null,"hh:mm:ss A":null,"h:mm:ss a":null,"h:mm:ss A":null,"H:mm:ss":null,"HH:mm:ss":null,"ah:mm:ss":null,"kl. HH:mm:ss":null,"KK:mm:ss A":null,"KK:mm:ss a":null};var i={"123,456,789.00":null,"123.456.789,00":null,"123456789,00":null};var j=function(Q){var R=Q;if(R.charAt(0)==="'"&&R.charAt(R.length-1)==="'"){R=R.slice(1,R.length-1);}return R;};var k=function(Q,R){if(Q===null){return R;}if(R===null){return Q.toUpperCase();}return Q.toUpperCase()+" "+R;};var l=function(Q,R){var S=null;var T=Q;var U=null;var V=T.slice(9);if(R.indexOf("KK")===0){S=T.slice(0,8);if(V==="pm"||V==="PM"){U=S.split(":");U[0]=parseInt(U[0],10)+12;S=U.join(":");}}return S;};var o=function(Q,R){var U=null;var S=Q;var T=null;var V=null;var W=null;T=S.split(":");V=parseInt(T[0],10);if(V>11){V-=12;W=R.endsWith("A")?"PM":"pm";}else{W=R.endsWith("A")?"AM":"am";}T[0]=V;U=T.join(":");U=U+" "+W;return U;};var q=function(Q,R,S){var T={str:Q,dateFormat:R,timeFormat:S};if(S){var U=S.indexOf('z');if(U>=0){T.timeFormat=S.substring(0,U-1);}}if(T.dateFormat&&((T.str.indexOf("г")>=0&&T.dateFormat.indexOf("г")>=0)||(T.str.indexOf("Ð³")>=0&&T.dateFormat.indexOf("Ð³")>=0))){var V=T.str.indexOf("г");var W=T.dateFormat.indexOf("г");if(V<0){V=T.str.indexOf("Ð");W=T.dateFormat.indexOf("Ð");}T.str=T.str.slice(0,V-1)+(T.timeFormat!==null?T.str.slice(V+2):'');T.dateFormat=T.dateFormat.slice(0,W-1);}if(T.timeFormat&&(T.str.indexOf("下午")>=0||T.str.indexOf("上午")>=0)&&T.timeFormat.indexOf("a")===0){if(T.str.indexOf("下午")>=0){T.str=T.str.replace("下午",'')+" pm";}else{T.str=T.str.replace("上午",'')+" am";}T.timeFormat=T.timeFormat.replace("a","")+" a";}if(T.timeFormat&&T.str.indexOf("kl. ")>=0&&T.timeFormat.indexOf("kl. ")===0){T.str=T.str.replace("kl. ",'');T.timeFormat=T.timeFormat.replace("kl. ","");}if(S&&S.indexOf("KK")===0&&(Q.toLowerCase().indexOf("pm")!==-1||Q.toLowerCase().indexOf("am")!==-1)){T.str=l(Q,S);T.timeFormat="HH:mm:ss";}return T;};var r=function(Q,R,S){var T=j(Q);var U=null;var V='';var W=q(T,R,S);V=k(W.dateFormat,W.timeFormat);U=m.moment(W.str,V,true);return U;};var u=function(Q,R){var S=null;var T=j(Q);if(R&&R.length>0){S=m.moment(T,R,true);}return S;};var v=function(Q,R,S){var T=null;var U=j(Q);T=m.moment(U,R,true);if(!T.isValid()){T=u(Q,S);}return T;};var w=function(Q,R,S){var T={};T.key="error_in_expression_unsupported_locale_settings";T.args=[Q,R];a.handleError(T.key,T.args,S);throw new h.HrfException();};var x=function(Q){function R(T){if(!T.hasOwnProperty(c.propertiesEnum.number)){w('Number format',null,Q);}if(!T.number.hasOwnProperty(c.propertiesEnum.groupSeparator)){w('Group separator',null,Q);}if(!T.number.hasOwnProperty(c.propertiesEnum.decimalSeparator)){w('Decimal separator',null,Q);}var X=T[c.propertiesEnum.number][c.propertiesEnum.groupSeparator];X=(X===' ')?'':X;var Y=T[c.propertiesEnum.number][c.propertiesEnum.decimalSeparator];var Z="123"+X+"456"+X+"789"+Y+"00";if(!i.hasOwnProperty(Z)){w('Number format',Z,Q);}}var S=Q.flags;if(!S.locale.hasOwnProperty(c.propertiesEnum.localeSettings)||!S.locale.localeSettings){w('Date format',null,Q);}var T=S.locale.localeSettings;if(!T.hasOwnProperty(c.propertiesEnum.dateFormat)||!T.dateFormat){w('Date format',null,Q);}var U=T.dateFormat;if(!s.hasOwnProperty(U.toUpperCase())){w('Date format',U,Q);}if(!T.hasOwnProperty(c.propertiesEnum.timeFormat)||!T.timeFormat){w('Time format',null,Q);}var V=T.timeFormat;var W=V.indexOf('z');if(W>=0){V=V.substring(0,W-1);}if(!g.hasOwnProperty(V)){w('Time format',T.timeFormat,Q);}R(T);};var y=function(Q){var R=Q.flags;if(!R||!R.hasOwnProperty(c.propertiesEnum.locale)){return false;}x(Q);return true;};var z=function(Q){var R=Q.flags;var S={};S.isLocaleExists=y(Q);S.isCodeText=S.isLocaleExists&&R.locale.hasOwnProperty(c.propertiesEnum.convert)&&R.locale.convert.hasOwnProperty(c.propertiesEnum.target)&&R.locale.convert.target===c.DISPLAY_TEXT;return S;};var A=function(Q){return Q.isLocaleExists&&!Q.isCodeText;};var B=function(Q){return!Q.isLocaleExists||Q.isCodeText;};var C=function(Q,R){switch(R){case t.toUTC:return(-1)*Number(Q);default:return Number(Q);}};var D=function(Q,R,S){if(!Q.isValid()||!R||!S){return;}var T=C(R,S);Q.add(T,'Minutes');};var E=function(Q,R){var S=null;var T='';var U=false;var V=R.flags;var W=z(R);if(A(W)){T=V.locale.localeSettings.dateFormat.replace('z','');S=r(Q,T,null);}if(B(W)&&(!S||!S.isValid())){S=v(Q,H,N);}if(S){U=S.isValid();}return U;};var F=function(Q,R){var S=null;var T='';var U='';var V=false;var W=R.flags;var X=z(R);if(A(X)){T=W.locale.localeSettings.dateFormat.replace('z','');U=W.locale.localeSettings.timeFormat;S=r(Q,T,U);}if(B(X)&&(!S||!S.isValid())){S=v(Q,e,f);}if(S){V=S.isValid();}return V;};var G=function(Q,R){var S=null;var T='';var U=false;var V=R.flags;var W=z(R);if(A(W)){T=V.locale.localeSettings.timeFormat;S=r(Q,null,T);}if(B(W)&&(!S||!S.isValid())){S=v(Q,b,d);}if(S){U=S.isValid();}return U;};var I=function(Q,R){var S=R;var T='';var U='';if(R&&(R.indexOf("г")>=0||R.indexOf("Ð³")>=0)){var V=R.indexOf("г");if(V<0){V=R.indexOf("Ð");}T=R.substr(V-1,3);S=R.slice(0,V-1);}U=Q.format(S.toUpperCase())+T;return U;};var J=function(Q,R){var S=R;var T='';var U='';var V=null;if(R.indexOf("KK")===0){V=Q.format("HH:mm:ss");U=o(V,R);}else{if(R.indexOf("a")===0){T=Q.hour()>=12?'下午':'上午';S=S.replace("a","");}if(R.indexOf("kl. ")===0){T="kl. ";S=S.replace("kl. ","");}U=T+Q.format(S);}return U;};var K=function(Q,R,S,T,U,V,W,X,Y){var Z=null;var $='';var _='';Z=r(Q,R,S);if(!Z.isValid()&&W){Z=v(Q,V,W);}if(Z.isValid()){D(Z,X,Y);if(T){$=I(Z,T);}if(U){var a1=U;var b1=a1.indexOf('z');if(b1>=0){a1=a1.substring(0,b1-1);}_=J(Z,a1);$+=(T?" ":"")+_;}}return $;};var L=function(Q){return(Q.locale.hasOwnProperty(c.propertiesEnum.convert)&&Q.locale.convert.hasOwnProperty(c.propertiesEnum.source)&&Q.locale.convert.source===c.CODE_TEXT&&Q.locale.convert.hasOwnProperty(c.propertiesEnum.target)&&Q.locale.convert.target===c.DISPLAY_TEXT);};var M=function(Q){return(Q.locale.hasOwnProperty(c.propertiesEnum.convert)&&Q.locale.convert.hasOwnProperty(c.propertiesEnum.source)&&Q.locale.convert.source===c.DISPLAY_TEXT&&Q.locale.convert.hasOwnProperty(c.propertiesEnum.target)&&Q.locale.convert.target===c.CODE_TEXT);};var O=function(Q,R,S){var T='';var U='';var V=null;var W=null;var X=0;var Y=R.flags;var Z=z(R);if(A(Z)){T=Y.locale.localeSettings.dateFormat.replace('z','');U=Y.locale.localeSettings.timeFormat;if(Y.locale.localeSettings.timeZoneOffset){X=Y.locale.localeSettings.timeZoneOffset;}}switch(S){case c.TYPE_DATE:if(T!==''){W=K(Q,T,null,H,null,H,N,null,null);}else{V=v(Q,H,N);if(V.isValid){W=V.format(H);}}break;case c.TYPE_TIME:if(U!==''){W=K(Q,null,U,null,b,b,d,X,t.toUTC);}else{V=v(Q,b,d);if(V.isValid){W=V.format(b);}}break;case c.TYPE_TIMESTAMP:if(T!==''&&U!==''){W=K(Q,T,U,H,b,e,f,X,t.toUTC);}else{V=v(Q,e,f);if(V.isValid){W=V.format(e);}}break;case c.TYPE_NUMERIC:W=n.convertNumber(Q,Y);break;}if(S!==c.TYPE_NUMERIC){W=(W&&W.indexOf("'")!==0)?"'"+W+"'":W;}return W;};var P=function(Q,R,S){var T=R.flags;var U='';var V='';var W=0;var X='';var Y=null;if(y(R)){U=T.locale.localeSettings.dateFormat.replace('z','');V=T.locale.localeSettings.timeFormat;if(T.locale.localeSettings.timeZoneOffset){W=T.locale.localeSettings.timeZoneOffset;}if(T.locale.hasOwnProperty(c.propertiesEnum.convert)&&T.locale.convert.hasOwnProperty(c.propertiesEnum.target)){X=T.locale.convert.target;}}if(X===c.CODE_TEXT){Y=O(Q,R,S);}else if(X===c.DISPLAY_TEXT){switch(S){case c.TYPE_DATE:Y=K(Q,H,null,U,null,H,N,null,null);break;case c.TYPE_TIME:Y=K(Q,null,b,null,V,b,d,W,t.toTimeZone);break;case c.TYPE_TIMESTAMP:Y=K(Q,H,b,U,V,e,f,W,t.toTimeZone);break;case c.TYPE_NUMERIC:Y=n.convertNumber(Q,T);break;}}if(S!==c.TYPE_NUMERIC){Y=(Y&&Y.indexOf("'")!==0)?"'"+Y+"'":Y;}return Y;};return{"isLocaleExistsInFlags":y,"isLocaleConversionFromCodeText":L,"isLocaleConversionFromDisplayText":M,"isDateStr":E,"isTimestampStr":F,"isTimeStr":G,"convertToHanaLocaleFormat":O,"convertLocaleFormat":P};}());
