jQuery.sap.declare("sap.rules.ui.parser.businessLanguage.lib.autoCompleteUtils");jQuery.sap.require("sap.rules.ui.parser.businessLanguage.lib.parseModel");jQuery.sap.require("sap.rules.ui.parser.businessLanguage.lib.constants");jQuery.sap.require("sap.rules.ui.parser.businessLanguage.lib.parseUtils");jQuery.sap.require("sap.rules.ui.parser.businessLanguage.lib.vocabularyUtils");jQuery.sap.require("sap.rules.ui.parser.businessLanguage.lib.parserTokens");jQuery.sap.require("sap.rules.ui.parser.businessLanguage.lib.utils");jQuery.sap.require("sap.rules.ui.parser.businessLanguage.lib.antlr3_all_min");jQuery.sap.require("sap.rules.ui.parser.infrastructure.errorHandling.hrfException");sap.rules.ui.parser.businessLanguage.lib.autoCompleteUtils=sap.rules.ui.parser.businessLanguage.lib.autoCompleteUtils||{};sap.rules.ui.parser.businessLanguage.lib.autoCompleteUtils.lib=(function(){var p=sap.rules.ui.parser.businessLanguage.lib.parseUtils.lib;var c=new p.parseUtilsLib();var d=sap.rules.ui.parser.businessLanguage.lib.constants.lib;var v=sap.rules.ui.parser.businessLanguage.lib.vocabularyUtils.lib;var e=new v.vocabularyUtilsLib();var f=sap.rules.ui.parser.businessLanguage.lib.parserTokens.lib;var g=sap.rules.ui.parser.businessLanguage.lib.parseModel.lib;var h=new g.parseModelLib();var u=new sap.rules.ui.parser.businessLanguage.lib.utils.lib();var o=sap.rules.ui.parser.businessLanguage.lib.antlr3_all_min.lib;var j=sap.rules.ui.parser.infrastructure.errorHandling.hrfException.lib;function k(){}k.prototype.overwriteParserReportError=function(a,b){a.reportError=function(A){function s(){h.getModelManger().setDFAFailed(true);b.contextInfo.valueListAttribute=h.getModelManger().getValueListAttribute();b.contextInfo.isDeprecatedAllContext=h.getModelManger().isAllContext();b.contextInfo.isTermAllContext=h.getModelManger().isTermAllContext();}function i(){h.getModelManger().cleanValueListAttribute();a.isInsideWhere=((a.isInsideWhere!==undefined&&a.isInsideWhere===true)?true:h.getModelManger().isInsideWhere);a.disableAliases=((a.disableAliases!==undefined&&a.disableAliases===true)?true:h.getModelManger().disableAliases);var n=h.getModelManger().contextQueue.length;if(n>0){var q=h.getModelManger().contextQueue[n-1];var r=q.associations.path.length;var t=(r>0)?q.associations.path[r-1].object:q.root.name;a.context=q.root.isAlias?null:t;a.fullContext=q;a.contextWasFound=true;}else{if(a.hasOwnProperty("contextWasFound")===false||a.contextWasFound===false){a.context=null;a.fullContext=null;a.isInsideWhere=null;}}}function l(){if(!a.lexerErrorOccurred){b.lastText=A.input.tokenSource.input.data;if(!(A.input.tokens.length===undefined||A.input.tokens.length===0)){var n=A.input.tokens.length-1;var q=A.input.tokens[A.input.tokens.length-1].stop+1;var r=A.input.tokens[A.input.tokens.length-1].start;for(n;n>=0;n--){if(A.input.tokens[n].channel!==o.antlr.runtime.Token.HIDDEN_CHANNEL&&A.input.tokens[n].type===f.NAVIGATION){r=A.input.tokens[n].start;break;}}b.lastText=b.lastText.substring(r,q);}}}function m(){if(A instanceof o.antlr.runtime.NoViableAltException||(A instanceof o.antlr.runtime.RecognitionException&&!(A instanceof o.antlr.runtime.UnwantedTokenException))){if(u.isInArray(A.decisionNumber,a.DFA_decisions)){c.handleFailedDFA(a,A,b);}}else if(A instanceof o.antlr.runtime.MismatchedTokenException){if(A instanceof o.antlr.runtime.UnwantedTokenException){b.isPartialText=b.isPartialText||c.isLastTokenPartialText(a);}}}s();i();l();m();throw new j.HrfException();};};k.prototype.overwriteLexerReportError=function(l,a,b){l.reportError=function(A){if(a.lexerErrorOccurred===false){a.lexerErrorOccurred=true;a.lexerErrorStartIndex=A.input.markers[1].charPositionInLine;if(A instanceof o.antlr.runtime.NoViableAltException){var i=A.input.data;b.lastText=i.substring(A.input.p,A.input.n);b.isPartialText=true;}if((A instanceof o.antlr.runtime.MismatchedTokenException||A instanceof o.antlr.runtime.MismatchedSetException||A instanceof o.antlr.runtime.EarlyExitException)&&A.c===-1){var m=a.input.tokens.length;if(m>0){var s=a.input.tokens[m-1].stop+1;var n=A.input.data;b.lastText=n.substring(s,A.input.n);}else{b.lastText=A.input.data;}b.isPartialText=true;}else if(A.c===" "){throw new j.HrfException();}}};};k.prototype.insertTermsAlternatives=function(a,n,b,l){var m="";var i;var q;for(i=0;i<a.length;i++){q=(n===null)?a[i]:a[i].substring(n.length);m=m+l+'{"text":"'+a[i]+'", "completion":"'+b+q+'", "tokenType":"'+d.tokenTypesEnum.vocabulary+'"';m=m+'}';l=',';}return m;};k.prototype.insertOMAlternatives=function(l,m,n,q,r,t){var s="";var i;m.sort(function(a,b){if(a.name>b.name){return 1;}if(a.name<b.name){return-1;}return 0;});var w,x;var y=JSON.stringify(n);y=y.substring(1,y.length-1);var z;var A=null;for(i=0;i<m.length;i++){if(m[i].tokenType==='vocabulary'&&t==='displayText'){A=m[i].description;}else{A=m[i].name;}z=JSON.stringify(A);z=z.substring(1,z.length-1);w=(y===null)?z:z.substring(y.length);if(this.navigationCompletionInfo.isValueListSuggestions){if(l.getValueListType(h.getModelManger().vocabulary,z)==='External'){z=w="<Value Help>";q="";}}x=(m[i].info)?JSON.stringify(m[i].info):null;s=s+r+'{"text":"'+z+'", "completion":"'+q+w+'", "tokenType":"'+m[i].tokenType+'"';if(x){s=s+','+'"info":'+x;}s=s+'}';r=',';}return s;};k.prototype.completeByValueListInLexerError=function(a,b){var i="";if(b.lexerErrorOccurred){var l=e.getAltValueListForValueListAttr(h.getModelManger().vocabulary,a,this.parsingOutputInfo.contextInfo.valueListAttribute,this.parsingOutputInfo.lastText);if(l.length>0){this.startSuggestionList();var m="";i+=this.insertOMAlternatives(a,l,this.parsingOutputInfo.lastText,"",m,null);this.navigationCompletionInfo.isValueListSuggestions=true;this.strSuggestions+=i;return true;}}return false;};k.prototype.filterTypes=function filterTypes(l,t,a){var b=[];if(l===f.COUNT_OF||l===f.NUMBER_OF){b[0]=a[f.TYPECOLLECTION].toLowerCase();}else{b=t;}return b;};k.prototype.convertNavigationRELTypesToBusinessTypes=function(a){var i;var b;var l;var t=a.getTokenNames();var m=u.removeDuplicate(this.parsingOutputInfo.allowedTypes);var n=c.getLastTokenTypeAndIgnoreWS(a);m=this.filterTypes(n,m,t);for(i=0;i<m.length;i++){b={};l={};switch(m[i]){case t[f.TYPENUMBER].toLowerCase():b.isCollection=false;b.isDTAlias=false;b.type=d.SIMPLE_SELECTION_VALUE_TYPE.INTEGER.string;break;case t[f.TYPEBOOLEAN].toLowerCase():b.isCollection=false;b.isDTAlias=false;b.type=d.SIMPLE_SELECTION_VALUE_TYPE.BOOLEAN.string;break;case t[f.TYPESTRING].toLowerCase():b.isCollection=false;b.isDTAlias=false;b.type=d.SIMPLE_SELECTION_VALUE_TYPE.STRING.string;break;case t[f.TYPEDATE].toLowerCase():b.isCollection=false;b.isDTAlias=false;b.type=d.SIMPLE_SELECTION_VALUE_TYPE.DATE.string;break;case t[f.TYPETIME].toLowerCase():b.isCollection=false;b.isDTAlias=false;b.type=d.SIMPLE_SELECTION_VALUE_TYPE.TIME.string;break;case t[f.TYPETIMESTAMP].toLowerCase():b.isCollection=false;b.isDTAlias=false;b.type=d.SIMPLE_SELECTION_VALUE_TYPE.TIMESTAMP.string;break;case t[f.TYPETIMEINTERVAL].toLowerCase():b.isCollection=false;b.isDTAlias=false;b.type=d.SIMPLE_SELECTION_VALUE_TYPE.TIMESPAN.string;break;case t[f.TYPENUMBERCOLLECTION].toLowerCase():b.isCollection=true;b.isDTAlias=false;b.type=d.SIMPLE_SELECTION_VALUE_TYPE.INTEGER.string;break;case t[f.TYPEBOOLEANCOLLECTION].toLowerCase():b.isCollection=true;b.isDTAlias=false;b.type=d.SIMPLE_SELECTION_VALUE_TYPE.BOOLEAN.string;break;case t[f.TYPESTRINGCOLLECTION].toLowerCase():b.isCollection=true;b.isDTAlias=false;b.type=d.SIMPLE_SELECTION_VALUE_TYPE.STRING.string;break;case t[f.TYPEDATECOLLECTION].toLowerCase():b.isCollection=true;b.isDTAlias=false;b.type=d.SIMPLE_SELECTION_VALUE_TYPE.DATE.string;break;case t[f.TYPETIMECOLLECTION].toLowerCase():b.isCollection=true;b.isDTAlias=false;b.type=d.SIMPLE_SELECTION_VALUE_TYPE.TIME.string;break;case t[f.TYPETIMESTAMPCOLLECTION].toLowerCase():b.isCollection=true;b.isDTAlias=false;b.type=d.SIMPLE_SELECTION_VALUE_TYPE.TIMESTAMP.string;break;case t[f.TYPETIMEINTERVALCOLLECTION].toLowerCase():b.isCollection=true;b.isDTAlias=false;b.type=d.SIMPLE_SELECTION_VALUE_TYPE.TIMESPAN.string;break;case t[f.TYPENUMBERDT].toLowerCase():b.isCollection=true;b.isDTAlias=true;b.type=d.SIMPLE_SELECTION_VALUE_TYPE.INTEGER.string;break;case t[f.TYPEBOOLEANDT].toLowerCase():b.isCollection=true;b.isDTAlias=true;b.type=d.SIMPLE_SELECTION_VALUE_TYPE.BOOLEAN.string;break;case t[f.TYPESTRINGDT].toLowerCase():b.isCollection=true;b.isDTAlias=true;b.type=d.SIMPLE_SELECTION_VALUE_TYPE.STRING.string;break;case t[f.TYPEDATEDT].toLowerCase():b.isCollection=true;b.isDTAlias=true;b.type=d.SIMPLE_SELECTION_VALUE_TYPE.DATE.string;break;case t[f.TYPETIMEDT].toLowerCase():b.isCollection=true;b.isDTAlias=true;b.type=d.SIMPLE_SELECTION_VALUE_TYPE.TIME.string;break;case t[f.TYPETIMESTAMPDT].toLowerCase():b.isCollection=true;b.isDTAlias=true;b.type=d.SIMPLE_SELECTION_VALUE_TYPE.TIMESTAMP.string;break;case t[f.TYPETIMEINTERVALDT].toLowerCase():b.isCollection=true;b.isDTAlias=true;b.type=d.SIMPLE_SELECTION_VALUE_TYPE.TIMESPAN.string;break;case t[f.TYPECOLLECTION].toLowerCase():b.isCollection=true;b.isDTAlias=false;b.type=null;break;default:continue;}l=JSON.parse(JSON.stringify(b));if(l.isCollection!==true){l.isCollection=true;this.navigationCompletionInfo.collectionBusinessTypes.push(b);}else{this.navigationCompletionInfo.completeCollection=true;}this.navigationCompletionInfo.collectionBusinessTypes.push(l);this.navigationCompletionInfo.simpleBusinessTypes.push(b);}};k.prototype.calcSpacePrefixAdditionForNonNavigation=function(a){if(!this.isPartialCompletion()&&!u.isEmptyArray(a.input.tokens)&&a.input.tokens[a.input.tokens.length-1].type!==f.WS){return" ";}return"";};k.prototype.calcSpacePrefixAdditionForNavigation=function(a){if(!this.isPartialCompletion()&&!u.isEmptyArray(a.input.tokens)&&a.input.tokens[a.input.tokens.length-1].type!==f.WS&&a.input.tokens[a.input.tokens.length-1].type!==f.NAVIGATION&&a.input.tokens[a.input.tokens.length-1].type!==f.ALL){return" ";}return"";};k.prototype.calculateNavigationStartText=function(){if(this.isPartialCompletion()){this.navigationCompletionInfo.navigationTextInput=this.parsingOutputInfo.lastText;}else{this.navigationCompletionInfo.navigationTextInput="";}};k.prototype.isPartialCompletion=function(){return this.parsingOutputInfo.isPartialText;};k.prototype.handleEmptyNextTokens=function(a){if(u.isEmptyArray(this.parsingOutputInfo.nextTokens)){if(this.isPartialCompletion()&&a.lexerErrorOccurred){this.parsingOutputInfo.nextTokens=a.getTokenNames();this.parsingOutputInfo.allTokens=true;}}};k.prototype.disableToken=function(a,b,t,i,m){var l=false;var n=c.getTokensDisplayMap(m);l=((t===n.DOT&&c.endsWith(this.parsingOutputInfo.lastText.toLowerCase(),' '))||(t===n.COUNT_OF)||(t===n.MAXIMUM_OF)||(t===n.MINIMUM_OF)||(t===n.FIRST)||(t===n.LAST)||(i===f.CURRENT&&!b.isInsideWhere)||(t===n.EQ_SIGN)||(t===n.NOT_EQUAL_SIGN)||(t===n.GREATER_EQUAL_SIGN)||(t===n.LESS_EQUAL_SIGN)||(t===n.GREATER_SIGN)||(t===n.LESS_SIGN)||(t===n.EQUALS)||(t===n.DOES_NOT_EQUAL)||(t===n.NOT_EQUAL)||(t===n.ZERO_OR_ONE)||(i===f.CURRENT&&this.parsingOutputInfo.contextInfo.isDeprecatedAllContext===false&&!this.parsingOutputInfo.contextInfo.isTermAllContext)||(i===f.ALL_OF_OBJ)||(i===f.ALL&&!a.isTermModifierEmpty(h.getModelManger().vocabulary))||(i===f.OF&&!a.isTermModifierEmpty(h.getModelManger().vocabulary))||(i===f.CURRENT&&!a.isCurrentTermModifierEmpty(h.getModelManger().vocabulary)));return l;};k.prototype.disableAdvancedFunctions=function(a,t){var b=a.getAdvancedFunctions(h.getModelManger().vocabulary);if(!c.advancedFunctions.hasOwnProperty(t)){return false;}var i;for(i=0;i<b.advancedFunctions.length;i++){if(b.advancedFunctions[i].name===c.advancedFunctions[t]){return false;}}return true;};k.prototype.disableGreaterOrLessThenOps=function(t,a){if(t===f.IS_EQUAL_OR_GREATER_THAN||t===f.IS_GREATER_THAN||t===f.GREATER_THAN||t===f.IS_EQUAL_OR_LESS_THAN||t===f.IS_LESS_THAN||t===f.LESS_THAN){var l=c.getLastTokenTypeAndIgnoreWS(a);if(l===f.TYPETIME||l===f.TYPEDATE||l===f.TYPETIMESTAMP){return true;}}return false;};k.prototype.disableDateTimeFormatsForString=function(t,n,m){var a=false;var b=c.getTokensDisplayMap(m);if(u.isInArray(f.TYPESTRING.toString(),n)&&!((u.isInArray(f.TYPETIMESTAMP.toString(),n))||(u.isInArray(f.TYPEDATE.toString(),n))||(u.isInArray(f.TYPETIME.toString(),n)))){a=((t===b.DATESTRING)||(t===b.TIMESTAMPSTRING)||(t===b.TIMESTRING));}return a;};k.prototype.getTokenName=function(t,a){var b=a.getTokenNames();var m=a.parseModelLib.getModelManger();var i=c.getTokensDisplayMap(m);var l=b[t];if(i.hasOwnProperty(l)){l=i[l];}if((l===i.DATESTRING)||(l===i.TIMESTAMPSTRING)||(l===i.TIMESTRING)){return l;}return l.toLowerCase();};k.prototype.disableNumericFragements=function(t,n,m){var a=false;var b=c.getTokensDisplayMap(m);if(u.isInArray(f.ZERO_TO_ONE.toString(),n)&&((u.isInArray(f.INT.toString(),n))||(u.isInArray(f.DECIMAL.toString(),n)))){a=((t===b.ZERO_TO_ONE));}return a;};k.prototype.isValidTokenToSuggest=function(t,a,i){var n=!t||t==='<eor>'||i||(this.isPartialCompletion()&&(a!==this.parsingOutputInfo.lastText.toLowerCase()))||(t.indexOf("parameter")!==-1);return!n;};k.prototype.checkNavigationToken=function(t){var i=false;if((t.lastIndexOf("type",0)===0&&t.indexOf("parameter",0)<0)||t==="navigation"){i=true;this.parsingOutputInfo.navigationCompleteion=true;if(t!=="navigation"){this.parsingOutputInfo.allowedTypes.push(t);}}return i;};k.prototype.filterTokens=function(i,l){var s=[];var t='<eor>';var m=-1;var n=0;var q="";var r=false;var w={};var x=l.parseModelLib.getModelManger();this.parsingOutputInfo.nextTokens=u.removeDuplicate(this.parsingOutputInfo.nextTokens);for(n=0;n<this.parsingOutputInfo.nextTokens.length;n++){r=false;t='<eor>';m=(this.parsingOutputInfo.allTokens?n:parseInt(this.parsingOutputInfo.nextTokens[n],10));if(m>0){t=this.getTokenName(m,l);}q=t.substring(0,this.parsingOutputInfo.lastText.length);if(this.disableToken(i,l,t,m,x)){continue;}if(this.disableAdvancedFunctions(i,t)){continue;}if(this.disableDateTimeFormatsForString(t,this.parsingOutputInfo.nextTokens,x)){continue;}if(this.disableNumericFragements(t,this.parsingOutputInfo.nextTokens,x)){continue;}if(this.disableGreaterOrLessThenOps(m,l)){continue;}r=this.checkNavigationToken(t);if(this.isValidTokenToSuggest(t,q,r)){w={};w.type=m;w.name=t;s.push(w);}}s=u.removeDupplicateByName(s);s.sort(function(a,b){if(a>b){return 1;}if(a<b){return-1;}return 0;});return s;};k.prototype.handleWhitespaceCharsInLastText=function(){if(c.isEmptyString(this.parsingOutputInfo.lastText)){this.parsingOutputInfo.lastText='';}this.parsingOutputInfo.lastText=this.parsingOutputInfo.lastText.replace(/\s+/g,' ');};k.prototype.startSuggestionList=function(){this.strSuggestions="[";};k.prototype.closeSuggestionList=function(){if(this.strSuggestions.charAt(this.strSuggestions.length-1)===","){this.strSuggestions=this.strSuggestions.slice(0,this.strSuggestions.length-1);}this.strSuggestions=this.strSuggestions+"]";this.strSuggestions=this.strSuggestions.replace(/\\/g,"\\\\");};k.prototype.prepareContextSuggestionsInsideWhere_dotMode=function(a,l,t,b){if(this.navigationCompletionInfo.navigationTextInput.indexOf('.')!==-1&&this.parsingOutputInfo.contextInfo.contextNavigation!==null&&this.navigationCompletionInfo.completeCollection===false&&l!==f.CURRENT){var s=this.navigationCompletionInfo.navigationTextInput.substring(0,this.navigationCompletionInfo.navigationTextInput.lastIndexOf('.'));if(this.parsingOutputInfo.contextInfo.contextNavigation.navigation.indexOf(s)===0){if(t.length>2){var i=e.validateNavigationDetails(this.navigationCompletionInfo.navigationTextInput,a,h.getModelManger().vocabulary,this.navigationCompletionInfo.collectionBusinessTypes,this.parsingOutputInfo.contextInfo.valueListAttribute);if(i.isValid===false&&i.attribute.altAttr.length>0){this.navigationCompletionInfo.navSuggestions+=this.insertOMAlternatives(a,i.attribute.altAttr,i.attribute.name,b,this.navigationCompletionInfo.commaDelimiter,null);this.navigationCompletionInfo.commaDelimiter=",";}}var n=this.parsingOutputInfo.contextInfo.contextNavigation.navigation.substring(0,this.parsingOutputInfo.contextInfo.contextNavigation.navigation.lastIndexOf('.'));if(s!==n&&n.indexOf(this.navigationCompletionInfo.navigationTextInput)===0){var m=n.replace(this.navigationCompletionInfo.navigationTextInput,'');var q=m.split(".");this.navigationCompletionInfo.navSuggestions=this.navigationCompletionInfo.navSuggestions+this.navigationCompletionInfo.commaDelimiter+'{"text":"'+b+t[t.length-1]+q[0]+'", "completion":"'+b+q[0]+'"}';this.navigationCompletionInfo.commaDelimiter=",";}}}};k.prototype.prepareContextAttrsSuggestionsInsideWhere=function(a,l){var t=h.getModelManger().termMode;if(this.parsingOutputInfo.contextInfo.contextDO!==null&&!c.endsWith(this.navigationCompletionInfo.navigationTextInput,".")&&(this.navigationCompletionInfo.completeCollection===false&&l!==f.CURRENT)){var b=this.parsingOutputInfo.contextInfo.contextDO+"."+this.navigationCompletionInfo.navigationTextInput;var i=e.validateNavigationDetails(b,a,h.getModelManger().vocabulary,this.navigationCompletionInfo.simpleBusinessTypes,this.parsingOutputInfo.contextInfo.valueListAttribute,t);if(i.isValid===false&&i.associations.isValid===false&&i.attribute.altAttr.length>0){this.navigationCompletionInfo.navAlternatives=i.attribute.altAttr;}}};k.prototype.prepareContextCompletion=function(a,l,t,b){this.prepareContextSuggestionsInsideWhere_dotMode(a,l,t,b);this.prepareContextAttrsSuggestionsInsideWhere(a,l,b);};k.prototype.completeNavSuggestions_dotMode=function(a,b,i){var n=null;n=e.validateNavigationDetails(this.navigationCompletionInfo.navigationTextInput,a,h.getModelManger().vocabulary,this.navigationCompletionInfo.simpleBusinessTypes,this.parsingOutputInfo.contextInfo.valueListAttribute);if(n.isValid===false){if(n.root.isValid===false){if(this.parsingOutputInfo.contextInfo.valueListAttribute){this.navigationCompletionInfo.isValueListSuggestions=true;this.navigationCompletionInfo.navSuggestions="";this.navigationCompletionInfo.navAlternatives=[];this.navigationCompletionInfo.navAlternatives=this.navigationCompletionInfo.navAlternatives.concat(n.root.altValueList);}else{this.navigationCompletionInfo.navAlternatives=this.navigationCompletionInfo.navAlternatives.concat(n.root.altDO);if(b.disableAliases===false){this.navigationCompletionInfo.navAlternatives=this.navigationCompletionInfo.navAlternatives.concat(n.root.altAlias);}}this.navigationCompletionInfo.navSuggestions+=this.insertOMAlternatives(a,this.navigationCompletionInfo.navAlternatives,n.root.name,i,this.navigationCompletionInfo.commaDelimiter,null);this.navigationCompletionInfo.navAlternatives=[];}else{this.navigationCompletionInfo.navAlternatives=this.navigationCompletionInfo.navAlternatives.concat(n.attribute.altAssoc);this.navigationCompletionInfo.navSuggestions+=this.insertOMAlternatives(a,n.attribute.altAttr.concat(this.navigationCompletionInfo.navAlternatives),n.attribute.name,i,this.navigationCompletionInfo.commaDelimiter,null);this.navigationCompletionInfo.navAlternatives=[];}}};k.prototype.completeNavSuggestions_termsMode=function(a,b,i,l){var w=null;if(this.parsingOutputInfo.contextInfo.contextNavigation!==null){var m=this.parsingOutputInfo.contextInfo.contextNavigation.navigation.split(".");if(this.parsingOutputInfo.contextInfo.contextNavigation.attribute.isValid){m.pop();}w=(m.length===0)?this.parsingOutputInfo.contextInfo.contextNavigation.navigation:m.join(".");}var n=(l===f.CURRENT)?true:false;if(n&&w){var q=w.split(".");w=(q.length>0?q[0]:w);}else if((l===f.ALL)){w=null;}var t=h.getModelManger().termMode;var r=null;var s=false;if(h.getModelManger().flags.hasOwnProperty(d.propertiesEnum.noAssocSuggestion)){s=h.getModelManger().flags[d.propertiesEnum.noAssocSuggestion];}r=e.getNavigationCompletion(this.navigationCompletionInfo.navigationTextInput,a,h.getModelManger().vocabulary,this.navigationCompletionInfo.simpleBusinessTypes,this.parsingOutputInfo.contextInfo.valueListAttribute,w,n,this.navigationCompletionInfo.completeCollection,this.parsingOutputInfo.contextInfo.isDeprecatedAllContext,b.isInsideWhere,this.parsingOutputInfo.contextInfo.isTermAllContext,t,s);if(r.altValueList.length>0){this.navigationCompletionInfo.isValueListSuggestions=true;this.navigationCompletionInfo.navSuggestions="";this.navigationCompletionInfo.navAlternatives=r.altValueList;}else{if(b.disableAliases===false&&r.altAlias.length>0){this.navigationCompletionInfo.navAlternatives=this.navigationCompletionInfo.navAlternatives.concat(r.altAlias);}if(r.altDO.length>0){this.navigationCompletionInfo.navSuggestions+=this.insertTermsAlternatives(r.altDO,this.navigationCompletionInfo.navigationTextInput,i,this.navigationCompletionInfo.commaDelimiter);this.navigationCompletionInfo.commaDelimiter=",";}}if(this.navigationCompletionInfo.navAlternatives.length>0){this.navigationCompletionInfo.navSuggestions+=this.insertOMAlternatives(a,this.navigationCompletionInfo.navAlternatives,this.navigationCompletionInfo.navigationTextInput,i,this.navigationCompletionInfo.commaDelimiter,t);this.navigationCompletionInfo.navAlternatives=[];}};k.prototype.isDotMode=function(a){return(this.navigationCompletionInfo.navigationTextInput.indexOf('.')!==-1||!e.isTermsExists(a,h.getModelManger().vocabulary)||(h.getModelManger().flags.hasOwnProperty(d.propertiesEnum.disableTerms)&&h.getModelManger().flags[d.propertiesEnum.disableTerms]));};k.prototype.isTermMode=function(a){return(e.isTermsExists(a,h.getModelManger().vocabulary)&&(!h.getModelManger().flags.hasOwnProperty(d.propertiesEnum.disableTerms)||!h.getModelManger().flags[d.propertiesEnum.disableTerms]));};k.prototype.addNavigationSuggestions=function(a,b){var i="";this.initNavigationInfo();if(this.parsingOutputInfo.navigationCompleteion){if(this.completeByValueListInLexerError(a,b)){return;}i=this.calcSpacePrefixAdditionForNavigation(b);this.calculateNavigationStartText();this.convertNavigationRELTypesToBusinessTypes(b);var l=c.getLastTokenTypeAndIgnoreWS(b);var t=this.navigationCompletionInfo.navigationTextInput.split(".");this.parsingOutputInfo.contextInfo.isDeprecatedAllContext=this.parsingOutputInfo.contextInfo.isDeprecatedAllContext||l===f.ALL;this.prepareContextCompletion(a,l,t,i);if(this.isTermMode(a)){this.completeNavSuggestions_termsMode(a,b,i,l);}if(this.isDotMode(a)){this.completeNavSuggestions_dotMode(a,b,i);}jQuery.sap.log.debug("Autocopmlete: End : this.navigationCompletionInfo.navSuggestions - "+this.navigationCompletionInfo.navSuggestions);if(this.navigationCompletionInfo.isValueListSuggestions){this.startSuggestionList();}this.strSuggestions+=this.navigationCompletionInfo.navSuggestions;}};k.prototype.addNonNavigationSuggestions=function(s,a){var i;var b=null;var t={};var l="";if(!this.navigationCompletionInfo.isValueListSuggestions){if(s.length>0&&this.strSuggestions.length>1){this.strSuggestions+=",";}for(i=0;i<s.length;i++){b=null;l=s[i].name;if(this.isPartialCompletion()){b=l.substring(this.parsingOutputInfo.lastText.length,l.length);}else{b=l;}if(b){t=c.getTokenTypeMetadata(s[i].type,l,0,false,h.getModelManger());this.strSuggestions+='{"text":"'+l+'","completion":"'+a+b+'","tokenType":"'+t.group+'","info":'+JSON.stringify(t.info)+'},';}}}};k.prototype.setDOContext=function(a){if(a.hasOwnProperty('context')){this.parsingOutputInfo.contextInfo.contextDO=a.context;}if(a.hasOwnProperty('fullContext')){this.parsingOutputInfo.contextInfo.contextNavigation=a.fullContext;this.parsingOutputInfo.contextInfo.isTermAllContext=this.parsingOutputInfo.contextInfo.isTermAllContext||(a.fullContext&&a.fullContext.modifiers&&a.fullContext.modifiers.hasOwnProperty("all"));}};k.prototype.initParsingOutputInfo=function(i){this.parsingOutputInfo={"nextTokens":[],"lastText":i,"isPartialText":false,"allTokens":false,"allowedTypes":[],"navigationCompleteion":false,"contextInfo":{"contextDO":null,"contextNavigation":null,"valueListAttribute":null,"isDeprecatedAllContext":false,"isTermAllContext":false}};};k.prototype.initNavigationInfo=function(){this.navigationCompletionInfo={"simpleBusinessTypes":[],"collectionBusinessTypes":[],"completeCollection":false,"isValueListSuggestions":false,"navigationTextInput":"","navAlternatives":[],"navSuggestions":"","commaDelimiter":""};};k.prototype.getNextSuggestions=function(i,l,a,b,t){var m="";var s=[];this.startSuggestionList();this.initParsingOutputInfo(i);this.overwriteParserReportError(a,this.parsingOutputInfo);this.overwriteLexerReportError(l,a,this.parsingOutputInfo);var n=((t===d.TYPE_ALL)?d.TYPE_AUTOCOMPLETE:t);c.parseType(a,n);this.setDOContext(a);if(a.lastExpecting.reachedEOF||this.parsingOutputInfo.isPartialText){this.parsingOutputInfo.nextTokens=a.lastExpecting.expecting;if(a.lastExpecting.isPartialText){this.parsingOutputInfo.isPartialText=a.lastExpecting.isPartialText;}}else{this.parsingOutputInfo.nextTokens=[];}m=this.calcSpacePrefixAdditionForNonNavigation(a);this.handleEmptyNextTokens(a);s=this.filterTokens(b,a);this.handleWhitespaceCharsInLastText();if(b.getTermModes().indexOf("byDescription")!==-1){h.getModelManger()[d.propertiesEnum.termMode]=d.DISPLAY_TEXT;}this.addNavigationSuggestions(b,a);this.addNonNavigationSuggestions(s,m);this.closeSuggestionList();return this.strSuggestions;};return{autoCompleteUtilsLib:k};})();
