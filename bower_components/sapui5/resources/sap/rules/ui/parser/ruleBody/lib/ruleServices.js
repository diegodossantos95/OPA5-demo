jQuery.sap.declare("sap.rules.ui.parser.ruleBody.lib.ruleServices");jQuery.sap.require("sap.rules.ui.parser.infrastructure.messageHandling.lib.responseCollector");jQuery.sap.require("sap.rules.ui.parser.resources.common.lib.resourcesConvertor");jQuery.sap.require("sap.rules.ui.parser.resources.vocabulary.lib.vocabularyDataProviderInitiator");jQuery.sap.require("sap.rules.ui.parser.resources.vocabulary.lib.constants");jQuery.sap.require("sap.rules.ui.parser.ruleBody.lib.ruleBodyServices");jQuery.sap.require("sap.rules.ui.parser.ruleBody.lib.decisionTableCell");jQuery.sap.require("sap.rules.ui.parser.ruleBody.lib.constants");jQuery.sap.require("sap.rules.ui.parser.resources.common.lib.oDataHandler");jQuery.sap.require("sap.rules.ui.parser.businessLanguage.lib.constants");jQuery.sap.require("sap.rules.ui.parser.resources.dependencies.lib.constants");sap.rules.ui.parser.ruleBody.lib.ruleServices=sap.rules.ui.parser.ruleBody.lib.ruleServices||{};sap.rules.ui.parser.ruleBody.lib.ruleServices.lib=(function(){var R=sap.rules.ui.parser.infrastructure.messageHandling.lib.responseCollector.lib.ResponseCollector;var r=R.getInstance();var a=sap.rules.ui.parser.resources.common.lib.resourcesConvertor.lib;var v=sap.rules.ui.parser.resources.vocabulary.lib.constants.lib;var b=sap.rules.ui.parser.resources.vocabulary.lib.vocabularyDataProviderInitiator.lib;var c=new b.vocaDataProviderInitiatorLib();var d=sap.rules.ui.parser.ruleBody.lib.ruleBodyServices.lib;var e=new d.RuleBodyServicesLib();var f=sap.rules.ui.parser.ruleBody.lib.constants.lib;var g=sap.rules.ui.parser.ruleBody.lib.decisionTableCell.lib;var D=sap.rules.ui.parser.resources.common.lib.oDataHandler.lib;var p=sap.rules.ui.parser.businessLanguage.lib.constants.lib;var h=sap.rules.ui.parser.resources.dependencies.lib.constants.lib;var O="rule";var k="rules";var l="id";var m="name";var n="content";var o="parameters";var q="usage";var s="RESULT";var t="flags";var u="vocabularyRules";var w="dependencies";var x=function(i,j){var P=D.getOdataPropName(i,j);var Q=null;if(P){Q=i[P];}return Q;};var y=function(i,j){var P=null;var Q=null;P={"connection":null,"resourceID":i,"vocaLoadingType":v.vocaContextTypeEnum.JSON,"resourceContent":j,"termModes":["byName"]};Q=c.init(P);return Q;};var z=function(i){var j=null;var P=i;if((P=x(P,f.EXECUTION_CONTEXT))&&(P=x(P,f.RESULT_DATA_OBJECT_ID))){j=P;}return j;};var A=function(j){var i=0;var P=null;var Q=null;var S=null;var T=z(j);var U=j;if((U=x(U,f.VOCABULARY))&&(U=x(U,f.RULE_CONTENT))&&(U=x(U,f.DATA_OBJECTS))){var V=U;for(i=0;i<V.length;i++){P=V[i];if((U=x(P,f.ID))===T&&(U=x(P,q))===s){return true;}}}U=x(j,f.ID);S={"type":f.additionalInfoTypeEnum.executionContext};Q=[T,U];r.addMessage("result_data_object_of_the_rule_services_is_not_valid",Q,null,S);return false;};var B=function(j,P){var i=0;var Q=null;var S=null;var T=null;var U=null;var V=null;var W=null;var X=null;var Y=x(j,f.ID);var Z=z(j);var $=x(j,f.RULES);if(Z&&$){S=$;for(i=0;i<S.length;i++){Q=S[i];if(($=x(Q,f.RULE_CONTENT))&&($=x($,f.RESULT_DATA_OBJECT_ID))){V=$;if(V===Z){continue;}if((W=x(Q,l))&&($=x(Q,f.RULE_CONTENT))&&(X=x($,m))){P[W]=X;}U={"ruleID":Q[l],"type":f.additionalInfoTypeEnum.ruleResult};T=[V,W,Z,Y];r.addMessage("result_data_object_of_the_rule_is_not_valid",T,null,U);}}}};var C=function(P,Q){var i=0;var j=0;var S=true;var T=null;var U=[];var V=[];var W=null;var X=null;var Y=Q.getParameters()||[];var Z=x(P,f.EXECUTION_CONTEXT);var $=x(Z,o)||[];var _=x(P,f.ID);Z=x(P,f.VOCABULARY);var a1=x(Z,f.ID);for(i=0;i<Y.length;i++){T=Y[i][f.ATTRIBUTES]||[];for(j=0;j<T.length;j++){U.push(T[j][f.PARAMETER_NAME]);}}for(i=0;i<$.length;i++){V.push(x($[i],m));}for(i=0;i<U.length;i++){if(V.indexOf(U[i])===-1){S=false;X={"type":f.additionalInfoTypeEnum.executionContext};W=[U[i],a1,_];r.addMessage("execution_context_parameter_of_the_rule_services_is_not_valid",W,null,X);break;}}return S;};var E=function(i,j,P){var Q={};var S=false;var T=false;P=P||{};Q[f.RULE_STATUS]=f.RULE_ERROR;S=A(i);if(S){T=C(i,j);if(T){B(i,P);if(Object.keys(P).length===0){Q[f.RULE_STATUS]=f.RULE_SUCCESS;}}}return Q;};var F=function(i,j,P){if(!P){P={};}P[f.ODATA_FORMAT_PAYLOAD]={};P[f.ODATA_FORMAT_PAYLOAD][f.RULE_ID]=i;P[f.outputFlagsEnum.validationOutput]=false;P[f.outputFlagsEnum.rootObjectContextOutput]=true;P[f.outputFlagsEnum.dependenciesOutput]=true;if(!P.vocaRules){P.vocaRules={};}P.vocaRules.rootObjectMap=j;};var G=function G(i,j,P,Q,S,T,U,V){var W=new g.DecisionTableCell(i,j,P,Q,S,T);var X=W.validateAndConvert(V,U);return X;};var H=function(i,j){var P=null;if(i){for(P in i){if(i.hasOwnProperty(P)){if(i[P][h.PROPERTY_NAME_CATEGORY]===h.CATEGORY_VOCA_DO){j[i[P].DOName]=null;}}}}};var I=function(i,j,P,Q,S,T){var U=null;var V=null;var W=null;var X=Q?JSON.parse(JSON.stringify(Q)):{};U=a.convertRuleODataToInternalModel(i,null);V=U[f.EXPLICIT_OUTPUT];var Y=X&&X[f.outputFlagsEnum.dependenciesOutput];F(x(i,l),S,X);W=e.process(U.ruleBody,j,P,X,V,null,i);if(W[f.RULE_STATUS]===f.RULE_SUCCESS){if(T!==null&&T!==undefined){H(W[w],T);}if(!Y){delete W[w];}}return W;};var J=function(j,P,Q,S,T){var i=0;var U=x(j,k);var V=null;var W=null;var X={};var Y={};var Z=null;X=E(j,Q,Y);if(!(X[f.RULE_STATUS]===f.RULE_ERROR&&Object.keys(Y).length===0)){for(i=0;i<U.length;i++){V=U[i];Z=x(V,l);if(!Y[Z]){W=I(x(V,n),P,Q,null,S,T);if(W[f.RULE_STATUS]===f.RULE_ERROR){X=W;}}}}return X;};var K=function(j,P,Q,S,T){var U=null;var i=0;var V=null;var W=null;var X=null;var Y=null;var Z={};for(i=0;i<j.length;i++){V=j[i];Y=x(V,n);X=x(Y,m);if(T.hasOwnProperty(X)===false){continue;}W=I(Y,Q,P,Z,null,null);if(W[f.RULE_STATUS]===f.RULE_ERROR){U=W;}else{S[X]=W[f.RULE_ROOT_OBJECT_CONTEXT];}}return U;};var L=function(i){var j=null;var P={};var Q=null;var S=null;var T=null;var U=null;var V=null;var W=null;var X={};var Y=x(i,O);var Z=x(Y,n);var $=x(i,f.VOCABULARY);if(!$){r.addMessage("voca_is_missing_in_the_payload",[],null,null);P[f.RULE_STATUS]=f.RULE_ERROR;}else{T=x($,n);j=x(T,l);U=x(i,t);S=y(j,T);V=x(i,u);P=I(Z,j,S,U,null,X);if(P[f.RULE_STATUS]===f.RULE_SUCCESS){if(V!==null){W={};Q=K(V,S,j,W,X);if(Q===null){P=I(Z,j,S,U,W);}else{P=Q;}}}}return P;};var M=function(i){var j=null;var P=null;var Q=null;var S={};var T=null;var U=null;var V=null;var W={};var X=x(i,f.VOCABULARY);if(!X){r.addMessage("voca_is_missing_in_the_payload",[],null,null);S[f.RULE_STATUS]=f.RULE_ERROR;}else{P=x(X,n);j=x(P,l);U=y(j,P);T=x(i,u);S=J(i,j,U,null,W);if(S[f.RULE_STATUS]===f.RULE_SUCCESS){if(T!==null){V={};Q=K(T,U,j,V,W);if(Q===null){S=J(i,j,U,V,null);}else{S=Q;}}}}return S;};var N=function(){return p.PARSER_EXPR_LANG_VERSION;};return{executeRuleValidation:L,executeRuleServiceValidation:M,validateRuleService:J,validateDecisionTableExpression:G,validateRule:I,validateExecutionContext:E,getParserExprLangVersion:N};}());
