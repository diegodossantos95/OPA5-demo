jQuery.sap.declare("sap.rules.ui.parser.resources.common.lib.resourcesConvertor");jQuery.sap.require("sap.rules.ui.parser.resources.vocabulary.lib.validationUtils");jQuery.sap.require("sap.rules.ui.parser.resources.common.lib.oDataHandler");jQuery.sap.require("sap.rules.ui.parser.infrastructure.util.utilsBase");sap.rules.ui.parser.resources.common.lib.resourcesConvertor=sap.rules.ui.parser.resources.common.lib.resourcesConvertor||{};sap.rules.ui.parser.resources.common.lib.resourcesConvertor.lib=(function(){var d=sap.rules.ui.parser.resources.common.lib.oDataHandler.lib;var u=new sap.rules.ui.parser.infrastructure.util.utilsBase.lib.utilsBaseLib();var v=sap.rules.ui.parser.resources.vocabulary.lib.validationUtils.lib;var g=d.getOdataPropName;var a=d.getOdataPropertyValue;var b=d.getEnumPropertyValue;var c=false;function e(D,i,t,w){var x,y,z,A;var B=a(D,d.PROPERTY_NAME_ID);if(a(D,d.PROPERTY_NAME_TYPE)===d.TYPE_CONDITION){x={colID:B,type:"condition",expression:"",alias:""};z=g(D,d.PROPERTY_NAME_CONDITION);w=u.buildJsonPath(w,z);x.inputModelPath=w;x.expression=a(D[z],d.PROPERTY_NAME_EXPRESSION);if(x.expression==='true'){x.expression='';}A=a(D[z],d.PROPERTY_NAME_FIXED_OPERATOR);if(A!==undefined){x.fixedOperator={};x.fixedOperator.operator=A;i[B]=A+' ';}}else if(a(D,d.PROPERTY_NAME_TYPE)===d.TYPE_RESULT){x={colID:B,name:"",type:"output",businessDataType:""};y=g(D,d.PROPERTY_NAME_RESULT);x.businessDataType=a(D[y],d.PROPERTY_NAME_BUSINESS_DATA_TYPE);x.name=a(D[y],d.PROPERTY_NAME_DO_ATTRIBUTE_NAME);}t[B]=x.type;return x;}function f(D,i,t){var w,x,y,z,A,B,C=true;var E={rowID:0,row:[]};E.rowID=a(D,d.PROPERTY_NAME_ID);B=g(D,d.PROPERTY_NAME_CELLS);x=a(D,d.PROPERTY_NAME_CELLS);if(x){x.forEach(function(O,F){w=u.buildJsonPath(t,B,F);y={colID:0,content:""};y.colID=a(O,d.PROPERTY_NAME_COLUMN_ID);A=a(O,d.PROPERTY_NAME_CONTENT);z=i[y.colID];if(C&&A){C=false;}y.inputModelPath=w;y.content=(z==='output'&&!A)?null:A;if(!(z==='condition'&&!A)){E.row.push(y);}});}if(C){return null;}return E;}function h(D,t){var i;var w=null;var x=null;var y=null;for(i=0;i<D.length;i++){y=D[i];w=g(y,d.PROPERTY_NAME_USAGE);if(w&&y[w]===d.TYPE_DO){w=g(y,d.PROPERTY_NAME_ID);if(w&&y[w]===t){x=a(y,d.PROPERTY_NAME_NAME);break;}}}return x;}function j(D,i){var t={};t.source=a(D,d.PROPERTY_NAME_ATTRIBUTE_MAPPINGS_SOURCE);t.target=a(D,d.PROPERTY_NAME_ATTRIBUTE_MAPPINGS_TARGET);i.push(t);}function k(i,t,w,x){var y=null;var z=null;var A=null;var B={};B.name=a(i,d.PROPERTY_NAME_NAME);if(c){B.description=a(i,d.PROPERTY_NAME_DESCRIPTION);x.validateDescription(B,d.PROPERTY_NAME_ATTRIBUTE,w);}y=g(i,d.PROPERTY_NAME_MAPPING_INFO);if(y){B.dataMapping={};var C=g(i[y],d.PROPERTY_NAME_DATA_TYPE);if(C){B.dataType=a(i[y],d.PROPERTY_NAME_DATA_TYPE);B.dataMapping.column=a(i[y],'column');z=g(i[y],d.PROPERTY_NAME_SIZE);if(z){B.size=a(i[y],d.PROPERTY_NAME_SIZE);}}else{B.dataMapping.column=a(i[y],d.PROPERTY_NAME_NAME);B.dataType=a(i,d.PROPERTY_NAME_DATA_TYPE);z=g(i,d.PROPERTY_NAME_SIZE);if(z){B.size=i[z];}}}else{B.dataType=a(i,d.PROPERTY_NAME_DATA_TYPE);z=g(i,d.PROPERTY_NAME_SIZE);if(z){B.size=i[z];}}A=a(i,d.PROPERTY_NAME_BUSINESS_DATA_TYPE);y=g(i,d.PROPERTY_NAME_VALUE_HELP_ID);if(y&&i[y]){x.validateValueHelpBusinessDataType(i[y],A);B.valueList=i[y];}else{B.businessDataType=A;}B.sourceType=d.SOURCE_TYPE_DATA;t.push(B);}function l(D,i,t,w,x){var y=null;var z={};z.name=a(i,d.PROPERTY_NAME_NAME);if(c){z.description=a(i,d.PROPERTY_NAME_DESCRIPTION);x.validateDescription(z,d.PROPERTY_NAME_ASSOCIATION,w);}y=g(i,d.PROPERTY_NAME_TARGET_DATA_OBJECT_ID);z.target=h(D,i[y]);z.cardinality=b(i,d.PROPERTY_NAME_CARDINALITY);z.attributeMappings=[];y=g(i,d.PROPERTY_NAME_ATTRIBUTE_MAPPINGS);if(y&&i[y]&&Array.isArray(i[y])){i[y].forEach(function(A){j(A,z.attributeMappings);});}t.push(z);}function m(i,t){var w={};var x;w.name=a(i,d.PROPERTY_NAME_NAME);w.description=a(i,d.PROPERTY_NAME_DESCRIPTION);w.businessDataType=a(i,d.PROPERTY_NAME_BUSINESS_DATA_TYPE);var y=g(i,d.PROPERTY_NAME_MAPPING_INFO);if(y){w.dataMapping={};var z=g(i[y],d.PROPERTY_NAME_DATA_TYPE);if(z){w.dataType=a(i[y],d.PROPERTY_NAME_DATA_TYPE);x=g(i[y],d.PROPERTY_NAME_SIZE);if(x){w.size=a(i[y],d.PROPERTY_NAME_SIZE);}}}else{w.dataType=a(i,d.PROPERTY_NAME_DATA_TYPE);w.size=a(i,d.PROPERTY_NAME_SIZE);}w.id=i.Id;t.push(w);}function n(D,i){var t=null;i.name=a(D,d.PROPERTY_NAME_NAME);i.type=a(D,d.PROPERTY_NAME_TYPE);t=g(D,d.PROPERTY_NAME_SCHEMA);i.schema="";if(D[t]){i.schema=D[t];}t=g(D,d.PROPERTY_NAME_PARAMETERS);if(D[t]){i.parameters=D[t];}}function o(D,i,t){var w={};var x=a(D,d.PROPERTY_NAME_ID);var y=t.getValueHelpBusinessDataType(x);if(!y){return;}w.businessDataType=y;w.metadata={};w.metadata.serviceURL=a(D,d.PROPERTY_NAME_SERVICE_URL);w.metadata.propertyPath=a(D,d.PROPERTY_NAME_PROPERTY_PATH);w.metadata.type=a(D,d.PROPERTY_NAME_TYPE);i.valueLists[x]=w;}function p(D,i,t,w){var x={};var y=null;x.name=a(D,d.PROPERTY_NAME_NAME);x.id=a(D,d.PROPERTY_NAME_ID);x.isVocaRule=true;if(c){x.description=a(D,d.PROPERTY_NAME_DESCRIPTION);if(!w.isVocaRuleUnique(x)){w.deleteNonUniqueVocaRule(x,i.dataObjects);return;}w.validateDescription(x,d.PROPERTY_NAME_VOCABULARY_RULE,t);}x.resultDataObjectId=a(D,d.PROPERTY_NAME_RESULTDOID);y=u.findObjectById(x.resultDataObjectId,i.outputs);if(!y){y=u.findObjectById(x.resultDataObjectId,i.vocaRulesOutputs);}x.attributes=y.inputParams;i.dataObjects.push(x);}function q(D,i,t,w,x){var y=null;var z={};y=g(i,d.PROPERTY_NAME_USAGE);if(y){z.name=a(i,d.PROPERTY_NAME_NAME);if(i[y]===d.TYPE_DO){if(c){z.description=a(i,d.PROPERTY_NAME_DESCRIPTION);x.validateDescription(z,d.PROPERTY_NAME_DATA_OBJECT,w);}y=g(i,d.PROPERTY_NAME_ATTRIBUTES);if(y){z.attributes=[];var A=i[y];A.forEach(function(H){k(H,z.attributes,z.name,x);});}y=g(i,d.PROPERTY_NAME_ASSOCIATIONS);if(y){var B=i[y];z.associations=[];B.forEach(function(H){l(D,H,z.associations,z.name,x);});}y=g(i,d.PROPERTY_NAME_MAPPING_INFO);if(y){var C=i[y];z.mappingInfo={};n(C,z.mappingInfo);}t.dataObjects.push(z);}else if(i[y]===d.TYPE_RESULT||i[y]===d.TYPE_NONE){var E=i[y];z.id=a(i,d.PROPERTY_NAME_ID);var F=a(i,d.PROPERTY_NAME_DESCRIPTION);if(F){z.description=F;}y=g(i,d.PROPERTY_NAME_ATTRIBUTES);if(y){z.inputParams=[];var G=i[y];G.forEach(function(H){m(H,z.inputParams);});}if(E===d.TYPE_RESULT){t.outputs.push(z);}else{t.vocaRulesOutputs.push(z);}}}}var r=function(D,i){var t={"id":"","output":"","name":"","ruleBody":{"content":{"headers":[],"rows":[]},"type":"","hitPolicy":"","ruleFormat":""}};var w=g(D,d.PROPERTY_NAME_DECISION_TABLE);var x=u.buildJsonPath(i,w);var y={};var z={};t.id=a(D,d.PROPERTY_NAME_ID);t.name=a(D,d.PROPERTY_NAME_NAME);t.ruleBody.ruleFormat=b(D,d.PROPERTY_NAME_RULE_FORMAT);t.output=a(D,d.PROPERTY_NAME_RESULT_DO_NAME);t.ruleBody.type=b(D,d.PROPERTY_NAME_TYPE);t.ruleBody.relVersion=a(D,d.PROPERTY_NAME_REL_VERSION);t.ruleBody.hitPolicy=b(D[w],d.PROPERTY_NAME_HIT_POLICY);var A=a(D[w],d.PROPERTY_NAME_DT_COLUMNS);var B=g(D[w],d.PROPERTY_NAME_DT_COLUMNS);var C=a(D[w],d.PROPERTY_NAME_DDT_ROWS);var E=g(D[w],d.PROPERTY_NAME_DDT_ROWS);if(A){var F;A.forEach(function(H,I){i=u.buildJsonPath(x,B,I);F=e(H,y,z,i);t.ruleBody.content.headers.push(F);});}if(C){var G;C.forEach(function(H,I){i=u.buildJsonPath(x,E,I);G=f(H,z,i);if(G){t.ruleBody.content.rows.push(G);}});}return t;};var s=function(D,t){var i;var w=new v.validationUtilsLib();var x=null;var y={"dataObjects":[],"outputs":[],"vocaRulesOutputs":[],"valueLists":{}};for(i=0;i<t.length;i++){if(t[i]==='byDescription'){c=true;break;}}x=g(D,d.PROPERTY_NAME_DATA_OBJECTS);if(x){D[x].forEach(function(z){q(D[x],z,y,D.id,w);});}x=g(D,d.PROPERTY_NAME_VALUE_HELPS);if(x&&Array.isArray(D[x])){D[x].forEach(function(z){o(z,y,w);});}x=g(D,d.PROPERTY_NAME_VOCABULARY_RULES);if(x){D[x].forEach(function(z){p(z,y,D.id,w);});}return y;};return{"convertRuleODataToInternalModel":r,"convertVocabularyODataToInternalModel":s};}());
