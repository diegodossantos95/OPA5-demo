(function(){function s(f,i,o){var t=g(f);f.operation(function(){if(!o)return;t.query=p(o);t.posFrom=t.posTo=f.getCursor();j(f,i,true);f.markText({line:t.posFrom.line,ch:t.posFrom.ch},{line:t.posTo.line,ch:t.posTo.ch},{readOnly:true,inclusiveLeft:true,atomic:true,className:"CodeMirror-readOnlyPrefix"});});}function a(f,i){if(typeof f=="string")f=new RegExp(f.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),i?"gi":"g");else if(!f.global)f=new RegExp(f.source,f.ignoreCase?"gi":"g");return{token:function(o){f.lastIndex=o.pos;var t=f.exec(o.string);if(t&&t.index==o.pos){o.pos+=t[0].length;return"searching";}else if(t){o.pos=t.index;}else{o.skipToEnd();}}};}function S(){this.posFrom=this.posTo=this.query=null;this.overlay=null;}function g(f){return f.state.search||(f.state.search=new S());}function q(f){return typeof f=="string"&&f==f.toLowerCase();}function b(f,i,o){return f.getSearchCursor(i,o,q(i));}function d(i,t,o,u,f){if(i.openDialog)i.openDialog(t,f,{value:u});else f(prompt(o,u));}function c(f,t,i,o){if(f.openConfirm)f.openConfirm(t,o);else if(confirm(i))o[0]();}function p(f){var i=f.match(/^\/(.*)\/([a-z]*)$/);if(i){f=new RegExp(i[1],i[2].indexOf("i")==-1?"":"i");if(f.test(""))f=/x^/;}else if(f==""){f=/x^/;}return f;}var e='Search: <input type="text" style="width: 10em"/> <span style="color: #888">(Use /re/ syntax for regexp search)</span>';function h(f,i){var o=g(f);if(o.query)return j(f,i);d(f,e,"Search for:",f.getSelection(),function(t){f.operation(function(){if(!t||o.query)return;o.query=p(t);f.removeOverlay(o.overlay,q(o.query));o.overlay=a(o.query,q(o.query));f.addOverlay(o.overlay);o.posFrom=o.posTo=f.getCursor();j(f,i);});});}function j(f,i,o){f.operation(function(){var t=g(f);var u=b(f,t.query,i?t.posFrom:t.posTo);if(!u.find(i)){u=b(f,t.query,i?CodeMirror.Pos(f.lastLine()):CodeMirror.Pos(f.firstLine(),0));if(!u.find(i))return;}if(!o){f.setSelection(u.from(),u.to());f.scrollIntoView({from:u.from(),to:u.to()});}t.posFrom=u.from();t.posTo=u.to();});}function k(f){f.operation(function(){var i=g(f);if(!i.query)return;i.query=null;f.removeOverlay(i.overlay);});}var r='Replace: <input type="text" style="width: 10em"/> <span style="color: #888">(Use /re/ syntax for regexp search)</span>';var l='With: <input type="text" style="width: 10em"/>';var m="Replace? <button>Yes</button> <button>No</button> <button>Stop</button>";function n(f,o){d(f,r,"Replace:",f.getSelection(),function(t){if(!t)return;t=p(t);d(f,l,"Replace with:","",function(u){if(o){f.operation(function(){for(var v=b(f,t);v.findNext();){if(typeof t!="string"){var y=f.getRange(v.from(),v.to()).match(t);v.replace(u.replace(/\$(\d)/g,function(_,i){return y[i];}));}else v.replace(u);}});}else{k(f);var v=b(f,t,f.getCursor());var w=function(){var i=v.from(),y;if(!(y=v.findNext())){v=b(f,t);if(!(y=v.findNext())||(i&&v.from().line==i.line&&v.from().ch==i.ch))return;}f.setSelection(v.from(),v.to());f.scrollIntoView({from:v.from(),to:v.to()});c(f,m,"Replace?",[function(){x(y);},w]);};var x=function(y){v.replace(typeof t=="string"?u:u.replace(/\$(\d)/g,function(_,i){return y[i];}));w();};w();}});});}CodeMirror.commands.find=function(f){k(f);h(f);};CodeMirror.commands.findNext=h;CodeMirror.commands.findPrev=function(f){h(f,true);};CodeMirror.commands.clearSearch=k;CodeMirror.commands.replace=n;CodeMirror.commands.replaceAll=function(f){n(f,true);};CodeMirror.commands.setPrefixReadOnly=function(f){s(f,undefined,f.readOnlyText);};})();
