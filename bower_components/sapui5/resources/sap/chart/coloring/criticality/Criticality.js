/*
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2017 SAP SE. All rights reserved
 */
sap.ui.define(['sap/chart/coloring/criticality/measureValues/MeasureValues','sap/chart/coloring/criticality/DimensionValues','sap/chart/coloring/ColoringUtils','sap/chart/coloring/ColorPalette','sap/chart/coloring/CriticalityType','sap/chart/data/MeasureSemantics'],function(M,D,C,a,b,c){"use strict";var t=jQuery.type;var S=['DimensionValues','MeasureValues'];var m=[b.Positive,b.Neutral,b.Critical,b.Negative,'Unmentioned'];var d=[b.Positive,b.Critical,b.Negative,b.Neutral];function e(i,l){var r=[];l.forEach(function(s){i.forEach(function(o){if(o.chartLog){throw o.chartLog;}var k=o.parsed.callbacks[s]||[];k.forEach(function(n,p){var q,u;if(s==="Unmentioned"){q=C.assignUnmentionedColor(a.CRITICALITY.Neutral,k.length);u=o.parsed.legend[p];}else{q=C.assignColor(a.CRITICALITY[s],k.length);var L=o.parsed.legend[s];u=(t(L)==="array")?L[p]:L;}var R={callback:n,properties:{color:q[p]},displayName:u};r.push(R);});});});return r;}function f(i){var o=i[0];var l=o.parsed.legend;var p=[],B=[];var n=l.segments[0].upperBound>l.min;var N=(l.segments.length<2)||(l.segments[l.segments.length-2].upperBound<l.max);l.segments.forEach(function(s){var q=C.assignColor(a.CRITICALITY[s.CriticalityType],1)[0];p.push(q);B.push(s.upperBound);});if(n){B=[l.min].concat(B);}else{p.splice(0,1);}if(N){B[B.length-1]=l.max;}else{p.splice(p.length-1,1);B.splice(B.length-1,1);}var k=p.length;if(p.length===1){p=[p[0],p[0]];k=2;}else if(p.length===0){return null;}return{feed:"color",palette:p,numOfSegments:k,legendValues:B};}function g(i){var l;if(i&&i.legendTitle){l={title:{text:i.legendTitle,visible:true}};}return l;}function h(i,l){return function(){var k,p;if(i.bMBC){k=f(i);}else{var r=e(i,l);p={plotArea:{dataPointStyle:{rules:r}},legend:g(i)};}return{colorScale:k,properties:p};};}function j(T,i){var s=[c.Actual,c.Projected,c.Reference];var m=[b.Positive,b.Neutral,b.Critical,b.Negative];var k=[];var n=[];var l=false;T.forEach(function(o){var p=false;var q=[];o.order=[];if(o.criticalityType){l=true;}s.forEach(function(r){if(o[r]){var u=i.filter(function(v){return o[r]===v.msr.getName();})[0];if(u){p=true;o.order.push(r);}else{q.push(r);}}});o.order=o.order.concat(q);if(p){k.push(o);}else{n.push(o);}});if(l){k.sort(function(o,p){return m.indexOf(o.criticalityType)-m.indexOf(p.criticalityType);});}T.splice(0,T.length);T.push.apply(T,k.concat(n));}return{getCandidateSetting:function(o,A,T,k,s,l,L){var n=o.Criticality||{},p=A.parameters||{};var u=C.dimOrMsrUse(n,p,k,S);var q={additionalMeasures:[],additionalDimensions:[]};var r=l.bMBC,Q,P,v;switch(u){case'DimensionValues':var w=p.dimension||Object.keys(n.DimensionValues);if(t(w)==='string'){w=[w];}Q=D.qualify(n.DimensionValues,w,k,l);if(Q){q.qualifiedSettings=Q;Q.parsed=D.parse(Q,k.aDim,s,L,l);q.contextHandler=D.getContextHandler(Q,L,l);q.ruleGenerator=h([Q],d);}break;case'MeasureValues':var x=p.measure||Object.keys(n.MeasureValues);if(t(x)==='string'){x=[x];}Q=M.qualify(n.MeasureValues,T,x,k,s,l);if(Q.sMethod){jQuery.each(Q,function(i,y){P=M.parse(y,k,s,l,L);jQuery.each(P.additionalMeasures,function(i,z){q.additionalMeasures.push(z);});jQuery.each(P.additionalDimensions,function(i,z){q.additionalDimensions.push(z);});y.parsed=P;if(y.settings.Legend&&y.settings.Legend.Title){Q.legendTitle=y.settings.Legend.Title;}});v=Q.sMethod;q.contextHandler=M.getContextHandler(v,Q,r,L);q.qualifiedSettings=Q;q.ruleGenerator=h(Q,m);Q.bMBC=r;j(T,Q);}break;default:return{};}if(Q.length){q.subType=u;}return q;},getLegendProps:g};});
