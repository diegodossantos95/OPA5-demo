/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2017 SAP SE. All rights reserved
 */
sap.ui.define(['sap/chart/library','sap/viz/ui5/controls/VizFrame','sap/viz/ui5/controls/common/BaseControl','sap/viz/ui5/data/Dataset','sap/viz/ui5/data/FlattenedDataset','sap/viz/ui5/data/DimensionDefinition','sap/viz/ui5/data/MeasureDefinition','sap/chart/data/Dimension','sap/chart/data/TimeDimension','sap/chart/data/Measure','sap/ui/model/analytics/ODataModelAdapter','sap/chart/utils/RoleFitter','sap/chart/utils/ChartUtils','sap/chart/utils/ChartTypeAdapterUtils','sap/chart/utils/DateFormatUtil','sap/chart/utils/DataSourceUtils','sap/chart/utils/SelectionAPIUtils','sap/chart/utils/MeasureSemanticsUtils','sap/viz/ui5/controls/common/feeds/FeedItem','sap/ui/model/Filter','sap/ui/model/FilterOperator','sap/ui/model/analytics/odata4analytics','sap/chart/TimeUnitType','sap/chart/coloring/Colorings','sap/chart/ChartLog','sap/chart/pagination/PagingController','sap/ui/core/LocaleData','sap/chart/SeriesColorTracker','sap/viz/ui5/format/ChartFormatter','sap/chart/utils/ValueAxisScaleUtils','sap/chart/AutoScaleMode','sap/chart/ScaleBehavior','sap/viz/ui5/utils/CommonUtil'],function(l,V,B,D,F,a,M,b,T,c,O,R,C,f,g,h,S,n,q,r,s,t,u,w,x,P,L,y,z,A,E,G,H){"use strict";var I=B.extend("sap.chart.Chart",{metadata:{library:"sap.chart",properties:{chartType:{type:"string",defaultValue:"bar"},uiConfig:{type:"object",group:"Misc"},visibleDimensions:{type:"string[]",defaultValue:[]},inResultDimensions:{type:"string[]",defaultValue:[]},visibleMeasures:{type:"string[]",defaultValue:[]},vizProperties:{type:"object",group:"Misc"},vizScales:{type:"object[]",group:"Misc"},isAnalytical:{type:"boolean"},selectionBehavior:{type:"sap.chart.SelectionBehavior",defaultValue:sap.chart.SelectionBehavior.DataPoint},selectionMode:{type:"sap.chart.SelectionMode",defaultValue:sap.chart.SelectionMode.Multi},enablePagination:{type:"boolean",defaultValue:false},enableStableColor:{type:"boolean",defaultValue:false},enableScalingFactor:{type:"boolean",defaultValue:false},customMessages:{type:"object",defaultValue:null},colorings:{type:"object",defaultValue:null},activeColoring:{type:"object",defaultValue:null},valueAxisScale:{type:"object",defaultValue:null}},aggregations:{data:{type:"sap.ui.core.Element",multiple:true,bindable:"bindable"},_vizFrame:{type:"sap.viz.ui5.controls.VizFrame",multiple:false,visibility:"hidden"},dimensions:{type:"sap.chart.data.Dimension",multiple:true},measures:{type:"sap.chart.data.Measure",multiple:true}},events:{drilledDown:{parameters:{dimensions:{type:"string[]"}}},drilledUp:{parameters:{dimensions:{type:"string[]"}}},renderComplete:{},selectData:{},deselectData:{},valueAxisFixedScaleTurnedOff:{}}},renderer:function(o,d){o.write("<div");o.writeControlData(d);o.addStyle("width",d.getWidth());o.addStyle("height",d.getHeight());o.writeStyles();o.write(">");o.renderControl(d.getAggregation("_vizFrame"));o.write("</div>");}});I.getMetadata().getAggregation("data")._doesNotRequireFactory=true;function J(v){return v.indexOf("%")!==-1?"100%":v;}I.prototype.setHeight=function(v){this.setProperty("height",v);var o=this._getVizFrame();if(o){o.setHeight(J(this.getProperty("height")));}return this;};I.prototype.setWidth=function(v){this.setProperty("width",v);var o=this._getVizFrame();if(o){o.setWidth(J(this.getProperty("width")));}return this;};I.prototype.setChartType=function(d,e){this.setProperty("chartType",d,e);this._bIsPagingChartType=C.CONFIG.pagingChartTypes.indexOf(d)>-1;if(this._isEnablePaging()){this._getPagingController().init(false);}else{var o=this._getDataset();if(o){o.setPagingOption(null);o.setRange(-1,-1);}}this._invalidateBy({source:this,keys:{vizFrame:true}});this._bNeedToApplyDefaultProperties=true;return this;};I.prototype.setColorings=function(v){this.setProperty("colorings",v);this._invalidateBy({source:this,keys:{vizFrame:true,checkBinding:true}});return this;};I.prototype.setActiveColoring=function(v){this.setProperty("activeColoring",v);this._invalidateBy({source:this,keys:{vizFrame:true,checkBinding:true}});return this;};I.prototype.setValueAxisScale=function(v){this._bEnbableValueAxisScale=true;this.setProperty("valueAxisScale",v);if(this._oValueScaleSetting&&this._oValueScaleSetting.fireValueAxisFixedScaleTurnedOff){this._oValueScaleSetting.fireValueAxisFixedScaleTurnedOff=false;this._oValueScaleSetting.resetValueAxisScale=true;}this._invalidateBy({source:this,keys:{vizFrame:true}});return this;};I.prototype._setValueAxisScale=function(){var v=this.getValueAxisScale(),d=!this._rendered&&!!v,e=!(this._mNeedToUpdate['binding']&&this._oValueScaleSetting)&&this._bEnbableValueAxisScale;if(d||e){if(!this._bEnbableValueAxisScale){this._bEnbableValueAxisScale=true;}this._oValueScaleSetting=A.getValueAxisScaleSetting(this.getChartType(),v,this.getMeasures(),this.getVisibleMeasures());}};I.prototype._getValueAxisScaleSetting=function(){return this._bEnbableValueAxisScale?this._oValueScaleSetting||{}:{};};I.prototype._validateValueScaleOnDimChange=function(d,o){if(o&&this._oValueScaleSetting){var v=this.getValueAxisScale();if(v&&v.scaleBehavior===G.FixedScale){var e=[];d.forEach(function(k){var m=o.indexOf(k);if(m<0){e.push(k);}else{o.splice(m,1);}});e=e.concat(o);if(e.length>0){var i=false,j=this.getChartType();if(C.isStackedLikeChart(j)){i=true;e.forEach(function(k){if(k._getFixedRole()!=='series'){i=false;}});}if(!i){this._oValueScaleSetting.fireValueAxisFixedScaleTurnedOff=true;v.scaleBehavior=G.AutoScale;this.setProperty('valueAxisScale',v);this.fireValueAxisFixedScaleTurnedOff();if(this._oValueScaleSetting.resetValueAxisScale){v=this.getValueAxisScale();this.setProperty('valueAxisScale',v);}this._oValueScaleSetting=A.getValueAxisScaleSetting(j,v,this.getMeasures(),this.getVisibleMeasures());}}else{this._oValueScaleSetting=A.getValueAxisScaleSetting(this.getChartType(),v,this.getMeasures(),this.getVisibleMeasures());}}}};I.prototype.removeDimension=function(d){var v=this._getVisibleDimensions()||[];var i;if(this.getIsAnalytical()===false&&d&&d.getName()){i=v.indexOf(d.getName());if(i!==-1){jQuery.sap.log.error('Data source does not support aggregation. The method "removeDimension" therefore cannot be used!');return;}}var o=this.removeAggregation("dimensions",d);if(o){i=v.indexOf(o.getName());if(i!==-1){v.splice(i,1);this.setVisibleDimensions(v);}var e=this.getInResultDimensions()||[];i=e.indexOf(o.getName());if(i!==-1){e.splice(i,1);this.setInResultDimensions(e);}}return o;};I.prototype.removeAllDimensions=function(){var o;if(this.getIsAnalytical()===false){jQuery.sap.log.error('Data source does not support aggregation. The method "removeAllDimensions" therefore cannot be used!');}else{o=this.removeAllAggregation("dimensions");this.setVisibleDimensions([]);this.setInResultDimensions([]);}return o;};I.prototype.destroyDimensions=function(){var o;if(this.getIsAnalytical()===false){jQuery.sap.log.error('Data source does not support aggregation. The method "destroyDimensions" therefore cannot be used!');}else{o=this.destroyAggregation("dimensions");this.setVisibleDimensions([]);this.setInResultDimensions([]);}return o;};I.prototype.removeMeasure=function(m){var o=this.removeAggregation("measures",m);if(o){var v=this._getVisibleMeasures()||[],i=v.indexOf(o.getName());if(i!==-1){v.splice(i,1);this.setVisibleMeasures(v);}}return o;};I.prototype.removeAllMeasures=function(){var o=this.removeAllAggregation("measures");this.setVisibleMeasures([]);return o;};I.prototype.destroyMeasures=function(){var o=this.destroyAggregation("measures");this.setVisibleMeasures([]);return o;};I.prototype._getVisibleDimensions=function(d){var o=this._getDrillStateTop();var e=o?o.dimensions:this.getProperty("visibleDimensions");return d?this._normalizeDorM(e,true):e;};I.prototype.getVisibleDimensions=function(){var v=this._getVisibleDimensions();return this._aFeeds?v.filter(function(d){return this._aFeeds._unused.indexOf(d)===-1;},this):v;};I.prototype._getVisibleMeasures=function(d){var o=this._getDrillStateTop();var m=o?o.measures:this.getProperty("visibleMeasures");return d?this._normalizeDorM(m):m;};I.prototype.getVisibleMeasures=function(){var v=this._getVisibleMeasures();return this._aFeeds?v.filter(function(d){return this._aFeeds._unused.indexOf(d)===-1;},this):v;};I.prototype.setVisibleDimensions=function(v,d){var m=this._dimensionSanityCheck({visible:v});this.setProperty("visibleDimensions",v,d);this.setProperty("inResultDimensions",m.inResult,d);this._createDrillStack();this._invalidateBy({source:this,keys:{binding:true,dataSet:true,vizFrame:true}});return this;};I.prototype.setInResultDimensions=function(i,d){var m=this._dimensionSanityCheck({inResult:i});this.setProperty("inResultDimensions",i,d);this.setProperty("visibleDimensions",m.visible,d);this._createDrillStack();this._invalidateBy({source:this,keys:{binding:true,dataSet:true,vizFrame:true}});};I.prototype.setVisibleMeasures=function(m,d){this.setProperty("visibleMeasures",m,d);this._createDrillStack();this._invalidateBy({source:this,keys:{binding:true,dataSet:true,vizFrame:true}});return this;};I.prototype.setEnableStableColor=function(v){v=!!v;if(this.getProperty("enableStableColor")!==v){this.setProperty("enableStableColor",v);this._invalidateBy({source:this,keys:{vizFrame:true}});}};I.prototype.setEnablePagination=function(e,d){if(!this._bIsInitialized){this.setProperty("enablePagination",e,d);this._invalidateBy({source:this,keys:{binding:true,dataSet:true,vizFrame:true,drillStack:true}});}return this;};I.prototype._dimensionSanityCheck=function(d){var v=d.visible||this.getVisibleDimensions()||[],i=d.inResult||this.getInResultDimensions()||[];var m=[].concat(v).concat(i).reduce(function(e,j){var k=v.indexOf(j)!==-1,o=i.indexOf(j)!==-1;if(k&&o){e.common[j]=true;}else if(k){e.visible[j]=true;}else if(o){e.inResult[j]=true;}return e;},{visible:{},inResult:{},common:{}});m.visible=Object.keys(m.visible);m.inResult=Object.keys(m.inResult);m.common=Object.keys(m.common);return m;};I.prototype._prepareFeeds=function(){if(!this._aFeeds){var d=this._normalizeDorM(this._getVisibleDimensions(),true),m=this._normalizeDorM(this._getVisibleMeasures(),false),i=this._normalizeDorM(this.getInResultDimensions(),true),e;this._sAdapteredChartType=this.getEnablePagination()?this.getChartType():f.adaptChartType(this.getChartType(),d);var v=this._getVisibleMeasures();e=this._normalizeDorM(this.getMeasures().filter(function(j){return v.indexOf(j.getName())===-1;}),false);this._aFeeds=R.fit(this._sAdapteredChartType,d,m,i,this._enableSemanticPattern(),e);if((!this._aFeeds._valid||this._aFeeds._unused.length)&&this._sAdapteredChartType!==this.getChartType()){this._sAdapteredChartType=this.getChartType();this._aFeeds=R.fit(this._sAdapteredChartType,d,m,i,this._enableSemanticPattern());}if(this._sAdapteredChartType!==this.getChartType()){this._bNeedToApplyDefaultProperties=true;}}return this._aFeeds;};I.prototype._normalizeDorM=function(m,i){var d=i?this.getDimensions():this.getMeasures(),e=d.reduce(function(p,v){p[v.getName()]=v;return p;},{}),j=i?b:c;var o=m.reduce(function(o,p){var v;if(typeof p==="string"){v=p;}else if(p instanceof j){v=p.getName();}else{o.errors.push(p);}if(e[v]){o.normalized.push(e[v]);}else{o.errors.push(p);}return o;},{normalized:[],errors:[]});var k=o.normalized;if(o.errors.length>0){k.errors=o.errors;}return k;};I.prototype._redundantsFromSelection=function(){var d=this._getVizFrame().vizSelection();if(!d||d.length===0){return{measureNames:{}};}var o=this._getContinuesSemanticTuples();var m=d.reduce(function(i,j){var p=[];for(var X in o){if(o.hasOwnProperty(X)){var Y=o[X];if(j.data[X]){p.push((j.data[Y.timeAxis]<Y.projectedValueStartTime)?Y.projected:Y.actual);}else{p.push(Y.actual);p.push(Y.projected);}}}jQuery.each(j.data,function(k,v){if(!(p.length>0&&p.indexOf(k)>-1)){if(!i[k]){i[k]=[];}if(i[k].indexOf(v)===-1){i[k].push(v);}}});return i;},{});var e=this._getVisibleDimensions().reduce(function(i,j){var v=m[j];if(v.length===1){i[j]=v[0];}return i;},{});e.measureNames=this._getVisibleMeasures().reduce(function(i,j){if(!m[j]){i[j]=true;}return i;},{});return e;};I.prototype._deriveFilterFromSelection=function(){var v=this._getVisibleDimensions();var d=this;var e=this._getVizFrame().vizSelection().map(function(o){var j=v.reduce(function(k,p){var X=d.getDimensionByName(p);var Y;Y=o.data[p];if(C.CONFIG.timeChartTypes.indexOf(d._sAdapteredChartType)>-1&&X instanceof T){var Z=g.getInstance(X.getTimeUnit());if(Z){var $=Z.format.bind(Z);Y=$(new Date(o.data[p]));}}k.filters.push(new r({path:p,operator:s.EQ,value1:Y}));k.signature.push(p+"="+o.data[p]);return k;},{filters:[],signature:[]});j.signature=j.signature.join(";");return j;});var m=e.reduce(function(j,o){if(!j[o.signature]&&o.filters.length>0){j[o.signature]=new r(o.filters,true);}return j;},{});var i=Object.keys(m).map(function(k){return m[k];});if(i.length>1){return new sap.ui.model.Filter(i,false);}else if(i.length===1){return i[0];}else{return null;}};I.prototype._checkDrilldownValid=function(i){var v=this._getVisibleDimensions().concat(this.getInResultDimensions()).reduce(function(e,j){e[j]=true;return e;},{});if(i.some(function(e){return v[e.getName()];})){jQuery.sap.log.error("Drill down not possible, because one of the given dimensions is already drilled down!");return false;}var m=i.reduce(function(e,j){e[j.getName()]=j;return e;},{});function d(e){if(jQuery.isArray(e.aFilters)){return e.aFilters.some(d);}else{return!!m[e.sPath];}}var o=this._getDrillStateTop();if(o&&o.filter&&d(o.filter)){jQuery.sap.log.error("Drill down not possible, because one of the given dimensions is already filtered!");return false;}return true;};I.prototype._createDrillStack=function(){var v=this.getProperty("visibleDimensions")||[],d=this.getProperty("visibleMeasures")||[],e=[{dimensions:[],measures:d,filter:undefined}],j=[];for(var i=0;i<v.length;i++){j.push(v[i]);e.push({dimensions:j.slice(),measures:d,filter:undefined});}this._drillStateStack=e;};I.prototype._invalidateBy=function(o){var d=o.source;var e=this._oCandidateColoringSetting?(this._oCandidateColoringSetting.additionalDimensions||[]):[];if(d===this){jQuery.each(o.keys||{},function(k,v){this._markForUpdate(k,v);}.bind(this));}else if(d instanceof c&&this._getVisibleMeasures().indexOf(d.getName())!==-1){this._markForUpdate("dataSet",true);this._markForUpdate("vizFrame",true);if(o.property==="unitBinding"||(this.getColorings()&&(o.property==='semantics'||o.property==='semanticallyRelatedMeasures'))){this._markForUpdate("binding",true);}}else if(d instanceof b&&this._getVisibleDimensions().concat(e).indexOf(d.getName())!==-1){this._markForUpdate("dataSet",true);this._markForUpdate("vizFrame",true);if(d.getDisplayText()&&(o.property==="textProperty"||o.property==="displayText")){this._markForUpdate("binding",true);}}this.invalidate(o);};I.prototype._handleNonAnalyticalFeeding=function(){var d=this;var i=this.getInResultDimensions();var v=this._getVisibleDimensions(),e=this.getDimensions().map(function(o){return o.getName();});var j=[];e.forEach(function(m){if(d.getDimensionByName(m)){var o=d.getDimensionByName(m).getTextProperty();if(o){j.push(o);}}});var k=v.concat(e.filter(function(m){return(v.indexOf(m)<0);})).filter(function(m){return(j.indexOf(m)<0)&&(i.indexOf(m)<0);});this.setProperty("visibleDimensions",k);this._createDrillStack();};I.prototype._markForUpdate=function(k,d){if(!this._mNeedToUpdate){this._mNeedToUpdate={};}this._mNeedToUpdate[k]=d;var o=this._updaters.onInvalidate[k];if(o){o.call(this);}};I.prototype._updaters=(function(){return{onInvalidate:{vizFrame:function(){this._aFeeds=null;this._bColoringParsed=null;},checkBinding:function(){this._bColoringParsed=null;},binding:function(){this._bColoringParsed=null;},loopData:function(){this._bColoringParsed=null;}},checkBinding:function(){var o=this._getCandidateColoringSetting();var d=o.additionalDimensions;var e=o.additionalMeasures;if((d&&d.length)||(e&&e.length)){this._mNeedToUpdate["binding"]=true;}},drillStack:function(){this._createDrillStack();},dataSet:function(){this._getDataset().invalidate();},binding:function(){var o=this._getDataset().getBinding("data"),i=this.getInResultDimensions();if(!o){return;}var d=this._getVisibleDimensions(true).concat(this._normalizeDorM(i,true));var m=this._getVisibleMeasures(true);h.updateModel(this.getIsAnalytical())(this,d,m);var e=this._getDrillStateTop();if(d.length>0||m.length>0){this._getVizFrame()._readyToRender(false);this.setBusy(true);}this._bFilterCalledByChart=true;o.filter((e&&e.filter)?e.filter:undefined);if(this._bEnbableValueAxisScale){this._validateValueScaleOnDimChange(d,this._aDimensions);}this._aDimensions=d;},vizFrame:function(){var d=this,o=this._getDataset(),v=this._getVizFrame();if(this._mNeedToUpdate['binding']){if(this._isEnablePaging()){this._getPagingController().reset();this._oColoringStatus={};}else{this._getDataset().setPagingOption(null);}}else{this._markForUpdate('loopData',true);}if(this.getEnableStableColor()){this._oColorTracker.add(v._runtimeScales());v._runtimeScales(this._oColorTracker.get(),true);}else{this._resetRuntimeScale();}var m=this._isEnablePaging()?this._getPagingController().getMeasureRange():{};o.removeAllAggregation("dimensions",true);o.removeAllAggregation("measures",true);v.removeAllAggregation("feeds",true);if(this.getIsAnalytical()===false){this._handleNonAnalyticalFeeding();}var e=this._prepareFeeds();e._def.dim.forEach(function(X){o.addAggregation("dimensions",X,true);},this);e._def.msr.forEach(function(X){if(X){var Y=m[X.getIdentity()];if(Y){X.setRange([Y.min,Y.max]);}if(!d.getDimensionByName(X.getUnit())){X.setUnit(null);}o.addAggregation("measures",X,true);}},this);e.forEach(function(X){v.addFeed(X);});this._semanticTuples=e._semanticTuples;var i=this._getCandidateColoringSetting();var j=e._context||[];var k=i.additionalMeasures||[];var p=i.additionalDimensions||[];k.forEach(function(X){j.push({id:X,showInTooltip:false});o.addMeasure(new M({name:X,identity:X,value:'{'+X+'}'}));});p.forEach(function(X){j.push({id:X,showInTooltip:false});o.addDimension(new a({name:X,identity:X,value:'{'+X+'}'}));});o.setContext(j);v.invalidate();o.invalidate();v.setVizType(this._sAdapteredChartType);v._setCustomMessages(this.getCustomMessages());this._setValueAxisScale();if(!this._mNeedToUpdate['loopData']){this._setEffectiveScales();v.setVizProperties(this._getEffectiveProperties());}},loopData:function(){var v=this._getVizFrame();try{this._prepareData();}catch(e){if(e instanceof x){e.display();}else{throw e;}}var o=this._getEffectiveProperties();this._usingDisplayNameForSemantics(o);v.setVizProperties(o);this._setEffectiveScales();}};})();I.prototype._getDrillStateTop=function(){return this._drillStateStack?this._drillStateStack[this._drillStateStack.length-1]:null;};I.prototype._getVizFrame=function(){return this.getAggregation("_vizFrame");};I.prototype._getDataset=function(){var v=this._getVizFrame();return v?v.getDataset():null;};I.prototype._prepareData=function(){var o=this._getCandidateColoringSetting().contextHandler;var d=[];if(o){d.push(o);try{this._loopContext(d);}catch(e){if(e instanceof x){e.display();this._oCandidateColoringSetting={};}else{throw e;}}}this._oSemanticVizSettings=n.getSemanticVizSettings(this._sAdapteredChartType,this._semanticTuples,this._oCandidateColoringSetting,this._enableSemanticPattern(),this._bDataPointStyleSetByUser,this._bLegendSetByUser);};I.prototype._getContexts=function(){var o=this.getBinding("data");if(o){if(this._isEnablePaging()&&this._getPagingController().isUnderPaging()){return this._getPagingController().getCurrentContexts();}else{var i=0;var d=o instanceof sap.ui.model.analytics.AnalyticalBinding?o.getTotalSize():o.getLength();return o.getContexts(i,d);}}else{return[];}};I.prototype._loopContext=function(d){var e=this._getContexts();if(e.length>0&&!e.dataRequested){var i=this;e.forEach(function(o){d.forEach(function(j){j.call(i,o);});});}};I.prototype._filterHandler=function(){if(!this._bFilterCalledByChart){this._bFilterCalledByCustomer=true;this._bColoringParsed=false;}this._bFilterCalledByChart=false;};I.prototype._dataRefreshListener=function(e){if(e.getParameters().reason==='filter'){this._filterHandler();}};I.prototype._bindingChangeListener=function(o){var v=this._getVizFrame();if(o.getParameters().reason==='filter'){this._filterHandler();}if(this.getEnableStableColor()){this._oColorTracker.add(v._runtimeScales());v._runtimeScales(this._oColorTracker.get(),true);}v.invalidate();this.setBusy(false);if(this._isEnablePaging()){this._getPagingController().bindingChanged();}else{v._readyToRender(true);}try{this._prepareData();}catch(e){if(e instanceof x){e.display();}}var d=this._getEffectiveProperties();this._usingDisplayNameForSemantics(d);v.setVizProperties(d);this._setEffectiveScales();this._bFilterCalledByChart=false;this._bFilterCalledByCustomer=false;};I.prototype._resetRuntimeScale=function(){this._oColorTracker.clear();this._getVizFrame()._runtimeScales(this._oColorTracker.get(),true);};I.prototype._hasUserSemanticProps=function(){var v=this.getProperty("vizProperties");if(v&&v.plotArea){if(v.plotArea.dataPointStyle||v.plotArea.seriesStyle){return true;}}return false;};I.prototype._enableSemanticColoring=function(){var d=true;if(this._sAdapteredChartType==="heatmap"){var v=this.getProperty("vizScales")||[];var o=v.filter(function(e){return e.feed==="color";})[0];if(o){d=false;}}else{if(this._hasUserSemanticProps()){d=false;}}return d;};I.prototype._enableSemanticPattern=function(){return!this._hasUserSemanticProps()&&C.CONFIG.nonSemanticPatternChartType.indexOf(this._sAdapteredChartType)===-1;};I.prototype._hasSemanticPattern=function(){return this._enableSemanticPattern()&&n.hasSemanticRelation(this._semanticTuples);};I.prototype._getContinuesSemanticTuples=function(){var d={};if(this._hasSemanticPattern()){d=this._semanticTuples.reduce(function(e,i){if(i.semanticMsrName){e[i.semanticMsrName]=i;}return e;},{});}return d;};I.prototype._getContinuesSemanticMap=function(){var d=[];if(this._hasSemanticPattern()){d=this._semanticTuples.filter(function(e){return e.projectedValueStartTime;});}return d;};I.prototype._getInternalVisibleMeasures=function(){var m=this._getVisibleMeasures();if(this._hasSemanticPattern()){m=m.concat(this._getContinuesSemanticMap().map(function(d){return d.semanticMsrName;}));}return m;};I.prototype._buildSelectedDataPoints=function(o,d){var m=this._getInternalVisibleMeasures(),e=this._getVisibleDimensions().concat(this.getInResultDimensions()),i=this._getEffectiveContinuesDataPoints(d);return S.buildSelectionVizCtx(m,e,o,i);};I.prototype._getEffectiveContinuesSeries=function(d){var e=d.slice(),i=this._getContinuesSemanticMap();if(this._hasSemanticPattern()){var m=e.map(function(j){return j.measures;});i.forEach(function(j){if(m.indexOf(j.actual)>-1||m.indexOf(j.projected)>-1){e=e.filter(function(k){return k.measures!==j.actual&&k.measures!==j.projected;});if(m.indexOf(j.actual)>-1&&m.indexOf(j.projected)>-1){e.push({measures:j.semanticMsrName});}}});}return e;};I.prototype._getEffectiveContinuesDataPoints=function(d){var e=d.slice(),k=this._getContinuesSemanticMap();if(this._hasSemanticPattern()){var m,p,o,v;for(var i=0;i<e.length;i++){o=e[i].measures;for(var j=0;j<k.length;j++){v=k[j];m=o.indexOf(v.actual);if(m>-1){o.splice(m,1);}p=o.indexOf(v.projected);if(p>-1){o.splice(p,1);}if(m>-1||p>-1){o.push(v.semanticMsrName);}}}}return e;};I.prototype._buildSelectEventData=function(d){if(d&&d.length>0&&this._hasSemanticPattern()){var v,e;var k=this._getContinuesSemanticMap();for(var i=0;i<d.length;i++){v=jQuery.extend(true,{},d[i].data);for(var j=0;j<k.length;j++){e=k[j];if(v.measureNames===e.semanticMsrName){if(v[e.timeAxis]<e.projectedValueStartTime){v.measureNames=e.actual;delete v[e.projected];delete v[e.semanticMsrName];}else{v.measureNames=e.projected;delete v[e.actual];delete v[e.semanticMsrName];}}else{if(v[e.actual]&&v.measureNames!==e.actual){delete v[e.actual];}if(v[e.projected]&&v.measureNames!==e.projected){delete v[e.projected];}}}d[i].data=v;}}};I.prototype.addData=function(){jQuery.sap.log.error('Chart manages the "data" aggregation only via data binding. The method "addData" therefore cannot be used programmatically!');};I.prototype.destroyData=function(){jQuery.sap.log.error('Chart manages the "data" aggregation only via data binding. The method "destroyData" therefore cannot be used programmatically!');};I.prototype.getData=function(){jQuery.sap.log.error('Chart manages the "data" aggregation only via data binding. The method "getData" therefore cannot be used programmatically!');};I.prototype.indexOfData=function(){jQuery.sap.log.error('Chart manages the "data" aggregation only via data binding. The method "indexOfData" therefore cannot be used programmatically!');};I.prototype.insertData=function(){jQuery.sap.log.error('Chart manages the "data" aggregation only via data binding. The method "insertData" therefore cannot be used programmatically!');};I.prototype.removeData=function(){jQuery.sap.log.error('Chart manages the "data" aggregation only via data binding. The method "removeData" therefore cannot be used programmatically!');};I.prototype.removeAllData=function(){jQuery.sap.log.error('Chart manages the "data" aggregation only via data binding. The method "removeAllData" therefore cannot be used programmatically!');};I.prototype._createOData4SAPAnalyticsModel=function(m){var o=null;try{o=new t.Model(new t.Model.ReferenceByModel(m));}catch(e){return undefined;}return o;};I.prototype.getIsAnalytical=function(){return this.getProperty("isAnalytical");};I.prototype.setIsAnalytical=function(v,d){if(this._bIsInitialized){jQuery.sap.log.error('The proeprty isAnalytical will programmatically set according to data source. The method "setIsAnalytical" therefore cannot be used!');}else{this.setProperty("isAnalytical",v,d);}};I.prototype._setIsAnalyticalProperty=function(o,d){var v=o.findQueryResultByName(h.getEntitySet(this.getIsAnalytical())(d))!==undefined;if(this.getIsAnalytical()!==v){this.setProperty("isAnalytical",v);}};I.prototype.bindAggregation=function(d,o){if(d==="data"){this._oBindingInfo=jQuery.extend(true,{},o);var m=this.getModel(o.model);var e;if(m){if(m instanceof sap.ui.model.json.JSONModel){if(this.getIsAnalytical()!==false){this.setProperty("isAnalytical",false);}else if(this.getEnablePagination()!==false){this.setProperty("enablePagination",false);}}else{e=this._createOData4SAPAnalyticsModel(m);this._setIsAnalyticalProperty(e,o);}if(this.getIsAnalytical()){if(o){var i=true;if(o.length!=undefined||this._isEnablePaging()){i=false;}o.parameters=jQuery.extend(true,{},{analyticalInfo:[{name:""}],useBatchRequests:true,provideGrandTotals:false,provideTotalsResultSize:false,autoexpand:false,reloadSingleUnitMeasures:true,noPaging:i},o.parameters);}O.apply(m);if(e){m.setAnalyticalExtensions(e);}}}}return B.prototype.bindAggregation.apply(this,arguments);};I.prototype._bindAggregation=function(d,o){if(d==="data"){var m=this.getModel(o.model);if(m){if(m instanceof sap.ui.model.json.JSONModel){if(this.getIsAnalytical()!==false){this.setProperty("isAnalytical",false);}else if(this.getEnablePagination()!==false){this.setProperty("enablePagination",false);}}else{var e=this._createOData4SAPAnalyticsModel(m);this._setIsAnalyticalProperty(e,o);}if(this.getIsAnalytical()){if(o){var i=true;if(o.length!=undefined||this._isEnablePaging()){i=false;}o.parameters=jQuery.extend(true,{},{analyticalInfo:[{name:""}],useBatchRequests:true,provideGrandTotals:false,provideTotalsResultSize:false,autoexpand:false,reloadSingleUnitMeasures:true,noPaging:i},o.parameters);}O.apply(m);if(e){m.setAnalyticalExtensions(e);}}this._deriveColumns(m,o);}var j=this._getDataset();j.bindAggregation("data",o);this._invalidateBy({source:this,keys:{binding:true,vizFrame:true}});}else{B.prototype._bindAggregation.apply(this,arguments);}};I.prototype._dataErrorListener=function(e){var v=this._getVizFrame();if(v){v._readyToRender(true);v.invalidate();this.setBusy(false);}};I.prototype.unbindAggregation=function(d,e){if(d==="data"){var o=this._getDataset();if(o){o.unbindAggregation.apply(o,arguments);}e=true;}return B.prototype.unbindAggregation.apply(this,[d,e]);};I.prototype.unbindData=function(){if(!this.getIsAnalytical()){this.removeAllAggregation("dimensions");this.removeAllAggregation("measures");this.setProperty("visibleDimensions",[]);this.setProperty("inResultDimensions",[]);this.setProperty("visibleMeasures",[]);this._createDrillStack();}this.unbindAggregation("data");};I.prototype._deriveColumns=function(m,o){var d=this.getAggregation("dimensions");var e=this.getAggregation("measures");if((d===null||d.length===0)&&(e===null||e.length===0)){var i=h.deriveColumns(this.getIsAnalytical())(m,o);i.dimensions.forEach(this.addDimension.bind(this));i.measures.forEach(this.addMeasure.bind(this));}};I.prototype.onBeforeRendering=function(){B.prototype.onBeforeRendering.apply(this,arguments);var o=["onInvalidate","drillStack","dataSet","vizFrame","checkBinding","binding","loopData"];o.forEach(function(k){if(this._mNeedToUpdate[k]){this._updaters[k].call(this);}}.bind(this));jQuery.each(this._mNeedToUpdate,function(k){this._mNeedToUpdate[k]=false;}.bind(this));};I.prototype.onAfterRendering=function(){this._showLoading(this._bLoading);this._rendered=true;};I.prototype.onlocalizationChanged=function(){this._invalidateBy({source:this,keys:{vizFrame:true}});};I.prototype.exit=function(){this._getDataset().unbindAggregation('data',true);this._oColorTracker.clear();B.prototype.exit.apply(this,arguments);var v=this._getVizFrame();if(this._delegateEventHandlers){this._delegateEventHandlers.forEach(function(o){v["detach"+o.name](o.handler,this);delete o.handler;},this);delete this._delegateEventHandlers;}v.detachRenderComplete(this._vizFrameRenderCompleteHandler,this);v.detachEvent("_zoomDetected",U.bind(this),this);v.detachEvent("_selectionDetails",W.bind(this),this);};I.prototype.applySettings=function(){sap.ui.core.Control.prototype.applySettings.apply(this,arguments);var d=new F();d.attachEvent("dataChange",{},this._bindingChangeListener,this);d.attachEvent("dataRefresh",{},this._dataRefreshListener,this);d.attachEvent("dataError",{},this._dataErrorListener,this);var i=jQuery.extend(true,{},{'applicationSet':'fiori'},this.getUiConfig());this.setUiConfig(i);this._bNeedToApplyDefaultProperties=true;this._oSemanticVizSettings={};var v=new V({width:J(this.getWidth()),height:J(this.getHeight()),vizType:this.getChartType(),uiConfig:this.getUiConfig(),vizProperties:this._getEffectiveProperties()});v.setDataset(d);v.attachRenderComplete(null,this._updateLoadingIndicator.bind(this));v.attachEvent("_zoomDetected",U.bind(this));v.attachEvent("renderFail",null,function(e){var p=this._getPagingController();if(p._sLoadingTimer){jQuery.sap.clearDelayedCall(p._sLoadingTimer);p._sLoadingTimer=null;}this._showLoading(false);},this);this._rendered=false;v._readyToRender(false);this.setAggregation("_vizFrame",v);this._delegateEvents();this._sAdapteredChartType=this.getChartType();this._bIsInitialized=true;this._oCandidateColoringSetting={};this._oColoringStatus={};this._mNeedToUpdate={};this._oColorTracker=new y();if(this._isEnablePaging()){this._getPagingController();}};I.prototype.setCustomMessages=function(o){this.setProperty("customMessages",o);var v=this._getVizFrame();if(v){v._setCustomMessages(o);}return this;};I.prototype._getZoomInfo=function(){var v=this._getVizFrame();if(v){return v._getZoomInfo();}};I.prototype.resetLayout=function(){this._invalidateBy({source:this,keys:{binding:true,vizFrame:true,drillStack:true,dataSet:true}});return this;};I.prototype.setSelectedDataPoints=function(d){if(this.getSelectionMode()!==l.SelectionMode.None){var o=this.getBinding("data"),v=this._getVizFrame();if(!o||!v||this.getSelectionBehavior().toUpperCase()!=="DATAPOINT"){return this;}v.vizSelection([],{clearSelection:true});v.vizSelection(this._buildSelectedDataPoints(o,d),{selectionMode:this.getSelectionMode()});}return this;};I.prototype.addSelectedDataPoints=function(d){if(this.getSelectionMode()!==l.SelectionMode.None){var o=this.getBinding("data"),v=this._getVizFrame();if(!o||!v||this.getSelectionBehavior().toUpperCase()!=="DATAPOINT"){return this;}v.vizSelection(this._buildSelectedDataPoints(o,d),{selectionMode:l.SelectionMode.Multi});}return this;};I.prototype.getSelectedDataPoints=function(){var v=this._getVizFrame();if(!v||this.getSelectionBehavior().toUpperCase()!=="DATAPOINT"){return{count:0,dataPoints:[]};}var o=this._getContinuesSemanticTuples();var m=this._getVisibleMeasures(),d=this._getDataset(),e=v.vizSelection()||[],j={};for(var i=0,k=e.length;i<k;i++){var p=e[i],X=p.data._context_row_number;if(!j[X]){j[X]={index:X,measures:[],context:d.findContext({"_context_row_number":X})};}p.measures=S.filterVisibleMsr(p.data,m);if(!jQuery.isEmptyObject(o)){S.filterSemMsr(o,m,p);}j[X].measures=j[X].measures.concat(p.measures);if(p.unit){j[X].unit=jQuery.extend(true,j[X].unit,p.unit);}if(p.dataName){j[X].dataName=jQuery.extend(true,j[X].dataName,p.dataName);}}return{count:e.length,dataPoints:Object.keys(j).map(function(Y){return j[Y];})};};I.prototype.removeSelectedDataPoints=function(d){if(this.getSelectionMode()!==l.SelectionMode.None){var o=this.getBinding("data"),v=this._getVizFrame();if(!v||this.getSelectionBehavior().toUpperCase()!=="DATAPOINT"){return this;}var e=this._buildSelectedDataPoints(o,d);v.vizSelection(e,{deselection:true});}return this;};I.prototype.setSelectedCategories=function(d){if(this.getSelectionMode()!==l.SelectionMode.None){var v=this._getVizFrame(),e=this.getSelectionBehavior().toUpperCase();if(!v||e!=="CATEGORY"){return this;}v.vizSelection([],{clearSelection:true});v.vizSelection(d.map(S.toVizCSCtx),{selectionMode:this.getSelectionMode()});}return this;};I.prototype.addSelectedCategories=function(d){if(this.getSelectionMode()!==l.SelectionMode.None){var v=this._getVizFrame(),e=this.getSelectionBehavior().toUpperCase();if(!v||e!=="CATEGORY"){return this;}v.vizSelection(d.map(S.toVizCSCtx),{selectionMode:l.SelectionMode.Multi});}return this;};I.prototype.removeSelectedCategories=function(d){if(this.getSelectionMode()!==l.SelectionMode.None){var v=this._getVizFrame(),e=this.getSelectionBehavior().toUpperCase();if(!v||e!=="CATEGORY"){return this;}v.vizSelection(d.map(S.toVizCSCtx),{deselection:true});}return this;};I.prototype.getSelectedCategories=function(){var v=this._getVizFrame(),d=this.getSelectionBehavior().toUpperCase();if(!v||d!=="CATEGORY"){return{count:0,categories:[]};}else{var e=v.vizSelection();return{count:e.length,categories:(e.category||[]).map(S.fromVizCSCtx)};}};I.prototype.setSelectedSeries=function(d){if(this.getSelectionMode()!==l.SelectionMode.None){var v=this._getVizFrame(),e=this.getSelectionBehavior().toUpperCase();if(!v||e!=="SERIES"){return this;}v.vizSelection([],{clearSelection:true});var i=this._getEffectiveContinuesSeries(d);v.vizSelection(i.map(S.toVizCSCtx),{selectionMode:this.getSelectionMode()});}return this;};I.prototype.addSelectedSeries=function(d){if(this.getSelectionMode()!==l.SelectionMode.None){var v=this._getVizFrame(),e=this.getSelectionBehavior().toUpperCase();if(!v||e!=="SERIES"){return this;}var i=this._getEffectiveContinuesSeries(d);v.vizSelection(i.map(S.toVizCSCtx),{selectionMode:l.SelectionMode.Multi});}return this;};I.prototype.removeSelectedSeries=function(d){if(this.getSelectionMode()!==l.SelectionMode.None){var v=this._getVizFrame(),e=this.getSelectionBehavior().toUpperCase();if(!v||e!=="SERIES"){return this;}var i=this._getEffectiveContinuesSeries(d);v.vizSelection(i.map(S.toVizCSCtx),{deselection:true});}return this;};I.prototype.getSelectedSeries=function(){var v=this._getVizFrame(),d=this.getSelectionBehavior().toUpperCase();if(!v||d!=="SERIES"){return{count:0,series:[]};}else{var e=v.vizSelection(),i=(e.series||[]).map(S.fromVizCSCtx),j=[],k=this._getContinuesSemanticTuples();i=i.filter(function(m){var o=true;if(m&&m.measures){var p=k[m.measures];if(p&&p.semanticMsrName===m.measures){j.push({measures:p.actual});j.push({measures:p.projected});o=false;}}return o;});i=i.concat(j);return{count:e.length,series:i};}};I.prototype.drillDown=function(d){if(this.getIsAnalytical()===false){jQuery.sap.log.error('Data source does not support drillDown/drillUp. The method "drillDown" therefore cannot be used!');return;}if(d&&!(d instanceof Array)){d=[d];}var e=this._normalizeDorM(d,true);if(e.length===0){return;}if(!this._checkDrilldownValid(e)){jQuery.sap.log.warning("Drill down not possible for "+e+". Already drilled down.");return;}var o=this._getDrillStateTop(),m=this._redundantsFromSelection(),i=this._deriveFilterFromSelection();var j;if(i){j=!(o&&o.filter)?i:new r([i,o.filter],true);}this._drillStateStack.push({dimensions:o.dimensions.slice().concat(e.map(function(p){return p.getName();})).filter(function(p){return!m[p];}),measures:o.measures.filter(function(p){return!m.measureNames[p];}),filter:j,redundant:m});var k=e.map(function(p){return p.getName();});this.fireDrilledDown({dimensions:k});this._invalidateBy({source:this,keys:{binding:true,vizFrame:true}});};I.prototype.drillUp=function(i){if(this.getIsAnalytical()===false){jQuery.sap.log.error('Data source does not support drillDown/drillUp. The method "drillUp" therefore cannot be used!');return;}if(arguments.length===0){i=this._drillStateStack.length-2;}var o=this._drillStateStack[i];if(o&&i!=this._drillStateStack.length-1){var p=this._drillStateStack.pop();this._drillStateStack.splice(i+1);this.fireDrilledUp({dimensions:p.dimensions.filter(function(d){return o.dimensions.indexOf(d)===-1;})});this._invalidateBy({source:this,keys:{binding:true,vizFrame:true}});}};I.prototype.getDrillStack=function(){if(this.getIsAnalytical()===false){jQuery.sap.log.error('Data source does not support drillDown/drillUp. The method "getDrillStack" therefore cannot be used!');return;}return jQuery.map(this._drillStateStack||[],function(o,i){return{dimension:o.dimensions.slice(),measure:o.measures.slice(),filter:o.filter};});};I.prototype.setUiConfig=function(o){this.setProperty("uiConfig",o);if(this._getVizFrame()){this._getVizFrame().setUiConfig(o);}};var K=(function(){var d=["interaction.selectability.mode","interaction.selectability.behavior"];function e(o,p){var j=o,v;v=p.reduce(function(m,X){if(j.hasOwnProperty(X)){m.push({parent:j,val:j[X],key:X});j=j[X];}return m;},[]);if(v.length!==p.length){return;}var k=v.pop();delete k.parent[k.key];while(v.length>0){k=v.pop();if(Object.keys(k.val).length>0){return;}else{delete k.parent[k.key];}}}function i(v,j){var o=jQuery.extend(true,{},v);d.forEach(function(p){delete o[p];e(o,p.split("."));});return o;}return{sanitize:i,modify:function(p,k,j){var m=k.split("."),o=p;while(m.length>1&&o.hasOwnProperty(m[0])){o=o[m.shift()];}var v=m[0];if(m.length===1&&o.hasOwnProperty(v)){o[v]=j(o[v]);}}};})();I.prototype.setVizProperties=function(v){v=K.sanitize(v);this.setProperty("vizProperties",v);if(v.plotArea&&v.plotArea.dataPointStyle){this._bDataPointStyleSetByUser=true;this._invalidateBy({source:this,keys:{vizFrame:true,loopData:true}});}if(v.legend&&v.legend.title){this._bLegendSetByUser=true;}if(this._getVizFrame()){this._getVizFrame().setVizProperties(this._getEffectiveProperties());}};I.prototype.getVizProperties=function(){var o=this._getVizFrame();var d=K.sanitize(o?o.getVizProperties():this.getProperty("vizProperties"));function e(i){var j=sap.viz.api.env.Format.numericFormatter();if(!j||jQuery.type(j.stripUnit)!=="function"){return i;}if(jQuery.type(i)==="string"){return j.stripUnit(i);}else if(jQuery.type(i)==="object"){jQuery.each(i,function(k,v){i[k]=j.stripUnit(v);});return i;}else{return i;}}K.modify(d,"plotArea.dataLabel.formatString",e);K.modify(d,"tooltip.formatString",e);return d;};I.prototype.setVizScales=function(v){this.setProperty("vizScales",v);this._aVizValueScales=v.filter(function(o){return o.feed==="valueAxis"||o.feed==="valueAxis2"||o.feed==="actualValues";});if(this._aVizValueScales&&this._aVizValueScales.length>0){this._bEnbableValueAxisScale=false;}if(this._getVizFrame()){this._getVizFrame().setVizScales(v);}};I.prototype.getVizScales=function(){var v=this._getVizFrame();return v?v.getVizScales():this.getProperty("vizScales");};I.prototype.getVizUid=function(){return this._getVizFrame().getVizUid();};I.prototype.zoom=function(o){this._getVizFrame().zoom(o);};var N=["selectData","deselectData"];I.prototype._delegateEvents=function(){if(this._delegateEventHandlers){return;}var v=this._getVizFrame();this._delegateEventHandlers=N.map(function(e){var d=e.charAt(0).toUpperCase()+e.slice(1);var i=function(o){var p=o.getParameters();this._buildSelectEventData(p.data);delete p.id;this.fireEvent(e,p);};i=i.bind(this);v["attach"+d](null,i);return{name:d,handler:i};},this);this._vizFrameRenderCompleteHandler=Q.bind(this);v.attachRenderComplete(null,this._vizFrameRenderCompleteHandler);v.attachEvent("_selectionDetails",W.bind(this));};I.getChartTypes=sap.chart.api.getChartTypes;I.prototype.getAvailableChartTypes=function(){var d=this._getVisibleDimensions(true),m=this._getVisibleMeasures(true);return C.CONFIG.chartTypes.reduce(function(o,e){var i=R.compatible(e,d,m);if(i.compatible){o.available.push({chart:e});}else{var j={};if(i.error.missing.dim){j.Dimension=i.error.missing.dim;}if(i.error.missing.time){j.DateTimeDimension=i.error.missing.time;}if(i.error.missing.msr){j.Measure=i.error.missing.msr;}o.unavailable.push({chart:e,error:j});}return o;},{available:[],unavailable:[]});};I.prototype._getDynamicScaleProp=function(){return{general:{enableScalingFactor:this.getEnableScalingFactor()}};};I.prototype._getEffectiveProperties=function(){var v={'title':{'visible':false}};if(this._bNeedToApplyDefaultProperties){v=jQuery.extend(true,v,this._getDefaultVizProperties());this._bNeedToApplyDefaultProperties=false;}v=jQuery.extend(true,v,this._oSemanticVizSettings.properties||{},this.getProperty("vizProperties"),this._getHostedVizProperties(),this._getPagingVizProperties(),this._getTimeProperties(),this._getValueAxisScaleSetting().property||{},this._getDynamicScaleProp());return v;};I.prototype._setEffectiveScales=function(){var v=this._getVizFrame(),o=this.getProperty('vizScales'),d=this._getValueAxisScaleSetting(),e=(o||[]).filter(function(j){return j.feed==='color';});var i=H.extendScales(o,d.scale||[],this._oSemanticVizSettings.scales||[]);if(this._oSemanticVizSettings.replaceColorScales&&e.length===0){v.setVizScales(i,{replace:true});}else{v.setVizScales(i);}};I.prototype._usingDisplayNameForSemantics=function(v){var d=function(o){if((typeof(o)==='undefined')||(o===null)){return false;}return true;};if(v.plotArea&&v.plotArea.dataPointStyle&&v.plotArea.dataPointStyle.rules){var e=this._getContexts();if(e.length>0&&!e.hasOwnProperty("dataRequested")){var k=this.getVisibleDimensions(),m=v.plotArea.dataPointStyle.rules;for(var i=0;i<m.length;i++){var p=m[i].dataContext;if(p&&p.length!==0){var X=Object.keys(p);if(!d(m[i].displayName)&&X.length===1){var Y=X[0];if(p[Y].hasOwnProperty("equal")&&k.indexOf(Y)!==-1){var Z=this.getDimensionByName(Y).getTextProperty();for(var j=0;j<e.length;j++){if(e[j].getProperty(Y)===p[Y].equal){var $=e[j].getProperty(Z);if(!d(Z)||!d($)||typeof($)==="object"||this.getDimensionByName(Y).getDisplayText()===false){m[i].displayName=p[Y].equal;break;}else{m[i].displayName=$;break;}}}}}}}}}};I.prototype._getCandidateColoringSetting=function(){if(!this._bColoringParsed){if(this._enableSemanticColoring()){this._bColoringParsed=true;this._oCandidateColoringSetting={};var d={},o=this.getColorings(),i=this.getActiveColoring();d.aMsr=this._normalizeDorM(this.getVisibleMeasures());var j=this._getDrillStateTop();var k=[],v;if(j.redundant){var k=Object.keys(j.redundant).filter(function(Y){return Y!=='measureNames';});}v=this._normalizeDorM(this.getVisibleDimensions().concat(k),true);d.aDim=v;d.aInResultDim=this._normalizeDorM(this.getInResultDimensions(),true);d.allMsr=this.getMeasures().map(function(Y){return Y.getName();});d.allDim=this.getDimensions().map(function(Y){return Y.getName();});if(o){try{var m=jQuery.sap.getResourcePath("sap/chart/i18n/i18n.properties");var p=jQuery.sap.resources({url:m});var X={bFiltered:this._bFilterCalledByCustomer};this._oCandidateColoringSetting=w.getCandidateSetting(o,i,this._semanticTuples,d,this._oColoringStatus||{},this._sAdapteredChartType||this.getChartType(),p,X);}catch(e){if(e instanceof x){e.display();}else{throw e;}}}}else{this._oCandidateColoringSetting={};}}return this._oCandidateColoringSetting;};I.prototype._hostedVizProperties={selectionMode:{prop:"interaction.selectability.mode"},selectionBehavior:{prop:"interaction.selectability.behavior"}};I.prototype._getHostedVizProperties=function(){return Object.keys(this._hostedVizProperties).reduce(function(o,p){var d=this._hostedVizProperties[p].prop.split(".").reverse().reduce(function(o,e){var i={};i[e]=o;return i;},this.getProperty(p));return jQuery.extend(true,o,d);}.bind(this),{});};I.prototype._getDefaultVizProperties=function(){var d='info/'+(this._sAdapteredChartType||this.getChartType());var i=(d.indexOf("info/100_")===0);var j=(d==="info/pie"||d==="info/donut");var o={interaction:{extraEventInfo:true}};return jQuery.extend(true,o,v({},d,["valueAxis.label.formatString","valueAxis2.label.formatString"],i?'':z.DefaultPattern.SHORTFLOAT),v({},d,["legend.formatString","sizeLegend.formatString"],z.DefaultPattern.SHORTFLOAT_MFD2),v({},d,["plotArea.dataLabel.formatString"],j?'':z.DefaultPattern.SHORTFLOAT_MFD2),v({},d,["tooltip.formatString"],i?'':z.DefaultPattern.STANDARDFLOAT));function k(e,X,Y){if(X.length===0){return Y;}e=e||{};var p=e[X[0]];e[X[0]]=k(p,X.slice(1),Y);return e;}function m(p,X){if(p==null||X.legnth===0){return p;}var e=p[X[0]];if(e&&e.children){return m(e.children,X.slice(1));}return e;}function v(e,X,Y,Z){var $=sap.viz.api.metadata.Viz.get(X);if($){var _=$.properties;Y.forEach(function(a1){a1=a1.split(".");var p=m(_,a1);if(p&&p.hasOwnProperty("defaultValue")){k(e,a1,Z);}});}return e;}};I.prototype._getPagingVizProperties=function(){if(this._isEnablePaging()){var p={interaction:{zoom:{enablement:false},selectability:{mode:"NONE"}},plotArea:{isFixedDataPointSize:true}};return p;}else{return{};}};I.prototype._getTimeProperties=function(){var d=["year","month","day"];var o=null;var e=this;var i=this.getVisibleDimensions().filter(function(_){var a1=e.getDimensionByName(_);return(a1 instanceof sap.chart.data.TimeDimension&&a1._getFixedRole()==="category");})[0];var j="ISO";var m,k,p;if(i){var v=this.getDimensionByName(i);switch(v.getTimeUnit()){case u.yearmonthday:d=["year","month","day"];break;case u.yearquarter:d=["year","quarter"];break;case u.yearmonth:d=["year","month"];break;case u.yearweek:d=["year","week"];var X=sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale(),Y=L.getInstance(X),p=X.getRegion();m=Y.getMinimalDaysInFirstWeek();k=Y.getFirstDayOfWeek();k=k===0?7:k;j="Gregorian";break;case u.fiscalyear:d=["fiscal_year"];break;case u.fiscalyearperiod:d=["fiscal_period","fiscal_year"];break;default:}o=v.getFiscalYearPeriodCount();}var Z=this.getProperty("vizProperties");if(Z&&Z.timeAxis){var $=Z.timeAxis;if($.levels){d=$.levels;}if($.fiscal&&$.fiscal.periodNumbers){o=$.fiscal.periodNumbers;}}return{"timeAxis":{"levels":d,"fiscal":{"periodNumbers":o},"levelConfig":{"week":{"type":j,"minDays":m,"firstDayOfWeek":k,"region":p}}}};};I.prototype.setSelectionMode=function(v){this.setProperty("selectionMode",v);var o=this._getVizFrame();if(o){o.setVizProperties({interaction:{selectability:{mode:v}}});}return this;};I.prototype.getSelectionMode=function(){var v=this._getVizFrame();if(v){return v.getVizProperties().interaction.selectability.mode;}else{return this.getProperty("selectionMode");}};I.prototype.setSelectionBehavior=function(v){this.setProperty("selectionBehavior",v);var o=this._getVizFrame();if(o){o.setVizProperties({interaction:{selectability:{behavior:v}}});}return this;};I.prototype.setEnableScalingFactor=function(v){this.setProperty("enableScalingFactor",v);this._invalidateBy({source:this,keys:{vizFrame:true}});return this;};I.prototype.getScalingFactor=function(){var v=this._getVizFrame();if(v){var d=v._states()["dynamicScale"];if(d){var e=null;var k=["primaryValues","secondaryValues"];var i=[d.valueAxis,d.valueAxis2];for(var j=0;j<k.length;j++){var m=i[j];if(m&&(m.symbol||m.unit)){e=e||{};var o=k[j];e[o]={scalingFactor:m.symbol};if(m.unit){e[o]["unit"]=m.unit;}}}return e;}}return null;};I.prototype.getSelectionBehavior=function(){var v=this._getVizFrame();if(v){return v.getVizProperties().interaction.selectability.behavior;}else{return this.getProperty("selectionBehavior");}};I.prototype.getDimensionByName=function(e){return this.getDimensions().filter(function(d){return d.getName()===e;})[0];};I.prototype.getMeasureByName=function(d){return this.getMeasures().filter(function(m){return m.getName()===d;})[0];};I.prototype.getTimeDimensions=function(){return this.getDimensions().filter(function(d){return d instanceof T;});};I.prototype._isEnablePaging=function(){this._bMobile=sap.ui.Device.system.tablet||sap.ui.Device.system.phone;var d=this.getEnablePagination()&&this._bIsPagingChartType&&!this._bMobile;return d;};function Q(e){var p=e.getParameters();delete p.id;if(this._isEnablePaging()){this._getPagingController().vizFrameRenderCompleted();}this.fireEvent("renderComplete",p);}function U(e){var p=e.getParameters();delete p.id;this.fireEvent("_zoomDetected",p);}function W(e){var p=e.getParameters();delete p.id;var d=this._getDataset();p.data.forEach(function(i){i.context=d.findContext({"_context_row_number":i.data._context_row_number});});this.fireEvent("_selectionDetails",p);}I.prototype._showLoading=function(d){var $=this.$();if(!$){return;}if(!d){if(this._$loadingIndicator){this._$loadingIndicator.remove();}}else{if(!this._$loadingIndicator){this._$loadingIndicator=this._createLoadingIndicator();}this._updateLoadingIndicator();$.append(this._$loadingIndicator);}this._bLoading=d;};I.prototype._createLoadingIndicator=function(){var $=jQuery(sap.ui.core.BusyIndicatorUtils.getElement());var d=jQuery("<p>").attr("class","loading-text").text("Loading");d.css({"position":"absolute","transform":"translateY(-3em)","width":"100%","text-align":"center"});d.insertBefore($.children()[0]);$.css({opacity:1});return $;};I.prototype._updateLoadingIndicator=function(){var $=this.$();if(!$||!this._$loadingIndicator){return;}var d=this._sAdapteredChartType,e=d==="bar"||d.indexOf("horizontal")!==-1;var i=$.find(".v-plot-bound"),o=$.offset(),p={top:o.top,left:o.left,width:$.width(),height:$.height()};if(i.length){var j=i.offset(),k=i[0].getBoundingClientRect();p.top=j.top-1;p.left=j.left;p.width=k.width+1;if(e){p.height=Math.ceil(k.height+1);}else{p.height=Math.floor(k.height+1);}}this._$loadingIndicator.css(p);var m=this._$loadingIndicator.find(".loading-text");m.css({"top":p.height/2,"font-weight":sap.ui.core.theming.Parameters.get("sapUiChartTitleFontWeight"),"font-size":sap.ui.core.theming.Parameters.get("sapUiChartMainTitleFontSize"),"color":sap.ui.core.theming.Parameters.get("sapUiChartMainTitleFontSize")});this._$loadingIndicator.css({"background-color":sap.ui.core.theming.Parameters.get("sapUiExtraLightBG")});};I.prototype._getRequiredDimensions=function(){var v=this._getVisibleDimensions(),i=this.getInResultDimensions();return this._normalizeDorM(v.concat(i),true);};I.prototype._getRequiredMeasures=function(){return this._getVisibleMeasures(true);};I.prototype.exportToSVGString=function(o){var d="<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"100%\" height=\"100%\"/>",v=this._getVizFrame();if(v){d=v.exportToSVGString(o);}return d;};I.prototype._getPagingController=function(){if(!this._pagingController){this._pagingController=new P(this);}return this._pagingController;};return I;});
