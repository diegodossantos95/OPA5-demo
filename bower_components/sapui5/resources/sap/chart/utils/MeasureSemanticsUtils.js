/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2017 SAP SE. All rights reserved
 */
sap.ui.define(['sap/chart/coloring/ColoringUtils','sap/chart/coloring/ColorPalette','sap/chart/data/MeasureSemantics','sap/chart/coloring/CriticalityType','sap/chart/ChartLog','sap/chart/ColoringType','sap/chart/coloring/criticality/Criticality','sap/chart/utils/ChartUtils'],function(C,c,M,d,f,g,h,j){"use strict";var k=['sapUiChartPaletteQualitativeHue1','sapUiChartPaletteQualitativeHue2','sapUiChartPaletteQualitativeHue3','sapUiChartPaletteQualitativeHue4','sapUiChartPaletteQualitativeHue5','sapUiChartPaletteQualitativeHue6','sapUiChartPaletteQualitativeHue7','sapUiChartPaletteQualitativeHue8','sapUiChartPaletteQualitativeHue9','sapUiChartPaletteQualitativeHue10','sapUiChartPaletteQualitativeHue11'],D=[['sapUiChartPaletteSequentialHue1','sapUiChartPaletteSequentialHue1Light2','sapUiChartPaletteSequentialHue1Dark1'],['sapUiChartPaletteSequentialHue2','sapUiChartPaletteSequentialHue2Light2','sapUiChartPaletteSequentialHue2Dark1']],S='sapUiChartPaletteSequentialNeutralDark2',l='sapUiChartPaletteSemanticNeutral',L={actual:'solid',projected:'dash',reference:'dot'},P={projected:'diagonalLightStripe',reference:'noFill'};var m=[d.Positive,d.Neutral,d.Critical,d.Negative];function r(a){var R={};if(a.getSemanticallyRelatedMeasures){var b=a.getSemanticallyRelatedMeasures();if(b){if(b.projectedValueMeasure){R.projected=b.projectedValueMeasure;}if(b.referenceValueMeasure){R.reference=b.referenceValueMeasure;}return R;}}return R;}function n(a,I){var b=a.reduce(function(b,e){b[e.getName()]={msr:e,sem:(e.getSemantics&&e.getSemantics())||"actual",rel:r(e)};return b;},{});jQuery.each(b,function(z,A){if(A.sem==="actual"){jQuery.each(A.rel,function(B,T){if(b[T]&&b[T].sem!==B){delete A.rel[B];var E=new f("error","Semantic Pattern",T+" shouldn't be used as "+B+" in semantic relation. ");E.display();}});}});if(I){for(var i=0;i<I.length;i++){var e=I[i];var R=r(e);if(R.projected&&R.reference&&b[R.projected]&&b[R.reference]){b[R.projected]={msr:e,sem:'projected',rel:{reference:R.reference}};}}}return b;}function o(e,i,z){var T=[],A=0,B;jQuery.each(e.slice().sort(function(a,b){var E=i[a.getName()].sem,F=i[b.getName()].sem;if(E<F){return-1;}else if(E>F){return 1;}else{return e.indexOf(a)-e.indexOf(b);}}),function(a,b){var N=b.getName();if(!i[N]){return;}var E=i[N];var F={};var G;F[z?'actual':E.sem]=N;if(b.getLabel){G=b.getLabel();if(G){F.labels={};F.labels[E.sem]=G;}}F.index=A++;if(!z&&(E.sem==="actual"||E.sem==="projected")){if(E.rel.projected){if(i[E.rel.projected]){F.projected=E.rel.projected;if(i[E.rel.projected].msr.getLabel){G=i[E.rel.projected].msr.getLabel();if(G){F.labels=jQuery.extend(true,F.labels,{projected:G});}}delete i[E.rel.projected];}else{B=new f('error','Semantic Pattern',E.msr.getName()+' has an invalid projected semantic relation.');B.display();}}if(E.rel.reference){if(i[E.rel.reference]){F.reference=E.rel.reference;if(i[E.rel.reference].msr.getLabel){G=i[E.rel.reference].msr.getLabel();if(G){F.labels=jQuery.extend(true,F.labels,{reference:G});}}delete i[E.rel.reference];}else{B=new f('error','Semantic Pattern',E.msr.getName()+' has an invalid reference semantic relation.');B.display();}}delete i[N];}F.order=[M.Actual,M.Projected,M.Reference];T.push(F);});return T;}var p=function(a,b){if(!a.dataPointStyle){a=jQuery.extend(true,a,{"dataPointStyle":{"rules":[],others:null}});}a.dataPointStyle.rules.push(b);};var q=function(a,i,b){var e,z;if(a.indexOf('dual')===-1){z=k;e=k.length;}else{var A=(b==='valueAxis')?0:1;z=D[A];e=z.length;}return{actual:z[i%e],projected:z[i%e],reference:z[i%e]};};var s=function(T,a,b){if(T.projectedValueStartTime&&T.timeAxis&&a!==M.Reference){b=b||function(){return true;};var i=function(e){return e.hasOwnProperty(T.semanticMsrName);};if(a===M.Actual){return function(e){return b(e)&&i(e)&&(new Date(e[T.timeAxis]).getTime()<T.projectedValueStartTime);};}else if(a===M.Projected){return function(e){return b(e)&&i(e)&&(new Date(e[T.timeAxis]).getTime()>=T.projectedValueStartTime);};}}else{b=b||function(e){return e.hasOwnProperty(T[a]);};return b;}};var t=function(T,a,b,e){var i,z;if(a){if(T.iUnMentionedIndex==undefined){z=l;}else{i=C.assignUnmentionedColor(c.CRITICALITY.Neutral,e.unMentionedTuplesNumber);z=i[T.iUnMentionedIndex];}}else{if(b===M.Reference&&e.hasSingleReference){z=S;}else{i=q(e.chartType,T.index,T.valueAxisID);z=i[b];}}return z;};var u=function(T,a,b,e,i){var z,A,B={},E;var F=T[b];var G;(a||[]).forEach(function(J){if(J.parsed.msr&&J.parsed.msr.getName()===F){A=J.parsed;G=J.type;}});var H=(T.labels&&T.labels[b])?T.labels[b]:F;if(T.semanticMsrName&&(b===M.Actual||b===M.Projected)){B[T.semanticMsrName]=H;}if(A){m.forEach(function(J){var K=A.callbacks[J];if(K){var I=s(T,b,K[0]);z=C.assignColor(c.CRITICALITY[J],K.length)[0];E={"color":z,"pattern":P[b]};if(j.CONFIG.lineChartType.indexOf(i.chartType)>-1){E.lineType=L[b];if(G==='Static'){E.lineColor=z;}}p(e,{"callback":I,"properties":E,"displayName":A.legend[J],"dataName":B});}});}else{if(!a||a.bShowUnmentionedMsr){var I=s(T,b);z=t(T,a,b,i);E={'color':z,"pattern":P[b]};if(j.CONFIG.lineChartType.indexOf(i.chartType)>-1){E.lineType=L[b];E.lineColor=z;}p(e,{"callback":I,"properties":E,"displayName":H,"dataName":B});}}};var v=function(a){return a.reference&&(!(a.actual||a.projected));};var w=function(T,a,b,e){var i=(T.filter(function(z){return z.reference;}).length===1);var U=T.filter(function(z){return z.hasOwnProperty('iUnMentionedIndex');}).length;T.forEach(function(z){z.order.forEach(function(A){var N=true;if(e.indexOf('bullet')>-1){N=(A!==M.Reference||v(z));}if(z.hasOwnProperty(A)&&N){var B={chartType:e,hasSingleReference:i,unMentionedTuplesNumber:U};u(z,a,A,b,B);}});});};var x=function(a,b,i,E,z,A){i=i||{};var B=(i.type===g.Criticality&&i.subType==="MeasureValues"&&!(i.qualifiedSettings&&i.qualifiedSettings.bMBC));var F={};if(!z){F.plotArea={dataPointStyle:null};}if(!A){F.legend={title:{text:null,visible:a.indexOf('waterfall')>-1?true:false}};}var G,H=true;if((E&&y(b))||B){var I=B?i.qualifiedSettings:null;w(b,I,F.plotArea,a);jQuery.extend(true,F.legend,h.getLegendProps(I));}else if(i.ruleGenerator){try{var J=i.ruleGenerator();jQuery.extend(true,F,J.properties);G=J.colorScale;}catch(e){if(e instanceof f){e.display();}else{throw e;}}}if(G){H=false;}return{properties:F,scales:G?[G]:[],replaceColorScales:H};};function y(T){if(T){return T.some(function(a){return a.hasOwnProperty(M.Projected)||a.hasOwnProperty(M.Reference);});}return false;}return{getTuples:function(a,i,b){return o(a,n(a,i),b);},getSemanticVizSettings:x,hasSemanticRelation:y};});
