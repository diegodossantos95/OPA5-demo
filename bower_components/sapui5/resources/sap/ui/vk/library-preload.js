sap.ui.predefine('sap/ui/vk/DockContainer',["jquery.sap.global","./library","sap/ui/core/Control"],function(q,l,C){"use strict";
var D=C.extend("sap.ui.vk.DockContainer",{
metadata:{library:"sap.ui.vk",publicMethods:["getMinimumWidth","getMinimumHeight","setOrientation","getOrientation","removeChild","addChild","resize","getSplitterPosition","setSplitterPosition","update"],properties:{},events:{dock:{parameters:{pane:{type:"object"}}},undock:{parameters:{pane:{type:"object"}}}}},
constructor:function(d,p,i){if(typeof D._counter=="undefined"){D._counter=0;}this._id="DockContainer_"+D._counter;D._counter++;var x=0,y=0,w=d._elem.offsetWidth,h=d._elem.offsetHeight;if(p){w=p._elem.offsetWidth;h=p._elem.offsetHeight;}var e=document.createElement("div");e.setAttribute("id",this._id);e.style.position="absolute";e.style.left=x+"px";e.style.top=y+"px";e.style.width=w+"px";e.style.height=h+"px";e.style.backgroundColor="blue";e.style.zIndex=30;var s=document.createElement("div");s.setAttribute("id",this._id+"_splitter");s.style.position="absolute";s.style.opacity=0;s.style.backgroundColor="blue";s.style.zIndex=60;s.style.visibility="hidden";this._elem=e;this._splitter=s;this._manager=d;this._parent=p;this._left=null;this._right=null;this._dir=0;this._elem.appendChild(this._splitter);d.addDockContainer(p,this,i);}
});
D.prototype._setRect=function(e,x,y,w,h){e.style.left=x+"px";e.style.top=y+"px";if(w!=null){e.style.width=w+"px";}if(h!=null){e.style.height=h+"px";}};
D.prototype.getMinimumWidth=function(){var w=0;if(this._left!=null){w=this._left.getMinimumWidth();}if(this._right!=null){var a=this._right.getMinimumWidth();if(this._dir==0){if(w>a){w=a;}}else{w+=a;}}return w;};
D.prototype.getMinimumHeight=function(){var h=0;if(this._left!=null){h=this._left.getMinimumHeight();}if(this._right!=null){var a=this._right.getMinimumHeight();if(this._dir==1){if(h>a){h=a;}}else{h+=a;}}return h;};
D.prototype.setOrientation=function(d){this._dir=d;this.update();};
D.prototype.getOrientation=function(){return this._dir;};
D.prototype.removeChild=function(i){if(i==1&&this._right!=null){this._elem.removeChild(this._right._elem);this._right=null;}else if(i==0){if(this._right!=null){this._elem.removeChild(this._left._elem);this._left=this._right;this._right=null;}else{this._elem.removeChild(this._left._elem);this._right=null;}}this.update();};
D.prototype.addChild=function(c,i){if(this._left==null){i=0;}if(i==0){if(this._left!=null){this._right=this._left;}this._left=c;}else if(i==1){this._right=c;}else{return;}c._parent=this;c.update();this._elem.appendChild(c._elem);this.update();};
D.prototype.resize=function(w,h,s){this._elem.style.width=w+"px";this._elem.style.height=h+"px";if(this._left!=null&&this._right!=null){var o,a,m,b,n,c;if(this._dir==0){o=this._left._elem.offsetHeight;a=this._right._elem.offsetHeight;m=this._left.getMinimumHeight();b=this._right.getMinimumHeight();n=(s!=null)?s:h*o/(o+a);if(n<m){n=m;}c=h-n;if(c<b){c=b;n=h-c;}this._left.resize(w,n);this._right.resize(w,c);this._setRect(this._left._elem,0,0);this._setRect(this._right._elem,0,n);this._setRect(this._splitter,0,n-6,w,12);this._splitter.style.cursor="ns-resize";}else{o=this._left._elem.offsetWidth;a=this._right._elem.offsetWidth;m=this._left.getMinimumWidth();b=this._right.getMinimumWidth();n=(s!=null)?s:w*o/(o+a);if(n<m){n=m;}c=w-n;if(c<b){c=b;n=w-c;}this._left.resize(n,h);this._right.resize(c,h);this._setRect(this._left._elem,0,0);this._setRect(this._right._elem,n,0);this._setRect(this._splitter,n-6,0,12,w);this._splitter.style.cursor="ew-resize";}this._splitter.style.visibility="visible";}else if(this._left!=null){this._left.resize(w,h);this._left._elem.style.left=0;this._left._elem.style.top=0;this._splitter.style.visibility="hidden";}else{this._splitter.style.visibility="hidden";}};
D.prototype.getSplitterPosition=function(){return(this._dir==0)?this._splitter.offsetTop+6:this._splitter.offsetLeft+6;};
D.prototype.setSplitterPosition=function(p){this.resize(this._elem.offsetWidth,this._elem.offsetHeight,p);};
D.prototype.update=function(){this.resize(this._elem.offsetWidth,this._elem.offsetHeight);};
return D;},true);
sap.ui.predefine('sap/ui/vk/DockManager',["jquery.sap.global","./library","sap/ui/core/Control","./DockContainer","./DockPane","./Loco","sap/ui/core/ResizeHandler"],function(q,l,C,D,a,L,R){"use strict";
var b=C.extend("sap.ui.vk.DockManager",{metadata:{library:"sap.ui.vk",publicMethods:["getDomElement","addDockPane","removeDockPane","addDockContainer","removeDockContainer","dock","undock","bringToFront","beginGesture","move","endGesture","resize"],properties:{width:{type:"sap.ui.core.CSSSize",defaultValue:"auto"},height:{type:"sap.ui.core.CSSSize",defaultValue:"auto"}}}});
b.prototype.init=function(){if(typeof b._counter=="undefined"){b._counter=0;}this._id="DockManager_"+b._counter;b._counter++;var e=document.createElement("div");e.setAttribute("id",this._id);e.style.width="100%";e.style.height="100%";e.style.overflow="hidden";e.style.position="relative";e.style.backgroundColor="blue";this._elem=e;this._root=null;this._panes=[];this._containers=[];this._dockIcons=null;this._gesture=false;this._oPane=null;this._oParent=null;this._oDir=null;this._oContainer=null;this._oResize=null;this._oResizeDir=0;this._oIsTab=false;this._rendered=false;this._loco=new L();this._loco.addHandler(this);};
b.prototype.exit=function(){this._loco.removeHandler(this._viewportHandler);if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}};
b.prototype.isRendered=function(){return this._rendered;};
b.prototype.alwaysOnTop=function(){this._loco=new L();this._loco.removeHandler(this);this._loco.addHandler(this);};
b.prototype.onBeforeRendering=function(){if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}this._rendered=false;};
b.prototype.onAfterRendering=function(){var d=document.getElementById(this.getId());d.appendChild(this._elem);this._resizeListenerId=R.register(this,this._handleResize.bind(this));this._handleResize({size:{width:d.clientWidth,height:d.clientHeight}});this._rendered=true;var c=this._panes.length;for(var i=0;i<c;i++){this._panes[i].renderContent();}};
b.prototype._handleResize=function(e){this.resize(e.size.width,e.size.height);};
b.prototype._setRect=function(e,x,y,w,h){e.style.left=x+"px";e.style.top=y+"px";if(w!=null){e.style.width=w+"px";}if(h!=null){e.style.height=h+"px";}};
b.prototype.getDomElement=function(){return this._elem;};
b.prototype._getBounding=function(o,c){var d=o.getBoundingClientRect();var p={x:d.left,y:d.top,w:o.offsetWidth,h:o.offsetHeight};if(c!==undefined){var r=c.getBoundingClientRect();p.x-=r.left;p.y-=r.top;}return p;};
b.prototype._isInside=function(c,x,y){return(x>=c.x&&x<=c.x+c.w&&y>=c.y&&y<=c.y+c.h);};
b.prototype._createDockIcon=function(i,x,y,h){var d=document.createElement("div");d.setAttribute("id",this._id+"_dockIcon_"+i);d.style.position="absolute";this._setRect(d,x,y,48,48);d.style.backgroundColor="white";d.style.border="1px solid darkgrey";d.style.opacity=0.9;d.style.cursor="default";d.style.zIndex=100;d.pointerEvents="none";if(h){d.style.display="none";}this._dockIcons.push(d);this._elem.appendChild(d);};
b.prototype._showDockIconsAt=function(e,c,h,d){var p=this._getBounding(e,this._elem);if(c){var f={x:p.x+p.w/2-24,y:p.y+p.h/2-24};if(f.x<110){f.x=110;}else if(f.x>this._elem.offsetWidth-158){f.x=this._elem.offsetWidth-158;}if(f.y<110){f.y=110;}else if(f.y>this._elem.offsetHeight-158){f.y=this._elem.offsetHeight-158;}this._createDockIcon("center",f.x,f.y,h);this._createDockIcon("top",f.x,f.y-49,d);this._createDockIcon("right",f.x+49,f.y,d);this._createDockIcon("bottom",f.x,f.y+49,d);this._createDockIcon("left",f.x-49,f.y,d);}else{this._createDockIcon("root_top",p.x+p.w/2-24,p.y+8);this._createDockIcon("root_right",p.x+p.w-48-8,p.y+p.h/2-24);this._createDockIcon("root_bottom",p.x+p.w/2-24,p.y+p.h-48-8);this._createDockIcon("root_left",p.x+8,p.y+p.h/2-24);}};
b.prototype._showDockShadow=function(e,d){var c=this._dockShadow;if(c==null){c=document.createElement("div");c.setAttribute("id",this._id+"_dockShadow");c.style.position="absolute";c.style.backgroundColor="blue";c.style.opacity=0.3;c.style.zIndex=90;c.style.cursor="default";c.pointerEvents="none";this._elem.appendChild(c);this._dockShadow=c;}var p=e?this._getBounding(e,this._elem):{};var w=(p.w>480)?240:(p.w/2);var h=(p.h>320)?160:(p.h/2);switch(d){case 0:this._setRect(c,p.x,p.y,p.w,p.h);break;case 1:this._setRect(c,p.x,p.y,p.w,h);break;case 2:this._setRect(c,p.x+(p.w-w),p.y,w,p.h);break;case 3:this._setRect(c,p.x,p.y+p.h-h,p.w,h);break;case 4:this._setRect(c,p.x,p.y,w,p.h);break;default:c.style.visibility="hidden";return;}c.style.visibility="visible";};
b.prototype._showDockIcons=function(s){if(s){if(this._dockIcons==null||this._dockParent!=this._dockParentCurr){this._showDockIcons(false);this._dockIcons=[];this._showDockIconsAt(this._elem);if(this._dockParent!=null&&this._containers.length>1){this._showDockIconsAt(this._dockParent._elem,true,!this._dockParent._movable,this._dockParent._parent==null);}this._dockParentCurr=this._dockParent;}}else if(!s&&this._dockIcons!=null){for(var i in this._dockIcons){this._elem.removeChild(this._dockIcons[i]);}this._dockIcons=null;}};
b.prototype.addDockPane=function(d){this._panes.push(d);this._elem.appendChild(d._elem);this._updateZIndex();};
b.prototype.removeDockPane=function(d){var i=this._panes.indexOf(d);if(i>-1){this._panes.splice(i,1);this._elem.removeChild(d._elem);}else{q.sap.log.error("DockManager.removeDockPane failed, element does not exist - "+d._id);}this._updateZIndex();};
b.prototype.addDockContainer=function(p,d,i){this._containers.push(d);if(p){if(p._left!=null){var o;if(i==0){o=p._left;d._elem.style.width=o._elem.offsetWidth+"px";d._elem.style.height=o._elem.offsetHeight+"px";p._elem.removeChild(o._elem);if(p._right){p._elem.insertBefore(d._elem,p._right._elem);}else{p._elem.appendChild(d._elem);}p._left=d;o._parent=d;d._left=o;d._elem.appendChild(o._elem);}else if(i==1){o=p._right;d._elem.style.width=o._elem.offsetWidth+"px";d._elem.style.height=o._elem.offsetHeight+"px";p._elem.removeChild(o._elem);p._elem.appendChild(d._elem);p._right=d;o._parent=d;d._left=o;d._elem.appendChild(o._elem);}p.update();}else{p.addChild(d,0);}}else{this._root=d;this._elem.appendChild(d._elem);d.resize(this._elem.offsetWidth,this._elem.offsetHeight);}};
b.prototype.removeDockContainer=function(d){var i=this._containers.indexOf(d);if(i>-1){this._containers.splice(i,1);}else{q.sap.log.error("DockManager.removeDockContainer failed, element does not exist - "+d._id);}};
b.prototype._dock=function(d,c,e){if(d._parent!=null){this.undock(d);}var i=0;if(e==2||e==3){i=1;}d._parent=c;if(d._saveSize){d._saveSize();}c.setOrientation((e==1||e==3)?0:1);c.addChild(d,i);};
b.prototype.dock=function(d,p,c){if(d._parent!=null){this.undock(d);}if(p==null){var o=this._root;this._elem.removeChild(o._elem);p=new D(this,null);this._dock(o,p,1);this._dock(d,p,c);}else if(c==0){p.addTab(d);}else{var e=p._parent;var i=(e._left==p)?0:1;var f=new D(this,e,i);this._dock(d,f,c);}};
b.prototype.undock=function(d,i){if(d._tabParent!=null){d._tabParent.removeTab(d);return;}else if(i&&d._tabs.length>0){d.removeTab(d);return;}var p=d._parent;if(p==null){q.sap.log.error("DockManager::undock: cannot undock a floating DockPane - "+d._id);return;}if(p._left&&p._right){var o=null;if(p._left==d){o=p._right;}else if(p._right==d){o=p._left;}else{q.sap.log.error("DockManager::undock: internal error, tree mis-match - "+this._id);}p.removeChild(1);p.removeChild(0);var c=p._parent;if(c){if(c._left==p){c._elem.removeChild(p._elem);if(c._right){c._elem.insertBefore(o._elem,c._right._elem);}else{c._elem.appendChild(o._elem);}c._left=o;o._parent=c;}else if(c._right==p){c._elem.removeChild(p._elem);c._elem.appendChild(o._elem);c._right=o;o._parent=c;}c.update();}else if(this._root==p){this._elem.removeChild(p._elem);this._elem.appendChild(o._elem);this._root=o;o._parent=null;o._elem.style.left=0;o._elem.style.top=0;o.resize(this._elem.offsetWidth,this._elem.offsetHeight);o.update();}this.removeDockContainer(p);d._parent=null;this._elem.appendChild(d._elem);d._restoreSize();d.update();}};
b.prototype.bringToFront=function(d){if(d._parent==null){var i=this._panes.indexOf(d);if(i>-1){this._panes.splice(i,1);this._panes.push(d);this._updateZIndex();}}};
b.prototype._updateZIndex=function(){var c=this._panes.length;for(var i=0;i<c;i++){this._panes[i]._elem.style.zIndex=50+i;}};
b.prototype._tabBoxGesture=function(d,e){if(d._tabs.length>0){var t=this._getBounding(d._tabBox);if(this._isInside(t,e.x,e.y)){var c=d._tabs.length+1;var i=Math.floor((e.x-t.x)/(d._elem.offsetWidth-2)*c);if(i>d._tabs.length){i=d._tabs.length;}var f=(i==0)?d:d._tabs[i-1];d.bringTabToFront(f);this._oPane=f;this._snapX=this._ox;this._snapY=this._oy;this._snapRect=this._getBounding(d._elem);return true;}}return false;};
b.prototype.beginGesture=function(c){var e=c;if(e.n==1&&!this._gesture){this._ox=e.x;this._oy=e.y;this._oIsTab=false;if(this._isInside(this._getBounding(this._elem),e.x,e.y)){this._dockParent=null;var i,d;for(i=this._panes.length-1;i>=0;i--){d=this._panes[i];if(d._parent!=null&&this._isInside(this._getBounding(d._elem),e.x,e.y)){this._dockParent=d;break;}}var f=false;for(i=this._panes.length-1;i>=0;i--){d=this._panes[i];if(d._parent==null&&d._movable){var g=this._getBounding(d._elem);if(this._isInside(g,e.x,e.y)){this.bringToFront(d);var h={x:g.x+8,y:g.y+8,w:g.w-16,h:g.h-16};if(!this._isInside(h,e.x,e.y)){this._oResize=d;if(e.x<=h.x){if(e.y<=h.y){this._oResizeDir=5;}else if(e.y>=h.y+h.h){this._oResizeDir=8;}else{this._oResizeDir=4;}}else if(e.x>=h.x+h.w){if(e.y<=h.y){this._oResizeDir=6;}else if(e.y>=h.y+h.h){this._oResizeDir=7;}else{this._oResizeDir=2;}}else if(e.y<=h.y){this._oResizeDir=1;}else if(e.y>=h.y+h.h){this._oResizeDir=3;}else{this._oResizeDir=0;}f=true;break;}if(this._isInside(this._getBounding(d._title),e.x,e.y)){if(this._isInside(this._getBounding(d._btnClose),e.x,e.y)){f=true;d.close();}else{f=true;this._oPane=d;this._showDockIcons(true);}break;}this._oIsTab=this._tabBoxGesture(d,e);if(this._oIsTab){f=true;}break;}}}if(!f){for(i=0;i<this._containers.length;i++){var j=this._containers[i];if(j._right!=null&&this._isInside(this._getBounding(j._splitter),e.x,e.y)){this._oContainer=j;this._oContainer._splitter.style.opacity=0.3;this._snapX=this._ox;this._snapY=this._oy;f=true;break;}}}if(!f){for(i=this._panes.length-1;i>=0;i--){d=this._panes[i];if(d._parent!=null&&d._movable&&this._isInside(this._getBounding(d._title),e.x,e.y)){if(this._isInside(this._getBounding(d._btnClose),e.x,e.y)){d.close();}else{this._oPane=d;this._snapX=this._ox;this._snapY=this._oy;this._snapRect=this._getBounding(d._elem);}f=true;break;}this._oIsTab=this._tabBoxGesture(d,e);if(this._oIsTab){f=true;break;}}}c.handled=f;this._gesture=f;}}};
b.prototype.move=function(c){var e=c;if(e.n==1&&this._gesture){var d=e.x-this._ox;var f=e.y-this._oy;this._ox=e.x;this._oy=e.y;var g,x,y;if(this._oResize){g=this._oResize;var o=this._oResizeDir;x=g._elem.offsetLeft;y=g._elem.offsetTop;var w=g._elem.offsetWidth;var h=g._elem.offsetHeight;var m=g.getMinimumWidth();var j=g.getMinimumHeight();switch(o){case 1:if(h-f>=j){g._elem.style.top=(y+f)+"px";g.resize(w,h-f);}break;case 2:if(w+d>=m){g.resize(w+d,h);}break;case 3:if(h+f>=j){g.resize(w,h+f);}break;case 4:if(w-d>=m){g._elem.style.left=(x+d)+"px";g.resize(w-d,h);}break;case 5:if(w-d>=m&&h-f>=j){g._elem.style.top=(y+f)+"px";g._elem.style.left=(x+d)+"px";g.resize(w-d,h-f);}else if(w-d>m){g._elem.style.left=(x+d)+"px";g.resize(w-d,h);}else if(h-f>j){g._elem.style.top=(y+f)+"px";g.resize(w,h-f);}break;case 6:if(w+d>=m&&h-f>=j){g._elem.style.top=(y+f)+"px";g.resize(w+d,h-f);}else if(w+d>=m){g.resize(w+d,h);}else if(h-f>=j){g._elem.style.top=(y+f)+"px";g.resize(w,h-f);}break;case 7:if(w+d>=m&&h+f>=j){g.resize(w+d,h+f);}else if(w+d>=m){g.resize(w+d,h);}else if(h+f>=j){g.resize(w,h+f);}break;case 8:if(w-d>=m&&h+f>=j){g._elem.style.left=(x+d)+"px";g.resize(w-d,h+f);}else if(w-d>=m){g._elem.style.left=(x+d)+"px";g.resize(w-d,h);}else if(h+f>=j){g.resize(w,h+f);}break;default:break;}return;}this._dockParent=null;var i;for(i=this._panes.length-1;i>=0;i--){g=this._panes[i];if(g._parent!=null&&g!=this._oPane&&this._isInside(this._getBounding(g._elem),e.x,e.y)){this._dockParent=g;break;}}if(this._dockIcons!=null){this._showDockIcons(true);}g=this._oPane;if(g){if(g._parent==null&&g._tabParent==null&&!(this._oIsTab&&g._tabs.length>0)){x=g._elem.offsetLeft+d;y=g._elem.offsetTop+f;g._elem.style.left=x+"px";g._elem.style.top=y+"px";}else if(Math.abs(this._snapX-e.x)>16||Math.abs(this._snapY-e.y)>16){var s=(g._tabParent!=null||this._oIsTab);this.undock(g,this._oIsTab);var p=this._getBounding(this._elem);var n=this._snapRect.x-(this._snapX-e.x)-16-p.x;var k=this._snapRect.y-(this._snapY-e.y)-16-p.y;var r=this._snapRect.x+this._snapRect.w/2-e.x;g._elem.style.left=(n+(this._snapRect.w-g._elem.offsetWidth)/2-r)+"px";if(s){g._elem.style.top=(k+this._snapRect.h-24)+"px";}else{g._elem.style.top=k+"px";}this.bringToFront(g);this._showDockIcons(true);}}var t=this._oContainer;if(t){x=t.getSplitterPosition();if(t.getOrientation()==0){x+=f;}else{x+=d;}t.setSplitterPosition(x);}this._oParent=null;this._oDir=-1;if(this._dockIcons!=null){var u=null;var v=-1;for(i=0;i<this._dockIcons.length;i++){var z=this._dockIcons[i];var A=this._getBounding(z);if(this._isInside(A,e.x,e.y)){if(i<4){u=this._elem;v=i+1;this._oParent=null;this._oDir=v;}else if(i>=4&&this._dockParent!=null){u=this._dockParent._elem;v=i-4;this._oParent=this._dockParent;this._oDir=v;}break;}}this._showDockShadow(u,v);}else{this._showDockShadow(null,-1);}c.handled=true;}};
b.prototype.endGesture=function(e){if(this._dockIcons!=null&&this._oPane!=null&&this._oDir>-1){this.dock(this._oPane,this._oParent,this._oDir);e.handled=true;}if(this._oContainer!=null){this._oContainer._splitter.style.opacity=0;e.handled=true;}var t=this._oResize?this._oResize:this._oPane;if(t){var c=t._elem;if(c.offsetTop<-8){c.style.top="-8px";}else if(c.offsetTop>this._elem.offsetHeight-8){c.style.top=(this._elem.offsetHeight-8)+"px";}if(c.offsetLeft+c.offsetWidth<32){c.style.left=(-c.offsetWidth+32)+"px";}else if(c.offsetLeft>this._elem.offsetWidth-32){c.style.left=(this._elem.offsetWidth-32)+"px";}e.handled=true;}this._oContainer=null;this._oPane=null;this._oParent=null;this._oDir=-1;this._showDockIcons(false);this._showDockShadow(this._elem,-1);this._gesture=false;this._oResize=null;};
b.prototype.click=function(e){};
b.prototype.doubleClick=function(e){};
b.prototype.contextMenu=function(e){};
b.prototype.getViewport=function(){return this;};
b.prototype.getId=function(){return this._id;};
b.prototype.resize=function(w,h){if(this._root){this._root.resize(w,h);}};
return b;},true);
sap.ui.predefine('sap/ui/vk/DockPane',["jquery.sap.global","./library","sap/ui/core/Control","./DockContainer"],function(q,l,C,D){"use strict";
var a=C.extend("sap.ui.vk.DockPane",{
metadata:{library:"sap.ui.vk",publicMethods:["getDomElement","setMinimumWidth","getMinimumWidth","setMinimumHeight","getMinimumHeight","setMinimumSize","close","resize","update","addTab","removeTab","bringTabToFront"],properties:{width:{type:"sap.ui.core.CSSSize",defaultValue:"auto"},height:{type:"sap.ui.core.CSSSize",defaultValue:"auto"}},events:{size:{parameters:{newSize:{type:"object"}}},close:{}},aggregations:{content:{type:"sap.ui.core.Control",multiple:false,singularName:"content"}}},
constructor:function(d,x,y,w,h,t,f){C.apply(this);if(typeof a._counter=="undefined"){a._counter=0;}this._id="DockPane_"+a._counter;a._counter++;var e=document.createElement("div");e.setAttribute("id",this._id);e.style.position="absolute";e.style.left=x+"px";e.style.top=y+"px";e.style.width=w+"px";e.style.height=h+"px";e.style.backgroundColor="darkgrey";e.style.zIndex=50;e.style.overflow="hidden";this._elem=e;this._manager=d;this._parent=null;this._movable=(f===undefined||f==false)?true:false;this._minWidth=64;this._minHeight=64;this._width=w;this._height=h;this._resizable=true;this._text=(t!=null)?t:(""+this._id);this._tabs=[];this._activeTab=this;this._tabParent=null;this._telem=[];this._tcontent=[];this._hasBorder=false;this._hasTabs=false;if(this._movable){t=document.createElement("div");t.setAttribute("id",this._id+"_title");t.style.position="absolute";t.style.left=0;t.style.top=0;t.style.width="100%";t.style.height="25px";t.style.boxSizing="border-box";t.style.padding="3px 4px";t.style.backgroundColor="black";t.style.color="white";t.style.cursor="default";t.style.userSelect="none";t.style.overflow="hidden";t.innerHTML=this._text;e.appendChild(t);this._title=t;var b=document.createElement("div");b.setAttribute("id",this._id+"_close");b.style.position="absolute";b.style.right="4px";b.style.top="4px";b.style.width="18px";b.style.height="18px";b.style.backgroundColor="red";b.style.opacity=0.5;b.style.textAlign="center";b.innerHTML="X";this._title.appendChild(b);this._btnClose=b;var c=document.createElement("div");c.setAttribute("id",this._id+"_border");c.style.position="absolute";c.style.left=0;c.style.top=0;c.style.width="100%";c.style.height="100%";c.style.boxSizing="border-box";c.style.zIndex=10;c.style.pointerEvents="none";this._border=c;var r=document.createElement("div");r.style.position="absolute";r.style.left="8px";r.style.top=0;r.style.right="8px";r.style.height="8px";r.style.cursor="ns-resize";c.appendChild(r);var g=document.createElement("div");g.style.position="absolute";g.style.left="8px";g.style.bottom=0;g.style.right="8px";g.style.height="8px";g.style.cursor="ns-resize";c.appendChild(g);var i=document.createElement("div");i.style.position="absolute";i.style.left=0;i.style.top="8px";i.style.width="8px";i.style.bottom="8px";i.style.cursor="ew-resize";c.appendChild(i);var j=document.createElement("div");j.style.position="absolute";j.style.right=0;j.style.top="8px";j.style.width="8px";j.style.bottom="8px";j.style.cursor="ew-resize";c.appendChild(j);var k=document.createElement("div");k.style.position="absolute";k.style.left=0;k.style.top=0;k.style.width="8px";k.style.height="8px";k.style.cursor="nwse-resize";c.appendChild(k);var m=document.createElement("div");m.style.position="absolute";m.style.right=0;m.style.top=0;m.style.width="8px";m.style.height="8px";m.style.cursor="nesw-resize";c.appendChild(m);var n=document.createElement("div");n.style.position="absolute";n.style.left=0;n.style.bottom=0;n.style.width="8px";n.style.height="8px";n.style.cursor="nesw-resize";c.appendChild(n);var o=document.createElement("div");o.style.position="absolute";o.style.right=0;o.style.bottom=0;o.style.width="8px";o.style.height="8px";o.style.cursor="nwse-resize";c.appendChild(o);}var p=document.createElement("div");p.setAttribute("id",this._id+"_tabbox");p.style.position="absolute";p.style.left=0;p.style.right=0;p.style.bottom=0;p.style.height="24px";p.style.overflow="hidden";this._tabBox=p;var s=document.createElement("div");s.setAttribute("id",this._id+"_content");s.style.position="absolute";s.style.left=0;s.style.top=this._movable?"25px":"0";s.style.right=0;s.style.bottom=0;s.style.boxSizing="border-box";s.style.backgroundColor=this._movable?"lightgrey":"grey";s.style.border="1px solid darkgrey";s.style.overflow="hidden";e.appendChild(s);this._content=s;this.update();d.addDockPane(this);}
});
a.prototype.setContent=function(c){this.setAggregation("content",c);this.renderContent();};
a.prototype.renderContent=function(){if(this._manager.isRendered()){var c=this.getAggregation("content");if(c!=null){sap.ui.getCore().getRenderManager().render(c,this._content);}}};
a.prototype.destroy=function(){this._manager.removeDockPane(this);};
a.prototype.getDomElement=function(){return this._elem;};
a.prototype.setMinimumWidth=function(w){this._minWidth=w;if(this._parent!=null){this._parent.update();}else{this.update();}};
a.prototype.getMinimumWidth=function(){return this._minWidth;};
a.prototype.setMinimumHeight=function(h){this._minHeight=h;if(this._parent!=null){this._parent.update();}else{this.update();}};
a.prototype.getMinimumHeight=function(){return this._minHeight;};
a.prototype.setMinimumSize=function(w,h){this._minWidth=w;this._minHeight=h;if(this._parent!=null){this._parent.update();}else{this.update();}};
a.prototype.close=function(){if(this._parent!=null){this._manager.undock(this);}this._manager.removeDockPane(this);};
a.prototype._saveSize=function(){this._floatW=this._elem.offsetWidth;this._floatH=this._elem.offsetHeight;};
a.prototype._restoreSize=function(){this.resize(this._floatW,this._floatH);};
a.prototype.resize=function(w,h){this._elem.style.width=w+"px";this._elem.style.height=h+"px";this._updateTabs(w);};
a.prototype.update=function(){if(this._parent==null){this._elem.style.boxShadow="2px 6px 20px 3px rgba(0,0,0,0.5)";this._elem.style.borderTopLeftRadius="6px";this._elem.style.borderTopRightRadius="6px";if(this._border!=null&&!this._hasBorder){this._elem.appendChild(this._border);this._hasBorder=true;}}else{this._elem.style.boxShadow="";this._elem.style.borderRadius="0";if(this._border!=null&&this._hasBorder){this._elem.removeChild(this._border);this._hasBorder=false;}}if(this._tcontent.length>0){this._content.style.bottom="24px";this._content.style.borderBottom="0";for(var i=0;i<this._tcontent.length;i++){var t=this._tcontent[i];t.style.bottom="24px";t.style.borderBottom="0";}}else{this._content.style.bottom=0;this._content.style.borderBottom="1px solid darkgrey";}this._updateTabs();};
a.prototype._updateTabs=function(_){if(this._tabs.length>0){if(!this._hasTabs){this._hasTabs=true;this._elem.appendChild(this._tabBox);}var c=this._telem.length;var w=0;if(_==undefined){_=this._tabBox.offsetWidth;}var t=(_-2)/c;for(var i=0;i<c;i++){var e=this._telem[i];var b=((i==0&&this._activeTab==this)||(i>0&&this._activeTab==this._tabs[i-1]));e.style.position="absolute";e.style.left=w+"px";e.style.top=0;if(i==c-1){t=this._tabBox.offsetWidth-w;}e.style.width=t+"px";e.style.height="24px";e.style.boxSizing="border-box";e.style.overflow="hidden";e.style.padding="0 4px";e.style.backgroundColor=b?"lightgrey":"darkgrey";e.style.border="1px solid grey";e.style.fontWeight=b?"bold":"normal";if(b){e.style.borderTop="0";}var d=(i==0)?this._content:this._tcontent[i-1];d.style.visibility=(b)?"visible":"hidden";if(b){this._title.innerHTML=e.innerHTML;}w+=t;}}else if(this._movable){if(this._hasTabs){this._hasTabs=false;this._elem.removeChild(this._tabBox);}this._content.style.visibility="visible";this._title.innerHTML=this._text;}};
a.prototype.addTab=function(c){if(this._tabs.length==0){var t=document.createElement("div");t.innerHTML=this._text;this._tabBox.appendChild(t);this._telem.push(t);}else if(this._tabs.indexOf(c)>=0){return;}this._tabs.push(c);var b=document.createElement("div");b.innerHTML=c._text;this._tabBox.appendChild(b);this._telem.push(b);this._tcontent.push(c._content);this._activeTab=c;c._tabParent=this;c._elem.removeChild(c._content);this._elem.appendChild(c._content);c._saveSize();c._elem.style.display="none";var d=c._tabs.length;if(d>0){for(var i=0;i<d;i++){this._tabs.push(c._tabs[i]);c._tabBox.removeChild(c._telem[i+1]);this._tabBox.appendChild(c._telem[i+1]);this._telem.push(c._telem[i+1]);this._tcontent.push(c._tabs[i]._content);c._tabs[i]._tabParent=this;c._elem.removeChild(c._tabs[i]._content);this._elem.appendChild(c._tabs[i]._content);}c._tabs=[];c._tcontent=[];c._telem=[];}this.update();};
a.prototype._removeSelfMigrate=function(){var c=this._tabs.length;if(c>0){var p=this._parent;var b=this._elem.offsetWidth,d=this._elem.offsetHeight;var n=this._tabs[0];n._elem.style.top=this._elem.offsetTop+"px";n._elem.style.left=this._elem.offsetLeft+"px";this.removeTab(n);for(var i=1;i<c;i++){var t=this._tabs[0];this.removeTab(t);n.addTab(t);}if(p!=null){if(p._left==this){p._left=n;}else if(p._right==this){p._right=n;}p._elem.removeChild(this._elem);this._manager._elem.appendChild(this._elem);this._parent=null;this._manager._elem.removeChild(n._elem);p._elem.appendChild(n._elem);n._parent=p;n._elem.style.width=b+"px";n._elem.style.height=d+"px";this._restoreSize();p.update();n.update();this.update();}}};
a.prototype.removeTab=function(c){if(c==this){this._removeSelfMigrate();return;}var i=this._tabs.indexOf(c);if(i>=0){this._tabBox.removeChild(this._telem[i+1]);this._tabs.splice(i,1);this._telem.splice(i+1,1);var t=this._tcontent[i];t.style.bottom=0;t.style.borderBottom="1px solid darkgrey";c._elem.appendChild(t);c._tabParent=null;this._tcontent.splice(i,1);c._elem.style.display="inherit";c._restoreSize();if(this._tabs.length==0){this._activeTab=this;this._tabBox.removeChild(this._telem[0]);this._telem=[];}else if(i==0){this._activeTab=this;}else{this._activeTab=this._tabs[i-1];}this.update();}};
a.prototype.bringTabToFront=function(c){if(c==this||this._tabs.indexOf(c)>=0){this._activeTab=c;this.update();}};
return a;},true);
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine('sap/ui/vk/ContainerBase',["jquery.sap.global","./library","sap/ui/core/Control","sap/ui/core/IconPool","sap/ui/core/Popup","sap/ui/Device","sap/m/library"],function(q,l,C,I,P,D,m){"use strict";
var a=C.extend("sap.ui.vk.ContainerBase",{metadata:{library:"sap.ui.vk",properties:{"showFullScreen":{type:"boolean",group:"Misc",defaultValue:true},"showSettings":{type:"boolean",group:"Misc",defaultValue:true},"showSelection":{type:"boolean",group:"Misc",defaultValue:true},"fullScreen":{type:"boolean",group:"Misc",defaultValue:false},"title":{type:"string",group:"Misc",defaultValue:""},"autoAdjustHeight":{type:"boolean",group:"Misc",defaultValue:false}},defaultAggregation:"content",aggregations:{content:{type:"sap.ui.vk.ContainerContent",multiple:true,singularName:"content"},"toolbar":{type:"sap.m.Toolbar",multiple:false,visibility:"hidden"}},associations:{},events:{"contentChange":{parameters:{selectedItemId:"string"}},"settingsPressed":{}}}});
a.prototype.switchContent=function(c){this.setSelectedContent(c);this.rerender();};
a.prototype.updateContainer=function(){this._contentChanged=true;this.rerender();};
a.prototype.setSelectedContent=function(c){this._oSelectedContent=c;};
a.prototype.getSelectedContent=function(){return this._oSelectedContent;};
a.prototype.init=function(){this._selectionState="SINGLE";this._firstTime=true;this._aContentIcons=[];this._selectedContent=null;this._oSelectedContent=null;this._bSegmentedButtonSaveSelectState=false;this._oMenu=null;var L=new sap.m.OverflowToolbarLayoutData({priority:sap.m.OverflowToolbarPriority.High});var b=sap.m.ButtonType.Transparent;this._oFullScreenButton=new sap.m.OverflowToolbarButton({layoutData:L,type:b,icon:"sap-icon://full-screen",text:sap.ui.vk.getResourceBundle().getText("CONTAINERBASE_FULLSCREEN"),tooltip:sap.ui.vk.getResourceBundle().getText("CONTAINERBASE_FULLSCREEN"),press:function(){this._bSegmentedButtonSaveSelectState=true;this._toggleFullScreen();}.bind(this)});this._oSettingsButton=new sap.m.OverflowToolbarButton({layoutData:L.clone(),type:b,icon:"sap-icon://action-settings",text:sap.ui.vk.getResourceBundle().getText("CONTAINERBASE_SETTINGS"),tooltip:sap.ui.vk.getResourceBundle().getText("CONTAINERBASE_SETTINGS"),press:function(){this._bSegmentedButtonSaveSelectState=true;this.fireSettingsPressed();}.bind(this)});this._oSelectionButtonSingle=new sap.m.SegmentedButtonItem({icon:"sap-icon://map-container/selection-single",tooltip:sap.ui.vk.getResourceBundle().getText("CONTAINERBASE_MENU_SINGLE"),press:this._handleSelection.bind(this,"SINGLE")});this._oSelectionButtonRectangle=new sap.m.SegmentedButtonItem({icon:"sap-icon://map-container/selection-rectangle",tooltip:sap.ui.vk.getResourceBundle().getText("CONTAINERBASE_MENU_RECT"),press:this._handleSelection.bind(this,"RECT")});this._oSelectionButtonLasso=new sap.m.SegmentedButtonItem({icon:"sap-icon://map-container/selection-lasso",tooltip:sap.ui.vk.getResourceBundle().getText("CONTAINERBASE_MENU_LASSO"),press:this._handleSelection.bind(this,"LASSO")});this._selectionMenu=new sap.m.SegmentedButton({items:[this._oSelectionButtonSingle,this._oSelectionButtonRectangle,this._oSelectionButtonLasso]});this._oPopup=new P({modal:true,shadow:false,autoClose:false});this._oContentSegmentedButton=new sap.m.SegmentedButton({layoutData:L.clone(),select:this._onContentButtonSelect.bind(this)});this._oContTitle=new sap.m.Label();this._oToolbar=new sap.m.OverflowToolbar({width:"auto"}).addStyleClass("sapUiVkContainerBaseToolbar");this.setAggregation("toolbar",this._oToolbar);this.sResizeListenerId=null;if(D.system.desktop){this.sResizeListenerId=sap.ui.core.ResizeHandler.register(this,q.proxy(this._performHeightChanges,this));}else{D.orientation.attachHandler(this._performHeightChanges,this);D.resize.attachHandler(this._performHeightChanges,this);}q.sap.require("sap.ui.thirdparty.URI");var c=[{name:"selection-lasso",unicode:"E000"},{name:"selection-rectangle",unicode:"E001"},{name:"selection-single",unicode:"E002"}],d="map-container",f="map-container";c.forEach(function(i){sap.ui.core.IconPool.addIcon(i.name,d,f,i.unicode);});};
a.prototype.exit=function(){if(this._oFullScreenButton){this._oFullScreenButton.destroy();this._oFullScreenButton=undefined;}if(this._oPopup){this._oPopup.destroy();this._oPopup=undefined;}if(this._oContentSegmentedButton){this._oContentSegmentedButton.destroy();this._oContentSegmentedButton=undefined;}if(this._oSelectedContent){this._oSelectedContent.destroy();this._oSelectedContent=undefined;}if(this._oToolbar){this._oToolbar.destroy();this._oToolbar=undefined;}if(D.system.desktop&&this.sResizeListenerId){sap.ui.core.ResizeHandler.deregister(this.sResizeListenerId);this.sResizeListenerId=null;}else{D.orientation.detachHandler(this._performHeightChanges,this);D.resize.detachHandler(this._performHeightChanges,this);}};
a.prototype.setFullScreen=function(f){if(this._firstTime){return;}if(this.getFullScreen()==f){return;}var b=this.getProperty("fullScreen");if(b!==f){this._toggleFullScreen();}};
a.prototype.onAfterRendering=function(){var t=this;if((this.sResizeListenerId===null)&&(D.system.desktop)){this.sResizeListenerId=sap.ui.core.ResizeHandler.register(this,q.proxy(this._performHeightChanges,this));}if(this.getAutoAdjustHeight()||this.getFullScreen()){q.sap.delayedCall(500,this,function(){t._performHeightChanges();});}this._firstTime=false;if(this.getSelectedContent()!==null){var c=this.getSelectedContent().getContent();if(c instanceof sap.ui.vbm.GeoMap||c instanceof sap.ui.vbm.AnalyticMap){if(this.getShowSelection()){if(this._selectionState==="LASSO"){c.setLassoSelection(true);}else if(this._selectionState==="RECT"){c.setRectangularSelection(true);}else if(this._selectionState==="SINGLE"){c.setRectangularSelection(false);c.setLassoSelection(false);}}}}};
a.prototype.onBeforeRendering=function(){if(this._contentChanged){this._contentChange();}this._oToolbar.removeAllContent();this._addToolbarContent();};
a.prototype.setTitle=function(v){this._oContTitle.setText(v);this.setProperty("title",v,true);};
a.prototype.addContent=function(o){this.addAggregation("content",o);this._contentChanged=true;};
a.prototype.insertContent=function(o,i){this.insertAggregation("content",o,i);this._contentChanged=true;};
a.prototype.updateContent=function(){this.updateAggregation("content");this._contentChanged=true;};
a.prototype._toggleFullScreen=function(){var f=this.getProperty("fullScreen");var s;var h;var c;if(f){this._closeFullScreen();this.setProperty("fullScreen",false,true);c=this.getSelectedContent().getContent();s=c.getId();c.setWidth("100%");h=this._contentHeight[s];if(h){c.setHeight(h);}this.invalidate();}else{var o=this.getAggregation("content");this._contentHeight={};if(o){for(var i=0;i<o.length;i++){c=o[i].getContent();s=c.getId();if(q.isFunction(c.getHeight)){h=c.getHeight();}else{h=0;}this._contentHeight[s]=h;}}this._openFullScreen(true);this.setProperty("fullScreen",true,true);}var b=(f?"sap-icon://full-screen":"sap-icon://exit-full-screen");this._oFullScreenButton.setIcon(b);this._oFullScreenButton.focus();};
a.prototype._openFullScreen=function(n){if((n!==null)&&(n===true)){this._oScrollEnablement=new sap.ui.core.delegate.ScrollEnablement(this,this.getId()+"-wrapper",{horizontal:true,vertical:true});}this.$content=this.$();if(this.$content){this.$tempNode=q("<div></div>");this.$content.before(this.$tempNode);this._$overlay=q("<div id='"+q.sap.uid()+"'></div>");this._$overlay.addClass("sapUiVkContainerBaseOverlay");this._$overlay.append(this.$content);this._oPopup.setContent(this._$overlay);}else{q.sap.log.warn("Overlay: content does not exist or contains more than one child");}this._oPopup.open(200,undefined,undefined,q("body"));};
a.prototype._closeFullScreen=function(){if(this._oScrollEnablement!==null){this._oScrollEnablement.destroy();this._oScrollEnablement=null;}this.$tempNode.replaceWith(this.$content);this._oToolbar.setDesign(sap.m.ToolbarDesign.Auto);this._oPopup.close();this._$overlay.remove();};
a.prototype._performHeightChanges=function(){if(this.getAutoAdjustHeight()||this.getFullScreen()){var $=this.$();if(($.find(".sapUiVkContainerBaseToolbarArea").children()[0])&&($.find(".sapUiVkContainerBaseContentArea").children()[0])){var o=this.getSelectedContent().getContent();if(o.getDomRef().offsetWidth!==this.getDomRef().clientWidth){this.rerender();}}}};
a.prototype._switchContent=function(c){var o=this._findContentById(c);this.setSelectedContent(o);this.fireContentChange({selectedItemId:c});this.rerender();};
a.prototype._contentChange=function(){var c=this.getContent();this._oContentSegmentedButton.removeAllButtons();this._destroyButtons(this._aContentIcons);this._aContentIcons=[];if(c.length===0){this._oContentSegmentedButton.removeAllButtons();this._setDefaultOnSegmentedButton();this.switchContent(null);}if(c){for(var i=0;i<c.length;i++){var b=c[i].getContent();if(b.setWidth){b.setWidth("100%");}var B=new sap.m.SegmentedButtonItem({icon:c[i].getIcon(),tooltip:c[i].getTitle(),key:b.getId()});this._aContentIcons.push(B);this._oContentSegmentedButton.addItem(B);if(i===0){this.setSelectedContent(c[i]);}}}this._contentChanged=false;};
a.prototype._onContentButtonSelect=function(e){var c=e.getParameter("key");this._switchContent(c);};
a.prototype._findContentById=function(s){var c=null;var o=this.getAggregation("content");if(o){for(var i=0;!c&&i<o.length;i++){if(o[i].getContent().getId()===s){c=o[i];}}}return c;};
a.prototype._addToolbarContent=function(){this._oToolbar.addContent(new sap.m.ToolbarSpacer());if(this._aContentIcons.length>1){this._oToolbar.addContent(this._oContentSegmentedButton);}if(this.getSelectedContent()!==null){var c=this.getSelectedContent().getContent();if(c instanceof sap.ui.vbm.GeoMap||c instanceof sap.ui.vbm.AnalyticMap){if(this.getShowSelection()){this._oToolbar.addContent(this._selectionMenu);}}}if(this.getShowSettings()){this._oToolbar.addContent(this._oSettingsButton);}if(!D.system.phone&&this.getShowFullScreen()){this._oToolbar.addContent(this._oFullScreenButton);}};
a.prototype._setDefaultOnSegmentedButton=function(){if(!this._bSegmentedButtonSaveSelectState){this._oContentSegmentedButton.setSelectedButton(null);}this._bSegmentedButtonSaveSelectState=false;};
a.prototype._destroyButtons=function(b){b.forEach(function(B){B.destroy();});};
a.prototype._handleSelection=function(b){var c=this.getSelectedContent().getContent();if(c instanceof sap.ui.vbm.GeoMap||c instanceof sap.ui.vbm.AnalyticMap){if(b==="LASSO"){c.setLassoSelection(true);this._selectionState=b;}else if(b==="RECT"){c.setRectangularSelection(true);this._selectionState=b;}else if(b==="SINGLE"){c.setRectangularSelection(false);c.setLassoSelection(false);this._selectionState=b;}}};
return a;});
sap.ui.predefine('sap/ui/vk/ContainerBaseRenderer',function(){"use strict";var C={};
C.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapUiVkContainerBase");r.writeClasses(c);r.write(">");r.write("<div");r.writeAttributeEscaped("id",c.getId()+"-wrapper");r.addClass("sapUiVkContainerBaseWrapper");r.writeClasses();r.write(">");this.writeContentArea(r,c);this.writeToolbarArea(r,c);r.write("</div>");r.write("</div>");};
C.writeContentArea=function(r,c){var s=c.getSelectedContent();r.write("<div");r.addClass("sapUiVkContainerBaseContentArea");r.writeClasses();r.write(">");if(s!==null){r.renderControl(s);}else if(c.getContent().length>0){s=c.getContent()[0];r.renderControl(s);}r.write("</div>");};
C.writeToolbarArea=function(r,c){r.write("<div");r.addClass("sapUiVkContainerBaseToolbarArea");r.writeClasses();r.write(">");r.renderControl(c._oToolbar);r.write("</div>");};
return C;},true);
sap.ui.predefine('sap/ui/vk/ContainerContent',["./library","sap/ui/core/Control"],function(l,C){"use strict";
var a=C.extend("sap.ui.vk.ContainerContent",{metadata:{library:"sap.ui.vk",properties:{"icon":{type:"string",group:"Misc",defaultValue:null},"title":{type:"string",group:"Misc",defaultValue:null}},aggregations:{"content":{type:"sap.ui.core.Control",multiple:false}}}});
a.prototype.setContent=function(c){if(c instanceof sap.ui.vbm.GeoMap){c.setNavcontrolVisible(false);c.setWidth("100%");c.setHeight("100%");}this.setAggregation("content",c);return this;};
return a;});
sap.ui.predefine('sap/ui/vk/ContainerContentRenderer',function(){"use strict";var C={};
C.render=function(r,c){r.renderControl(c.getContent());};
return C;},true);
sap.ui.predefine('sap/ui/vk/LegendItem',["./library","sap/m/StandardListItem"],function(l,S){"use strict";
var L=S.extend("sap.ui.vk.LegendItem",{metadata:{library:"sap.ui.vk",properties:{color:{type:"sap.ui.core.CSSColor",group:"Appearance",defaultValue:null},semanticSpotType:{type:"sap.ui.vbm.SemanticType",group:"Behavior",defaultValue:null}},aggregations:{}}});
return L;});
sap.ui.predefine('sap/ui/vk/LegendItemRenderer',["sap/m/StandardListItemRenderer","sap/ui/core/Renderer"],function(B,R){"use strict";var L=R.extend(B);
L.renderLIContent=function(r,c){var s=c.getColor();var t=c.getSemanticSpotType();var i=null;if(s){r.write("<span");r.addClass("sapUiVkLegendItemSquare");r.addStyle("background-color",s);r.writeStyles();r.writeClasses();r.write(">");r.write("</span>");}if(t){switch(t){case sap.ui.vbm.SemanticType.Error:i=sap.ui.resource("sap.ui.vbm","themes/base/img/Pin_Red.png");break;case sap.ui.vbm.SemanticType.Warning:i=sap.ui.resource("sap.ui.vbm","themes/base/img/Pin_Orange.png");break;case sap.ui.vbm.SemanticType.Success:i=sap.ui.resource("sap.ui.vbm","themes/base/img/Pin_Green.png");break;case sap.ui.vbm.SemanticType.Default:i=sap.ui.resource("sap.ui.vbm","themes/base/img/Pin_Blue.png");break;case sap.ui.vbm.SemanticType.Inactive:i=sap.ui.resource("sap.ui.vbm","themes/base/img/Pin_Grey.png");break;default:break;}if(i){c.addStyleClass("sapUiVkLegendItemSpotType");c.setIcon(i);}}B.renderLIContent(r,c);};
return L;},true);
sap.ui.predefine('sap/ui/vk/ListPanel',["./library","sap/ui/core/Control","sap/m/library"],function(l,C,m){"use strict";
var L=C.extend("sap.ui.vk.ListPanel",{metadata:{library:"sap.ui.vk",properties:{"headerText":{type:"string",group:"Misc"},"headerIcon":{type:"sap.ui.core.URI",group:"Misc"},"expanded":{type:"boolean",group:"Misc",defaultValue:true},"expandAnimation":{type:"boolean",group:"Misc",defaultValue:true},"selectionMode":{type:"sap.m.ListMode",group:"Misc",defaultValue:sap.m.ListMode.MultiSelect}},aggregations:{"items":{type:"sap.m.ListItemBase",multiple:true,singularName:"item"},"panel":{type:"sap.m.Panel",multiple:false,visibility:"hidden"}},events:{headerIconPress:{},expand:{},selectionChange:{parameters:{listItem:{type:"sap.m.ListItemBase"},listItems:{type:"sap.m.ListItemBase[]"},selected:{type:"boolean"}}},itemPress:{parameters:{listItem:{type:"sap.m.ListItemBase"},srcControl:{type:"sap.ui.core.Control"}}}}}});
L.prototype.getSelectedItem=function(){return this._oList.getSelectedItem();};
L.prototype.setSelectedItem=function(o,s,f){this._oList.setSelectedItem(o,s,f);};
L.prototype.getSelectedItems=function(){return this._oList.getSelectedItems();};
L.prototype.init=function(){this._oList=new sap.m.ListBase({mode:this.getSelectionMode(),itemPress:this.fireItemPress.bind(this),selectionChange:this.fireSelectionChange.bind(this)});this._oPanel=new sap.m.Panel({expandable:true,expanded:true,expandAnimation:true,headerToolbar:new sap.m.Toolbar({active:true,press:this._onHeaderToolbarPress.bind(this)}),content:[this._oList],expand:this.fireExpand.bind(this)});this._oPanel.getHeaderToolbar().addStyleClass("sapUiVkLPTb");this.setAggregation("panel",this._oPanel,true);this._oHeaderIcon=null;this._oHeaderText=null;this._bHeaderToolbarChanged=true;};
L.prototype.exit=function(){this._destroyControl(this._oList);this._destroyControl(this._oPanel);this._destroyControl(this._oHeaderIcon);this._destroyControl(this._oHeaderText);};
L.prototype.getItems=function(){return this._oList.getItems();};
L.prototype.addItem=function(o){return this._oList.addItem(o);};
L.prototype.insertItem=function(o,i){return this._oList.insertItem(o,i);};
L.prototype.removeItem=function(o){return this._oList.removeItem(o);};
L.prototype.removeAllItems=function(){return this._oList.removeAllItems();};
L.prototype.setHeaderText=function(v){if(!this._oHeaderText){this._oHeaderText=new sap.m.Title();}this._oHeaderText.setText(v);this._bHeaderToolbarChanged=true;return this.setProperty("headerText",v);};
L.prototype.getExpanded=function(){return this._oPanel.getExpanded();};
L.prototype.setExpanded=function(v){return this._oPanel.setExpanded(v);};
L.prototype.getExpandAnimation=function(){return this._oPanel.getExpandAnimation();};
L.prototype.setExpandAnimation=function(v){return this._oPanel.setExpandAnimation(v);};
L.prototype.setHeaderIcon=function(v){if(!this._oHeaderIcon){this._oHeaderIcon=new sap.m.Button({press:this.fireHeaderIconPress.bind(this),type:sap.m.ButtonType.Transparent});}this._oHeaderIcon.setIcon(v);this._bHeaderToolbarChanged=true;return this.setProperty("headerIcon",v);};
L.prototype.setSelectionMode=function(v){this._oList.setMode(v);return this.setProperty("selectionMode",v);};
L.prototype.onBeforeRendering=function(){if(this._bHeaderToolbarChanged){var t=this._oPanel.getHeaderToolbar();t.removeAllContent();if(this._oHeaderIcon){t.addContent(this._oHeaderIcon);}if(this._oHeaderText){t.addContent(this._oHeaderText);}this._bHeaderToolbarChanged=false;}};
L.prototype._destroyControl=function(c){if(c){c.destroy();c=undefined;}};
L.prototype._onHeaderToolbarPress=function(e){this._oPanel.setExpanded(!this._oPanel.getExpanded());};
return L;});
sap.ui.predefine('sap/ui/vk/ListPanelRenderer',function(){"use strict";var L={};
L.render=function(r,c){var p=c._oPanel;p.addStyleClass("sapUiVkListPanel");r.write("<div");r.writeControlData(c);r.write(">");r.renderControl(p);r.write("</div>");};
return L;},true);
sap.ui.predefine('sap/ui/vk/ListPanelStack',["./library","sap/ui/core/Control","sap/ui/layout/library"],function(l,C,a){"use strict";
var L=C.extend("sap.ui.vk.ListPanelStack",{metadata:{library:"sap.ui.vk",properties:{"width":{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:"100%"},"expanded":{type:"boolean",group:"Misc",defaultValue:true},"expandAnimation":{type:"boolean",group:"Misc",defaultValue:true},"collapsible":{type:"boolean",group:"Misc",defaultValue:true}},aggregations:{"content":{type:"sap.ui.vk.ListPanel",multiple:true,singularName:"content"},"layout":{type:"sap.ui.layout.VerticalLayout",multiple:false,visibility:"hidden"}}}});
L.prototype.init=function(){this._oLayout=new sap.ui.layout.VerticalLayout();this._oLayout.addStyleClass("sapUiVkLPSTrans");this.setAggregation("layout",this._oLayout,true);this._bFirstTime=true;};
L.prototype.exit=function(){if(this._oLayout){this._oLayout.destroy();this._oLayout=undefined;}};
L.prototype.getContent=function(){return this._oLayout.getContent();};
L.prototype.addContent=function(o){o.attachExpand(this._onContentExpand.bind(this));o.attachHeaderIconPress(this._onContentHeaderIconPress.bind(this));return this._oLayout.addContent(o);};
L.prototype.removeContent=function(o){return this._oLayout.removeContent(o);};
L.prototype.insertContent=function(o,i){return this._oLayout.insertContent(o,i);};
L.prototype.removeAllContent=function(){return this._oLayout.removeAllContent();};
L.prototype.getWidth=function(){return this._oLayout.getWidth();};
L.prototype.setWidth=function(v){this.setProperty("width",v,true);return this._oLayout.setWidth(v);};
L.prototype.setExpanded=function(v){if(v!=this.getExpanded()){if(v){this._expand();}else{this._collapse();}}return this;};
L.prototype.setExpandAnimation=function(v){this._oLayout.removeStyleClass("sapUiVkLPSTrans");if(v){this._oLayout.addStyleClass("sapUiVkLPSTrans");}return this.setProperty("expandAnimation",v,true);};
L.prototype.onBeforeRendering=function(){if(this._bFirstTime){var e=false;var c=this.getContent();for(var i=0;i<c.length;++i){if(c[i].getExpanded()){e=true;}}this.setExpanded(e);this._bFirstTime=false;}};
L.prototype.onAfterRendering=function(){if(!this.getExpanded()){this._updateCollapsedLayoutWidth();}};
L.prototype._onContentExpand=function(e){var b=false;var c=this._oLayout.getContent();for(var i=0;i<c.length;++i){if(c[i].getExpanded()){b=true;}}this.setExpanded(b);};
L.prototype._onContentHeaderIconPress=function(e){var b=e.oSource.getExpanded()?false:true;e.oSource.setExpanded(b);var E=false;var c=this._oLayout.getContent();for(var i=0;i<c.length;++i){if(c[i].getExpanded()){E=true;break;}}this.setExpanded(E);};
L.prototype._expand=function(){this._oLayout.removeStyleClass("sapUiVkLPSCollapse");this._oLayout.setWidth(this.getProperty("width"));this.setProperty("expanded",true,true);};
L.prototype._collapse=function(){if(!this.getCollapsible()){return;}var c=this.getContent();for(var i=0;i<c.length;++i){c[i].setExpanded(false);}this._oLayout.addStyleClass("sapUiVkLPSCollapse");this._updateCollapsedLayoutWidth();this.setProperty("expanded",false,true);};
L.prototype._updateCollapsedLayoutWidth=function(){if(this._oLayout.$().closest(".sapUiSizeCompact").length===0){this._oLayout.setWidth("3rem");}else{this._oLayout.setWidth("2.5rem");}};
return L;});
sap.ui.predefine('sap/ui/vk/ListPanelStackRenderer',function(){"use strict";var L={};
L.render=function(r,c){c._oLayout.addStyleClass("sapUiVkListPanelStack");r.renderControl(c._oLayout);};
return L;},true);
sap.ui.predefine('sap/ui/vk/MapContainer',["jquery.sap.global","./library","sap/ui/vk/ContainerBase","sap/ui/core/IconPool","sap/ui/vbm/lib/sapvbi","sap/ui/Device"],function(q,l,C,I,s,D){"use strict";
var M=C.extend("sap.ui.vk.MapContainer",{metadata:{library:"sap.ui.vk",properties:{"showNavbar":{type:"boolean",group:"Misc",defaultValue:true},"showHome":{type:"boolean",group:"Misc",defaultValue:true},"showMapLayer":{type:"boolean",group:"Misc",defaultValue:true},"showRectangularZoom":{type:"boolean",group:"Misc",defaultValue:true},"showZoom":{type:"boolean",group:"Misc",defaultValue:true}},aggregations:{"listPanelStack":{type:"sap.ui.vk.ListPanelStack",multiple:false},"scrollCont":{type:"sap.m.ScrollContainer",multiple:false,visibility:"hidden"}},associations:{},events:{}}});
M.prototype.init=function(){this._currentText=new sap.m.Text({}).addStyleClass("mapLayerSelectedText");C.prototype.init.apply(this,arguments);var m=new sap.ui.model.json.JSONModel();m.setData({rectZoom:false});this.setModel(m,"rectZoom");this._oNavbar=new sap.m.Toolbar({width:"auto"});this._oScrollCont=new sap.m.ScrollContainer({horizontal:false,vertical:true,focusable:false});this.setAggregation("scrollCont",this._oScrollCont,true);this._oHomeButton=new sap.m.Button({icon:"sap-icon://home",type:sap.m.ButtonType.Transparent,tooltip:sap.ui.vk.getResourceBundle().getText("MAPCONTAINER_HOME"),press:this._onNavbarHome.bind(this)});this._oRectZoomButton=new sap.m.ToggleButton({icon:"sap-icon://draw-rectangle",type:sap.m.ButtonType.Transparent,pressed:"{rectZoom>/rectZoom}",tooltip:sap.ui.vk.getResourceBundle().getText("MAPCONTAINER_RECT_ZOOM")}).setModel(m,"rectZoom");this._oZoomInButton=new sap.m.Button({icon:"sap-icon://add",type:sap.m.ButtonType.Transparent,tooltip:sap.ui.vk.getResourceBundle().getText("MAPCONTAINER_ZOOMIN"),press:this._onNavbarZoomIn.bind(this)});this._oZoomOutButton=new sap.m.Button({icon:"sap-icon://less",type:sap.m.ButtonType.Transparent,tooltip:sap.ui.vk.getResourceBundle().getText("MAPCONTAINER_ZOOMOUT"),press:this._onNavbarZoomOut.bind(this)});if(D.system.phone){this._oMenuOpenButton=new sap.m.Button({layoutData:new sap.m.OverflowToolbarLayoutData({priority:sap.m.OverflowToolbarPriority.NeverOverflow}),icon:"sap-icon://menu2",type:sap.m.ButtonType.Transparent,tooltip:sap.ui.vk.getResourceBundle().getText("CONTAINERBASE_MENU"),press:function(){this._bSegmentedButtonSaveSelectState=true;this._showListPanelStack();}.bind(this)});this._oMenuCloseButton=new sap.m.Button({type:sap.m.ButtonType.Transparent,icon:"sap-icon://nav-back",press:function(){this._bSegmentedButtonSaveSelectState=true;this._hideListPanelStack();}.bind(this)});}};
M.prototype.exit=function(){if(this._oNavbar){this._oNavbar.destroy();this._oNavbar=undefined;}if(this._oScrollCont){this._oScrollCont.destroy();this._oScrollCont=undefined;}C.prototype.exit.apply(this,arguments);};
M.prototype.getListPanelStack=function(){return this._oScrollCont.getContent()[0];};
M.prototype.setListPanelStack=function(p){if(D.system.phone){p.setCollapsible(false);p.setWidth("100%");}this._oScrollCont.removeAllContent();return this._oScrollCont.addContent(p);};
M.prototype.onBeforeRendering=function(){C.prototype.onBeforeRendering.apply(this,arguments);this._oNavbar.removeAllContent();var c=this.getSelectedContent();if(c!==null){var a=c.getContent();this._isInstanceGeoAnalytic=a instanceof sap.ui.vbm.GeoMap||a instanceof sap.ui.vbm.AnalyticMap;if(this._isInstanceGeoAnalytic){if(this.getShowHome()){this._oNavbar.addContent(this._oHomeButton);}if(!D.system.phone&&this.getShowRectangularZoom()){this._oNavbar.addContent(this._oRectZoomButton);}if(this.getShowZoom()){this._oNavbar.addContent(this._oZoomInButton);this._oNavbar.addContent(this._oZoomOutButton);}this._shouldRenderListPanel=true;}else{this._shouldRenderListPanel=false;}this._isSupportingMapLayerSwitch=a instanceof sap.ui.vbm.GeoMap&&!(a instanceof sap.ui.vbm.AnalyticMap);if(this._isSupportingMapLayerSwitch&&a.getMapConfiguration()!==null&&this.getShowMapLayer()){var b=a.getMapConfiguration();var d=[].concat(b.MapLayerStacks);if(d.length>1){this._box=new sap.m.HBox({}).addStyleClass("mapContainerHboxPopover");this._popover=new sap.m.Popover({placement:sap.m.PlacementType.Horizontal,content:this._box,showHeader:false});this._selectionMap=new sap.m.Image({width:"4.7rem",press:function(e){if(this._popover.isOpen()){this._popover.close();}else{this._popover.openBy(this._selectionMap);}}.bind(this)}).addStyleClass("mapLayerPopoverItem");}this._shouldRenderMapLayerSwitch=true;}else{this._shouldRenderMapLayerSwitch=false;}}};
M.prototype.onAfterRendering=function(){if(D.system.phone){var L=document.getElementById(this.getId()+"-LPW");this.getDomRef().appendChild(L);}C.prototype.onAfterRendering.apply(this,arguments);if(this.getSelectedContent()!==null){var c=this.getSelectedContent().getContent();if(this._isSupportingMapLayerSwitch===true&&c.getMapConfiguration()){var a=c.getMapConfiguration();var b=[].concat(a.MapLayerStacks);if(b.length>1){b.forEach(function(v,i){var d=new sap.ui.layout.VerticalLayout({});var e=c.mVBIContext.GetMainScene();var f=c.mVBIContext.m_MapLayerStackManager.GetMapLayerStack(v.name);var o=new sap.m.Image({width:"4.5rem",press:function(h){this._popover.close();o.setAlt(v.name);var j=h.getSource();var t=j.getAlt();c.setRefMapLayerStack(t);this._currentText.setText(v.name);e.GetPreviewImage(f,function(k){q(".mapLayerPopoverItem").attr("src",k.src);});this._currentMapLayerStackIndex=i;}.bind(this)});var g=new sap.m.Text({text:v.name}).addStyleClass("mapLayerPopoverItemText");o.addStyleClass("layerType");e.GetPreviewImage(f,function(h){o.setSrc(h.src);});e.GetPreviewImage(e.m_MapLayerStack,function(h){q(".mapLayerPopoverItem").attr("src",h.src);});var n=b[this._currentMapLayerStackIndex||0].name;this._currentText.setText(n);this._box.addItem(d);d.addContent(o);d.addContent(g);},this);}}}};
M.prototype.setSelectedContent=function(c){var o;if(this._oSelectedContent){if((o=this._oSelectedContent.getContent())instanceof sap.ui.vbm.GeoMap){o.unbindProperty("rectZoom","rectZoom>/rectZoom");}}C.prototype.setSelectedContent.apply(this,arguments);var n=this._oSelectedContent.getContent();if(n instanceof sap.ui.vbm.GeoMap){n.bindProperty("rectZoom","rectZoom>/rectZoom");}};
M.prototype._addToolbarContent=function(){if(D.system.phone){this._oToolbar.addContent(this._oMenuOpenButton);}C.prototype._addToolbarContent.apply(this,arguments);};
M.prototype._onNavbarZoomIn=function(e){var c=this.getSelectedContent().getContent();if(c.getZoomlevel&&c.setZoomlevel&&c.setEnableAnimation){c.setEnableAnimation(true);c.setZoomlevel(c.getZoomlevel()+1);}};
M.prototype._onNavbarZoomOut=function(e){var c=this.getSelectedContent().getContent();if(c.getZoomlevel&&c.setZoomlevel&&c.setEnableAnimation){c.setEnableAnimation(true);c.setZoomlevel(c.getZoomlevel()-1);}};
M.prototype._onNavbarHome=function(e){var c=this.getSelectedContent().getContent();if(c.goToStartPosition){c.goToStartPosition();}};
M.prototype._showListPanelStack=function(){q("#"+this.getId()+"-LPW").addClass("sapUiVkMapContainerLPWIn");q("#"+this.getId()+"-wrapper").addClass("sapUiVkMapContainerMapOut");};
M.prototype._hideListPanelStack=function(){q("#"+this.getId()+"-LPW").removeClass("sapUiVkMapContainerLPWIn");q("#"+this.getId()+"-wrapper").removeClass("sapUiVkMapContainerMapOut");};
return M;});
sap.ui.predefine('sap/ui/vk/MapContainerRenderer',["./ContainerBaseRenderer","sap/ui/core/Renderer","sap/ui/Device"],function(B,R,D){"use strict";var M=R.extend(B);
M.render=function(r,c){c.addStyleClass("sapUiVkMapContainer");B.render.apply(this,arguments);};
M.writeToolbarArea=function(r,c){r.write("<div");r.addClass("sapUiVkMapContainerOverlay");r.writeClasses();r.write(">");if(c.getShowNavbar()){r.write("<div");r.addClass("sapUiVkMapContainerNavbarArea");r.writeClasses();r.write(">");if(c.getShowMapLayer()&&c._shouldRenderMapLayerSwitch){r.renderControl(c._currentText);r.renderControl(c._selectionMap);}r.write("<div");r.addClass("sapUiVkMapContainerNavbarContainer");r.writeClasses();r.write(">");r.renderControl(c._oNavbar);r.write("</div>");r.write("</div>");}if(!D.system.phone&&c._shouldRenderListPanel){c._oScrollCont.addStyleClass("sapUiVkMapContainerListPanelArea");r.renderControl(c._oScrollCont);}B.writeToolbarArea(r,c);r.write("</div>");if(D.system.phone){r.write("<div id="+c.getId()+"-LPW");r.addClass("sapUiVkMapContainerLPW");r.writeClasses();r.write(">");r.renderControl(c._oMenuCloseButton);c._oScrollCont.addStyleClass("sapUiVkMapContainerListPanelArea");r.renderControl(c._oScrollCont);r.write("</div>");}};
return M;},true);
sap.ui.predefine('sap/ui/vk/NativeViewport',["jquery.sap.global","./library","sap/ui/core/Control","sap/ui/core/ResizeHandler","./Loco","./ViewportHandler","./Messages","./ContentConnector"],function(q,l,C,R,L,V,M,a){"use strict";
var N=C.extend("sap.ui.vk.NativeViewport",{metadata:{library:"sap.ui.vk",properties:{limitZoomOut:{type:"boolean",group:"Behavior",defaultValue:false}},publicMethods:["beginGesture","endGesture","getViewInfo","loadUrl","pan","queueCommand","rotate","setViewInfo","tap","zoom"],associations:{contentConnector:{type:"sap.ui.vk.ContentConnector",multiple:false}},events:{"resize":{parameters:{oldSize:"object",size:"object"}},"move":{parameters:{pan:"object",zoom:"float"}}}}});
N.prototype.init=function(){if(C.prototype.init){C.prototype.init.call(this);}this._canvas=null;this._canvas=document.createElement("div");this._canvas.style.textAlign="left";this._canvas.id=q.sap.uid();this._resizeListenerId=null;this._viewportHandler=new V(this);this._loco=new L();this._loco.addHandler(this._viewportHandler);this._img=null;this._svg=null;this._svgError=null;this._reset();this._gx=0;this._gy=0;this._errorImageWidth=550;this._errorImageHeight=512;this._imageW=0;this._imageH=0;this._s4BestFit=0;this._update=function(){};this._svgid=this.getId()+"-svg";this._doBestFitAfterResize=false;};
N.prototype.exit=function(){this._loco.removeHandler(this._viewportHandler);this._viewportHandler.destroy();if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}if(C.prototype.exit){C.prototype.exit.call(this);}};
N.prototype.onBeforeRendering=function(){if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}};
N.prototype.onAfterRendering=function(){if(this._canvas){var d=this.getDomRef();d.appendChild(this._canvas);this._resizeListenerId=R.register(this,this._handleResize.bind(this));}};
N.prototype._handleResize=function(e){this.fireResize({oldSize:e.oldSize,size:e.size});if(this._doBestFitAfterResize){this._doBestFitAfterResize=false;this._bestFit();}this._update();};
N.prototype._reset=function(){this._x=0;this._y=0;this._s=1.0;this._r=0;};
N.prototype._updateIMG=function(){if(this._img!=null){var x=this._x-(this._imageW-this._canvas.clientWidth)/2;var y=this._y-(this._imageH-this._canvas.clientHeight)/2;var t="matrix("+this._s+",0,0,"+this._s+","+x+","+y+")";this._img.style.transform=t;this._img.style.webkitTransform=t;this._img.style.msTransform=t;this._img.style.MozTransform=t;this._img.style.OTransform=t;}};
N.prototype._updateSVG=function(){if(this._svg!=null){var x=this._x-(this._imageW-this._canvas.clientWidth)/2;var y=this._y-(this._imageH-this._canvas.clientHeight)/2;if((this.x<0)&&(this.y<0)){x=0;y=0;}var t="matrix("+this._s+",0,0,"+this._s+","+x+","+y+");";this._svg.setAttribute("style","transform:"+t+"webkitTransform:"+t+"msTransform:"+t+"MozTransform:"+t+"OTransform:"+t);}};
N.prototype._updateError=function(){if(this._svgError!=null){var x=this._x-(this._imageW-this._canvas.clientWidth)/2;var y=this._y-(this._imageH-this._canvas.clientHeight)/2;if((this.x<0)&&(this.y<0)){x=0;y=0;}var t="matrix("+this._s+",0,0,"+this._s+","+x+","+y+");";this._svgError.setAttribute("style","transform:"+t+"webkitTransform:"+t+"msTransform:"+t+"MozTransform:"+t+"OTransform:"+t);}};
N.prototype._bestFit=function(){if(this._canvas.children[0]&&this._canvas.children[0].getBoundingClientRect()){var w=this._canvas.clientWidth/this._canvas.children[0].getBoundingClientRect().width,h=this._canvas.clientHeight/this._canvas.children[0].getBoundingClientRect().height,s=w<h?w:h;this.zoom(s);var o=q(this._canvas.children[0]).position().left-q(this._canvas).position().left,b=q(this._canvas.children[0]).position().top-q(this._canvas).position().top,i=this._canvas.children[0].getBoundingClientRect().width,c=this._canvas.children[0].getBoundingClientRect().height,v=this._canvas.getBoundingClientRect().width,d=this._canvas.getBoundingClientRect().height;var e=(v-i)/2-o,f=(d-c)/2-b;this.pan(e,f);this._s4BestFit=this._s;}};
N.prototype.loadUrl=function(u,o,b,c,d){if(/^(svg)$/.test(d.toLowerCase())){while(this._canvas.lastChild){this._canvas.removeChild(this._canvas.lastChild);}this._reset();this._svg=document.createElement("object");this._svg.setAttribute("type","image/svg+xml");this._svg.setAttribute("data",u);this._svg.setAttribute("id",this._svgid);this._svg.setAttribute("class","SVGImage");this._canvas.appendChild(this._svg);var s=document.createElement("div");this._canvas.appendChild(s);s.style.position="absolute";s.style.top=0;s.style.left=0;s.style.height="100%";s.style.width="100%";this._svg.style.visibility="hidden";this._svg.onload=function(){setTimeout(function(){this._imageW=this._svg.getBoundingClientRect().width;this._imageH=this._svg.getBoundingClientRect().height;this._s=1;this._update=this._updateSVG.bind(this);this._bestFit();o();this._svg.onload=undefined;}.bind(this),0);}.bind(this);this._svg.src=u;this._svg.onerror=function(){q.sap.log.error(sap.ui.vk.getResourceBundle().getText(M.VIT1.summary),M.VIT1.code,"sap.ui.vk.NativeViewport");b();if(this._svg.parentNode===this._canvas){this._canvas.removeChild(this._svg);}}.bind(this);return this;}else if(/^(jpg|png|gif|bmp|tif|tiff)$/.test(d.toLowerCase())){while(this._canvas.lastChild){this._canvas.removeChild(this._canvas.lastChild);}this._reset();this._img=new Image();this._img.onload=function(){this._imageW=this._img.width;this._imageH=this._img.height;setTimeout(function(){this._canvas.appendChild(this._img);this._update=this._updateIMG.bind(this);this._bestFit();}.bind(this),0);o();}.bind(this);this._img.onerror=function(){q.sap.log.error(sap.ui.vk.getResourceBundle().getText(M.VIT2.summary),M.VIT2.code,"sap.ui.vk.NativeViewport");b();};this._img.src=u;return this;}else{q.sap.log.error(sap.ui.vk.getResourceBundle().getText(M.VIT3.summary),M.VIT3.code,"sap.ui.vk.NativeViewport");b();}};
N.prototype.loadFailed=function(t){while(this._canvas.lastChild){this._canvas.removeChild(this._canvas.lastChild);}this._reset();this._svgError=document.createElement("div");this._svgError.className="svgErrorContainer";this._svgErrorElement=document.createElementNS("http://www.w3.org/2000/svg","svg");this._svgErrorElement.setAttribute("width","550px");this._svgErrorElement.setAttribute("height","512px");this._svgErrorElement.setAttribute("viewBox","-244 -244 512 512");this._svgErrorElement.setAttribute("enable-background","new -244 -244 512 512");this._svgErrorElement.setAttribute("id","SVGError");var b=document.createElementNS("http://www.w3.org/2000/svg","rect");b.setAttribute("fill","#FFFFFF");b.setAttribute("x","-244");b.setAttribute("y","-244");b.setAttribute("width","512");b.setAttribute("height","512");b.setAttribute("opacity","0.1");this._svgErrorElement.appendChild(b);var c=document.createElementNS("http://www.w3.org/2000/svg","path");c.setAttribute("fill","#474747");c.setAttribute("d","M12.833,89.742c-70.781,0-128.366-57.584-128.366-128.366c0-70.781,57.584-128.365,128.366-128.365 s128.365,57.584,128.365,128.365C141.198,32.158,83.614,89.742,12.833,89.742z M12.833-146.989 c-59.753,0-108.366,48.612-108.366,108.365c0,59.752,48.613,108.366,108.366,108.366S121.198,21.129 121.198-38.624 C121.198-98.376,72.586-146.989,12.833-146.989z");c.setAttribute("opacity","0.3");this._svgErrorElement.appendChild(c);var d=document.createElementNS("http://www.w3.org/2000/svg","rect");d.setAttribute("fill","#474747");d.setAttribute("x","-2.167");d.setAttribute("y","-120.847");d.setAttribute("width","30");d.setAttribute("height","119.447");d.setAttribute("fill","#474747");d.setAttribute("opacity","0.3");this._svgErrorElement.appendChild(d);var e=document.createElementNS("http://www.w3.org/2000/svg","rect");e.setAttribute("fill","#474747");e.setAttribute("x","-2.167");e.setAttribute("y","13.6");e.setAttribute("width","30");e.setAttribute("height","30");e.setAttribute("opacity","0.3");this._svgErrorElement.appendChild(e);var f=document.createElementNS("http://www.w3.org/2000/svg","path");f.setAttribute("fill","#474747");f.setAttribute("d","M10.833,87.33c-70.781,0-128.366-57.584-128.366-128.365c0-70.781,57.584-128.365,128.366-128.365 s128.365,57.584,128.365,128.365C139.198,29.746,81.614,87.33,10.833,87.33z M10.833-149.4 c-59.753,0-108.366,48.612-108.366,108.365S-48.92,67.33,10.833,67.33S119.198,18.718,119.198-41.035S70.586-149.4,10.833-149.4z");this._svgErrorElement.appendChild(f);var g=document.createElementNS("http://www.w3.org/2000/svg","rect");g.setAttribute("fill","#474747");g.setAttribute("x","-4.167");g.setAttribute("y","-123.259");g.setAttribute("width","30");g.setAttribute("height","119.447");g.setAttribute("fill","#474747");this._svgErrorElement.appendChild(g);var h=document.createElementNS("http://www.w3.org/2000/svg","rect");h.setAttribute("fill","#474747");h.setAttribute("x","-4.167");h.setAttribute("y","11.188");h.setAttribute("width","30");h.setAttribute("height","30");h.setAttribute("fill","#474747");this._svgErrorElement.appendChild(h);var i=document.createElementNS("http://www.w3.org/2000/svg","text");i.setAttribute("id","textError");i.setAttribute("left","auto");i.setAttribute("right","auto");i.setAttribute("y","150");i.setAttribute("x","10");i.setAttribute("display","block");i.setAttribute("text-anchor","middle");i.setAttribute("fill","#474747");i.setAttribute("style","font-family:Arial");i.setAttribute("font-size","32");i.textContent=t?t:sap.ui.vk.getResourceBundle().getText("VIEWPORT_MESSAGEUNSUPPORTEDFILEFORMAT");this._svgErrorElement.appendChild(i);this._svgError.appendChild(this._svgErrorElement);this._canvas.appendChild(this._svgError);this._imageW=this._errorImageWidth;this._imageH=this._errorImageHeight;this._update=this._updateError.bind(this);this._doBestFitAfterResize=true;setTimeout(function(){this._bestFit();}.bind(this),0);q.sap.log.error(sap.ui.vk.getResourceBundle().getText(M.VIT4.summary),M.VIT4.code,"sap.ui.vk.NativeViewport");return this;};
N.prototype.beginGesture=function(x,y){this._gx=(x-this._canvas.clientWidth/2-this._x)/this._s;this._gy=(y-this._canvas.clientHeight/2-this._y)/this._s;return this;};
N.prototype.endGesture=function(){this._gx=0;this._gy=0;return this;};
N.prototype.pan=function(d,b){this._x+=d;this._y+=b;this._update();this.fireMove({pan:{x:d,y:b},zoom:1.0});return this;};
N.prototype.rotate=function(d,b){this._x+=d;this._y+=b;this._update();this.fireMove({pan:{x:d,y:b},zoom:1.0});return this;};
N.prototype.zoom=function(z){var g=this._gx*this._s;var b=this._gy*this._s;var n=this._s*z;var c=(this.getLimitZoomOut())?this._s4BestFit*0.25:0.0001;var d=500;if((n>c)&&(n<d)){this._s=n;}else if(n<d){z=c/this._s;this._s=c;}else{z=d/this._s;this._s=d;}var e=this._gx*this._s;var f=this._gy*this._s;var h=g-e;var i=b-f;this._x+=h;this._y+=i;this._update();this.fireMove({pan:{x:h,y:i},zoom:z});return this;};
N.prototype.tap=function(x,y,i){if(i){this._bestFit();}return this;};
N.prototype.queueCommand=function(c){c();return this;};
N.prototype.getViewInfo=function(){var v={};v.camera=[this._s,0,0,this._s,this._x,this._y];return v;};
N.prototype.setViewInfo=function(v){var c=v.camera;this._s=c[0];this._x=c[4];this._y=c[5];this._update();return this;};
N.prototype.getOutputSize=function(){var c=this.getViewInfo().camera,b=this.getDomRef().getBoundingClientRect();return{left:b.width/2+c[4],top:b.height/2+c[5],sideLength:this._canvas.children[0].getBoundingClientRect().width};};
N.prototype._onAfterUpdateContentConnector=function(){this._setImage(this._contentConnector.getContent());};
N.prototype._onBeforeClearContentConnector=function(){this._setImage(null);};
N.prototype._handleContentReplaced=function(e){this._setImage(e.getParameter("newContent"));};
N.prototype._setImage=function(i){while(this._canvas.lastChild){this._canvas.removeChild(this._canvas.lastChild);}this._reset();if(i instanceof HTMLObjectElement){this._svg=i;this._svg.setAttribute("id",this._svgid);this._canvas.appendChild(this._svg);var s=document.createElement("div");this._canvas.appendChild(s);s.style.position="absolute";s.style.top=0;s.style.left=0;s.style.height="100%";s.style.width="100%";q.sap.delayedCall(10,this,function(){this._imageW=this._svg.getBoundingClientRect().width;this._imageH=this._svg.getBoundingClientRect().height;this._s=1;this._update=this._updateSVG.bind(this);this._bestFit();});}else if(i instanceof HTMLImageElement){this._img=i;this._canvas.appendChild(this._img);q.sap.delayedCall(10,this,function(){this._imageW=this._img.width;this._imageH=this._img.height;this._update=this._updateIMG.bind(this);this._bestFit();});}};
var r=2;var p=2;[{key:"left",dx:-p,dy:0},{key:"right",dx:+p,dy:0},{key:"up",dx:0,dy:-p},{key:"down",dx:0,dy:+p}].forEach(function(i){N.prototype["onsap"+i.key]=function(e){this.beginGesture(this.$().width()/2,this.$().height()/2);this.pan(i.dx,i.dy);this.endGesture();e.preventDefault();e.stopPropagation();};});[{key:"left",dx:-r,dy:0},{key:"right",dx:+r,dy:0},{key:"up",dx:0,dy:-r},{key:"down",dx:0,dy:+r}].forEach(function(i){N.prototype["onsap"+i.key+"modifiers"]=function(e){if(e.shiftKey&&!(e.ctrlKey||e.altKey||e.metaKey)){this.beginGesture(this.$().width()/2,this.$().height()/2);this.rotate(i.dx,i.dy);this.endGesture();e.preventDefault();e.stopPropagation();}};});[{key:"minus",d:0.98},{key:"plus",d:1.02}].forEach(function(i){N.prototype["onsap"+i.key]=function(e){this.beginGesture(this.$().width()/2,this.$().height()/2);this.zoom(i.d);this.endGesture();e.preventDefault();e.stopPropagation();};});a.injectMethodsIntoClass(N);return N;});
sap.ui.predefine('sap/ui/vk/Notifications',["jquery.sap.global","./library","sap/ui/core/Control","./Messages"],function(q,l,C,M){"use strict";
var N=C.extend("sap.ui.vk.Notifications",{metadata:{library:"sap.ui.vk",publicMethods:["clearAllMessages"],aggregations:{_messagePopover:{type:"sap.m.MessagePopover",multiple:false,visibility:"hidden"},_messagePopoverToggleButton:{type:"sap.m.ToggleButton",multiple:false,visibility:"hidden"}},events:{allMessagesCleared:{},messageAdded:{}}}});
N.prototype.init=function(){if(C.prototype.init){C.prototype.init.call(this);}var m;var a=new sap.m.ToggleButton({icon:"sap-icon://message-popup",type:sap.m.ButtonType.Emphasized,tooltip:sap.ui.vk.getResourceBundle().getText("MESSAGEPOPOVERBUTTON"),text:"0",press:function(e){if(a.getPressed()){m.openBy(a);}else{m.close();}}});a.addStyleClass("messagePopoverButton");this.setAggregation("_messagePopoverToggleButton",a);m=new sap.m.MessagePopover({headerButton:new sap.m.Button({text:sap.ui.vk.getResourceBundle().getText("MESSAGEPOPOVER_CLEARBUTTON"),type:sap.m.ButtonType.Emphasized,tooltip:sap.ui.vk.getResourceBundle().getText("MESSAGEPOPOVER_CLEARBUTTON"),press:function(e){m.getParent().clearAllMessages();}}),afterClose:a.setPressed.bind(a,false)});m.addStyleClass("sapVizKitNotificationPopover");this.setAggregation("_messagePopover",m);q.sap.log.addLogListener(this);};
N.prototype.exit=function(){q.sap.log.removeLogListener(this);if(C.prototype.exit){C.prototype.exit.call(this);}};
N.prototype.onLogEntry=function(e){if(/^sap\.ui\.vk/.test(e.component)){var m=e.details,c,r,a;if(M[e.details]){m=sap.ui.vk.getResourceBundle().getText(M[e.details].summary);c=sap.ui.vk.getResourceBundle().getText(M[e.details].cause);r=sap.ui.vk.getResourceBundle().getText(M[e.details].resolution);a=sap.ui.vk.getResourceBundle().getText("ERROR_DESCRIPTION_CODE");}var b=sap.ui.vk.getResourceBundle().getText("ERROR_DESCRIPTION_COMPONENT");var d=sap.ui.vk.getResourceBundle().getText("ERROR_DESCRIPTION_DATE");var t=sap.ui.vk.getResourceBundle().getText("ERROR_DESCRIPTION_TIME");var f=sap.ui.vk.getResourceBundle().getText("ERROR_DESCRIPTION_LEVEL");var g=sap.ui.vk.getResourceBundle().getText("ERROR_DESCRIPTION_MESSAGE");var h=sap.ui.vk.getResourceBundle().getText("ERROR_DESCRIPTION_CAUSE");var i=sap.ui.vk.getResourceBundle().getText("ERROR_DESCRIPTION_RESOLUTION");var j="<div><b>"+b+":</b><br>"+e.component+"</div><br>"+"<div><b>"+d+":</b><br>"+e.date+"</div><br>"+(a?"<div><b>"+a+":</b><br>"+e.details+"</div><br>":"")+"<div><b>"+t+":</b><br>"+e.time.slice(0,e.time.indexOf("."))+"</div><br>"+"<div><b>"+f+":</b><br>"+e.level+"</div><br>"+"<div><b>"+g+":</b><br>"+m+"</div><br>"+(c?"<div><b>"+h+":</b><br>"+c+"</div><br>":"")+(r?"<div><b>"+i+":</b><br>"+r+"</div>":"");var k=new sap.m.MessagePopoverItem({markupDescription:true,title:e.message,description:j});var n=this.getAggregation("_messagePopover");n.addItem(k);this.getAggregation("_messagePopoverToggleButton").setText(n.getItems().length);this.fireMessageAdded();}};
N.prototype.clearAllMessages=function(){var m=this.getAggregation("_messagePopover");m.removeAllItems();m.close();this.getAggregation("_messagePopoverToggleButton").setText(m.getItems().length);this.fireAllMessagesCleared();return this;};
return N;});
sap.ui.predefine('sap/ui/vk/Overlay',["jquery.sap.global","./library","sap/ui/core/Control","sap/ui/vbm/library","sap/ui/vbm/lib/sapvbi","./Messages"],function(q,l,C,v,a,M){"use strict";
var O=C.extend("sap.ui.vk.Overlay",{metadata:{library:"sap.ui.vk",properties:{zoomOnResize:{type:"boolean",group:"Behavior",defaultValue:true}},aggregations:{areas:{type:"sap.ui.vk.OverlayArea",multiple:true,singularName:"area"}},associations:{target:{type:"sap.ui.core.Control",cardinality:"0..1"}},events:{click:{parameters:{clientX:{type:"int"},clientY:{type:"int"},pos:{type:"string"}}},contextMenu:{parameters:{pos:{type:"string"},menu:{type:"sap.ui.unified.Menu"}}}}}});
O.prototype.getPositionInteractive=function(p,c){if(!this.mIACreateCB&&c&&typeof(c)==="function"){this.mIACreateCB=c;var t="POS";if(p){t+="ARRAY";}var L={"SAPVB":{"Automation":{"Call":{"handler":"OBJECTCREATIONHANDLER","name":"CreateObject","object":"MainScene","scene":"MainScene","instance":"","Param":{"name":"data","#":"{"+t+"}"}}}}};this._load(L);return true;}else{return false;}};
O.prototype.openContextMenu=function(m){this._openContextMenu("Overlay",this,m);};
O.prototype.setPanAndZoom=function(n,b,z){if(n===0&&b===0&&z===1){return;}var s=this.mVBIContext.GetMainScene();this.totalCenterOffset.dx+=n;this.totalCenterOffset.dy+=b;if(z===1){s.MoveMap(n,b);}else{var c=s.m_Canvas[0];var d=c.m_nExactLOD+Math.log(z)*Math.LOG2E;s.ZoomToGeoPosition(VBI.MathLib.DegToRad([0.5,0.5]),d);s.MoveMap(this.totalCenterOffset.dx,this.totalCenterOffset.dy);}};
O.prototype.reset=function(){this.totalCenterOffset.dx=this.totalCenterOffset.dy=0;var s=this.mVBIContext.GetMainScene();if(s){s.ZoomToGeoPosition(VBI.MathLib.DegToRad([0.5,0.5]),this.initialZoom);}return this;};
O.prototype.init=function(){this.aLoadQueue=null;this.oTargetDomRef=null;this.mVBIContext=new VBI.VBIContext(this);this.resizeID="";this.resizeIDTarget="";this.bVosDirty=true;this.bWindowsDirty=true;this.bSceneDirty=true;this.bDataDeltaUpdate=false;this.bHandleDataChangeActive=false;this.bForceDataUpdate=false;this.mAddMenuItems=[];this.totalCenterOffset={dx:0,dy:0};this.initialZoom=10;};
O.prototype.exit=function(){if(this.mVBIContext){this.mVBIContext.clear();}if(this.resizeID!=""){sap.ui.core.ResizeHandler.deregister(this.resizeID);this.resizeID="";}if(this.resizeIDTarget!=""){sap.ui.core.ResizeHandler.deregister(this.resizeIDTarget);this.resizeIDTarget="";}};
O.prototype.resize=function(e){var c=(this.oControl!=undefined)?this.oControl:this;var b=c.mVBIContext;if(b){var s=b.GetMainScene();if(s){if(c.getZoomOnResize()&&e&&e.oldSize.width>0){var z=Math.log(e.size.width/e.oldSize.width)*Math.LOG2E;s.ZoomToGeoPosition(s.GetCenterPos(),s.GetCurrentZoomlevel()+z,false,true,true);}s.resizeCanvas(e,true,true);}}};
O.prototype.setTarget=function(t){if(!t){return;}this.setAssociation("target",t);this.reset();if(t instanceof sap.m.Image){t.addDelegate({onAfterRendering:function(e){this.oTargetDomRef=t.getDomRef();this.oTargetDomRef.addEventListener("load",q.proxy(this._adaptSizeOfTarget,this));}.bind(this)});}else{t.addDelegate({onAfterRendering:function(e){this.oTargetDomRef=t.getDomRef();this._adaptSizeOfTarget();}.bind(this)});}if(this.resizeIDTarget!=""){sap.ui.core.ResizeHandler.deregister(this.resizeIDTarget);this.resizeIDTarget="";}this.resizeIDTarget=sap.ui.core.ResizeHandler.register(t,this._adaptSizeOfTarget.bind(this));};
O.prototype._adaptSizeOfTarget=function(){var t=this.oTargetDomRef;var d=this.getDomRef();if(t){try{var T=q(t);var p={top:T.offset().top,left:T.offset().left,width:T.outerWidth(),height:T.outerHeight()};q(d).width(p.width).height(p.height).css("position","absolute");q(d).css("top","0px").css("left","0px").css("visibility","");}catch(e){q.sap.log.error(e);}}else{q(d).css("position","fixed").width("0px").height("0px").css("top","0px").css("left","0px").css("visibility","hidden");}};
O.prototype.onAfterRendering=function(){if(this.$oldContent.length>0){this.$().append(this.$oldContent);}this._adaptSizeOfTarget();if(this.aLoadQueue){var n;for(n=0;n<this.aLoadQueue.length;++n){this._load(this.aLoadQueue[n]);}this.aLoadQueue=null;}if(this.resizeID==""){this.resize();this.resizeID=sap.ui.core.ResizeHandler.register(this,this.resize);}var o=this.getId();if(this.mVBIContext.m_Windows){this.mVBIContext.m_Windows.Awake(o);}};
O.prototype.onBeforeRendering=function(){this.$oldContent=sap.ui.core.RenderManager.findPreservedContent(this.getId());};
O.prototype.invalidate=function(s){this.bSceneDirty=true;if(s instanceof sap.ui.vk.OverlayArea){this.bVosDirty=true;this.bDataDeltaUpdate=this.bHandleDataChangeActive;}sap.ui.core.Control.prototype.invalidate.apply(this,arguments);};
O.prototype._load=function(d){if(!this.isRendered()){if(!this.aLoadQueue){this.aLoadQueue=[];}this.aLoadQueue.push(d);return;}this._loadHtml(d);};
O.prototype._loadHtml=function(d){var o=this.getId();var b=null;if(typeof d=="string"){b=JSON.parse(d.indexOf("{")?d.substr(d.indexOf("{")):d);}else if(typeof d=="object"){b=d;}if(!b){return;}if(!b["SAPVB"]){var m;if(this.mVBIContext&&(m=(new VBI.Adaptor(this.mVBIContext)).CreateLoadData(b))){this.loadHtml(m);return;}else{return;}}var c=false;var e=false;var f=false;if(q.type(b)=="object"){if(b.SAPVB){if(b.SAPVB.Config){this.mVBIContext.GetConfig().load(b.SAPVB.Config,this.mVBIContext);}if(b.SAPVB.Resources){this.mVBIContext.GetResources().load(b.SAPVB.Resources,this.mVBIContext);}if(b.SAPVB.DataTypes){if(!this.mVBIContext["m_DataTypeProvider"]){this.mVBIContext["m_DataTypeProvider"]=new VBI.DataTypeProvider();}this.mVBIContext["m_DataTypeProvider"].load(b.SAPVB.DataTypes,this.mVBIContext);}if(b.SAPVB.Data){if(!this.mVBIContext["m_DataProvider"]){this.mVBIContext["m_DataProvider"]=new VBI.DataProvider();}this.mVBIContext["m_DataProvider"].load(b.SAPVB.Data,this.mVBIContext);c=true;}if(b.SAPVB.Windows){if(!this.mVBIContext["m_Windows"]){this.mVBIContext["m_Windows"]=new VBI.Windows();}this.mVBIContext["m_Windows"].load(b.SAPVB.Windows,this.mVBIContext);f=true;}if(b.SAPVB.Actions){if(!this.mVBIContext["m_Actions"]){this.mVBIContext["m_Actions"]=new VBI.Actions();}this.mVBIContext["m_Actions"].load(b.SAPVB.Actions,this.mVBIContext);}if(b.SAPVB.Automation){if(!this.mVBIContext["m_Automations"]){this.mVBIContext["m_Automations"]=new VBI.Automations();}this.mVBIContext["m_Automations"].load(b.SAPVB.Automation,this.mVBIContext);}if(b.SAPVB.Menus){if(!this.mVBIContext["m_Menus"]){this.mVBIContext["m_Menus"]=new VBI.Menus();}this.mVBIContext["m_Menus"].load(b.SAPVB.Menus,this.mVBIContext);}if(b.SAPVB.Scenes){if(!this.mVBIContext["m_SceneManager"]){this.mVBIContext["m_SceneManager"]=new VBI.SceneManager();}this.mVBIContext["m_SceneManager"].load(b.SAPVB.Scenes,this.mVBIContext);e=true;}}if(c){if(this.mVBIContext["m_Windows"]){this.mVBIContext["m_Windows"].NotifyDataChange();}}if(e||f){if(this.mVBIContext["m_Windows"]){this.mVBIContext["m_Windows"].Awake(o);}}if(e||c){if(this.mVBIContext["m_Windows"]){this.mVBIContext["m_Windows"].RenderAsync();}}}};
O.prototype._openContextMenu=function(t,i,m){if(m&&m.vbi_data&&m.vbi_data.VBIName=="DynContextMenu"){if(!this.mVBIContext["m_Menus"]){this.mVBIContext["m_Menus"]=new window.VBI.Menus();}for(var n=0;n<this.mAddMenuItems.length;++n){m.addItem(this.mAddMenuItems[n]);}this.mVBIContext.m_Menus.m_menus.push(m);this._loadHtml({"SAPVB":{"version":"2.0","Automation":{"Call":{"earliest":"0","handler":"CONTEXTMENUHANDLER","instance":i.sId,"name":"SHOW","object":t,"refID":"CTM","Param":[{"name":"x","#":i.mClickPos[0]},{"name":"y","#":i.mClickPos[1]},{"name":"scene","#":"MainScene"}]}}}});}this.mAddMenuItems=[];};
O.prototype._update=function(){var A={SAPVB:{}};if(this.bSceneDirty){this._updateScene(A);}this._updateWindows(A);if(A.SAPVB.Actions){Array.prototype.push.apply(A.SAPVB.Actions.Set.Action,this._getActionArray());}return this._minimizeApp(A);};
O.prototype._minimizeApp=function(A){var t,s;var c;s=null;if(!this.bWindowsDirty){c=(t=A)&&(t=t.SAPVB)&&(t=t.Windows)&&(s=JSON.stringify(t))&&(s==this.mCurWindows)&&(delete A.SAPVB.Windows);if(!c){this.mCurWindows=s?s:this.mCurWindows;}}else{this.bWindowsDirty=false;}s=null;c=(t=A)&&(t=t.SAPVB)&&(t=t.Scenes)&&(s=JSON.stringify(t))&&(s==this.mCurScenes)&&(delete A.SAPVB.Scenes);if(!c){this.mCurScenes=s?s:this.mCurScenes;}s=null;c=(t=A)&&(t=t.SAPVB)&&(t=t.Actions)&&(s=JSON.stringify(t))&&(s==this.mCurActions)&&(delete A.SAPVB.Actions);if(!c){this.mCurActions=s?s:this.mCurActions;}s=null;c=(t=A)&&(t=t.SAPVB)&&(t=t.DataTypes)&&(s=JSON.stringify(t))&&(s==this.mCurDataTypes)&&(delete A.SAPVB.DataTypes);if(!c){this.mCurDataTypes=s?s:this.mCurDataTypes;}if(!this.bForceDataUpdate){s=null;c=(t=A)&&(t=t.SAPVB)&&(t=t.Data)&&(s=JSON.stringify(t))&&(s==this.mCurData)&&(delete A.SAPVB.Data);if(!c){this.mCurData=s?s:this.mCurData;}}else{this.bForceDataUpdate=false;}return A;};
O.prototype._updateWindows=function(A){A.SAPVB.Windows={"Set":[{"name":"Main","Window":{"id":"Main","caption":"MainWindow","type":"geo","refParent":"","refScene":"MainScene","modal":"true"}}]};};
O.prototype._updateScene=function(A){var s=[];var b=[];var c=[];var d=[];this._updateVOData(s,b,c,d);var _=JSON.stringify(s);var m=true;if(!this.saVO){((((A.SAPVB.Scenes={}).Set={}).SceneGeo={id:"MainScene",scaleVisible:"false",navControlVisible:"false",VisualFrame:{minLOD:5},NavigationDisablement:{move:"true",zoom:"true"},initialZoom:this.initialZoom.toString(),initialStartPosition:"0.5;0.5;0"}).VO=s);}else if(this.bRefMapLayerStackDirty||!(this.saVO===_)){(A.SAPVB.Scenes=this._getSceneVOdelta(JSON.parse(this.m_saVO),s));}else{m=false;}this.saVO=_;if(this.bDataDeltaUpdate){A.SAPVB.Data=[];for(var n=0;n<b.length;++n){A.SAPVB.Data.push({Set:{name:b[n].name,type:"N",N:b[n]}});}}else{((A.SAPVB.Data={}).Set={}).N=b;}if(m){(((A.SAPVB.DataTypes={}).Set={}).N=c);}(((A.SAPVB.Actions={}).Set={}).Action=d);this.bSceneDirty=this.bVosDirty=this.bDataDeltaUpdate=false;};
O.prototype._isEventRegistered=function(A,e){var b=this.getAggregation(A);if(!b){return false;}for(var n=0;n<b.length;++n){var i=b[n];if(i.hasListeners(e)){return true;}}return false;};
O.prototype._getTemplateBindingInfo=function(A){var b=this.getBindingInfo(A);if(b&&b.template){return b.template.mBindingInfos;}};
O.prototype._getBindInfo=function(A){var b={};var t=this._getTemplateBindingInfo(A);b.C=(t)?t.hasOwnProperty("color"):true;b.CB=(t)?t.hasOwnProperty("colorBorder"):true;b.DCH=(t)?t.hasOwnProperty("deltaColorHot"):true;b.CS=(t)?t.hasOwnProperty("colorSelect"):true;b.CNS=(t)?t.hasOwnProperty("colorNonSelect"):true;b.TT=(t)?t.hasOwnProperty("tooltip"):true;b.M=(t)?t.hasOwnProperty("changeable"):true;b.hasTemplate=(t)?true:false;return b;};
O.prototype._updateVOData=function(s,b,c,d){var B,V;this.AreaBindInfo=B=(this.AreaBindInfo)?this.AreaBindInfo:this._getBindInfo("areas");V=(B.hasTemplate)?this.getBindingInfo("areas").template:null;var o={id:"OverlayArea",datasource:"OverlayArea",type:"{00100000-2012-0004-B001-F311DE491C77}"};o["posarray.bind"]=o.id+".P";if(B.C){o["color.bind"]=o.id+".C";}else{o.color=V.getColor();}if(B.CB){o["colorBorder.bind"]=o.id+".C";}else{o.colorBorder=V.getColorBorder();}if(B.DCH){o["hotDeltaColor.bind"]=o.id+".DCH";}else{o.hotDeltaColor=V.getDeltaColorHot();}if(B.CS){o["colorSelect.bind"]=o.id+".C";}else{o.colorSelect=V.getColorSelect();}if(B.CNS){o["colorNonSelect.bind"]=o.id+".C";}else{o.colorNonSelect=V.getColorNonSelect();}if(!B.M){o["VB:c"]=V.getChangeable();}s.push(o);var e={name:o.id,key:"K"};e.A=[{"name":"K","alias":"K","type":"string"},{"name":"VB:s","alias":"VB:s","type":"boolean"},{"name":"P","alias":"P","type":"vectorarray","changeable":"true"}];if(B.C){e.A.push({"name":"C","alias":"C","type":"color"});}if(B.CB){e.A.push({"name":"CB","alias":"CB","type":"string"});}if(B.DCH){e.A.push({"name":"DCH","alias":"DCH","type":"string"});}if(B.CS){e.A.push({"name":"CS","alias":"CS","type":"string"});}if(B.CNS){e.A.push({"name":"CNS","alias":"CNS","type":"string"});}if(B.TT){e.A.push({"name":"TT","alias":"TT","type":"string"});}c.push(e);var i=o.id;if(this._isEventRegistered("areas","click")){d.push({"id":i+"1","name":"click","refScene":"MainScene","refVO":i,"refEvent":"Click","AddActionProperty":[{"name":"pos"}]});}if(this._isEventRegistered("areas","contextMenu")){d.push({"id":i+"2","name":"contextMenu","refScene":"MainScene","refVO":i,"refEvent":"ContextMenu"});}if(this._isEventRegistered("areas","edgeClick")){d.push({"id":i+"7","name":"edgeClick","refScene":"MainScene","refVO":i,"refEvent":"EdgeClick"});}d.push({"id":i+"4","name":"handleMoved","refScene":"MainScene","refVO":i,"refEvent":"HandleMoved"});d.push({"id":i+"5","name":"handleContextMenu","refScene":"MainScene","refVO":i,"refEvent":"HandleContextMenu"});d.push({"id":i+"8","name":"edgeContextMenu","refScene":"MainScene","refVO":i,"refEvent":"EdgeContextMenu"});if(this._isEventRegistered("areas","handleClick")){d.push({"id":i+"6","name":"handleClick","refScene":"MainScene","refVO":i,"refEvent":"HandleClick"});}var f={name:o.id,E:[]};var g=this.getAreas();for(var n=0;n<g.length;++n){f.E.push(g[n].getDataElement());}b.push(f);};
O.prototype._getSceneVOdelta=function(c,n){var V=[];var r=[];var o={};for(var b=0,d=c.length;b<d;++b){o[c[b].id]=c[b];}for(var e=0;e<n.length;++e){if(o[n[e].id]){if(JSON.stringify(n[e])!=JSON.stringify(o[n[e].id])){r.push({"id":n[e].id,"type":"VO"});V.push(n[e]);}}else{V.push(n[e]);}delete o[n[e].id];}for(var i in o){r.push({"id":i,"type":"VO"});}var f={"Merge":{"name":"MainScene","type":"SceneGeo","SceneGeo":{"id":"MainScene"}}};if(r.length){f.Merge.SceneGeo.Remove=r;}if(V.length){f.Merge.SceneGeo.VO=V;}return f;};
O.prototype._getActionArray=function(){var A=[];if(this.mEventRegistry["click"]){A.push({"id":"Overlay1","name":"click","refScene":"MainScene","refVO":"Map","refEvent":"Click","AddActionProperty":[{"name":"pos"}]});}if(this.mEventRegistry["contextMenu"]){A.push({"id":"Overlay2","name":"contextMenu","refScene":"MainScene","refVO":"Map","refEvent":"ContextMenu","AddActionProperty":[{"name":"pos"}]});}A.push({"id":"Overlay3","name":"GetPosComplete","refScene":"MainScene","refVO":"General","refEvent":"CreateComplete"});return A;};
O.prototype._handleChangedData=function(n){try{this.bHandleDataChangeActive=true;if(n&&n.length){for(var b=0,N;b<n.length;++b){N=n[b];if(N.E&&N.E.length){for(var c=0,e,i;c<N.E.length;++c){e=N.E[c];i=this._findInstance(e.K);if(i){i.handleChangedData(e);}}}}}this.bHandleDataChangeActive=false;}catch(d){this.bHandleDataChangeActive=false;throw d;}};
O.prototype._findInstance=function(i){var I=(i.indexOf(".")!==-1)?i.split(".")[1]:i;var A=this.getAreas();for(var n=0;n<A.length;++n){var e=A[n];if(e.getId()===I){return e;}}return null;};
O.prototype._handleAggregationEvent=function(e){var E;if((E=this._findInstance(e.Action.instance))){try{E.handleEvent(e);}catch(b){q.sap.log.error(sap.ui.vk.getResourceBundle().getText(M.VIT11.summary),M.VIT11.code,"sap.ui.vk.Overlay");}}};
O.prototype.isRendered=function(){return this.getDomRef()?true:false;};
O.prototype.fireSubmit=function(e){var d=JSON.parse(e.data);if(d.Data&&d.Data.Merge){this._handleChangedData(d.Data.Merge.N);}if(d.Action.object==="OverlayArea"){this._handleAggregationEvent(d);}else{var A=d.Action.name,c;if(A==="click"||A==="contextMenu"){c=[d.Action.Params.Param[0]["#"],d.Action.Params.Param[1]["#"]];}switch(A){case"GetPosComplete":if(this.mIACreateCB){try{this.mIACreateCB(d.Action.Params.Param[0]["#"]);this.mIACreateCB=null;}catch(b){this.mIACreateCB=null;throw b;}}break;case"click":this.fireClick({clientX:c[0],clientY:c[1],pos:d.Action.AddActionProperties.AddActionProperty[0]["#"]});break;case"contextMenu":if(this.mVBIContext.m_Menus){this.mVBIContext.m_Menus.deleteMenu("DynContextMenu");}sap.ui.getCore().loadLibrary("sap.ui.unified");var m=new sap.ui.unified.Menu();m["vbi_data"]={};m["vbi_data"].menuRef="CTM";m["vbi_data"].VBIName="DynContextMenu";this.mClickPos=c;this.fireContextMenu({pos:d.Action.AddActionProperties.AddActionProperty[0]["#"],menu:m});break;default:break;}}};
O.prototype.fireRender=function(d){};
O.prototype.fireMove=function(d){};
O.prototype.fireZoom=function(d){};
O.prototype.fireOpenWindow=function(d){};
O.prototype.fireCloseWindow=function(d){};
return O;});
sap.ui.predefine('sap/ui/vk/OverlayArea',["./library","sap/ui/core/Element"],function(l,E){"use strict";
var O=E.extend("sap.ui.vk.OverlayArea",{metadata:{library:"sap.ui.vk",properties:{key:{type:"string",group:"Misc",defaultValue:null},position:{type:"string",group:"Misc",defaultValue:null},color:{type:"sap.ui.core.CSSColor",group:"Misc",defaultValue:"rgba(200, 50, 50, 0.3)"},colorBorder:{type:"sap.ui.core.CSSColor",group:"Misc",defaultValue:"rgba(200, 50, 50, 1.0)"},colorSelect:{type:"string",group:"Misc",defaultValue:null},colorNonSelect:{type:"string",group:"Misc",defaultValue:null},deltaColorHot:{type:"string",group:"Misc",defaultValue:"RHLSA(0;1.3;1.0;1.0)"},select:{type:"boolean",group:"Misc",defaultValue:false},changeable:{type:"boolean",group:"Misc",defaultValue:false}},events:{click:{clientX:{type:"int"},clientY:{type:"int"}},contextMenu:{parameters:{menu:{type:"sap.ui.unified.Menu"}}},edgeClick:{parameters:{index:{type:"int"}}},edgeContextMenu:{parameters:{index:{type:"int"},menu:{type:"sap.ui.unified.Menu"}}},handleMoved:{},handleContextMenu:{parameters:{index:{type:"int"},menu:{type:"sap.ui.unified.Menu"}}},handleClick:{index:{type:"int"}}}}});
O.prototype.openContextMenu=function(m){this.getParent().openContextMenu("OverlayArea",this,m);};
O.prototype.getDataElement=function(){var e={};var b=this.getParent().AreaBindInfo;e.K=this.getId();if(b.C){e.C=this.getColor();}if(b.CB){e.CB=this.getColorBorder();}if(b.DCH){e.DCH=this.getDeltaColorHot();}if(b.CS){e.CS=this.getColorSelect();}if(b.CNS){e.CNS=this.getColorNonSelect();}if(b.TT){e.TT=this.getTooltip();}e["VB:s"]=this.getSelect();e.P=this.getPosition();if(b.M){e["VB:c"]=this.getChangeable();}return e;};
O.prototype.handleChangedData=function(e){if(e.P){this.setPosition(e.P);}};
O.prototype.handleEvent=function(e){var a=e.Action.name;var f="fire"+a[0].toUpperCase()+a.slice(1);if(a==="contextMenu"||a==="edgeContextMenu"||a==="handleContextMenu"){var p=this.getParent();this.mClickPos=[e.Action.Params.Param[0]["#"],e.Action.Params.Param[1]["#"]];if(p.mVBIContext.m_Menus){p.mVBIContext.m_Menus.deleteMenu("DynContextMenu");}sap.ui.getCore().loadLibrary("sap.ui.unified");var m=new sap.ui.unified.Menu();m["vbi_data"]={};m["vbi_data"].menuRef="CTM";m["vbi_data"].VBIName="DynContextMenu";if(this.getChangeable()){if(a==="edgeContextMenu"){var s=e.Action.Params.Param[2]["#"];p.mAddMenuItems.push(new sap.ui.unified.MenuItem({text:sap.ui.vk.getResourceBundle().getText("OVL_AREA_EDGE_SPLIT"),select:this._handleCtxFunction.bind(this,"SPLIT",s)}));}else if(a==="handleContextMenu"){var h=e.Action.Params.Param[2]["#"];p.mAddMenuItems.push(new sap.ui.unified.MenuItem({text:sap.ui.vk.getResourceBundle().getText("OVL_AREA_HANDLE_REMOVE"),select:this._handleCtxFunction.bind(this,"REMOVE",h)}));}}if(this.hasListeners(a)){if(a==="contextMenu"){this.firecontextMenu({menu:m});}else{this[f]({index:e.Action.Params.Param[2]["#"],menu:m});}}else{p._openContextMenu(e.Action.object,this,m);}}else if(a=="click"){this.mClickPos=e.Action.AddActionProperties.AddActionProperty[0]["#"];this.fireClick({clientX:e.Action.Params.Param[0]["#"],clientY:e.Action.Params.Param[1]["#"]});}else if(a.indexOf("Click")>-1){this[f]({index:e.Action.Params.Param[2]["#"]});}else{this[f]();}};
O.prototype.getKey=function(){var k=this.getProperty("key");if(!k){k=this.getId();}return k;};
O.prototype._handleCtxFunction=function(f,c){var p=this.getPosition().split(";");var o=c*3;if(f==="REMOVE"){p.splice(o,3);}else if(f==="SPLIT"){var s=[p[o],p[o+1]];var e=(o+3<p.length)?[p[o+3],p[o+4]]:[p[0],p[1]];var m=[parseFloat(s[0])+(e[0]-s[0])/2,parseFloat(s[1])+(e[1]-s[1])/2];p.splice(o+3,0,m[0].toString(),m[1].toString(),"0");}this.setPosition(p.toString().replace(/,/g,";"));};
return O;});
sap.ui.predefine('sap/ui/vk/OverlayRenderer',function(){"use strict";var O={};
O.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapUiVkOverlay");r.writeClasses(c);r.write(">");r.write("</div>");var a;if((a=c._update())){c._load(a);}};
return O;},true);
sap.ui.predefine('sap/ui/vk/Viewer',["jquery.sap.global","./library","sap/ui/core/Control","./Scene","./ContentResource","./FlexibleControl","sap/ui/layout/VerticalLayout","sap/ui/core/ResizeHandler","./DvlException","./Messages","./ProgressIndicator","./Notifications","./ContentConnector","./ViewStateManager","./dvl/ContentManager"],function(q,l,C,S,a,F,V,R,D,M,P,N,b,c,d){"use strict";var e=q.sap.log;sap.ui.lazyRequire("sap.ui.vk.NativeViewport");sap.ui.lazyRequire("sap.ui.vk.Overlay");sap.ui.lazyRequire("sap.ui.vk.SceneTree");sap.ui.lazyRequire("sap.ui.vk.StepNavigation");sap.ui.lazyRequire("sap.ui.vk.Toolbar");sap.ui.lazyRequire("sap.ui.vk.Viewport");
var f=C.extend("sap.ui.vk.Viewer",{metadata:{library:"sap.ui.vk",properties:{enableOverlay:{type:"boolean",defaultValue:false},enableSceneTree:{type:"boolean",defaultValue:true},showSceneTree:{type:"boolean",defaultValue:true},enableStepNavigation:{type:"boolean",defaultValue:true},enableNotifications:{type:"boolean",defaultValue:true},showStepNavigation:{type:"boolean",defaultValue:false},showStepNavigationThumbnails:{type:"boolean",defaultValue:true},enableToolbar:{type:"boolean",defaultValue:true},enableProgressIndicator:{type:"boolean",defaultValue:true},width:{type:"sap.ui.core.CSSSize",defaultValue:"auto"},height:{type:"sap.ui.core.CSSSize",defaultValue:"auto"},toolbarTitle:{type:"string",defaultValue:""},shouldTrackVisibilityChanges:{type:"boolean",defaultValue:false},runtimeSettings:{type:"object",defaultValue:{}},webGLContextAttributes:{type:"object",defaultValue:{antialias:true,alpha:true,premultipliedAlpha:false}},showAllHotspots:{type:"boolean",defaultValue:false},hotspotColorABGR:{type:"int",defaultValue:0xc00000ff},hotspotColor:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(255, 0, 0, 0.7529411764705882)"}},publicMethods:["activateFullScreenMode","activateRedlineDesign","destroyRedlineDesign","getDecryptionHandler","getGraphicsCore","getNativeViewport","getRedlineDesign","getScene","getViewport","getViewStateManager","setDecryptionHandler"],aggregations:{contentResources:{type:"sap.ui.vk.ContentResource"},overlay:{type:"sap.ui.vk.Overlay",multiple:false},toolbar:{type:"sap.ui.vk.Toolbar",multiple:false,visibility:"hidden"},progressIndicator:{type:"sap.ui.vk.ProgressIndicator",multiple:false,visibility:"hidden"},viewport:{type:"sap.ui.vk.ViewportBase",multiple:false,visibility:"hidden"},nativeViewport:{type:"sap.ui.vk.NativeViewport",multiple:false,visibility:"hidden"},stepNavigation:{type:"sap.ui.vk.StepNavigation",multiple:false,visibility:"hidden"},sceneTree:{type:"sap.ui.vk.SceneTree",multiple:false,visibility:"hidden"},layout:{type:"sap.ui.layout.VerticalLayout",multiple:false,visibility:"hidden"},contentConnector:{type:"sap.ui.vk.ContentConnector",multiple:false,visibility:"hidden"},viewStateManager:{type:"sap.ui.vk.ViewStateManager",multiple:false,visibility:"hidden"},messagePopover:{type:"sap.ui.vk.Notifications",multiple:false,visibility:"hidden"}},defaultAggregation:"contentResources",events:{contentResourceChangesProcessed:{},sceneLoadingSucceeded:{parameters:{scene:{type:"sap.ui.vk.Scene"}}},sceneLoadingFailed:{parameters:{reason:{type:"object"}}},sceneDestroying:{parameters:{scene:{type:"sap.ui.vk.Scene"},preventGarbageCollection:{type:"function"}}},selectionChanged:{parameters:{selected:{type:"any[]"},unselected:{type:"any[]"}}},fullScreen:{parameters:{isFullScreen:{type:"boolean"}}},urlClicked:{parameters:{nodeRef:"any",url:"string"}},nodeClicked:{parameters:{nodeRef:"any",x:"int",y:"int"}}}}});
f.prototype.applySettings=function(s){this._inApplySettings=true;C.prototype.applySettings.apply(this,arguments);delete this._inApplySettings;if(this._viewStateManager){this._viewStateManager.setShouldTrackVisibilityChanges(this.getShouldTrackVisibilityChanges());}this._componentsState={sceneTree:{defaultEnable:this.getEnableSceneTree(),shouldBeEnabled:true,userInteractionShow:this.getShowSceneTree()},stepNavigation:{defaultEnable:this.getEnableStepNavigation(),userInteractionShow:this.getShowStepNavigation()},progressIndicator:{defaultEnable:this.getEnableProgressIndicator()},messagePopover:{defaultEnable:this.getEnableNotifications()}};this.setEnableSceneTree(false);this.setEnableStepNavigation(false);};
f.prototype.init=function(){if(C.prototype.init){C.prototype.init.apply(this);}this._contentConnector=new b(this.getId()+"-contentconnector");this.setAggregation("contentConnector",this._contentConnector);this._contentConnector.attachContentReplaced(this._handleContentReplaced,this);this._contentConnector.attachContentChangesStarted(this._handleContentChangesStarted,this);this._contentConnector.attachContentChangesFinished(this._handleContentChangesFinished,this);this._contentConnector.attachContentChangesProgress(this._handleContentChangesProgress,this);this._viewStateManager=new c(this.getId()+"-viewstatemanager",{contentConnector:this._contentConnector});this.setAggregation("viewStateManager",this._viewStateManager);e.debug("sap.ui.vk.Viewer.init() called.");this._mainScene=null;this._resizeListenerId=null;this._busyIndicatorCounter=0;this._toolbar=null;this._viewport=null;this._nativeViewport=null;this._redlineDesign=null;this._stepNavigation=null;this._sceneTree=null;this._overlayManager={initialized:false,changed:false,control:null,onNativeViewportMove:function(g){var p=g.getParameter("pan");var z=g.getParameter("zoom");this.control.setPanAndZoom(p.x,p.y,z);},onViewportZoom:function(g){var z=g.getParameter("zoomFactor");this.control.setPanAndZoom(0,0,z);},onViewportPan:function(g){var h=g.getParameter("dx");var j=g.getParameter("dy");this.control.setPanAndZoom(h,j,1);}};this._overlayManager.delegate={onAfterRendering:this._onAfterRenderingOverlay.bind(this,this._viewport,this._nativeViewport,this._overlayManager)};this._updateSizeTimer=0;this._layout=new sap.ui.layout.VerticalLayout(this.getId()+"-verticalLayout").addStyleClass("sapUiVizKitLayout");this.setAggregation("layout",this._layout);this._toolbar=new sap.ui.vk.Toolbar({title:this.getToolbarTitle(),visible:this.getEnableToolbar(),viewer:this});this.setAggregation("toolbar",this._toolbar);this._layout.addContent(this._toolbar);this._splitter=new sap.ui.layout.Splitter(this.getId()+"-splitter",{orientation:"Horizontal"});this._layout.addContent(this._splitter);this._stackedViewport=new F(this.getId()+"-stackedViewport",{width:"100%",height:"100%",layout:"Stacked",layoutData:new sap.ui.layout.SplitterLayoutData({size:"auto",minSize:200})});this._splitter.addContentArea(this._stackedViewport);this._messagePopover=new N({visible:true});this._messagePopover.attachAllMessagesCleared(this._updateLayout,this);this._messagePopover.attachMessageAdded(this._updateLayout,this);this.setAggregation("messagePopover",this._messagePopover);this._layout.addContent(this._messagePopover);this.setTooltip(sap.ui.vk.getResourceBundle().getText("VIEWER_TITLE"));if(this.getEnableProgressIndicator()){this._progressIndicator=new P({visible:false}).addStyleClass("sapUiVizKitProgressIndicator");this.setAggregation("progressIndicator",this._progressIndicator);}};
f.prototype.exit=function(){e.debug("sap.ui.vk.Viewer.exit() called.");if(this._viewport){this._viewport.detachEvent("viewActivated",this._onViewportViewActivated,this);}this._setMainScene(null);this._toolbar=null;this._messagePopover=null;this._sceneTree=null;this._nativeViewport=null;this._stepNavigation=null;this._viewport=null;this._componentsState=null;this._viewStateManager=null;this._contentConnector=null;if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}if(C.prototype.exit){C.prototype.exit.apply(this);}};
f.prototype._setMainScene=function(s){if(s){if(s!==this._mainScene){this._mainScene=s;this._showViewport();if(this._componentsState.sceneTree.defaultEnable){this._instantiateSceneTree();this.setEnableSceneTree(true);this._sceneTree.setScene(s,this._viewStateManager);if(this._componentsState.sceneTree.userInteractionShow&&this._componentsState.sceneTree.shouldBeEnabled){this.setShowSceneTree(true);this._sceneTree.setVisible(true);}else{this.setShowSceneTree(false);}}else if(this._sceneTree&&this._viewStateManager){this._sceneTree.setScene(s,this._viewStateManager);}if(this._componentsState.stepNavigation.defaultEnable){this._instantiateStepNavigation();this.setEnableStepNavigation(true);if(this._componentsState.stepNavigation.userInteractionShow){this.setShowStepNavigation(true);this._stepNavigation.setVisible(true);}else{this.setShowStepNavigation(false);}}}if(this._sceneTree){this._sceneTree.refresh();}if(this._stepNavigation){this._stepNavigation.refresh(s);}}else{this._mainScene=null;this.setEnableSceneTree(false);this.setEnableStepNavigation(false);}return this;};
f.prototype.getGraphicsCore=function(){return this._mainScene instanceof sap.ui.vk.dvl.Scene?this._mainScene.getGraphicsCore():null;};
f.prototype.getScene=function(){return this._mainScene;};
f.prototype.getViewStateManager=function(){return this._viewStateManager;};
f.prototype.getViewport=function(){return this._viewport?this._viewport.getImplementation():null;};
f.prototype.getNativeViewport=function(){return this._nativeViewport;};
f.prototype.getRedlineDesign=function(){if(i(this.getViewport())){return this._redlineDesign;}else{return null;}};
f.prototype.getOverlay=function(){return this._overlayManager.control;};
f.prototype.setEnableOverlay=function(p){if(p!==this.getProperty("enableOverlay")){this.setProperty("enableOverlay",p);this._overlayManager.changed=true;}return this;};
f.prototype.setEnableSceneTree=function(p){this.setProperty("enableSceneTree",p,true);if(!p){this.setProperty("showSceneTree",false);}this._updateLayout();return this;};
f.prototype.setEnableNotifications=function(p){this.setProperty("enableNotifications",p,true);this._messagePopover.setVisible(false);this._updateLayout();return this;};
f.prototype.setShowSceneTree=function(p){this.setProperty("showSceneTree",p,true);this._updateLayout();return this;};
f.prototype.setEnableStepNavigation=function(p){this.setProperty("enableStepNavigation",p,true);if(!p){this.setProperty("showStepNavigation",false);}this._updateLayout();return this;};
f.prototype.setShowStepNavigation=function(p){this.setProperty("showStepNavigation",p,true);this._updateLayout();return this;};
f.prototype.setEnableToolbar=function(p){this.setProperty("enableToolbar",p,true);this._updateLayout();return this;};
f.prototype.activateFullScreenMode=function(v){var g=function(j){return!!(j.fullScreen||j.webkitIsFullScreen||j.mozFullScreen||j.msFullscreenElement);};if(v){if(!g(document)){if(!this._fullScreenHandler){var t=this;this._fullScreenHandler=function(j){var k=g(document);if(!k){document.removeEventListener("fullscreenchange",t._fullScreenHandler);document.removeEventListener("mozfullscreenchange",t._fullScreenHandler);document.removeEventListener("webkitfullscreenchange",t._fullScreenHandler);document.removeEventListener("MSFullscreenChange",t._fullScreenHandler);}t.fireFullScreen({isFullScreen:k});};}var h=document.getElementsByTagName("body")[0];if(h.requestFullScreen){document.addEventListener("fullscreenchange",this._fullScreenHandler);h.requestFullScreen();}else if(h.webkitRequestFullScreen){document.addEventListener("webkitfullscreenchange",this._fullScreenHandler);h.webkitRequestFullScreen();}else if(h.mozRequestFullScreen){document.addEventListener("mozfullscreenchange",this._fullScreenHandler);h.mozRequestFullScreen();}else if(h.msRequestFullscreen){document.addEventListener("MSFullscreenChange",this._fullScreenHandler);h.msRequestFullscreen();}}this.addStyleClass("sapVizKitViewerFullScreen");}else{if(g(document)){if(document.cancelFullScreen){document.cancelFullScreen();}else if(document.webkitCancelFullScreen){document.webkitCancelFullScreen();}else if(document.mozCancelFullScreen){document.mozCancelFullScreen();}else if(document.msExitFullscreen){document.msExitFullscreen();}}this.removeStyleClass("sapVizKitViewerFullScreen");}return this;};
function i(v){if(!v){return false;}return v instanceof sap.ui.vk.dvl.Viewport;}
f.prototype.getShowAllHotspots=function(){return i(this.getViewport())?this.getViewport().getShowAllHotspots():this.getProperty("showAllHotspots");};
f.prototype.setShowAllHotspots=function(v){this.setProperty("showAllHotspots",v,true);if(i(this.getViewport())){this.getViewport().setShowAllHotspots(v);}return this;};
f.prototype.getHotspotColorABGR=function(){return i(this.getViewport())?this.getViewport().getHotspotColorABGR():this.getProperty("hotspotColorABGR");};
f.prototype.setHotspotColorABGR=function(v){this.setProperty("hotspotColorABGR",v,true);this.setProperty("hotspotColor",sap.ui.vk.colorToCSSColor(sap.ui.vk.abgrToColor(v)),true);if(i(this.getViewport())){this.getViewport().setHotspotColorABGR(v);}return this;};
f.prototype.getHotspotColor=function(){return i(this.getViewport())?this.getViewport().getHotspotColor():this.getProperty("hotspotColor");};
f.prototype.setHotspotColor=function(v){this.setProperty("hotspotColor",v,true);this.setProperty("hotspotColorABGR",sap.ui.vk.colorToABGR(sap.ui.vk.cssColorToColor(v)),true);if(i(this.getViewport())){this.getViewport().setHotspotColor(v);}return this;};
f.prototype.setRuntimeSettings=function(s){if(this._inApplySettings){this.setProperty("runtimeSettings",s,true);d.setRuntimeSettings(s);}else{e.error(sap.ui.vk.getResourceBundle().getText(M.VIT29.summary),M.VIT29.code,"sap.ui.vk.Viewer");}return this;};
f.prototype.setWebGLContextAttributes=function(g){if(this._inApplySettings){this.setProperty("webGLContextAttributes",g,true);d.setWebGLContextAttributes(g);}else{e.error(sap.ui.vk.getResourceBundle().getText(M.VIT30.summary),M.VIT30.code,"sap.ui.vk.Viewer");}return this;};
f.prototype.invalidate=function(o){if(o instanceof a){this._contentConnector.invalidate(o);return;}C.prototype.invalidate.apply(this,arguments);};
f.prototype.validateAggregation=function(g,o,m){if(g==="contentResources"){return this._contentConnector.validateAggregation(g,o,m);}return C.prototype.validateAggregation.call(this,g,o,m);};
f.prototype.getAggregation=function(g,h){if(g==="contentResources"){return this._contentConnector.getAggregation(g,h);}return C.prototype.getAggregation.call(this,g,h);};
f.prototype.setAggregation=function(g,o,s){if(g==="contentResources"){this._contentConnector.setAggregation(g,o,s);return this;}return C.prototype.setAggregation.call(this,g,o,s);};
f.prototype.addAggregation=function(g,o,s){if(g==="contentResources"){this._contentConnector.addAggregation(g,o,s);return this;}return C.prototype.addAggregation.call(this,g,o,s);};
f.prototype.insertAggregation=function(g,o,h,s){if(g==="contentResources"){this._contentConnector.insertAggregation(g,o,h,s);return this;}return C.prototype.insertAggregation.call(this,g,o,h,s);};
f.prototype.removeAggregation=function(g,o,s){if(g==="contentResources"){return this._contentConnector.removeAggregation(g,o,s);}return C.prototype.removeAggregation.call(this,g,o,s);};
f.prototype.removeAllAggregation=function(g,s){if(g==="contentResources"){return this._contentConnector.removeAllAggregation(g,s);}return C.prototype.removeAllAggregation.call(this,g,s);};
f.prototype.destroyAggregation=function(g,s){if(g==="contentResources"){this._contentConnector.destroyAggregation(g,s);return this;}return C.prototype.destroyAggregation.call(this,g,s);};
f.prototype.onBeforeRendering=function(){this._showOverlay();if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}};
f.prototype.onAfterRendering=function(){this._resizeListenerId=R.register(this,this._handleResize.bind(this));this._handleResize();};
f.prototype._handleResize=function(g){this._updateSize();if(this.getRedlineDesign()){var x=this.getRedlineDesign().exportJSON();this.getRedlineDesign().removeAllRedlineElements();q.sap.delayedCall(200,this,function(){var v;if(this.getViewport()&&this.getViewport().getVisible()){v=this.getViewport().getOutputSize();}else if(this.getNativeViewport()&&this.getNativeViewport().getVisible()){v=this.getNativeViewport().getOutputSize();}this.getRedlineDesign().setProperty("virtualLeft",v.left,true);this.getRedlineDesign().setProperty("virtualTop",v.top,true);this.getRedlineDesign().setProperty("virtualSideLength",v.sideLength,true);this.getRedlineDesign().invalidate();this.getRedlineDesign().importJSON(x);});}};
f.prototype._delayedUpdateSize=function(){if(this.getDomRef()){if(this._updateSizeTimer){clearTimeout(this._updateSizeTimer);}this._updateSizeTimer=setTimeout(this._updateSize.bind(this),0);}};
f.prototype._updateSize=function(){this._updateSizeTimer=0;if(!this.getDomRef()){return;}var h=this.getDomRef().clientHeight;if(this._toolbar&&this._toolbar.getDomRef()&&this.getEnableToolbar()){h-=this._toolbar.getDomRef().clientHeight;}if(this._stepNavigation&&this._stepNavigation.getDomRef()&&this.getShowStepNavigation()){h-=this._stepNavigation.getDomRef().clientHeight;}if(this._messagePopover&&this._messagePopover.getDomRef()&&this._messagePopover.getVisible()){h-=this._messagePopover.getDomRef().clientHeight;}if(this._sceneTree){this._sceneTree.updateHeight(h);}this._splitter.setHeight(Math.max(h,100)+"px");};
f.prototype.isTreeBinding=function(n){return n==="contentResources";};
f.prototype.setBusy=function(g){if(g){if(this._busyIndicatorCounter===0){this.setBusyIndicatorDelay(0);C.prototype.setBusy.call(this,true);}this._busyIndicatorCounter+=1;}else{this._busyIndicatorCounter-=1;if(this._busyIndicatorCounter==0){C.prototype.setBusy.call(this,false);}}};
f.prototype._updateLayout=function(){if(this._bIsBeingDestroyed){return;}if(this._sceneTree){if(this.getShowSceneTree()&&this.getEnableSceneTree()){this._sceneTree.setVisible(true);if(this._splitter.indexOfContentArea(this._sceneTree)<0){this._splitter.insertContentArea(this._sceneTree,0);}}else{if(this._splitter.indexOfContentArea(this._sceneTree)>=0){this._splitter.removeContentArea(this._sceneTree);}this._sceneTree.setVisible(false);}}if(this._stepNavigation){this._stepNavigation.setVisible(this.getShowStepNavigation()&&this.getEnableStepNavigation());}if(this._messagePopover){this._messagePopover.setVisible(this.getEnableNotifications()&&this._messagePopover.getAggregation("_messagePopover").getItems().length>0);}if(this._toolbar){this._toolbar.setVisible(this.getEnableToolbar());this._toolbar.refresh();}this._delayedUpdateSize();};
f.prototype._instantiateSceneTree=function(){if(!this._sceneTree){this._sceneTree=new sap.ui.vk.SceneTree({layoutData:new sap.ui.layout.SplitterLayoutData({size:"320px",minSize:200}),viewStateManager:this._viewStateManager,contentConnector:this._contentConnector});this.setAggregation("sceneTree",this._sceneTree);}return this;};
f.prototype._instantiateStepNavigation=function(){if(!this._stepNavigation){this._stepNavigation=new sap.ui.vk.StepNavigation(this.getId()+"-stepNavigation",{showThumbnails:this.getShowStepNavigationThumbnails(),contentConnector:this._contentConnector});this.setAggregation("stepNavigation",this._stepNavigation);this._layout.insertContent(this._stepNavigation,3);}return this;};
f.prototype._showViewport=function(){if(!this._viewport){this._viewport=new sap.ui.vk.Viewport(this.getId()+"-viewport",{viewStateManager:this._viewStateManager,selectionMode:sap.ui.vk.SelectionMode.Exclusive,contentConnector:this._contentConnector});this.setAggregation("viewport",this._viewport);this._viewport.attachEvent("viewActivated",this._onViewportViewActivated,this);var v=this.getViewport();if(i(v)){v.setHotspotColor(this.getProperty("hotspotColor"));v.setHotspotColorABGR(this.getProperty("hotspotColorABGR"));v.setShowAllHotspots(this.getProperty("showAllHotspots"));}}if(this._nativeViewport){this._nativeViewport.setVisible(false);}this._stackedViewport.removeAllContent();this._stackedViewport.addContent(this._viewport);this._viewport.setVisible(true);return this;};
f.prototype._showNativeViewport=function(){if(!this._nativeViewport){this._nativeViewport=new sap.ui.vk.NativeViewport(this.getId()+"-nativeViewport",{limitZoomOut:true,contentConnector:this._contentConnector});this.setAggregation("nativeViewport",this._nativeViewport);}if(this._viewport){this._viewport.setVisible(false);}this._stackedViewport.removeAllContent();this._stackedViewport.addContent(this._nativeViewport);this._nativeViewport.setVisible(true);return this;};
f.prototype._showOverlay=function(){var o=this._overlayManager;if(o.changed){var O;if(this.getEnableOverlay()){if(!o.initialized){if(!(O=this.getAggregation("overlay"))){O=new sap.ui.vk.Overlay();}O.setZoomOnResize(false);o.control=O;o.initialized=true;}else{O=o.control;O.reset();}if(this._nativeViewport&&this._nativeViewport.getVisible()){O.setTarget(this._nativeViewport);o.savedLimitZoomOutState=this._nativeViewport.getLimitZoomOut();this._nativeViewport.setLimitZoomOut(true);this._nativeViewport.attachEvent("move",o.onNativeViewportMove,o);}else if(this._viewport&&this._viewport.getVisible()){O.setTarget(this._viewport);o.savedLimitZoomOutState=false;this._viewport.attachEvent("zoom",o.onViewportZoom,o);this._viewport.attachEvent("pan",o.onViewportPan,o);}this._stackedViewport.addContent(O);this._stackedViewport.addDelegate(o.delegate);}else{this._nativeViewport.detachEvent("move",o.onNativeViewportMove,o);this._stackedViewport.removeDelegate(o.delegate);this._stackedViewport.removeContent(o.control);this._nativeViewport.setLimitZoomOut(o.savedLimitZoomOutState);}o.changed=false;}};
f.prototype._onAfterRenderingOverlay=function(E){var o=this._overlayManager.control.getDomRef();if(o&&(this._nativeViewport||this._viewport)){var v=this._nativeViewport&&this._nativeViewport.getVisible()?this._nativeViewport.getDomRef():this._viewport.getDomRef();if(o.parentNode!==v){o.parentNode.style.display="none";}v.appendChild(o);o.style.width="100%";o.style.height="100%";}};
f.prototype.setDecryptionHandler=function(h){d.setDecryptionHandler(h);return this;};
f.prototype.getDecryptionHandler=function(){return d.getDecryptionHandler();};
f.prototype._instantiateRedlineDesign=function(r){if((this.getViewport()&&this.getViewport().getVisible())||(this.getNativeViewport()&&this.getNativeViewport().getVisible())){var g=this.getViewport()&&this.getViewport().getVisible()?this.getViewport():this.getNativeViewport();var v=g.getOutputSize();this._redlineDesign=new sap.ui.vk.RedlineDesign({visible:false,virtualTop:v.top,virtualLeft:v.left,virtualSideLength:v.sideLength,redlineElements:r});}return this;};
f.prototype.activateRedlineDesign=function(r){if(!i(this.getViewport())){return this;}r=r||[];this._instantiateRedlineDesign(r);this.getRedlineDesign().placeAt(this._stackedViewport);this.getRedlineDesign().setVisible(true);var o=function(k){var m=k.getParameter("deltaX"),n=k.getParameter("deltaY");this.getViewport().queueCommand(function(m,n){this.getViewport().pan(m,n);this.getViewport().endGesture();}.bind(this,m,n));};var g=function(k){var m=k.getParameter("originX"),n=k.getParameter("originY"),z=k.getParameter("zoomFactor");this.getViewport().queueCommand(function(m,n,z){this.getViewport().beginGesture(m,n);this.getViewport().zoom(z);this.getViewport().endGesture();}.bind(this,m,n,z));};var h=function(k){var m=k.getParameter("deltaX"),n=k.getParameter("deltaY");this.getNativeViewport().queueCommand(function(){this.getNativeViewport().pan(m,n);this.getNativeViewport().endGesture();}.bind(this));};var j=function(k){var m=k.getParameter("originX"),n=k.getParameter("originY"),z=k.getParameter("zoomFactor");this.getNativeViewport().queueCommand(function(m,n,z){this.getNativeViewport().beginGesture(m,n);this.getNativeViewport().zoom(z);this.getNativeViewport().endGesture();}.bind(this,m,n,z));};if(this.getNativeViewport()&&this.getNativeViewport().getVisible()){this.getRedlineDesign().attachEvent("pan",h.bind(this));this.getRedlineDesign().attachEvent("zoom",j.bind(this));}else if(this.getViewport()&&this.getViewport().getVisible()){this.getRedlineDesign().attachEvent("pan",o.bind(this));this.getRedlineDesign().attachEvent("zoom",g.bind(this));}return this;};
f.prototype.destroyRedlineDesign=function(){if(this.getRedlineDesign()){this.getRedlineDesign().destroy();this._redlineDesign=null;}return this;};
f.prototype._onViewportViewActivated=function(g){this._componentsState.sceneTree.shouldBeEnabled=g.getParameter("type")==="3D";};
f.prototype._handleContentReplaced=function(g){var h=g.getParameter("newContent");if(h instanceof sap.ui.vk.Scene){this._showViewport();if(this.getRedlineDesign()){this.getRedlineDesign().updatePanningRatio();}this._setMainScene(h);}else if(h instanceof HTMLImageElement||h instanceof HTMLObjectElement){this._setMainScene(null);this._showNativeViewport();if(this.getEnableOverlay()){this._overlayManager.changed=true;this._showOverlay();}}else{this._setMainScene(null);if(this._viewport){this._viewport.setVisible(false);}if(this._nativeViewport){this._nativeViewport.setVisible(false);}this._stackedViewport.removeAllContent();}};
f.prototype._handleContentChangesStarted=function(g){this.setBusy(true);if(this._componentsState.progressIndicator.defaultEnable){this._progressIndicator.setPercentValue(0.0);this._progressIndicator.setVisible(true);}};
f.prototype._handleContentChangesFinished=function(g){e.info("Finished");this._progressIndicator.setVisible(false);this._progressIndicator.setDisplayValue("");this._progressIndicator.setPercentValue(0);this.setBusy(false);var h=g.getParameter("content");if(h){this.fireSceneLoadingSucceeded({scene:h});}var j=g.getParameter("failureReason");if(j){this.fireSceneLoadingFailed({reason:j});if(this.getEnableNotifications()===false){this._showNativeViewport();if(j.errorMessage==="The content resources cannot be loaded. The type of content resources is unknown."){this._nativeViewport.loadFailed();}else{var k=sap.ui.vk.getResourceBundle().getText("VIEWPORT_MESSAGEERRORLOADINGFILE");this._nativeViewport.loadFailed(k);}}(Array.isArray(j)?j:[j]).forEach(function(r){e.error(r.errorMessage,"","sap.ui.vk.Viewer");});}this.fireContentResourceChangesProcessed();};
f.prototype._handleContentChangesProgress=function(g){if(this._progressIndicator.getVisible()){var s=g.getParameter("source"),p=g.getParameter("percentage"),h=s.match(/\..{3,4}$/),j=h&&h[0]?s.split(/\\|\//).pop()+" ":"";this._progressIndicator.setPercentValue(p);this._progressIndicator.setDisplayValue(j+sap.ui.vk.getResourceBundle().getText("PROGRESS_INDICATOR_DOWNLOADING")+" "+(p?Math.floor(p)+"%":""));}};
f.prototype._handleContentDestroying=function(g){this.fireSceneDestroying({scene:g.getParameter("content"),preventGarbageCollection:g.getParameter("preventGarbageCollection")});};
return f;});
sap.ui.predefine('sap/ui/vk/library',["jquery.sap.global","./TransformationMatrix","./DvlException","./Core"],function(q,T,D,C){"use strict";var l=q.sap.log;sap.ui.getCore().initLibrary({name:"sap.ui.vk",dependencies:["sap.ui.core"],types:["sap.ui.vk.CameraFOVBindingType","sap.ui.vk.CameraProjectionType","sap.ui.vk.ContentResourceSourceCategory","sap.ui.vk.dvl.GraphicsCoreApi","sap.ui.vk.SelectionMode","sap.ui.vk.TransformationMatrix","sap.ui.vk.VisibilityMode","sap.ui.vk.ZoomTo"],interfaces:["sap.ui.vk.DecryptionHandler"],controls:["sap.ui.vk.ContainerBase","sap.ui.vk.ContainerContent","sap.ui.vk.DockContainer","sap.ui.vk.DockManager","sap.ui.vk.DockPane","sap.ui.vk.FlexibleControl","sap.ui.vk.LegendItem","sap.ui.vk.ListPanel","sap.ui.vk.ListPanelStack","sap.ui.vk.MapContainer","sap.ui.vk.NativeViewport","sap.ui.vk.Notifications","sap.ui.vk.Overlay","sap.ui.vk.RedlineDesign","sap.ui.vk.RedlineSurface","sap.ui.vk.SceneTree","sap.ui.vk.StepNavigation","sap.ui.vk.Toolbar","sap.ui.vk.Viewer","sap.ui.vk.Viewport","sap.ui.vk.ViewportBase","sap.ui.vk.dvl.Viewport","sap.ui.vk.threejs.Viewport"],elements:["sap.ui.vk.ContentConnector","sap.ui.vk.OverlayArea","sap.ui.vk.RedlineElement","sap.ui.vk.RedlineElementEllipse","sap.ui.vk.RedlineElementFreehand","sap.ui.vk.RedlineElementRectangle","sap.ui.vk.ViewStateManager","sap.ui.vk.ViewStateManagerBase","sap.ui.vk.dvl.ViewStateManager","sap.ui.vk.threejs.ViewStateManager"],noLibraryCSS:false,version:"1.50.7"});var a=function(b,s){var m="new extend getMetadata";if(s){m+=" "+s;}sap.ui.lazyRequire("sap.ui.vk."+b,m);};a("ContentConnector","registerSourceType");a("ContentResource");a("ContentManager");a("DownloadManager");a("ImageContentManager");a("Loco");a("LayerProxy");a("NodeHierarchy");a("NodeProxy");a("Scene");a("ViewportHandler");a("dvl.GraphicsCore");a("dvl.BaseNodeProxy");a("dvl.ContentManager","getRuntimeSettings setRuntimeSettings getWebGLContextAttributes setWebGLContextAttributes getDecryptionHandler setDecryptionHandler");a("dvl.LayerProxy");a("dvl.NodeHierarchy");a("dvl.NodeProxy");a("dvl.Scene");a("threejs.BaseNodeProxy");a("threejs.ContentManager","registerLoader");a("threejs.LayerProxy");a("threejs.NodeHierarchy");a("threejs.NodeProxy");a("threejs.Scene");sap.ui.vk.dvl.GraphicsCoreApi={LegacyDvl:"LegacyDvl"};sap.ui.vk.ContentResourceSourceCategory={"3D":"3D","2D":"2D"};sap.ui.vk.CameraProjectionType={Perspective:"perspective",Orthographic:"orthographic"};sap.ui.vk.CameraFOVBindingType={Minimum:"minimum",Maximum:"maximum",Horizontal:"horizontal",Vertical:"vertical"};sap.ui.vk.VisibilityMode={Complete:"complete",Differences:"differences"};sap.ui.vk.ZoomTo={All:"all",Visible:"visible",Selected:"selected",Node:"node",NodeSetIsolation:"node_setisolation",Restore:"restore",RestoreRemoveIsolation:"restore_removeisolation",ViewLeft:"view_left",ViewRight:"view_right",ViewTop:"view_top",ViewBottom:"view_bottom",ViewBack:"view_back",ViewFront:"view_front"};sap.ui.vk.SelectionMode={None:"none",Exclusive:"exclusive",Sticky:"sticky"};sap.ui.vk.ContentResourceSourceTypeToCategoryMap={"vds":sap.ui.vk.ContentResourceSourceCategory["3D"],"vdsl":sap.ui.vk.ContentResourceSourceCategory["3D"],"cgm":sap.ui.vk.ContentResourceSourceCategory["3D"],"png":sap.ui.vk.ContentResourceSourceCategory["2D"],"jpg":sap.ui.vk.ContentResourceSourceCategory["2D"],"gif":sap.ui.vk.ContentResourceSourceCategory["2D"],"bmp":sap.ui.vk.ContentResourceSourceCategory["2D"],"tiff":sap.ui.vk.ContentResourceSourceCategory["2D"],"tif":sap.ui.vk.ContentResourceSourceCategory["2D"],"svg":sap.ui.vk.ContentResourceSourceCategory["2D"]};var d="sap.ve.dvl";
sap.ui.vk.dvl.checkResult=function(r){if(r<0){var m=sap.ve.dvl.DVLRESULT.getDescription?sap.ve.dvl.DVLRESULT.getDescription(r):"";l.error(m,JSON.stringify({errorCode:r}),d);throw new D(r,m);}return r;};
sap.ui.vk.dvl.getPointer=function(p){if(typeof p==="number"){var r=p;var m=sap.ve.dvl.DVLRESULT.getDescription?sap.ve.dvl.DVLRESULT.getDescription(r):"";l.error(m,JSON.stringify({errorCode:r}),d);throw new D(r,m);}return p;};
sap.ui.vk.dvl.getJSONObject=function(o){if(typeof o==="number"){var r=o;var m=sap.ve.dvl.DVLRESULT.getDescription?sap.ve.dvl.DVLRESULT.getDescription(r):"";l.error(m,JSON.stringify({errorCode:r}),d);throw new D(r,m);}return o;};
sap.ui.vk.getResourceBundle=function(){var r=sap.ui.getCore().getLibraryResourceBundle("sap.ui.vk.i18n");sap.ui.vk.getResourceBundle=function(){return r;};return r;};
sap.ui.vk.utf8ArrayBufferToString=function(b){return decodeURIComponent(escape(String.fromCharCode.apply(null,new Uint8Array(b))));};
sap.ui.vk.Redline={ElementType:{Rectangle:"rectangle",Ellipse:"ellipse",Freehand:"freehand"},svgNamespace:"http://www.w3.org/2000/svg"};sap.ui.vk.cssColorToColor=(function(){var i=false;var b=document.createElement("div");b.id="sap.ui.vk.colorConverter";b.style.setProperty("display","none","important");return function(c){if(!i){if(document.body){document.body.appendChild(b);i=true;}else{return{red:0,green:0,blue:0,alpha:1};}}b.style.setProperty("color","rgba(0, 0, 0, 0)","important");b.style.setProperty("color",c,"important");var e=window.getComputedStyle(b).color;if(e==="transparent"){return{red:0,green:0,blue:0,alpha:0};}else{var f=e.split("(")[1].split(")")[0].split(",");return{red:parseInt(f[0],10),green:parseInt(f[1],10),blue:parseInt(f[2],10),alpha:f.length===4?parseFloat(f[3]):1};}};})();
sap.ui.vk.colorToCSSColor=function(c){return"rgba("+c.red+","+c.green+","+c.blue+","+c.alpha+")";};
sap.ui.vk.abgrToColor=function(b){return{red:b&0xff,green:b>>>8&0xff,blue:b>>>16&0xff,alpha:(b>>>24&0xff)/255};};
sap.ui.vk.colorToABGR=function(c){return(c.alpha*255<<24|c.blue<<16|c.green<<8|c.red)>>>0;};
return sap.ui.vk;});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine('sap/ui/vk/BaseNodeProxy',["jquery.sap.global","sap/ui/base/Object"],function(q,B){"use strict";
var a=B.extend("sap.ui.vk.dvl.BaseNodeProxy",{metadata:{"abstract":true}});
return a;});
sap.ui.predefine('sap/ui/vk/CheckEye',["jquery.sap.global","sap/ui/commons/CheckBox","./library"],function(q,C,l){"use strict";
var a=C.extend("sap.ui.vk.CheckEye",{
metadata:{library:"sap.ui.vk",properties:{}},
onAfterRendering:function(){var $=this.$();$.removeClass("sapUiCb");$.removeClass("sapUiCbChk");$.removeClass("sapUiCbInteractive");$.removeClass("sapUiCbStd");$.addClass("sapUiVkCheckEye");},
renderer:{}
});
return a;},true);
sap.ui.predefine('sap/ui/vk/ContentConnector',["jquery.sap.global","sap/ui/base/ManagedObjectObserver","sap/ui/core/Element","./Messages","./Core"],function(q,M,E,a,V){"use strict";var l=q.sap.log;
var C=E.extend("sap.ui.vk.ContentConnector",{metadata:{library:"sap.ui.vk",publicMethods:["getContent","getContentManager"],aggregations:{contentResources:{type:"sap.ui.vk.ContentResource",bindable:"bindable"},viewStateManagers:{type:"sap.ui.vk.ViewStateManager"},contentManagers:{type:"sap.ui.vk.ContentManager",visibility:"hidden"}},defaultAggregation:"contentResources",events:{contentChangesStarted:{parameters:{}},contentChangesFinished:{parameters:{content:{type:"any"},failureReason:{type:"any"}}},contentChangesProgress:{parameters:{phase:{type:"string"},percentage:{type:"float"},source:{type:"any"}}},contentReplaced:{parameters:{newContent:{type:"any"},oldContent:{type:"any"}}},contentDestroying:{parameters:{content:{type:"any"},preventGarbageCollection:{type:"function"}}}}}});
sap.ui.vk.getCore().registerClass(C);var b=C.getMetadata().getParent().getClass().prototype;
C.prototype.isTreeBinding=function(n){return n==="contentResources";};
C.prototype.init=function(){if(b.init){b.init.call(this);}this._inLoading=false;this._delayContentResourcesUpdate=false;this._scheduleContentResourcesUpdateTimerId=null;this._content=null;this._contentManager=null;this._selfObserver=new M(this._observeChanges.bind(this));this._selfObserver.observe(this,{aggregations:["contentResources","viewStateManagers"]});};
C.prototype.exit=function(){this._selfObserver.disconnect();this._selfObserver=null;if(this._scheduleContentResourcesUpdateTimerId){q.sap.clearDelayedCall(this._scheduleContentResourcesUpdateTimerId);this._scheduleContentResourcesUpdateTimerId=null;}this._delayContentResourcesUpdate=false;this._setContent(null,null);if(b.exit){b.exit.call(this);}};
C.prototype._observeChanges=function(d){if(d.name==="contentResources"){this._scheduleContentResourcesUpdate();}else if(d.name==="viewStateManagers"){if(d.mutation==="insert"){d.child.setContentConnector(this);}else if(d.mutation==="remove"){d.child.setContentConnector(null);}}};
C.prototype.invalidate=function(o){if(sap.ui.vk.ContentResource&&o instanceof sap.ui.vk.ContentResource){this._scheduleContentResourcesUpdate();return;}b.invalidate.apply(this,arguments);};
C.prototype._scheduleContentResourcesUpdate=function(){if(this._inLoading){this._delayContentResourcesUpdate=true;return this;}if(!this._scheduleContentResourcesUpdateTimerId){this._scheduleContentResourcesUpdateTimerId=q.sap.delayedCall(0,this,function(){this._scheduleContentResourcesUpdateTimerId=null;var d=this.getContentResources();if(d.length>0){this._collectContentResourceSourceTypeInformation(d).then(function(i){if(i.dimensions.length>1){q.sap.delayedCall(0,this,function(){this.fireContentChangesStarted();this._setContent(null,null);this.fireContentChangesFinished({content:null,failureReason:{errorMessage:sap.ui.vk.getResourceBundle().getText(a.VIT17.cause)}});l.error(sap.ui.vk.getResourceBundle().getText(a.VIT17.summary),a.VIT17.code,"sap.ui.vk.ContentConnector");});}else if(i.contentManagerClassNames.length>1){q.sap.delayedCall(0,this,function(){this.fireContentChangesStarted();this._setContent(null,null);this.fireContentChangesFinished({content:null,failureReason:{errorMessage:sap.ui.vk.getResourceBundle().getText(a.VIT35.cause)}});l.error(sap.ui.vk.getResourceBundle().getText(a.VIT35.summary),a.VIT35.code,"sap.ui.vk.ContentConnector");});}else if(i.contentManagerClassNames.length===0){q.sap.delayedCall(0,this,function(){this.fireContentChangesStarted();this._setContent(null,null);this.fireContentChangesFinished({content:null,failureReason:{errorMessage:sap.ui.vk.getResourceBundle().getText(a.VIT36.cause)}});l.error(sap.ui.vk.getResourceBundle().getText(a.VIT36.summary),a.VIT36.code,"sap.ui.vk.ContentConnector");});}else if(i.contentManagerClassNames.length===1){var e=this._getContentManagerByClassName(i.contentManagerClassNames[0]);if(e!==this._contentManager){this._setContent(null,null);}e.loadContent(this._content,d);}}.bind(this));}else{q.sap.delayedCall(0,this,function(){this.fireContentChangesStarted();this._setContent(null,null);this.fireContentChangesFinished({content:null});});}});}return this;};
C.prototype._handleContentChangesStarted=function(e){this._inLoading=true;this.fireContentChangesStarted();};
C.prototype._handleContentChangesFinished=function(e){var d=e.getParameter("content");this._setContent(d,e.getSource());this.fireContentChangesFinished({content:d,failureReason:e.getParameter("failureReason")});this._inLoading=false;if(this._delayContentResourcesUpdate){this._delayContentResourcesUpdate=false;this._scheduleContentResourcesUpdate();}};
C.prototype._handleContentChangesProgress=function(e){this.fireContentChangesProgress({phase:e.getParameter("phase"),source:e.getParameter("source"),percentage:e.getParameter("percentage")});};
C.prototype._getContentManagerByClassName=function(d){var e,g=this.getAggregation("contentManagers",[]);for(var i=0,h=g.length;i<h;++i){e=g[i];if(e.getMetadata().getName()===d){return e;}}q.sap.require(d);e=new(q.sap.getObject(d));this.addAggregation("contentManagers",e);e.attachContentChangesStarted(this._handleContentChangesStarted,this);e.attachContentChangesFinished(this._handleContentChangesFinished,this);e.attachContentChangesProgress(this._handleContentChangesProgress,this);return e;};
C.prototype.getContent=function(){return this._content;};
C.prototype.getContentManager=function(){return this._contentManager;};
C.prototype._setContent=function(n,d){var o=this._content,e=this._contentManager;if(o!==n){this._content=n;this._contentManager=d;this.fireContentReplaced({oldContent:o,newContent:n});if(o){var p=false;this.fireContentDestroying({content:o,preventGarbageCollection:function(v){p=v;}});e.destroyContent(o);if(!p){e.collectGarbage();}}}return this;};
var r=[{pattern:/(^threejs[:.])|(^(threejs|stream)$)/,dimension:3,contentManagerClassName:"sap.ui.vk.threejs.ContentManager"},{pattern:/^vdsl?$/,dimension:3,contentManagerClassName:"sap.ui.vk.dvl.ContentManager"},{pattern:/^(png|jpg|gif|bmp|tiff?|svg)$/,dimension:2,contentManagerClassName:"sap.ui.vk.ImageContentManager"},{pattern:"cgm",dimension:2,contentManagerClassName:"sap.ui.vk.dvl.ContentManager"}];var c=function(d){return new Promise(function(e,g){var h=r.slice();var t=function(i){if(i>=h.length){g();return;}var j=h[i];(function(){if(typeof j==="function"){return j(d);}else if(typeof j.pattern==="string"){if(j.pattern===d.getSourceType()){return Promise.resolve(j);}}else if(j.pattern instanceof RegExp){if(j.pattern.test(d.getSourceType())){return Promise.resolve(j);}}return Promise.reject();})().then(function(v){e({dimension:v.dimension,contentManagerClassName:v.contentManagerClassName,settings:v.settings});},function(){t(i+1);});};t(0);});};
C.addContentManagerResolver=function(d){if(typeof d==="function"){r.unshift(d);}else{r.unshift({pattern:d.pattern,dimension:d.dimension,contentManagerClassName:d.contentManagerClassName,settings:d.settings});}return this;};
C.removeAllContentManagerResolvers=function(){r=[];return this;};
C.removeContentManagerResolver=function(d){var e=typeof d==="function",g=typeof d==="string",h=d instanceof RegExp;for(var i=0,j=r.length;i<j;++i){if(e||g){if(r[i]===d){r.splice(i,1);return true;}}else if(h){if(typeof r[i]==="object"&&r[i].pattern instanceof RegExp&&r[i].pattern.source===d.source){r.splice(i,1);return true;}}}return false;};
C.prototype._collectContentResourceSourceTypeInformation=function(d){var n=false,u=false,e={},g={},h=[];d.forEach(function flatten(i){h.push(i);i.getContentResources().forEach(flatten);});return Promise.all(h.map(function(i){return c(i).then(function(j){e[j.dimension]=true;g[j.contentManagerClassName]=true;return j;},function(){if(i.getSourceType()){u=true;}else{n=true;}return false;});})).then(function(j){for(var i=0,k=h.length;i<k;++i){if(j[i]){h[i]._contentManagerResolver=j[i];}}return{noSourceTypes:n,unknownSourceTypes:u,dimensions:Object.getOwnPropertyNames(e).sort(),contentManagerClassNames:Object.getOwnPropertyNames(g)};});};
var f=C.getMetadata().getName();var m={init:function(){this._contentConnector=null;sap.ui.vk.getCore().attachEvent(f+"-created",this._handleContentConnectorCreated,this).attachEvent(f+"-destroying",this._handleContentConnectorDestroying,this);},exit:function(){this.setContentConnector(null);sap.ui.vk.getCore().detachEvent(f+"-destroying",this._handleContentConnectorDestroying,this).detachEvent(f+"-created",this._handleContentConnectorCreated,this);},setContentConnector:function(d){this.setAssociation("contentConnector",d,true);this._updateContentConnector();return this;},_updateContentConnector:function(){var n=this.getContentConnector(),d=n&&sap.ui.getCore().byId(n)||null;if(this._contentConnector!==d){this._clearContentConnector();if(d){if(this._handleContentChangesStarted){d.attachContentChangesStarted(this._handleContentChangesStarted,this);}if(this._handleContentChangesFinished){d.attachContentChangesFinished(this._handleContentChangesFinished,this);}if(this._handleContentChangesProgress){d.attachContentChangesProgress(this._handleContentChangesProgress,this);}if(this._handleContentReplaced){d.attachContentReplaced(this._handleContentReplaced,this);}if(this._handleContentDestroying){d.attachContentDestroying(this._handleContentDestroying,this);}this._contentConnector=d;if(this._onAfterUpdateContentConnector){this._onAfterUpdateContentConnector();}}}return this;},_clearContentConnector:function(){if(this._contentConnector){if(this._onBeforeClearContentConnector){this._onBeforeClearContentConnector();}if(this._handleContentDestroying){this._contentConnector.detachContentDestroying(this._handleContentDestroying,this);}if(this._handleContentReplaced){this._contentConnector.detachContentReplaced(this._handleContentReplaced,this);}if(this._handleContentChangesProgress){this._contentConnector.detachContentChangesProgress(this._handleContentChangesProgress,this);}if(this._handleContentChangesFinished){this._contentConnector.detachContentChangesFinished(this._handleContentChangesFinished,this);}if(this._handleContentChangesStarted){this._contentConnector.detachContentChangesStarted(this._handleContentChangesStarted,this);}this._contentConnector=null;}return this;},_handleContentConnectorCreated:function(e){if(this.getContentConnector()===e.getParameter("object").getId()){this._updateContentConnector();}},_handleContentConnectorDestroying:function(e){if(this.getContentConnector()===e.getParameter("object").getId()){this._clearContentConnector();}}};
C.injectMethodsIntoClass=function(d){var p=d.prototype,i=p.init,e=p.exit;p.init=function(){if(i){i.call(this);}m.init.call(this);};p.exit=function(){m.exit.call(this);if(e){e.call(this);}};p.setContentConnector=m.setContentConnector;p._updateContentConnector=m._updateContentConnector;p._clearContentConnector=m._clearContentConnector;p._handleContentConnectorCreated=m._handleContentConnectorCreated;p._handleContentConnectorDestroying=m._handleContentConnectorDestroying;};
return C;});
sap.ui.predefine('sap/ui/vk/ContentManager',["jquery.sap.global","sap/ui/base/ManagedObject"],function(q,M){"use strict";
var C=M.extend("sap.ui.vk.ContentManager",{metadata:{library:"sap.ui.vk",events:{contentChangesStarted:{parameters:{}},contentChangesFinished:{parameters:{content:{type:"any"},failureReason:{type:"object"}}},contentChangesProgress:{parameters:{phase:{type:"string"},percentage:{type:"float"},source:{type:"any"}}}}}});
C.prototype.destroyContent=function(c){return this;};
C.prototype.collectGarbage=function(){return this;};
return C;});
sap.ui.predefine('sap/ui/vk/ContentResource',["jquery.sap.global","./library","sap/ui/base/ManagedObject"],function(q,l,M){"use strict";
var C=M.extend("sap.ui.vk.ContentResource",{
metadata:{properties:{source:"any",sourceType:"string",sourceId:"string",localMatrix:"sap.ui.vk.TransformationMatrix",name:"string",password:"string"},aggregations:{contentResources:"sap.ui.vk.ContentResource"},publicMethods:["getNodeProxy","getSourceProperties"]},
constructor:function(i,s,S){M.apply(this,arguments);}
});
C.prototype.isTreeBinding=function(n){return n==="contentResources";};
C.prototype.destroy=function(){M.prototype.destroy.call(this);};
C.prototype.setLocalMatrix=function(v){var n=this.getNodeProxy();if(n){n.setLocalMatrix(v);}this.setProperty("localMatrix",v,true);return this;};
C.prototype.getSourceProperties=function(){return this._shadowContentResource&&this._shadowContentResource.sourceProperties||{};};
C.prototype.getNodeProxy=function(){return this._shadowContentResource&&this._shadowContentResource.nodeProxy||null;};
C.collectCategories=function(r){var c=[];var m={};function g(a){var s=(a.getSourceType()||"").toLowerCase();if(s){var b=sap.ui.vk.ContentResourceSourceTypeToCategoryMap[s]||"unknown";if(!m.hasOwnProperty(b)){m[b]=true;c.push(b);}}a.getContentResources().forEach(g);}r.forEach(g);return c;};
return C;});
sap.ui.predefine('sap/ui/vk/Core',["jquery.sap.global","sap/ui/base/ManagedObject"],function(q,M){"use strict";
var C=M.extend("sap.ui.vk.Core",{
metadata:{publicMethods:["registerClass"]},
constructor:function(){if(sap.ui.vk.getCore&&sap.ui.vk.getCore()){return sap.ui.vk.getCore();}M.call(this);sap.ui.vk.getCore=q.sap.getter(this);this._classes=[];}
});
C.prototype.registerClass=function(c){if(this._classes.indexOf(c)>=0){return this;}var t=this,f=c.getMetadata().getName(),e=f+"-created",a=f+"-destroying",b=c.prototype.register,d=c.prototype.deregister;c.prototype.register=function(){if(b){b.call(this);}t.fireEvent(e,{object:this});};c.prototype.deregister=function(){t.fireEvent(a,{object:this});if(d){d.call(this);}};this._classes.push(c);return this;};
return new C();});
sap.ui.predefine('sap/ui/vk/DockManagerRenderer',["jquery.sap.global"],function(q){"use strict";var D={};
D.render=function(r,c){var a=r;a.write("<div");a.writeControlData(c);a.writeClasses();if(c.getWidth()&&c.getWidth()!=""){a.addStyle("width",c.getWidth());}if(c.getHeight()&&c.getHeight()!=""){a.addStyle("height",c.getHeight());}a.writeStyles();a.write(">");a.write("</div>");};
return D;},true);
sap.ui.predefine('sap/ui/vk/DownloadManager',["jquery.sap.global","./library","sap/ui/base/EventProvider","./Messages"],function(q,l,E,M){"use strict";
var D=E.extend("sap.ui.vk.DownloadManager",{
metadata:{publicMethods:["start","attachItemSucceeded","detachItemSucceeded","attachItemFailed","detachItemFailed","attachAllItemsCompleted","detachAllItemsCompleted"],events:{itemSucceeded:{parameters:{source:{type:"any"},response:{type:"object"}}},itemProgress:{parameters:{source:{type:"any"},loaded:{type:"int"},total:{type:"int"}}},itemFailed:{parameters:{source:{type:"any"},status:{type:"any"},statusText:{type:"string"}}},allItemsCompleted:{}}},
constructor:function(s,m){E.apply(this);this._maxParallelTasks=m||5;this._sourcesToProcess=s.slice();this._sourcesBeingProcessed=[];}
});
D.prototype.start=function(){while(this._pickAndDispatchTask()){}return this;};
D.prototype.queue=function(s){this._sourcesToProcess.push(s);this._pickAndDispatchTask();return this;};
D.prototype._pickAndDispatchTask=function(){if(this._sourcesToProcess.length>0&&this._sourcesBeingProcessed.length<this._maxParallelTasks){var s=this._sourcesToProcess.shift();this._sourcesBeingProcessed.push(s);this._runTask(s);return true;}return false;};
D.prototype._taskFinished=function(s){var i=this._sourcesBeingProcessed.indexOf(s);if(i>=0){this._sourcesBeingProcessed.splice(i,1);}return this;};
D.prototype._queueIsEmpty=function(){return this._sourcesToProcess.length===0&&this._sourcesBeingProcessed.length===0;};
D.prototype._runTask=function(s){var t=this;if(typeof s==="string"){var x=new(typeof sinon==="object"&&sinon.xhr&&sinon.xhr.XMLHttpRequest||XMLHttpRequest);x.onerror=function(e){t._taskFinished(s);t._pickAndDispatchTask();t.fireItemFailed({source:s,status:x.status,statusText:x.statusText});if(t._queueIsEmpty()){t._asyncFireAllItemsCompleted();}};x.onload=function(e){t._taskFinished(s);t._pickAndDispatchTask();if(x.status===200||x.status===0){t.fireItemSucceeded({source:s,response:x.response});}else{t.fireItemFailed({source:s,status:x.status,statusText:x.statusText});}if(t._queueIsEmpty()){t._asyncFireAllItemsCompleted();}};x.onprogress=function(e){t.fireItemProgress({source:s,loaded:e.loaded,total:e.total});};x.open("GET",s,true);x.responseType="arraybuffer";x.send(null);}else if(s instanceof File){var f=new FileReader();f.onload=function(e){t._taskFinished(s);t._pickAndDispatchTask();t.fireItemSucceeded({source:s,response:f.result});if(t._queueIsEmpty()){t._asyncFireAllItemsCompleted();}};f.onerror=function(e){t._taskFinished(s);t._pickAndDispatchTask();t.fireItemFailed({source:s,status:f.error.name,statusText:f.error.message});if(t._queueIsEmpty()){t._asyncFireAllItemsCompleted();}};f.onprogress=function(e){t.fireItemProgress({source:s.name,loaded:e.loaded,total:e.total});};f.readAsArrayBuffer(s);}else{q.sap.log.error(sap.ui.vk.getResourceBundle().getText(M.VIT5.summary),M.VIT5.code,"sap.ui.vk.DownloadManager");}return this;};
D.prototype._asyncFireAllItemsCompleted=function(){q.sap.delayedCall(0,this,this.fireAllItemsCompleted);};
D.prototype.attachItemSucceeded=function(d,f,a){return this.attachEvent("itemSucceeded",d,f,a);};
D.prototype.detachItemSucceeded=function(f,a){return this.detachEvent("itemSucceeded",f,a);};
D.prototype.fireItemSucceeded=function(p,a,e){return this.fireEvent("itemSucceeded",p,a,e);};
D.prototype.attachItemFailed=function(d,f,a){return this.attachEvent("itemFailed",d,f,a);};
D.prototype.detachItemFailed=function(f,a){return this.detachEvent("itemFailed",f,a);};
D.prototype.fireItemFailed=function(p,a,e){return this.fireEvent("itemFailed",p,a,e);};
D.prototype.attachAllItemsCompleted=function(d,f,a){return this.attachEvent("allItemsCompleted",d,f,a);};
D.prototype.detachAllItemsCompleted=function(f,a){return this.detachEvent("allItemsCompleted",f,a);};
D.prototype.fireAllItemsCompleted=function(p,a,e){return this.fireEvent("allItemsCompleted",p,a,e);};
D.prototype.attachItemProgress=function(d,f,a){return this.attachEvent("itemProgress",d,f,a);};
D.prototype.detachItemProgress=function(f,a){return this.detachEvent("itemProgress",f,a);};
D.prototype.fireItemProgress=function(p,a,e){return this.fireEvent("itemProgress",p,a,e);};
return D;});
sap.ui.predefine('sap/ui/vk/DvlException',["sap/ui/base/Exception"],function(E){"use strict";var D=function(c,m){this.name="DvlException";this.code=c;this.message=m;};D.prototype=Object.create(E.prototype);return D;});
sap.ui.predefine('sap/ui/vk/FlexibleControl',["jquery.sap.global","sap/ui/core/Control","sap/ui/core/EnabledPropagator","./library"],function(q,C,E,l){"use strict";
var F=C.extend("sap.ui.vk.FlexibleControl",{metadata:{library:"sap.ui.vk",properties:{width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},height:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},layout:{type:"string",group:"Behavior",defaultValue:"Stacked"},enabled:{type:"boolean",group:"Behavior",defaultValue:true}},defaultAggregation:"content",aggregations:{content:{type:"sap.ui.core.Control",multiple:true,singularName:"content"}},designTime:true}});
E.call(F.prototype);return F;},true);
sap.ui.predefine('sap/ui/vk/FlexibleControlLayoutData',["jquery.sap.global","sap/ui/core/LayoutData","./library"],function(q,L,l){"use strict";
var F=L.extend("sap.ui.vk.FlexibleControlLayoutData",{metadata:{library:"sap.ui.vk",properties:{size:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"auto"},minSize:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"0px"},marginTop:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"0px"},marginBottom:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"0px"}}}});
return F;},true);
sap.ui.predefine('sap/ui/vk/FlexibleControlRenderer',["jquery.sap.global"],function(q){"use strict";var F={};
F.render=function(r,f){var a=r;a.write("<div");a.writeControlData(f);a.addClass("sapUiFlexControl");if(f.getWidth()&&f.getWidth()!=""){a.addStyle("width",f.getWidth());}if(f.getHeight()&&f.getHeight()!=""){a.addStyle("height",f.getHeight());}a.writeStyles();a.writeClasses();a.write(">");var c=f.getContent();var l=f.getLayout();var b="sapUiFlexCellStacked";if(l=="Vertical"){b="sapUiFlexCellVertical";}for(var i=0;i<c.length;i++){var d=c[i];a.write("<div id=\""+f.getId()+"Content_"+i+"\" class=\""+b+"\"");var e=d.getLayoutData();if(e&&l!="Stacked"){a.write(" style=\"");if(e.getSize()&&e.getSize()!=""){a.write("height: "+e.getSize()+";");}if(e.getMinSize()&&e.getMinSize()!=""){a.write("min-height: "+e.getMinSize()+";");}if(e.getMarginTop()&&e.getMarginTop()!=""){a.write("margin-top: "+e.getMarginTop()+";");}if(e.getMarginBottom()&&e.getMarginBottom()!=""){a.write("margin-bottom: "+e.getMarginBottom()+";");}a.write("\"");}a.write(">");a.renderControl(d);a.write("</div>");}a.write("</div>");};
return F;},true);
sap.ui.predefine('sap/ui/vk/ImageContentManager',["jquery.sap.global","./Messages","./ContentManager"],function(q,M,C){"use strict";
var I=C.extend("sap.ui.vk.ImageContentManager",{metadata:{library:"sap.ui.vk"}});
var b=I.getMetadata().getParent().getClass().prototype;
I.prototype.init=function(){if(b.init){b.init.call(this);}this._handleLoadSucceededProxy=this._handleLoadSucceeded.bind(this);this._handleLoadFailedProxy=this._handleLoadFailed.bind(this);};
I.prototype.exit=function(){if(b.exit){b.exit.call(this);}};
I.prototype.loadContent=function(c,a){if(a.length!==1){q.sap.delayedCall(0,this,function(){this.fireContentChangesStarted();this.fireContentChangesFinished({content:null,failureReason:{errorMessage:"Only a single image can be loaded."}});});}else if(a[0].getContentResources().length>0){q.sap.delayedCall(0,this,function(){this.fireContentChangesStarted();this.fireContentChangesFinished({content:null,failureReason:{errorMessage:"Cannot load a hierarchy of images."}});});}else{var d=a[0],s=d.getSource(),e=d.getSourceType();if(s instanceof File){var f=new FileReader();f.onload=function(g){this._loadImageFromUrl(c,f.result,e);}.bind(this);f.readAsDataURL(s);}else{this._loadImageFromUrl(c,s,e);}}};
I.prototype._addEventListeners=function(h){h.addEventListener("load",this._handleLoadSucceededProxy);h.addEventListener("error",this._handleLoadFailedProxy);};
I.prototype._removeEventListeners=function(h){h.removeEventListener("error",this._handleLoadFailedProxy);h.removeEventListener("load",this._handleLoadSucceededProxy);};
I.prototype._addSvgQuirks=function(h){h.style.setProperty("visibility","collapse");h.style.setProperty("width","0");h.style.setProperty("height","0");h.style.setProperty("position","absolute");document.body.appendChild(h);return this;};
I.prototype._removeSvgQuirks=function(h){h.parentElement.removeChild(h);h.style.removeProperty("visibility");h.style.removeProperty("width");h.style.removeProperty("height");h.style.removeProperty("position");return this;};
I.prototype._loadImageFromUrl=function(c,u,s){this.fireContentChangesStarted();switch(s.toLowerCase()){case"svg":var a=document.createElement("object");this._addEventListeners(a);a.type="image/svg+xml";a.data=u;a.className="SVGImage";this._addSvgQuirks(a);break;case"jpg":case"png":case"gif":case"bmp":case"tif":case"tiff":var i=document.createElement("img");this._addEventListeners(i);i.src=u;break;default:q.sap.delayedCall(0,this,function(){this.fireContentChangesFinished({content:null,failureReason:{errorMessage:"Unsupported image type.",sourcesFailedToDownload:[{source:u}]}});});break;}};
I.prototype._handleLoadSucceeded=function(a){var c=a.target;if(c instanceof HTMLObjectElement){try{if(!c.getSVGDocument()){this._handleLoadFailed(a);return;}}catch(e){}}this._removeEventListeners(c);if(c instanceof HTMLObjectElement){this._removeSvgQuirks(c);}this.fireContentChangesFinished({content:c});};
I.prototype._handleLoadFailed=function(e){var c=e.target;this._removeEventListeners(c);if(c instanceof HTMLObjectElement){this._removeSvgQuirks(c);}this.fireContentChangesFinished({content:null,failureReason:{errorMessage:"Failed to load the image.",sourcesFailedToDownload:[{source:c instanceof HTMLImageElement?c.src:c.data}]}});};
return I;});
sap.ui.predefine('sap/ui/vk/InputDeviceKeyboard',["jquery.sap.global","sap/ui/base/EventProvider"],function(q,E){"use strict";
var I=E.extend("sap.ui.vk.InputDeviceKeyboard",{
metadata:{publicMethods:["enable","disable"]},
constructor:function(l){this._loco=l;}
});
I.prototype.enable=function(c){this._control=c;this._control.attachBrowserEvent("keydown keyup keypress",this._onKeyEvent,this);};
I.prototype.disable=function(){this._control.detachBrowserEvent("keydown keyup keypress",this._onKeyEvent,this);};
I.prototype._onKeyEvent=function(e){this._loco.keyEventHandler(e,this._control);};
return I;},true);
sap.ui.predefine('sap/ui/vk/InputDeviceMouse',["jquery.sap.global","sap/ui/base/EventProvider"],function(q,E){"use strict";
var I=E.extend("sap.ui.vk.InputDeviceMouse",{
metadata:{publicMethods:["isSupported","enable","disable"]},
constructor:function(L){this._loco=L;this._buttons=0;this._buttonFlagsValue=0;this._zoomOrigin={x:0,y:0};this._mousedownProxy=this._onmousedown.bind(this);this._mouseupProxy=this._onmouseup.bind(this);this._mousemoveProxy=this._onmousemove.bind(this);this._mousewheelProxy=this._onmousewheel.bind(this);this._contextmenuProxy=this._oncontextmenu.bind(this);this._onmouseupWindowListenerProxy=this._onmouseupWindowListener.bind(this);}
});
I.prototype._buttonFlags=function(b,d){if(d){this._buttonFlagsValue|=(1<<b);}else{this._buttonFlagsValue&=~(1<<b);}return this._buttonFlagsValue;};
I.prototype._eventToInput=function(e,b){var a=(e.buttons!=undefined)?e.buttons:this._buttonFlagsValue;if(b){a=b;}var i={x:0,y:0,z:0,d:0,n:0,buttons:a,scroll:e.wheelDelta,points:[],handled:false};var n=0;switch(a){case 0:case 1:n=1;i.points.push({x:e.pageX,y:e.pageY,z:0});break;case 3:case 4:case 5:n=2;i.points.push({x:e.pageX,y:e.pageY,z:0});i.points.push({x:e.pageX,y:e.pageY,z:0});break;case 2:n=2;i.points.push({x:this._zoomOrigin.x,y:e.pageY,z:0});i.points.push({x:this._zoomOrigin.x,y:e.pageY+(this._zoomOrigin.y-e.pageY)*2,z:0});break;default:n=0;break;}i.n=n;return i;};
I.prototype._onmouseup=function(e){this._capturedByControl=true;var b=(e.buttons!=undefined)?e.buttons:this._buttonFlags(e.button,false);if(e["_sapui_handledByControl"]){return;}var i=this._eventToInput(e,this._buttons);this._loco.endGesture(i,this._control);if(b==2){this._zoomOrigin.x=e.pageX;this._zoomOrigin.y=e.pageY;}i=this._eventToInput(e);if(b!=0){i.handled=false;this._loco.beginGesture(i,this._control);}this._buttons=b;if(i.handled){e.preventDefault();e["_sapui_handledByControl"]=true;}};
I.prototype._onmouseupWindowListener=function(e){if(!this._capturedByControl){this._onmouseup(e);}this._capturedByControl=false;};
I.prototype._onmousemove=function(e){if(e["_sapui_handledByControl"]){return;}if(sap.ui.Device.os.name===sap.ui.Device.os.OS.MACINTOSH&&e.buttons===2){e.buttons=3;}var i=this._eventToInput(e);this._loco.move(i,this._control);if(i.handled){e["_sapui_handledByControl"]=true;e.preventDefault();}};
I.prototype._onmousedown=function(e){var b=(e.buttons!=undefined)?e.buttons:this._buttonFlags(e.button,true);if(e["_sapui_handledByControl"]){return;}var i;if(this._buttons!=0){i=this._eventToInput(e,this._buttons);this._loco.endGesture(i,this._control);}if(b==2){this._zoomOrigin.x=e.pageX;this._zoomOrigin.y=e.pageY;}i=this._eventToInput(e);i.handled=false;this._loco.beginGesture(i,this._control);this._prevButtons=b;this._buttons=b;if(i.handled){e["_sapui_handledByControl"]=true;e.preventDefault();}};
I.prototype._onmousewheel=function(e){var a=e.originalEvent?e.originalEvent:e;if(a["_sapui_handledByControl"]||this._buttons!=0){return;}this._zoomOrigin.x=a.pageX;this._zoomOrigin.y=a.pageY;var s={pageX:a.pageX,pageY:a.pageY,buttons:2,wheelDelta:a.wheelDelta};var i=this._eventToInput(s);this._loco.beginGesture(i,this._control);var d=a.detail?a.detail*(-40):a.wheelDelta;s.pageY-=d/5;i=this._eventToInput(s);i.handled=false;this._loco.move(i,this._control);i.handled=false;this._loco.endGesture(i,this._control);if(i.handled){a["_sapui_handledByControl"]=true;a.preventDefault();}};
I.prototype._oncontextmenu=function(e){var i=this._eventToInput(e);this._loco.contextMenu(i,this._control);if(i.handled){e["_sapui_handledByControl"]=true;e.preventDefault();}};
I.prototype.isSupported=function(){return true;};
I.prototype.enable=function(c){this._buttonFlagsValue=0;this._buttons=0;this._control=c;var f=this._control?this._control.attachBrowserEvent.bind(this._control):window.document.addEventListener;f("mousedown",this._mousedownProxy);f("mouseup",this._mouseupProxy);f("mousemove",this._mousemoveProxy);f("mousewheel",this._mousewheelProxy);f("DOMMouseScroll",this._mousewheelProxy);f("contextmenu",this._contextmenuProxy);window.document.addEventListener("mouseup",this._onmouseupWindowListenerProxy);};
I.prototype.disable=function(){var f=this._control?this._control.detachBrowserEvent.bind(this._control):window.document.removeEventListener;f("mousedown",this._mousedownProxy);f("mouseup",this._mouseupProxy);f("mousemove",this._mousemoveProxy);f("mousewheel",this._mousewheelProxy);f("DOMMouseScroll",this._mousewheelProxy);f("contextmenu",this._contextmenuProxy);window.document.removeEventListener("mouseup",this._onmouseupWindowListenerProxy);};
return I;},true);
sap.ui.predefine('sap/ui/vk/InputDevicePointer',["jquery.sap.global","sap/ui/base/EventProvider","./InputDeviceMouse"],function(q,E,I){"use strict";
var a=E.extend("sap.ui.vk.InputDevicePointer",{
metadata:{publicMethods:["isSupported","enable","disable"]},
constructor:function(L){this._loco=L;this._pointerIds=[];this._pointers=[];this._count=0;this._points=0;this._buttons=0;this._mouse=new I(this._loco);this._pointerdownProxy=this._onpointerdown.bind(this);this._pointerupProxy=this._onpointerup.bind(this);this._pointermoveProxy=this._onpointermove.bind(this);this._mousewheelProxy=this._mouse._onmousewheel.bind(this._mouse);this._contextmenuProxy=this._mouse._oncontextmenu.bind(this._mouse);this._onpointerupWindowListenerProxy=this._onpointerupWindowListener.bind(this);}
});
a.prototype._clearPointers=function(){this._pointerIds=[];this._pointers=[];this._count=0;this._points=0;this._buttons=0;};
a.prototype._addPointer=function(i,_,b){if(this._pointerIds[i]==null){this._pointerIds[i]=this._count;}var c=this._pointerIds[i];if(this._pointers.length<=c||this._pointers[c]==null){this._count++;}this._pointers[c]={x:_,y:b};return this._count;};
a.prototype._removePointer=function(i){if(this._pointerIds[i]==null){return this._count;}var b=this._pointerIds[i];this._pointerIds[i]=null;if(this._pointers.length>b&&this._pointers[b]!=null){this._count--;}this._pointers[b]=null;return this._count;};
a.prototype._eventToInput=function(e){var b={x:0,y:0,z:0,d:0,n:this._count,buttons:0,scroll:0,points:[],handled:false};var t=this._pointers;var l=t.length;for(var i=0;i<l;i++){var c=t[i];if(c!=null){b.points.push({x:c.x,y:c.y,z:0});}}return b;};
a.prototype._onpointerdown=function(e){var b=e.originalEvent?e.originalEvent:e;if(b.pointerType!="touch"&&b.pointerType!="pen"){this._buttons=b.buttons;this._mouse._onmousedown(b);return;}if(b.isPrimary){this._clearPointers();}this._addPointer(b.pointerId,b.pageX,b.pageY);b.target.setPointerCapture(b.pointerId);var i=this._eventToInput(b);if(this._points!=0&&this._points!=i.n){this._loco.endGesture(i,this._control);}this._points=i.n;i.handled=false;this._loco.beginGesture(i,this._control);if(i.handled){b["_sapui_handledByControl"]=true;b.preventDefault();}else{this._removePointer(b.pointerId);}};
a.prototype._onpointerup=function(e){this._capturedByControl=true;var b=e.originalEvent?e.originalEvent:e;if(b.pointerType!="touch"&&b.pointerType!="pen"){this._buttons=0;this._mouse._onmouseup(b);return;}this._removePointer(b.pointerId);b.target.releasePointerCapture(b.pointerId);var i=this._eventToInput(b);this._loco.endGesture(i,this._control);if(i.n!=0&&this._points!=i.n){i.handled=false;this._loco.beginGesture(i,this._control);}this._points=i.n;if(i.handled){b["_sapui_handledByControl"]=true;b.preventDefault();}};
a.prototype._onpointerupWindowListener=function(e){if(!this._capturedByControl){this._onpointerup(e);}this._capturedByControl=false;};
a.prototype._onpointermove=function(e){if(e.buttons!==0||sap.ui.Device.system.desktop){var b=e.originalEvent?e.originalEvent:e;if(b.pointerType!="touch"&&b.pointerType!="pen"){if(this._buttons!=b.buttons){this._mouse._onmousedown(b);this._buttons=b.buttons;}else{this._mouse._onmousemove(b);}return;}this._addPointer(b.pointerId,b.pageX,b.pageY);var i=this._eventToInput(b);if(this._points!=i.n){this._loco.endGesture(i,this._control);i.handled=false;this._loco.beginGesture(i,this._control);this._points=i.n;}else{this._loco.move(i,this._control);}if(i.handled){b["_sapui_handledByControl"]=true;b.preventDefault();}}};
a.prototype.isSupported=function(){if((sap.ui.Device.browser.edge||sap.ui.Device.browser.msie)&&sap.ui.Device.support.pointer){return true;}return false;};
a.prototype.enable=function(c){this._pointerIds=[];this._pointers=[];this._points=0;this._count=0;this._buttons=0;this._mouse._buttons=0;this._control=c;this._mouse._control=c;var f=this._control?this._control.attachBrowserEvent.bind(this._control):window.document.addEventListener;f("pointerdown",this._pointerdownProxy);f("pointerup",this._pointerupProxy);f("pointermove",this._pointermoveProxy);f("mousewheel",this._mousewheelProxy);f("DOMMouseScroll",this._mousewheelProxy);f("contextmenu",this._contextmenuProxy);window.document.addEventListener("pointerup",this._onpointerupWindowListenerProxy);};
a.prototype.disable=function(){var f=this._control?this._control.detachBrowserEvent.bind(this._control):window.document.removeEventListener;f("pointerdown",this._pointerdownProxy);f("pointerup",this._pointerupProxy);f("pointermove",this._pointermoveProxy);f("mousewheel",this._mousewheelProxy);f("DOMMouseScroll",this._mousewheelProxy);f("contextmenu",this._contextmenuProxy);window.document.removeEventListener("pointerup",this._onpointerupWindowListenerProxy);};
return a;},true);
sap.ui.predefine('sap/ui/vk/InputDeviceTouch',["jquery.sap.global","sap/ui/base/EventProvider"],function(q,E){"use strict";
var I=E.extend("sap.ui.vk.InputDeviceTouch",{
metadata:{publicMethods:["isSupported","enable","disable"]},
constructor:function(L){this._loco=L;this._points=0;this._touchdownProxy=this._ontouchdown.bind(this);this._touchupProxy=this._ontouchup.bind(this);this._touchmoveProxy=this._ontouchmove.bind(this);}
});
I.prototype._eventToInput=function(e){var a={x:0,y:0,z:0,d:0,n:e.touches.length,buttons:0,scroll:0,points:[],handled:false};for(var i=0;i<a.n;i++){var b=e.touches[i];a.points.push({x:b.pageX,y:b.pageY,z:0});}return a;};
I.prototype._ontouchdown=function(e){var i=this._eventToInput(e);if(this._points!=0&&this._points!=i.n){this._loco.endGesture(i,this._control);}this._points=i.n;i.handled=false;this._loco.beginGesture(i,this._control);if(i.handled){e["_sapui_handledByControl"]=true;e.preventDefault();}};
I.prototype._ontouchup=function(e){var i=this._eventToInput(e);this._loco.endGesture(i,this._control);this._points=0;if(i.handled){e["_sapui_handledByControl"]=true;e.preventDefault();}};
I.prototype._ontouchmove=function(e){var i=this._eventToInput(e);if(this._points!=i.n){this._loco.endGesture(i,this._control);i.handled=false;this._loco.beginGesture(i,this._control);this._points=i.n;}else{this._loco.move(i,this._control);}if(i.handled){e["_sapui_handledByControl"]=true;e.preventDefault();}};
I.prototype.isSupported=function(){return typeof window.ontouchstart!=="undefined";};
I.prototype.enable=function(c){this._points=0;this._control=c;var f=this._control?this._control.attachBrowserEvent.bind(this._control):window.document.addEventListener;f("touchstart",this._touchdownProxy);f("touchend",this._touchupProxy);f("touchmove",this._touchmoveProxy);};
I.prototype.disable=function(){var f=this._control?this._control.detachBrowserEvent.bind(this._control):window.document.removeEventListener;f("touchstart",this._touchdownProxy);f("touchend",this._touchupProxy);f("touchmove",this._touchmoveProxy);};
return I;},true);
sap.ui.predefine('sap/ui/vk/LayerProxy',["jquery.sap.global","sap/ui/base/Object"],function(q,B){"use strict";
var L=B.extend("sap.ui.vk.LayerProxy",{metadata:{"abstract":true}});
return L;});
sap.ui.predefine('sap/ui/vk/Loco',["jquery.sap.global","sap/ui/base/EventProvider","./InputDevicePointer","./InputDeviceMouse","./InputDeviceTouch","./InputDeviceKeyboard"],function(q,E,I,a,b,c){"use strict";
var L=E.extend("sap.ui.vk.Loco",{
metadata:{publicMethods:["addHandler","removeHandler","beginGesture","move","endGesture","contextMenu"]},
constructor:function(){if(L._instance){return L._instance;}E.apply(this);this._handlers=[];this._handlerMap=[];this._gesture=[];this._touchOrigin={x:0,y:0,z:0};this._touchMoved=false;this._touchButton=0;this._touchStart=0;this._touchEnd=0;this._clickTimer=0;this._isDoubleClick=false;L._instance=this;}
});
L.prototype.destroy=function(){this._gesture=[];this._handlers=[];};
L.prototype.addHandler=function(h){if(this._handlers.indexOf(h)>=0){return;}this._handlers.push(h);var v=h.getViewport();var d=this._handlerMap[v];if(d==null){this._handlerMap[v]=[];d=this._handlerMap[v];d.push(h);}else if(d.indexOf(h)==-1){d.push(h);}var p=new I(this);if(p.isSupported()){p.enable(v);v._pointer=p;}else{var m=new a(this);if(m.isSupported()){m.enable(v);v._mouse=m;}var t=new b(this);if(t.isSupported()){t.enable(v);v._touch=t;}}v._keyboard=new c(this);v._keyboard.enable(v);};
L.prototype.removeHandler=function(d){var v=d.getViewport();var h=this._handlers;var e=this._handlerMap[v];var f;if(e!=null){f=e.indexOf(d);if(f>=0){e.splice(f,1);}}f=h.indexOf(d);if(f>=0){h.splice(f,1);if(v._pointer){v._pointer.disable();v._pointer=null;}if(v._touch){v._touch.disable();v._touch=null;}if(v._mouse){v._mouse.disable();v._mouse=null;}if(v._keyboard){v._keyboard.disable();v._keyboard=null;}}};
L.prototype._processClick=function(d,v){this._clickTimer=0;var e={x:0,y:0,z:0,d:0,n:0,buttons:0,scrolls:[],points:[],handled:false};e.x=this._touchOrigin.x;e.y=this._touchOrigin.y;e.z=this._touchOrigin.z;e.buttons=this._touchButton;var h=this._handlerMap[v];if(h!=null){for(var i=h.length-1;i>=0;i--){if(d){var n=h[i].getViewport().getId();var p=/-nativeViewport$/.test(n)?n.replace(/-nativeViewport$/,""):null;var f=sap.ui.getCore().byId(p);if(!f||!f.getOverlay()||!(typeof f.getOverlay().mIACreateCB==="function")){h[i].doubleClick(e,v);}}else{h[i].click(e,v);}}}};
L.prototype._processInput=function(e){var d=e.points;switch(e.n){case 0:e.x=0;e.y=0;e.z=0;e.d=0;break;case 2:var f=d[0].x-d[1].x,g=d[0].y-d[1].y,h=d[0].z-d[1].z;e.x=(d[0].x+d[1].x)/2;e.y=(d[0].y+d[1].y)/2;e.z=(d[0].z+d[1].z)/2;e.d=Math.sqrt(f*f+g*g+h*h);break;default:e.x=d[0].x;e.y=d[0].y;e.z=d[0].z;e.d=0;break;}return e;};
L.prototype.beginGesture=function(e,v){if(this._gesture[v]){return;}if(this._clickTimer>0){clearTimeout(this._clickTimer);this._clickTimer=0;this._isDoubleClick=true;if(e.n==1&&e.buttons<=1&&this._touchButton<=1){this._processClick(true,v);}}this._processInput(e);var h=this._handlerMap[v];if(h!=null){for(var i=h.length-1;i>=0;i--){h[i].beginGesture(e);if(e.handled){break;}}}var n=new Date();this._touchStart=n.getTime();this._touchMoved=false;this._gesture[v]=true;this._touchOrigin.x=e.x;this._touchOrigin.y=e.y;this._touchOrigin.z=e.z;this._touchButton=e.buttons;if(this._touchEnd!=0&&this._touchStart-this._touchEnd<50){this._touchMoved=true;}};
L.prototype.move=function(e,v){this._processInput(e);var h=this._handlerMap[v];var i;if(this._gesture[v]){if(h!=null){for(i=h.length-1;i>=0;i--){h[i].move(e);if(e.handled){break;}}}var d=this._touchOrigin.x-e.x;var f=this._touchOrigin.y-e.y;var g=this._touchOrigin.z-e.z;if((d*d+f*f+g*g)>8){this._touchMoved=true;}}else if(h!=null){for(i=h.length-1;i>=0;i--){if(h[i].hover!=undefined){h[i].hover(e);if(e.handled){break;}}}}};
L.prototype.endGesture=function(e,v){if(!this._gesture[v]){return;}this._processInput(e);var h=this._handlerMap[v];if(h!=null){for(var i=h.length-1;i>=0;i--){h[i].endGesture(e);if(e.handled){break;}}}var n=new Date();this._touchEnd=n.getTime();if(!this._touchMoved&&!this._isDoubleClick&&(this._touchEnd-this._touchStart)<2000){this._clickTimer=setTimeout(function(l){l._processClick(false,v);},200,this);}this._isDoubleClick=false;this._gesture[v]=false;};
L.prototype.contextMenu=function(e,v){this._processInput(e);var h=this._handlerMap[v];if(h!=null){for(var i=h.length-1;i>=0;i--){h[i].contextMenu(e);if(e.handled){break;}}}};
L.prototype.keyEventHandler=function(e,v){var h=this._handlerMap[v];if(h!==null&&h!==undefined){for(var i=h.length-1;i>=0;i--){if(h[i].keyEventHandler){h[i].keyEventHandler(e);}}}};
return L;},true);
sap.ui.predefine('sap/ui/vk/Messages',["jquery.sap.global","sap/ui/base/ManagedObject"],function(q,M){"use strict";var a={VIT1:{summary:"NATIVEVIEWPORT_MSG_NOTBELOADED_SUMMARY",cause:"NATIVEVIEWPORT_MSG_NOTBELOADED_NOTFOUND_CAUSE",resolution:"NATIVEVIEWPORT_MSG_NOTBELOADED_NOTFOUND_CHECKEXISTS_RESOLUTION",code:"VIT1"},VIT2:{summary:"NATIVEVIEWPORT_MSG_NOTBELOADED_SUMMARY",cause:"NATIVEVIEWPORT_MSG_NOTBELOADED_NOTFOUND_CAUSE",resolution:"NATIVEVIEWPORT_MSG_NOTBELOADED_NOTFOUND_CHECKEXISTS_RESOLUTION",code:"VIT2"},VIT3:{summary:"NATIVEVIEWPORT_MSG_NOTBELOADED_SUMMARY",cause:"NATIVEVIEWPORT_MSG_NOTBELOADED_UNSUPPORTEDFILEFORMAT_CAUSE",resolution:"NATIVEVIEWPORT_MSG_NOTBELOADED_UNSUPPORTEDFILEFORMAT_CHECKFILEFORMAT_RESOLUTION",code:"VIT3"},VIT4:{summary:"NATIVEVIEWPORT_MSG_NOTBELOADED_SUMMARY",cause:"NATIVEVIEWPORT_MSG_NOTBELOADED_UNSUPPORTEDFILEFORMAT_CAUSE",resolution:"NATIVEVIEWPORT_MSG_NOTBELOADED_UNSUPPORTEDFILEFORMAT_CHECKFILEFORMAT_RESOLUTION",code:"VIT4"},VIT5:{summary:"DOWNLOADMANAGER_MSG_NOTBELOADED_SUMMARY",cause:"DOWNLOADMANAGER_MSG_NOTBELOADED_VALUESOURCEUNSUPPORTED_CAUSE",resolution:"DOWNLOADMANAGER_MSG_NOTBELOADED_VALUESOURCEUNSUPPORTED_CHECKSOURCEISURLORFILE_RESOLUTION",code:"VIT5"},VIT6:{summary:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_SUMMARY",cause:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_INVALIDQUERY_CAUSE",resolution:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_INVALIDQUERY_SPECIFYVALUEPROPERTY_RESOLUTION",code:"VIT6"},VIT7:{summary:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_SUMMARY",cause:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_PREDICATENOTSPECIFIED_CAUSE",resolution:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_PREDICATENOTSPECIFIED_SPECIFYPREDICATE_RESOLUTION",code:"VIT7"},VIT8:{summary:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_SUMMARY",cause:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_INCORRECTPREDICATEVALUE_CAUSE",resolution:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_INCORRECTPREDICATEVALUE_INVALIDPREDICATE_RESOLUTION",code:"VIT8"},VIT9:{summary:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_SUMMARY",cause:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_INCORRECTPREDICATEVALUE_CAUSE",resolution:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_INCORRECTPREDICATEVALUE_INVALIDPREDICATE_RESOLUTION",code:"VIT9"},VIT10:{summary:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_SUMMARY",cause:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_NOMETADATASPECIFIED_CAUSE",resolution:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_NOMETADATASPECIFIED_SPECIFYMETADATACATEGORY_RESOLUTION",code:"VIT10"},VIT11:{summary:"OVERLAY_MSG_EVENTHANDLERFAILED_SUMMARY",cause:"OVERLAY_MSG_EVENTHANDLERFAILED_UNSUPPORTEDEVENTTYPE_CAUSE",resolution:"OVERLAY_MSG_EVENTHANDLERFAILED_UNSUPPORTEDEVENTTYPE_CHECKEVENTTYPE_RESOLUTION",code:"VIT11"},VIT12:{summary:"STEPNAVIGATION_MSG_STEPCOULDNOTBEPLAYED_SUMMARY",cause:"STEPNAVIGATION_MSG_STEPCOULDNOTBEPLAYED_INCORRECTSTEPEVENTTYPE_CAUSE",resolution:"STEPNAVIGATION_MSG_STEPCOULDNOTBEPLAYED_INCORRECTSTEPEVENTTYPE_CHECKSTEPEVENTTYPEVALUE_RESOLUTION",code:"VIT12"},VIT13:{summary:"VIEWER_MSG_CONTENTRESOURCESNOTLOADED_SUMMARY",cause:"VIEWER_MSG_CONTENTRESOURCESNOTLOADED_NONEXISTINGORUNSUPPORTEDFILE_CAUSE",resolution:"VIEWER_MSG_CONTENTRESOURCESNOTLOADED_NONEXISTINGORUNSUPPORTEDFILE_CHECKFILEEXISTSANDIFSUPPORT_RESOLUTION",code:"VIT13"},VIT14:{summary:"VIEWER_MSG_FAILEDTOBUILDSCENE_SUMMARY",cause:"VIEWER_MSG_FAILEDTOBUILDSCENE_COULDNOTCREATESCENE_CAUSE",resolution:"VIEWER_MSG_FAILEDTOBUILDSCENE_COULDNOTCREATESCENE_RELOADORSELECTANOTHERFILE_RESOLUTION",code:"VIT14"},VIT15:{summary:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_SUMMARY",cause:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_LOADINGMULTIPLE2DNOTSUPPORTED_CAUSE",resolution:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_LOADINGMULTIPLE2DNOTSUPPORTED_LOADONE2D_RESOLUTION",code:"VIT15"},VIT16:{summary:"VIEWER_MSG_NOTBELOADED_SUMMARY",cause:"VIEWER_MSG_NOTBELOADED_NONATIVESUPPORT_CAUSE",resolution:"VIEWER_MSG_NOTBELOADED_NONATIVESUPPORT_CHECKFILEFORMATSUPPORT_RESOLUTION",code:"VIT16"},VIT17:{summary:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_SUMMARY",cause:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_COMBINATIONOF2D3DNOTSUPPORTED_CAUSE",resolution:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_COMBINATIONOF2D3DNOTSUPPORTED_MULTIPLESUPPORTFOR3DONLY_RESOLUTION",code:"VIT17"},VIT18:{summary:"VIEWPORT_MSG_ERRORLOADINGVIEWPORT_SUMMARY",cause:"VIEWPORT_MSG_ERRORLOADINGVIEWPORT_CREATINGMULTIPLEVIEWPORTINSTANCES_CAUSE",resolution:"VIEWPORT_MSG_ERRORLOADINGVIEWPORT_CREATINGMULTIPLEVIEWPORTINSTANCES_ONEINSTANCEOFVIEWPORTSUPPORTED_RESOLUTION",code:"VIT18"},VIT19:{summary:"VIEWPORT_MSG_COULDNOTSETCAMERAPROJECTION_SUMMARY",cause:"VIEWPORT_MSG_COULDNOTSETCAMERAPROJECTION_SPECIFIEDCAMERAPROJECTIONNOTSUPPORTED_CAUSE",resolution:"VIEWPORT_MSG_COULDNOTSETCAMERAPROJECTION_SPECIFIEDCAMERAPROJECTIONNOTSUPPORTED_CHECKPROJECTIONTYPESUPPORTED_RESOLUTION",code:"VIT19"},VIT20:{summary:"DOWNLOADMANAGER_MSG_VDS4_BETA_WARNING_SUMMARY",cause:"DOWNLOADMANAGER_MSG_VDS4_BETA_WARNING_CAUSE",resolution:"DOWNLOADMANAGER_MSG_VDS4_BETA_WARNING_RESOLUTION",code:"VIT20"},VIT21:{summary:"VIEWER_MSG_FAILEDTOBUILDSCENE_SUMMARY",cause:"VIEWER_MSG_FAILEDTOBUILDSCENE_MISSINGPASSWORD_CAUSE",resolution:"VIEWER_MSG_FAILEDTOBUILDSCENE_MISSINGPASSWORD_PROVIDEPASSWORD_RESOLUTION",code:"VIT21"},VIT22:{summary:"GRAPHICSCORE_MSG_VDSL_NOFILEPROPERTY_SUMMARY",cause:"GRAPHICSCORE_MSG_VDSL_EMPTY_CAUSE",resolution:"GRAPHICSCORE_MSG_VDSL_FIRSTLINE_WRONGFORMAT_RESOLUTION",code:"VIT22"},VIT23:{summary:"GRAPHICSCORE_MSG_VDSL_FIRSTLINE_WRONGFORMAT_SUMMARY",cause:"GRAPHICSCORE_MSG_VDSL_WRONGFORMAT_CAUSE",resolution:"GRAPHICSCORE_MSG_VDSL_FIRSTLINE_WRONGFORMAT_RESOLUTION",code:"VIT23"},VIT24:{summary:"GRAPHICSCORE_MSG_VDSL_RELATIVE_IN_LOCAL_SUMMARY",cause:"GRAPHICSCORE_MSG_VDSL_WRONGFORMAT_CAUSE",resolution:"GRAPHICSCORE_MSG_VDSL_RELATIVE_IN_LOCAL_RESOLUTION",code:"VIT24"},VIT25:{summary:"GRAPHICSCORE_MSG_VDS3ENCRYPTED_SUMMARY",cause:"GRAPHICSCORE_MSG_VDS3ENCRYPTED_CAUSE",resolution:"GRAPHICSCORE_MSG_VDS3ENCRYPTED_RESOLUTION",code:"VIT25"},VIT26:{summary:"VIEWPORT_UNSUPPORTED_STEP_INDEX_SUMMARY",cause:"VIEWPORT_UNSUPPORTED_STEP_INDEX_CAUSE",resolution:"VIEWPORT_UNSUPPORTED_STEP_INDEX_RESOLUTION",code:"VIT26"},VIT27:{summary:"VIEWPORT_UNSUPPORTED_PROCEDURE_INDEX_SUMMARY",cause:"VIEWPORT_UNSUPPORTED_PROCEDURE_INDEX_CAUSE",resolution:"VIEWPORT_UNSUPPORTED_PROCEDURE_INDEX_RESOLUTION",code:"VIT27"},VIT28:{summary:"VIEWPORT_UNSUPPORTED_VISIBILITY_MODE_SUMMARY",cause:"VIEWPORT_UNSUPPORTED_VISIBILITY_MODE_CAUSE",resolution:"VIEWPORT_UNSUPPORTED_VISIBILITY_MODE_RESOLUTION",code:"VIT28"},VIT29:{summary:"VIEWER_RUNTIME_SETTINGS_NOT_CHANGEABLE_SUMMARY",cause:"VIEWER_RUNTIME_SETTINGS_NOT_CHANGEABLE_CAUSE",resolution:"VIEWER_RUNTIME_SETTINGS_NOT_CHANGEABLE_RESOLUTION",code:"VIT29"},VIT30:{summary:"VIEWER_WEBGLCONTEXTATTRIBUTES_NOT_CHANGEABLE_SUMMARY",cause:"VIEWER_WEBGLCONTEXTATTRIBUTES_NOT_CHANGEABLE_CAUSE",resolution:"VIEWER_WEBGLCONTEXTATTRIBUTES_NOT_CHANGEABLE_RESOLUTION",code:"VIT30"},VIT31:{summary:"VIEWPORT_UNSUPPORTED_RESET_OPTIONS_SUMMARY",cause:"VIEWPORT_UNSUPPORTED_RESET_OPTIONS_CAUSE",resolution:"VIEWPORT_UNSUPPORTED_RESET_OPTIONS_RESOLUTION",code:"VIT31"},VIT32:{summary:"VIEWPORT_UNSUPPORTED_VISIBILITY_TRACKING_SUMMARY",cause:"VIEWPORT_UNSUPPORTED_VISIBILITY_TRACKING_CAUSE",resolution:"VIEWPORT_UNSUPPORTED_VISIBILITY_TRACKING_RESOLUTION",code:"VIT32"},VIT33:{summary:"VIEWER_SOURCE_FAILED_TO_DOWNLOAD_SUMMARY",cause:"VIEWER_SOURCE_FAILED_TO_DOWNLOAD_CAUSE",resolution:"VIEWER_SOURCE_FAILED_TO_DOWNLOAD_RESOLUTION",code:"VIT33"},VIT34:{summary:"VIEWER_SOURCE_FAILED_TO_LOAD_SUMMARY",cause:"VIEWER_SOURCE_FAILED_TO_LOAD_CAUSE",resolution:"VIEWER_SOURCE_FAILED_TO_LOAD_RESOLUTION",code:"VIT34"},VIT35:{summary:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_SUMMARY",cause:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_COMBINATIONOFDIFFRENTCONTENTMANAGERSNOTSUPPORTED_CAUSE",resolution:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_COMBINATIONOFDIFFRENTCONTENTMANAGERSNOTSUPPORTED_MULTIPLESUPPORTFORSAMECONTENTMANAGER_RESOLUTION",code:"VIT35"},VIT36:{summary:"VIEWER_UNKNOWN_CONTENT_RESOURCE_TYPE_SUMMARY",cause:"VIEWER_UNKNOWN_CONTENT_RESOURCE_TYPE_CAUSE",resolution:"VIEWER_UNKNOWN_CONTENT_RESOURCE_TYPE_RESOLUTION",code:"VIT36"}};q.sap.setObject("sap.ui.vk.Messages",a);return a;});
sap.ui.predefine('sap/ui/vk/NativeViewportRenderer',["jquery.sap.global"],function(q){"use strict";var N={};
N.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapVizKitNativeViewport");r.writeClasses();r.writeAttribute("tabindex",0);r.write(">");r.write("</div>");};
return N;},true);
sap.ui.predefine('sap/ui/vk/NodeHierarchy',["jquery.sap.global","sap/ui/base/ManagedObject","./Messages"],function(q,M,a){"use strict";
var N=M.extend("sap.ui.vk.NodeHierarchy",{metadata:{"abstract":true,events:{changed:{},nodeCreated:{parameters:{nodeRef:{type:"any"},nodeId:{type:"string"}}},nodeRemoving:{parameters:{nodeRef:{type:"any"},nodeId:{type:"string"}}}}}});
N.prototype.findNodesById=function(b){if(b.fields.some(function(g){return!g.caseSensitive;})){b=q.extend(true,{},b);b.fields.forEach(function(g){if(!g.caseSensitive){g.value=g.value.toLowerCase();}});}var c=function(p,g,v,h){var m;p=p||"equals";h=h||"";var j=g?v:v.toLowerCase();switch(p){case"equals":m=(j===h);break;case"contains":m=(j.indexOf(h)!==-1);break;case"startsWith":m=(j.indexOf(h)===0);break;default:m=false;q.sap.log.error(sap.ui.vk.getResourceBundle().getText(a.VIT8.summary),a.VIT8.code,"sap.ui.vk.dvl.NodeHierarchy");}return m;};var i=function(l,g){return!l.some(function(v){return g.name===v.name?c(g.predicate,g.caseSensitive,v.value,g.value):false;});};var f=function(b,v){return b.source===v.source&&b.type===v.type&&!b.fields.some(i.bind(undefined,v.fields));};var d=this.findNodesByName();var e=d.filter(function(n){var g=this.createNodeProxy(n);var v=g.getVeIds();this.destroyNodeProxy(g);return v.some(f.bind(undefined,b));}.bind(this));return e;};
N.prototype.findNodesByMetadata=function(b){var c=function(m,j,k,v,h,i){if(m.hasOwnProperty(j)){var l=m[j];if(l.hasOwnProperty(k)){var n=l[k];if(!i){n=n.toLowerCase();}return v.some(h.bind(undefined,n));}}return false;};var d=function(m,j){return m.hasOwnProperty(j);};var g=function(e,f,j,k,v,h,i){var n=this._baseNodeProxyPool.borrowObject();var r=e.filter(function(l){n.init(this,l);var m=n.getNodeMetadata();var o=f(m,j,k,v,h,i);n.reset();return o;}.bind(this));this._baseNodeProxyPool.returnObject(n);return r;};var e=this.findNodesByName(),r=[];if(b===undefined||b===null||q.isEmptyObject(b)){r=e;}else if(b.category!==null&&b.category!==undefined&&b.category!==""){var f,v,p,h,i=!!(b&&b.caseSensitive);if(b.key===undefined||b.key===null){f=d;}else{v=b.value;p=b.predicate||"equals";if(v===undefined||v===null){v="";p="contains";}if(!Array.isArray(v)){v=[v];}if(!i){v=v.map(function(j){return j.toLowerCase();});}switch(p){case"equals":h=function(m,j){return m===j;};break;case"contains":h=function(m,j){return m.indexOf(j)!==-1;};break;case"startsWith":h=function(m,j){return m.indexOf(j)===0;};break;default:q.sap.log.error(sap.ui.vk.getResourceBundle().getText(a.VIT9.summary),a.VIT9.code,"sap.ui.vk.dvl.NodeHierarchy");}f=c;}r=g.bind(this)(e,f,b.category,b.key,v,h,i);}else{q.sap.log.error(sap.ui.vk.getResourceBundle().getText(a.VIT10.summary),a.VIT10.code,"sap.ui.vk.dvl.NodeHierarchy");}return q.sap.unique(r);};
return N;});
sap.ui.predefine('sap/ui/vk/NodeProxy',["jquery.sap.global","./library","sap/ui/base/ManagedObject"],function(q,l,M){"use strict";
var N=M.extend("sap.ui.vk.NodeProxy",{metadata:{properties:{nodeRef:"any",veIds:"object[]",name:"string",localMatrix:{type:"sap.ui.vk.TransformationMatrix",bindable:"bindable"},worldMatrix:{type:"sap.ui.vk.TransformationMatrix",bindable:"bindable"},opacity:{type:"float",bindable:"bindable"},tintColorABGR:{type:"int",bindable:"bindable"},tintColor:{type:"sap.ui.core.CSSColor",bindable:"bindable"},nodeMetadata:"object",hasChildren:"boolean",closed:"boolean"},publicMethods:["getSceneRef"]}});
N.prototype.setClosed=function(v){return this;};
N.prototype.setHasChildren=function(v){return this;};
N.prototype.setName=function(v){return this;};
N.prototype.setNodeId=function(v){return this;};
N.prototype.setNodeMetadata=function(v){return this;};
N.prototype.setVeIds=function(v){return this;};
return N;});
sap.ui.predefine('sap/ui/vk/NotificationsRenderer',["jquery.sap.global"],function(q){"use strict";var N={};
N.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapVizKitNotifications");r.writeClasses();r.write(">");r.renderControl(c.getAggregation("_messagePopoverToggleButton"));r.write("</div>");};
return N;},true);
sap.ui.predefine('sap/ui/vk/ProgressIndicator',["jquery.sap.global","./library","sap/m/ProgressIndicator"],function(q,l,M){"use strict";
var P=M.extend("sap.ui.vk.ProgressIndicator");
P.prototype.setPercentValue=function(p){var i=function i(v){return(typeof(v)==="number")&&!isNaN(v)&&v>=0&&v<=100;};var t=this,$,f,a=this.$(),A,u=false;if(!i(p)){p=0;q.sap.log.warning(this+": percentValue ("+p+") is not correct! Setting the default percentValue:0.");}if(this.getPercentValue()!==p){f=this.getPercentValue()-p;this.setProperty("percentValue",p,true);if(!a.length){return this;}["sapMPIValueMax","sapMPIValueMin","sapMPIValueNormal","sapMPIValueGreaterHalf"].forEach(function(c){a.removeClass(c);});a.addClass(this._getCSSClassByPercentValue(p));a.addClass("sapMPIAnimate").attr("aria-valuenow",p).attr("aria-valuetext",this._getAriaValueText({fPercent:p}));A=u?Math.abs(f)*20:0;$=this.$("bar");$.animate({"flex-basis":p+"%"},A,"linear",function(){t._setText.apply(t);t.$().removeClass("sapMPIAnimate");});}return this;};
return P;},true);
sap.ui.predefine('sap/ui/vk/ProgressIndicatorRenderer',["jquery.sap.global","sap/m/ProgressIndicatorRenderer"],function(q,P){"use strict";return P;},true);
sap.ui.predefine('sap/ui/vk/RedlineDesign',["jquery.sap.global","./library","sap/ui/core/Control","./RedlineSurface","./RedlineElement","./RedlineGesturesHandler","./RedlineDesignHandler","./Loco"],function(q,l,C,R,a,b,c,L){"use strict";
var d=R.extend("sap.ui.vk.RedlineDesign",{metadata:{library:"sap.ui.vk",events:{elementCreated:{parameters:{element:"object"}}},aggregations:{activeElementInstance:{type:"sap.ui.vk.RedlineElement",multiple:false,visibility:"hidden"}}}});
d.prototype.init=function(){this._isAddingModeActive=false;this._isDrawingOn=false;this._activeElementInstance=null;this.addStyleClass("sapUiVizkitRedlineInteractionMode");this._gestureHandler=new b(this);this._designHandler=new c(this);};
d.prototype.onBeforeRendering=function(){if(this._loco){this._loco.removeHandler(this._gestureHandler);this._loco.removeHandler(this._designHandler);}};
d.prototype.onAfterRendering=function(){var e=this.getDomRef();e.style.width="100%";e.style.height="100%";this._loco=new L();if(this._isAddingModeActive){this._loco.addHandler(this._designHandler);}else{this._loco.addHandler(this._gestureHandler);}this.updatePanningRatio();};
d.prototype._editElement=function(e,o,f){e.edit(o,f);return this;};
d.prototype._getIsDrawingOn=function(){return this._isDrawingOn;};
d.prototype._setIsDrawingOn=function(i){this._isDrawingOn=i;return this;};
d.prototype.startAdding=function(e){this._isAddingModeActive=true;this._activeElementInstance=e;this.setAggregation("activeElementInstance",this._activeElementInstance);this.addStyleClass("sapUiVizkitRedlineDesignMode");this.removeStyleClass("sapUiVizkitRedlineInteractionMode");return this;};
d.prototype.stopAdding=function(){this._isAddingModeActive=false;this._setIsDrawingOn(false);this.setAggregation("activeElementInstance",null);this._activeElementInstance=null;this.addStyleClass("sapUiVizkitRedlineInteractionMode");this.removeStyleClass("sapUiVizkitRedlineDesignMode");return this;};
d.prototype._getOffset=function(o){var r=o.getBoundingClientRect();return{x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};};
return d;});
sap.ui.predefine('sap/ui/vk/RedlineDesignHandler',["jquery.sap.global","sap/ui/base/EventProvider","sap/ui/core/ResizeHandler"],function(q,E,R){"use strict";
var a=E.extend("RedlineDesignHandler",{
metadata:{publicMethods:["beginGesture","move","endGesture","click","doubleClick","contextMenu","getViewport"]},
constructor:function(r){this._redlineDesign=r;this._x=0;this._y=0;this._gesture=false;}
});
a.prototype.destroy=function(){this._redlineDesign=null;this._rect=null;this._gesture=false;};
a.prototype._getOffset=function(d){var r=d.getBoundingClientRect();return{x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};};
a.prototype._inside=function(e,r){var b=r.getDomRef(),i=false;if(b!==null){var c=this._getOffset(b);var d={x:c.x,y:c.y,width:b.getBoundingClientRect().width,height:b.getBoundingClientRect().height};i=(e.x>=d.x&&e.x<=d.x+d.width&&e.y>=d.y&&e.y<=d.y+d.height);}return i;};
a.prototype._onresize=function(e){this._gesture=false;};
a.prototype.beginGesture=function(e){var v=this.getViewport();if(this._inside(e,v)&&v._activeElementInstance){this._gesture=true;this._x=e.x;this._y=e.y;v._setIsDrawingOn(true);var d=v.getDomRef();var t=v._toVirtualSpace(e.x-d.getBoundingClientRect().left-window.pageXOffset,e.y-d.getBoundingClientRect().top-window.pageYOffset);v._activeElementInstance.setOriginX(t.x);v._activeElementInstance.setOriginY(t.y);if(sap.ui.Device.browser.msie||sap.ui.Device.browser.edge){v.invalidate();}else{var r=sap.ui.getCore().createRenderManager();v._activeElementInstance.render(r);r.flush(v.getDomRef(),false,true);r.destroy();var x=v.$();x.html(x.html());}e.handled=true;}return this;};
a.prototype.move=function(e){var v=this.getViewport();if(v._activeElementInstance&&v._getIsDrawingOn()){var b=v.getDomRef().getBoundingClientRect(),o=e.x-b.left-window.pageXOffset,c=e.y-b.top-window.pageYOffset;v._editElement(v._activeElementInstance,o,c);}e.handled=true;return this;};
a.prototype.endGesture=function(e){var v=this.getViewport();this._gesture=false;if(v._activeElementInstance){v.addRedlineElement(v._activeElementInstance);v.fireElementCreated({element:v._activeElementInstance});v.stopAdding();}return this;};
a.prototype.click=function(e){};
a.prototype.doubleClick=function(e){};
a.prototype.contextMenu=function(e){e.handled=true;};
a.prototype.getViewport=function(){return this._redlineDesign;};
return a;},true);
sap.ui.predefine('sap/ui/vk/RedlineDesignRenderer',["jquery.sap.global","./RedlineSurfaceRenderer","sap/ui/core/Renderer"],function(q,R,a){"use strict";var b=a.extend(R);
b.render=function(r,c){R.render.call(this,r,c);};
b.renderAfterRedlineElements=function(r,c){if(c._activeElementInstance&&c._getIsDrawingOn()){c._activeElementInstance.render(r);}};
return b;},true);
sap.ui.predefine('sap/ui/vk/RedlineElement',["jquery.sap.global","sap/ui/core/Element"],function(q,E){"use strict";
var R=E.extend("sap.ui.vk.RedlineElement",{metadata:{library:"sap.ui.vk",properties:{originX:{type:"float",defaultValue:0},originY:{type:"float",defaultValue:0},opacity:{type:"float",defaultValue:1},strokeWidth:{type:"float",defaultValue:2},strokeColor:{type:"sap.ui.core.CSSColor",defaultValue:"#e6600d"}}}});
R.prototype.init=function(){};
R.prototype.onAfterRendering=function(){};
R.prototype.setOriginX=function(o){this.setProperty("originX",o,true);};
R.prototype.setOriginY=function(o){this.setProperty("originY",o,true);};
R.prototype.applyZoom=function(){};
R.prototype.render=function(r){};
R.prototype.exportJSON=function(){return{originX:this.getOriginX(),originY:this.getOriginY(),opacity:this.getOpacity(),strokeColor:this.getStrokeColor(),strokeWidth:this.getStrokeWidth()};};
R.prototype.importJSON=function(j){if(j.hasOwnProperty("originX")){this.setOriginX(j.originX);}if(j.hasOwnProperty("originY")){this.setOriginY(j.originY);}if(j.hasOwnProperty("opacity")){this.setOpacity(j.opacity);}if(j.hasOwnProperty("strokeColor")){this.setStrokeColor(j.strokeColor);}if(j.hasOwnProperty("strokeWidth")){this.setStrokeWidth(j.strokeWidth);}return this;};
return R;});
sap.ui.predefine('sap/ui/vk/RedlineElementEllipse',["jquery.sap.global","./RedlineElement"],function(q,R){"use strict";
var a=R.extend("sap.ui.vk.RedlineElementEllipse",{metadata:{library:"sap.ui.vk",properties:{radiusX:{type:"float",defaultValue:0.0001},radiusY:{type:"float",defaultValue:0.0001},fillColor:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(0, 0, 0, 0)"}}}});
a.prototype.init=function(){};
a.prototype.edit=function(o,b){var p=this.getParent(),t=p._toVirtualSpace(o,b),r=t.x-this.getOriginX(),c=t.y-this.getOriginY(),d=p._toVirtualSpace(1);this.setRadiusX(r>0?r:d);this.setRadiusY(c>0?c:d);return this;};
a.prototype.applyZoom=function(z){this.setProperty("radiusX",this.getRadiusX()*z,true);this.setProperty("radiusY",this.getRadiusY()*z,true);return this;};
a.prototype.setRadiusX=function(r){this.setProperty("radiusX",r,true);var d=this.getDomRef();if(d){d.setAttribute("rx",this.getParent()._toPixelSpace(r));}};
a.prototype.setRadiusY=function(r){this.setProperty("radiusY",r,true);var d=this.getDomRef();if(d){d.setAttribute("ry",this.getParent()._toPixelSpace(r));}};
a.prototype.render=function(r){var p=this.getParent();r.write("<ellipse");r.writeElementData(this);var o=p._toPixelSpace(this.getOriginX(),this.getOriginY());r.writeAttribute("cx",o.x);r.writeAttribute("cy",o.y);r.writeAttribute("rx",p._toPixelSpace(this.getRadiusX()));r.writeAttribute("ry",p._toPixelSpace(this.getRadiusY()));r.writeAttribute("fill",this.getFillColor());r.writeAttribute("stroke",this.getStrokeColor());r.writeAttribute("stroke-width",this.getStrokeWidth());r.writeAttribute("opacity",this.getOpacity());r.write("></ellipse>");};
a.prototype.exportJSON=function(){return q.extend(true,R.prototype.exportJSON.call(this),{type:sap.ui.vk.Redline.ElementType.Ellipse,version:1,radiusX:this.getRadiusX(),radiusY:this.getRadiusY(),fillColor:this.getFillColor()});};
a.prototype.importJSON=function(j){if(j.type===sap.ui.vk.Redline.ElementType.Ellipse){if(j.version===1){R.prototype.importJSON.call(this,j);if(j.hasOwnProperty("radiusX")){this.setRadiusX(j.radiusX);}if(j.hasOwnProperty("radiusY")){this.setRadiusY(j.radiusY);}if(j.hasOwnProperty("fillColor")){this.setFillColor(j.fillColor);}}else{q.sap.log.error("wrong version number");}}else{q.sap.log.error("wrong element type");}return this;};
return a;});
sap.ui.predefine('sap/ui/vk/RedlineElementFreehand',["jquery.sap.global","./RedlineElement"],function(q,R){"use strict";
var a=R.extend("sap.ui.vk.RedlineElementFreehand",{metadata:{library:"sap.ui.vk",properties:{path:{type:"float[]",defaultValue:null}}}});
a.prototype.init=function(){};
a.prototype.setPath=function(p){this.setProperty("path",p,true);var d=this.getDomRef();if(d){d.setAttribute("d",this._getProcessedPath());}};
a.prototype.edit=function(o,b){var p=this.getParent();var t=p._toVirtualSpace(o,b);var c=this.getPath()||[];c.push(t.x-this.getOriginX(),t.y-this.getOriginY());this.setPath(c);var d=this.getDomRef();if(d){d.setAttribute("d",this._getProcessedPath());}return this;};
a.prototype.applyZoom=function(z){this.setProperty("path",this.getPath().map(function(v){return v*z;}),true);return this;};
a.prototype._getProcessedPath=function(){var p=this.getParent(),o=p._toPixelSpace(this.getOriginX(),this.getOriginY());var d="";(this.getPath()||[]).forEach(function(e,i){e=p._toPixelSpace(e);if(i===0){d+="M "+(o.x+e);}else if(i===1){d+=" "+(o.y+e);}else{d+=" "+(i%2===0?"L "+(o.x+e):(o.y+e));}});return d;};
a.prototype.render=function(r){r.write("<path");r.writeElementData(this);r.writeAttribute("d",this._getProcessedPath());r.writeAttribute("stroke",this.getStrokeColor());r.writeAttribute("stroke-width",this.getStrokeWidth());r.writeAttribute("opacity",this.getOpacity());r.writeAttribute("fill","none");r.write("></path>");};
a.prototype.exportJSON=function(){return q.extend(true,R.prototype.exportJSON.call(this),{type:sap.ui.vk.Redline.ElementType.Freehand,version:1,path:(this.getPath()||[]).slice()});};
a.prototype.importJSON=function(j){if(j.type===sap.ui.vk.Redline.ElementType.Freehand){if(j.version===1){R.prototype.importJSON.call(this,j);if(j.hasOwnProperty("path")){this.setPath(j.path.slice());}}else{q.sap.log.error("wrong version number");}}else{q.sap.log.error("wrong element type");}return this;};
return a;});
sap.ui.predefine('sap/ui/vk/RedlineElementRectangle',["jquery.sap.global","./RedlineElement"],function(q,R){"use strict";
var a=R.extend("sap.ui.vk.RedlineElementRectangle",{metadata:{library:"sap.ui.vk",properties:{width:{type:"float",defaultValue:0.001},height:{type:"float",defaultValue:0.001},fillColor:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(0, 0, 0, 0)"}}}});
a.prototype.init=function(){};
a.prototype.edit=function(o,b){var p=this.getParent(),t=p._toVirtualSpace(o,b),w=t.x-this.getOriginX(),h=t.y-this.getOriginY(),c=p._toVirtualSpace(1);this.setWidth(w>0?w:c);this.setHeight(h>0?h:c);return this;};
a.prototype.applyZoom=function(z){this.setProperty("width",this.getWidth()*z,true);this.setProperty("height",this.getHeight()*z,true);return this;};
a.prototype.setWidth=function(w){this.setProperty("width",w,true);var d=this.getDomRef();if(d){d.setAttribute("width",this.getParent()._toPixelSpace(w));}};
a.prototype.setHeight=function(h){this.setProperty("height",h,true);var d=this.getDomRef();if(d){d.setAttribute("height",this.getParent()._toPixelSpace(h));}};
a.prototype.render=function(r){var p=this.getParent();r.write("<rect");r.writeElementData(this);var o=p._toPixelSpace(this.getOriginX(),this.getOriginY());r.writeAttribute("x",o.x);r.writeAttribute("y",o.y);r.writeAttribute("width",p._toPixelSpace(this.getWidth()));r.writeAttribute("height",p._toPixelSpace(this.getHeight()));r.writeAttribute("fill",this.getFillColor());r.writeAttribute("stroke",this.getStrokeColor());r.writeAttribute("stroke-width",this.getStrokeWidth());r.writeAttribute("opacity",this.getOpacity());r.write("></rect>");};
a.prototype.exportJSON=function(){return q.extend(true,R.prototype.exportJSON.call(this),{type:sap.ui.vk.Redline.ElementType.Rectangle,version:1,width:this.getWidth(),height:this.getHeight(),fillColor:this.getFillColor()});};
a.prototype.importJSON=function(j){if(j.type===sap.ui.vk.Redline.ElementType.Rectangle){if(j.version===1){R.prototype.importJSON.call(this,j);if(j.hasOwnProperty("width")){this.setWidth(j.width);}if(j.hasOwnProperty("height")){this.setHeight(j.height);}if(j.hasOwnProperty("fillColor")){this.setFillColor(j.fillColor);}}else{q.sap.log("wrong version number");}}else{q.sap.log("wrong element type");}return this;};
return a;});
sap.ui.predefine('sap/ui/vk/RedlineGesturesHandler',["jquery.sap.global","sap/ui/base/EventProvider","sap/ui/core/ResizeHandler"],function(q,E,R){"use strict";
var a=E.extend("RedlineGesturesHandler",{
metadata:{publicMethods:["beginGesture","move","endGesture","click","doubleClick","contextMenu","getViewport"]},
constructor:function(r){this._redlineDesign=r;this._x=0;this._y=0;this._gesture=false;var v=this.getViewport();v._currentPosition={x:0,y:0};v._totalMoveX=0;v._totalMoveY=0;}
});
a.prototype.destroy=function(){this._redlineDesign=null;this._rect=null;this._gesture=false;};
a.prototype._getOffset=function(d){var r=d.getBoundingClientRect();return{x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};};
a.prototype._inside=function(e,r){var b=r.getDomRef(),i=false;if(b!==null){var c=this._getOffset(b);var d={x:c.x,y:c.y,width:b.getBoundingClientRect().width,height:b.getBoundingClientRect().height};i=(e.x>=d.x&&e.x<=d.x+d.width&&e.y>=d.y&&e.y<=d.y+d.height);}return i;};
a.prototype._onresize=function(e){this._gesture=false;};
a.prototype.beginGesture=function(e){var v=this.getViewport();if(this._inside(e,v)){this._gesture=true;this._x=e.x;this._y=e.y;var o=this._getOffset(v.getDomRef());this._gestureOriginX=e.x-o.x;this._gestureOriginY=e.y-o.y;this._distanceBetweenTouchPoints=null;if(e.n===1){this._lastMoveCoordinates={};this._totalDeltaMove={x:0,y:0};}e.handled=true;}return this;};
a.prototype._pan=function(e){if(this._totalDeltaMove){var v=this.getViewport(),d=e.x-(this._lastMoveCoordinates.x||e.x),b=e.y-(this._lastMoveCoordinates.y||e.y);this._totalDeltaMove.x+=d;this._totalDeltaMove.y+=b;if(d||b){var p=v.getPanningRatio();v.firePan({deltaX:d*p,deltaY:b*p});v.getRedlineElements().forEach(function(c){c.setOriginX(c.getOriginX()+v._toVirtualSpace(d));c.setOriginY(c.getOriginY()+v._toVirtualSpace(b));});this._manualRender(v);}this._lastMoveCoordinates.x=e.x;this._lastMoveCoordinates.y=e.y;}else{this._totalDeltaMove={x:0,y:0};this._lastMoveCoordinates={};}};
a.prototype._zoom=function(e){var v=this.getViewport(),z;if(e.scroll!==undefined){if(e.scroll>0){z=1.05;}else if(e.scroll<0){z=1/1.05;}else if(this._distanceBetweenTouchPoints!==null){var d=e.d-this._distanceBetweenTouchPoints;if(d>0){z=1.05;}else if(d<0){z=1/1.05;}else{return;}this._distanceBetweenTouchPoints=e.d;}else{this._distanceBetweenTouchPoints=e.d;return;}}else if(e.points[0].y<e.points[1].y){z=1.05;}else{z=1/1.05;}var s=1-z,p=v._toVirtualSpace(this._gestureOriginX,this._gestureOriginY);v.getRedlineElements().forEach(function(b){b.applyZoom(z);var o=b.getOriginX(),c=b.getOriginY();o+=(p.x-o)*s;c+=(p.y-c)*s;b.setOriginX(o);b.setOriginY(c);});this._manualRender(v);v.fireZoom({originX:this._gestureOriginX,originY:this._gestureOriginY,zoomFactor:z});};
a.prototype.move=function(e){if(this.getViewport().getDomRef()){if(e.n===2&&(e.buttons===4||e.buttons===3)||e.n===1){this._pan(e);}else if((e.n===2&&e.buttons===2)||(sap.ui.Device.system.tablet&&e.n===2&&e.buttons===0)){this._zoom(e);}}e.handled=true;return this;};
a.prototype._manualRender=function(r){if(sap.ui.Device.browser.msie||sap.ui.Device.browser.edge){r.invalidate();}else{var b=sap.ui.getCore().createRenderManager();r.getRedlineElements().forEach(function(e){e.render(b);});b.flush(r.getDomRef(),false,false);b.destroy();var x=r.$();x.html(x.html());}};
a.prototype.endGesture=function(e){this._gestureOriginX=0;this._gestureOriginY=0;this._lastMoveCoordinates={};this._totalDeltaMove={x:0,y:0};this._gesture=false;e.handled=true;return this;};
a.prototype.click=function(e){};
a.prototype.doubleClick=function(e){};
a.prototype.contextMenu=function(e){e.handled=true;};
a.prototype.getViewport=function(){return this._redlineDesign;};
return a;},true);
sap.ui.predefine('sap/ui/vk/RedlineSurface',["jquery.sap.global","./library","sap/ui/core/Control","./Loco","./RedlineGesturesHandler"],function(q,l,C,L){"use strict";
var R=C.extend("sap.ui.vk.RedlineSurface",{metadata:{library:"sap.ui.vk",aggregations:{redlineElements:{type:"sap.ui.vk.RedlineElement"}},properties:{virtualLeft:{type:"float"},virtualTop:{type:"float"},virtualSideLength:{type:"float"},panningRatio:{type:"float",defaultValue:1}},events:{pan:{parameters:{deltaX:"float",deltaY:"float"}},zoom:{parameters:{originX:"float",originY:"float",zoomFactor:"float"}}}}});
R.prototype.init=function(){};
R.prototype.onAfterRendering=function(){};
R.prototype.exportJSON=function(){return this.getRedlineElements().map(function(e){return e.exportJSON();});};
R.prototype.importJSON=function(j){if(!q.isArray(j)){j=[j];}var v=this.getVirtualLeft(),a=this.getVirtualTop(),b=this.getVirtualSideLength();j.forEach(function(c){var E;switch(c.type){case sap.ui.vk.Redline.ElementType.Rectangle:E=sap.ui.vk.RedlineElementRectangle;break;case sap.ui.vk.Redline.ElementType.Ellipse:E=sap.ui.vk.RedlineElementEllipse;break;case sap.ui.vk.Redline.ElementType.Freehand:E=sap.ui.vk.RedlineElementFreehand;break;default:}this.addRedlineElement(new E().importJSON(c,v,a,b));}.bind(this));return this;};
R.prototype._toVirtualSpace=function(x,y){if(arguments.length===1){return x/this.getVirtualSideLength();}else{return{x:(x-this.getVirtualLeft())/this.getVirtualSideLength(),y:(y-this.getVirtualTop())/this.getVirtualSideLength()};}};
R.prototype._toPixelSpace=function(x,y){if(arguments.length===1){return x*this.getVirtualSideLength();}else{return{x:x*this.getVirtualSideLength()+this.getVirtualLeft(),y:y*this.getVirtualSideLength()+this.getVirtualTop()};}};
R.prototype.setPanningRatio=function(p){this.setProperty("panningRatio",p,true);};
R.prototype.updatePanningRatio=function(){var v=this.getVirtualLeft(),a=this.getVirtualTop(),r=this.getDomRef(),b=r.getBoundingClientRect(),h=b.height,w=b.width,p;if(v===0&&(h<w&&a<0||(h>w&&a>0))){p=h/w;}else{p=1;}this.setPanningRatio(p);return this;};
return R;});
sap.ui.predefine('sap/ui/vk/RedlineSurfaceRenderer',["jquery.sap.global"],function(q){"use strict";var R={};
R.render=function(r,c){r.write("<svg");r.writeControlData(c);r.addClass("sapUiVizkitRedlineSurface");r.writeClasses();r.write(">");c.getRedlineElements().forEach(function(a){a.render(r);});this.renderAfterRedlineElements(r,c);r.write("</svg>");};
R.renderAfterRedlineElements=function(r,c){};
return R;},true);
sap.ui.predefine('sap/ui/vk/Scene',["jquery.sap.global","sap/ui/base/Object"],function(q,B){"use strict";
var S=B.extend("sap.ui.vk.Scene",{metadata:{"abstract":true}});
return S;});
sap.ui.predefine('sap/ui/vk/SceneTree',["jquery.sap.global","./library","sap/ui/core/Control","sap/ui/table/TreeTable","sap/ui/table/Column","sap/ui/model/json/JSONModel","sap/m/Title","./CheckEye","./ContentConnector","./ViewStateManager"],function(q,l,C,T,a,J,b,c,d,V){"use strict";
var S=C.extend("sap.ui.vk.SceneTree",{metadata:{library:"sap.ui.vk",aggregations:{_tree:{type:"sap.ui.table.TreeTable",multiple:false,visibility:"hidden"}},associations:{contentConnector:{type:"sap.ui.vk.ContentConnector",multiple:false},viewStateManager:{type:"sap.ui.vk.ViewStateManager",multiple:false}}}});
var g=function(i,s){return sap.ui.vk.getResourceBundle().getText(i?"SCENETREE_VISIBILITYSTATEVISIBLE":"SCENETREE_VISIBILITYSTATEHIDDEN");};
S.prototype._createNodeForSceneTree=function(n,e,v){var f=v.getVisibilityState(e);return{name:n,id:e,visible:f,checkEyeTooltip:g(f,this)};};
S.prototype.setScene=function(s,v){this.setViewStateManager(v);this._setScene(s);};
S.prototype._setScene=function(s){this._scene=s;this.refresh();};
S.prototype.init=function(){if(C.prototype.init){C.prototype.init.apply(this);}var _=new b({text:sap.ui.vk.getResourceBundle().getText("SCENETREE_TITLE"),tooltip:sap.ui.vk.getResourceBundle().getText("SCENETREE_TITLE")});_.onAfterRendering=function(){var $=this.$();$.addClass("sapUiVkTitle");};this._visibilityColumnHeader=new c({checked:true,tooltip:g(true,this),change:function(e){var i=e.getParameters("checked").checked;this.setTooltip(g(i,this));this._toggleVisibilityForAllChildren(this._model.getData(),i);}.bind(this)});this._tree=new T({title:_,columnHeaderHeight:32,columns:[new a({label:sap.ui.vk.getResourceBundle().getText("SCENETREE_NAME"),tooltip:sap.ui.vk.getResourceBundle().getText("SCENETREE_NAME"),template:new sap.m.Text({text:"{name}",maxLines:1,tooltip:"{name}"}),resizable:false}),new a({label:this._visibilityColumnHeader,template:new c({checked:"{visible}",tooltip:"{checkEyeTooltip}"}),width:"2.7em",resizable:false,hAlign:"Center"})],selectionMode:"MultiToggle",selectionBehavior:"RowSelector",visibleRowCountMode:"Fixed",expandFirstLevel:false,collapseRecursive:true,rowHeight:32});this.setAggregation("_tree",this._tree,true);this._model=new J();this._tree.setModel(this._model);this._tree.bindRows({path:"/"});this._tree.attachRowSelectionChange(this._nodeSelection.bind(this));this._tree.getBinding("rows").attachChange(this._dataChange.bind(this));this._scene=null;this._syncing=false;this._selected={};this._toggled={};this._vsmSelected={};this._forwardTimer=0;this._reverseTimer=0;this._vSyncing=false;this._lastChangeIsExpand=false;this._forwardVTimer=0;this._reverseVTimer=0;this._scrollTimer=0;this._totalNodes=null;};
S.prototype.onBeforeRendering=function(){this._tree.setVisible(true);};
S.prototype._pathToNode=function(p,e,t){p=p.substr(1);if(e==undefined){e=this._model.getData();}var n=e;var f=n;var h="";while(p.length>0){var i=p.indexOf("/");if(i>=0){h=p.substr(0,i);p=p.substr(i+1);}else{h=p;p="";}f=n;n=f[h];}if(t!=undefined){f[h]=t;}return n;};
S.prototype._indexToNodeRef=function(i){var e=this._tree.getContextByIndex(i);if(e){var n=this._pathToNode(e.sPath,e.oModel.oData);return n.id;}else{return null;}};
S.prototype._deselectHidden=function(){var v=this._vsmSelected;var e=this._viewStateManager;var f=[];var u={};for(var i=0;;i++){var r=this._indexToNodeRef(i);if(r==null){break;}if(v.hasOwnProperty(r)){u[r]=true;}}for(var k in v){if(v.hasOwnProperty(k)&&v[k]==true&&!u.hasOwnProperty(k)&&k!=""){f.push(k);v[k]=false;}}if(f.length>0){this._syncing=true;e.setSelectionState(f,false,false);this._syncing=false;}};
S.prototype._nodeSelection=function(e){if(this._tree.getBinding("rows")._aSelectedContexts!=undefined){return;}if(!this._syncing){if(this._forwardTimer>0){clearTimeout(this._forwardTimer);}var p=e.mParameters;var f=p.rowIndices;var h=this._tree.getSelectedIndices();if(f.length>=1&&h.length==1){if(f.indexOf(h[0])!=-1){this._deselectHidden();}}for(var i=0;i<f.length;i++){var j=f[i];if(this._toggled.hasOwnProperty(j)){this._toggled[j]=!this._toggled[j];}else{this._toggled[j]=true;}if(!this._selected.hasOwnProperty(j)){this._selected[j]=false;}}this._forwardTimer=setTimeout(this._resyncSelectionForward.bind(this,f),100);}};
S.prototype._handleSelectionChanged=function(e){if(!this._syncing){if(this._reverseTimer>0){clearTimeout(this._reverseTimer);}var s=e.mParameters.selected;var f=e.mParameters.unselected;for(var i=0;i<f.length;i++){if(this._vsmSelected[f[i]]!=undefined){delete this._vsmSelected[f[i]];}}for(var j=0;j<s.length;j++){this._vsmSelected[s[j]]=true;}if(s.length==1){this._expandToNode(s[0],this._resyncSelectionReverse.bind(this));}else{this._reverseTimer=setTimeout(this._resyncSelectionReverse.bind(this),100,true);}}};
S.prototype._resyncSelectionForward=function(t){this._forwardTimer=0;if(this._syncing){return false;}for(var i in this._selected){if(this._selected.hasOwnProperty(i)){var r=this._indexToNodeRef(parseInt(i,10));if(r==null||r==""){continue;}var e=this._selected[i];if(this._toggled[i]){e=!e;}if(t.indexOf(parseInt(i,10))!==-1){this._viewStateManager.setSelectionState(r,e,false);if(!e){var n=this._viewStateManager.getNodeHierarchy();var f=n.getAncestors(r);var p=f[f.length-1];if(this._viewStateManager.getSelectionState(p)){this._viewStateManager.setSelectionState(p,false);var s=this._tree.getSelectedIndices();for(var j=0,h=s.length;j<h;j++){var k=s[j];if(p===this._indexToNodeRef(k)){this._selected[k]=false;this._tree.removeSelectionInterval(k,k);break;}}this._vsmSelected[p]=false;}}}this._selected[i]=e;this._vsmSelected[r]=e;}}this._toggled={};this._syncing=false;};
S.prototype._resyncSelectionReverse=function(s){this._reverseTimer=0;if(this._syncing){return;}this._syncing=true;var v=this._viewStateManager;var t=this._tree;var e=0;this._selected={};for(var i=0;;i++){var r=this._indexToNodeRef(i);if(r==null||r==""){break;}var f=v.getSelectionState(r);if(f){this._selected[i]=true;e++;}if(f!=t.isIndexSelected(i)){if(f){t.addSelectionInterval(i,i);}else{t.removeSelectionInterval(i,i);}}}this._syncing=false;};
S.prototype._expandToNode=function(n,e){var t=this._totalNodes;var f=function(r,u){u.forEach(function(v){r=r[v];});return r;};var h=function(r,u,v){var w;if((u<r)||(u>=(r+v))){w=u-(v/2);}else{w=r;}w=w>0?Math.floor(w):0;return w;};var s=function(r,u){var v=r.getVisibleRowCount(),w=r.getFirstVisibleRow(),x=h(w,u,v);if(x!==w){r.setFirstVisibleRow(x);}};var i=function(r,n){var u=null,v;for(var w=0;w<t;w++){v=r.getContextByIndex(w);if(v){var x=v.getPath().split("/");x.shift();var y=v.getModel().getData();if(f(y,x).id===n){u=w;break;}}}return u;};var j=this._scene.getDefaultNodeHierarchy(),k=j.getAncestors(n);var m=function(r,u,k,v){if(v.getParameter("reason")==="expand"){r(u,k);}};var o;var p=function(r,k){setTimeout(function(){if(k.length){var u=k.shift();var v=i(r,u);if(v!==null){r.expand(v);}}else{var w=i(r,n);if(w!==null){s(r,w);r.getBinding("rows").detachChange(o);e();}}},70);};o=m.bind(this,p,this._tree,k);this._tree.getBinding("rows").attachChange(o);p(this._tree,k);};
S.prototype._dataChange=function(e){if(this._viewStateManager==null||this._scene==null||this._vSyncing){return;}if(this._lastChangeIsExpand){this._lastChangeIsExpand=false;return;}if(this._forwardVTimer>0){clearTimeout(this._forwardVTimer);}this._forwardVTimer=setTimeout(this._resyncVisibilityForward.bind(this),100);};
S.prototype._resyncVisibilityForward=function(){if(!this._vSyncing){this._vSyncing=true;this._forwardVTimer=0;this._setNodeVisibilityRecursive(this._model.getData(),this._viewStateManager);this._vSyncing=false;}};
S.prototype._enumerateChildrenIntoArray=function(n,e){var f=this._scene.getDefaultNodeHierarchy();f.enumerateChildren(n,function(p){var r=p.getNodeRef();e.push(r);if(p.getHasChildren()){this._enumerateChildrenIntoArray(r,e);}});};
S.prototype._setNodeVisibilityRecursive=function(n,v){if(n.id!=null&&v.getVisibilityState(n.id)!=n.visible){v.setVisibilityState(n.id,n.visible,true);if(n[0]!==undefined||n.hasOwnProperty("children")){if(this._reverseVTimer>0){clearTimeout(this._reverseVTimer);}this._reverseVTimer=setTimeout(this._resyncVisibilityReverse.bind(this),100);}}else{var e=n.hasOwnProperty("children")?n.children:n;for(var i=0;e[i]!=null;i++){this._setNodeVisibilityRecursive(e[i],v);}}};
S.prototype._toggleVisibilityForAllChildren=function(n,e){var f=n.hasOwnProperty("children")?n.children:n;for(var i=0;f[i]!=null;i++){this._viewStateManager.setVisibilityState(f[i].id,e,true);}};
S.prototype._handleVisibilityChanged=function(e){if(!this._vSyncing){if(this._reverseVTimer>0){clearTimeout(this._reverseVTimer);}this._reverseVTimer=setTimeout(this._resyncVisibilityReverse.bind(this),100);}};
S.prototype._resyncVisibilityReverse=function(){if(!this._vSyncing){this._vSyncing=true;this._forwardVTimer=0;this._getNodeVisibilityRecursive(this._model.getData(),this._viewStateManager);this._tree.getModel().refresh(true);this._vSyncing=false;}};
S.prototype._getNodeVisibilityRecursive=function(n,v){if(n.id!=null){n.visible=v.getVisibilityState(n.id);n.checkEyeTooltip=g(n.visible,this);}var e=n.hasOwnProperty("children")?n.children:n;for(var i=0;e[i]!=null;i++){this._getNodeVisibilityRecursive(e[i],v);}};
S.prototype.updateHeight=function(h){this._tree.setVisibleRowCount(Math.floor(h/this._tree.getRowHeight())-2);};
S.prototype.refresh=function(){if(this._scene==null||!this._viewStateManager||!this._viewStateManager.getNodeHierarchy()){this._model.setData([]);return;}var n=this._scene.getDefaultNodeHierarchy();var t=[];this._totalNodes=0;var e=function(t,f){f.forEach(function(h,i){var j=n.createNodeProxy(h);var k=this._createNodeForSceneTree(j.getName(),j.getNodeRef(),this._viewStateManager);t[i]=k;n.destroyNodeProxy(j);this._totalNodes++;k.children=[];e.bind(this)(k.children,n.getChildren(h));}.bind(this));};e.bind(this)(t,n.getChildren());this._model.setData(t);this._tree.setModel(this._model);this._tree.bindRows({path:"/",parameters:{arrayNames:["children"]}});this._tree.getBinding("rows").attachChange(this._dataChange.bind(this));this._visibilityColumnHeader.setChecked(true);this._visibilityColumnHeader.setTooltip(g(true,this));};
S.prototype._onBeforeClearContentConnector=S.prototype._onBeforeClearViewStateManager=function(){this._setScene(null);};S.prototype._onAfterUpdateContentConnector=S.prototype._onAfterUpdateViewStateManager=function(){this._setScene(this._contentConnector&&this._contentConnector.getContent());};
S.prototype._handleContentReplaced=function(e){this._setScene(e.getParameter("newContent"));};
S.prototype._handleNodeHierarchyReplaced=function(e){this._setScene(this._scene);};
S.prototype._handleContentChangesFinished=function(e){this.refresh();};
d.injectMethodsIntoClass(S);V.injectMethodsIntoClass(S);return S;},true);
sap.ui.predefine('sap/ui/vk/SceneTreeRenderer',["jquery.sap.global"],function(q){"use strict";var S={};
S.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapUiSizeCompact");r.addClass("sapUiVkSceneTree");r.writeClasses();r.write(">");r.renderControl(c.getAggregation("_tree"));r.write("</div>");};
return S;},true);
sap.ui.predefine('sap/ui/vk/Smart2DHandler',["jquery.sap.global","sap/ui/base/EventProvider","sap/ui/core/ResizeHandler"],function(q,E,R){"use strict";
var S=E.extend("Smart2DHandler",{
metadata:{publicMethods:["beginGesture","move","endGesture","click","doubleClick","contextMenu","getViewport"]},
constructor:function(v,a){this._viewport=v;this._rect=null;this._x=0;this._y=0;this._gesture=false;this._hitEndTimer=0;this._lastRender=0;this._viewport.attachEvent("resize",this,this._onresize);this._viewStateManager=a;this._previousColoring={nodeRef:null,nodeId:null,color:null};}
});
S.prototype.destroy=function(){this._viewport=null;this._rect=null;this._gesture=false;this._viewport.detachEvent("resize",this,this._onresize);this._viewStateManager=null;this._previousColoring=null;};
S.prototype._getOffset=function(d){var r=d.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};
S.prototype._inside=function(e){var v=this._viewport.getDomRef();if(v==null){return false;}var a=this._getOffset(v);this._rect={x:a.x,y:a.y,w:v.offsetWidth,h:v.offsetHeight};return(e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h);};
S.prototype._onresize=function(e){this._gesture=false;this._rect=null;};
S.prototype.beginGesture=function(e){if(this._inside(e)){this._gesture=true;this._x=e.x;this._y=e.y;}};
S.prototype.callbackHover=function(){var n=this._viewStateManager.getNodeHierarchy();this._lastRender=Date.now();this._hitEndTimer=0;var h=this._viewport.hitTest(this._x,this._y);if(this._highlightedNodeRef!==h){if(this._highlightedNodeRef!==sap.ve.dvl.DVLID_INVALID){var t=this._highlightedNodeRef===this._previousColoring.nodeRef?this._previousColoring.color:0;this._viewport.showHotspots(this._highlightedNodeRef,true,t);}if(n.getHotspotNodeIds().indexOf(h)!==-1){var a=n.createNodeProxy(h);this._previousColoring={nodeRef:h,nodeId:h,color:a.getTintColorABGR()};n.destroyNodeProxy(a);this._viewport.showHotspots(h,true);}this._highlightedNodeRef=h;}this._viewport.renderFrame();};
S.prototype.hover=function(e){if(e.n==1&&this._inside(e)){this._x=e.x-this._rect.x;this._y=e.y-this._rect.y;if(!this.getViewport().getShowAllHotspots()){var t=Date.now();if(t-this._lastRender>20){this.callbackHover();}if(this._hitEndTimer!=0){clearTimeout(this._hitEndTimer);}this._hitEndTimer=setTimeout(this.callbackHover.bind(this),20);}e.handled=true;}};
S.prototype.move=function(e){if(this._gesture&&e.n==1){this._viewport.pan(e.x-this._x,e.y-this._y);this._x=e.x;this._y=e.y;e.handled=true;}};
S.prototype.endGesture=function(e){this._gesture=false;};
S.prototype.click=function(e){};
S.prototype.doubleClick=function(e){};
S.prototype.contextMenu=function(e){};
S.prototype.getViewport=function(){return this._viewport;};
return S;},true);
sap.ui.predefine('sap/ui/vk/StepNavigation',["jquery.sap.global","./library","sap/ui/core/Control","sap/ui/core/ResizeHandler","./Loco","./ViewportHandler","sap/ui/core/Popup","sap/ui/core/IconPool","./Messages","./DvlException","./ContentConnector"],function(q,l,C,R,L,V,P,I,M,D,a){"use strict";
var S=C.extend("sap.ui.vk.StepNavigation",{metadata:{library:"sap.ui.vk",properties:{settings:"object",width:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},height:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},showThumbnails:{type:"boolean",group:"Appearance",defaultValue:true},showToolbar:{type:"boolean",group:"Appearance",defaultValue:true},showStepInfo:{type:"boolean",group:"Appearance",defaultValue:false}},publicMethods:["setScene","playStep","pauseStep","playAllSteps","getStep","getNextStep","getPreviousStep","getProceduresAndSteps","refresh","clear"],associations:{contentConnector:{type:"sap.ui.vk.ContentConnector"}},aggregations:{procedureItemTemplate:{type:"sap.ui.core.Item",multiple:false},stepInfoPopup:{type:"sap.ui.core.Control",multiple:false},layout:{type:"sap.m.Toolbar",multiple:false},thumbnailsContainer:{type:"sap.m.Panel",multiple:false}},events:{"resize":{parameters:{oldSize:"object",size:"object"}},"stepChanged":{parameters:{clientId:"object",type:"object",stepId:"object"}}}}});
S.prototype._onStepEvent=function(p){var s=this.getSettings();this.instanceSettings.currentStepId=p.stepId;switch(p.type){case sap.ve.dvl.DVLSTEPEVENT.DVLSTEPEVENT_FINISHED:s.currentStepFinished=true;s.currentStepPaused=false;s.playAllActive=false;s.isPlaying=false;this._togglePlayPause(true);break;case sap.ve.dvl.DVLSTEPEVENT.DVLSTEPEVENT_SWITCHED:case sap.ve.dvl.DVLSTEPEVENT.DVLSTEPEVENT_STARTED:s.currentStepId=p.stepId;s.currentStepFinished=false;this._highlightStep(p.stepId);if(s.currentStepPaused){this.pauseStep();}break;default:q.sap.log.error(sap.ui.vk.getResourceBundle().getText(M.VIT12.summary),M.VIT12.code,"sap.ui.vk.StepNavigation");}this.fireStepChanged({clientId:p.clientId,type:p.type,stepId:p.stepId});};
S.prototype.setScene=function(s){if(this._scene){this.oDvl.Client.detachStepEvent(this._onStepEvent,this);this.oDvl=null;}if(s){var b=s.getMetadata().getName();if(b!=="sap.ui.vk.dvl.Scene"){return;}}this._scene=s;this.instanceSettings={};if(this._scene){this.oDvl=s.getGraphicsCore().getApi(sap.ui.vk.dvl.GraphicsCoreApi.LegacyDvl);this.oDvl.Client.attachStepEvent(this._onStepEvent,this);}delete this._procedures;var p=this.getProcedureList();var o=this.getSettings();o.reset();p.unbindItems();p.setSelectedItem(p.getFirstItem());if(o.stepInfo.stepMessagePopup){if(!o.stepInfo.stepMessagePopup.isOpen()){o.stepInfo.stepMessagePopup.close();}o.stepInfo.stepMessagePopup.destroy();o.stepInfo.stepMessagePopup=null;this.getShowStepInfoButton().setText(sap.ui.vk.getResourceBundle().getText("STEP_NAV_STEPDESCRIPTIONHEADING"));}var c=this._getStepThumbnails();this.oModel.setData(c);this._togglePlayPause(true);this._refreshControl();this.refresh();};
S.prototype.init=function(){if(C.prototype.init){C.prototype.init.call(this);}if(this.getSettings()==undefined){this.setSettings(new this._settings());}this._scene=null;this.oModel=new sap.ui.model.json.JSONModel();this._layout=new sap.m.Toolbar({design:sap.m.ToolbarDesign.Solid});this.setAggregation("layout",this._layout);if(this.getShowThumbnails()){this._thumbnailsScroller=new sap.m.ScrollContainer(this.getId()+"-scroller",{width:"100%",horizontal:true,vertical:false,focusable:true});this._thumbnailsContainer=new sap.m.Panel({expandable:false,content:[this._thumbnailsScroller]});this.setAggregation("thumbnailsContainer",this._thumbnailsContainer);}this.playPreviousButton=new sap.m.Button(this.getId()+"-playPreviousButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://slim-arrow-left",tooltip:sap.ui.vk.getResourceBundle().getText("STEP_NAV_PREVIOUSSTEPBUTTON"),visible:true,press:function(e){var s=this.getSettings();var p=this.getPreviousStep(s.currentProcedureIndex);if(p){s.currentStepPaused=false;this.playStep(p.id,true,s.playAllActive);this._togglePlayPause(false);}}.bind(this)});this.playNextButton=new sap.m.Button(this.getId()+"-playNextButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://slim-arrow-right",tooltip:sap.ui.vk.getResourceBundle().getText("STEP_NAV_NEXTSTEPBUTTON"),visible:true,press:function(e){var s=this.getSettings();var n=this.getNextStep(s.currentProcedureIndex);if(n){s.currentStepPaused=false;this.playStep(n.id,true,s.playAllActive);this._togglePlayPause(false);}}.bind(this)});this.playOptionButton=new sap.m.Button(this.getId()+"-playOptionButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://media-play",tooltip:sap.ui.vk.getResourceBundle().getText("STEP_NAV_PLAYBUTTON_PLAY"),visible:true,press:function(e){var k=this.getPlayMenuButton().getSelectedKey();var s=this.getSettings();var f=null;switch(k){case"0":if(!s.currentStepId){f=this.getNextStep(s.currentProcedureIndex);if(f){s.currentStepId=f.id;}else{return;}}s.playAllActive=false;this.playStep(s.currentStepId,!s.currentStepPaused,s.playAllActive);s.isPlaying=true;s.currentStepPaused=false;this._togglePlayPause(false);break;case"1":s.playAllActive=true;s.currentStepPaused=false;this.playAllSteps(s.currentProcedureId);s.isPlaying=true;this._togglePlayPause(false);break;case"2":if(!s.currentStepId){f=this.getNextStep(s.currentProcedureIndex);if(f){s.currentStepId=f.id;}else{return;}}s.playAllActive=true;var p=!s.currentStepPaused;s.currentStepPaused=false;this.playStep(s.currentStepId,p,s.playAllActive);s.isPlaying=true;this._togglePlayPause(false);break;default:break;}}.bind(this)});this.procedureList=new sap.m.Select(this.getId()+"-procedureList",{tooltip:sap.ui.vk.getResourceBundle().getText("STEP_NAV_PROCEDURESLISTHEADING"),selectedKey:"0",type:sap.m.SelectType.Default,enabled:true,width:"30%",autoAdjustWidth:true,change:function(c){var p=this.getProcedureList();var s=this.getSettings();s.currentProcedureIndex=0;s.currentProcedureId=this.instanceSettings.currentProcedureId=p.getSelectedKey();s.currentStepId=this.instanceSettings.currentStepId=null;for(var i=0;i<this.oModel.oData.procedures.length;i++){if(this.oModel.oData.procedures[i].id==s.currentProcedureId){s.currentProcedureIndex=i;s.currentProcedure=this.oModel.oData.procedures[i];break;}}if(s.stepInfo.stepMessagePopup){if(!s.stepInfo.stepMessagePopup.isOpen()){s.stepInfo.stepMessagePopup.close();}s.stepInfo.stepMessagePopup.destroy();s.stepInfo.stepMessagePopup=null;}this._refreshItems();}.bind(this)});this.procedureList.addStyleClass("sapVizKitStepNavigationProcedureList");this.setAggregation("procedureItemTemplate",(new sap.ui.core.ListItem().bindProperty("text","name").bindProperty("key","id").bindProperty("tooltip","name")));this.playMenuButton=(new sap.m.Select(this.getId()+"-playMenuButtonIcon",{selectedKey:"0",type:sap.m.SelectType.Default,tooltip:sap.ui.vk.getResourceBundle().getText("STEP_NAV_PLAYMENU_PLAYOPTIONS"),enabled:true,autoAdjustWidth:false,items:[new sap.ui.core.ListItem({key:"0",icon:"sap-icon://media-play",text:sap.ui.vk.getResourceBundle().getText("STEP_NAV_PLAYMENU_PLAY"),tooltip:sap.ui.vk.getResourceBundle().getText("STEP_NAV_PLAYMENU_PLAY")}),new sap.ui.core.ListItem({key:"1",icon:"sap-icon://media-play",text:sap.ui.vk.getResourceBundle().getText("STEP_NAV_PLAYMENU_PLAYALL"),tooltip:sap.ui.vk.getResourceBundle().getText("STEP_NAV_PLAYMENU_PLAYALL")}),new sap.ui.core.ListItem({key:"2",icon:"sap-icon://media-play",text:sap.ui.vk.getResourceBundle().getText("STEP_NAV_PLAYMENU_PLAYALLREMAINING"),tooltip:sap.ui.vk.getResourceBundle().getText("STEP_NAV_PLAYMENU_PLAYALLREMAINING")})]}));this.playMenuButton.addStyleClass("sapVizKitStepNavigationPlayOptionsSelect");this.pauseButton=new sap.m.Button(this.getId()+"-pauseButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://media-pause",visible:false,tooltip:sap.ui.vk.getResourceBundle().getText("STEP_NAV_PLAYMENU_PAUSE"),press:function(e){var s=this.getSettings();this.pauseStep();s.currentStepPaused=true;s.isPlaying=false;this._togglePlayPause(true);}.bind(this)});this.showStepInfoButton=new sap.m.ToggleButton(this.getId()+"-showStepInfoButton",{icon:"sap-icon://hide",type:sap.m.ButtonType.Transparent,pressed:false,text:sap.ui.vk.getResourceBundle().getText("STEP_NAV_STEPDESCRIPTIONHEADING"),tooltip:sap.ui.vk.getResourceBundle().getText("STEP_NAV_STEPDESCRIPTIONHEADING"),press:function(e){var t=e.getSource();if(t.getPressed()){this.setShowStepInfo(true);t.setIcon("sap-icon://show");t.setTooltip(sap.ui.vk.getResourceBundle().getText("STEP_NAV_HIDESTEPDESCRIPTIONBUTTON"));}else{this.setShowStepInfo(false);t.setIcon("sap-icon://hide");t.setTooltip(sap.ui.vk.getResourceBundle().getText("STEP_NAV_SHOWSTEPDESCRIPTIONBUTTON"));}}.bind(this)});this._layout.addContent(this.playPreviousButton).addContent(this.playOptionButton).addContent(this.pauseButton).addContent(this.playMenuButton).addContent(this.procedureList).addContent(this.showStepInfoButton).addContent(new sap.m.ToolbarSpacer()).addContent(this.playNextButton);};
S.prototype.destroy=function(){return C.prototype.destroy.call(this);};
S.prototype.getScroller=function(){return this._thumbnailsScroller;};
S.prototype.getProcedureList=function(){var i=this.getId()+"-procedureList";var h=this._layout;var c=sap.ui.getCore().byId(i);return h.getContent()[h.indexOfContent(c)];};
S.prototype.getPlayMenuButton=function(){var i=this.getId()+"-playMenuButtonIcon";var h=this._layout;var c=sap.ui.getCore().byId(i);return h.getContent()[h.indexOfContent(c)];};
S.prototype.getPlayOptionButton=function(){var i=this.getId()+"-playOptionButton";var h=this._layout;var c=sap.ui.getCore().byId(i);return h.getContent()[h.indexOfContent(c)];};
S.prototype.getPauseButton=function(){var i=this.getId()+"-pauseButton";var h=this._layout;var c=sap.ui.getCore().byId(i);return h.getContent()[h.indexOfContent(c)];};
S.prototype.getPlayNextButton=function(){var i=this.getId()+"-playNextButton";var h=this._layout;var c=sap.ui.getCore().byId(i);return h.getContent()[h.indexOfContent(c)];};
S.prototype.getPlayPreviousButton=function(){var i=this.getId()+"-playPreviousButton";var h=this._layout;var c=sap.ui.getCore().byId(i);return h.getContent()[h.indexOfContent(c)];};
S.prototype.getShowStepInfoButton=function(){var i=this.getId()+"-showStepInfoButton";var h=this._layout;var c=sap.ui.getCore().byId(i);return h.getContent()[h.indexOfContent(c)];};
S.prototype.exit=function(){if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}if(C.prototype.exit){C.prototype.exit.apply(this);}};
S.prototype._settings=function(){return{enabled:false,toggle:{addCss:function(k,p,o,b){if(!this.targets[k]){this.targets[k]={"type":"css","property":p,"onValue":o,"offValue":b};}},addMethod:function(t,m,o,b,u){var k=t.getId();if(!this.targets[k]){this.targets[k]={"type":"method","target":t,"method":m,"onValue":o,"offValue":b,"useJQuery":u};}},targets:{}},currentProcedureIndex:0,currentProcedureId:"",currentProcedure:null,currentStepId:null,currentStep:null,currentStepPaused:false,isPlaying:false,currentStepFinished:true,playAllActive:false,showToolbar:true,showThumbnails:true,portfolioMode:false,reset:function(){this.currentStep=null;this.currentProcedure=null;this.currentProcedureIndex=0;this.currentProcedureId="";this.currentStepId=null;this.currentStepPaused=false;this.currentStepFinished=true;this.playAllActive=false;this.portfolioMode=false;},stepInfo:{lastTop:null,lastLeft:null,stepMessagePopup:null,openPopup:function(p,t,b,c){this._customHeaderText=this._customHeaderText||new sap.m.Text({width:"100%",textAlign:sap.ui.core.TextAlign.Center}).addStyleClass("sapVizKitStepNavigationPopoverTitle");this._customHeaderText.setText(p);this._customHeaderText.setTooltip(p);this._customHeader=this._customHeader||new sap.m.Bar({contentLeft:[this._customHeaderText]});this._textContent=this._textContent||new sap.m.Text({});this._textContent.addStyleClass("sapVizKitStepNavigationPopoverContent");this._textContent.setText(t);this.stepMessagePopup=this.stepMessagePopup||new sap.m.ResponsivePopover({placement:c,showCloseButton:true,verticalScrolling:true,contentHeight:"10%",contentWidth:"30%",content:[this._textContent],customHeader:this._customHeader});this.stepMessagePopup.addStyleClass("sapVizKitStepNavigationPopoverStepInfo");this.stepMessagePopup.openBy(b);}}};};
S.prototype.refresh=function(s){q.sap.log.info("StepNavigation refresh() called.");if(this.getVisible()&&(this["_getStepThumbnails"]&&this._scene!=null)){var p=this.getProcedureList();var o=this.getSettings();o.reset();p.setSelectedItem(p.getFirstItem());var b=this._getStepThumbnails();if(o.stepInfo.stepMessagePopup){if(!o.stepInfo.stepMessagePopup.isOpen()){o.stepInfo.stepMessagePopup.close();}o.stepInfo.stepMessagePopup.destroy();o.stepInfo.stepMessagePopup=null;}this.oModel.setData(b);this._togglePlayPause(true);this._refreshControl();}else if(this.getVisible()){this._refreshControl();}return true;};
S.prototype.clear=function(){q.sap.log.info("StepNavigation clear() called.");return true;};
S.prototype.onBeforeRendering=function(){if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}if(this.getShowToolbar()){var p=this.getProcedureList();p.setModel(this.oModel);var o=this.getProcedureItemTemplate();p.bindItems("/procedures",o);}};
S.prototype.onAfterRendering=function(){if(this._canvas){var b=this.getDomRef();b.appendChild(this._canvas);this._resizeListenerId=R.register(this,this._handleResize.bind(this));this._bestFit();this.fireResize({size:{width:b.clientWidth,height:b.clientHeight}});}var s=this.getSettings();this._togglePlayPause(!s.isPlaying);if(s.currentStepId){this._highlightStep(s.currentStepId);}};
S.prototype._handleResize=function(e){this.fireResize({oldSize:e.oldSize,size:e.size});this._update();};
S.prototype._reset=function(){this._x=0;this._y=0;this._s=1.0;this._r=0;};
S.prototype._update=function(){var x=this._x-(this._imageW-this._canvas.clientWidth)/2;var y=this._y-(this._imageH-this._canvas.clientHeight)/2;var t="matrix("+this._s+",0,0,"+this._s+","+x+","+y+")";this._img.style.transform=t;this._img.style.webkitTransform=t;this._img.style.msTransform=t;this._img.style.MozTransform=t;this._img.style.OTransform=t;};
S.prototype._bestFit=function(){this._reset();var s=this._canvas.clientWidth/this._img.width;var b=this._canvas.clientHeight/this._img.height;this._s=s<b?s:b;if(this._s==0){this._s=1.0;}this._x=0;this._y=0;this._update();};
var d={onAfterRendering:function(e){e.srcControl.focus();e.srcControl.removeEventDelegate(this);}};
S.prototype._togglePlayPause=function(p){this.togglePlayPauseActive=true;if(this.getSettings().showToolbar){var b=this.getPlayOptionButton(),c=this.getPauseButton();if(p){if(sap.ui.getCore().getCurrentFocusedControlId()===c.getId()){b.addEventDelegate(d);}c.setVisible(false);b.setVisible(true);}else{if(sap.ui.getCore().getCurrentFocusedControlId()===b.getId()){c.addEventDelegate(d);}b.setVisible(false);c.setVisible(true);}}};
S.prototype._refreshControl=function(){if(!this.oModel.oData.procedures){return;}var p=this.getProcedureList();var o=this.getProcedureItemTemplate();var s=this.getSettings();if(s.stepInfo.stepMessagePopup){if(!s.stepInfo.stepMessagePopup.isOpen()){s.stepInfo.stepMessagePopup.close();}s.stepInfo.stepMessagePopup.destroy();s.stepInfo.stepMessagePopup=null;this.getShowStepInfoButton().setText(sap.ui.vk.getResourceBundle().getText("STEP_NAV_STEPDESCRIPTIONHEADING"));}p.unbindItems();if(this.oModel.oData.procedures.length>0){var f=this.oModel.oData.procedures[0];if(this.getShowToolbar()){p.bindItems("/procedures",o);p.selectedKey=f.id;p.enabled=true;}this._refreshItems();}else{if(this.getShowToolbar()){p.bindItems("/procedures",o);p.enabled=false;}if(this.getShowThumbnails()){var b=this.getScroller();b.destroyContent();}}};
S.prototype._refreshItems=function(){var t=this;var s=[];var p=this.getProcedureList();var o=t.getSettings();var b=new sap.m.HBox();if(!o.currentProcedure){o.currentProcedure=t.oModel.oData.procedures[o.currentProcedureIndex];p.setSelectedItem(p.getFirstItem());}if(o.currentProcedureId!=""||t.oModel.oData.procedures.length>0){if(t.getShowThumbnails()){var c=t.getScroller();c.removeAllContent();s=t.oModel.oData.procedures[o.currentProcedureIndex].steps;var e=function(g){o.currentStepPaused=false;var h=sap.ui.getCore().byId(g.getSource().getId());t.playStep(h.getCustomData()[0].getValue("stepId"));o.playAllActive=false;t._togglePlayPause(false);};for(var i=0;i<s.length;i++){var f=new sap.m.Image({alt:s[i].name,src:"data:image/"+s[i].thumbnailType+";base64,"+s[i].thumbnailData,densityAware:false,tooltip:s[i].name,press:e.bind(t),layoutData:new sap.m.FlexItemData({shrinkFactor:0})});f.data("stepId",s[i].id);f.addCustomData(new sap.ui.core.CustomData({key:"stepId",value:s[i].id}));f.addStyleClass("sapVizKitStepNavigationStepItem");b.addItem(f);}c.addContent(b);}}};
S.prototype._getPopupPlacement=function(e){var p=null;var y=0;while(e){y+=e.offsetTop;e=e.offsetParent;}if(y>200){p=sap.m.PlacementType.Top;}else{p=sap.m.PlacementType.Bottom;}return p;};
S.prototype._isScrollingNecessary=function(i,s){var b;if(i&&s){var c=q(i).offset().left+q(i).width();var t=q(s).width();if(c-q(i).width()<0){b=true;}else if((t-c)<q(i).width()){b=true;}else{b=false;}}else{b=false;}return b;};
S.prototype._scrollToItem=function(i,s){var p={},o=q(i).offset(),c=q(s).scrollLeft();p.scrollLeft=o.left+(c-q(s).offset().left);p.scrollLeft-=parseInt(q(i).css("marginLeft"),10)||0;p.scrollLeft-=parseInt(q(i).css("borderLeftWidth"),10)||0;q(s).animate(p,50);};
S.prototype._highlightStep=function(s){var t=this;if(t.getVisible()){var o=t.getSettings();var b=t.getStep(0,o.currentProcedureIndex,s);if(!o.currentProcedure){o.currentProcedure=t.oModel.oData.procedures[t.oSettings.currentProcedureIndex];}var c=t.getShowStepInfoButton();var p;var e=document.getElementById(c.getId());p=t._getPopupPlacement(e);if(t.getShowStepInfo()){o.stepInfo.openPopup.call(this,b.name,b.description,c,p);}else if(o.stepInfo.stepMessagePopup&&o.stepInfo.stepMessagePopup.isOpen()){o.stepInfo.stepMessagePopup.close();}if(t.getShowThumbnails()){var f=t.getScroller();var T=f.getContent()[0].getItems();for(var i=0;i<T.length;i++){if(T[i].getCustomData()[0].getValue("stepId")==s){T[i].addStyleClass("selected");if(t._isScrollingNecessary(T[i].$()[0],q("#"+f.sId)[0])){t._scrollToItem(T[i].$()[0],q("#"+f.sId)[0]);}}else{T[i].removeStyleClass("selected");}}}}};
S.prototype.getProceduresAndSteps=function(){return this._getStepThumbnails();};
S.prototype._getStepThumbnails=function(){var p=function(s,c,e){var t,i,f;try{t=sap.ui.vk.dvl.getPointer(c.Scene.RetrieveThumbnail(s,e.id));f=t.substring(0,3);if(f==="iVB"){i="png";}else{i="jpg";}e.thumbnailData=t;e.thumbnailType=i;}catch(g){if(g.code!==sap.ve.dvl.DVLRESULT.NOTFOUND){q.sap.log.error(g.message,g.code,"sap.ui.vk.StepNavigation");}e.thumbnailData=null;e.thumbnailType=null;}};var b=this._retrieveProcedures();if(b.sceneId!=null){b.procedures.forEach(function(c){c.steps.forEach(p.bind(this,b.sceneId,this.oDvl));},this);b.portfolios.forEach(function(c){c.steps.forEach(p.bind(this,b.sceneId,this.oDvl));},this);b.hasThumbnails=true;}this._procedures=b;return b;};
S.prototype._retrieveProcedures=function(b){var t=this;var p={};if(!t._procedures){p={sceneId:null,hasThumbnails:false,"procedures":[],"portfolios":[]};}else{p=t._procedures;}if(t._scene&&(p.sceneId!=(b||t._scene._dvlSceneRef))){var s=b||t._scene._dvlSceneRef;if(s!=null){p={sceneId:null,hasThumbnails:false,"procedures":[],"portfolios":[]};try{var c=sap.ui.vk.dvl.getJSONObject(t.oDvl.Scene.RetrieveProcedures(s));if(c!=null){p.hasThumbnails=false;p.sceneId=t._scene._dvlSceneRef;p.procedures=c.procedures;p.portfolios=c.portfolios;}}catch(e){if(!(e instanceof D&&e.code===sap.ve.dvl.DVLRESULT.NOTIMPLEMENTED)){throw e;}}}}return p;};
S.prototype.getStep=function(r,b,s){var t=this;var c=t.oDvl.Settings.LastLoadedSceneId;var e=null;if(c!=null){b=b!=null?b:0;var f=s?s:t.instanceSettings.currentStepId;var p=t._retrieveProcedures(c);var g=p.procedures[b];if(g&&g.steps.length>0){e=g.steps[0];}else{return null;}if(f!=""){for(var h=0;h<g.steps.length;h++){var _=g.steps[h];if(_.id==f){var x=h+r;if(x<g.steps.length&&x>=0){e=g.steps[x];}else{e=null;}break;}}}}return e;};
S.prototype.pauseStep=function(){var t=this;var s=t.oDvl.Settings.LastLoadedSceneId;if(s!=null){t.oDvl.Scene.PauseCurrentStep(s);}};
S.prototype._stepCount=function(b){var t=this;var s=t.oDvl.Settings.LastLoadedSceneId;var c=0;if(s!=null){var p=t._retrieveProcedures(s);for(var e=0;e<p.procedures.length;e++){if(p.procedures[e].id==b){c=p.procedures[e].steps.length;break;}else if(b==null){c+=p.procedures[e].steps.length;}}}return c;};
S.prototype.getPreviousStep=function(p){var t=this;return t.getStep(-1,p);};
S.prototype.getNextStep=function(p){var t=this;return t.getStep(1,p);};
S.prototype.playStep=function(b,f,c){var t=this;var s=t.oDvl.Settings.LastLoadedSceneId;if(s!=null){t.instanceSettings.currentStepId=b;t.oDvl.Scene.ActivateStep(s,b,f!=null?f:true,c!=null?c:false);}};
S.prototype.playAllSteps=function(p){var t=this;var b=t.oDvl.Settings.LastLoadedSceneId;if(b!=null){var c=t._retrieveProcedures(b);var e=0;if(p!=null&&c.procedures.length>1){for(var i=0;i<c.procedures.length;i++){if(c.procedures[i].id==p){e=i;break;}}}if(c.procedures.length>0){var s=c.procedures[e].steps[0];if(s){t.instanceSettings.currentStepId=s.id;t.oDvl.Scene.ActivateStep(b,s.id,true,true);}}}};
S.prototype._onAfterUpdateContentConnector=function(){this.setScene(this._contentConnector.getContent());};
S.prototype._onBeforeClearContentConnector=function(){this.setScene(null);};
S.prototype._handleContentReplaced=function(e){var c=e.getParameter("newContent");if(!(c instanceof sap.ui.vk.dvl.Scene)){c=null;}this.setScene(c);};
a.injectMethodsIntoClass(S);return S;});
sap.ui.predefine('sap/ui/vk/StepNavigationRenderer',["jquery.sap.global"],function(q){"use strict";var S={};
S.render=function(r,c){if(!c.getVisible()){return;}if(c.getShowToolbar()||c.getShowThumbnails){var w=c.getWidth()!=="auto"?c.getWidth():"100%";var h=c.getHeight()!=="auto"?c.getHeight():"auto";r.write("<div");r.addStyle("width",w);r.addStyle("height",h);r.writeControlData(c);r.addClass("sapVizKitStepNavigation");r.writeClasses();var t=c.getTooltip_AsString();if(t){r.writeAttributeEscaped("title",t);}if(!c.getVisible()){r.addStyle("visibility","hidden");}r.writeStyles();r.write(">");r.renderControl(c.getAggregation("layout"));if(c.getShowThumbnails()){S._renderScrollerDiv(r,c);}r.write("</div>");}};
S._renderScrollerDiv=function(r,c){r.renderControl(c.getAggregation("thumbnailsContainer"));};
return S;},true);
sap.ui.predefine('sap/ui/vk/Toolbar',["jquery.sap.global","./library","sap/ui/core/Control","sap/ui/model/json/JSONModel"],function(q,l,C,J){"use strict";
var T=C.extend("sap.ui.vk.Toolbar",{metadata:{library:"sap.ui.vk",properties:{title:{type:"string",group:"Appearance",defaultValue:""}},events:{},associations:{viewer:{type:"sap.ui.vk.Viewer",cardinality:"0..1"}},aggregations:{_toolbar:{type:"sap.m.Toolbar",multiple:false,visibility:"hidden"},_helpButton:{type:"sap.m.Button",multiple:false,visibility:"hidden"},_stepNavigationButton:{type:"sap.m.ToggleButton",multiple:false,visibility:"hidden"},_sceneTreeButton:{type:"sap.m.ToggleButton",multiple:false,visibility:"hidden"},_enterFullScreenButton:{type:"sap.m.ToggleButton",multiple:false,visibility:"hidden"},_exitFullScreenButton:{type:"sap.m.Button",multiple:false,visibility:"hidden"},_toolbarTitle:{type:"sap.m.Title",multiple:false,visibility:"hidden"}}}});
T.prototype._isUsingIOS=function(){return(sap.ui.Device.system.tablet||sap.ui.Device.system.phone)&&sap.ui.Device.os.ios;};
T.prototype._onSceneTree=function(){this.oViewer=sap.ui.getCore().byId(this.getViewer());if(this.oViewer!=null){this.oViewer._componentsState.sceneTree.userInteractionShow=this._sceneTreeButton.getPressed();this.oViewer.setShowSceneTree(this.oViewer._componentsState.sceneTree.userInteractionShow);}};
T.prototype._onStepNavigation=function(){this.oViewer=sap.ui.getCore().byId(this.getViewer());if(this.oViewer!=null){this.oViewer._componentsState.stepNavigation.userInteractionShow=this._stepNavigationButton.getPressed();this.oViewer.setShowStepNavigation(this.oViewer._componentsState.stepNavigation.userInteractionShow);}};
T.prototype._onFullScreen=function(){this.oViewer=sap.ui.getCore().byId(this.getViewer());if(this.oViewer!=null){var n=this._enterFullScreenButton.getPressed();this.oViewer.activateFullScreenMode(n);}};
T.prototype._fullScreenHandler=function(e){var f=e.mParameters.isFullScreen;this._enterFullScreenButton.setPressed(f);if(f){this._enterFullScreenButton.setIcon("sap-icon://exit-full-screen");}else{this._enterFullScreenButton.setIcon("sap-icon://full-screen");}};
T.prototype.init=function(){if(C.prototype.init){C.prototype.init.apply(this);}var _=new sap.m.ToolbarSpacer();var a=new sap.m.Button({icon:"sap-icon://sys-help",type:sap.m.ButtonType.Transparent,tooltip:sap.ui.vk.getResourceBundle().getText("VIEWER_HELPBUTTONTOOLTIP")});this.setAggregation("_helpButton",a);this._stepNavigationButton=new sap.m.ToggleButton({icon:"sap-icon://step",type:sap.m.ButtonType.Transparent,enabled:false,tooltip:sap.ui.vk.getResourceBundle().getText("STEP_NAV_MENUBUTTONTOOLTIP"),press:this._onStepNavigation.bind(this)});this.setAggregation("_stepNavigationButton",this._stepNavigationButton);this._sceneTreeButton=new sap.m.ToggleButton({icon:"sap-icon://tree",type:sap.m.ButtonType.Transparent,tooltip:sap.ui.vk.getResourceBundle().getText("SCENETREE_MENUBUTTONTOOLTIP"),press:this._onSceneTree.bind(this)});this.setAggregation("_sceneTreeButton",this._sceneTreeButton);var t;this._toolbarTitle=new sap.m.Title();if(!this._isUsingIOS()){this._enterFullScreenButton=new sap.m.ToggleButton({icon:"sap-icon://full-screen",type:sap.m.ButtonType.Transparent,tooltip:sap.ui.vk.getResourceBundle().getText("VIEWER_FULLSCREENBUTTONTOOLTIP"),press:this._onFullScreen.bind(this)});this.setAggregation("_enterFullScreenButton",this._enterFullScreenButton);var b=new sap.m.Button({icon:"sap-icon://exit-full-screen",type:sap.m.ButtonType.Transparent,tooltip:sap.ui.vk.getResourceBundle().getText("VIEWER_FULLSCREENBUTTONTOOLTIP")});this.setAggregation("_exitFullScreenButton",b);t=[this._toolbarTitle,_,new sap.m.ToolbarSeparator(),this._sceneTreeButton,new sap.m.ToolbarSeparator(),this._stepNavigationButton,new sap.m.ToolbarSeparator(),this._enterFullScreenButton];}else{t=[this._toolbarTitle,_,new sap.m.ToolbarSeparator(),this._sceneTreeButton,new sap.m.ToolbarSeparator(),this._stepNavigationButton];}this.setAggregation("_toolbarTitle",this._toolbarTitle);this._toolbar=new sap.m.Toolbar({design:sap.m.ToolbarDesign.Solid,content:t});this.setAggregation("_toolbar",this._toolbar,true);};
T.prototype.exit=function(){this.oViewer=sap.ui.getCore().byId(this.getViewer());if(this.oViewer){this.oViewer.detachFullScreen(this._fullScreenHandler.bind(this));}};
T.prototype.onBeforeRendering=function(){this._toolbar.setVisible(true);this._toolbarTitle.setText(this.getTitle());};
T.prototype.refresh=function(){this.oViewer=sap.ui.getCore().byId(this.getViewer());this._stepNavigationButton.setPressed(this.oViewer.getShowStepNavigation());this._stepNavigationButton.setEnabled(this.oViewer.getEnableStepNavigation());this._sceneTreeButton.setPressed(this.oViewer.getShowSceneTree());this._sceneTreeButton.setEnabled(this.oViewer.getEnableSceneTree());this.oViewer.attachFullScreen(this._fullScreenHandler.bind(this));return true;};
T.prototype.onAfterRendering=function(){this.refresh();};
return T;},true);
sap.ui.predefine('sap/ui/vk/ToolbarRenderer',["jquery.sap.global"],function(q){"use strict";var T={};
T.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapVizKitToolbar");r.writeClasses();r.write(">");r.renderControl(c.getAggregation("_toolbar"));r.write("</div>");};
return T;},true);
sap.ui.predefine('sap/ui/vk/TransformationMatrix',["jquery.sap.global","sap/ui/base/DataType"],function(q,D){"use strict";var T=D.createType("sap.ui.vk.TransformationMatrix",{isValid:function(v){return T.getBaseType().isValid(v)&&v.length===12;}},D.getType("float[]"));
T.parseValue=function(v){var c=T.getComponentType();return v.split(/\s*,\s*|\s+/).map(c.parseValue.bind(c));};
T.convertTo4x4=function(a){var m=a;return[m[0],m[1],m[2],0,m[3],m[4],m[5],0,m[6],m[7],m[8],0,m[9],m[10],m[11],1];};
T.convertTo4x3=function(a){var m=a;return[m[0],m[1],m[2],m[4],m[5],m[6],m[8],m[9],m[10],m[12],m[13],m[14]];};
q.sap.setObject("sap.ui.vk.TransformationMatrix",T);return T;});
sap.ui.predefine('sap/ui/vk/ViewStateManager',["jquery.sap.global","sap/ui/core/Element","./ContentConnector","./Scene","./ViewStateManagerBase","./Core"],function(q,E,C,S,V,a){"use strict";
var b=V.extend("sap.ui.vk.ViewStateManager",{metadata:{publicMethods:["enumerateSelection","getNodeHierarchy","getOpacity","getSelectionState","getTintColor","getVisibilityChanges","getVisibilityState","setOpacity","setSelectionState","setTintColor","setVisibilityState"]}});
var c=b.getMetadata().getParent().getClass().prototype;
b.prototype.init=function(){if(c.init){c.init.call(this);}this._implementation=null;};
b.prototype.exit=function(){this._destroyImplementation();if(c.exit){c.exit.call(this);}};
b.prototype._destroyImplementation=function(){if(this._implementation){this._implementation.destroy();this._implementation=null;}return this;};
b.prototype.getImplementation=function(){return this._implementation;};
b.prototype._onAfterUpdateContentConnector=function(){this._setScene(this._contentConnector.getContent());};
b.prototype._onBeforeClearContentConnector=function(){this._setScene(null);};
b.prototype._handleContentReplaced=function(e){this._setScene(e.getParameter("newContent"));};
b.prototype._setScene=function(s){if(s&&s instanceof S){var d=s.getMetadata().getName(),i=this._implementation&&this._implementation.getMetadata().getName(),r=d==="sap.ui.vk.dvl.Scene"&&i==="sap.ui.vk.dvl.ViewStateManager"||d==="sap.ui.vk.threejs.Scene"&&i==="sap.ui.vk.threejs.ViewStateManager";if(!r){this._destroyImplementation();var n;if(d==="sap.ui.vk.dvl.Scene"){n="sap.ui.vk.dvl.ViewStateManager";}else if(d==="sap.ui.vk.threejs.Scene"){n="sap.ui.vk.threejs.ViewStateManager";}if(n){var t=this;q.sap.require(n);this._implementation=new(q.sap.getObject(n))({shouldTrackVisibilityChanges:this.getShouldTrackVisibilityChanges(),contentConnector:this.getContentConnector(),visibilityChanged:function(e){t.fireVisibilityChanged({visible:e.getParameter("visible"),hidden:e.getParameter("hidden")});},selectionChanged:function(e){t.fireSelectionChanged({selected:e.getParameter("selected"),unselected:e.getParameter("unselected")});},opacityChanged:function(e){t.fireOpacityChanged({changed:e.getParameter("changed"),opacity:e.getParameter("opacity")});},tintColorChanged:function(e){t.fireTintColorChanged({changed:e.getParameter("changed"),tintColor:e.getParameter("tintColor"),tintColorABGR:e.getParameter("tintColorABGR")});},nodeHierarchyReplaced:function(e){t.fireNodeHierarchyReplaced({oldNodeHierarchy:e.getParameter("oldNodeHierarchy"),newNodeHierarchy:e.getParameter("newNodeHierarchy")});}});}}}else{this._destroyImplementation();}return this;};
b.prototype.getNodeHierarchy=function(){return this._implementation&&this._implementation.getNodeHierarchy();};
b.prototype.getVisibilityChanges=function(){return this._implementation&&this._implementation.getVisibilityChanges();};
b.prototype.getVisibilityComplete=function(){return this._implementation&&this._implementation.getVisibilityComplete();};
b.prototype.getVisibilityState=function(n){return this._implementation&&this._implementation.getVisibilityState(n);};
b.prototype.setVisibilityState=function(n,v,r){if(this._implementation){this._implementation.setVisibilityState(n,v,r);}return this;};
b.prototype.enumerateSelection=function(d){if(this._implementation){this._implementation.enumerateSelection(d);}return this;};
b.prototype.getSelectionState=function(n){return this._implementation&&this._implementation.getSelectionState(n);};
b.prototype.setSelectionState=function(n,s,r){if(this._implementation){this._implementation.setSelectionState(n,s,r);}return this;};
b.prototype.getOpacity=function(n){return this._implementation&&this._implementation.getOpacity(n);};
b.prototype.setOpacity=function(n,o,r){if(this._implementation){this._implementation.setOpacity(n,o,r);}return this;};
b.prototype.getTintColor=function(n,i){return this._implementation&&this._implementation.getTintColor(n,i);};
b.prototype.setTintColor=function(n,t,r){if(this._implementation){this._implementation.setTintColor(n,t,r);}return this;};
b.prototype.setHighlightColor=function(d){if(this._implementation&&this._implementation.setHighlightColor){this._implementation.setHighlightColor(d);}return this;};
b.prototype.getHighlightColor=function(i){if(this._implementation&&this._implementation.getHighlightColor){return this._implementation.getHighlightColor(i);}};
var f=b.getMetadata().getName();var m={init:function(){this._viewStateManager=null;sap.ui.vk.getCore().attachEvent(f+"-created",this._handleViewStateManagerCreated,this).attachEvent(f+"-destroying",this._handleViewStateManagerDestroying,this);},exit:function(){this.setViewStateManager(null);sap.ui.vk.getCore().detachEvent(f+"-destroying",this._handleViewStateManagerDestroying,this).detachEvent(f+"-created",this._handleViewStateManagerCreated,this);},setViewStateManager:function(v){this.setAssociation("viewStateManager",v,true);this._updateViewStateManager();return this;},_updateViewStateManager:function(){var n=this.getViewStateManager(),d=n&&sap.ui.getCore().byId(n)||null;if(this._viewStateManager!==d){this._clearViewStateManager();if(d){if(this._handleNodeHierarchyReplaced){d.attachNodeHierarchyReplaced(this._handleNodeHierarchyReplaced,this);}if(this._handleVisibilityChanged){d.attachVisibilityChanged(this._handleVisibilityChanged,this);}if(this._handleSelectionChanged){d.attachSelectionChanged(this._handleSelectionChanged,this);}if(this._handleOpacityChanged){d.attachOpacityChanged(this._handleOpacityChanged,this);}if(this._handleTintColorChanged){d.attachTintColorChanged(this._handleTintColorChanged,this);}this._viewStateManager=d;if(this._onAfterUpdateViewStateManager){this._onAfterUpdateViewStateManager();}}}return this;},_clearViewStateManager:function(){if(this._viewStateManager){if(this._onBeforeClearViewStateManager){this._onBeforeClearViewStateManager();}if(this._handleTintColorChanged){this._viewStateManager.detachTintColorChanged(this._handleTintColorChanged,this);}if(this._handleOpacityChanged){this._viewStateManager.detachOpacityChanged(this._handleOpacityChanged,this);}if(this._handleSelectionChanged){this._viewStateManager.detachSelectionChanged(this._handleSelectionChanged,this);}if(this._handleVisibilityChanged){this._viewStateManager.detachVisibilityChanged(this._handleVisibilityChanged,this);}if(this._handleNodeHierarchyReplaced){this._viewStateManager.detachNodeHierarchyReplaced(this._handleNodeHierarchyReplaced,this);}this._viewStateManager=null;}return this;},_handleViewStateManagerCreated:function(e){if(this.getViewStateManager()===e.getParameter("object").getId()){this._updateViewStateManager();}},_handleViewStateManagerDestroying:function(e){if(this.getViewStateManager()===e.getParameter("object").getId()){this._clearViewStateManager();}}};
b.injectMethodsIntoClass=function(d){var p=d.prototype,i=p.init,e=p.exit;p.init=function(){if(i){i.call(this);}m.init.call(this);};p.exit=function(){m.exit.call(this);if(e){e.call(this);}};p.setViewStateManager=m.setViewStateManager;p._updateViewStateManager=m._updateViewStateManager;p._clearViewStateManager=m._clearViewStateManager;p._handleViewStateManagerCreated=m._handleViewStateManagerCreated;p._handleViewStateManagerDestroying=m._handleViewStateManagerDestroying;};
sap.ui.vk.getCore().registerClass(b);C.injectMethodsIntoClass(b);return b;});
sap.ui.predefine('sap/ui/vk/ViewStateManagerBase',["jquery.sap.global","sap/ui/core/Element","./ContentConnector","./Scene"],function(q,E,C,S){"use strict";
var V=E.extend("sap.ui.vk.ViewStateManagerBase",{metadata:{"abstract":true,properties:{shouldTrackVisibilityChanges:{type:"boolean",defaultValue:false},canTrackVisibilityChanges:{type:"boolean",defaultValue:false}},associations:{contentConnector:{type:"sap.ui.vk.ContentConnector"}},events:{visibilityChanged:{parameters:{visible:{type:"any[]"},hidden:{type:"any[]"}},enableEventBubbling:true},selectionChanged:{parameters:{selected:{type:"any[]"},unselected:{type:"any[]"}},enableEventBubbling:true},opacityChanged:{parameters:{changed:{type:"any[]"},opacity:{type:"float"}},enableEventBubbling:true},tintColorChanged:{parameters:{changed:{type:"any[]"},tintColor:{type:"sap.ui.core.CSSColor"},tintColorABGR:{type:"int"}},enableEventBubbling:true},nodeHierarchyReplaced:{parameters:{oldNodeHierarchy:{type:"sap.ui.vk.NodeHierarchy"},newNodeHierarchy:{type:"sap.ui.vk.NodeHierarchy"}}},highlightColorChanged:{parameters:{highlightColor:{type:"sap.ui.core.CSSColor"},highlightColorABGR:{type:"int"}},enableEventBubbling:true}}}});
return V;});
sap.ui.predefine('sap/ui/vk/ViewerRenderer',["jquery.sap.global"],function(q){"use strict";var V={};
V.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapVizKitViewer");r.writeClasses();r.addStyle("width",c.getWidth());r.addStyle("height",c.getHeight());r.writeStyles();r.write(">");r.renderControl(c._layout);r.renderControl(c._progressIndicator);r.write("</div>");};
return V;},true);
sap.ui.predefine('sap/ui/vk/Viewport',["jquery.sap.global","./library","./ViewportBase","sap/ui/core/ResizeHandler","./Loco","./ViewportHandler","./Smart2DHandler","./Messages","./ContentConnector","./ViewStateManager"],function(q,l,V,R,L,a,S,M,C,b){"use strict";
var c=V.extend("sap.ui.vk.Viewport",{metadata:{library:"sap.ui.vk",publicMethods:[]}});
var d=c.getMetadata().getParent().getClass().prototype;
c.prototype.init=function(){if(d.init){d.init.call(this);}this._implementation=null;this._deferred={};};
c.prototype.exit=function(){this._deferred=null;this._destroyImplementation();if(d.exit){d.exit.call(this);}};
c.prototype.getImplementation=function(){return this._implementation;};
c.prototype._destroyImplementation=function(){if(this._implementation){this._implementation.destroy();this._implementation=null;}return this;};
c.prototype.getShowDebugInfo=function(){if(this._implementation){return this._implementation.getShowDebugInfo();}return d.getShowDebugInfo.call(this);};
c.prototype.setShowDebugInfo=function(v){d.setShowDebugInfo.call(this,v);if(this._implementation){this._implementation.setShowDebugInfo(v);}return this;};
c.prototype.getBackgroundColorTop=function(){if(this._implementation){return this._implementation.getBackgroundColorTop();}return d.getBackgroundColorTop.call(this);};
c.prototype.setBackgroundColorTop=function(v){d.setBackgroundColorTop.call(this,v);if(this._implementation){this._implementation.setBackgroundColorTop(v);}return this;};
c.prototype.getBackgroundColorBottom=function(){if(this._implementation){return this._implementation.getBackgroundColorBottom();}return d.getBackgroundColorBottom.call(this);};
c.prototype.setBackgroundColorBottom=function(v){d.setBackgroundColorBottom.call(this,v);if(this._implementation){this._implementation.setBackgroundColorBottom(v);}return this;};
c.prototype.setWidth=function(v){d.setWidth.call(this,v);if(this._implementation){this._implementation.setWidth(v);}return this;};
c.prototype.setHeight=function(v){d.setHeight.call(this,v);if(this._implementation){this._implementation.setHeight(v);}return this;};
c.prototype.setSelectionMode=function(v){d.setSelectionMode.call(this,v);if(this._implementation){this._implementation.setSelectionMode(v);}return this;};
c.prototype.getSelectionMode=function(){if(this._implementation){return this._implementation.getSelectionMode();}return d.getSelectionMode.call(this);};
c.prototype._onAfterUpdateContentConnector=function(){this._setScene(this._contentConnector.getContent());};
c.prototype._onBeforeClearContentConnector=function(){this._setScene(null);};
c.prototype._handleContentReplaced=function(e){var f=e.getParameter("newContent");if(!(f instanceof sap.ui.vk.Scene)){f=null;}this._setScene(f);};
c.prototype._setScene=function(s){if(s instanceof sap.ui.vk.Scene){var e=s.getMetadata().getName(),i=this._implementation&&this._implementation.getMetadata().getName(),r=e==="sap.ui.vk.dvl.Scene"&&i==="sap.ui.vk.dvl.Viewport"||e==="sap.ui.vk.threejs.Scene"&&i==="sap.ui.vk.threejs.Viewport";if(!r){this._destroyImplementation();var n;var t=this;if(e==="sap.ui.vk.dvl.Scene"){n="sap.ui.vk.dvl.Viewport";q.sap.require(n);this._implementation=new(q.sap.getObject(n))({viewStateManager:this.getViewStateManager(),resize:function(f){t.fireResize({size:f.getParameter("size")});},showDebugInfo:this.getShowDebugInfo(),width:this.getWidth(),height:this.getHeight(),backgroundColorTop:this.getBackgroundColorTop(),backgroundColorBottom:this.getBackgroundColorBottom(),selectionMode:this.getSelectionMode(),contentConnector:this.getContentConnector()});}else if(e==="sap.ui.vk.threejs.Scene"){n="sap.ui.vk.threejs.Viewport";q.sap.require(n);this._implementation=new(q.sap.getObject(n))({viewStateManager:this.getViewStateManager(),showDebugInfo:this.getShowDebugInfo(),width:this.getWidth(),height:this.getHeight(),backgroundColorTop:this.getBackgroundColorTop(),backgroundColorBottom:this.getBackgroundColorBottom(),selectionMode:this.getSelectionMode(),contentConnector:this.getContentConnector()});}if(n){if("graphicsCore"in this._deferred&&this._implementation.setGraphicsCore){this._implementation.setGraphicsCore(this._deferred.graphicsCore);}delete this._deferred.graphicsCore;if("scene"in this._deferred&&this._implementation.setScene){this._implementation.setScene(this._deferred.scene);}delete this._deferred.scene;this._implementation.attachNodesPicked(function(f){this.fireNodesPicked({picked:f.getParameter("picked")});},this);}this.invalidate();}}else{this._destroyImplementation();this.invalidate();}return this;};
c.prototype._onAfterUpdateViewStateManager=function(){if(this._implementation){this._implementation.setViewStateManager(this._viewStateManager);}};
c.prototype._onBeforeClearViewStateManager=function(){if(this._implementation){this._implementation.setViewStateManager(null);}};
C.injectMethodsIntoClass(c);b.injectMethodsIntoClass(c);return c;});
sap.ui.predefine('sap/ui/vk/ViewportBase',["jquery.sap.global","./library","sap/ui/core/Control","sap/ui/core/ResizeHandler","./Loco","./ViewportHandler","./Smart2DHandler","./Messages","./ContentConnector","./ViewStateManager"],function(q,l,C,R,L,V,S,M,a,b){"use strict";
var c=C.extend("sap.ui.vk.ViewportBase",{metadata:{library:"sap.ui.vk","abstract":true,properties:{showDebugInfo:{type:"boolean",defaultValue:false},backgroundColorTop:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(0, 0, 0, 1)"},backgroundColorBottom:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(255, 255, 255, 1)"},width:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},height:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},selectionMode:{type:"sap.ui.vk.SelectionMode",defaultValue:sap.ui.vk.SelectionMode.Sticky}},associations:{contentConnector:{type:"sap.ui.vk.ContentConnector",multiple:false},viewStateManager:{type:"sap.ui.vk.ViewStateManager",multiple:false}},events:{resize:{parameters:{size:"object"}},nodesPicked:{parameters:{picked:{type:"any[]"}},enableEventBubbling:true}}}});
c.prototype.stickySelectionHandler=function(n){if(this._viewStateManager==null){return;}if(n.length===0){var d=[];this._viewStateManager.enumerateSelection(function(g){d.push(g);});if(d.length>0){this._viewStateManager.setSelectionState(d,false,false);}}else{var s=[];var e=[];var i=this._viewStateManager.getSelectionState(n);for(var f=0;f<i.length;f++){if(i[f]){e.push(n[f]);}else{s.push(n[f]);}}this._viewStateManager.setSelectionState(s,true);this._viewStateManager.setSelectionState(e,false);}};
c.prototype.exclusiveSelectionHandler=function(n){if(this._viewStateManager==null){return;}var d=true;if(n.length===1){d=!this._viewStateManager.getSelectionState(n[0]);}else if(n.length>1){var i=this._viewStateManager.getSelectionState(n);for(var e=0;e<i.length;e++){if(i[e]){d=false;break;}}}if(this._viewStateManager&&(n.length===0||d)){var f=[];this._viewStateManager.enumerateSelection(function(s){f.push(s);});if(f.length>0){this._viewStateManager.setSelectionState(f,false,false);}}if(this._viewStateManager&&n.length){this._viewStateManager.setSelectionState(n,true);}};
return c;});
sap.ui.predefine('sap/ui/vk/ViewportHandler',["jquery.sap.global","sap/ui/base/EventProvider","sap/ui/core/ResizeHandler"],function(q,E,R){"use strict";
var V=E.extend("sap.ui.vk.ViewportHandler",{
metadata:{publicMethods:["beginGesture","move","endGesture","click","doubleClick","contextMenu","getViewport"]},
constructor:function(a){this._viewport=a;this._rect=null;this._evt={x:0,y:0,z:0,d:0,tdx:0,tdy:0,tdd:0,initd:0};this._gesture=false;this._viewport.attachEvent("resize",this,this._onresize);this._nomenu=false;}
});
V.prototype.destroy=function(){this._viewport=null;this._rect=null;this._evt=null;this._gesture=false;};
V.prototype._getOffset=function(o){var r=o.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};
V.prototype._inside=function(e){if(this._rect==null||true){var i=this._viewport.getIdForLabel();var d=document.getElementById(i);if(d==null){return false;}var o=this._getOffset(d);this._rect={x:o.x,y:o.y,w:d.offsetWidth,h:d.offsetHeight};}return(e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h);};
V.prototype._onresize=function(e){this._gesture=false;this._rect=null;};
V.prototype.beginGesture=function(a){if(this._inside(a)&&!this._gesture){this._gesture=true;var x=a.x-this._rect.x,y=a.y-this._rect.y;this._evt.tdx=0;this._evt.tdy=0;this._evt.tdd=0;this._evt.x=x;this._evt.y=y;this._evt.d=a.d;this._evt.initd=a.d;this._evt.avgd=a.d;this._evt.avgx=0;this._evt.avgy=0;q.sap.log.debug("Loco: beginGesture: "+x+", "+y);this._viewport.queueCommand(function(){this._viewport.beginGesture(x,y);}.bind(this));a.handled=true;if(document.activeElement){try{document.activeElement.blur();}catch(e){}}var d=document.getElementById(this._viewport.getIdForLabel());d.focus();}this._nomenu=false;};
V.prototype.move=function(e){if(this._gesture){var x=e.x-this._rect.x,y=e.y-this._rect.y;var d=x-this._evt.x;var a=y-this._evt.y;var b=e.d-this._evt.d;this._evt.tdx=this._evt.tdx+d;this._evt.tdy=this._evt.tdy+a;this._evt.tdd=this._evt.tdd+b;this._evt.x=x;this._evt.y=y;this._evt.d=e.d;this._evt.avgx=this._evt.avgx*0.99+d*0.01;this._evt.avgy=this._evt.avgy*0.99+a*0.01;var z=1.0;if(this._evt.initd>0){z=1.0+b*(1.0/this._evt.initd);}else if(e.n==2){if(e.points[0].y>e.points[1].y){z=1.0-b*0.005;if(z<0.333){z=0.333;}}else{z=1.0+b*0.005;if(z>3){z=3;}}}if(this._evt.initd>0){var c=Math.sqrt(this._evt.avgx*this._evt.avgx+this._evt.avgy*this._evt.avgy);q.sap.log.debug("AvgDist: "+c);if((Math.abs(e.d-this._evt.avgd)/this._evt.avgd)<(c/10)){z=1.0;}}this._evt.avgd=this._evt.avgd*0.97+e.d*0.03;this._evt.n=e.n;switch(e.n){case 1:q.sap.log.debug("Loco: Rotate: "+(d)+", "+(a));this._viewport.queueCommand(function(){this._viewport.rotate(d,a);}.bind(this));break;case 2:q.sap.log.debug("Loco: Pan: "+(d)+", "+(a));if(z!=0&&z!=1.0){q.sap.log.debug("Loco: Zoom: "+(z));}this._viewport.queueCommand(function(){if(this._evt.tdx!==0&&this._evt.tdy!==0){this._viewport.pan(d,a);}if((d<10&&a<10&&z!=0&&z!=1.0)&&this._evt.tdd!==0){this._viewport.zoom(z);}}.bind(this));break;default:break;}this._nomenu=true;e.handled=true;}};
V.prototype.endGesture=function(e){if(this._gesture){var x=e.x-this._rect.x,y=e.y-this._rect.y;q.sap.log.debug("Loco: endGesture: "+x+", "+y);this._viewport.queueCommand(function(){this._viewport.endGesture();}.bind(this));this._gesture=false;e.handled=true;}};
V.prototype.click=function(e){if(this._inside(e)&&e.buttons<=1){var x=e.x-this._rect.x,y=e.y-this._rect.y;q.sap.log.debug("Loco: click: "+(x)+", "+(y));this._viewport.queueCommand(function(){this._viewport.tap(x,y,false);}.bind(this));e.handled=true;}};
V.prototype.doubleClick=function(e){if(this._inside(e)&&e.buttons<=1){var x=e.x-this._rect.x,y=e.y-this._rect.y;q.sap.log.debug("Loco: doubleClick: "+(x)+", "+(y));this._viewport.queueCommand(function(){this._viewport.tap(x,y,true);}.bind(this));e.handled=true;}};
V.prototype.contextMenu=function(e){if(this._inside(e)||this._nomenu||e.buttons==5){this._nomenu=false;e.handled=true;}};
V.prototype.keyEventHandler=function(e){};
V.prototype.getViewport=function(){return this._viewport;};
return V;},true);
sap.ui.predefine('sap/ui/vk/ViewportRenderer',["jquery.sap.global"],function(q){"use strict";var V={};
V.render=function(r,c){if(c._implementation){r.renderControl(c._implementation);}else{r.write("<div");r.writeControlData(c);r.addClass("sapVizKitViewport");r.writeClasses();r.writeAttribute("tabindex",0);var a=false;var w=c.getWidth();if(w){r.addStyle("width",w);a=true;}var h=c.getHeight();if(h){r.addStyle("height",h);a=true;}if(a){r.writeStyles();}r.write(">");r.writeEscaped("NO CONTENT");r.write("</div>");}};
return V;},true);
sap.ui.predefine('sap/ui/vk/dvl/BaseNodeProxy',["jquery.sap.global","../library","../BaseNodeProxy"],function(q,l,B){"use strict";var g=sap.ui.vk.dvl.getJSONObject;
var a=B.extend("sap.ui.vk.dvl.BaseNodeProxy",{metadata:{publicMethods:["getHasChildren","getName","getSceneRef","getNodeRef","getNodeId","getNodeMetadata"]}});
a.prototype.init=function(n,b){this._dvl=n?n.getGraphicsCore()._getDvl():null;this._dvlSceneRef=n?n.getSceneRef():null;this._dvlNodeRef=b;};
a.prototype.reset=function(){this._dvlNodeRef=null;this._dvlSceneRef=null;this._dvl=null;};
a.prototype.getNodeRef=function(){return this._dvlNodeRef;};
a.prototype.getNodeId=function(){return this._dvlNodeRef;};
a.prototype.getName=function(){return g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,this._dvlNodeRef,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_NAME)).NodeName;};
a.prototype.getNodeMetadata=function(){return g(this._dvl.Scene.RetrieveMetadata(this._dvlSceneRef,this._dvlNodeRef)).metadata;};
a.prototype.getHasChildren=function(){return(g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,this._dvlNodeRef,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS)).Flags&(sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_MAPPED_HASCHILDREN|sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_CLOSED))===sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_MAPPED_HASCHILDREN;};
a.prototype.getSceneRef=function(){return this._dvlNodeRef;};
return a;});
sap.ui.predefine('sap/ui/vk/dvl/ContentManager',["jquery.sap.global","../DvlException","../Messages","../ContentManager"],function(q,D,M,C){"use strict";
var a=C.extend("sap.ui.vk.dvl.ContentManager",{metadata:{library:"sap.ui.vk",publicMethods:["collectGarbage","destroyContent","loadContent"]}});
var b=a.getMetadata().getParent().getClass().prototype;
a.prototype.init=function(){if(b.init){b.init.call(this);}this._handleDownloadingProgressProxy=this._handleDownloadingProgress.bind(this);this._graphicsCore=null;this._failedSources=[];};
a.prototype.exit=function(){if(this._graphicsCore){this._graphicsCore.destroy();this._graphicsCore=null;}if(b.exit){b.exit.call(this);}};
var r={},w={antialias:true,alpha:true,premultipliedAlpha:true},d=null;
a.getRuntimeSettings=function(){return r;};
a.setRuntimeSettings=function(s){r=s;};
a.getWebGLContextAttributes=function(){return w;};
a.setWebGLContextAttributes=function(c){w=q.extend(w,c);};
a.getDecryptionHandler=function(){return d;};
a.setDecryptionHandler=function(h){d=h;};
a.prototype._getGraphicsCore=function(){var t=this;return new Promise(function(c,e){if(t._graphicsCore){c(t._graphicsCore);}else{sap.ui.require(["sap/ui/vk/dvl/GraphicsCore"],function(G){t._graphicsCore=new G(r,w);t._graphicsCore.attachSceneLoadingStarted(t._handleDvlSceneLoadingStarted,t);t._graphicsCore.attachSceneLoadingFinished(t._handleDvlSceneLoadingFinished,t);t._graphicsCore.attachSceneLoadingProgress(t._handleDvlSceneLoadingProgress,t);c(t._graphicsCore);});}});};
a.prototype._handleDownloadingProgress=function(e){var s=e.getParameter("source"),l=e.getParameter("loaded"),t=e.getParameter("total"),v=t?l/t*50:0;this.fireContentChangesProgress({phase:"downloading",source:s,percentage:v});};
a.prototype._handleDvlSceneLoadingProgress=function(e){this.fireContentChangesProgress({phase:"building",source:e.getParameter("source"),percentage:50+e.getParameter("percentage")*50});};
a.prototype._handleDvlSceneLoadingStarted=function(e){};
a.prototype._handleDvlSceneLoadingFinished=function(e){};
a.prototype.loadContent=function(c,e){this.fireContentChangesStarted();var t=this;this._getGraphicsCore().then(function(g){g.setDecryptionHandler(d);g.loadContentResourcesAsync(e,function(s){var f=[];if(s){s.forEach(function(i){f.push({error:i,errorMessage:"Failed to download source '"+i.source+"'."});});}var l=c?c.scene:undefined;g.updateSceneTreeAsync(l,e).then(function(h){var i={content:h.scene};if(h.failureReason){f=f.concat(h.failureReason);}if(f.length>0){i.failureReason=f;}t.fireContentChangesFinished(i);}).catch(function(h){f.push(h);t.fireContentChangesFinished({content:null,failureReason:f});});},t._handleDownloadingProgressProxy);},function(f){t.fireContentChangesFinished({content:null,failureReason:{error:f,errorMessage:"Failed to create DVL graphics core object."}});});return this;};
a.prototype.destroyContent=function(c){this._graphicsCore.destroyScene(c);return this;};
a.prototype.collectGarbage=function(){this._graphicsCore.collectGarbage();return this;};
return a;});
sap.ui.predefine('sap/ui/vk/dvl/GraphicsCore',["jquery.sap.global","../library","sap/ui/base/EventProvider","../ve/thirdparty/html2canvas","../ve/dvl","./Scene","./NodeHierarchy","../ContentResource","../DownloadManager","./ViewStateManager","../DvlException","../Messages"],function(q,l,E,H,D,S,N,C,a,V,b,M){"use strict";var c=q.sap.log;
function g(e){return e instanceof File?"local":"remote";}
function d(e){return e instanceof File?e.name:e;}
var f=function(e){Object.defineProperties(this,{source:{value:e,writable:false,enumerable:true},_refCount:{value:0,writable:true,enumerable:false}});};
f.prototype.isInUse=function(){return this._refCount>0;};
f.prototype.addRef=function(){++this._refCount;return this;};
f.prototype.release=function(){--this._refCount;return this;};
f.prototype.destroy=function(){};
var h=function(e,v,i){f.call(this,e);Object.defineProperties(this,{content:{value:i,writable:false,enumerable:true},vdsSourceDatum:{value:v,writable:false,enumerable:true}});};h.prototype=Object.create(f.prototype);h.prototype.constructor=h;
h.prototype.destroy=function(){if(this.vdsSourceDatum){this.vdsSourceDatum.release();}f.prototype.destroy.call(this);};
var j=function(e,i,m){Object.defineProperties(this,{dvlSceneId:{value:e,writable:false,enumerable:true},sourceDatum:{value:i,writable:false,enumerable:true},root:{value:!!m,writable:false,enumerable:true},_refCount:{value:0,writable:true,enumerable:false}});};
j.prototype.isInUse=function(){return this._refCount>0;};
j.prototype.addRef=function(){++this._refCount;return this;};
j.prototype.release=function(){--this._refCount;return this;};
j.prototype.destroy=function(){if(this.sourceDatum){this.sourceDatum.release();}};
var k=function(e,i){Object.defineProperties(this,{source:{value:e.getSource()},sourceType:{value:e.getSourceType()},sourceId:{value:e.getSourceId(),writable:true},name:{value:e.getName()},localMatrix:{value:e.getLocalMatrix(),writable:true},password:{value:e.getPassword()},children:{value:e.getContentResources().map(function(e){return new k(e);})},dvlSceneDatum:{value:null,writable:true},nodeProxy:{value:null,writable:true},fake:{value:!!i},sourceProperties:{value:null,writable:true}});e._shadowContentResource=this;};
k.prototype.destroy=function(){if(this.dvlSceneDatum){this.dvlSceneDatum.release();}};
var n=function(v,e){Object.defineProperties(this,{vkScene:{value:v},shadowContentResource:{value:e}});};
var G=E.extend("sap.ui.vk.dvl.GraphicsCore",{
metadata:{publicMethods:["attachSceneLoadingFinished","attachSceneLoadingProgress","attachSceneLoadingStarted","buildSceneTree","buildSceneTreeAsync","createViewStateManager","destroyScene","destroyViewStateManager","detachSceneLoadingFinished","detachSceneLoadingProgress","detachSceneLoadingStarted","getApi","loadContentResourcesAsync","showDebugInfo","updateSceneTree","updateSceneTreeAsync"]},
constructor:function(e,w){E.apply(this);var i=q.extend({},e,{filePackagePrefixURL:q.sap.getResourcePath("sap/ve")+"/"});this._dvlClientId=q.sap.uid();this._dvl=sap.ve.dvl.createRuntime(i);this._dvl.CreateCoreInstance(this._dvlClientId);sap.ui.vk.dvl.checkResult(this._dvl.Core.Init(this._DVLMajorVersion,this._DVLMinorVersion));var u=sap.ui.getCore();u.attachLocalizationChanged(this._onlocalizationChanged,this);sap.ui.vk.dvl.checkResult(this._dvl.Core.SetLocale(u.getConfiguration().getLanguageTag()));this._canvas=this._createRenderingCanvasAndContext(w);this._rendererId=sap.ui.vk.dvl.getPointer(this._dvl.Core.CreateRenderer());this._dvl.Renderer.SetOptionF(sap.ve.dvl.DVLRENDEROPTIONF.DVLRENDEROPTIONF_DPI,96*window.devicePixelRatio,this._rendererId);this._sourceData=[];this._dvlSceneData=[];this._vkSceneData=[];this._viewports=[];this._renderLoopRequestId=null;this._renderLoopFunction=this._renderLoop.bind(this);this._viewStateManagers=[];},
_DVLMajorVersion:7,
_DVLMinorVersion:1
});
G.prototype.destroy=function(){sap.ui.getCore().detachLocalizationChanged(this._onlocalizationChanged,this);var v=this._viewports.slice();v.reverse();v.forEach(function(e){e.control.setGraphicsCore(null);});this._viewports=null;this._cleanupVkSceneData();this._vkSceneData=null;this._cleanupDvlSceneData();this._dvlSceneData=null;this._cleanupSourceData();this._sourceData=null;this._viewStateManagers.slice().forEach(this.destroyViewStateManager.bind(this));this._viewStateManagers=null;this._webGLContext=null;this._canvas=null;this._dvl.Core.DeleteRenderer(this._rendererId);this._rendererId=null;this._dvl.Core.Release();this._dvl=null;E.prototype.destroy.apply(this);};
G.prototype._createRenderingCanvasAndContext=function(w){var e=document.createElement("canvas");e.id=q.sap.uid();this._webGLContext=this._dvl.Core.CreateWebGLContext(e,w);return e;};
G.prototype._getCanvas=function(){return this._canvas;};
G.prototype._getWebGLContext=function(){return this._webGLContext;};
G.prototype._getDvl=function(){return this._dvl;};
G.prototype._getDvlClientId=function(){return this._dvlClientId;};
G.prototype._findSourceData=function(e){var i=Object.getOwnPropertyNames(e);return this._sourceData.filter(function(m){return i.every(function(t){return e[t]===m[t];});});};
G.prototype._destroySourceDatum=function(e){if(!(e instanceof h)){this._dvl.Core.DeleteFileByUrl(d(e.source),g(e.source));}e.destroy();return this;};
G.prototype._cleanupSourceData=function(){var e=false;for(var i=this._sourceData.length-1;i>=0;--i){var m=this._sourceData[i];if(!m.isInUse()){var t=m instanceof h?m.vdsSourceDatum:null;this._sourceData.splice(i,1);this._destroySourceDatum(m);if(t&&!t.isInUse()){e=true;}}}if(e){this._cleanupSourceData();}return this;};
G.prototype._findDvlSceneData=function(e){var i=Object.getOwnPropertyNames(e);return this._dvlSceneData.filter(function(m){return i.every(function(t){return e[t]===m[t];});});};
G.prototype._destroyDvlSceneDatum=function(e){this._dvl.Scene.Release(e.dvlSceneId);e.destroy();return this;};
G.prototype._cleanupDvlSceneData=function(){for(var i=this._dvlSceneData.length-1;i>=0;--i){var e=this._dvlSceneData[i];if(!e.isInUse()){this._dvlSceneData.splice(i,1);this._destroyDvlSceneDatum(e);}}};
G.prototype._findVkSceneData=function(e){var i=Object.getOwnPropertyNames(e);return this._vkSceneData.filter(function(m){return i.every(function(t){return e[t]===m[t];});});};
G.prototype._cleanupVkSceneData=function(){for(var i=this._vkSceneData.length-1;i>=0;--i){this.destroyScene(this._vkSceneData[i].vkScene);}};
G.prototype._destroyShadowContentResource=function(v,i){if(i.children){i.children.forEach(this._destroyShadowContentResource.bind(this,v));}if(i.nodeProxy){try{sap.ui.vk.dvl.checkResult(this._dvl.Scene.DeleteNode(v.getSceneRef(),i.nodeProxy.getNodeRef()));}catch(e){var m="Failed to delete node with ID = "+i.nodeProxy.getNodeRef()+".";if(e instanceof b){m+=" Error code: "+e.code+". Message: "+e.message+".";}c.error(m);}v.getDefaultNodeHierarchy().destroyNodeProxy(i.nodeProxy);}i.destroy();};
G.prototype._filterContentResources=function(e,i){var m=[];e.forEach(function enumerate(t){if(i(t)){m.push(t);}t.getContentResources().forEach(enumerate);});return m;};
G.prototype._getContentResourcesWithMissingPasswords=function(i){var l=this._dvl.Library;return this._filterContentResources(i,function(m){var t=m.getSource();try{return t&&(sap.ui.vk.dvl.getJSONObject(l.RetrieveInfo(d(t),g(t))).flags&sap.ve.dvl.DVLFILEFLAG.ENCRYPTED)&&!m.getPassword();}catch(e){c.warning("Failed to get information from Emscripten virtual file system about file '"+d(t)+"'");return false;}});};
G.prototype._getContentResourcesWithEncryptedVds3=function(i){var l=this._dvl.Library;return this._filterContentResources(i,function(m){var t=m.getSource();if(t){try{var u=sap.ui.vk.dvl.getJSONObject(l.RetrieveInfo(d(t),g(t)));return u.major<=3&&(u.flags&sap.ve.dvl.DVLFILEFLAG.ENCRYPTED);}catch(e){c.warning("Failed to get information from Emscripten virtual file system about file '"+d(t)+"'");return false;}}else{return false;}});};
G.prototype._collectAndCheckSourceProperties=function(i){var m=i.dvlSceneDatum.sourceDatum;if(!m){return this;}try{if(m instanceof h){m=m.vdsSourceDatum;}var t=sap.ui.vk.dvl.getJSONObject(this._dvl.Library.RetrieveInfo(d(m.source),g(m.source)));i.sourceProperties={version:{major:t.major,minor:t.minor}};if(t.flags&(sap.ve.dvl.DVLFILEFLAG.PAGESCOMPRESSED|sap.ve.dvl.DVLFILEFLAG.WHOLEFILECOMPRESSED)){i.sourceProperties.compressed=true;}if(t.flags&sap.ve.dvl.DVLFILEFLAG.ENCRYPTED){i.sourceProperties.encrypted=true;}}catch(e){c.warning("Failed to get information from Emscripten virtual file system about file '"+d(i.source)+"'");}return this;};
G.prototype.loadContentResourcesAsync=function(e,i,t){var u=this,v=[],w=new Map();e.forEach(function enumerate(m){var A=m.getSource();if(A&&v.indexOf(A)<0&&u._findSourceData({source:A}).length===0){v.push(A);if(m.getSourceType()==="vdsl"){w.set(A,{});}}m.getContentResources().forEach(enumerate);});var x=[];if(v.length>0){var y;var z=new a(v).attachItemSucceeded(function(A){var B=A.getParameter("source");var F=A.getParameter("response");if(w.has(B)){var I=sap.ui.vk.utf8ArrayBufferToString(F);if(I.trim().length===0){y=y||[];y.push({source:B,status:M.VIT22.code,statusText:sap.ui.vk.getResourceBundle().getText(M.VIT22.summary)});c.error(sap.ui.vk.getResourceBundle().getText(M.VIT22.summary),M.VIT22.code,"sap.ui.vk.dvl.GraphicsCore");return;}else{var J=I.split(/\n|\r\n/);var m=J[0].match(/^file=(.+)$/);if(!m){y=y||[];y.push({source:B,status:M.VIT23.code,statusText:sap.ui.vk.getResourceBundle().getText(M.VIT23.summary)});c.error(sap.ui.vk.getResourceBundle().getText(M.VIT23.summary),M.VIT23.code,"sap.ui.vk.dvl.GraphicsCore");return;}else{var K=w.get(B);K.content=J;var L=m[1];var O=L;var P=new URI(O);if(P.is("relative")){if(B instanceof File){y=y||[];y.push({source:B,status:M.VIT24.code,statusText:sap.ui.vk.getResourceBundle().getText(M.VIT24.summary)});c.error(sap.ui.vk.getResourceBundle().getText(M.VIT24.summary),M.VIT24.code,"sap.ui.vk.dvl.GraphicsCore");return;}else{var Q=new URI(B);L=P.absoluteTo(Q).href();}}K.referencedSource=L;K.content[0]=K.content[0].replace(O,this._dvl.Core.GetFilename(K.referencedSource,"remote"));if(v.indexOf(K.referencedSource)<0&&this._findSourceData({source:K.referencedSource}).length===0){v.push(K.referencedSource);z.queue(K.referencedSource);}}}}else{var R=B instanceof File;var T=R?B.name:B;var U=g(B);this._dvl.Core.CreateFileFromArrayBuffer(F,T,U);x.push(new f(B));}},this).attachAllItemsCompleted(function(m){Array.prototype.push.apply(this._sourceData,x);w.forEach(function(A,B){var F=this._findSourceData({source:A.referencedSource})[0];var I=new h(B,F,A.content.join("\n"));this._sourceData.push(I);F.addRef();}.bind(this));if(i){i(y);}},this).attachItemFailed(function(m){y=y||[];y.push({source:m.getParameter("source"),status:m.getParameter("status"),statusText:m.getParameter("statusText")});},this);if(t){z.attachItemProgress(t,this);}z.start();}else if(i){i();}return this;};
G.prototype._buildPlaceholders=function(e,i,m,t){var u=[];t.forEach(function build(i,m,v){var w=this._dvl.Scene.CreateNode(e.getSceneRef(),i,v.name,m);v.nodeProxy=e.createNodeProxy(w);if(v.localMatrix){v.nodeProxy.setLocalMatrix(v.localMatrix);}if(v.source){u.push(v);}v.children.forEach(build.bind(this,w,null));}.bind(this,i,m));return u;};
G.prototype._updatePlaceholders=function(v,e,m){var t=this,u=v.getDefaultNodeHierarchy(),w=[];(function update(x,m,y){function z(F,I){if(!F&&!I){return true;}else if(!!F^!!I){return false;}else{return F.source===I.getSource()&&F.sourceType===I.getSourceType()&&F.name===I.getName()&&F.password===I.getPassword();}}function A(F,I){I._shadowContentResource=F;F.sourceId=I.getSourceId();F.localMatrix=I.getLocalMatrix();if(F.nodeProxy){F.nodeProxy.setLocalMatrix(F.localMatrix);}}var i=0;var B=q.sap.arrayDiff(x,m,z,true);B.forEach(function(F){for(;i<F.index;++i){update(x[i].children,m[i].getContentResources(),x[i].nodeProxy.getNodeRef());A(x[i],m[i]);}if(F.type==="delete"){t._destroyShadowContentResource(v,x[F.index]);x.splice(F.index,1);}else if(F.type==="insert"){var I;if(i<x.length&&x[i].nodeProxy){I=x[i].nodeProxy.getNodeRef();}var J=new k(m[F.index]);w=w.concat(t._buildPlaceholders(u,y,I,[J]));x.splice(F.index,0,J);++i;}});for(;i<x.length;++i){update(x[i].children,m[i].getContentResources(),x[i].nodeProxy&&x[i].nodeProxy.getNodeRef());A(x[i],m[i]);}})(e.fake?e.children:[e],m,null);return w;};
G.prototype._loadAndMergeContentResource=function(i,m){if(m.source){var t=this._findSourceData({source:m.source})[0];if(!t){c.warning("Failed to load content resource with sourceId '"+m.sourceId+"' due to failed downloading from URL '"+d(m.source)+"'.");}else{var u=m.nodeProxy.getNodeRef();var v=this._findDvlSceneData({sourceDatum:t,root:false})[0];if(!v){try{v=new j(sap.ui.vk.dvl.getPointer(t instanceof h?this._dvl.Core.LoadSceneFromVDSL(t.content,m.password):this._dvl.Core.LoadSceneByUrl(d(m.source),m.password,g(m.source))),t,false);}catch(e){c.error(sap.ui.vk.getResourceBundle().getText(M.VIT34.summary)+": "+d(m.source),M.VIT34.code,"sap.ui.vk.dvl.GraphicsCore");return;}this._dvlSceneData.push(v);t.addRef();}m.dvlSceneDatum=v;v.addRef();this._collectAndCheckSourceProperties(m);var w=i.getSceneRef(),x=i.getChildren(u)[0];this._dvl.Scene.RetrieveSceneInfo(v.dvlSceneId,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_CHILDREN).ChildNodes.forEach(function(y){this._dvl.Scene.CreateNodeCopy(w,y,u,sap.ve.dvl.DVLCREATENODECOPYFLAG.COPY_CHILDREN,null,x);}.bind(this));}}};
G.prototype.buildSceneTree=function(i){if(i.length===0){return null;}var m;var t;var u=i.map(function(y){return new k(y);});if(u.length===1){t=u[0];if(t.source){var v=this._findSourceData({source:t.source})[0];try{m=new j(sap.ui.vk.dvl.getPointer(v instanceof h?this._dvl.Core.LoadSceneFromVDSL(v.content,t.password):this._dvl.Core.LoadSceneByUrl(d(t.source),t.password,g(t.source))),v,true);}catch(e){c.error(sap.ui.vk.getResourceBundle().getText(M.VIT34.summary)+": "+d(t.source),M.VIT34.code,"sap.ui.vk.dvl.GraphicsCore");return null;}v.addRef();}else{m=new j(this._dvl.Core.CreateEmptyScene(),null,true);}}else{var w=new C({sourceType:"vds",sourceId:q.sap.uid()});t=new k(w,true);w.destroy();w=null;Array.prototype.push.apply(t.children,u);u=[t];m=new j(this._dvl.Core.CreateEmptyScene(),null,true);}this._dvlSceneData.push(m);t.dvlSceneDatum=m;m.addRef();this._collectAndCheckSourceProperties(t);var x=new S(this,m.dvlSceneId);this._vkSceneData.push(new n(x,t));this._buildPlaceholders(x.getDefaultNodeHierarchy(),null,null,t.children).forEach(this._loadAndMergeContentResource.bind(this,x.getDefaultNodeHierarchy()));return x;};
G.prototype.updateSceneTree=function(v,e,i){if(e.length===0){return null;}var m;var t=this._getContentResourcesWithEncryptedVds3(e);if(t.length>0){c.error(sap.ui.vk.getResourceBundle().getText(M.VIT25.summary),M.VIT25.code,"sap.ui.vk.dvl.GraphicsCore");m=m||{};m.contentResourcesWithEncryptedVds3=t;}var u=this._getContentResourcesWithMissingPasswords(e);if(u.length>0){c.error(sap.ui.vk.getResourceBundle().getText(M.VIT21.summary),M.VIT21.code,"sap.ui.vk.dvl.GraphicsCore");m=m||{};m.contentResourcesWithMissingPasswords=u;}if(m&&i){i(m);}if(!v){return this.buildSceneTree(e);}var w=this._findVkSceneData({vkScene:v})[0].shadowContentResource;var x=!!w.source;var y=e.length===1&&!!e[0].getSource();if(!(x&&y&&w.source===e[0].getSource()||!x&&!y&&w.fake===e.length>1)){return this.buildSceneTree(e);}this._updatePlaceholders(v,w,e).forEach(this._loadAndMergeContentResource.bind(this,v.getDefaultNodeHierarchy()));v.getDefaultNodeHierarchy().fireChanged();return v;};
G.prototype._loadDvlSceneAsync=function(i,m){return new Promise(function(t,u){var v;var w=function(z){v();this.fireSceneLoadingFinished({source:i.source,sceneId:z.sceneId});t(z.sceneId);};var x=function(z){v();var A=sap.ve.dvl.DVLRESULT.getDescription?sap.ve.dvl.DVLRESULT.getDescription(z.errorCode):"";var B={source:i.source,errorCode:z.errorCode,errorMessage:A};this.fireSceneLoadingFinished(B);u(B);};var y=function(z,A){this.fireSceneLoadingProgress({source:d(i.source),percentage:A});return true;}.bind(this);v=function(){this._dvl.Client.NotifyFileLoadProgress=null;this._dvl.Client.detachSceneFailed(x,this);this._dvl.Client.detachSceneLoaded(w,this);}.bind(this);this._dvl.Client.attachSceneLoaded(w,this);this._dvl.Client.attachSceneFailed(x,this);this._dvl.Client.NotifyFileLoadProgress=y;this.fireSceneLoadingStarted({source:d(i.source)});try{sap.ui.vk.dvl.checkResult(i instanceof h?this._dvl.Core.LoadSceneFromVDSLAsync(i.content,m):this._dvl.Core.LoadSceneByUrlAsync(d(i.source),m,g(i.source)));}catch(e){v();x.call(this,{errorCode:e instanceof b?e.code:sap.ve.dvl.DVLRESULT.FAIL});}}.bind(this));};
var o=function(e,i){return new Promise(function(m){(function step(t){if(t>=e.length){m();}else{i(e[t]).catch(function(){}).then(function(){step(t+1);});}})(0);});};
G.prototype._loadAndMergeContentResourcesAsync=function(e,i){var m,t=this;return o(i,function(u){if(u.source){var v=t._findSourceData({source:u.source})[0];if(!v){var w="Failed to load content resource with sourceId '"+u.sourceId+"' due to failed downloading from URL '"+d(u.source)+"'.";c.warning(w);m=m||[];m.push({errorMessage:w,source:u.source});return Promise.reject();}return(function(){var x=t._findDvlSceneData({sourceDatum:v,root:false})[0];if(x){return Promise.resolve(x);}else{return t._loadDvlSceneAsync(v,u.password).then(function(y){x=new j(y,v,false);t._dvlSceneData.push(x);v.addRef();return Promise.resolve(x);},function(y){m=m||[];m.push(y);return Promise.reject();});}})().then(function(x){u.dvlSceneDatum=x;x.addRef();t._collectAndCheckSourceProperties(u);var y=u.nodeProxy.getNodeRef(),z=e.getSceneRef(),A=e.getChildren(y)[0];t._dvl.Scene.RetrieveSceneInfo(x.dvlSceneId,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_CHILDREN).ChildNodes.forEach(function(B){t._dvl.Scene.CreateNodeCopy(z,B,y,sap.ve.dvl.DVLCREATENODECOPYFLAG.COPY_CHILDREN,null,A);});return Promise.resolve();});}return Promise.resolve();}).then(function(){return Promise.resolve(m);});};
G.prototype.buildSceneTreeAsync=function(e){if(e.length===0){return Promise.resolve(null);}var i=e.map(function(m){return new k(m);});return function(){var m;if(i.length===1){m=i[0];if(m.source){var t=this._findSourceData({source:m.source})[0];if(t){return this._loadDvlSceneAsync(t,m.password).then(function(v){var w=new j(v,t,true);t.addRef();return Promise.resolve({shadowContentResource:m,dvlSceneDatum:w});});}else{return Promise.reject({errorMessage:"Failed to download the root content resource.",source:m.source});}}return Promise.resolve({shadowContentResource:m,dvlSceneDatum:new j(this._dvl.Core.CreateEmptyScene(),null,true)});}else{var u=new C({sourceType:"vds",sourceId:q.sap.uid()});m=new k(u,true);u.destroy();u=null;Array.prototype.push.apply(m.children,i);i=[m];return Promise.resolve({shadowContentResource:m,dvlSceneDatum:new j(this._dvl.Core.CreateEmptyScene(),null,true)});}}.call(this).then(function(m){this._dvlSceneData.push(m.dvlSceneDatum);m.shadowContentResource.dvlSceneDatum=m.dvlSceneDatum;m.dvlSceneDatum.addRef();this._collectAndCheckSourceProperties(m.shadowContentResource);var v=new S(this,m.dvlSceneDatum.dvlSceneId);this._vkSceneData.push(new n(v,m.shadowContentResource));var t=v.getDefaultNodeHierarchy();return this._loadAndMergeContentResourcesAsync(t,this._buildPlaceholders(v.getDefaultNodeHierarchy(),null,null,m.shadowContentResource.children)).then(function(u){return Promise.resolve({scene:v,failureReason:u});});}.bind(this));};
G.prototype.updateSceneTreeAsync=function(v,e){if(e.length===0){return Promise.resolve(null);}var i=this._getContentResourcesWithEncryptedVds3(e);if(i.length>0){c.error(sap.ui.vk.getResourceBundle().getText(M.VIT25.summary),M.VIT25.code,"sap.ui.vk.dvl.GraphicsCore");}var m=this._getContentResourcesWithMissingPasswords(e);if(m.length>0){c.error(sap.ui.vk.getResourceBundle().getText(M.VIT21.summary),M.VIT21.code,"sap.ui.vk.dvl.GraphicsCore");}if(!v){return this.buildSceneTreeAsync(e);}var t=this._findVkSceneData({vkScene:v})[0].shadowContentResource;var u=!!t.source;var w=e.length===1&&!!e[0].getSource();if(!(u&&w&&t.source===e[0].getSource()||!u&&!w&&t.fake===e.length>1)){return this.buildSceneTreeAsync(e);}return new Promise(function(x,y){var z=v.getDefaultNodeHierarchy();this._loadAndMergeContentResourcesAsync(z,this._updatePlaceholders(v,t,e)).then(function(A){x({scene:v,failureReason:A});z.fireChanged();});}.bind(this));};
G.prototype.destroyScene=function(v){var e;for(e=0;e<this._vkSceneData.length;++e){if(this._vkSceneData[e].vkScene===v){break;}}if(e===this._vkSceneData.length){c.warning("Scene with id '"+v.getId()+"' is not created by this GraphicsCore.");return this;}var i=this._vkSceneData.splice(e,1)[0];this._destroyShadowContentResource(v,i.shadowContentResource);v.destroy();return this;};
var p=function(e,m,t){for(var i=0,u=e.length;i<u;++i){if(m.call(t,e[i],i,e)){return i;}}return-1;};var r=function(v,e){return p(v,function(i){return i.control===e;});};var s=function(v,e){return p(v,function(i){return i.rendererId===e;});};
G.prototype._registerViewport=function(v){if(r(this._viewports,v)>=0){return false;}var e={control:v,canvas:null,rendererId:null};if(this._viewports.length===0){e.canvas=this._canvas;e.rendererId=this._rendererId;this._startRenderLoop();}else{if(this._viewports.length===1){var i=this._viewports[0];i.control._setCanvas(i.canvas=document.createElement("canvas"));this._dvl.Client.attachFrameFinished(this._handleFrameFinished,this);}e.canvas=document.createElement("canvas");e.rendererId=this._dvl.Core.CreateRenderer();}v._setCanvas(e.canvas);v._setRenderer(e.rendererId);v.attachResize(this._handleViewportResize,this);this._viewports.push(e);return true;};
G.prototype._deregisterViewport=function(v){var i=r(this._viewports,v);if(i<0){return false;}var e=this._viewports.splice(i,1)[0];if(this._viewports.length===0){this._stopRenderLoop();}else{if(this._viewports.length===1){this._dvl.Client.detachFrameFinished(this._handleFrameFinished,this);var m=this._viewports[1-i];m.control._setCanvas(m.canvas=this._canvas);}this._dvl.Core.DeleteRenderer(e.rendererId);}v.detachResize(this._handleViewportResize,this);v._setRenderer(null);v._setCanvas(null);return true;};
G.prototype._getViewportCount=function(){return this._viewports.length;};
G.prototype._handleViewportResize=function(e){if(this._viewports.length>1){this._canvas.width=Math.max.apply(null,this._viewports.map(function(v){return v.canvas.width;}));this._canvas.height=Math.max.apply(null,this._viewports.map(function(v){return v.canvas.height;}));}};
G.prototype._startRenderLoop=function(){if(!this._renderLoopRequestId){this._renderLoopRequestId=window.requestAnimationFrame(this._renderLoopFunction);}return this;};
G.prototype._stopRenderLoop=function(){if(this._renderLoopRequestId){window.cancelAnimationFrame(this._renderLoopRequestId);this._renderLoopRequestId=null;}return this;};
G.prototype._renderLoop=(function(){var e;return function(){var m=this._viewports.length>1;this._viewports.forEach(function(v){var i=v.canvas,t=v.rendererId;this._dvl.Renderer._processCommandQueue(t);if(i.width>0&&i.height>0&&this._dvl.Renderer.ShouldRenderFrame(t)){if(m&&e!==t){this._dvl.Renderer.SetDimensions(i.width,i.height,t);}this._dvl.Renderer.RenderFrame(t);e=t;}},this);this._renderLoopRequestId=window.requestAnimationFrame(this._renderLoopFunction);};})();
G.prototype._handleFrameFinished=function(e){if(this._viewports.length>1){var i=s(this._viewports,e.rendererId);if(i>=0){var t=this._viewports[i].canvas,m=t.getContext("2d"),u=t.width,v=t.height;m.drawImage(this._canvas,0,this._canvas.height-v,u,v,0,0,u,v);}}};
G.prototype.createViewStateManager=function(e,i,m){var v=new sap.ui.vk.dvl.ViewStateManager();v._setNodeHierarchy(e).setShouldTrackVisibilityChanges(i).setCanTrackVisibilityChanges(m);this._viewStateManagers.push(v);return v;};
G.prototype.destroyViewStateManager=function(v){var i=this._viewStateManagers.indexOf(v);if(i>=0){this._viewStateManagers.splice(i,1)[0].destroy();}return this;};
G.prototype.showDebugInfo=function(e){this._viewports.forEach(function(v){v.control.setShowDebugInfo(e);});return this;};
G.prototype.getApi=function(e){switch(e){case sap.ui.vk.dvl.GraphicsCoreApi.LegacyDvl:return this._dvl;default:return null;}};
G.prototype.collectGarbage=function(){this._cleanupDvlSceneData();this._cleanupSourceData();return this;};
G.prototype._onlocalizationChanged=function(e){if(e.getParameter("changes").language){sap.ui.vk.dvl.checkResult(this._dvl.Core.SetLocale(sap.ui.getCore().getConfiguration().getLanguageTag()));}};
G.prototype.setDecryptionHandler=function(e){this._dvl.Client.setDecryptionHandler(e);return this;};
G.prototype.getDecryptionHandler=function(){return this._dvl.Client.getDecryptionHandler();};
G.prototype.attachSceneLoadingFinished=function(e,i,m){return this.attachEvent("sceneLoadingFinished",e,i,m);};
G.prototype.detachSceneLoadingFinished=function(e,i){return this.detachEvent("sceneLoadingFinished",e,i);};
G.prototype.fireSceneLoadingFinished=function(e,i,m){return this.fireEvent("sceneLoadingFinished",e,i,m);};
G.prototype.attachSceneLoadingProgress=function(e,i,m){return this.attachEvent("sceneLoadingProgress",e,i,m);};
G.prototype.detachSceneLoadingProgress=function(e,i){return this.detachEvent("sceneLoadingProgress",e,i);};
G.prototype.fireSceneLoadingProgress=function(e,i,m){return this.fireEvent("sceneLoadingProgress",e,i,m);};
G.prototype.attachSceneLoadingStarted=function(e,i,m){return this.attachEvent("sceneLoadingStarted",e,i,m);};
G.prototype.detachSceneLoadingStarted=function(e,i){return this.detachEvent("sceneLoadingStarted",e,i);};
G.prototype.fireSceneLoadingStarted=function(e,i,m){return this.fireEvent("sceneLoadingStarted",e,i,m);};
return G;});
sap.ui.predefine('sap/ui/vk/dvl/LayerProxy',["jquery.sap.global","../library","../LayerProxy"],function(q,l,L){"use strict";var g=sap.ui.vk.dvl.getJSONObject;
var a=L.extend("sap.ui.vk.dvl.LayerProxy",{
metadata:{publicMethods:["getDescription","getLayerId","getLayerMetadata","getName","getNodes","getVeIds"]},
constructor:function(n,b){L.call(this);this._dvl=n?n.getGraphicsCore()._getDvl():null;this._dvlSceneRef=n?n.getSceneRef():null;this._dvlLayerId=b;}
});
a.prototype.destroy=function(){this._dvlLayerId=null;this._dvlSceneRef=null;this._dvl=null;L.prototype.destroy.call(this);};
a.prototype.getLayerId=function(){return this._dvlLayerId;};
a.prototype.getVeIds=function(){return g(this._dvl.Scene.RetrieveVEIDs(this._dvlSceneRef,this._dvlLayerId));};
a.prototype.getName=function(){return g(this._dvl.Scene.RetrieveLayerInfo(this._dvlSceneRef,this._dvlLayerId)).name;};
a.prototype.getDescription=function(){return g(this._dvl.Scene.RetrieveLayerInfo(this._dvlSceneRef,this._dvlLayerId)).description;};
a.prototype.getLayerMetadata=function(){return g(this._dvl.Scene.RetrieveMetadata(this._dvlSceneRef,this._dvlLayerId)).metadata;};
a.prototype.getNodes=function(){return g(this._dvl.Scene.RetrieveLayerInfo(this._dvlSceneRef,this._dvlLayerId)).nodes;};
return a;});
sap.ui.predefine('sap/ui/vk/dvl/NodeHierarchy',["jquery.sap.global","../library","../NodeHierarchy","sap/ui/base/ObjectPool","./BaseNodeProxy","./NodeProxy","./LayerProxy","../Messages"],function(q,l,N,O,B,a,L,M){"use strict";var g=sap.ui.vk.dvl.getJSONObject;var s={modeDictionary:{equals:function(i){return i?sap.ve.dvl.DVLFINDNODEMODE.DVLFINDNODEMODE_EQUAL:sap.ve.dvl.DVLFINDNODEMODE.DVLFINDNODEMODE_EQUAL_CASE_INSENSITIVE;},contains:function(i){return i?sap.ve.dvl.DVLFINDNODEMODE.DVLFINDNODEMODE_SUBSTRING:sap.ve.dvl.DVLFINDNODEMODE.DVLFINDNODEMODE_SUBSTRING_CASE_INSENSITIVE;},startsWith:function(i){return i?sap.ve.dvl.DVLFINDNODEMODE.DVLFINDNODEMODE_STARTS_WITH:sap.ve.dvl.DVLFINDNODEMODE.DVLFINDNODEMODE_STARTS_WITH_CASE_INSENSITIVE;}}};
var b=N.extend("sap.ui.vk.dvl.NodeHierarchy",{
metadata:{publicMethods:["createLayerProxy","createNode","createNodeCopy","createNodeProxy","destroyLayerProxy","destroyNodeProxy","enumerateAncestors","enumerateChildren","findNodesById","findNodesByMetadata","findNodesByName","getAncestors","getChildren","getGraphicsCore","getLayers","getSceneRef","getScene","removeNode"]},
_baseNodeProxyPool:new O(B),
constructor:function(c){N.call(this);this._graphicsCore=c.getGraphicsCore();this._scene=c;this._dvlSceneRef=this._scene.getSceneRef();this._dvl=this._graphicsCore._getDvl();this._nodeProxies=[];this._layerProxies=[];}
});
b.prototype.destroy=function(){this._layerProxies.slice().forEach(this.destroyLayerProxy,this);this._nodeProxies.slice().forEach(this.destroyNodeProxy,this);this._dvl=null;this._dvlSceneRef=null;this._scene=null;this._graphicsCore=null;N.prototype.destroy.call(this);};
b.prototype.getGraphicsCore=function(){return this._graphicsCore;};
b.prototype.getScene=function(){return this._scene;};
b.prototype.getSceneRef=function(){return this._dvlSceneRef;};
b.prototype.enumerateChildren=function(n,c,d,p){if(typeof n==="function"){p=d;d=c;c=n;n=undefined;}var e;if(n){if(d||(g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,n,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS)).Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_CLOSED)===0){e=g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,n,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_CHILDREN)).ChildNodes;}else{e=[];}}else{e=g(this._dvl.Scene.RetrieveSceneInfo(this._dvlSceneRef,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_CHILDREN)).ChildNodes;}if(p){e.forEach(c);}else{var f=this._baseNodeProxyPool.borrowObject();try{e.forEach(function(n){f.init(this,n);c(f);f.reset();}.bind(this));}finally{this._baseNodeProxyPool.returnObject(f);}}return this;};
b.prototype.enumerateAncestors=function(n,c,p){var d=g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,n,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_PARENTS)).ParentNodes;if(p){d.forEach(c);}else{var e=this._baseNodeProxyPool.borrowObject();try{d.forEach(function(n){e.init(this,n);c(e);e.reset();}.bind(this));}finally{this._baseNodeProxyPool.returnObject(e);}}return this;};
b.prototype.createNodeProxy=function(n){var c=new a(this,n);this._nodeProxies.push(c);return c;};
b.prototype.destroyNodeProxy=function(n){var i=this._nodeProxies.indexOf(n);if(i>=0){this._nodeProxies.splice(i,1)[0].destroy();}return this;};
b.prototype.getChildren=function(n,c){if(typeof n==="boolean"){c=n;n=undefined;}if(n){if(c||(g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,n,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS)).Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_CLOSED)===0){return g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,n,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_CHILDREN)).ChildNodes;}else{return[];}}else{return g(this._dvl.Scene.RetrieveSceneInfo(this._dvlSceneRef,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_CHILDREN)).ChildNodes;}};
b.prototype.getAncestors=function(n){return g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,n,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_PARENTS)).ParentNodes;};
b.prototype.findNodesByName=function(c){var d=sap.ve.dvl.DVLFINDNODETYPE.DVLFINDNODETYPE_NODE_NAME,e=[],f,h;if(c===undefined||c===null||q.isEmptyObject(c)){f=s.modeDictionary.contains(false);h=[""];}else{if(c.value===undefined||c.value===null||c.value===""){q.sap.log.error(sap.ui.vk.getResourceBundle().getText(M.VIT6.summary),M.VIT6.code,"sap.ui.vk.dvl.NodeHierarchy");}var p=c.hasOwnProperty("predicate")?c.predicate:"equals";if(p===undefined||p===null||p===""){q.sap.log.error(sap.ui.vk.getResourceBundle().getText(M.VIT7.summary),M.VIT7.code,"sap.ui.vk.dvl.NodeHierarchy");}else if(["equals","contains","startsWith"].indexOf(p)===-1){q.sap.log.error(sap.ui.vk.getResourceBundle().getText(M.VIT8.summary),M.VIT8.code,"sap.ui.vk.dvl.NodeHierarchy");}f=s.modeDictionary[p](c.caseSensitive);h=(typeof c.value==="string")?[c.value]:c.value;}for(var i=0;i<h.length;i++){e=e.concat(g(this._dvl.Scene.FindNodes(this._dvlSceneRef,d,f,h[i])).nodes);}return q.sap.unique(e);};
b.prototype.createLayerProxy=function(c){var d=new L(this,c);this._layerProxies.push(d);return d;};
b.prototype.destroyLayerProxy=function(c){var i=this._layerProxies.indexOf(c);if(i>=0){this._layerProxies.splice(i,1)[0].destroy();}return this;};
b.prototype.getLayers=function(){return g(this._dvl.Scene.RetrieveSceneInfo(this._dvlSceneRef,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_LAYERS)).Layers;};
b.prototype.getHotspotNodeIds=function(){var h=g(this._dvl.Scene.RetrieveSceneInfo(this._dvlSceneRef,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_HOTSPOTS).ChildNodes);return h.length>0?h:this._getLegacyHotspotNodeIds();};
b.prototype._getLegacyHotspotNodeIds=function(){var c=this.getLayers(),h=[];for(var i=0;i<c.length;i++){var d=this.createLayerProxy(c[i]),e=d.getName();if(e.toLowerCase()==="hotspots"){h=d.getNodes();this.destroyLayerProxy(d);break;}this.destroyLayerProxy(d);}return h;};
b.prototype.createNode=function(p,n,i){var c=this._dvl.Scene.CreateNode(this._dvlSceneRef,p,n,i);this.fireNodeCreated({nodeRef:c,nodeId:c});this.fireChanged();return c;};
b.prototype.createNodeCopy=function(n,p,c,i){var d=this._dvl.Scene.CreateNodeCopy(this._dvlSceneRef,n,p,sap.ve.dvl.DVLCREATENODECOPYFLAG.COPY_CHILDREN,c,i);this.fireNodeCreated({nodeRef:d,nodeId:d});this.fireChanged();return d;};
b.prototype.removeNode=function(n){this.fireNodeRemoving({nodeRef:n,nodeId:n});this._dvl.Scene.DeleteNode(this._dvlSceneRef,n);this.fireChanged();return this;};
return b;});
sap.ui.predefine('sap/ui/vk/dvl/NodeProxy',["jquery.sap.global","../library","../NodeProxy"],function(q,l,N){"use strict";var g=sap.ui.vk.dvl.getJSONObject;
var a=N.extend("sap.ui.vk.dvl.NodeProxy",{
metadata:{},
constructor:function(n,b){N.call(this);this._dvl=n?n.getGraphicsCore()._getDvl():null;this._dvlSceneRef=n?n.getSceneRef():null;this._dvlNodeRef=b;}
});
a.prototype.destroy=function(){this._dvlNodeRef=null;this._dvlSceneRef=null;this._dvl=null;N.prototype.destroy.call(this);};
a.prototype.getNodeRef=function(){return this._dvlNodeRef;};
a.prototype.getNodeId=function(){return this._dvlNodeRef;};
a.prototype.getVeIds=function(){return g(this._dvl.Scene.RetrieveVEIDs(this._dvlSceneRef,this._dvlNodeRef));};
a.prototype.getName=function(){return g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,this._dvlNodeRef,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_NAME)).NodeName;};
a.prototype.getLocalMatrix=function(){return sap.ui.vk.TransformationMatrix.convertTo4x3(g(this._dvl.Scene.GetNodeLocalMatrix(this._dvlSceneRef,this._dvlNodeRef)).matrix);};
a.prototype.setLocalMatrix=function(v){this._dvl.Scene.SetNodeLocalMatrix(this._dvlSceneRef,this._dvlNodeRef,v&&sap.ui.vk.TransformationMatrix.convertTo4x4(v));this.setProperty("localMatrix",v,true);return this;};
a.prototype.getWorldMatrix=function(){return sap.ui.vk.TransformationMatrix.convertTo4x3(g(this._dvl.Scene.GetNodeWorldMatrix(this._dvlSceneRef,this._dvlNodeRef)).matrix);};
a.prototype.setWorldMatrix=function(v){this._dvl.Scene.SetNodeWorldMatrix(this._dvlSceneRef,this._dvlNodeRef,v&&sap.ui.vk.TransformationMatrix.convertTo4x4(v));this.setProperty("worldMatrix",v,true);return this;};
a.prototype.getOpacity=function(){return g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,this._dvlNodeRef,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_OPACITY)).Opacity;};
a.prototype.setOpacity=function(v){this._dvl.Scene.SetNodeOpacity(this._dvlSceneRef,this._dvlNodeRef,v);this.setProperty("opacity",v,true);return this;};
a.prototype.getTintColorABGR=function(){return g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,this._dvlNodeRef,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_HIGHLIGHT_COLOR)).HighlightColor;};
a.prototype.setTintColorABGR=function(v){this._dvl.Scene.SetNodeHighlightColor(this._dvlSceneRef,this._dvlNodeRef,v);this.setProperty("tintColorABGR",v,true);this.setProperty("tintColor",sap.ui.vk.colorToCSSColor(sap.ui.vk.abgrToColor(v)),true);return this;};
a.prototype.getTintColor=function(){return sap.ui.vk.colorToCSSColor(sap.ui.vk.abgrToColor(this.getTintColorABGR()));};
a.prototype.setTintColor=function(v){var b=sap.ui.vk.colorToABGR(sap.ui.vk.cssColorToColor(v));this._dvl.Scene.SetNodeHighlightColor(this._dvlSceneRef,this._dvlNodeRef,b);this.setProperty("tintColorABGR",b,true);this.setProperty("tintColor",v,true);return this;};
a.prototype.getNodeMetadata=function(){return g(this._dvl.Scene.RetrieveMetadata(this._dvlSceneRef,this._dvlNodeRef)).metadata;};
a.prototype.getHasChildren=function(){return(g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,this._dvlNodeRef,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS)).Flags&(sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_MAPPED_HASCHILDREN|sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_CLOSED))===sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_MAPPED_HASCHILDREN;};
a.prototype.getClosed=function(){return(g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,this._dvlNodeRef,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS)).Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_CLOSED)!==0;};
return a;});
sap.ui.predefine('sap/ui/vk/dvl/Scene',["jquery.sap.global","../library","../Scene","./NodeHierarchy"],function(q,l,S,N){"use strict";
var a=S.extend("sap.ui.vk.dvl.Scene",{
metadata:{publicMethods:["getDefaultNodeHierarchy","getId","getSceneRef"]},
constructor:function(g,d){S.call(this);this._id=q.sap.uid();this._graphicsCore=g;this._dvlSceneRef=d;this._defaultNodeHierarchy=null;}
});
a.prototype.destroy=function(){if(this._defaultNodeHierarchy){this._defaultNodeHierarchy.destroy();this._defaultNodeHierarchy=null;}this._dvlSceneRef=null;this._graphicsCore=null;S.prototype.destroy.call(this);};
a.prototype.getId=function(){return this._id;};
a.prototype.getGraphicsCore=function(){return this._graphicsCore;};
a.prototype.getDefaultNodeHierarchy=function(){if(!this._defaultNodeHierarchy){this._defaultNodeHierarchy=new N(this);}return this._defaultNodeHierarchy;};
a.prototype.getSceneRef=function(){return this._dvlSceneRef;};
return a;});
sap.ui.predefine('sap/ui/vk/dvl/ViewStateManager',["jquery.sap.global","sap/ui/core/Element","../ContentConnector","../ViewStateManagerBase"],function(q,E,C,V){"use strict";var a;
var b=V.extend("sap.ui.vk.dvl.ViewStateManager",{metadata:{publicMethods:["enumerateSelection","getNodeHierarchy","getOpacity","getSelectionState","getTintColor","getVisibilityChanges","getVisibilityState","setOpacity","setSelectionState","setTintColor","setVisibilityState"]}});
var c=b.getMetadata().getParent().getClass().prototype;
b.prototype.init=function(){if(c.init){c.init.call(this);}this._nodeHierarchy=null;this._dvl=null;this._nodeStates=new Map();this._selectedNodes=new Set();this._visibilityTracker=new a();};
b.prototype._onAfterUpdateContentConnector=function(){this._setScene(this._contentConnector.getContent());};
b.prototype._onBeforeClearContentConnector=function(){this._setScene(null);};
b.prototype._handleContentReplaced=function(e){var d=e.getParameter("newContent");if(!(d instanceof sap.ui.vk.dvl.Scene)){d=null;}this._setScene(d);};
b.prototype._setScene=function(d){if(d){this._setNodeHierarchy(d.getDefaultNodeHierarchy());}else{this._setNodeHierarchy(null);}return this;};
b.prototype._setNodeHierarchy=function(n){var o=this._nodeHierarchy;if(this._nodeHierarchy){this._dvl.Client.detachStepEvent(this._handleStepEvent,this);this._nodeHierarchy=null;this._dvl=null;this._nodeStates.clear();this._selectedNodes.clear();this._visibilityTracker.clear();}if(n){var d=n.getScene(),e=d.getSceneRef();this._nodeHierarchy=n;this._dvl=d.getGraphicsCore().getApi(sap.ui.vk.dvl.GraphicsCoreApi.LegacyDvl);this._dvl.Client.attachStepEvent(this._handleStepEvent,this);var t=this,v=[],h=[],f=[],u=[];t._dvl.Scene.RetrieveSceneInfo(e,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_CHILDREN|sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_HOTSPOTS).ChildNodes.forEach(function addNodeRecursive(i){var j=t._dvl.Scene.RetrieveNodeInfo(e,i,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS|sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_CHILDREN);t._nodeStates.set(i,{flags:j.Flags});if(j.Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED){t._selectedNodes.add(i);}(j.Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE?v:h).push(i);(j.Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED?f:u).push(i);j.ChildNodes.forEach(addNodeRecursive);});this.fireSelectionChanged({selected:f,unselected:u});this.fireVisibilityChanged({visible:v,hidden:h});}if(n!==o){this.fireNodeHierarchyReplaced({oldNodeHierarchy:o,newNodeHierarchy:n});}return this;};
b.prototype.getNodeHierarchy=function(){return this._nodeHierarchy;};
b.prototype.getVisibilityChanges=function(){return this.getShouldTrackVisibilityChanges()?this._visibilityTracker.getInfo(this.getNodeHierarchy()):null;};
b.prototype.getVisibilityComplete=function(){var n=this.getNodeHierarchy(),d=n.findNodesByName(),v=[],h=[];d.forEach(function(e){var f=n.createNodeProxy(e),i=q.grep(f.getVeIds(),function(i){return i.type==="VE_LOCATOR";});i=Array.isArray(i)&&i.length>0?i[0].fields[0].value:null;n.destroyNodeProxy(f);if(i){if(this.getVisibilityState(e)){v.push(i);}else{h.push(i);}}},this);return{visible:v,hidden:h};};
var g=function(n,f,d){return n.has(d)&&(n.get(d).flags&f)!==0;};
b.prototype._getVisibilityFlagState=function(n){return g(this._nodeStates,sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE,n);};
b.prototype._getSelectionFlagState=function(n){return g(this._nodeStates,sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED,n);};
var s=function(n,f,d,e){if(n.has(e)){var i=n.get(e);i.flags=i.flags&~d|f&d;}else{n.set(e,{flags:f&d});}};
b.prototype._setFlags=function(n,f,d){if(d&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE){this.setVisibilityState(n,(f&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE)!==0,false);}if(d&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED){this.setSelectionState(n,(f&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED)!==0,false);}s(this._nodeStates,f,d&~(sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE|sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED),n);return this;};
b.prototype._getFlags=function(n,f){var d=this._nodeStates.get(n),e=d&&d.flags;return e!==undefined?e&f:null;};
b.prototype.getVisibilityState=function(n){return Array.isArray(n)?n.map(this._getVisibilityFlagState,this):this._getVisibilityFlagState(n);};
b.prototype.setVisibilityState=function(n,v,r){if(!Array.isArray(n)){n=[n];}var d=q.sap.unique(r?this._collectNodesRecursively(n):n).filter(function(e){return e&&this._getVisibilityFlagState(e)!==v;},this);if(d.length>0){d.forEach(function(e){var f=this._nodeStates.get(e);if(f){if(f.flags===undefined){f.flags=0;}if(v){f.flags|=sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE|sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_TEMPORARY_PREVIOUS_VISIBILITY;}else{f.flags&=~(sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE|sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_TEMPORARY_PREVIOUS_VISIBILITY);}}else{this._nodeStates.set(e,{flags:v?sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE:0});}},this);if(this.getShouldTrackVisibilityChanges()){d.forEach(this._visibilityTracker.trackNodeRef,this._visibilityTracker);}this.fireVisibilityChanged({visible:v?d:[],hidden:v?[]:d});}return this;};
b.prototype.enumerateSelection=function(d){this._selectedNodes.forEach(d);return this;};
b.prototype.getSelectionState=function(n){return Array.isArray(n)?n.map(this._getSelectionFlagState,this):this._getSelectionFlagState(n);};
b.prototype.setSelectionState=function(n,d,r){if(!Array.isArray(n)){n=[n];}var e=q.sap.unique(r?this._collectNodesRecursively(n):n).filter(function(f){return f&&this._getSelectionFlagState(f)!==d;},this);if(e.length>0){e.forEach(function(f){var h=this._nodeStates.get(f);if(h){if(h.flags===undefined){h.flags=this._dvl.Scene.RetrieveNodeInfo(this._nodeHierarchy.getScene().getSceneRef(),f,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS).Flags;}if(d){h.flags|=sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED;}else{h.flags&=~sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED;}}else{var i=this._dvl.Scene.RetrieveNodeInfo(this._nodeHierarchy.getScene().getSceneRef(),f,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS).Flags;this._nodeStates.set(f,{flags:i|(d?sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED:0)});}this._selectedNodes[d?"add":"delete"](f);},this);this.fireSelectionChanged({selected:d?e:[],unselected:d?[]:e});}return this;};
b.prototype._handleStepEvent=function(e){if(e.type===sap.ve.dvl.DVLSTEPEVENT.DVLSTEPEVENT_STARTED){this._visibilityTracker.clear();}};
b.prototype._collectNodesRecursively=function(n){var r=[],t=this;n.forEach(function collectChildNodes(d){r.push(d);t._nodeHierarchy.enumerateChildren(d,collectChildNodes,false,true);});return r;};
b.prototype._getOpacity=function(n){if(this._nodeStates.has(n)){var o=this._nodeStates.get(n).opacity;return o===undefined?null:o;}else{return null;}};
b.prototype.getOpacity=function(n){if(Array.isArray(n)){return n.map(this._getOpacity,this);}else{return this._getOpacity(n);}};
b.prototype.setOpacity=function(n,o,r){if(!Array.isArray(n)){n=[n];}var d=q.sap.unique(r?this._collectNodesRecursively(n):n).filter(function(e){return e&&this._getOpacity(e)!==o;},this);if(d.length>0){d.forEach(function(e){var f=this._nodeStates.get(e);if(f){if(o===null){delete f.opacity;}else{f.opacity=o;}}else if(o!==null){this._nodeStates.set(e,{opacity:o});}},this);this.fireOpacityChanged({changed:d,opacity:o});}return this;};
b.prototype._getTintColorABGR=function(n){if(this._nodeStates.has(n)){var t=this._nodeStates.get(n).tintColorABGR;return t===undefined?null:t;}else{return null;}};
b.prototype._getTintColor=function(n){if(this._nodeStates.has(n)){var t=this._nodeStates.get(n).tintColorABGR;return t===undefined?null:sap.ui.vk.colorToCSSColor(sap.ui.vk.abgrToColor(t));}else{return null;}};
b.prototype.getTintColor=function(n,i){var d=i?"_getTintColorABGR":"_getTintColor";if(Array.isArray(n)){return n.map(this[d],this);}else{return this[d](n);}};
b.prototype.setTintColor=function(n,t,r){if(!Array.isArray(n)){n=[n];}var d=null;switch(typeof t){case"number":d=t;break;case"string":if(sap.ui.core.CSSColor.isValid(t)){d=sap.ui.vk.colorToABGR(sap.ui.vk.cssColorToColor(t));}break;default:t=null;break;}var e=q.sap.unique(r?this._collectNodesRecursively(n):n).filter(function(f){return f&&this._getTintColorABGR(f)!==d;},this);if(e.length>0){e.forEach(function(f){var h=this._nodeStates.get(f);if(h){if(d===null){delete h.tintColorABGR;}else{h.tintColorABGR=d;}}else if(d!==null){this._nodeStates.set(f,{tintColorABGR:d});}},this);this.fireTintColorChanged({changed:e,tintColor:t,tintColorABGR:d});}return this;};
a=function(){this._visibilityChanges=new Set();};
a.prototype.getInfo=function(n){var f=function(v){return v.type==="VE_LOCATOR";};var d=[];this._visibilityChanges.forEach(function(e){var h=n.createNodeProxy(e),v=q.grep(h.getVeIds(),f);v=Array.isArray(v)&&v.length>0?v[0].fields[0].value:null;n.destroyNodeProxy(h);if(v){d.push(v);}});return d;};
a.prototype.clear=function(){this._visibilityChanges.clear();};
a.prototype.trackNodeRef=function(n){if(this._visibilityChanges.has(n)){this._visibilityChanges.delete(n);}else{this._visibilityChanges.add(n);}};
C.injectMethodsIntoClass(b);return b;});
sap.ui.predefine('sap/ui/vk/dvl/Viewport',["jquery.sap.global","../library","../ViewportBase","sap/ui/core/ResizeHandler","../Loco","../ViewportHandler","../Smart2DHandler","../Messages","../ContentConnector","../ViewStateManager","./GraphicsCore"],function(q,l,V,R,L,a,S,M,C,b,G){"use strict";var d={encodedProjectionType:{},decodedProjectionType:{},encodedBindingType:{},decodedBindingType:{},decodedZoomTo:{}};d.decodedProjectionType[sap.ui.vk.CameraProjectionType.Perspective]=sap.ve.dvl.DVLCAMERAPROJECTION.PERSPECTIVE;d.decodedProjectionType[sap.ui.vk.CameraProjectionType.Orthographic]=sap.ve.dvl.DVLCAMERAPROJECTION.ORTHOGRAPHIC;d.encodedProjectionType[sap.ve.dvl.DVLCAMERAPROJECTION.PERSPECTIVE]=sap.ui.vk.CameraProjectionType.Perspective;d.encodedProjectionType[sap.ve.dvl.DVLCAMERAPROJECTION.ORTHOGRAPHIC]=sap.ui.vk.CameraProjectionType.Orthographic;d.decodedBindingType[sap.ui.vk.CameraFOVBindingType.Minimum]=sap.ve.dvl.DVLCAMERAFOVBINDING.MIN;d.decodedBindingType[sap.ui.vk.CameraFOVBindingType.Maximum]=sap.ve.dvl.DVLCAMERAFOVBINDING.Max;d.decodedBindingType[sap.ui.vk.CameraFOVBindingType.Horizontal]=sap.ve.dvl.DVLCAMERAFOVBINDING.HORZ;d.decodedBindingType[sap.ui.vk.CameraFOVBindingType.Vertical]=sap.ve.dvl.DVLCAMERAFOVBINDING.VERT;d.encodedBindingType[sap.ve.dvl.DVLCAMERAFOVBINDING.MIN]=sap.ui.vk.CameraFOVBindingType.Minimum;d.encodedBindingType[sap.ve.dvl.DVLCAMERAFOVBINDING.MAX]=sap.ui.vk.CameraFOVBindingType.Maximum;d.encodedBindingType[sap.ve.dvl.DVLCAMERAFOVBINDING.HORZ]=sap.ui.vk.CameraFOVBindingType.Horizontal;d.encodedBindingType[sap.ve.dvl.DVLCAMERAFOVBINDING.VERT]=sap.ui.vk.CameraFOVBindingType.Vertical;d.decodedZoomTo[sap.ui.vk.ZoomTo.All]=sap.ve.dvl.DVLZOOMTO.DVLZOOMTO_ALL;d.decodedZoomTo[sap.ui.vk.ZoomTo.Visible]=sap.ve.dvl.DVLZOOMTO.DVLZOOMTO_VISIBLE;d.decodedZoomTo[sap.ui.vk.ZoomTo.Selected]=sap.ve.dvl.DVLZOOMTO.DVLZOOMTO_SELECTED;d.decodedZoomTo[sap.ui.vk.ZoomTo.Node]=sap.ve.dvl.DVLZOOMTO.DVLZOOMTO_NODE;d.decodedZoomTo[sap.ui.vk.ZoomTo.NodeSetIsolation]=sap.ve.dvl.DVLZOOMTO.DVLZOOMTO_NODE_SETISOLATION;d.decodedZoomTo[sap.ui.vk.ZoomTo.Restore]=sap.ve.dvl.DVLZOOMTO.DVLZOOMTO_RESTORE;d.decodedZoomTo[sap.ui.vk.ZoomTo.RestoreRemoveIsolation]=sap.ve.dvl.DVLZOOMTO.DVLZOOMTO_RESTORE_REMOVEISOLATION;d.decodedZoomTo[sap.ui.vk.ZoomTo.ViewLeft]=sap.ve.dvl.DVLZOOMTO.VIEW_LEFT;d.decodedZoomTo[sap.ui.vk.ZoomTo.ViewRight]=sap.ve.dvl.DVLZOOMTO.VIEW_RIGHT;d.decodedZoomTo[sap.ui.vk.ZoomTo.ViewTop]=sap.ve.dvl.DVLZOOMTO.VIEW_TOP;d.decodedZoomTo[sap.ui.vk.ZoomTo.ViewBottom]=sap.ve.dvl.DVLZOOMTO.VIEW_BOTTOM;d.decodedZoomTo[sap.ui.vk.ZoomTo.ViewBack]=sap.ve.dvl.DVLZOOMTO.VIEW_BACK;d.decodedZoomTo[sap.ui.vk.ZoomTo.ViewFront]=sap.ve.dvl.DVLZOOMTO.VIEW_FRONT;
var c=V.extend("sap.ui.vk.dvl.Viewport",{metadata:{library:"sap.ui.vk",publicMethods:["beginGesture","endGesture","getGraphicsCore","getViewInfo","hitTest","pan","queueCommand","rotate","setGraphicsCore","setScene","setViewInfo","tap","zoom"],properties:{showAllHotspots:{type:"boolean",defaultValue:false},hotspotColorABGR:{type:"int",defaultValue:0xc00000ff},hotspotColor:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(255, 0, 0, 0.7529411764705882)"},backgroundColorTopABGR:{type:"int",defaultValue:0xff000000},backgroundColorBottomABGR:{type:"int",defaultValue:0xffffffff}},events:{urlClicked:{parameters:{nodeRef:"any",url:"string"},enableEventBubbling:true},nodeClicked:{parameters:{nodeRef:"any",x:"int",y:"int"},enableEventBubbling:true},pan:{parameters:{dx:"int",dy:"int"}},zoom:{parameters:{zoomFactor:"float"}},rotate:{parameters:{dx:"int",dy:"int"}},viewActivated:{parameters:{type:{type:"string"}}},frameRenderingFinished:{}}}});
var e=c.getMetadata().getParent().getClass().prototype;
c.prototype.init=function(){if(e.init){e.init.call(this);}this._graphicsCore=null;this._dvl=null;this._dvlRendererId=null;this._viewStateManager=null;this._canvas=null;this._resizeListenerId=null;this._is2D=false;this._viewportHandler=new a(this);this._loco=new L();this._loco.addHandler(this._viewportHandler);this._smart2DHandler=null;this._lastPlayedStep=null;this._contentConnector=null;};
c.prototype.exit=function(){this._loco.removeHandler(this._viewportHandler);this._viewportHandler.destroy();if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}this._clearContentConnector();this.setViewStateManager(null);this.setScene(null);this.setGraphicsCore(null);if(e.exit){e.exit.call(this);}};
c.prototype.setGraphicsCore=function(i){if(i!=this._graphicsCore){if(this._graphicsCore){this._dvl.Client.detachFrameFinished(this._handleFrameFinished,this);this._dvl.Client.detachStepEvent(this._updateLastPlayedStep,this);this._dvl.Renderer.SetViewStateManager(null,this._dvlRendererId);this._graphicsCore._deregisterViewport(this);this._dvl=null;}this._graphicsCore=i;if(this._graphicsCore){this._dvl=this._graphicsCore._getDvl();this._graphicsCore._registerViewport(this);this.setShowDebugInfo(this.getShowDebugInfo());this._dvl.Client.attachStepEvent(this._updateLastPlayedStep,this);this._dvl.Client.attachFrameFinished(this._handleFrameFinished,this);this._dvl.Renderer.SetViewStateManager(this._viewStateManager,this._dvlRendererId);}}return this;};
c.prototype.getGraphicsCore=function(){return this._graphicsCore;};
c.prototype._setCanvas=function(i){var j=this.getDomRef()&&this._canvas!==i;this._canvas=i;if(j){this.invalidate();}return this;};
c.prototype._setRenderer=function(i){this._dvlRendererId=i;return this;};
c.prototype._updateLastPlayedStep=function(i){if(i.type===sap.ve.dvl.DVLSTEPEVENT.DVLSTEPEVENT_STARTED){this._lastPlayedStep=i.stepId;}};
c.prototype.setScene=function(i){if(this._dvlRendererId){this._dvl.Renderer.AttachScene(i&&i.getSceneRef()||null,this._dvlRendererId);this._dvlSceneRef=i?i.getSceneRef():null;if(i){this._dvl.Client.attachUrlClicked(this._fireUrlClicked,this);var j=this._isSmart2DContent()||this._isSmart2DContentLegacy();if(j){this._dvl.Renderer.SetBackgroundColor(1,1,1,1,1,1,1,1,this._dvlRendererId);}else{var t=this._getDecomposedABGR(this.getBackgroundColorTopABGR());var n=this._getDecomposedABGR(this.getBackgroundColorBottomABGR());this._dvl.Renderer.SetBackgroundColor(t.red,t.green,t.blue,t.alpha,n.red,n.green,n.blue,n.alpha,this._dvlRendererId);}this.fireViewActivated({type:j?"2D":"3D"});}else{this._dvl.Client.detachUrlClicked(this._fireUrlClicked,this);if(this._smart2DHandler){var u=new L();u.removeHandler(this._smart2DHandler);}this.invalidate();}}return this;};
c.prototype._isSmart2DContent=function(){var i=sap.ui.vk.dvl.getJSONObject(this._dvl.Scene.RetrieveSceneInfo(this._dvlSceneRef,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_HOTSPOTS).ChildNodes);return i&&i.length>0;};
c.prototype._isSmart2DContentLegacy=function(){var i=this._dvl.Scene.GetCurrentCamera(this._dvlSceneRef),j=this._dvl.Camera.GetRotation(i),n=this._dvl.Camera.GetProjection(i);return j[0]===90&&j[1]===-90&&j[2]===0&&n===sap.ve.dvl.DVLCAMERAPROJECTION.ORTHOGRAPHIC;};
c.prototype._initializeSmart2DHandler=function(){if(this._viewStateManager){if(this._smart2DHandler){this._loco.removeHandler(this._smart2DHandler);}this._smart2DHandler=new S(this,this._viewStateManager);this._loco.addHandler(this._smart2DHandler);}if(this.getShowAllHotspots()){var n=this._viewStateManager.getNodeHierarchy(),i=n.getHotspotNodeIds();this.showHotspots(i,true);}};
c.prototype._fireUrlClicked=function(i){this.fireUrlClicked({url:i.url,nodeRef:i.nodeRef,nodeId:i.nodeId});};
c.prototype.setHotspotColorABGR=function(v){this.setProperty("hotspotColorABGR",v,true);this.setProperty("hotspotColor",sap.ui.vk.colorToCSSColor(sap.ui.vk.abgrToColor(this.getProperty("hotspotColorABGR"))),true);return this;};
c.prototype.setHotspotColor=function(v){this.setProperty("hotspotColor",v,true);this.setProperty("hotspotColorABGR",sap.ui.vk.colorToABGR(sap.ui.vk.cssColorToColor(this.getProperty("hotspotColor"))),true);return this;};
c.prototype._getStepAndProcedureIndexes=function(n,t){var u=-1,v=-1,w=false;for(var i=0;i<n.length;i++){if(!w){for(var j=0;j<n[i].steps.length;j++){if(n[i].steps[j].id===t){v=j;u=i;w=true;break;}}}else{break;}}return{stepIndex:v,procedureIndex:u};};
c.prototype._getStepVeIdById=function(i){if(i){var v=this._dvl.Scene.RetrieveVEIDs(this._dvlSceneRef,i);if(Array.isArray(v)){for(var j=0,n=v.length;j<n;++j){var t=v[j];if(t.source==="SAP"&&t.type==="VE_VIEWPORT"&&Array.isArray(t.fields)){for(var u=0,w=t.fields.length;u<w;++u){var x=t.fields[u];if(x.name==="ID"){return x.value;}}}}}}return null;};
c.prototype._getStepIdByVeId=function(i,j){for(var n=0,t=i.length;n<t;++n){var u=i[n].steps;for(var v=0,w=u.length;v<w;++v){var x=u[v].id;if(this._getStepVeIdById(x)===j){return x;}}}return null;};
var s=function(i){i.camera={};};var f=function(i){if(typeof i.camera==="object"&&i.camera!==null){i.camera.matrices=false;}};var g=function(i){if(typeof i.camera==="object"&&i.camera!==null){i.camera.useTransitionCamera=false;}};var h=function(i){i.animation=true;};var k=function(i){i.visibility=false;};var m=function(i){if(typeof i.visibility==="object"&&i.visibility!==null){i.visibility.mode=sap.ui.vk.VisibilityMode.Complete;}};
c.prototype.getViewInfo=function(i){if(!this._dvlSceneRef){return null;}var j={};if(typeof i!=="object"||i===null){s(j);f(j);g(j);h(j);k(j);m(j);}else{if(typeof i.camera==="object"&&i.camera!==null){j.camera={};if(typeof i.camera.matrices==="boolean"){j.camera.matrices=i.camera.matrices;}else if("matrices"in i.camera){j.camera.matrices=false;}else{f(j);}if(typeof i.camera.useTransitionCamera==="boolean"){j.camera.useTransitionCamera=i.camera.useTransitionCamera;}else if("useTransitionCamera"in i.camera){j.camera.useTransitionCamera=false;}else{g(j);}}else if(typeof i.camera==="boolean"){if(i.camera===true){j.camera={};f(j);g(j);}else{j.camera=false;}}else if("camera"in i){j.camera=false;}else{s(j);f(j);g(j);}if(typeof i.animation==="boolean"){j.animation=i.animation;}else if("animation"in i){j.animation=false;}else{h(j);}if(typeof i.visibility==="object"&&i.visibility!==null){j.visibility={};if(i.visibility.mode===sap.ui.vk.VisibilityMode.Complete||i.visibility.mode===sap.ui.vk.VisibilityMode.Differences){j.visibility.mode=i.visibility.mode;}else{m(j);}}else if(typeof i.visibility==="boolean"){if(i.visibility===true){j.visibility={};m(j);}else{j.visibility=false;}}else if("visibility"in i){j.visibility=false;}else{k(j);m(j);}}var v={};if(j.camera){var n=null;if(j.camera.useTransitionCamera){n=this._dvl.Renderer.GetTransitionCamera(this._dvlRendererId);if(n===sap.ve.dvl.DVLID_INVALID){n=null;}}if(n===null){n=this._dvl.Renderer.GetCurrentCamera(this._dvlRendererId);}var t=this._dvl.Camera.GetRotation(n),u=this._dvl.Camera.GetOrigin(n);v.camera={rotation:{yaw:t[0],pitch:t[1],roll:t[2]},position:{x:u[0],y:u[1],z:u[2]},projectionType:d.encodedProjectionType[this._dvl.Camera.GetProjection(n)],bindingType:d.encodedBindingType[this._dvl.Camera.GetFOVBinding(n)]};if(v.camera.projectionType===sap.ui.vk.CameraProjectionType.Perspective){v.camera.fieldOfView=this._dvl.Camera.GetFOV(n);}else if(v.camera.projectionType===sap.ui.vk.CameraProjectionType.Orthographic){v.camera.zoomFactor=this._dvl.Camera.GetOrthoZoomFactor(n);}if(j.camera.matrices){var w=this._dvl.Renderer.GetCameraMatrices(this._dvlRendererId);v.camera.matrices={view:w.view,projection:w.projection};}}if(j.animation){var x=this._dvl.Scene.RetrieveSceneInfo(this._dvlSceneRef,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_STEP_INFO),y=x.StepId!==sap.ve.dvl.DVLID_INVALID;var z=y?x.StepId:this._lastPlayedStep,A=y?x.StepTime:0,B=this._dvl.Scene.RetrieveProcedures(this._dvlSceneRef),D=this._getStepAndProcedureIndexes(B.procedures,z),E=this._getStepVeIdById(z);v.animation={animationTime:A,stepIndex:D.stepIndex,procedureIndex:D.procedureIndex};if(E){v.animation.stepVeId=E;}}if(j.visibility&&this._viewStateManager){v.visibility={mode:j.visibility.mode};if(j.visibility.mode===sap.ui.vk.VisibilityMode.Complete){var F=this._viewStateManager.getVisibilityComplete();v.visibility.visible=F.visible;v.visibility.hidden=F.hidden;}else if(this._viewStateManager.getShouldTrackVisibilityChanges()){v.visibility.changes=this._viewStateManager.getVisibilityChanges();}else{q.sap.log.warning(sap.ui.vk.getResourceBundle().getText(M.VIT32.summary),M.VIT32.code,"sap.ui.vk.dvl.Viewport");}}return v;};
c.prototype.setViewInfo=function(v,i){var j=false;if(v.animation){var n=this._dvl.Scene.RetrieveProcedures(this._dvlSceneRef),t=v.animation.procedureIndex,u=v.animation.stepIndex,w=v.animation.stepVeId,x,y=v.animation.animationTime||0;if(w||u>=0&&t>=0){if(w){x=this._getStepIdByVeId(n.procedures,v.animation.stepVeId);}else if(t>=0&&t<n.procedures.length){if(u>=0&&u<n.procedures[t].steps.length){x=n.procedures[t].steps[u].id;}else{q.sap.log.error(sap.ui.vk.getResourceBundle().getText(M.VIT26.summary),M.VIT26.code,"sap.ui.vk.dvl.Viewport");}}else{q.sap.log.error(sap.ui.vk.getResourceBundle().getText(M.VIT27.summary),M.VIT27.code,"sap.ui.vk.dvl.Viewport");}if(x){this._dvl.Renderer.ActivateStep(this._dvlRendererId,x,false,false,y);this._dvl.Renderer.PauseCurrentStep(this._dvlRendererId);}}else{j=true;}}if(v.camera){var z;if(v.camera.projectionType===sap.ui.vk.CameraProjectionType.Perspective||v.camera.projectionType===sap.ui.vk.CameraProjectionType.Orthographic){z=d.decodedProjectionType[v.camera.projectionType];}else{q.sap.log.error(sap.ui.vk.getResourceBundle().getText(M.VIT19.summary),M.VIT19.code,"sap.ui.vk.dvl.Viewport");z=sap.ve.dvl.DVLCAMERAPROJECTION.PERSPECTIVE;}var A=this._dvl.Scene.CreateCamera(this._dvlSceneRef,z,sap.ve.dvl.DVLID_INVALID);if(z===sap.ve.dvl.DVLCAMERAPROJECTION.PERSPECTIVE){this._dvl.Camera.SetFOV(A,v.camera.fieldOfView);}else if(z===sap.ve.dvl.DVLCAMERAPROJECTION.ORTHOGRAPHIC){this._dvl.Camera.SetOrthoZoomFactor(A,v.camera.zoomFactor);}if(v.camera.position){this._dvl.Camera.SetOrigin(A,v.camera.position.x,v.camera.position.y,v.camera.position.z);}if(v.camera.rotation){this._dvl.Camera.SetRotation(A,v.camera.rotation.yaw,v.camera.rotation.pitch,v.camera.rotation.roll);}if(v.camera.bindingType){var B=d.decodedBindingType[v.camera.bindingType]||sap.ve.dvl.DVLCAMERAFOVBINDING.MIN;this._dvl.Camera.SetFOVBinding(A,B);}i=i||0;this._dvl.Renderer.ActivateCamera(this._dvlRendererId,A,i);this._dvl.Scene.DeleteNode(this._dvlSceneRef,A);}if(v.visibility){var D=this._viewStateManager.getNodeHierarchy(),E=new Map(),F=D.findNodesByName();F.forEach(function(J){var K=D.createNodeProxy(J),N=q.grep(K.getVeIds(),function(N){return N.type==="VE_LOCATOR";});N=Array.isArray(N)&&N.length>0?N[0].fields[0].value:null;D.destroyNodeProxy(K);if(N){E.set(N,J);}});switch(v.visibility.mode){case sap.ui.vk.VisibilityMode.Complete:var H=v.visibility.visible,I=v.visibility.hidden;H.forEach(function(J){this._viewStateManager.setVisibilityState(E.get(J),true,false);},this);I.forEach(function(J){this._viewStateManager.setVisibilityState(E.get(J),false,false);},this);break;case sap.ui.vk.VisibilityMode.Differences:if(j){this.resetView({camera:false,visibility:true,transition:false});}v.visibility.changes.forEach(function(J){var K=E.get(J);if(K){this._viewStateManager.setVisibilityState(K,!this._viewStateManager.getVisibilityState(K),false);}},this);break;default:q.sap.log.error(sap.ui.vk.getResourceBundle().getText(M.VIT28.summary),M.VIT28.code,"sap.ui.vk.dvl.Viewport");break;}}return this;};
c.prototype.getOutputSize=function(){var i=this.getViewInfo().camera.bindingType,j=this.getDomRef().getBoundingClientRect(),v=j.width,n=j.height,t;switch(d.decodedBindingType[i]){case sap.ve.dvl.DVLCAMERAFOVBINDING.MIN:t=Math.min(v,n);break;case sap.ve.dvl.DVLCAMERAFOVBINDING.MAX:t=Math.max(v,n);break;case sap.ve.dvl.DVLCAMERAFOVBINDING.HORZ:t=v;break;case sap.ve.dvl.DVLCAMERAFOVBINDING.VERT:t=n;break;default:break;}return{left:(v-t)/2,top:(n-t)/2,sideLength:t};};
c.prototype.onBeforeRendering=function(){if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}};
c.prototype.onAfterRendering=function(){if(this._canvas){var i=this.getDomRef();i.appendChild(this._canvas);this._resizeListenerId=R.register(this,this._handleResize.bind(this));this._handleResize({size:{width:i.clientWidth,height:i.clientHeight}});}};
c.prototype._handleResize=function(i){if(this._dvlRendererId&&this._canvas){var j=i.size.width*window.devicePixelRatio;var n=i.size.height*window.devicePixelRatio;this._dvl.Renderer.SetDimensions(j,n,this._dvlRendererId);this._dvl.Renderer.SetOptionF(sap.ve.dvl.DVLRENDEROPTIONF.DVLRENDEROPTIONF_DPI,96*window.devicePixelRatio,this._dvlRendererId);this._canvas.width=j;this._canvas.height=n;this._canvas.style.width=i.size.width+"px";this._canvas.style.height=i.size.height+"px";this.fireResize({size:{width:i.size.width,height:i.size.height}});return true;}};
c.prototype._handleVisibilityChanged=c.prototype._handleSelectionChanged=c.prototype._handleOpacityChanged=c.prototype._handleTintColorChanged=function(i){if(this._dvlRendererId){this._dvl.Renderer.ForceRenderFrame(this._dvlRendererId);}};
c.prototype.showHotspots=function(n,i,j){var t=sap.ui.vk.dvl.NodeProxy.prototype[typeof j==="string"?"setTintColor":"setTintColorABGR"];var u=function(w,j,A){var B=w.createNodeProxy(A);t.call(B,j);w.destroyNodeProxy(B);};if(!Array.isArray(n)){n=[n];}var v=j===undefined?this.getHotspotColorABGR():j;if(!i){v=0;}var w=this._viewStateManager.getNodeHierarchy();if(this._isSmart2DContent()){var x=[];n.forEach(function(A){var B=sap.ui.vk.dvl.getJSONObject(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,A,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_CHILDREN).ChildNodes);Array.prototype.push.apply(x,B);}.bind(this));Array.prototype.push.apply(x,n);x.forEach(u.bind(null,w,v));}else{var y=[];var z=function(A){var x=w.getChildren(A);Array.prototype.push.apply(y,x);x.forEach(z);};n.forEach(z);Array.prototype.push.apply(y,n);y.forEach(u.bind(null,w,v));}return this;};
c.prototype._getDecomposedABGR=function(i){return{red:(i>>>0&0xff)/255,green:(i>>>8&0xff)/255,blue:(i>>>16&0xff)/255,alpha:(i>>>24&0xff)/255};};
c.prototype._setBackgroundColor=function(){if(this._dvl){var t=this._getDecomposedABGR(this.getBackgroundColorTopABGR()),i=this._getDecomposedABGR(this.getBackgroundColorBottomABGR());this._dvl.Renderer.SetBackgroundColor(t.red,t.green,t.blue,t.alpha,i.red,i.green,i.blue,i.alpha,this._dvlRendererId);}};
c.prototype.setBackgroundColorTopABGR=function(i){this.setProperty("backgroundColorTopABGR",i,true);this._setBackgroundColor();return this;};
c.prototype.setBackgroundColorTop=function(v){this.setProperty("backgroundColorTop",v,true);return this.setBackgroundColorTopABGR(sap.ui.vk.colorToABGR(sap.ui.vk.cssColorToColor(v)));};
c.prototype.setBackgroundColorBottomABGR=function(i){this.setProperty("backgroundColorBottomABGR",i,true);this._setBackgroundColor();return this;};
c.prototype.setBackgroundColorBottom=function(v){this.setProperty("backgroundColorBottom",v,true);return this.setBackgroundColorBottomABGR(sap.ui.vk.colorToABGR(sap.ui.vk.cssColorToColor(v)));};
c.prototype.setShouldRenderFrame=function(){if(this._dvlRendererId){this._dvl.Renderer.ForceRenderFrame(this._dvlRendererId);}return this;};
c.prototype.shouldRenderFrame=function(){return this._dvlRendererId&&this._dvl.Renderer.ShouldRenderFrame(this._dvlRendererId);};
c.prototype.renderFrame=function(){if(this._dvlRendererId){this._dvl.Renderer.RenderFrame(this._dvlRendererId);}return this;};
c.prototype.renderFrameEx=function(v,i){if(this._dvlRendererId){this._dvl.Renderer.RenderFrameEx.apply(this,[].concat(v,i),this._dvlRendererId);}return this;};
c.prototype.resetView=function(i){if(i!==undefined&&!q.isPlainObject(i)){q.sap.log.error(sap.ui.vk.getResourceBundle().getText(M.VIT31.summary),M.VIT31.code,"sap.ui.vk.dvl.Viewport");}var j={camera:true,transition:true,visibility:false};q.extend(j,i);if(j.camera||j.visibility){var n=(j.camera?sap.ve.dvl.DVLRESETVIEWFLAG.CAMERA:0)|(j.transition?sap.ve.dvl.DVLRESETVIEWFLAG.SMOOTHTRANSITION:0)|(j.visibility?sap.ve.dvl.DVLRESETVIEWFLAG.VISIBILITY:0);if(this._dvlRendererId){this._dvl.Renderer.ResetView(n,this._dvlRendererId);this._lastPlayedStep=null;}}return this;};
c.prototype.canIsolateNode=function(n){if(this._dvlRendererId){return this._dvl.Renderer.CanIsolateNode(n,this._dvlRendererId);}else{return false;}};
c.prototype.setIsolatedNode=function(n){if(this._dvlRendererId){this._dvl.Renderer.SetIsolatedNode(n,this._dvlRendererId);}return this;};
c.prototype.getIsolatedNode=function(){if(this._dvlRendererId){return this._dvl.Renderer.GetIsolatedNode(this._dvlRendererId);}else{return sap.ve.dvl.DVLID_INVALID;}};
c.prototype.hitTest=function(x,y){if(this._dvlRendererId){var i=this._dvl.Renderer.HitTest(x*window.devicePixelRatio,y*window.devicePixelRatio,this._dvlRendererId).id;this.setShouldRenderFrame();return i;}else{return sap.ve.dvl.DVLID_INVALID;}};
c.prototype.setShowDebugInfo=function(v){this.setProperty("showDebugInfo",v,true);if(this._dvlRendererId){this._dvl.Renderer.SetOption(sap.ve.dvl.DVLRENDEROPTION.DVLRENDEROPTION_SHOW_DEBUG_INFO,v,this._dvlRendererId);}return this;};
c.prototype._handleFrameFinished=function(i){if(i.rendererId===this._dvlRendererId){this.fireFrameRenderingFinished();}};
c.prototype.beginGesture=function(x,y){if(this._dvlRendererId){this._dvl.Renderer.BeginGesture(x*window.devicePixelRatio,y*window.devicePixelRatio,this._dvlRendererId);}return this;};
c.prototype.endGesture=function(){if(this._dvlRendererId){this._dvl.Renderer.EndGesture(this._dvlRendererId);}return this;};
c.prototype.pan=function(i,j){if(this._dvlRendererId){this._dvl.Renderer.Pan(i*window.devicePixelRatio,j*window.devicePixelRatio,this._dvlRendererId);this.firePan({dx:i,dy:j});}return this;};
c.prototype.rotate=function(i,j){if(this._dvlRendererId){this._dvl.Renderer.Rotate(i*window.devicePixelRatio,j*window.devicePixelRatio,this._dvlRendererId);this.fireRotate({dx:i,dy:j});}return this;};
c.prototype.zoom=function(i){if(this._dvlRendererId){this._dvl.Renderer.Zoom(i,this._dvlRendererId);this.fireZoom({zoomFactor:i});}return this;};
c.prototype.zoomTo=function(w,n,j,t){if(this._dvlRendererId){var u=0;if(Array.isArray(w)){for(var i in w){u|=d.decodedZoomTo[w[i]];}}else{u=d.decodedZoomTo[w];}this._dvl.Renderer.ZoomTo(u,n,j,t,this._dvlRendererId);}return this;};
c.prototype.tap=function(x,y,i){if(this._dvlRendererId){var j=x*window.devicePixelRatio,n=y*window.devicePixelRatio;if(!i){var t=this.hitTest(x,y);var u={picked:t!==sap.ve.dvl.DVLID_INVALID?[t]:[]};this.fireNodesPicked(u);if(this.getSelectionMode()===sap.ui.vk.SelectionMode.Exclusive){this.exclusiveSelectionHandler(u.picked);}else if(this.getSelectionMode()===sap.ui.vk.SelectionMode.Sticky){this.stickySelectionHandler(u.picked);}if(t!==sap.ve.dvl.DVLID_INVALID){this.fireNodeClicked({nodeRef:t,nodeId:t,x:x,y:y},true,true);}}else{this._dvl.Renderer.Tap(j,n,i,this._dvlRendererId);}}return this;};
c.prototype.queueCommand=function(i){if(this._dvlRendererId){this._dvl.Renderer._queueCommand(i,this._dvlRendererId);}return this;};
c.prototype._onAfterUpdateContentConnector=function(){this._setScene(this._contentConnector.getContent());};
c.prototype._onBeforeClearContentConnector=function(){this._setScene(null);};
c.prototype._handleContentReplaced=function(i){var j=i.getParameter("newContent");if(!(j instanceof sap.ui.vk.dvl.Scene)){j=null;}this._setScene(j);};
c.prototype._setScene=function(i){var j=i&&i.getGraphicsCore();this.setGraphicsCore(j);this.setScene(i);if(i&&(this._isSmart2DContent()||this._isSmart2DContentLegacy())){this._initializeSmart2DHandler();}};
c.prototype._handleContentChangesFinished=function(i){this.setShouldRenderFrame();};
c.prototype._onAfterUpdateViewStateManager=function(){if(this._dvl){this._dvl.Renderer.SetViewStateManager(this._viewStateManager,this._dvlRendererId);}};
c.prototype._onBeforeClearViewStateManager=function(){if(this._dvl){this._dvl.Renderer.SetViewStateManager(null,this._dvlRendererId);}};
var o={x:-2,y:-2};var r=2;var p=5;[{key:"left",dx:-r,dy:0},{key:"right",dx:+r,dy:0},{key:"up",dx:0,dy:-r},{key:"down",dx:0,dy:+r}].forEach(function(i){c.prototype["onsap"+i.key]=function(j){this.beginGesture(o.x,o.y);this.rotate(i.dx,i.dy);this.endGesture();this.setShouldRenderFrame();j.preventDefault();j.stopPropagation();};});[{key:"left",dx:-p,dy:0},{key:"right",dx:+p,dy:0},{key:"up",dx:0,dy:-p},{key:"down",dx:0,dy:+p}].forEach(function(i){c.prototype["onsap"+i.key+"modifiers"]=function(j){if(j.shiftKey&&!(j.ctrlKey||j.altKey||j.metaKey)){this.beginGesture(o.x,o.y);this.pan(i.dx,i.dy);this.endGesture();this.setShouldRenderFrame();j.preventDefault();j.stopPropagation();}};});[{key:"minus",d:0.98},{key:"plus",d:1.02}].forEach(function(i){V.prototype["onsap"+i.key]=function(j){this.beginGesture(this.$().width()/2,this.$().height()/2);this.zoom(i.d);this.endGesture();this.setShouldRenderFrame();j.preventDefault();j.stopPropagation();};});C.injectMethodsIntoClass(c);b.injectMethodsIntoClass(c);return c;});
sap.ui.predefine('sap/ui/vk/dvl/ViewportRenderer',["jquery.sap.global"],function(q){"use strict";var V={};
V.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapVizKitViewport");r.writeClasses();r.writeAttribute("tabindex",0);var a=false;var w=c.getWidth();if(w){r.addStyle("width",w);a=true;}var h=c.getHeight();if(h){r.addStyle("height",h);a=true;}if(a){r.writeStyles();}r.write(">");r.write("</div>");};
return V;},true);
sap.ui.predefine('sap/ui/vk/threejs/BaseNodeProxy',["jquery.sap.global","../library","../BaseNodeProxy"],function(q,l,B){"use strict";
var a=B.extend("sap.ui.vk.threejs.BaseNodeProxy",{metadata:{publicMethods:["getHasChildren","getName","getSceneRef","getNodeRef","getNodeId","getNodeMetadata"]}});
a.prototype.init=function(n,b){this._object3D=b;};
a.prototype.reset=function(){this._object3D=null;};
a.prototype.getNodeRef=function(){return this._object3D;};
a.prototype.getNodeId=function(){return this._object3D;};
a.prototype.getName=function(){return this._object3D.name||("<"+this._object3D.type+">");};
a.prototype.getNodeMetadata=function(){return this._object3D.userData.metadata;};
a.prototype.getHasChildren=function(){return this._object3D.children.length>0;};
a.prototype.getSceneRef=function(){return this._object3D;};
return a;});
sap.ui.predefine('sap/ui/vk/threejs/ContentManager',["jquery.sap.global","../ContentManager","./Scene","../TransformationMatrix"],function(q,C,S,T){"use strict";
var a=C.extend("sap.ui.vk.threejs.ContentManager",{metadata:{library:"sap.ui.vk"}});
var b=a.getMetadata().getParent().getClass().prototype;var t=function(p,c){return new Promise(function(r,d){var l=new THREE.ObjectLoader();l.load(c.getSource(),function(o){p.add(o);r({node:p,contentResource:c});},function(x){},function(x){d(new Error("Not object json"));});});};
a.prototype.init=function(){if(b.init){b.init.call(this);}};
a.prototype.exit=function(){if(b.exit){b.exit.call(this);}};
function i(n){if(n){var c=[new THREE.Color(0.8,0.8,0.9).multiplyScalar(0.9),new THREE.Color(0.5,0.5,0.5).multiplyScalar(0.4),new THREE.Color(0.8,0.8,0.9).multiplyScalar(0.4),new THREE.Color(0.9,0.9,0.9).multiplyScalar(0.4)];var d=[new THREE.Vector3(0,0,1).normalize(),new THREE.Vector3(-2.0,-1.5,-0.5).normalize(),new THREE.Vector3(2.0,1.1,-2.5).normalize(),new THREE.Vector3(0.04,0.01,2.0).normalize()];var e=new THREE.Group();n.add(e);e.name="DefaultLights";for(var l=0,g=c.length;l<g;l++){var h=new THREE.DirectionalLight();h.color.copy(c[l]);h.position.copy(d[l]);e.add(h);}}}
a.prototype.loadContent=function(c,d){var e=this;var l=function(){e.fireContentChangesStarted();var n=new THREE.Scene(),s=new S(n);i(n);e._loadContentResources(s,d).then(function(v){s._setState(v[0].state);e.fireContentChangesFinished({content:s});},function(r){q.sap.log.error("Failed to load content resources.");e.fireContentChangesFinished({content:null,failureReason:[{error:r,errorMessage:"Failed to load content resources."}]});});};if(window.THREE){l();}else{sap.ui.require(["sap/ui/vk/threejs/thirdparty/three"],function(g){l();});}return this;};
var f=function(c){if(c._contentManagerResolver&&c._contentManagerResolver.settings&&c._contentManagerResolver.settings.loader){return c._contentManagerResolver.settings.loader;}if(c.getSource()){var s=c.getSourceType();if(s==="threejs.test.json"){return t;}return null;}return null;};
a.prototype._loadContentResources=function(s,c){var p=[];c.forEach(function loadContentResource(d,e){var n=new THREE.Group();n.name=e.getName();n.sourceId=e.getSourceId();e._shadowContentResource={nodeProxy:s.getDefaultNodeHierarchy().createNodeProxy(n)};var l=e.getLocalMatrix();if(l){n.applyMatrix(new THREE.Matrix4().fromArray(T.convertTo4x4(l)));}d.add(n);var g=f(e);if(g){p.push(g(n,e));}else{p.push(Promise.resolve({node:n,contentResource:e}));}e.getContentResources().forEach(loadContentResource.bind(this,n));}.bind(this,s.getSceneRef()));return Promise.all(p);};
return a;});
sap.ui.predefine('sap/ui/vk/threejs/NodeHierarchy',["jquery.sap.global","../NodeHierarchy","sap/ui/base/ObjectPool","./BaseNodeProxy","./NodeProxy","../Messages"],function(q,N,O,B,a,M){"use strict";var s={equals:function(c,d){return c===d;},contains:function(c,d){return c.indexOf(d)!==-1;},startsWith:function(c,d){return c.indexOf(d)===0;}};
var b=N.extend("sap.ui.vk.threejs.NodeHierarchy",{
metadata:{publicMethods:["createLayerProxy","createNode","createNodeCopy","createNodeProxy","destroyLayerProxy","destroyNodeProxy","enumerateAncestors","enumerateChildren","findNodesById","findNodesByMetadata","findNodesByName","getAncestors","getChildren","getLayers","getSceneRef","getScene","removeNode"]},
_baseNodeProxyPool:new O(B),
constructor:function(c){N.call(this);this._scene=c;this._nodeProxies=[];}
});
b.prototype.destroy=function(){this._nodeProxies.slice().forEach(this.destroyNodeProxy,this);this._scene=null;N.prototype.destroy.call(this);};
b.prototype.getScene=function(){return this._scene;};
b.prototype.getSceneRef=function(){return this._scene.getSceneRef();};
b.prototype.enumerateChildren=function(n,c,d,p){if(typeof n==="function"){p=d;d=c;c=n;n=undefined;}var e=this.getChildren(n,d);if(p){e.forEach(c);}else{var f=this._baseNodeProxyPool.borrowObject();try{e.forEach(function(n){f.init(this,n);c(f);f.reset();}.bind(this));}finally{this._baseNodeProxyPool.returnObject(f);}}return this;};
b.prototype.enumerateAncestors=function(n,c,p){var d=this.getAncestors(n);if(p){d.forEach(c);}else{var e=this._baseNodeProxyPool.borrowObject();try{d.forEach(function(n){e.init(this,n);c(e);e.reset();}.bind(this));}finally{this._baseNodeProxyPool.returnObject(e);}}return this;};
b.prototype.createNodeProxy=function(n){var c=new a(this,n);this._nodeProxies.push(c);return c;};
b.prototype.destroyNodeProxy=function(n){var i=this._nodeProxies.indexOf(n);if(i>=0){this._nodeProxies.splice(i,1)[0].destroy();}return this;};
b.prototype.getChildren=function(n,c){if(typeof n==="boolean"){c=n;n=undefined;}if(!n){n=this._scene.getSceneRef();}return(c||!n.userData.closed)?n.children.slice():[];};
b.prototype.getAncestors=function(n){var c=[];n.traverseAncestors(function(p){c.unshift(p);});if(c.length>0&&c[c.length-1]===this._scene.getSceneRef()){c.length--;}return c;};
b.prototype.findNodesByName=function(c){var r=[];if(c===undefined||c===null||q.isEmptyObject(c)){this._scene.getSceneRef().children.forEach(function(f){f.traverse(function(o){r.push(o);});});}else{var d=s[c.predicate||"equals"];if(d===undefined){q.sap.log.error(sap.ui.vk.getResourceBundle().getText(M.VIT8.summary),M.VIT8.code,"sap.ui.vk.threejs.NodeHierarchy");}else if(!Array.isArray(c.value)&&typeof c.value!=="string"){q.sap.log.error(sap.ui.vk.getResourceBundle().getText(M.VIT6.summary),M.VIT6.code,"sap.ui.vk.threejs.NodeHierarchy");}else{var e=Array.isArray(c.value)?c.value:[c.value];if(!c.caseSensitive){for(var i in e){e[i]=e[i].toLowerCase();}}this._scene.getSceneRef().children.forEach(function(f){f.traverse(function(o){var n=o.name||"";if(!c.caseSensitive){n=n.toLowerCase();}for(var i in e){if(d(n,e[i])){r.push(o);break;}}});});}}return r;};
b.prototype.createLayerProxy=function(l){return null;};
b.prototype.destroyLayerProxy=function(l){return this;};
b.prototype.getLayers=function(){return[];};
b.prototype.getHotspotNodeIds=function(){return null;};
b.prototype.attachChanged=function(d,f,l){return this.attachEvent("changed",d,f,l);};
b.prototype.detachChanged=function(d,f,l){return this.detachEvent("changed",d,f,l);};
b.prototype.fireChanged=function(p,c,e){return this.fireEvent("changed",p,c,e);};
b.prototype.attachNodeCreated=function(d,f,l){return this.attachEvent("nodeCreated",d,f,l);};
b.prototype.detachNodeCreated=function(d,f,l){return this.detachEvent("nodeCreated",d,f,l);};
b.prototype.fireNodeCreated=function(p,c,e){return this.fireEvent("nodeCreated",p,c,e);};
b.prototype.attachNodeRemoving=function(d,f,l){return this.attachEvent("nodeRemoving",d,f,l);};
b.prototype.detachNodeRemoving=function(d,f,l){return this.detachEvent("nodeRemoving",d,f,l);};
b.prototype.fireNodeRemoving=function(p,c,e){return this.fireEvent("nodeRemoving",p,c,e);};
b.prototype.createNode=function(p,n,i){if(!p){p=this._scene.getSceneRef();}var c=p.children.indexOf(i);var o=new THREE.Group();o.name=n;p.add(o);if(c>=0){p.children.splice(c,0,p.children.pop());}this.fireNodeCreated({nodeRef:o,nodeId:o});this.fireChanged();return o;};
b.prototype.createNodeCopy=function(n,p,c,i){if(!p){p=this._scene.getSceneRef();}var d=p.children.indexOf(i);var e=n.clone(true);e.name=c;p.add(e);if(d>=0){p.children.splice(d,0,p.children.pop());}this.fireNodeCreated({nodeRef:e,nodeId:e});this.fireChanged();return e;};
b.prototype.removeNode=function(n){if(n&&n.parent){this.fireNodeRemoving({nodeRef:n,nodeId:n});n.parent.remove(n);this.fireChanged();}return this;};
return b;});
sap.ui.predefine('sap/ui/vk/threejs/NodeProxy',["jquery.sap.global","../library","../NodeProxy"],function(q,l,N){"use strict";
var a=N.extend("sap.ui.vk.threejs.NodeProxy",{
metadata:{},
constructor:function(n,o){N.call(this);this._object3D=o;}
});
a.prototype.destroy=function(){this._object3D=null;N.prototype.destroy.call(this);};
a.prototype.getNodeRef=function(){return this._object3D;};
a.prototype.getNodeId=function(){return this._object3D;};
a.prototype.getVeIds=function(){return this._object3D.userData.veIds;};
a.prototype.getName=function(){return this._object3D.name||("<"+this._object3D.type+">");};
a.prototype.getLocalMatrix=function(){return sap.ui.vk.TransformationMatrix.convertTo4x3(this._object3D.matrix.elements);};
a.prototype.setLocalMatrix=function(v){if(v){var o=this._object3D;o.matrix.fromArray(sap.ui.vk.TransformationMatrix.convertTo4x4(v));o.matrix.decompose(o.position,o.quaternion,o.scale);o.matrixWorldNeedsUpdate=true;}this.setProperty("localMatrix",v,true);return this;};
a.prototype.getWorldMatrix=function(){return sap.ui.vk.TransformationMatrix.convertTo4x3(this._object3D.matrixWorld.elements);};
a.prototype.setWorldMatrix=function(v){if(v){var o=this._object3D;o.matrixWorld.fromArray(sap.ui.vk.TransformationMatrix.convertTo4x4(v));if(o.parent){o.matrix.multiplyMatrices(new THREE.Matrix4().getInverse(o.parent.matrixWorld),o.matrixWorld);}else{o.matrix.copy(o.matrixWorld);}o.matrix.decompose(o.position,o.quaternion,o.scale);}this.setProperty("worldMatrix",v,true);return this;};
a.prototype.getOpacity=function(){return this._object3D.userData.opacity;};
a.prototype.setOpacity=function(v){this._object3D.userData.opacity=v;this.setProperty("opacity",v,true);return this;};
a.prototype.getTintColorABGR=function(){return this._object3D.userData.tintColor;};
a.prototype.setTintColorABGR=function(v){this._object3D.userData.tintColor=v;this.setProperty("tintColorABGR",v,true);this.setProperty("tintColor",sap.ui.vk.colorToCSSColor(sap.ui.vk.abgrToColor(v)),true);return this;};
a.prototype.getTintColor=function(){return sap.ui.vk.colorToCSSColor(sap.ui.vk.abgrToColor(this._object3D.userData.tintColor));};
a.prototype.setTintColor=function(v){var b=sap.ui.vk.colorToABGR(sap.ui.vk.cssColorToColor(v));this._object3D.userData.tintColor=b;this.setProperty("tintColorABGR",b,true);this.setProperty("tintColor",v,true);return this;};
a.prototype.getNodeMetadata=function(){return this._object3D.userData.metadata;};
a.prototype.getHasChildren=function(){return this._object3D.children.length>0;};
a.prototype.getClosed=function(){return!!this._object3D.userData.closed;};
return a;});
sap.ui.predefine('sap/ui/vk/threejs/Scene',["jquery.sap.global","../Scene","./NodeHierarchy"],function(q,S,N){"use strict";
var a=S.extend("sap.ui.vk.threejs.Scene",{
metadata:{publicMethods:["getDefaultNodeHierarchy","getId","getSceneRef"]},
constructor:function(s){S.call(this);this._id=q.sap.uid();this._scene=s;this._state=null;this._defaultNodeHierarchy=null;}
});
a.prototype.destroy=function(){if(this._defaultNodeHierarchy){this._defaultNodeHierarchy.destroy();this._defaultNodeHierarchy=null;}this._state=null;this._scene=null;S.prototype.destroy.call(this);};
a.prototype.getId=function(){return this._id;};
a.prototype.getDefaultNodeHierarchy=function(){if(!this._defaultNodeHierarchy){this._defaultNodeHierarchy=new N(this);}return this._defaultNodeHierarchy;};
a.prototype.getSceneRef=function(){return this._scene;};
a.prototype._setState=function(s){this._state=s;};
return a;});
sap.ui.predefine('sap/ui/vk/threejs/ViewStateManager',["jquery.sap.global","sap/ui/core/Element","../ContentConnector","../ViewStateManagerBase"],function(q,E,C,V){"use strict";var a;
var b=V.extend("sap.ui.vk.threejs.ViewStateManager",{metadata:{publicMethods:["enumerateSelection","getNodeHierarchy","getOpacity","getSelectionState","getTintColor","getVisibilityChanges","getVisibilityState","setOpacity","setSelectionState","setTintColor","setVisibilityState"]}});
var c=b.getMetadata().getParent().getClass().prototype;
b.prototype.init=function(){if(c.init){c.init.call(this);}this._nodeHierarchy=null;this._nodeStates=new Map();this._selectedNodes=new Set();this._visibilityTracker=new a();this.setHighlightColor("rgba(255, 0, 0, 1.0)");};
b.prototype._onAfterUpdateContentConnector=function(){this._setScene(this._contentConnector.getContent());};
b.prototype._onBeforeClearContentConnector=function(){this._setScene(null);};
b.prototype._handleContentReplaced=function(e){var d=e.getParameter("newContent");this._setScene(d instanceof sap.ui.vk.threejs.Scene?d:null);};
b.prototype._setScene=function(s){this._setNodeHierarchy(s?s.getDefaultNodeHierarchy():null);return this;};
b.prototype._setNodeHierarchy=function(n){var o=this._nodeHierarchy;if(this._nodeHierarchy){this._nodeHierarchy=null;this._nodeStates.clear();this._selectedNodes.clear();this._visibilityTracker.clear();}if(n){this._nodeHierarchy=n;var v=[],h=[];var d=n.findNodesByName();d.forEach(function(e){(e.visible?v:h).push(e);});this.fireVisibilityChanged({visible:v,hidden:h});}if(n!==o){this.fireNodeHierarchyReplaced({oldNodeHierarchy:o,newNodeHierarchy:n});}return this;};
b.prototype.getNodeHierarchy=function(){return this._nodeHierarchy;};
b.prototype.getVisibilityChanges=function(){return this.getShouldTrackVisibilityChanges()?this._visibilityTracker.getInfo(this.getNodeHierarchy()):null;};
b.prototype.getVisibilityComplete=function(){var n=this.getNodeHierarchy(),d=n.findNodesByName(),v=[],h=[];d.forEach(function(e){var f=n.createNodeProxy(e),g=q.grep(f.getVeIds(),function(g){return g.type==="VE_LOCATOR";})[0].fields[0].value;n.destroyNodeProxy(f);if(this.getVisibilityState(e)){v.push(g);}else{h.push(g);}},this);return{visible:v,hidden:h};};
b.prototype.getVisibilityState=function(n){return Array.isArray(n)?n.map(function(d){return d.visible;}):n.visible;};
b.prototype.setVisibilityState=function(n,v,r){if(!Array.isArray(n)){n=[n];}n=(r?this._collectNodesRecursively(n):n).filter(function(e,i,s){return s.indexOf(e)===i;});var d=n.filter(function(e){return e.visible!=v;},this);if(d.length>0){d.forEach(function(e){e.visible=v;},this);if(this.getShouldTrackVisibilityChanges()){d.forEach(this._visibilityTracker.trackNodeRef,this._visibilityTracker);}this.fireVisibilityChanged({visible:v?d:[],hidden:v?[]:d});}return this;};
b.prototype.enumerateSelection=function(d){this._selectedNodes.forEach(d);return this;};
b.prototype.getSelectionState=function(n){var s=this._selectedNodes;function i(d){return s.has(d);}return Array.isArray(n)?n.map(i):i(n);};
b.prototype._applyColor=function(n,d){if(n&&n.material){if(!n.userData.originalMaterial){n.userData.originalMaterial=n.material;}if(n.userData.originalMaterial){n.material=n.userData.originalMaterial.clone();}var e=sap.ui.vk.abgrToColor(d);n.material.color.r=e.red/255.0;n.material.color.g=e.green/255.0;n.material.color.b=e.blue/255.0;n.material.opacity=e.alpha;if(Math.abs(e.alpha-1.0)>0.0001){n.material.transparent=true;}}};
b.prototype._applyOpacity=function(n,o){if(n&&n.material){if(!n.userData.originalMaterial){n.userData.originalMaterial=n.material;}if(n.userData.originalMaterial===n.material){n.material=n.userData.originalMaterial.clone();}n.material.opacity=o;if(Math.abs(o-1.0)>0.0001){n.material.transparent=true;}else{n.material.transparent=false;}}};
b.prototype._resetColor=function(n){if(n&&n.material){if(typeof n.userData.beHighlighted=="undefined"){if(n.userData.tintColorABGR){this._applyColor(n,n.userData.tintColorABGR);}else if(n.userData.originalMaterial){n.material=n.userData.originalMaterial;}}if(n.userData.opacity){this._applyOpacity(n,n.userData.opacity);}else if(n.userData.beHighlighted){this._applyColor(n,this._highlightColorABGR);}}};
b.prototype._isAChild=function(d,n){var e=d.parent;while(e){if(n.has(e)){return true;}e=e.parent;}return false;};
b.prototype._ApplyHighlightingColor=function(n){this._applyColor(n,this._highlightColorABGR);if(n.userData.opacity){this._applyOpacity(n,n.userData.opacity);}n.userData.beHighlighted=true;var d=this._nodeHierarchy.getChildren(n);var e;for(e=0;e<d.length;e++){this._ApplyHighlightingColor(d[e]);}};
b.prototype._RemoveHighlightingColor=function(n){if(!this._selectedNodes.has(n)){delete n.userData.beHighlighted;this._resetColor(n);var d=this._nodeHierarchy.getChildren(n);var e;for(e=0;e<d.length;e++){this._RemoveHighlightingColor(d[e]);}}};
b.prototype.setSelectionState=function(n,s,r){if(!Array.isArray(n)){n=[n];}n=(r?this._collectNodesRecursively(n):n).filter(function(v,i,g){return g.indexOf(v)===i;});var d=n.filter(function(g){return this._selectedNodes.has(g)!==s;},this);if(d.length>0){d.forEach(function(g){this._selectedNodes[s?"add":"delete"](g);},this);var e;var f=[];for(e=0;e<d.length;e++){if(!this._isAChild(d[e],this._selectedNodes)){f.push(d[e]);}}for(e=0;e<f.length;e++){if(s){this._ApplyHighlightingColor(f[e]);}else{this._RemoveHighlightingColor(f[e]);}}this.fireSelectionChanged({selected:s?d:[],unselected:s?[]:d});}return this;};
b.prototype._collectNodesRecursively=function(n){var r=[],t=this;n.forEach(function collectChildNodes(d){r.push(d);t._nodeHierarchy.enumerateChildren(d,collectChildNodes,false,true);});return r;};
b.prototype._getOpacity=function(n){return n.userData&&n.userData.opacity?n.userData.opacity:null;};
b.prototype.getOpacity=function(n){if(Array.isArray(n)){return n.map(this._getOpacity,this);}else{return this._getOpacity(n);}};
b.prototype.setOpacity=function(n,o,r){if(!Array.isArray(n)){n=[n];}n=(r?this._collectNodesRecursively(n):n).filter(function(v,i,s){return s.indexOf(v)===i;});var d=n.filter(function(e){return this._getOpacity(e)!==o;},this);if(d.length>0){d.forEach(function(e){if(o){e.userData.opacity=o;}else{delete e.userData.opacity;}},this);d.forEach(function(e){this._resetColor(e);},this);this.fireOpacityChanged({changed:d,opacity:o});}return this;};
b.prototype._getTintColorABGR=function(n){return n.userData&&n.userData.tintColorABGR?n.userData.tintColorABGR:null;};
b.prototype._getTintColor=function(n){return n.userData&&n.userData.tintColorABGR?sap.ui.vk.colorToCSSColor(sap.ui.vk.abgrToColor(n.userData.tintColorABGR)):null;};
b.prototype.getTintColor=function(n,i){var g=i?"_getTintColorABGR":"_getTintColor";if(Array.isArray(n)){return n.map(this[g],this);}else{return this[g](n);}};
b.prototype.setTintColor=function(n,t,r){if(!Array.isArray(n)){n=[n];}var d=null;switch(typeof t){case"number":d=t;break;case"string":if(sap.ui.core.CSSColor.isValid(t)){d=sap.ui.vk.colorToABGR(sap.ui.vk.cssColorToColor(t));}break;default:t=null;break;}n=(r?this._collectNodesRecursively(n):n).filter(function(v,i,s){return s.indexOf(v)===i;});var e=n.filter(function(f){return this._getTintColorABGR(f)!==d;},this);if(e.length>0){e.forEach(function(f){if(d){f.userData.tintColorABGR=d;}else if(f.userData&&f.userData.tintColorABGR){delete f.userData.tintColorABGR;}},this);e.forEach(function(f){this._resetColor(f);},this);this.fireTintColorChanged({changed:e,tintColor:t,tintColorABGR:d});}return this;};
b.prototype.setHighlightColor=function(d){switch(typeof d){case"number":this._highlightColorABGR=d;break;case"string":if(sap.ui.core.CSSColor.isValid(d)){this._highlightColorABGR=sap.ui.vk.colorToABGR(sap.ui.vk.cssColorToColor(d));}break;default:return this;}if(this._selectedNodes.size>0){this._selectedNodes.forEach(function(e){this._resetColor(e);},this);var s=Array.from(this._selectedNodes);for(var n=0;n<s.length;n++){this._ApplyHighlightingColor(s[n]);}this.fireHighlightColorChanged({highlightColor:sap.ui.vk.colorToCSSColor(sap.ui.vk.abgrToColor(this._highlightColorABGR)),highlightColorABGR:this._highlightColorABGR});}return this;};
b.prototype.getHighlightColor=function(i){return i?this._highlightColorABGR:sap.ui.vk.colorToCSSColor(sap.ui.vk.abgrToColor(this._highlightColorABGR));};
a=function(){this._visibilityChanges=new Set();};
a.prototype.getInfo=function(n){var f=function(v){return v.type==="VE_LOCATOR";};var d=[];this._visibilityChanges.forEach(function(e){var g=n.createNodeProxy(e);var i=g.getVeIds();var v=q.grep(i,f)[0].fields[0].value;n.destroyNodeProxy(g);d.push(v);});return d;};
a.prototype.clear=function(){this._visibilityChanges.clear();};
a.prototype.trackNodeRef=function(n){if(this._visibilityChanges.has(n)){this._visibilityChanges.delete(n);}else{this._visibilityChanges.add(n);}};
C.injectMethodsIntoClass(b);return b;});
sap.ui.predefine('sap/ui/vk/threejs/Viewport',["jquery.sap.global","../library","../ViewportBase","sap/ui/core/ResizeHandler","../Loco","./thirdparty/three","../ContentConnector","../ViewStateManager","./ViewportGestureHandler"],function(q,l,V,R,L,t,C,a,b){"use strict";
var c=V.extend("sap.ui.vk.threejs.Viewport",{metadata:{library:"sap.ui.vk",publicMethods:["setScene","getScene","setCamera","getCamera","getRenderer","hitTest","tap","render"]}});
var d=c.getMetadata().getParent().getClass().prototype;
c.prototype.init=function(){if(d.init){d.init.call(this);}this._resizeListenerId=null;this._renderLoopRequestId=0;this._renderLoopFunction=this._renderLoop.bind(this);var e=1;var f=1;this._renderer=new THREE.WebGLRenderer({antialias:true});this._renderer.setClearColor(0xf0f0f0);this._renderer.setPixelRatio(window.devicePixelRatio);this._renderer.setSize(e,f);var n=1;var g=20000;this._camera=new THREE.OrthographicCamera(e/-2,e/2,f/2,f/-2,n,g);this._camera.position.set(0,0,10000);this._camera.zoom=10;this._viewportGestureHandler=new b(this);this._loco=new L();this._loco.addHandler(this._viewportGestureHandler);};
c.prototype.exit=function(){this._loco.removeHandler(this._viewportGestureHandler);this._viewportGestureHandler.destroy();if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}this._stopRenderLoop();this.setScene(null);this.setCamera(null);this._renderer=null;this._loco=null;this._viewportGestureHandler=null;if(d.exit){d.exit.call(this);}};
c.prototype._startRenderLoop=function(){if(!this._renderLoopRequestId){this._renderLoopRequestId=window.requestAnimationFrame(this._renderLoopFunction);}return this;};
c.prototype._stopRenderLoop=function(){if(this._renderLoopRequestId){window.cancelAnimationFrame(this._renderLoopRequestId);this._renderLoopRequestId=0;}return this;};
c.prototype.onBeforeRendering=function(){if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}this._stopRenderLoop();};
c.prototype.onAfterRendering=function(){var e=this.getDomRef();e.appendChild(this._renderer.domElement);this._resizeListenerId=R.register(this,this._handleResize.bind(this));var f=e.getBoundingClientRect();this._handleResize({size:{width:f.width,height:f.height}});this._startRenderLoop();};
c.prototype._updateCamera=function(w,h){if(!this._camera){return false;}if(this._camera.isPerspectiveCamera){this._camera.aspect=w/h;}else{this._camera.left=w/-2;this._camera.right=w/2;this._camera.top=h/2;this._camera.bottom=h/-2;}this._camera.updateProjectionMatrix();return true;};
c.prototype._handleResize=function(e){if(!this._camera||!this._renderer){return false;}var w=e.size.width;var h=e.size.height;this._updateCamera(w,h);this._renderer.setSize(w,h);this.fireResize({size:{width:w,height:h}});return true;};
c.prototype.setScene=function(s){this._scene=s;var n=this._scene?this._scene.getSceneRef():undefined;if(n){var g;for(var i=0;i<n.children.length;i++){g=n.children[i];if(g.name==="DefaultLights"&&g.children.length){if(g.children[0]instanceof THREE.DirectionalLight){this._eyePointLight=g.children[0];}}}}};
c.prototype.getScene=function(){return this._scene;};
c.prototype.setCamera=function(e){this._camera=e;var f=window.devicePixelRatio||1;if(this._camera&&this._renderer){this._updateCamera(this._renderer.domElement.width*f,this._renderer.domElement.height*f);}};
c.prototype.getCamera=function(){return this._camera;};
c.prototype.getRenderer=function(){return this._renderer;};
c.prototype.hitTest=function(x,y){var n=this._scene?this._scene.getSceneRef():undefined;if(!this._camera||!n){return null;}var e=this._renderer.domElement;var m=new THREE.Vector2((x-e.offsetLeft)/e.width*2-1,(e.offsetTop-y)/e.height*2+1);var f=new THREE.Raycaster();f.setFromCamera(m,this._camera);var i=f.intersectObjects(n.children,true);if(i&&i.length){return i[0];}return null;};
c.prototype.tap=function(x,y,i){if(!i){if(this._viewStateManager){var h=this.hitTest(x,y);var n=h&&h.object;var e={picked:n?[n]:[]};this.fireNodesPicked(e);if(this.getSelectionMode()===sap.ui.vk.SelectionMode.Exclusive){this.exclusiveSelectionHandler(e.picked);}else if(this.getSelectionMode()===sap.ui.vk.SelectionMode.Sticky){this.stickySelectionHandler(e.picked);}}}else{}return this;};
var o={x:-2,y:-2};var r=2;var p=5;[{key:"left",dx:-r,dy:0},{key:"right",dx:+r,dy:0},{key:"up",dx:0,dy:-r},{key:"down",dx:0,dy:+r}].forEach(function(i){c.prototype["onsap"+i.key]=function(e){var f=this._viewportGestureHandler._cameraController;f.beginGesture(o.x,o.y);f.rotate(i.dx,i.dy,true);f.endGesture();e.preventDefault();e.stopPropagation();};});[{key:"left",dx:-p,dy:0},{key:"right",dx:+p,dy:0},{key:"up",dx:0,dy:-p},{key:"down",dx:0,dy:+p}].forEach(function(i){c.prototype["onsap"+i.key+"modifiers"]=function(e){if(e.shiftKey&&!(e.ctrlKey||e.altKey||e.metaKey)){var f=this._viewportGestureHandler._cameraController;f.beginGesture(o.x,o.y);f.pan(i.dx,i.dy);f.endGesture();e.preventDefault();e.stopPropagation();}};});[{key:"minus",d:0.98},{key:"plus",d:1.02}].forEach(function(i){V.prototype["onsap"+i.key]=function(e){var f=this._viewportGestureHandler._cameraController;f.beginGesture(this.$().width()/2,this.$().height()/2);f.zoom(i.d);f.endGesture();e.preventDefault();e.stopPropagation();};});c.prototype._handleVisibilityChanged=c.prototype._handleSelectionChanged=c.prototype._handleOpacityChanged=c.prototype._handleTintColorChanged=c.prototype._handleHighlightColorChanged=function(e){this.render();};
c.prototype._renderLoop=function(){if(!this._renderer||!this.getDomRef()){this._renderLoopRequestId=0;return;}if(this._viewportGestureHandler){this._viewportGestureHandler.update();}if(this._eyePointLight&&this._camera){this._eyePointLight.position.copy(this._camera.position);this._eyePointLight.position.normalize();}this.render();this._renderLoopRequestId=window.requestAnimationFrame(this._renderLoopFunction);};
c.prototype.render=function(){var n=this._scene?this._scene.getSceneRef():undefined;if(!n||!this._camera||!this._renderer){return;}this._renderer.render(n,this._camera);};
c.prototype._onAfterUpdateContentConnector=function(){this.setScene(this._contentConnector.getContent());};
c.prototype._onBeforeClearContentConnector=function(){this.setScene(null);};
c.prototype._handleContentReplaced=function(e){var f=e.getParameter("newContent");if(!(f instanceof sap.ui.vk.threejs.Scene)){f=null;}this.setScene(f);};
c.prototype._onAfterUpdateViewStateManager=function(){};
c.prototype._onBeforeClearViewStateManager=function(){};
C.injectMethodsIntoClass(c);a.injectMethodsIntoClass(c);return c;});
sap.ui.predefine('sap/ui/vk/threejs/ViewportGestureHandler',["jquery.sap.global","sap/ui/base/EventProvider","sap/ui/core/ResizeHandler","./thirdparty/three"],function(q,E,R,t){"use strict";
var V=E.extend("sap.ui.vk.threejs.ViewportGestureHandler",{
metadata:{publicMethods:["beginGesture","move","endGesture","click","doubleClick","contextMenu","getViewport","update"]},
constructor:function(a){this._viewport=a;this._rect=null;this._evt={x:0,y:0,z:0,d:0,initd:0};this._gesture=false;this._viewport.attachEvent("resize",this,this._onresize);this._nomenu=false;var T=function(b){var c=b;var g=new THREE.Vector3();var d=new THREE.Vector2();var o=false;var A=0.001;var M=-Math.PI/2+A;var e=Math.PI/2-A;var s=new THREE.Spherical();var f=new THREE.Vector3();this.isTurnTableMode=true;function h(r){var k=new THREE.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);var n=new THREE.Vector3(Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE);r.traverse(function(u){if(u instanceof THREE.Mesh){var p=new THREE.Vector3();p.applyMatrix4(u.matrixWorld);k.x=Math.min(k.x,p.x);k.y=Math.min(k.y,p.y);k.z=Math.min(k.z,p.z);n.x=Math.max(n.x,p.x);n.y=Math.max(n.y,p.y);n.z=Math.max(n.z,p.z);}});return k.add(n).multiplyScalar(0.5);}this.beginGesture=function(x,y){var k=c.getRenderer().domElement;var n=c.getScene().getSceneRef();var p=c.getCamera();var r=(x-k.offsetLeft)/k.width*2-1;var u=(k.offsetTop-y)/k.height*2+1;d.x=r;d.y=u;var v=c.hitTest(x,y,n,p);if(v){g.copy(v.point);o=true;}else{g=h(n);o=false;}};this.endGesture=function(){o=false;};function i(k,n){var v=new THREE.Vector3();v.setFromMatrixColumn(n,0);v.multiplyScalar(-k);return v;}function j(k,n){var v=new THREE.Vector3();v.setFromMatrixColumn(n,1);v.multiplyScalar(k);return v;}this.pan=function(n,p){if(n===0&&p===0){return;}var r=c.getCamera();var u=new THREE.Vector3().copy(g);var v=c.getRenderer().domElement;var w=v.height/2;if(r.isPerspectiveCamera){var x=new THREE.Vector3().subVectors(r.position,u).length();var y=r.fov/180*Math.PI/2;var k=w/Math.tan(y);n=n*x/k;p=p*x/k;}else if(r.isOrthographicCamera){n=n/r.zoom;p=p/r.zoom;}else{q.sap.log.error("threejs.ViewportGestureHandler: unsupported camera type");}f.add(i(n,r.matrix));f.add(j(p,r.matrix));};this.rotate=function(k,n){if(k===0&&n===0){return;}s.theta-=(k*0.01);s.phi+=(n*0.01);};this.zoom=function(z){if(z===0||z===1){return;}var k=c.getCamera();var n=new THREE.Vector3();var p,r;if(k.isPerspectiveCamera){if(o){p=new THREE.Vector3(d.x,d.y,-1).unproject(k);r=new THREE.Vector3(d.x,d.y,1).unproject(k);r.sub(p);n.copy(r);}else{n.copy(k.getWorldDirection());}var u=new THREE.Vector3().copy(g).sub(k.position);var v=u.length();n.normalize();n.multiplyScalar(v);n.multiplyScalar(1-1/z);}else if(k.isOrthographicCamera){if(o){p=new THREE.Vector3(0,0,1).unproject(k);r=new THREE.Vector3(d.x,d.y,1).unproject(k);r.sub(p);n.copy(r);}n.multiplyScalar(1-1/z);k.zoom*=z;k.updateProjectionMatrix();}else{q.sap.log.error("threejs.ViewportGestureHandler: unsupported camera type");}f.add(n);};function l(k,p){var n=Math.sin(k);var r=Math.cos(k);var u=Math.sin(p);var v=Math.cos(p);var z=r*v;var x=n*v;var y=u;return new THREE.Vector3(x,y,z);}function m(n,k,p){return Math.max(k,Math.min(n,p));}this.update=function(){var k=c.getCamera();if(k){var r=new THREE.Vector3().copy(g);var n=new THREE.Vector3().copy(k.position);n.sub(r);var p=k.getWorldDirection();p.normalize();var u=new THREE.Vector3().copy(k.up);if(this.isTurnTableMode){var y=new THREE.Vector3(0,1,0);var v=Math.atan2(p.x,p.z)+Math.PI/2;var w=l(v,0);w.normalize();var x=Math.atan2(p.y,Math.sqrt(p.x*p.x+p.z*p.z));var z=new THREE.Quaternion();z.setFromAxisAngle(y,s.theta);var B=new THREE.Quaternion();B.setFromAxisAngle(w,m(s.phi,M+x,e+x));u.copy(p).cross(w);u.normalize();z.multiply(B);n.applyQuaternion(z);p.applyQuaternion(z);u.applyQuaternion(z);}else{var C=new THREE.Vector3().crossVectors(u,p);C.normalize();var D=new THREE.Quaternion();D.setFromAxisAngle(u,s.theta);var F=new THREE.Quaternion();F.setFromAxisAngle(C,s.phi);D.multiply(F);n.applyQuaternion(D);p.applyQuaternion(D);u.applyQuaternion(D);p.normalize();u.normalize();}n.add(r);var G=n.clone();G.add(p);k.position.copy(n);k.up.copy(u);k.lookAt(G);k.position.add(f);s.set(0,0,0);f.set(0,0,0);k.updateMatrix();k.updateProjectionMatrix();}};};this._cameraController=new T(a);}
});
V.prototype.destroy=function(){this._viewport=null;this._rect=null;this._evt=null;this._gesture=false;};
V.prototype._getOffset=function(o){var r=o.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};
V.prototype._inside=function(e){if(this._rect==null||true){var i=this._viewport.getIdForLabel();var d=document.getElementById(i);if(d==null){return false;}var o=this._getOffset(d);this._rect={x:o.x,y:o.y,w:d.offsetWidth,h:d.offsetHeight};}return(e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h);};
V.prototype._onresize=function(e){this._gesture=false;this._rect=null;};
V.prototype.beginGesture=function(a){if(this._inside(a)&&!this._gesture){this._gesture=true;var x=a.x-this._rect.x,y=a.y-this._rect.y;this._evt.x=x;this._evt.y=y;this._evt.d=a.d;this._evt.initd=a.d;this._evt.avgd=a.d;this._evt.avgx=0;this._evt.avgy=0;q.sap.log.debug("Loco: beginGesture: "+x+", "+y);this._cameraController.beginGesture(x,y);a.handled=true;if(document.activeElement){try{document.activeElement.blur();}catch(e){}}var d=document.getElementById(this._viewport.getIdForLabel());d.focus();}this._nomenu=false;};
V.prototype.move=function(e){if(this._gesture){var x=e.x-this._rect.x,y=e.y-this._rect.y;var d=x-this._evt.x;var a=y-this._evt.y;var b=e.d-this._evt.d;this._evt.x=x;this._evt.y=y;this._evt.d=e.d;this._evt.avgx=this._evt.avgx*0.99+d*0.01;this._evt.avgy=this._evt.avgy*0.99+a*0.01;var z=1.0;if(this._evt.initd>0){z=1.0+b*(1.0/this._evt.initd);}else if(e.n==2){if(e.points[0].y>e.points[1].y){z=1.0-b*0.005;if(z<0.333){z=0.333;}}else{z=1.0+b*0.005;if(z>3){z=3;}}}if(this._evt.initd>0){var c=Math.sqrt(this._evt.avgx*this._evt.avgx+this._evt.avgy*this._evt.avgy);q.sap.log.debug("AvgDist: "+c);if((Math.abs(e.d-this._evt.avgd)/this._evt.avgd)<(c/10)){z=1.0;}}this._evt.avgd=this._evt.avgd*0.97+e.d*0.03;switch(e.n){case 1:q.sap.log.debug("Loco: Rotate: "+(d)+", "+(a));this._cameraController.rotate(d,a);break;case 2:q.sap.log.debug("Loco: Pan: "+(d)+", "+(a));if(z!=0&&z!=1.0){q.sap.log.debug("Loco: Zoom: "+(z));}this._cameraController.pan(d,a);if(d<10&&a<10&&z!=0&&z!=1.0){this._cameraController.zoom(z);}break;default:break;}this._nomenu=true;e.handled=true;}};
V.prototype.endGesture=function(e){if(this._gesture){var x=e.x-this._rect.x,y=e.y-this._rect.y;q.sap.log.debug("Loco: endGesture: "+x+", "+y);this._cameraController.endGesture();this._gesture=false;e.handled=true;}};
V.prototype.click=function(e){if(this._inside(e)&&e.buttons<=1){var x=e.x-this._rect.x,y=e.y-this._rect.y;q.sap.log.debug("Loco: click: "+(x)+", "+(y));if(this._viewport){this._viewport.tap(x,y,false);}e.handled=true;}};
V.prototype.doubleClick=function(e){if(this._inside(e)&&e.buttons<=1){var x=e.x-this._rect.x,y=e.y-this._rect.y;q.sap.log.debug("Loco: doubleClick: "+(x)+", "+(y));e.handled=true;}};
V.prototype.contextMenu=function(e){if(this._inside(e)||this._nomenu||e.buttons==5){this._nomenu=false;e.handled=true;}};
V.prototype.keyEventHandler=function(e){};
V.prototype.getViewport=function(){return this._viewport;};
V.prototype.update=function(){this._cameraController.update();};
return V;},true);
sap.ui.predefine('sap/ui/vk/threejs/ViewportRenderer',["jquery.sap.global"],function(q){"use strict";var V={};
V.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapVizKitViewport");r.writeClasses();r.writeAttribute("tabindex",0);r.addStyle("width",c.getWidth());r.addStyle("height",c.getHeight());r.writeStyles();r.write(">");r.write("</div>");};
return V;},true);
jQuery.sap.registerPreloadedModules({
"name":"sap/ui/vk/library-preload",
"version":"2.0",
"modules":{
	"sap/ui/vk/manifest.json":'{\n  "_version": "1.2.0",\n  "sap.app": {\n    "_version": "1.2.0",\n    "id": "sap.ui.vk",\n    "type": "library",\n    "embeds": [],\n    "applicationVersion": {\n      "version": "1.50.7"\n    },\n    "title": "SAPUI5 Visualization Toolkit.",\n    "description": "SAPUI5 Visualization Toolkit.",\n    "resources": "resources.json",\n    "offline": true\n  },\n  "sap.ui": {\n    "_version": "1.1.0",\n    "technology": "UI5",\n    "supportedThemes": [\n      "base",\n      "sap_belize",\n      "sap_belize_plus",\n      "sap_bluecrystal",\n      "sap_hcb"\n    ]\n  },\n  "sap.ui5": {\n    "_version": "1.1.0",\n    "dependencies": {\n      "minUI5Version": "1.50",\n      "libs": {\n        "sap.ui.core": {\n          "minVersion": "1.50.0"\n        },\n        "sap.ui.unified": {\n          "minVersion": "1.50.0",\n          "lazy": true\n        },\n        "sap.m": {\n          "minVersion": "1.50.0",\n          "lazy": true\n        },\n        "sap.ui.layout": {\n          "minVersion": "1.50.0",\n          "lazy": true\n        }\n      }\n    }\n  }\n}'
}});
//# sourceMappingURL=library-preload.js.map