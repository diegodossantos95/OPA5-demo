/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["jquery.sap.global","./library","sap/ui/core/Control","./Messages"],function(q,l,C,M){"use strict";var N=C.extend("sap.ui.vk.Notifications",{metadata:{library:"sap.ui.vk",publicMethods:["clearAllMessages"],aggregations:{_messagePopover:{type:"sap.m.MessagePopover",multiple:false,visibility:"hidden"},_messagePopoverToggleButton:{type:"sap.m.ToggleButton",multiple:false,visibility:"hidden"}},events:{allMessagesCleared:{},messageAdded:{}}}});N.prototype.init=function(){if(C.prototype.init){C.prototype.init.call(this);}var m;var a=new sap.m.ToggleButton({icon:"sap-icon://message-popup",type:sap.m.ButtonType.Emphasized,tooltip:sap.ui.vk.getResourceBundle().getText("MESSAGEPOPOVERBUTTON"),text:"0",press:function(e){if(a.getPressed()){m.openBy(a);}else{m.close();}}});a.addStyleClass("messagePopoverButton");this.setAggregation("_messagePopoverToggleButton",a);m=new sap.m.MessagePopover({headerButton:new sap.m.Button({text:sap.ui.vk.getResourceBundle().getText("MESSAGEPOPOVER_CLEARBUTTON"),type:sap.m.ButtonType.Emphasized,tooltip:sap.ui.vk.getResourceBundle().getText("MESSAGEPOPOVER_CLEARBUTTON"),press:function(e){m.getParent().clearAllMessages();}}),afterClose:a.setPressed.bind(a,false)});m.addStyleClass("sapVizKitNotificationPopover");this.setAggregation("_messagePopover",m);q.sap.log.addLogListener(this);};N.prototype.exit=function(){q.sap.log.removeLogListener(this);if(C.prototype.exit){C.prototype.exit.call(this);}};N.prototype.onLogEntry=function(e){if(/^sap\.ui\.vk/.test(e.component)){var m=e.details,c,r,a;if(M[e.details]){m=sap.ui.vk.getResourceBundle().getText(M[e.details].summary);c=sap.ui.vk.getResourceBundle().getText(M[e.details].cause);r=sap.ui.vk.getResourceBundle().getText(M[e.details].resolution);a=sap.ui.vk.getResourceBundle().getText("ERROR_DESCRIPTION_CODE");}var b=sap.ui.vk.getResourceBundle().getText("ERROR_DESCRIPTION_COMPONENT");var d=sap.ui.vk.getResourceBundle().getText("ERROR_DESCRIPTION_DATE");var t=sap.ui.vk.getResourceBundle().getText("ERROR_DESCRIPTION_TIME");var f=sap.ui.vk.getResourceBundle().getText("ERROR_DESCRIPTION_LEVEL");var g=sap.ui.vk.getResourceBundle().getText("ERROR_DESCRIPTION_MESSAGE");var h=sap.ui.vk.getResourceBundle().getText("ERROR_DESCRIPTION_CAUSE");var i=sap.ui.vk.getResourceBundle().getText("ERROR_DESCRIPTION_RESOLUTION");var j="<div><b>"+b+":</b><br>"+e.component+"</div><br>"+"<div><b>"+d+":</b><br>"+e.date+"</div><br>"+(a?"<div><b>"+a+":</b><br>"+e.details+"</div><br>":"")+"<div><b>"+t+":</b><br>"+e.time.slice(0,e.time.indexOf("."))+"</div><br>"+"<div><b>"+f+":</b><br>"+e.level+"</div><br>"+"<div><b>"+g+":</b><br>"+m+"</div><br>"+(c?"<div><b>"+h+":</b><br>"+c+"</div><br>":"")+(r?"<div><b>"+i+":</b><br>"+r+"</div>":"");var k=new sap.m.MessagePopoverItem({markupDescription:true,title:e.message,description:j});var n=this.getAggregation("_messagePopover");n.addItem(k);this.getAggregation("_messagePopoverToggleButton").setText(n.getItems().length);this.fireMessageAdded();}};N.prototype.clearAllMessages=function(){var m=this.getAggregation("_messagePopover");m.removeAllItems();m.close();this.getAggregation("_messagePopoverToggleButton").setText(m.getItems().length);this.fireAllMessagesCleared();return this;};return N;});
