sap.ui.define(["jquery.sap.global","./library","sap/ui/core/Control","./DockContainer","./DockPane","./Loco","sap/ui/core/ResizeHandler"],function(q,l,C,D,a,L,R){"use strict";var b=C.extend("sap.ui.vk.DockManager",{metadata:{library:"sap.ui.vk",publicMethods:["getDomElement","addDockPane","removeDockPane","addDockContainer","removeDockContainer","dock","undock","bringToFront","beginGesture","move","endGesture","resize"],properties:{width:{type:"sap.ui.core.CSSSize",defaultValue:"auto"},height:{type:"sap.ui.core.CSSSize",defaultValue:"auto"}}}});b.prototype.init=function(){if(typeof b._counter=="undefined"){b._counter=0;}this._id="DockManager_"+b._counter;b._counter++;var e=document.createElement("div");e.setAttribute("id",this._id);e.style.width="100%";e.style.height="100%";e.style.overflow="hidden";e.style.position="relative";e.style.backgroundColor="blue";this._elem=e;this._root=null;this._panes=[];this._containers=[];this._dockIcons=null;this._gesture=false;this._oPane=null;this._oParent=null;this._oDir=null;this._oContainer=null;this._oResize=null;this._oResizeDir=0;this._oIsTab=false;this._rendered=false;this._loco=new L();this._loco.addHandler(this);};b.prototype.exit=function(){this._loco.removeHandler(this._viewportHandler);if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}};b.prototype.isRendered=function(){return this._rendered;};b.prototype.alwaysOnTop=function(){this._loco=new L();this._loco.removeHandler(this);this._loco.addHandler(this);};b.prototype.onBeforeRendering=function(){if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}this._rendered=false;};b.prototype.onAfterRendering=function(){var d=document.getElementById(this.getId());d.appendChild(this._elem);this._resizeListenerId=R.register(this,this._handleResize.bind(this));this._handleResize({size:{width:d.clientWidth,height:d.clientHeight}});this._rendered=true;var c=this._panes.length;for(var i=0;i<c;i++){this._panes[i].renderContent();}};b.prototype._handleResize=function(e){this.resize(e.size.width,e.size.height);};b.prototype._setRect=function(e,x,y,w,h){e.style.left=x+"px";e.style.top=y+"px";if(w!=null){e.style.width=w+"px";}if(h!=null){e.style.height=h+"px";}};b.prototype.getDomElement=function(){return this._elem;};b.prototype._getBounding=function(o,c){var d=o.getBoundingClientRect();var p={x:d.left,y:d.top,w:o.offsetWidth,h:o.offsetHeight};if(c!==undefined){var r=c.getBoundingClientRect();p.x-=r.left;p.y-=r.top;}return p;};b.prototype._isInside=function(c,x,y){return(x>=c.x&&x<=c.x+c.w&&y>=c.y&&y<=c.y+c.h);};b.prototype._createDockIcon=function(i,x,y,h){var d=document.createElement("div");d.setAttribute("id",this._id+"_dockIcon_"+i);d.style.position="absolute";this._setRect(d,x,y,48,48);d.style.backgroundColor="white";d.style.border="1px solid darkgrey";d.style.opacity=0.9;d.style.cursor="default";d.style.zIndex=100;d.pointerEvents="none";if(h){d.style.display="none";}this._dockIcons.push(d);this._elem.appendChild(d);};b.prototype._showDockIconsAt=function(e,c,h,d){var p=this._getBounding(e,this._elem);if(c){var f={x:p.x+p.w/2-24,y:p.y+p.h/2-24};if(f.x<110){f.x=110;}else if(f.x>this._elem.offsetWidth-158){f.x=this._elem.offsetWidth-158;}if(f.y<110){f.y=110;}else if(f.y>this._elem.offsetHeight-158){f.y=this._elem.offsetHeight-158;}this._createDockIcon("center",f.x,f.y,h);this._createDockIcon("top",f.x,f.y-49,d);this._createDockIcon("right",f.x+49,f.y,d);this._createDockIcon("bottom",f.x,f.y+49,d);this._createDockIcon("left",f.x-49,f.y,d);}else{this._createDockIcon("root_top",p.x+p.w/2-24,p.y+8);this._createDockIcon("root_right",p.x+p.w-48-8,p.y+p.h/2-24);this._createDockIcon("root_bottom",p.x+p.w/2-24,p.y+p.h-48-8);this._createDockIcon("root_left",p.x+8,p.y+p.h/2-24);}};b.prototype._showDockShadow=function(e,d){var c=this._dockShadow;if(c==null){c=document.createElement("div");c.setAttribute("id",this._id+"_dockShadow");c.style.position="absolute";c.style.backgroundColor="blue";c.style.opacity=0.3;c.style.zIndex=90;c.style.cursor="default";c.pointerEvents="none";this._elem.appendChild(c);this._dockShadow=c;}var p=e?this._getBounding(e,this._elem):{};var w=(p.w>480)?240:(p.w/2);var h=(p.h>320)?160:(p.h/2);switch(d){case 0:this._setRect(c,p.x,p.y,p.w,p.h);break;case 1:this._setRect(c,p.x,p.y,p.w,h);break;case 2:this._setRect(c,p.x+(p.w-w),p.y,w,p.h);break;case 3:this._setRect(c,p.x,p.y+p.h-h,p.w,h);break;case 4:this._setRect(c,p.x,p.y,w,p.h);break;default:c.style.visibility="hidden";return;}c.style.visibility="visible";};b.prototype._showDockIcons=function(s){if(s){if(this._dockIcons==null||this._dockParent!=this._dockParentCurr){this._showDockIcons(false);this._dockIcons=[];this._showDockIconsAt(this._elem);if(this._dockParent!=null&&this._containers.length>1){this._showDockIconsAt(this._dockParent._elem,true,!this._dockParent._movable,this._dockParent._parent==null);}this._dockParentCurr=this._dockParent;}}else if(!s&&this._dockIcons!=null){for(var i in this._dockIcons){this._elem.removeChild(this._dockIcons[i]);}this._dockIcons=null;}};b.prototype.addDockPane=function(d){this._panes.push(d);this._elem.appendChild(d._elem);this._updateZIndex();};b.prototype.removeDockPane=function(d){var i=this._panes.indexOf(d);if(i>-1){this._panes.splice(i,1);this._elem.removeChild(d._elem);}else{q.sap.log.error("DockManager.removeDockPane failed, element does not exist - "+d._id);}this._updateZIndex();};b.prototype.addDockContainer=function(p,d,i){this._containers.push(d);if(p){if(p._left!=null){var o;if(i==0){o=p._left;d._elem.style.width=o._elem.offsetWidth+"px";d._elem.style.height=o._elem.offsetHeight+"px";p._elem.removeChild(o._elem);if(p._right){p._elem.insertBefore(d._elem,p._right._elem);}else{p._elem.appendChild(d._elem);}p._left=d;o._parent=d;d._left=o;d._elem.appendChild(o._elem);}else if(i==1){o=p._right;d._elem.style.width=o._elem.offsetWidth+"px";d._elem.style.height=o._elem.offsetHeight+"px";p._elem.removeChild(o._elem);p._elem.appendChild(d._elem);p._right=d;o._parent=d;d._left=o;d._elem.appendChild(o._elem);}p.update();}else{p.addChild(d,0);}}else{this._root=d;this._elem.appendChild(d._elem);d.resize(this._elem.offsetWidth,this._elem.offsetHeight);}};b.prototype.removeDockContainer=function(d){var i=this._containers.indexOf(d);if(i>-1){this._containers.splice(i,1);}else{q.sap.log.error("DockManager.removeDockContainer failed, element does not exist - "+d._id);}};b.prototype._dock=function(d,c,e){if(d._parent!=null){this.undock(d);}var i=0;if(e==2||e==3){i=1;}d._parent=c;if(d._saveSize){d._saveSize();}c.setOrientation((e==1||e==3)?0:1);c.addChild(d,i);};b.prototype.dock=function(d,p,c){if(d._parent!=null){this.undock(d);}if(p==null){var o=this._root;this._elem.removeChild(o._elem);p=new D(this,null);this._dock(o,p,1);this._dock(d,p,c);}else if(c==0){p.addTab(d);}else{var e=p._parent;var i=(e._left==p)?0:1;var f=new D(this,e,i);this._dock(d,f,c);}};b.prototype.undock=function(d,i){if(d._tabParent!=null){d._tabParent.removeTab(d);return;}else if(i&&d._tabs.length>0){d.removeTab(d);return;}var p=d._parent;if(p==null){q.sap.log.error("DockManager::undock: cannot undock a floating DockPane - "+d._id);return;}if(p._left&&p._right){var o=null;if(p._left==d){o=p._right;}else if(p._right==d){o=p._left;}else{q.sap.log.error("DockManager::undock: internal error, tree mis-match - "+this._id);}p.removeChild(1);p.removeChild(0);var c=p._parent;if(c){if(c._left==p){c._elem.removeChild(p._elem);if(c._right){c._elem.insertBefore(o._elem,c._right._elem);}else{c._elem.appendChild(o._elem);}c._left=o;o._parent=c;}else if(c._right==p){c._elem.removeChild(p._elem);c._elem.appendChild(o._elem);c._right=o;o._parent=c;}c.update();}else if(this._root==p){this._elem.removeChild(p._elem);this._elem.appendChild(o._elem);this._root=o;o._parent=null;o._elem.style.left=0;o._elem.style.top=0;o.resize(this._elem.offsetWidth,this._elem.offsetHeight);o.update();}this.removeDockContainer(p);d._parent=null;this._elem.appendChild(d._elem);d._restoreSize();d.update();}};b.prototype.bringToFront=function(d){if(d._parent==null){var i=this._panes.indexOf(d);if(i>-1){this._panes.splice(i,1);this._panes.push(d);this._updateZIndex();}}};b.prototype._updateZIndex=function(){var c=this._panes.length;for(var i=0;i<c;i++){this._panes[i]._elem.style.zIndex=50+i;}};b.prototype._tabBoxGesture=function(d,e){if(d._tabs.length>0){var t=this._getBounding(d._tabBox);if(this._isInside(t,e.x,e.y)){var c=d._tabs.length+1;var i=Math.floor((e.x-t.x)/(d._elem.offsetWidth-2)*c);if(i>d._tabs.length){i=d._tabs.length;}var f=(i==0)?d:d._tabs[i-1];d.bringTabToFront(f);this._oPane=f;this._snapX=this._ox;this._snapY=this._oy;this._snapRect=this._getBounding(d._elem);return true;}}return false;};b.prototype.beginGesture=function(c){var e=c;if(e.n==1&&!this._gesture){this._ox=e.x;this._oy=e.y;this._oIsTab=false;if(this._isInside(this._getBounding(this._elem),e.x,e.y)){this._dockParent=null;var i,d;for(i=this._panes.length-1;i>=0;i--){d=this._panes[i];if(d._parent!=null&&this._isInside(this._getBounding(d._elem),e.x,e.y)){this._dockParent=d;break;}}var f=false;for(i=this._panes.length-1;i>=0;i--){d=this._panes[i];if(d._parent==null&&d._movable){var g=this._getBounding(d._elem);if(this._isInside(g,e.x,e.y)){this.bringToFront(d);var h={x:g.x+8,y:g.y+8,w:g.w-16,h:g.h-16};if(!this._isInside(h,e.x,e.y)){this._oResize=d;if(e.x<=h.x){if(e.y<=h.y){this._oResizeDir=5;}else if(e.y>=h.y+h.h){this._oResizeDir=8;}else{this._oResizeDir=4;}}else if(e.x>=h.x+h.w){if(e.y<=h.y){this._oResizeDir=6;}else if(e.y>=h.y+h.h){this._oResizeDir=7;}else{this._oResizeDir=2;}}else if(e.y<=h.y){this._oResizeDir=1;}else if(e.y>=h.y+h.h){this._oResizeDir=3;}else{this._oResizeDir=0;}f=true;break;}if(this._isInside(this._getBounding(d._title),e.x,e.y)){if(this._isInside(this._getBounding(d._btnClose),e.x,e.y)){f=true;d.close();}else{f=true;this._oPane=d;this._showDockIcons(true);}break;}this._oIsTab=this._tabBoxGesture(d,e);if(this._oIsTab){f=true;}break;}}}if(!f){for(i=0;i<this._containers.length;i++){var j=this._containers[i];if(j._right!=null&&this._isInside(this._getBounding(j._splitter),e.x,e.y)){this._oContainer=j;this._oContainer._splitter.style.opacity=0.3;this._snapX=this._ox;this._snapY=this._oy;f=true;break;}}}if(!f){for(i=this._panes.length-1;i>=0;i--){d=this._panes[i];if(d._parent!=null&&d._movable&&this._isInside(this._getBounding(d._title),e.x,e.y)){if(this._isInside(this._getBounding(d._btnClose),e.x,e.y)){d.close();}else{this._oPane=d;this._snapX=this._ox;this._snapY=this._oy;this._snapRect=this._getBounding(d._elem);}f=true;break;}this._oIsTab=this._tabBoxGesture(d,e);if(this._oIsTab){f=true;break;}}}c.handled=f;this._gesture=f;}}};b.prototype.move=function(c){var e=c;if(e.n==1&&this._gesture){var d=e.x-this._ox;var f=e.y-this._oy;this._ox=e.x;this._oy=e.y;var g,x,y;if(this._oResize){g=this._oResize;var o=this._oResizeDir;x=g._elem.offsetLeft;y=g._elem.offsetTop;var w=g._elem.offsetWidth;var h=g._elem.offsetHeight;var m=g.getMinimumWidth();var j=g.getMinimumHeight();switch(o){case 1:if(h-f>=j){g._elem.style.top=(y+f)+"px";g.resize(w,h-f);}break;case 2:if(w+d>=m){g.resize(w+d,h);}break;case 3:if(h+f>=j){g.resize(w,h+f);}break;case 4:if(w-d>=m){g._elem.style.left=(x+d)+"px";g.resize(w-d,h);}break;case 5:if(w-d>=m&&h-f>=j){g._elem.style.top=(y+f)+"px";g._elem.style.left=(x+d)+"px";g.resize(w-d,h-f);}else if(w-d>m){g._elem.style.left=(x+d)+"px";g.resize(w-d,h);}else if(h-f>j){g._elem.style.top=(y+f)+"px";g.resize(w,h-f);}break;case 6:if(w+d>=m&&h-f>=j){g._elem.style.top=(y+f)+"px";g.resize(w+d,h-f);}else if(w+d>=m){g.resize(w+d,h);}else if(h-f>=j){g._elem.style.top=(y+f)+"px";g.resize(w,h-f);}break;case 7:if(w+d>=m&&h+f>=j){g.resize(w+d,h+f);}else if(w+d>=m){g.resize(w+d,h);}else if(h+f>=j){g.resize(w,h+f);}break;case 8:if(w-d>=m&&h+f>=j){g._elem.style.left=(x+d)+"px";g.resize(w-d,h+f);}else if(w-d>=m){g._elem.style.left=(x+d)+"px";g.resize(w-d,h);}else if(h+f>=j){g.resize(w,h+f);}break;default:break;}return;}this._dockParent=null;var i;for(i=this._panes.length-1;i>=0;i--){g=this._panes[i];if(g._parent!=null&&g!=this._oPane&&this._isInside(this._getBounding(g._elem),e.x,e.y)){this._dockParent=g;break;}}if(this._dockIcons!=null){this._showDockIcons(true);}g=this._oPane;if(g){if(g._parent==null&&g._tabParent==null&&!(this._oIsTab&&g._tabs.length>0)){x=g._elem.offsetLeft+d;y=g._elem.offsetTop+f;g._elem.style.left=x+"px";g._elem.style.top=y+"px";}else if(Math.abs(this._snapX-e.x)>16||Math.abs(this._snapY-e.y)>16){var s=(g._tabParent!=null||this._oIsTab);this.undock(g,this._oIsTab);var p=this._getBounding(this._elem);var n=this._snapRect.x-(this._snapX-e.x)-16-p.x;var k=this._snapRect.y-(this._snapY-e.y)-16-p.y;var r=this._snapRect.x+this._snapRect.w/2-e.x;g._elem.style.left=(n+(this._snapRect.w-g._elem.offsetWidth)/2-r)+"px";if(s){g._elem.style.top=(k+this._snapRect.h-24)+"px";}else{g._elem.style.top=k+"px";}this.bringToFront(g);this._showDockIcons(true);}}var t=this._oContainer;if(t){x=t.getSplitterPosition();if(t.getOrientation()==0){x+=f;}else{x+=d;}t.setSplitterPosition(x);}this._oParent=null;this._oDir=-1;if(this._dockIcons!=null){var u=null;var v=-1;for(i=0;i<this._dockIcons.length;i++){var z=this._dockIcons[i];var A=this._getBounding(z);if(this._isInside(A,e.x,e.y)){if(i<4){u=this._elem;v=i+1;this._oParent=null;this._oDir=v;}else if(i>=4&&this._dockParent!=null){u=this._dockParent._elem;v=i-4;this._oParent=this._dockParent;this._oDir=v;}break;}}this._showDockShadow(u,v);}else{this._showDockShadow(null,-1);}c.handled=true;}};b.prototype.endGesture=function(e){if(this._dockIcons!=null&&this._oPane!=null&&this._oDir>-1){this.dock(this._oPane,this._oParent,this._oDir);e.handled=true;}if(this._oContainer!=null){this._oContainer._splitter.style.opacity=0;e.handled=true;}var t=this._oResize?this._oResize:this._oPane;if(t){var c=t._elem;if(c.offsetTop<-8){c.style.top="-8px";}else if(c.offsetTop>this._elem.offsetHeight-8){c.style.top=(this._elem.offsetHeight-8)+"px";}if(c.offsetLeft+c.offsetWidth<32){c.style.left=(-c.offsetWidth+32)+"px";}else if(c.offsetLeft>this._elem.offsetWidth-32){c.style.left=(this._elem.offsetWidth-32)+"px";}e.handled=true;}this._oContainer=null;this._oPane=null;this._oParent=null;this._oDir=-1;this._showDockIcons(false);this._showDockShadow(this._elem,-1);this._gesture=false;this._oResize=null;};b.prototype.click=function(e){};b.prototype.doubleClick=function(e){};b.prototype.contextMenu=function(e){};b.prototype.getViewport=function(){return this;};b.prototype.getId=function(){return this._id;};b.prototype.resize=function(w,h){if(this._root){this._root.resize(w,h);}};return b;},true);
