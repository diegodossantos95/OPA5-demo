tinymce.PluginManager.add('link',function(b){var c={};function d(e){return e&&e.nodeName==='A'&&e.href;}function h(e){return tinymce.util.Tools.grep(e,d).length>0;}function g(e){return b.dom.getParent(e,'a[href]');}function f(){return g(b.selection.getStart());}function j(e){var a=e.getAttribute('data-mce-href');return a?a:e.getAttribute('href');}function k(){var a=b.plugins.contextmenu;return a?a.isContextMenuVisible():false;}var l=function(e){return e.altKey===true&&e.shiftKey===false&&e.ctrlKey===false&&e.metaKey===false;};function m(e){var a,i,v;if(b.settings.link_context_toolbar&&!k()&&d(e)){a=b.selection;i=a.getRng();v=i.startContainer;if(v.nodeType==3&&a.isCollapsed()&&i.startOffset>0&&i.startOffset<v.data.length){return true;}}return false;}function n(a,e){document.body.appendChild(a);a.dispatchEvent(e);document.body.removeChild(a);}function o(a){if(!tinymce.Env.ie||tinymce.Env.ie>10){var e=document.createElement('a');e.target='_blank';e.href=a;e.rel='noreferrer noopener';var i=document.createEvent('MouseEvents');i.initMouseEvent('click',true,true,window,0,0,0,0,0,false,false,false,false,0,null);n(e,i);}else{var w=window.open('','_blank');if(w){w.opener=null;var v=w.document;v.open();v.write('<meta http-equiv="refresh" content="0; url='+tinymce.DOM.encode(a)+'">');v.close();}}}function p(a){if(a){var e=j(a);if(/^#/.test(e)){var i=b.$(e);if(i.length){b.selection.scrollIntoView(i[0],true);}}else{o(a.href);}}}function q(){p(f());}function t(){var a=this;var i=function(e){if(h(e.parents)){a.show();}else{a.hide();}};if(!h(b.dom.getParents(b.selection.getStart()))){a.hide();}b.on('nodechange',i);a.on('remove',function(){b.off('nodechange',i);});}function r(a){return function(){var e=b.settings.link_list;if(typeof e=="string"){tinymce.util.XHR.send({url:e,success:function(i){a(tinymce.util.JSON.parse(i));}});}else if(typeof e=="function"){e(a);}else{a(e);}};}function s(i,a,e){function v(w,x){x=x||[];tinymce.each(w,function(y){var z={text:y.text||y.title};if(y.menu){z.menu=v(y.menu);}else{z.value=y.value;if(a){a(z);}}x.push(z);});return x;}return v(i,e||[]);}function u(a){var v={},w=b.selection,x=b.dom,y,z,A;var B,C,D,E,F,G,H,I,J;function K(e){var i=B.find('#text');if(!i.value()||(e.lastControl&&i.value()==e.lastControl.text())){i.value(e.control.text());}B.find('#href').value(e.control.value());}function L(e){var i=[];tinymce.each(b.dom.select('a:not([href])'),function(Q){var R=Q.name||Q.id;if(R){i.push({text:R,value:'#'+R,selected:e.indexOf('#'+R)!=-1});}});if(i.length){i.unshift({text:'None',value:''});return{name:'anchor',type:'listbox',label:'Anchors',values:i,onselect:K};}}function M(){if(!A&&v.text.length===0&&C){this.parent().parent().find('#text')[0].value(this.value());}}function N(e){var i=e.meta||{};if(E){E.value(b.convertURL(this.value(),'href'));}tinymce.each(e.meta,function(J,Q){var R=B.find('#'+Q);if(Q==='text'){if(A.length===0){R.value(J);v.text=J;}}else{R.value(J);}});if(i.attach){c={href:this.value(),attach:i.attach};}if(!i.text){M.call(this);}}function O(z){var e=w.getContent();if(/</.test(e)&&(!/^<a [^>]+>[^<]+<\/a>$/.test(e)||e.indexOf('href=')==-1)){return false;}if(z){var Q=z.childNodes,i;if(Q.length===0){return false;}for(i=Q.length-1;i>=0;i--){if(Q[i].nodeType!=3){return false;}}}return true;}function P(e){e.meta=B.toJSON();}y=w.getNode();z=x.getParent(y,'a[href]');C=O();v.text=A=z?(z.innerText||z.textContent):w.getContent({format:'text'});v.href=z?x.getAttrib(z,'href'):'';if(z){v.target=x.getAttrib(z,'target');}else if(b.settings.default_link_target){v.target=b.settings.default_link_target;}if((J=x.getAttrib(z,'rel'))){v.rel=J;}if((J=x.getAttrib(z,'class'))){v['class']=J;}if((J=x.getAttrib(z,'title'))){v.title=J;}if(C){D={name:'text',type:'textbox',size:40,label:'Text to display',onchange:function(){v.text=this.value();}};}if(a){E={type:'listbox',label:'Link list',values:s(a,function(i){i.value=b.convertURL(i.value||i.url,'href');},[{text:'None',value:''}]),onselect:K,value:b.convertURL(v.href,'href'),onPostRender:function(){E=this;}};}if(b.settings.target_list!==false){if(!b.settings.target_list){b.settings.target_list=[{text:'None',value:''},{text:'New window',value:'_blank'}];}G={name:'target',type:'listbox',label:'Target',values:s(b.settings.target_list)};}if(b.settings.rel_list){F={name:'rel',type:'listbox',label:'Rel',values:s(b.settings.rel_list)};}if(b.settings.link_class_list){H={name:'class',type:'listbox',label:'Class',values:s(b.settings.link_class_list,function(i){if(i.value){i.textStyle=function(){return b.formatter.getCssText({inline:'a',classes:[i.value]});};}})};}if(b.settings.link_title!==false){I={name:'title',type:'textbox',label:'Title',value:v.title};}B=b.windowManager.open({title:'Insert link',data:v,body:[{name:'href',type:'filepicker',filetype:'file',size:40,autofocus:true,label:'Url',onchange:N,onkeyup:M,onbeforecall:P},D,I,L(v.href),E,F,G,H],onSubmit:function(e){var i;v=tinymce.extend(v,e.data);i=v.href;function Q(U,V){var W=b.selection.getRng();tinymce.util.Delay.setEditorTimeout(b,function(){b.windowManager.confirm(U,function(X){b.selection.setRng(W);V(X);});});}function R(U,V){var W='noopener noreferrer';function X(U){U=Y(U);return U?[U,W].join(' '):W;}function Y(U){var Z=new RegExp('('+W.replace(' ','|')+')','g');if(U){U=tinymce.trim(U.replace(Z,''));}return U?U:null;}return V?X(U):Y(U);}function S(){var U={href:i,target:v.target?v.target:null,rel:v.rel?v.rel:null,"class":v["class"]?v["class"]:null,title:v.title?v.title:null};if(!b.settings.allow_unsafe_link_target){U.rel=R(U.rel,U.target=='_blank');}if(i===c.href){c.attach();c={};}if(z){b.focus();if(C&&v.text!=A){if("innerText"in z){z.innerText=v.text;}else{z.textContent=v.text;}}x.setAttribs(z,U);w.select(z);b.undoManager.add();}else{if(C){b.insertContent(x.createHTML('a',U,x.encode(v.text)));}else{b.execCommand('mceInsertLink',false,U);}}}function T(){b.undoManager.transact(S);}if(!i){b.execCommand('unlink');return;}if(i.indexOf('@')>0&&i.indexOf('//')==-1&&i.indexOf('mailto:')==-1){Q('The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?',function(U){if(U){i='mailto:'+i;}T();});return;}if((b.settings.link_assume_external_targets&&!/^\w+:/i.test(i))||(!b.settings.link_assume_external_targets&&/^\s*www[\.|\d\.]/i.test(i))){Q('The URL you entered seems to be an external link. Do you want to add the required http:// prefix?',function(U){if(U){i='http://'+i;}T();});return;}T();}});}b.addButton('link',{icon:'link',tooltip:'Insert/edit link',shortcut:'Meta+K',onclick:r(u),stateSelector:'a[href]'});b.addButton('unlink',{icon:'unlink',tooltip:'Remove link',cmd:'unlink',stateSelector:'a[href]'});if(b.addContextToolbar){b.addButton('openlink',{icon:'newtab',tooltip:'Open link',onclick:q});b.addContextToolbar(m,'openlink | link unlink');}b.addShortcut('Meta+K','',r(u));b.addCommand('mceLink',r(u));b.on('click',function(e){var a=g(e.target);if(a&&tinymce.util.VK.metaKeyPressed(e)){e.preventDefault();p(a);}});b.on('keydown',function(e){var a=f();if(a&&e.keyCode===13&&l(e)){e.preventDefault();p(a);}});this.showDialog=u;b.addMenuItem('openlink',{text:'Open link',icon:'newtab',onclick:q,onPostRender:t,prependToContext:true});b.addMenuItem('link',{icon:'link',text:'Link',shortcut:'Meta+K',onclick:r(u),stateSelector:'a[href]',context:'insert',prependToContext:true});});
