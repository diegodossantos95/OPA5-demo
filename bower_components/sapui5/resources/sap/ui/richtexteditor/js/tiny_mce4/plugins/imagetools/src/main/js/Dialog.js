define("tinymce/imagetoolsplugin/Dialog",["global!tinymce.dom.DOMUtils","global!tinymce.util.Tools","global!tinymce.util.Promise","global!tinymce.ui.Factory","global!tinymce.ui.Form","global!tinymce.ui.Container","tinymce/imagetoolsplugin/ImagePanel","ephox/imagetools/api/ImageTransformations","ephox/imagetools/api/BlobConversions","tinymce/imagetoolsplugin/UndoStack"],function(D,T,P,F,a,C,I,c,B,U){function d(b){return{blob:b,url:URL.createObjectURL(b)};}function f(s){if(s){URL.revokeObjectURL(s.url);}}function h(s){T.each(s,f);}function o(j,k,l){var w,u=new U(),m,n,t,p,q,s,v,x,y,z,A,E,G,H,J,K,L,M,N,O,Q,R,S,V,W,X;function Y(e){var b,g,r,t1;b=w.find('#w')[0];g=w.find('#h')[0];r=parseInt(b.value(),10);t1=parseInt(g.value(),10);if(w.find('#constrain')[0].checked()&&S&&V&&r&&t1){if(e.control.settings.name=='w'){t1=Math.round(r*W);g.value(t1);}else{r=Math.round(t1*X);b.value(r);}}S=r;V=t1;}function Z(b){return Math.round(b*100)+'%';}function $(){w.find('#undo').disabled(!u.canUndo());w.find('#redo').disabled(!u.canRedo());w.statusbar.find('#save').disabled(!u.canUndo());}function _(){w.find('#undo').disabled(true);w.find('#redo').disabled(true);}function a1(b){if(b){v.imageSrc(b.url);}}function b1(b){return function(){var e=T.grep(R,function(g){return g.settings.name!=b;});T.each(e,function(g){g.hide();});b.show();b.focus();};}function c1(b){t=d(b);a1(t);}function d1(b){j=d(b);a1(j);h(u.add(j).removed);$();}function e1(){var r=v.selection();c.crop(j.blob,r.x,r.y,r.w,r.h).then(function(b){d1(b);h1();});}function f1(b){var e=[].slice.call(arguments,1);return function(){var g=t||j;b.apply(this,[g.blob].concat(e)).then(c1);};}function g1(b){var e=[].slice.call(arguments,1);return function(){b.apply(this,[j.blob].concat(e)).then(d1);};}function h1(){a1(j);f(t);b1(m)();$();}function i1(){if(t){d1(t.blob);h1();}}function j1(){var b=v.zoom();if(b<2){b+=0.1;}v.zoom(b);}function k1(){var b=v.zoom();if(b>0.1){b-=0.1;}v.zoom(b);}function l1(){j=u.undo();a1(j);$();}function m1(){j=u.redo();a1(j);$();}function n1(){k(j.blob);w.close();}function o1(b){return new a({layout:'flex',direction:'row',labelGap:5,border:'0 0 1 0',align:'center',pack:'center',padding:'0 10 0 10',spacing:5,flex:0,minHeight:60,defaults:{classes:'imagetool',type:'button'},items:b});}function p1(b,e){return o1([{text:'Back',onclick:h1},{type:'spacer',flex:1},{text:'Apply',subtype:'primary',onclick:i1}]).hide().on('show',function(){_();e(j.blob).then(function(g){var r=d(g);a1(r);f(t);t=r;});});}function q1(b,g,r,t1,u1){function v1(r){g(j.blob,r).then(function(e){var w1=d(e);a1(w1);f(t);t=w1;});}return o1([{text:'Back',onclick:h1},{type:'spacer',flex:1},{type:'slider',flex:1,ondragend:function(e){v1(e.value);},minValue:t1,maxValue:u1,value:r,previewFilter:Z},{type:'spacer',flex:1},{text:'Apply',subtype:'primary',onclick:i1}]).hide().on('show',function(){this.find('slider').value(r);_();});}function r1(e,t1){function u1(){var r,g,b;r=w.find('#r')[0].value();g=w.find('#g')[0].value();b=w.find('#b')[0].value();t1(j.blob,r,g,b).then(function(v1){var w1=d(v1);a1(w1);f(t);t=w1;});}return o1([{text:'Back',onclick:h1},{type:'spacer',flex:1},{type:'slider',label:'R',name:'r',minValue:0,value:1,maxValue:2,ondragend:u1,previewFilter:Z},{type:'slider',label:'G',name:'g',minValue:0,value:1,maxValue:2,ondragend:u1,previewFilter:Z},{type:'slider',label:'B',name:'b',minValue:0,value:1,maxValue:2,ondragend:u1,previewFilter:Z},{type:'spacer',flex:1},{text:'Apply',subtype:'primary',onclick:i1}]).hide().on('show',function(){w.find('#r,#g,#b').value(1);_();});}p=o1([{text:'Back',onclick:h1},{type:'spacer',flex:1},{text:'Apply',subtype:'primary',onclick:e1}]).hide().on('show hide',function(e){v.toggleCropRect(e.type=='show');}).on('show',_);function s1(e){if(e.control.value()===true){W=V/S;X=S/V;}}q=o1([{text:'Back',onclick:h1},{type:'spacer',flex:1},{type:'textbox',name:'w',label:'Width',size:4,onkeyup:Y},{type:'textbox',name:'h',label:'Height',size:4,onkeyup:Y},{type:'checkbox',name:'constrain',text:'Constrain proportions',checked:true,onchange:s1},{type:'spacer',flex:1},{text:'Apply',subtype:'primary',onclick:'submit'}]).hide().on('submit',function(e){var S=parseInt(w.find('#w').value(),10),V=parseInt(w.find('#h').value(),10);e.preventDefault();g1(c.resize,S,V)();h1();}).on('show',_);s=o1([{text:'Back',onclick:h1},{type:'spacer',flex:1},{icon:'fliph',tooltip:'Flip horizontally',onclick:f1(c.flip,'h')},{icon:'flipv',tooltip:'Flip vertically',onclick:f1(c.flip,'v')},{icon:'rotateleft',tooltip:'Rotate counterclockwise',onclick:f1(c.rotate,-90)},{icon:'rotateright',tooltip:'Rotate clockwise',onclick:f1(c.rotate,90)},{type:'spacer',flex:1},{text:'Apply',subtype:'primary',onclick:i1}]).hide().on('show',_);z=p1("Invert",c.invert);M=p1("Sharpen",c.sharpen);N=p1("Emboss",c.emboss);A=q1("Brightness",c.brightness,0,-1,1);E=q1("Hue",c.hue,180,0,360);G=q1("Saturate",c.saturate,0,-1,1);H=q1("Contrast",c.contrast,0,-1,1);J=q1("Grayscale",c.grayscale,0,0,1);K=q1("Sepia",c.sepia,0,0,1);L=r1("Colorize",c.colorize);O=q1("Gamma",c.gamma,0,-1,1);Q=q1("Exposure",c.exposure,1,0,2);n=o1([{text:'Back',onclick:h1},{type:'spacer',flex:1},{text:'hue',icon:'hue',onclick:b1(E)},{text:'saturate',icon:'saturate',onclick:b1(G)},{text:'sepia',icon:'sepia',onclick:b1(K)},{text:'emboss',icon:'emboss',onclick:b1(N)},{text:'exposure',icon:'exposure',onclick:b1(Q)},{type:'spacer',flex:1}]).hide();m=o1([{tooltip:'Crop',icon:'crop',onclick:b1(p)},{tooltip:'Resize',icon:'resize2',onclick:b1(q)},{tooltip:'Orientation',icon:'orientation',onclick:b1(s)},{tooltip:'Brightness',icon:'sun',onclick:b1(A)},{tooltip:'Sharpen',icon:'sharpen',onclick:b1(M)},{tooltip:'Contrast',icon:'contrast',onclick:b1(H)},{tooltip:'Color levels',icon:'drop',onclick:b1(L)},{tooltip:'Gamma',icon:'gamma',onclick:b1(O)},{tooltip:'Invert',icon:'invert',onclick:b1(z)}]);v=new I({flex:1,imageSrc:j.url});x=new C({layout:'flex',direction:'column',border:'0 1 0 0',padding:5,spacing:5,items:[{type:'button',icon:'undo',tooltip:'Undo',name:'undo',onclick:l1},{type:'button',icon:'redo',tooltip:'Redo',name:'redo',onclick:m1},{type:'button',icon:'zoomin',tooltip:'Zoom in',onclick:j1},{type:'button',icon:'zoomout',tooltip:'Zoom out',onclick:k1}]});y=new C({type:'container',layout:'flex',direction:'row',align:'stretch',flex:1,items:[x,v]});R=[m,p,q,s,n,z,A,E,G,H,J,K,L,M,N,O,Q];w=F.create('window',{layout:'flex',direction:'column',align:'stretch',minWidth:Math.min(D.DOM.getViewPort().w,800),minHeight:Math.min(D.DOM.getViewPort().h,650),title:'Edit image',items:R.concat([y]),buttons:[{text:'Save',name:'save',subtype:'primary',onclick:n1},{text:'Cancel',onclick:'close'}]});w.renderTo(document.body).reflow();w.on('close',function(){l();h(u.data);u=null;t=null;});u.add(j);$();v.on('load',function(){S=v.imageSize().w;V=v.imageSize().h;W=V/S;X=S/V;w.find('#w').value(S);w.find('#h').value(V);});v.on('crop',e1);}function i(b){return new P(function(r,e){o(d(b),r,e);});}return{edit:i};});
