(function(){var d={};var r=function(e){var f=c(e);var n=e.split('.');var t=Function('return this;')();for(var i=0;i<n.length-1;++i){if(t[n[i]]===undefined)t[n[i]]={};t=t[n[i]];}t[n[n.length-1]]=f;};var a=function(e){var f=d[e];var n=f.deps;var o=f.defn;var p=n.length;var q=new Array(p);for(var i=0;i<p;++i)q[i]=c(n[i]);var s=o.apply(null,q);if(s===undefined)throw'module ['+e+'] returned undefined';f.instance=s;};var b=function(i,e,f){if(typeof i!=='string')throw'module id must be a string';else if(e===undefined)throw'no dependencies for '+i;else if(f===undefined)throw'no definition function for '+i;d[i]={deps:e,defn:f,instance:undefined};};var c=function(i){var e=d[i];if(e===undefined)throw'module ['+i+'] was undefined';else if(e.instance===undefined)a(i);return e.instance;};var g=function(e,f){var n=e.length;var o=new Array(n);for(var i=0;i<n;++i)o.push(c(e[i]));f.apply(null,f);};var h={};h.bolt={module:{api:{define:b,require:g,demand:c}}};var j=b;var k=g;var l=c;var m=function(i,e){j(i,[],function(){return e;});};m("global!tinymce.PluginManager",tinymce.PluginManager);m("global!tinymce.util.Delay",tinymce.util.Delay);m("global!tinymce.util.Tools",tinymce.util.Tools);m("global!tinymce.html.SaxParser",tinymce.html.SaxParser);m("global!tinymce.html.Schema",tinymce.html.Schema);m("global!tinymce.dom.DOMUtils.DOM",tinymce.dom.DOMUtils.DOM);j('tinymce.media.core.VideoScript',[],function(){var e=function(p,s){if(p){for(var i=0;i<p.length;i++){if(s.indexOf(p[i].filter)!==-1){return p[i];}}}};return{getVideoScriptMatch:e};});j('tinymce.media.core.Size',[],function(){var t=function(v){return v.replace(/px$/,'');};var e=function(v){return/^[0-9.]+$/.test(v)?(v+'px'):v;};var f=function(n){return function(i){return i?t(i.style[n]):'';};};var s=function(n){return function(i,v){if(i){i.style[n]=e(v);}};};return{getMaxWidth:f('maxWidth'),getMaxHeight:f('maxHeight'),setMaxWidth:s('maxWidth'),setMaxHeight:s('maxHeight')};});j('tinymce.media.core.HtmlToData',['global!tinymce.util.Tools','global!tinymce.html.SaxParser','global!tinymce.html.Schema','global!tinymce.dom.DOMUtils.DOM','tinymce.media.core.VideoScript','tinymce.media.core.Size'],function(T,S,e,D,V,f){var i=function(s){return D.getAttrib(s,'data-ephox-embed-iri');};var n=function(s){var t=D.createFragment(s);return i(t.firstChild)!=='';};var o=function(s,t){var u={};new S({validate:false,allow_conditional_comments:true,special:'script,noscript',start:function(v,w){if(!u.source1&&v==="param"){u.source1=w.map.movie;}if(v==="iframe"||v==="object"||v==="embed"||v==="video"||v==="audio"){if(!u.type){u.type=v;}u=T.extend(w.map,u);}if(v==="script"){var x=V.getVideoScriptMatch(s,w.map.src);if(!x){return;}u={type:"script",source1:w.map.src,width:x.width,height:x.height};}if(v==="source"){if(!u.source1){u.source1=w.map.src;}else if(!u.source2){u.source2=w.map.src;}}if(v==="img"&&!u.poster){u.poster=w.map.src;}}}).parse(t);u.source1=u.source1||u.src||u.data;u.source2=u.source2||'';u.poster=u.poster||'';return u;};var p=function(s){var t=D.createFragment(s);var u=t.firstChild;return{type:'ephox-embed-iri',source1:i(u),source2:'',poster:'',width:f.getMaxWidth(u),height:f.getMaxHeight(u)};};var q=function(s,t){return n(t)?p(t):o(s,t);};return{htmlToData:q};});m("global!tinymce.html.Writer",tinymce.html.Writer);j('tinymce.media.core.UpdateHtml',['global!tinymce.html.Writer','global!tinymce.html.SaxParser','global!tinymce.html.Schema','global!tinymce.dom.DOMUtils.DOM','tinymce.media.core.Size'],function(W,S,e,D,f){var s=function(t,v){var w;var i;var x;var y;for(w in v){x=""+v[w];if(t.map[w]){i=t.length;while(i--){y=t[i];if(y.name===w){if(x){t.map[w]=x;y.value=x;}else{delete t.map[w];t.splice(i,1);}}}}else if(x){t.push({name:w,value:x});t.map[w]=x;}}};var n=function(i){var w=new W();var t=new S(w);t.parse(i);return w.getContent();};var u=function(i,t,v){var w=new W();var x=0;var y;new S({validate:false,allow_conditional_comments:true,special:'script,noscript',comment:function(z){w.comment(z);},cdata:function(z){w.cdata(z);},text:function(z,A){w.text(z,A);},start:function(z,A,B){switch(z){case"video":case"object":case"embed":case"img":case"iframe":s(A,{width:t.width,height:t.height});break;}if(v){switch(z){case"video":s(A,{poster:t.poster,src:""});if(t.source2){s(A,{src:""});}break;case"iframe":s(A,{src:t.source1});break;case"source":x++;if(x<=2){s(A,{src:t["source"+x],type:t["source"+x+"mime"]});if(!t["source"+x]){return;}}break;case"img":if(!t.poster){return;}y=true;break;}}w.start(z,A,B);},end:function(z){if(z==="video"&&v){for(var A=1;A<=2;A++){if(t["source"+A]){var B=[];B.map={};if(x<A){s(B,{src:t["source"+A],type:t["source"+A+"mime"]});w.start("source",B,true);}}}}if(t.poster&&z==="object"&&v&&!y){var C=[];C.map={};s(C,{src:t.poster,width:t.width,height:t.height});w.start("img",C,true);}w.end(z);}},new e({})).parse(i);return w.getContent();};var o=function(i){var t=D.createFragment(i);return D.getAttrib(t.firstChild,'data-ephox-embed-iri')!=='';};var p=function(i,t){var v=D.createFragment(i);var w=v.firstChild;f.setMaxWidth(w,t.width);f.setMaxHeight(w,t.height);return n(w.outerHTML);};var q=function(i,t,v){return o(i)?p(i,t):u(i,t,v);};return{updateHtml:q};});j('tinymce.media.core.Mime',[],function(){var e=function(u){var f={'mp3':'audio/mpeg','wav':'audio/wav','mp4':'video/mp4','webm':'video/webm','ogg':'video/ogg','swf':'application/x-shockwave-flash'};var i=u.toLowerCase().split('.').pop();var n=f[i];return n?n:'';};return{guess:e};});j('tinymce.media.core.UrlPatterns',[],function(){var u=[{regex:/youtu\.be\/([\w\-.]+)/,type:'iframe',w:560,h:314,url:'//www.youtube.com/embed/$1',allowFullscreen:true},{regex:/youtube\.com(.+)v=([^&]+)/,type:'iframe',w:560,h:314,url:'//www.youtube.com/embed/$2',allowFullscreen:true},{regex:/youtube.com\/embed\/([a-z0-9\-_]+(?:\?.+)?)/i,type:'iframe',w:560,h:314,url:'//www.youtube.com/embed/$1',allowFullscreen:true},{regex:/vimeo\.com\/([0-9]+)/,type:'iframe',w:425,h:350,url:'//player.vimeo.com/video/$1?title=0&byline=0&portrait=0&color=8dc7dc',allowfullscreen:true},{regex:/vimeo\.com\/(.*)\/([0-9]+)/,type:"iframe",w:425,h:350,url:"//player.vimeo.com/video/$2?title=0&amp;byline=0",allowfullscreen:true},{regex:/maps\.google\.([a-z]{2,3})\/maps\/(.+)msid=(.+)/,type:'iframe',w:425,h:350,url:'//maps.google.com/maps/ms?msid=$2&output=embed"',allowFullscreen:false},{regex:/dailymotion\.com\/video\/([^_]+)/,type:'iframe',w:480,h:270,url:'//www.dailymotion.com/embed/video/$1',allowFullscreen:true}];return{urlPatterns:u};});j('tinymce.media.core.DataToHtml',['tinymce.media.core.Mime','tinymce.media.core.HtmlToData','tinymce.media.core.UrlPatterns','tinymce.media.core.VideoScript','tinymce.media.core.UpdateHtml','global!tinymce.util.Tools'],function(M,H,U,V,e,T){var f=function(n,o){var p='';var q=T.extend({},o);if(!q.source1){T.extend(q,H.htmlToData(n.settings.media_scripts,q.embed));if(!q.source1){return'';}}if(!q.source2){q.source2='';}if(!q.poster){q.poster='';}q.source1=n.convertURL(q.source1,"source");q.source2=n.convertURL(q.source2,"source");q.source1mime=M.guess(q.source1);q.source2mime=M.guess(q.source2);q.poster=n.convertURL(q.poster,"poster");T.each(U.urlPatterns,function(t){var i;var u;var w=t.regex.exec(q.source1);if(w){u=t.url;for(i=0;w[i];i++){u=u.replace('$'+i,function(){return w[i];});}q.source1=u;q.type=t.type;q.allowFullscreen=t.allowFullscreen;q.width=q.width||t.w;q.height=q.height||t.h;}});if(q.embed){p=e.updateHtml(q.embed,q,true);}else{var v=V.getVideoScriptMatch(n.settings.media_scripts,q.source1);if(v){q.type='script';q.width=v.width;q.height=v.height;}q.width=q.width||300;q.height=q.height||150;T.each(q,function(i,t){q[t]=n.dom.encode(i);});if(q.type==="iframe"){var s=q.allowFullscreen?' allowFullscreen="1"':'';p+='<iframe src="'+q.source1+'" width="'+q.width+'" height="'+q.height+'"'+s+'></iframe>';}else if(q.source1mime==="application/x-shockwave-flash"){p+='<object data="'+q.source1+'" width="'+q.width+'" height="'+q.height+'" type="application/x-shockwave-flash">';if(q.poster){p+='<img src="'+q.poster+'" width="'+q.width+'" height="'+q.height+'" />';}p+='</object>';}else if(q.source1mime.indexOf('audio')!==-1){if(n.settings.audio_template_callback){p=n.settings.audio_template_callback(q);}else{p+=('<audio controls="controls" src="'+q.source1+'">'+(q.source2?'\n<source src="'+q.source2+'"'+(q.source2mime?' type="'+q.source2mime+'"':'')+' />\n':'')+'</audio>');}}else if(q.type==="script"){p+='<script src="'+q.source1+'"></script>';}else{if(n.settings.video_template_callback){p=n.settings.video_template_callback(q);}else{p=('<video width="'+q.width+'" height="'+q.height+'"'+(q.poster?' poster="'+q.poster+'"':'')+' controls="controls">\n'+'<source src="'+q.source1+'"'+(q.source1mime?' type="'+q.source1mime+'"':'')+' />\n'+(q.source2?'<source src="'+q.source2+'"'+(q.source2mime?' type="'+q.source2mime+'"':'')+' />\n':'')+'</video>');}}}return p;};return{dataToHtml:f};});m("global!tinymce.util.Promise",tinymce.util.Promise);j('tinymce.media.core.Service',['tinymce.media.core.DataToHtml','global!tinymce.util.Promise'],function(D,P){var e=function(o,p,q){var s={};return new P(function(t,u){var w=function(v){if(v.html){s[o.source1]=v;}return t({url:o.source1,html:v.html?v.html:p(o)});};if(s[o.source1]){w(s[o.source1]);}else{q({url:o.source1},w,u);}});};var f=function(o,p){return new P(function(q){q({html:p(o),url:o.source1});});};var i=function(o){return function(p){return D.dataToHtml(o,p);};};var n=function(o,p){var q=o.settings.media_url_resolver;return q?e(p,i(o),q):f(p,i(o));};return{getEmbedHtml:n};});m("global!tinymce.Env",tinymce.Env);j('tinymce.media.ui.SizeManager',[],function(){var e=function(w,f){w.state.set('oldVal',w.value());f.state.set('oldVal',f.value());};var i=function(w,f){var p=w.find('#width')[0];var q=w.find('#height')[0];var t=w.find('#constrain')[0];if(p&&q&&t){f(p,q,t.checked());}};var n=function(w,f,p){var q=w.state.get('oldVal');var t=f.state.get('oldVal');var v=w.value();var x=f.value();if(p&&q&&t&&v&&x){if(v!==q){x=Math.round((v/q)*x);if(!isNaN(x)){f.value(x);}}else{v=Math.round((x/t)*v);if(!isNaN(v)){w.value(v);}}}e(w,f);};var s=function(w){i(w,e);};var u=function(w){i(w,n);};var o=function(f){var p=function(){f(function(w){u(w);});};return{type:'container',label:'Dimensions',layout:'flex',align:'center',spacing:5,items:[{name:'width',type:'textbox',maxLength:5,size:5,onchange:p,ariaLabel:'Width'},{type:'label',text:'x'},{name:'height',type:'textbox',maxLength:5,size:5,onchange:p,ariaLabel:'Height'},{name:'constrain',type:'checkbox',checked:true,text:'Constrain proportions'}]};};return{createUi:o,syncSize:s,updateSize:u};});j('tinymce.media.ui.Dialog',['global!tinymce.util.Delay','tinymce.media.core.HtmlToData','tinymce.media.core.UpdateHtml','tinymce.media.core.Service','tinymce.media.core.Size','global!tinymce.util.Tools','global!tinymce.Env','tinymce.media.ui.SizeManager'],function(D,H,U,S,f,T,E,n){var o=(E.ie&&E.ie<=8)?'onChange':'onInput';var p=function(e){return function(i){var y=i&&i.msg?'Media embed handler error: '+i.msg:'Media embed handler threw unknown error.';e.notificationManager.open({type:'error',text:y});};};var q=function(e){var i=e.selection.getNode();var y=i.getAttribute('data-ephox-embed-iri');if(y){return{source1:y,'data-ephox-embed-iri':y,width:f.getMaxWidth(i),height:f.getMaxHeight(i)};}return i.getAttribute('data-mce-object')?H.htmlToData(e.settings.media_scripts,e.serializer.serialize(i,{selection:true})):{};};var s=function(e){var i=e.selection.getNode();if(i.getAttribute('data-mce-object')||i.getAttribute('data-ephox-embed-iri')){return e.selection.getContent();}};var t=function(e,i){return function(y){var A=y.html;var B=e.find('#embed')[0];var C=T.extend(H.htmlToData(i.settings.media_scripts,A),{source1:y.url});e.fromJSON(C);if(B){B.value(A);n.updateSize(e);}};};var u=function(e,A){var i;var y;var B=e.dom.select('img[data-mce-object]');for(i=0;i<A.length;i++){for(y=B.length-1;y>=0;y--){if(A[i]===B[y]){B.splice(y,1);}}}e.selection.select(B[0]);};var v=function(e,i){var y=e.dom.select('img[data-mce-object]');e.insertContent(i);u(e,y);e.nodeChanged();};var w=function(e,i){var y=e.toJSON();y.embed=U.updateHtml(y.embed,y);if(y.embed){v(i,y.embed);}else{S.getEmbedHtml(i,y).then(function(A){v(i,A.html);})["catch"](p(i));}};var x=function(e,i){T.each(i,function(y,A){e.find('#'+A).value(y);});};var z=function(i){var y;var A;var B=[{name:'source1',type:'filepicker',filetype:'media',size:40,autofocus:true,label:'Source',onpaste:function(){setTimeout(function(){S.getEmbedHtml(i,y.toJSON()).then(t(y,i))["catch"](p(i));},1);},onchange:function(e){S.getEmbedHtml(i,y.toJSON()).then(t(y,i))["catch"](p(i));x(y,e.meta);},onbeforecall:function(e){e.meta=y.toJSON();}}];var C=[];var F=function(e){e(y);A=y.toJSON();y.find('#embed').value(U.updateHtml(A.embed,A));};if(i.settings.media_alt_source!==false){C.push({name:'source2',type:'filepicker',filetype:'media',size:40,label:'Alternative source'});}if(i.settings.media_poster!==false){C.push({name:'poster',type:'filepicker',filetype:'image',size:40,label:'Poster'});}if(i.settings.media_dimensions!==false){var G=n.createUi(F);B.push(G);}A=q(i);var I={id:'mcemediasource',type:'textbox',flex:1,name:'embed',value:s(i),multiline:true,rows:5,label:'Source'};var J=function(){A=T.extend({},H.htmlToData(i.settings.media_scripts,this.value()));this.parent().parent().fromJSON(A);};I[o]=J;y=i.windowManager.open({title:'Insert/edit media',data:A,bodyType:'tabpanel',body:[{title:'General',type:"form",items:B},{title:'Embed',type:"container",layout:'flex',direction:'column',align:'stretch',padding:10,spacing:10,items:[{type:'label',text:'Paste your embed code below:',forId:'mcemediasource'},I]},{title:'Advanced',type:"form",items:C}],onSubmit:function(){n.updateSize(y);w(y,i);}});n.syncSize(y);};return{showDialog:z};});j('tinymce.media.core.Sanitize',['global!tinymce.util.Tools','global!tinymce.html.Writer','global!tinymce.html.SaxParser','global!tinymce.html.Schema'],function(T,W,S,e){var s=function(f,n){if(f.settings.media_filter_html===false){return n;}var w=new W();var o;new S({validate:false,allow_conditional_comments:false,special:'script,noscript',comment:function(t){w.comment(t);},cdata:function(t){w.cdata(t);},text:function(t,i){w.text(t,i);},start:function(p,q,t){o=true;if(p==='script'||p==='noscript'){return;}for(var i=0;i<q.length;i++){if(q[i].name.indexOf('on')===0){return;}if(q[i].name==='style'){q[i].value=f.dom.serializeStyle(f.dom.parseStyle(q[i].value),p);}}w.start(p,q,t);o=false;},end:function(i){if(o){return;}w.end(i);}},new e({})).parse(n);return w.getContent();};return{sanitize:s};});m("global!tinymce.html.Node",tinymce.html.Node);j('tinymce.media.core.Nodes',['tinymce.media.core.Sanitize','tinymce.media.core.VideoScript','global!tinymce.html.Node','global!tinymce.Env'],function(S,V,N,E){var e=function(i,q){var s;var t=q.name;s=new N('img',1);s.shortEnded=true;n(i,q,s);s.attr({width:q.attr('width')||"300",height:q.attr('height')||(t==="audio"?"30":"150"),style:q.attr('style'),src:E.transparentSrc,"data-mce-object":t,"class":"mce-object mce-object-"+t});return s;};var f=function(i,q){var s;var t;var u;var v=q.name;s=new N('span',1);s.attr({contentEditable:'false',style:q.attr('style'),"data-mce-object":v,"class":"mce-preview-object mce-object-"+v});n(i,q,s);t=new N(v,1);t.attr({src:q.attr('src'),allowfullscreen:q.attr('allowfullscreen'),width:q.attr('width')||"300",height:q.attr('height')||(v==="audio"?"30":"150"),frameborder:'0'});u=new N('span',1);u.attr('class','mce-shim');s.append(t);s.append(u);return s;};var n=function(i,s,t){var q;var u;var v;var w;var x;v=s.attributes;w=v.length;while(w--){q=v[w].name;u=v[w].value;if(q!=="width"&&q!=="height"&&q!=="style"){if(q==="data"||q==="src"){u=i.convertURL(u,q);}t.attr('data-mce-p-'+q,u);}}x=s.firstChild&&s.firstChild.value;if(x){t.attr("data-mce-html",escape(S.sanitize(i,x)));t.firstChild=null;}};var o=function(i){while((i=i.parent)){if(i.attr('data-ephox-embed-iri')){return true;}}return false;};var p=function(q){return function(s){var i=s.length;var t;var v;while(i--){t=s[i];if(!t.parent){continue;}if(t.parent.attr('data-mce-object')){continue;}if(t.name==='script'){v=V.getVideoScriptMatch(q.settings.media_scripts,t.attr('src'));if(!v){continue;}}if(v){if(v.width){t.attr('width',v.width.toString());}if(v.height){t.attr('height',v.height.toString());}}if(t.name==='iframe'&&q.settings.media_live_embeds!==false&&E.ceFalse){if(!o(t)){t.replace(f(q,t));}}else{if(!o(t)){t.replace(e(q,t));}}}};};return{createPreviewIframeNode:f,createPlaceholderNode:e,placeHolderConverter:p};});j('tinymce.media.Plugin',['global!tinymce.PluginManager','tinymce.media.ui.Dialog','tinymce.media.core.Sanitize','tinymce.media.core.UpdateHtml','tinymce.media.core.Nodes'],function(P,D,S,U,N){var f=function(n){n.on('ResolveName',function(e){var i;if(e.target.nodeType===1&&(i=e.target.getAttribute("data-mce-object"))){e.name=i;}});n.on('preInit',function(){var s=n.schema.getSpecialElements();tinymce.each('video audio iframe object'.split(' '),function(i){s[i]=new RegExp('<\/'+i+'[^>]*>','gi');});var e=n.schema.getBoolAttrs();tinymce.each('webkitallowfullscreen mozallowfullscreen allowfullscreen'.split(' '),function(i){e[i]={};});n.parser.addNodeFilter('iframe,video,audio,object,embed,script',N.placeHolderConverter(n));n.serializer.addAttributeFilter('data-mce-object',function(o,p){var i=o.length;var q;var t;var u;var v;var w;var x;var y;var z;while(i--){q=o[i];if(!q.parent){continue;}y=q.attr(p);t=new tinymce.html.Node(y,1);if(y!=="audio"&&y!=="script"){z=q.attr('class');if(z&&z.indexOf('mce-preview-object')!==-1){t.attr({width:q.firstChild.attr('width'),height:q.firstChild.attr('height')});}else{t.attr({width:q.attr('width'),height:q.attr('height')});}}t.attr({style:q.attr('style')});v=q.attributes;u=v.length;while(u--){var A=v[u].name;if(A.indexOf('data-mce-p-')===0){t.attr(A.substr(11),v[u].value);}}if(y==="script"){t.attr('type','text/javascript');}w=q.attr('data-mce-html');if(w){x=new tinymce.html.Node('#text',3);x.raw=true;x.value=S.sanitize(n,unescape(w));t.append(x);}q.replace(t);}});});n.on('click keyup',function(){var s=n.selection.getNode();if(s&&n.dom.hasClass(s,'mce-preview-object')){if(n.dom.getAttrib(s,'data-mce-selected')){s.setAttribute('data-mce-selected','2');}}});n.on('ObjectSelected',function(e){var o=e.target.getAttribute('data-mce-object');if(o==="audio"||o==="script"){e.preventDefault();}});n.on('objectResized',function(e){var t=e.target;var i;if(t.getAttribute('data-mce-object')){i=t.getAttribute('data-mce-html');if(i){i=unescape(i);t.setAttribute('data-mce-html',escape(U.updateHtml(i,{width:e.width,height:e.height})));}}});this.showDialog=function(){D.showDialog(n);};n.addButton('media',{tooltip:'Insert/edit media',onclick:this.showDialog,stateSelector:['img[data-mce-object]','span[data-mce-object]','div[data-ephox-embed-iri]']});n.addMenuItem('media',{icon:'media',text:'Media',onclick:this.showDialog,context:'insert',prependToContext:true});n.on('setContent',function(){n.$('span.mce-preview-object').each(function(i,e){var $=n.$(e);if($.find('span.mce-shim',e).length===0){$.append('<span class="mce-shim"></span>');}});});n.addCommand('mceMedia',this.showDialog);};P.add('media',f);return function(){};});c('tinymce.media.Plugin')();})();
