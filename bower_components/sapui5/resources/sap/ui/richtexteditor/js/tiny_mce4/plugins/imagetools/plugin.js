(function(){var c={};var f=function(a){var m=o(a);var b=a.split('.');var d=Function('return this;')();for(var i=0;i<b.length-1;++i){if(d[b[i]]===undefined)d[b[i]]={};d=d[b[i]];}d[b[b.length-1]]=m;};var l=function(a){var b=c[a];var d=b.deps;var e=b.defn;var g=d.length;var h=new Array(g);for(var i=0;i<g;++i)h[i]=o(d[i]);var j=e.apply(null,h);if(j===undefined)throw'module ['+a+'] returned undefined';b.instance=j;};var n=function(i,d,a){if(typeof i!=='string')throw'module id must be a string';else if(d===undefined)throw'no dependencies for '+i;else if(a===undefined)throw'no definition function for '+i;c[i]={deps:d,defn:a,instance:undefined};};var o=function(i){var a=c[i];if(a===undefined)throw'module ['+i+'] was undefined';else if(a.instance===undefined)l(i);return a.instance;};var p=function(a,b){var d=a.length;var e=new Array(d);for(var i=0;i<d;++i)e.push(o(a[i]));b.apply(null,b);};var q={};q.bolt={module:{api:{define:n,require:p,demand:o}}};var s=n;var t=p;var u=o;var v=function(i,r){s(i,[],function(){return r;});};v("global!tinymce.PluginManager",tinymce.PluginManager);v("global!tinymce.Env",tinymce.Env);v("global!tinymce.util.Promise",tinymce.util.Promise);v("global!tinymce.util.URI",tinymce.util.URI);v("global!tinymce.util.Tools",tinymce.util.Tools);v("global!tinymce.util.Delay",tinymce.util.Delay);s("ephox/imagetools/util/Canvas",[],function(){function a(w,h){return r(document.createElement('canvas'),w,h);}function g(d){return d.getContext("2d");}function b(d){var h=null;try{h=d.getContext("webgl")||d.getContext("experimental-webgl");}catch(e){}if(!h){h=null;}return h;}function r(d,w,h){d.width=w;d.height=h;return d;}return{create:a,resize:r,get2dContext:g,get3dContext:b};});s("ephox/imagetools/util/ImageSize",[],function(){function g(i){return i.naturalWidth||i.width;}function a(i){return i.naturalHeight||i.height;}return{getWidth:g,getHeight:a};});s("ephox/imagetools/util/Promise",[],function(){if(window.Promise){return window.Promise;}var a=P.immediateFn||(typeof setImmediate==='function'&&setImmediate)||function(e){setTimeout(e,1);};function b(e,i){return function(){e.apply(i,arguments);};}var d=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]";};function P(e){if(typeof this!=='object')throw new TypeError('Promises must be constructed via new');if(typeof e!=='function')throw new TypeError('not a function');this._state=null;this._value=null;this._deferreds=[];k(e,b(r,this),b(g,this));}function h(i){var m=this;if(this._state===null){this._deferreds.push(i);return;}a(function(){var w=m._state?i.onFulfilled:i.onRejected;if(w===null){(m._state?i.resolve:i.reject)(m._value);return;}var x;try{x=w(m._value);}catch(e){i.reject(e);return;}i.resolve(x);});}function r(i){try{if(i===this)throw new TypeError('A promise cannot be resolved with itself.');if(i&&(typeof i==='object'||typeof i==='function')){var m=i.then;if(typeof m==='function'){k(b(m,i),b(r,this),b(g,this));return;}}this._state=true;this._value=i;j.call(this);}catch(e){g.call(this,e);}}function g(e){this._state=false;this._value=e;j.call(this);}function j(){for(var i=0,e=this._deferreds.length;i<e;i++){h.call(this,this._deferreds[i]);}this._deferreds=null;}function H(e,i,r,g){this.onFulfilled=typeof e==='function'?e:null;this.onRejected=typeof i==='function'?i:null;this.resolve=r;this.reject=g;}function k(e,i,m){var w=false;try{e(function(y){if(w)return;w=true;i(y);},function(y){if(w)return;w=true;m(y);});}catch(x){if(w)return;w=true;m(x);}}P.prototype['catch']=function(e){return this.then(null,e);};P.prototype.then=function(e,i){var m=this;return new P(function(r,g){h.call(m,new H(e,i,r,g));});};P.all=function(){var e=Array.prototype.slice.call(arguments.length===1&&d(arguments[0])?arguments[0]:arguments);return new P(function(r,g){if(e.length===0)return r([]);var m=e.length;function w(i,x){try{if(x&&(typeof x==='object'||typeof x==='function')){var y=x.then;if(typeof y==='function'){y.call(x,function(x){w(i,x);},g);return;}}e[i]=x;if(--m===0){r(e);}}catch(z){g(z);}}for(var i=0;i<e.length;i++){w(i,e[i]);}});};P.resolve=function(e){if(e&&typeof e==='object'&&e.constructor===P){return e;}return new P(function(r){r(e);});};P.reject=function(e){return new P(function(r,g){g(e);});};P.race=function(e){return new P(function(r,g){for(var i=0,m=e.length;i<m;i++){e[i].then(r,g);}});};return P;});s("ephox/imagetools/util/Mime",[],function(){function g(d){var a=document.createElement('a');a.href=d;return a.pathname;}function b(a){var d=g(a).split('.'),e=d[d.length-1],m={'jpg':'image/jpeg','jpeg':'image/jpeg','png':'image/png'};if(e){e=e.toLowerCase();}return m[e];}return{guessMimeType:b};});s("ephox/imagetools/util/Conversions",["ephox/imagetools/util/Promise","ephox/imagetools/util/Canvas","ephox/imagetools/util/Mime","ephox/imagetools/util/ImageSize"],function(P,C,M,I){function a(i){return new P(function(x){function y(){i.removeEventListener('load',y);x(i);}if(i.complete){x(i);}else{i.addEventListener('load',y);}});}function b(i){return a(i).then(function(i){var x,y;y=C.create(I.getWidth(i),I.getHeight(i));x=C.get2dContext(y);x.drawImage(i,0,0);return y;});}function d(i){return a(i).then(function(i){var x=i.src;if(x.indexOf('blob:')===0){return g(x);}if(x.indexOf('data:')===0){return h(x);}return b(i).then(function(y){return h(y.toDataURL(M.guessMimeType(x)));});});}function e(i){return new P(function(x){var y=new Image();function z(){y.removeEventListener('load',z);x(y);}y.addEventListener('load',z);y.src=URL.createObjectURL(i);if(y.complete){z();}});}function g(i){return new P(function(x){var y=new XMLHttpRequest();y.open('GET',i,true);y.responseType='blob';y.onload=function(){if(this.status==200){x(this.response);}};y.send();});}function h(x){return new P(function(y){var z,A,i,B,D,E;x=x.split(',');B=/data:([^;]+)/.exec(x[0]);if(B){D=B[1];}z=atob(x[1]);if(window.WebKitBlobBuilder){E=new WebKitBlobBuilder();A=new ArrayBuffer(z.length);for(i=0;i<A.length;i++){A[i]=z.charCodeAt(i);}E.append(A);y(E.getBlob(D));return;}A=new Uint8Array(z.length);for(i=0;i<A.length;i++){A[i]=z.charCodeAt(i);}y(new Blob([A],{type:D}));});}function j(i){if(i.indexOf('blob:')===0){return g(i);}if(i.indexOf('data:')===0){return h(i);}return null;}function k(i,x){return h(i.toDataURL(x));}function m(i){return new P(function(x){var y=new FileReader();y.onloadend=function(){x(y.result);};y.readAsDataURL(i);});}function r(i){return m(i).then(function(x){return x.split(',')[1];});}function w(i){URL.revokeObjectURL(i.src);}return{blobToImage:e,imageToBlob:d,blobToDataUri:m,blobToBase64:r,imageToCanvas:b,canvasToBlob:k,revokeImageUrl:w,uriToBlob:j};});s("ephox/imagetools/transformations/ColorMatrix",[],function(){function a(i,j,k){i=parseFloat(i);if(i>k){i=k;}else if(i<j){i=j;}return i;}function b(){return[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1];}var D=[0,0.01,0.02,0.04,0.05,0.06,0.07,0.08,0.1,0.11,0.12,0.14,0.15,0.16,0.17,0.18,0.20,0.21,0.22,0.24,0.25,0.27,0.28,0.30,0.32,0.34,0.36,0.38,0.40,0.42,0.44,0.46,0.48,0.5,0.53,0.56,0.59,0.62,0.65,0.68,0.71,0.74,0.77,0.80,0.83,0.86,0.89,0.92,0.95,0.98,1.0,1.06,1.12,1.18,1.24,1.30,1.36,1.42,1.48,1.54,1.60,1.66,1.72,1.78,1.84,1.90,1.96,2.0,2.12,2.25,2.37,2.50,2.62,2.75,2.87,3.0,3.2,3.4,3.6,3.8,4.0,4.3,4.7,4.9,5.0,5.5,6.0,6.5,6.8,7.0,7.3,7.5,7.8,8.0,8.4,8.7,9.0,9.4,9.6,9.8,10.0];function m(x,A){var i,j,k,B,C=[],E=new Array(10);for(i=0;i<5;i++){for(j=0;j<5;j++){C[j]=A[j+i*5];}for(j=0;j<5;j++){B=0;for(k=0;k<5;k++){B+=x[j+k*5]*C[k];}E[j+i*5]=B;}}return E;}function d(i,j){j=a(j,0,1);return i.map(function(k,x){if(x%6===0){k=1.0-((1-k)*j);}else{k*=j;}return a(k,0,1);});}function e(i,j){var x;j=a(j,-1,1);j*=100;if(j<0){x=127+j/100*127;}else{x=j%1;if(x===0){x=D[j];}else{x=D[(Math.floor(j))]*(1-x)+D[(Math.floor(j))+1]*x;}x=x*127+127;}return m(i,[x/127,0,0,0,0.5*(127-x),0,x/127,0,0,0.5*(127-x),0,0,x/127,0,0.5*(127-x),0,0,0,1,0,0,0,0,0,1]);}function g(i,j){var x,k,A,B;j=a(j,-1,1);x=1+((j>0)?3*j:j);k=0.3086;A=0.6094;B=0.0820;return m(i,[k*(1-x)+x,A*(1-x),B*(1-x),0,0,k*(1-x),A*(1-x)+x,B*(1-x),0,0,k*(1-x),A*(1-x),B*(1-x)+x,0,0,0,0,0,1,0,0,0,0,0,1]);}function h(i,j){var k,x,A,B,C;j=a(j,-180,180)/180*Math.PI;k=Math.cos(j);x=Math.sin(j);A=0.213;B=0.715;C=0.072;return m(i,[A+k*(1-A)+x*(-A),B+k*(-B)+x*(-B),C+k*(-C)+x*(1-C),0,0,A+k*(-A)+x*(0.143),B+k*(1-B)+x*(0.140),C+k*(-C)+x*(-0.283),0,0,A+k*(-A)+x*(-(1-A)),B+k*(-B)+x*(B),C+k*(1-C)+x*(C),0,0,0,0,0,1,0,0,0,0,0,1]);}function r(i,j){j=a(255*j,-255,255);return m(i,[1,0,0,0,j,0,1,0,0,j,0,0,1,0,j,0,0,0,1,0,0,0,0,0,1]);}function w(i,j,k,x){j=a(j,0,2);k=a(k,0,2);x=a(x,0,2);return m(i,[j,0,0,0,0,0,k,0,0,0,0,0,x,0,0,0,0,0,1,0,0,0,0,0,1]);}function y(i,j){j=a(j,0,1);return m(i,d([0.393,0.769,0.189,0,0,0.349,0.686,0.168,0,0,0.272,0.534,0.131,0,0,0,0,0,1,0,0,0,0,0,1],j));}function z(i,j){j=a(j,0,1);return m(i,d([0.33,0.34,0.33,0,0,0.33,0.34,0.33,0,0,0.33,0.34,0.33,0,0,0,0,0,1,0,0,0,0,0,1],j));}return{identity:b,adjust:d,multiply:m,adjustContrast:e,adjustBrightness:r,adjustSaturation:g,adjustHue:h,adjustColors:w,adjustSepia:y,adjustGrayscale:z};});s("ephox/imagetools/transformations/Filters",["ephox/imagetools/util/Canvas","ephox/imagetools/util/ImageSize","ephox/imagetools/util/Conversions","ephox/imagetools/transformations/ColorMatrix"],function(C,I,e,j){var k=e.revokeImageUrl;function z(h,w){return e.blobToImage(h).then(function(x){var y=C.create(I.getWidth(x),I.getHeight(x)),G=C.get2dContext(y),H;function J(H,m){var d=H.data,r,g,b,a,i,K=m[0],L=m[1],M=m[2],N=m[3],O=m[4],P=m[5],Q=m[6],R=m[7],S=m[8],T=m[9],U=m[10],V=m[11],W=m[12],X=m[13],Y=m[14],Z=m[15],$=m[16],_=m[17],a1=m[18],b1=m[19];for(i=0;i<d.length;i+=4){r=d[i];g=d[i+1];b=d[i+2];a=d[i+3];d[i]=r*K+g*L+b*M+a*N+O;d[i+1]=r*P+g*Q+b*R+a*S+T;d[i+2]=r*U+g*V+b*W+a*X+Y;d[i+3]=r*Z+g*$+b*_+a*a1+b1;}return H;}G.drawImage(x,0,0);k(x);H=J(G.getImageData(0,0,y.width,y.height),w);G.putImageData(H,0,0);return e.canvasToBlob(y);});}function A(a,m){return e.blobToImage(a).then(function(i){var d=C.create(I.getWidth(i),I.getHeight(i)),G=C.get2dContext(d),H,J;function K(H,J,m){var L,M,N,O,x,y,r,g,b,P,Q,R,S,T,U,w,h;function V(W,X,Y){if(W>Y){W=Y;}else if(W<X){W=X;}return W;}N=Math.round(Math.sqrt(m.length));O=Math.floor(N/2);L=H.data;M=J.data;w=H.width;h=H.height;for(y=0;y<h;y++){for(x=0;x<w;x++){r=g=b=0;for(Q=0;Q<N;Q++){for(P=0;P<N;P++){R=V(x+P-O,0,w-1);S=V(y+Q-O,0,h-1);T=(S*w+R)*4;U=m[Q*N+P];r+=L[T]*U;g+=L[T+1]*U;b+=L[T+2]*U;}}T=(y*w+x)*4;M[T]=V(r,0,255);M[T+1]=V(g,0,255);M[T+2]=V(b,0,255);}}return J;}G.drawImage(i,0,0);k(i);H=G.getImageData(0,0,d.width,d.height);J=G.getImageData(0,0,d.width,d.height);J=K(H,J,m);G.putImageData(J,0,0);return e.canvasToBlob(d);});}function B(a){return function(b,g){return e.blobToImage(b).then(function(h){var m=C.create(I.getWidth(h),I.getHeight(h)),r=C.get2dContext(m),w,i,x=new Array(256);function y(w,x){var d=w.data,i;for(i=0;i<d.length;i+=4){d[i]=x[d[i]];d[i+1]=x[d[i+1]];d[i+2]=x[d[i+2]];}return w;}for(i=0;i<x.length;i++){x[i]=a(i,g);}r.drawImage(h,0,0);k(h);w=y(r.getImageData(0,0,m.width,m.height),x);r.putImageData(w,0,0);return e.canvasToBlob(m);});};}function D(m){return function(b,a){return z(b,m(j.identity(),a));};}function E(m){return function(b){return z(b,m);};}function F(a){return function(b){return A(b,a);};}return{invert:E([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0]),brightness:D(j.adjustBrightness),hue:D(j.adjustHue),saturate:D(j.adjustSaturation),contrast:D(j.adjustContrast),grayscale:D(j.adjustGrayscale),sepia:D(j.adjustSepia),colorize:function(b,a,d,g){return z(b,j.adjustColors(j.identity(),a,d,g));},sharpen:F([0,-1,0,-1,5,-1,0,-1,0]),emboss:F([-2,-1,0,-1,1,1,0,1,2]),gamma:B(function(a,b){return Math.pow(a/255,1-b)*255;}),exposure:B(function(a,b){return 255*(1-Math.exp(-(a/255)*b));}),colorFilter:z,convoluteFilter:A};});s("ephox/imagetools/transformations/ImageResizerCanvas",["ephox/imagetools/util/Promise","ephox/imagetools/util/Conversions","ephox/imagetools/util/Canvas","ephox/imagetools/util/ImageSize"],function(P,C,a,I){function b(i,w,h){var W=I.getWidth(i);var H=I.getHeight(i);var d=w/W;var e=h/H;var g=false;if(d<0.5||d>2){d=d<0.5?0.5:2;g=true;}if(e<0.5||e>2){e=e<0.5?0.5:2;g=true;}var j=_(i,d,e);return!g?j:j.then(function(k){return b(k,w,h);});}function _(i,w,h){return new P(function(r){var W=I.getWidth(i);var H=I.getHeight(i);var d=Math.floor(W*w);var e=Math.floor(H*h);var g=a.create(d,e);var j=a.get2dContext(g);j.drawImage(i,0,0,W,H,0,0,d,e);r(g);});}return{scale:b};});s("ephox/imagetools/transformations/ImageTools",["ephox/imagetools/util/Conversions","ephox/imagetools/util/Canvas","ephox/imagetools/util/ImageSize","ephox/imagetools/transformations/ImageResizerCanvas"],function(C,a,I,b){var r=C.revokeImageUrl;function d(h,k){return C.blobToImage(h).then(function(m){var w=a.create(I.getWidth(m),I.getHeight(m)),x=a.get2dContext(w),y=0,z=0;k=k<0?360+k:k;if(k==90||k==270){a.resize(w,w.height,w.width);}if(k==90||k==180){y=w.width;}if(k==270||k==180){z=w.height;}x.translate(y,z);x.rotate(k*Math.PI/180);x.drawImage(m,0,0);r(m);return C.canvasToBlob(w,h.type);});}function e(h,k){return C.blobToImage(h).then(function(m){var w=a.create(I.getWidth(m),I.getHeight(m)),x=a.get2dContext(w);if(k=='v'){x.scale(1,-1);x.drawImage(m,0,-w.height);}else{x.scale(-1,1);x.drawImage(m,-w.width,0);}r(m);return C.canvasToBlob(w);});}function g(k,x,y,w,h){return C.blobToImage(k).then(function(m){var z=a.create(w,h),A=a.get2dContext(z);A.drawImage(m,-x,-y);r(m);return C.canvasToBlob(z);});}var i=function(h){return function(k){r(h);return k;};};function j(k,w,h){return C.blobToImage(k).then(function(m){var x;x=b.scale(m,w,h).then(function(y){return C.canvasToBlob(y,k.type);}).then(i(m)).catch(i(m));return x;});}return{rotate:d,flip:e,crop:g,resize:j};});s('ephox/imagetools/api/ImageTransformations',['ephox/imagetools/transformations/Filters','ephox/imagetools/transformations/ImageTools'],function(F,I){var i=function(h){return F.invert(h);};var a=function(h){return F.sharpen(h);};var e=function(h){return F.emboss(h);};var g=function(h,w){return F.gamma(h,w);};var b=function(h,w){return F.exposure(h,w);};var d=function(h,w,x,y){return F.colorize(h,w,x,y);};var j=function(h,w){return F.brightness(h,w);};var k=function(h,w){return F.hue(h,w);};var m=function(h,w){return F.saturate(h,w);};var r=function(h,w){return F.contrast(h,w);};var z=function(h,w){return F.grayscale(h,w);};var A=function(h,w){return F.sepia(h,w);};var B=function(h,w){return I.flip(h,w);};var C=function(G,x,y,w,h){return I.crop(G,x,y,w,h);};var D=function(x,w,h){return I.resize(x,w,h);};var E=function(h,w){return I.rotate(h,w);};return{invert:i,sharpen:a,emboss:e,brightness:j,hue:k,saturate:m,contrast:r,grayscale:z,sepia:A,colorize:d,gamma:g,exposure:b,flip:B,crop:C,resize:D,rotate:E};});s('ephox/imagetools/api/BlobConversions',['ephox/imagetools/util/Conversions'],function(C){var b=function(e){return C.blobToImage(e);};var i=function(e){return C.imageToBlob(e);};var a=function(e){return C.blobToDataUri(e);};var d=function(e){return C.blobToBase64(e);};return{blobToImage:b,imageToBlob:i,blobToDataUri:a,blobToBase64:d};});v("global!tinymce.dom.DOMUtils",tinymce.dom.DOMUtils);v("global!tinymce.ui.Factory",tinymce.ui.Factory);v("global!tinymce.ui.Form",tinymce.ui.Form);v("global!tinymce.ui.Container",tinymce.ui.Container);v("global!tinymce.ui.Control",tinymce.ui.Control);v("global!tinymce.ui.DragHelper",tinymce.ui.DragHelper);v("global!tinymce.geom.Rect",tinymce.geom.Rect);v("global!tinymce.dom.DomQuery",tinymce.dom.DomQuery);v("global!tinymce.util.Observable",tinymce.util.Observable);v("global!tinymce.util.VK",tinymce.util.VK);s("tinymce/imagetoolsplugin/CropRect",["global!tinymce.dom.DomQuery","global!tinymce.ui.DragHelper","global!tinymce.geom.Rect","global!tinymce.util.Tools","global!tinymce.util.Observable","global!tinymce.util.VK"],function($,D,R,T,O,V){var a=0;return function(b,d,g,i,j){var k,m,r,z,A='mce-',B=A+'crid-'+(a++);m=[{name:'move',xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:0,deltaH:0,label:'Crop Mask'},{name:'nw',xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:-1,deltaH:-1,label:'Top Left Crop Handle'},{name:'ne',xMul:1,yMul:0,deltaX:0,deltaY:1,deltaW:1,deltaH:-1,label:'Top Right Crop Handle'},{name:'sw',xMul:0,yMul:1,deltaX:1,deltaY:0,deltaW:-1,deltaH:1,label:'Bottom Left Crop Handle'},{name:'se',xMul:1,yMul:1,deltaX:0,deltaY:0,deltaW:1,deltaH:1,label:'Bottom Right Crop Handle'}];z=["top","right","bottom","left"];function C(e,h){return{x:h.x+e.x,y:h.y+e.y,w:h.w,h:h.h};}function E(e,h){return{x:h.x-e.x,y:h.y-e.y,w:h.w,h:h.h};}function F(){return E(g,b);}function G(e,Q,S,U){var x,y,w,h,W;x=Q.x;y=Q.y;w=Q.w;h=Q.h;x+=S*e.deltaX;y+=U*e.deltaY;w+=S*e.deltaW;h+=U*e.deltaH;if(w<20){w=20;}if(h<20){h=20;}W=b=R.clamp({x:x,y:y,w:w,h:h},g,e.name=='move');W=E(g,W);k.fire('updateRect',{rect:W});M(W);}function H(){function h(w){var x;return new D(B,{document:i.ownerDocument,handle:B+'-'+w.name,start:function(){x=b;},drag:function(e){G(w,x,e.deltaX,e.deltaY);}});}$('<div id="'+B+'" class="'+A+'croprect-container"'+' role="grid" aria-dropeffect="execute">').appendTo(i);T.each(z,function(e){$('#'+B,i).append('<div id="'+B+'-'+e+'"class="'+A+'croprect-block" style="display: none" data-mce-bogus="all">');});T.each(m,function(e){$('#'+B,i).append('<div id="'+B+'-'+e.name+'" class="'+A+'croprect-handle '+A+'croprect-handle-'+e.name+'"'+'style="display: none" data-mce-bogus="all" role="gridcell" tabindex="-1"'+' aria-label="'+e.label+'" aria-grabbed="false">');});r=T.map(m,h);J(b);$(i).on('focusin focusout',function(e){$(e.target).attr('aria-grabbed',e.type==='focus');});$(i).on('keydown',function(e){var w;T.each(m,function(y){if(e.target.id==B+'-'+y.name){w=y;return false;}});function x(y,Q,S,U,W){y.stopPropagation();y.preventDefault();G(w,S,U,W);}switch(e.keyCode){case V.LEFT:x(e,w,b,-10,0);break;case V.RIGHT:x(e,w,b,10,0);break;case V.UP:x(e,w,b,0,-10);break;case V.DOWN:x(e,w,b,0,10);break;case V.ENTER:case V.SPACEBAR:e.preventDefault();j();break;}});}function I(e){var h;h=T.map(m,function(w){return'#'+B+'-'+w.name;}).concat(T.map(z,function(w){return'#'+B+'-'+w;})).join(',');if(e){$(h,i).show();}else{$(h,i).hide();}}function J(e){function h(w,e){if(e.h<0){e.h=0;}if(e.w<0){e.w=0;}$('#'+B+'-'+w,i).css({left:e.x,top:e.y,width:e.w,height:e.h});}T.each(m,function(w){$('#'+B+'-'+w.name,i).css({left:e.w*w.xMul+e.x,top:e.h*w.yMul+e.y});});h('top',{x:d.x,y:d.y,w:d.w,h:e.y-d.y});h('right',{x:e.x+e.w,y:e.y,w:d.w-e.x-e.w+d.x,h:e.h});h('bottom',{x:d.x,y:e.y+e.h,w:d.w,h:d.h-e.y-e.h+d.y});h('left',{x:d.x,y:e.y,w:e.x-d.x,h:e.h});h('move',e);}function K(e){b=e;J(b);}function L(e){d=e;J(b);}function M(e){K(C(g,e));}function N(e){g=e;J(b);}function P(){T.each(r,function(h){h.destroy();});r=[];}H(i);k=T.extend({toggleVisibility:I,setClampRect:N,setRect:K,getInnerRect:F,setInnerRect:M,setViewPortRect:L,destroy:P},O);return k;};});s("tinymce/imagetoolsplugin/ImagePanel",["global!tinymce.ui.Control","global!tinymce.ui.DragHelper","global!tinymce.geom.Rect","global!tinymce.util.Tools","global!tinymce.util.Promise","tinymce/imagetoolsplugin/CropRect"],function(C,D,R,T,P,a){function b(i){return new P(function(r){function d(){i.removeEventListener('load',d);r(i);}if(i.complete){r(i);}else{i.addEventListener('load',d);}});}return C.extend({Defaults:{classes:"imagepanel"},selection:function(r){if(arguments.length){this.state.set('rect',r);return this;}return this.state.get('rect');},imageSize:function(){var d=this.state.get('viewRect');return{w:d.w,h:d.h};},toggleCropRect:function(d){this.state.set('cropEnabled',d);},imageSrc:function(d){var e=this,i=new Image();i.src=d;b(i).then(function(){var r,$,g=e.state.get('viewRect');$=e.$el.find('img');if($[0]){$.replaceWith(i);}else{var h=document.createElement('div');h.className='mce-imagepanel-bg';e.getEl().appendChild(h);e.getEl().appendChild(i);}r={x:0,y:0,w:i.naturalWidth,h:i.naturalHeight};e.state.set('viewRect',r);e.state.set('rect',R.inflate(r,-20,-20));if(!g||g.w!=r.w||g.h!=r.h){e.zoomFit();}e.repaintImage();e.fire('load');});},zoom:function(d){if(arguments.length){this.state.set('zoom',d);return this;}return this.state.get('zoom');},postRender:function(){this.imageSrc(this.settings.imageSrc);return this._super();},zoomFit:function(){var d=this,$,e,g,w,h,z,i;i=10;$=d.$el.find('img');e=d.getEl().clientWidth;g=d.getEl().clientHeight;w=$[0].naturalWidth;h=$[0].naturalHeight;z=Math.min((e-i)/w,(g-i)/h);if(z>=1){z=1;}d.zoom(z);},repaintImage:function(){var x,y,w,h,d,e,$,g,z,r,i;i=this.getEl();z=this.zoom();r=this.state.get('rect');$=this.$el.find('img');g=this.$el.find('.mce-imagepanel-bg');d=i.offsetWidth;e=i.offsetHeight;w=$[0].naturalWidth*z;h=$[0].naturalHeight*z;x=Math.max(0,d/2-w/2);y=Math.max(0,e/2-h/2);$.css({left:x,top:y,width:w,height:h});g.css({left:x,top:y,width:w,height:h});if(this.cropRect){this.cropRect.setRect({x:r.x*z+x,y:r.y*z+y,w:r.w*z,h:r.h*z});this.cropRect.setClampRect({x:x,y:y,w:w,h:h});this.cropRect.setViewPortRect({x:0,y:0,w:d,h:e});}},bindStates:function(){var d=this;function g(r){d.cropRect=new a(r,d.state.get('viewRect'),d.state.get('viewRect'),d.getEl(),function(){d.fire('crop');});d.cropRect.on('updateRect',function(e){var r=e.rect,z=d.zoom();r={x:Math.round(r.x/z),y:Math.round(r.y/z),w:Math.round(r.w/z),h:Math.round(r.h/z)};d.state.set('rect',r);});d.on('remove',d.cropRect.destroy);}d.state.on('change:cropEnabled',function(e){d.cropRect.toggleVisibility(e.value);d.repaintImage();});d.state.on('change:zoom',function(){d.repaintImage();});d.state.on('change:rect',function(e){var r=e.value;if(!d.cropRect){g(r);}d.cropRect.setRect(r);});}});});s("tinymce/imagetoolsplugin/UndoStack",[],function(){return function(){var d=[],i=-1;function a(h){var j;j=d.splice(++i);d.push(h);return{state:h,removed:j};}function b(){if(e()){return d[--i];}}function r(){if(g()){return d[++i];}}function e(){return i>0;}function g(){return i!=-1&&i<d.length-1;}return{data:d,add:a,undo:b,redo:r,canUndo:e,canRedo:g};};});s("tinymce/imagetoolsplugin/Dialog",["global!tinymce.dom.DOMUtils","global!tinymce.util.Tools","global!tinymce.util.Promise","global!tinymce.ui.Factory","global!tinymce.ui.Form","global!tinymce.ui.Container","tinymce/imagetoolsplugin/ImagePanel","ephox/imagetools/api/ImageTransformations","ephox/imagetools/api/BlobConversions","tinymce/imagetoolsplugin/UndoStack"],function(D,T,P,F,a,C,I,d,B,U){function h(b){return{blob:b,url:URL.createObjectURL(b)};}function i(b){if(b){URL.revokeObjectURL(b.url);}}function j(b){T.each(b,i);}function k(w,x,y){var z,A=new U(),E,G,H,J,K,L,M,N,O,Q,R,S,V,W,X,Y,Z,$,_,a1,b1,c1,d1,e1,f1,g1;function h1(e){var b,g,r,E1;b=z.find('#w')[0];g=z.find('#h')[0];r=parseInt(b.value(),10);E1=parseInt(g.value(),10);if(z.find('#constrain')[0].checked()&&d1&&e1&&r&&E1){if(e.control.settings.name=='w'){E1=Math.round(r*f1);g.value(E1);}else{r=Math.round(E1*g1);b.value(r);}}d1=r;e1=E1;}function i1(b){return Math.round(b*100)+'%';}function j1(){z.find('#undo').disabled(!A.canUndo());z.find('#redo').disabled(!A.canRedo());z.statusbar.find('#save').disabled(!A.canUndo());}function k1(){z.find('#undo').disabled(true);z.find('#redo').disabled(true);}function l1(b){if(b){M.imageSrc(b.url);}}function m1(b){return function(){var e=T.grep(c1,function(g){return g.settings.name!=b;});T.each(e,function(g){g.hide();});b.show();b.focus();};}function n1(b){H=h(b);l1(H);}function o1(b){w=h(b);l1(w);j(A.add(w).removed);j1();}function p1(){var r=M.selection();d.crop(w.blob,r.x,r.y,r.w,r.h).then(function(b){o1(b);s1();});}function q1(b){var e=[].slice.call(arguments,1);return function(){var g=H||w;b.apply(this,[g.blob].concat(e)).then(n1);};}function r1(b){var e=[].slice.call(arguments,1);return function(){b.apply(this,[w.blob].concat(e)).then(o1);};}function s1(){l1(w);i(H);m1(E)();j1();}function t1(){if(H){o1(H.blob);s1();}}function u1(){var b=M.zoom();if(b<2){b+=0.1;}M.zoom(b);}function v1(){var b=M.zoom();if(b>0.1){b-=0.1;}M.zoom(b);}function w1(){w=A.undo();l1(w);j1();}function x1(){w=A.redo();l1(w);j1();}function y1(){x(w.blob);z.close();}function z1(b){return new a({layout:'flex',direction:'row',labelGap:5,border:'0 0 1 0',align:'center',pack:'center',padding:'0 10 0 10',spacing:5,flex:0,minHeight:60,defaults:{classes:'imagetool',type:'button'},items:b});}function A1(b,e){return z1([{text:'Back',onclick:s1},{type:'spacer',flex:1},{text:'Apply',subtype:'primary',onclick:t1}]).hide().on('show',function(){k1();e(w.blob).then(function(g){var r=h(g);l1(r);i(H);H=r;});});}function B1(b,g,r,E1,F1){function G1(r){g(w.blob,r).then(function(e){var H1=h(e);l1(H1);i(H);H=H1;});}return z1([{text:'Back',onclick:s1},{type:'spacer',flex:1},{type:'slider',flex:1,ondragend:function(e){G1(e.value);},minValue:E1,maxValue:F1,value:r,previewFilter:i1},{type:'spacer',flex:1},{text:'Apply',subtype:'primary',onclick:t1}]).hide().on('show',function(){this.find('slider').value(r);k1();});}function C1(e,E1){function F1(){var r,g,b;r=z.find('#r')[0].value();g=z.find('#g')[0].value();b=z.find('#b')[0].value();E1(w.blob,r,g,b).then(function(G1){var H1=h(G1);l1(H1);i(H);H=H1;});}return z1([{text:'Back',onclick:s1},{type:'spacer',flex:1},{type:'slider',label:'R',name:'r',minValue:0,value:1,maxValue:2,ondragend:F1,previewFilter:i1},{type:'slider',label:'G',name:'g',minValue:0,value:1,maxValue:2,ondragend:F1,previewFilter:i1},{type:'slider',label:'B',name:'b',minValue:0,value:1,maxValue:2,ondragend:F1,previewFilter:i1},{type:'spacer',flex:1},{text:'Apply',subtype:'primary',onclick:t1}]).hide().on('show',function(){z.find('#r,#g,#b').value(1);k1();});}J=z1([{text:'Back',onclick:s1},{type:'spacer',flex:1},{text:'Apply',subtype:'primary',onclick:p1}]).hide().on('show hide',function(e){M.toggleCropRect(e.type=='show');}).on('show',k1);function D1(e){if(e.control.value()===true){f1=e1/d1;g1=d1/e1;}}K=z1([{text:'Back',onclick:s1},{type:'spacer',flex:1},{type:'textbox',name:'w',label:'Width',size:4,onkeyup:h1},{type:'textbox',name:'h',label:'Height',size:4,onkeyup:h1},{type:'checkbox',name:'constrain',text:'Constrain proportions',checked:true,onchange:D1},{type:'spacer',flex:1},{text:'Apply',subtype:'primary',onclick:'submit'}]).hide().on('submit',function(e){var d1=parseInt(z.find('#w').value(),10),e1=parseInt(z.find('#h').value(),10);e.preventDefault();r1(d.resize,d1,e1)();s1();}).on('show',k1);L=z1([{text:'Back',onclick:s1},{type:'spacer',flex:1},{icon:'fliph',tooltip:'Flip horizontally',onclick:q1(d.flip,'h')},{icon:'flipv',tooltip:'Flip vertically',onclick:q1(d.flip,'v')},{icon:'rotateleft',tooltip:'Rotate counterclockwise',onclick:q1(d.rotate,-90)},{icon:'rotateright',tooltip:'Rotate clockwise',onclick:q1(d.rotate,90)},{type:'spacer',flex:1},{text:'Apply',subtype:'primary',onclick:t1}]).hide().on('show',k1);Q=A1("Invert",d.invert);$=A1("Sharpen",d.sharpen);_=A1("Emboss",d.emboss);R=B1("Brightness",d.brightness,0,-1,1);S=B1("Hue",d.hue,180,0,360);V=B1("Saturate",d.saturate,0,-1,1);W=B1("Contrast",d.contrast,0,-1,1);X=B1("Grayscale",d.grayscale,0,0,1);Y=B1("Sepia",d.sepia,0,0,1);Z=C1("Colorize",d.colorize);a1=B1("Gamma",d.gamma,0,-1,1);b1=B1("Exposure",d.exposure,1,0,2);G=z1([{text:'Back',onclick:s1},{type:'spacer',flex:1},{text:'hue',icon:'hue',onclick:m1(S)},{text:'saturate',icon:'saturate',onclick:m1(V)},{text:'sepia',icon:'sepia',onclick:m1(Y)},{text:'emboss',icon:'emboss',onclick:m1(_)},{text:'exposure',icon:'exposure',onclick:m1(b1)},{type:'spacer',flex:1}]).hide();E=z1([{tooltip:'Crop',icon:'crop',onclick:m1(J)},{tooltip:'Resize',icon:'resize2',onclick:m1(K)},{tooltip:'Orientation',icon:'orientation',onclick:m1(L)},{tooltip:'Brightness',icon:'sun',onclick:m1(R)},{tooltip:'Sharpen',icon:'sharpen',onclick:m1($)},{tooltip:'Contrast',icon:'contrast',onclick:m1(W)},{tooltip:'Color levels',icon:'drop',onclick:m1(Z)},{tooltip:'Gamma',icon:'gamma',onclick:m1(a1)},{tooltip:'Invert',icon:'invert',onclick:m1(Q)}]);M=new I({flex:1,imageSrc:w.url});N=new C({layout:'flex',direction:'column',border:'0 1 0 0',padding:5,spacing:5,items:[{type:'button',icon:'undo',tooltip:'Undo',name:'undo',onclick:w1},{type:'button',icon:'redo',tooltip:'Redo',name:'redo',onclick:x1},{type:'button',icon:'zoomin',tooltip:'Zoom in',onclick:u1},{type:'button',icon:'zoomout',tooltip:'Zoom out',onclick:v1}]});O=new C({type:'container',layout:'flex',direction:'row',align:'stretch',flex:1,items:[N,M]});c1=[E,J,K,L,G,Q,R,S,V,W,X,Y,Z,$,_,a1,b1];z=F.create('window',{layout:'flex',direction:'column',align:'stretch',minWidth:Math.min(D.DOM.getViewPort().w,800),minHeight:Math.min(D.DOM.getViewPort().h,650),title:'Edit image',items:c1.concat([O]),buttons:[{text:'Save',name:'save',subtype:'primary',onclick:y1},{text:'Cancel',onclick:'close'}]});z.renderTo(document.body).reflow();z.on('close',function(){y();j(A.data);A=null;H=null;});A.add(w);j1();M.on('load',function(){d1=M.imageSize().w;e1=M.imageSize().h;f1=e1/d1;g1=d1/e1;z.find('#w').value(d1);z.find('#h').value(e1);});M.on('crop',p1);}function m(b){return new P(function(r,e){k(h(b),r,e);});}return{edit:m};});s("tinymce/imagetoolsplugin/ImageSize",[],function(){function g(i){var w,h;function d(e){return/^[0-9\.]+px$/.test(e);}w=i.style.width;h=i.style.height;if(w||h){if(d(w)&&d(h)){return{w:parseInt(w,10),h:parseInt(h,10)};}return null;}w=i.width;h=i.height;if(w&&h){return{w:parseInt(w,10),h:parseInt(h,10)};}return null;}function a(i,d){var w,h;if(d){w=i.style.width;h=i.style.height;if(w||h){i.style.width=d.w+'px';i.style.height=d.h+'px';i.removeAttribute('data-mce-style');}w=i.width;h=i.height;if(w||h){i.setAttribute('width',d.w);i.setAttribute('height',d.h);}}}function b(i){return{w:i.naturalWidth,h:i.naturalHeight};}return{getImageSize:g,setImageSize:a,getNaturalImageSize:b};});s("tinymce/imagetoolsplugin/Utils",["global!tinymce.util.Promise","global!tinymce.util.Tools"],function(P,T){var i=function(e){return e!==null&&e!==undefined;};var a=function(j,e){var g;g=e.reduce(function(h,k){return i(h)?h[k]:undefined;},j);return i(g)?g:null;};var r=function(e,h){return new P(function(g){var x;x=new XMLHttpRequest();x.onreadystatechange=function(){if(x.readyState===4){g({status:x.status,blob:this.response});}};x.open('GET',e,true);T.each(h,function(j,k){x.setRequestHeader(k,j);});x.responseType='blob';x.send();});};var b=function(g){return new P(function(h){var j=new FileReader();j.onload=function(e){var k=e.target;h(k.result);};j.readAsText(g);});};var d=function(e){var j;try{j=JSON.parse(e);}catch(g){}return j;};return{traverse:a,readBlob:b,requestUrlAsBlob:r,parseJson:d};});s("tinymce/imagetoolsplugin/Proxy",["global!tinymce.util.Promise","global!tinymce.util.Tools","tinymce/imagetoolsplugin/Utils"],function(P,T,U){var i=function(j){return j===400||j===403||j===500;};var h=function(j){return P.reject("ImageProxy HTTP error: "+j);};var a=function(j){P.reject("ImageProxy Service error: "+j);};var b=function(j,k){return U.readBlob(k).then(function(m){var w=U.parseJson(m);var x=U.traverse(w,['error','type']);return x?a(x):a('Invalid JSON');});};var d=function(j,k){return i(j)?b(j,k):h(j);};var r=function(j,k){return U.requestUrlAsBlob(j,{'Content-Type':'application/json;charset=UTF-8','tiny-api-key':k}).then(function(m){return m.status>=400?d(m.status,m.blob):P.resolve(m.blob);});};function e(j){return U.requestUrlAsBlob(j,{}).then(function(k){return k.status>=400?h(k.status):P.resolve(k.blob);});}var g=function(j,k){return k?r(j,k):e(j);};return{getUrl:g};});s("tinymce/imagetoolsplugin/Plugin",["global!tinymce.PluginManager","global!tinymce.Env","global!tinymce.util.Promise","global!tinymce.util.URI","global!tinymce.util.Tools","global!tinymce.util.Delay","ephox/imagetools/api/ImageTransformations","ephox/imagetools/api/BlobConversions","tinymce/imagetoolsplugin/Dialog","tinymce/imagetoolsplugin/ImageSize","tinymce/imagetoolsplugin/Proxy"],function(P,E,a,U,T,D,I,B,b,d,g){var h=function(i){var j=0,k,r;if(!E.fileApi){return;}function w(e){i.notificationManager.open({text:e,type:'error'});}function x(){return i.selection.getNode();}function y(e){var m=e.match(/\/([^\/\?]+)?\.(?:jpeg|jpg|png|gif)(?:\?|$)/i);if(m){return i.dom.encode(m[1]);}return null;}function z(){return'imagetools'+j++;}function A(e){var m=e.src;return m.indexOf('data:')===0||m.indexOf('blob:')===0||new U(m).host===i.documentBaseURI.host;}function C(e){return T.inArray(i.settings.imagetools_cors_hosts,new U(e.src).host)!==-1;}function F(){return i.settings.api_key||i.settings.imagetools_api_key;}function G(e){var m=e.src,X;if(C(e)){return g.getUrl(e.src,null);}if(!A(e)){m=i.settings.imagetools_proxy;m+=(m.indexOf('?')===-1?'?':'&')+'url='+encodeURIComponent(e.src);X=F();return g.getUrl(m,X);}return B.imageToBlob(e);}function H(){var e;e=i.editorUpload.blobCache.getByUri(x().src);if(e){return e.blob();}return G(x());}function J(){k=D.setEditorTimeout(i,function(){i.editorUpload.uploadImagesAuto();},i.settings.images_upload_timeout||30000);}function K(){clearTimeout(k);}function L(e,m){return B.blobToDataUri(e).then(function(X){var Y,Z,$,_,a1,b1;b1=x();_=i.editorUpload.blobCache;a1=_.getByUri(b1.src);$=U.parseDataUri(X).data;Y=z();if(i.settings.images_reuse_filename){Z=a1?a1.filename():y(b1.src);}a1=_.create(Y,e,$,Z);_.add(a1);i.undoManager.transact(function(){function c1(){i.$(b1).off('load',c1);i.nodeChanged();if(m){i.editorUpload.uploadImagesAuto();}else{K();J();}}i.$(b1).on('load',c1);i.$(b1).attr({src:a1.blobUri()}).removeAttr('data-mce-src');});return a1;});}function M(e){return function(){return i._scanForImages().then(H).then(e).then(L,w);};}function N(e){return function(){return M(function(m){var X=d.getImageSize(x());if(X){d.setImageSize(x(),{w:X.h,h:X.w});}return I.rotate(m,e);})();};}function O(e){return function(){return M(function(m){return I.flip(m,e);})();};}function Q(){var e=x(),m=d.getNaturalImageSize(e);var X=function(Z){return new a(function($){B.blobToImage(Z).then(function(_){var a1=d.getNaturalImageSize(_);if(m.w!=a1.w||m.h!=a1.h){if(d.getImageSize(e)){d.setImageSize(e,a1);}}URL.revokeObjectURL(_.src);$(Z);});});};var Y=function(Z){return b.edit(Z).then(X).then(function(Z){L(Z,true);},function(){});};if(e){G(e).then(Y,w);}}function R(){i.addButton('rotateleft',{title:'Rotate counterclockwise',cmd:'mceImageRotateLeft'});i.addButton('rotateright',{title:'Rotate clockwise',cmd:'mceImageRotateRight'});i.addButton('flipv',{title:'Flip vertically',cmd:'mceImageFlipVertical'});i.addButton('fliph',{title:'Flip horizontally',cmd:'mceImageFlipHorizontal'});i.addButton('editimage',{title:'Edit image',cmd:'mceEditImage'});i.addButton('imageoptions',{title:'Image options',icon:'options',cmd:'mceImage'});}function S(){i.on('NodeChange',function(e){if(r&&r.src!=e.element.src){K();i.editorUpload.uploadImagesAuto();r=undefined;}if(V(e.element)){r=e.element;}});}function V(e){var m=i.dom.is(e,'img:not([data-mce-object],[data-mce-placeholder])');return m&&(A(e)||C(e)||i.settings.imagetools_proxy);}function W(){var e=i.settings.imagetools_toolbar;if(!e){e='rotateleft rotateright | flipv fliph | crop editimage imageoptions';}i.addContextToolbar(V,e);}T.each({mceImageRotateLeft:N(-90),mceImageRotateRight:N(90),mceImageFlipVertical:O('v'),mceImageFlipHorizontal:O('h'),mceEditImage:Q},function(e,m){i.addCommand(m,e);});R();W();S();};P.add('imagetools',h);return function(){};});o('tinymce/imagetoolsplugin/Plugin')();})();
