tinyMCEPopup.requireLangPack();var templates={"window.open":"window.open('${url}','${target}','${options}')"};
function preinit(){var u;if(u=tinyMCEPopup.getParam("external_link_list_url"))document.write('<script language="javascript" type="text/javascript" src="'+tinyMCEPopup.editor.documentBaseURI.toAbsolute(u)+'"></script>');}
function changeClass(){var f=document.forms[0];f.classes.value=getSelectValue(f,'classlist');}
function init(){tinyMCEPopup.resizeToInnerSize();var f=document.forms[0];var i=tinyMCEPopup.editor;var e=i.selection.getNode();var a="insert";var h;document.getElementById('hrefbrowsercontainer').innerHTML=getBrowserHTML('hrefbrowser','href','file','advlink');document.getElementById('popupurlbrowsercontainer').innerHTML=getBrowserHTML('popupurlbrowser','popupurl','file','advlink');document.getElementById('targetlistcontainer').innerHTML=getTargetListHTML('targetlist','target');h=getLinkListHTML('linklisthref','href');if(h=="")document.getElementById("linklisthrefrow").style.display='none';else document.getElementById("linklisthrefcontainer").innerHTML=h;h=getAnchorListHTML('anchorlist','href');if(h=="")document.getElementById("anchorlistrow").style.display='none';else document.getElementById("anchorlistcontainer").innerHTML=h;if(isVisible('hrefbrowser'))document.getElementById('href').style.width='260px';if(isVisible('popupurlbrowser'))document.getElementById('popupurl').style.width='180px';e=i.dom.getParent(e,"A");if(e==null){var p=i.dom.create("p",null,i.selection.getContent());if(p.childNodes.length===1){e=p.firstChild;}}if(e!=null&&e.nodeName=="A")a="update";f.insert.value=tinyMCEPopup.getLang(a,'Insert',true);setPopupControlsDisabled(true);if(a=="update"){var b=i.dom.getAttrib(e,'href');var o=i.dom.getAttrib(e,'onclick');var l=i.dom.getAttrib(e,'target')?i.dom.getAttrib(e,'target'):"_self";setFormValue('href',b);setFormValue('title',i.dom.getAttrib(e,'title'));setFormValue('id',i.dom.getAttrib(e,'id'));setFormValue('style',i.dom.getAttrib(e,"style"));setFormValue('rel',i.dom.getAttrib(e,'rel'));setFormValue('rev',i.dom.getAttrib(e,'rev'));setFormValue('charset',i.dom.getAttrib(e,'charset'));setFormValue('hreflang',i.dom.getAttrib(e,'hreflang'));setFormValue('dir',i.dom.getAttrib(e,'dir'));setFormValue('lang',i.dom.getAttrib(e,'lang'));setFormValue('tabindex',i.dom.getAttrib(e,'tabindex',typeof(e.tabindex)!="undefined"?e.tabindex:""));setFormValue('accesskey',i.dom.getAttrib(e,'accesskey',typeof(e.accesskey)!="undefined"?e.accesskey:""));setFormValue('type',i.dom.getAttrib(e,'type'));setFormValue('onfocus',i.dom.getAttrib(e,'onfocus'));setFormValue('onblur',i.dom.getAttrib(e,'onblur'));setFormValue('onclick',o);setFormValue('ondblclick',i.dom.getAttrib(e,'ondblclick'));setFormValue('onmousedown',i.dom.getAttrib(e,'onmousedown'));setFormValue('onmouseup',i.dom.getAttrib(e,'onmouseup'));setFormValue('onmouseover',i.dom.getAttrib(e,'onmouseover'));setFormValue('onmousemove',i.dom.getAttrib(e,'onmousemove'));setFormValue('onmouseout',i.dom.getAttrib(e,'onmouseout'));setFormValue('onkeypress',i.dom.getAttrib(e,'onkeypress'));setFormValue('onkeydown',i.dom.getAttrib(e,'onkeydown'));setFormValue('onkeyup',i.dom.getAttrib(e,'onkeyup'));setFormValue('target',l);setFormValue('classes',i.dom.getAttrib(e,'class'));if(o!=null&&o.indexOf('window.open')!=-1)parseWindowOpen(o);else parseFunction(o);selectByValue(f,'dir',i.dom.getAttrib(e,'dir'));selectByValue(f,'rel',i.dom.getAttrib(e,'rel'));selectByValue(f,'rev',i.dom.getAttrib(e,'rev'));selectByValue(f,'linklisthref',b);if(b.charAt(0)=='#')selectByValue(f,'anchorlist',b);addClassesToList('classlist','advlink_styles');selectByValue(f,'classlist',i.dom.getAttrib(e,'class'),true);selectByValue(f,'targetlist',l,true);}else addClassesToList('classlist','advlink_styles');}
function checkPrefix(n){if(n.value&&Validator.isEmail(n)&&!/^\s*mailto:/i.test(n.value)&&confirm(tinyMCEPopup.getLang('advlink_dlg.is_email')))n.value='mailto:'+n.value;if(/^\s*www\./i.test(n.value)&&confirm(tinyMCEPopup.getLang('advlink_dlg.is_external')))n.value='http://'+n.value;}
function setFormValue(n,v){document.forms[0].elements[n].value=v;}
function parseWindowOpen(o){var f=document.forms[0];if(o.indexOf('return false;')!=-1){f.popupreturn.checked=true;o=o.replace('return false;','');}else f.popupreturn.checked=false;var a=parseLink(o);if(a!=null){f.ispopup.checked=true;setPopupControlsDisabled(false);var b=parseOptions(a['options']);var u=a['url'];f.popupname.value=a['target'];f.popupurl.value=u;f.popupwidth.value=getOption(b,'width');f.popupheight.value=getOption(b,'height');f.popupleft.value=getOption(b,'left');f.popuptop.value=getOption(b,'top');if(f.popupleft.value.indexOf('screen')!=-1)f.popupleft.value="c";if(f.popuptop.value.indexOf('screen')!=-1)f.popuptop.value="c";f.popuplocation.checked=getOption(b,'location')=="yes";f.popupscrollbars.checked=getOption(b,'scrollbars')=="yes";f.popupmenubar.checked=getOption(b,'menubar')=="yes";f.popupresizable.checked=getOption(b,'resizable')=="yes";f.popuptoolbar.checked=getOption(b,'toolbar')=="yes";f.popupstatus.checked=getOption(b,'status')=="yes";f.popupdependent.checked=getOption(b,'dependent')=="yes";buildOnClick();}}
function parseFunction(o){var f=document.forms[0];var a=parseLink(o);}
function getOption(o,n){return typeof(o[n])=="undefined"?"":o[n];}
function setPopupControlsDisabled(s){var f=document.forms[0];f.popupname.disabled=s;f.popupurl.disabled=s;f.popupwidth.disabled=s;f.popupheight.disabled=s;f.popupleft.disabled=s;f.popuptop.disabled=s;f.popuplocation.disabled=s;f.popupscrollbars.disabled=s;f.popupmenubar.disabled=s;f.popupresizable.disabled=s;f.popuptoolbar.disabled=s;f.popupstatus.disabled=s;f.popupreturn.disabled=s;f.popupdependent.disabled=s;setBrowserDisabled('popupurlbrowser',s);}
function parseLink(l){l=l.replace(new RegExp('&#39;','g'),"'");var n=l.replace(new RegExp("\\s*([A-Za-z0-9\.]*)\\s*\\(.*","gi"),"$1");var t=templates[n];if(t){var v=t.match(new RegExp("'?\\$\\{[A-Za-z0-9\.]*\\}'?","gi"));var r="\\s*[A-Za-z0-9\.]*\\s*\\(";var a="";for(var i=0;i<v.length;i++){if(v[i].indexOf("'${")!=-1)r+="'(.*)'";else r+="([0-9]*)";a+="$"+(i+1);v[i]=v[i].replace(new RegExp("[^A-Za-z0-9]","gi"),"");if(i!=v.length-1){r+="\\s*,\\s*";a+="<delim>";}else r+=".*";}r+="\\);?";var b=[];b["_function"]=n;var c=l.replace(new RegExp(r,"gi"),a).split('<delim>');for(var i=0;i<v.length;i++)b[v[i]]=c[i];return b;}return null;}
function parseOptions(o){if(o==null||o=="")return[];o=o.toLowerCase();o=o.replace(/;/g,",");o=o.replace(/[^0-9a-z=,]/g,"");var a=o.split(',');var b=[];for(var i=0;i<a.length;i++){var p=a[i].split('=');if(p.length==2)b[p[0]]=p[1];}return b;}
function buildOnClick(){var f=document.forms[0];if(!f.ispopup.checked){f.onclick.value="";return;}var o="window.open('";var u=f.popupurl.value;o+=u+"','";o+=f.popupname.value+"','";if(f.popuplocation.checked)o+="location=yes,";if(f.popupscrollbars.checked)o+="scrollbars=yes,";if(f.popupmenubar.checked)o+="menubar=yes,";if(f.popupresizable.checked)o+="resizable=yes,";if(f.popuptoolbar.checked)o+="toolbar=yes,";if(f.popupstatus.checked)o+="status=yes,";if(f.popupdependent.checked)o+="dependent=yes,";if(f.popupwidth.value!="")o+="width="+f.popupwidth.value+",";if(f.popupheight.value!="")o+="height="+f.popupheight.value+",";if(f.popupleft.value!=""){if(f.popupleft.value!="c")o+="left="+f.popupleft.value+",";else o+="left='+(screen.availWidth/2-"+(f.popupwidth.value/2)+")+',";}if(f.popuptop.value!=""){if(f.popuptop.value!="c")o+="top="+f.popuptop.value+",";else o+="top='+(screen.availHeight/2-"+(f.popupheight.value/2)+")+',";}if(o.charAt(o.length-1)==',')o=o.substring(0,o.length-1);o+="');";if(f.popupreturn.checked)o+="return false;";f.onclick.value=o;if(f.href.value=="")f.href.value=u;}
function setAttrib(e,a,v){var f=document.forms[0];var b=f.elements[a.toLowerCase()];var d=tinyMCEPopup.editor.dom;if(typeof(v)=="undefined"||v==null){v="";if(b)v=b.value;}if(a=='style')v=d.serializeStyle(d.parseStyle(v),'a');d.setAttrib(e,a,v);}
function getAnchorListHTML(a,t){var e=tinyMCEPopup.editor,n=e.dom.select('a'),b,i,l,h="";for(i=0,l=n.length;i<l;i++){if((b=e.dom.getAttrib(n[i],"name"))!="")h+='<option value="#'+b+'">'+b+'</option>';if((b=n[i].id)!=""&&!n[i].href)h+='<option value="#'+b+'">'+b+'</option>';}if(h=="")return"";h='<select id="'+a+'" name="'+a+'" class="mceAnchorList"'+' onchange="this.form.'+t+'.value=this.options[this.selectedIndex].value"'+'>'+'<option value="">---</option>'+h+'</select>';return h;}
function insertAction(){var a=tinyMCEPopup.editor;var e,b,i;e=a.selection.getNode();checkPrefix(document.forms[0].href);e=a.dom.getParent(e,"A");if(!document.forms[0].href.value){i=a.selection.getBookmark();a.dom.remove(e,1);a.selection.moveToBookmark(i);tinyMCEPopup.execCommand("mceEndUndoLevel");tinyMCEPopup.close();return;}if(e==null){a.getDoc().execCommand("unlink",false,null);tinyMCEPopup.execCommand("mceInsertLink",false,"#mce_temp_url#",{skip_undo:1});b=tinymce.grep(a.dom.select("a"),function(n){return a.dom.getAttrib(n,'href')=='#mce_temp_url#';});for(i=0;i<b.length;i++)setAllAttribs(e=b[i]);}else setAllAttribs(e);if(e.childNodes.length!=1||e.firstChild.nodeName!='IMG'){a.focus();a.selection.select(e);a.selection.collapse(0);tinyMCEPopup.storeSelection();}tinyMCEPopup.execCommand("mceEndUndoLevel");tinyMCEPopup.close();}
function setAllAttribs(e){var f=document.forms[0];var h=f.href.value.replace(/ /g,'%20');var t=getSelectValue(f,'targetlist');setAttrib(e,'href',h);setAttrib(e,'title');setAttrib(e,'target',t=='_self'?'':t);setAttrib(e,'id');setAttrib(e,'style');setAttrib(e,'class',getSelectValue(f,'classlist'));setAttrib(e,'rel');setAttrib(e,'rev');setAttrib(e,'charset');setAttrib(e,'hreflang');setAttrib(e,'dir');setAttrib(e,'lang');setAttrib(e,'tabindex');setAttrib(e,'accesskey');setAttrib(e,'type');setAttrib(e,'onfocus');setAttrib(e,'onblur');setAttrib(e,'onclick');setAttrib(e,'ondblclick');setAttrib(e,'onmousedown');setAttrib(e,'onmouseup');setAttrib(e,'onmouseover');setAttrib(e,'onmousemove');setAttrib(e,'onmouseout');setAttrib(e,'onkeypress');setAttrib(e,'onkeydown');setAttrib(e,'onkeyup');if(tinyMCE.isMSIE5)e.outerHTML=e.outerHTML;}
function getSelectValue(f,a){var e=f.elements[a];if(!e||e.options==null||e.selectedIndex==-1)return"";return e.options[e.selectedIndex].value;}
function getLinkListHTML(e,t,o){if(typeof(tinyMCELinkList)=="undefined"||tinyMCELinkList.length==0)return"";var h="";h+='<select id="'+e+'" name="'+e+'"';h+=' class="mceLinkList" onchange="this.form.'+t+'.value=';h+='this.options[this.selectedIndex].value;';if(typeof(o)!="undefined")h+=o+'(\''+t+'\',this.options[this.selectedIndex].text,this.options[this.selectedIndex].value);';h+='"><option value="">---</option>';for(var i=0;i<tinyMCELinkList.length;i++)h+='<option value="'+tinyMCELinkList[i][1]+'">'+tinyMCELinkList[i][0]+'</option>';h+='</select>';return h;}
function getTargetListHTML(e,t){var a=tinyMCEPopup.getParam('theme_advanced_link_targets','').split(';');var h='';h+='<select id="'+e+'" name="'+e+'" onchange="this.form.'+t+'.value=';h+='this.options[this.selectedIndex].value;">';h+='<option value="_self">'+tinyMCEPopup.getLang('advlink_dlg.target_same')+'</option>';h+='<option value="_blank">'+tinyMCEPopup.getLang('advlink_dlg.target_blank')+' (_blank)</option>';h+='<option value="_parent">'+tinyMCEPopup.getLang('advlink_dlg.target_parent')+' (_parent)</option>';h+='<option value="_top">'+tinyMCEPopup.getLang('advlink_dlg.target_top')+' (_top)</option>';for(var i=0;i<a.length;i++){var k,v;if(a[i]=="")continue;k=a[i].split('=')[0];v=a[i].split('=')[1];h+='<option value="'+k+'">'+v+' ('+k+')</option>';}h+='</select>';return h;}
preinit();tinyMCEPopup.onInit.add(init);
