(function(){var D=tinymce.DOM;var a=function(o,b,d){var t=function(s){var c=o.controlManager.get(s);var e=b.controlManager.get(s);if(c&&e){e.displayColor(c.value);}};t('forecolor');t('backcolor');b.setContent(o.getContent({format:'raw'}),{format:'raw'});b.selection.moveToBookmark(d);if(o.plugins.spellchecker&&b.plugins.spellchecker){b.plugins.spellchecker.setLanguage(o.plugins.spellchecker.selectedLang);}};tinymce.create('tinymce.plugins.FullScreenPlugin',{init:function(b,u){var t=this,s={},d=D.doc.documentElement,c,f,g,h,i,p,j;b.addCommand('mceFullScreen',function(){var w,o;if(b.getParam('fullscreen_is_enabled')){if(b.getParam('fullscreen_new_window'))closeFullscreen();else{D.win.setTimeout(function(){var k=b;var l=tinyMCE.get(k.getParam('fullscreen_editor_id'));l.plugins.fullscreen.saveState(k);tinyMCE.remove(k);},10);}return;}if(b.getParam('fullscreen_new_window')){t.fullscreenSettings={bookmark:b.selection.getBookmark()};w=D.win.open(u+"/fullscreen.htm","mceFullScreenPopup","fullscreen=yes,menubar=no,toolbar=no,scrollbars=no,resizable=yes,left=0,top=0,width="+screen.availWidth+",height="+screen.availHeight);try{w.resizeTo(screen.availWidth,screen.availHeight);}catch(e){}}else{f=D.getStyle(D.doc.body,'overflow',1)||'auto';g=D.getStyle(d,'overflow',1);c=D.getViewPort();h=c.x;i=c.y;if(tinymce.isOpera&&f=='visible')f='auto';if(tinymce.isIE&&f=='scroll')f='auto';if(tinymce.isIE&&(g=='visible'||g=='scroll'))g='auto';if(f=='0px')f='';D.setStyle(D.doc.body,'overflow','hidden');d.style.overflow='hidden';c=D.getViewPort();D.win.scrollTo(0,0);if(tinymce.isIE)c.h-=1;if(tinymce.isIE6||document.compatMode=='BackCompat')p='absolute;top:'+c.y;else p='fixed;top:0';n=D.add(D.doc.body,'div',{id:'mce_fullscreen_container',style:'position:'+p+';left:0;width:'+c.w+'px;height:'+c.h+'px;z-index:200000;'});D.add(n,'div',{id:'mce_fullscreen'});tinymce.each(b.settings,function(v,n){s[n]=v;});s.id='mce_fullscreen';s.width=n.clientWidth;s.height=n.clientHeight-15;s.fullscreen_is_enabled=true;s.fullscreen_editor_id=b.id;s.theme_advanced_resizing=false;s.save_onsavecallback=function(){b.setContent(tinyMCE.get(s.id).getContent());b.execCommand('mceSave');};tinymce.each(b.getParam('fullscreen_settings'),function(v,k){s[k]=v;});t.fullscreenSettings={bookmark:b.selection.getBookmark(),fullscreen_overflow:f,fullscreen_html_overflow:g,fullscreen_scrollx:h,fullscreen_scrolly:i};if(s.theme_advanced_toolbar_location==='external')s.theme_advanced_toolbar_location='top';tinyMCE.oldSettings=tinyMCE.settings;t.fullscreenEditor=new tinymce.Editor('mce_fullscreen',s);t.fullscreenEditor.onInit.add(function(){t.loadState(t.fullscreenEditor);});t.fullscreenEditor.render();t.fullscreenElement=new tinymce.dom.Element('mce_fullscreen_container');t.fullscreenElement.update();t.resizeFunc=tinymce.dom.Event.add(D.win,'resize',function(){var c=tinymce.DOM.getViewPort(),k=t.fullscreenEditor,l,m;l=k.dom.getSize(k.getContainer().getElementsByTagName('table')[0]);m=k.dom.getSize(k.getContainer().getElementsByTagName('iframe')[0]);k.theme.resizeTo(c.w-l.w+m.w,c.h-l.h+m.h);});}});b.addButton('fullscreen',{title:'fullscreen.desc',cmd:'mceFullScreen'});b.onNodeChange.add(function(b,e){e.setActive('fullscreen',b.getParam('fullscreen_is_enabled'));});t.loadState=function(e){if(!(e&&t.fullscreenSettings)){throw"No fullscreen editor to load to";}a(b,e,t.fullscreenSettings.bookmark);e.focus();};t.saveState=function(e){if(!(e&&t.fullscreenSettings)){throw"No fullscreen editor to restore from";}var k=t.fullscreenSettings;a(e,b,e.selection.getBookmark());if(!b.getParam('fullscreen_new_window')){tinymce.dom.Event.remove(D.win,'resize',t.resizeFunc);delete t.resizeFunc;D.remove('mce_fullscreen_container');D.doc.documentElement.style.overflow=k.fullscreen_html_overflow;D.setStyle(D.doc.body,'overflow',k.fullscreen_overflow);D.win.scrollTo(k.fullscreen_scrollx,k.fullscreen_scrolly);}tinyMCE.settings=tinyMCE.oldSettings;delete tinyMCE.oldSettings;delete t.fullscreenEditor;delete t.fullscreenElement;delete t.fullscreenSettings;D.win.setTimeout(function(){b.selection.moveToBookmark(j);b.focus();},10);};},getInfo:function(){return{longname:'Fullscreen',author:'Moxiecode Systems AB',authorurl:'http://tinymce.moxiecode.com',infourl:'http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/fullscreen',version:tinymce.majorVersion+"."+tinymce.minorVersion};}});tinymce.PluginManager.add('fullscreen',tinymce.plugins.FullScreenPlugin);})();
