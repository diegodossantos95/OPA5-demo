(function(){var b=tinymce.each,d={paste_auto_cleanup_on_paste:true,paste_enable_default_filters:true,paste_block_drop:false,paste_retain_style_properties:"none",paste_strip_class_attributes:"mso",paste_remove_spans:false,paste_remove_styles:false,paste_remove_styles_if_webkit:true,paste_convert_middot_lists:true,paste_convert_headers_to_strong:false,paste_dialog_width:"450",paste_dialog_height:"400",paste_max_consecutive_linebreaks:2,paste_text_use_dialog:false,paste_text_sticky:false,paste_text_sticky_default:false,paste_text_notifyalways:false,paste_text_linebreaktype:"combined",paste_text_replacements:[[/\u2026/g,"..."],[/[\x93\x94\u201c\u201d]/g,'"'],[/[\x60\x91\x92\u2018\u2019]/g,"'"]]};function g(e,n){return e.getParam(n,d[n]);}tinymce.create('tinymce.plugins.PastePlugin',{init:function(a,c){var t=this;t.editor=a;t.url=c;t.onPreProcess=new tinymce.util.Dispatcher(t);t.onPostProcess=new tinymce.util.Dispatcher(t);t.onPreProcess.add(t._preProcess);t.onPostProcess.add(t._postProcess);t.onPreProcess.add(function(e,o){a.execCallback('paste_preprocess',e,o);});t.onPostProcess.add(function(e,o){a.execCallback('paste_postprocess',e,o);});a.onKeyDown.addToTop(function(a,e){if(((tinymce.isMac?e.metaKey:e.ctrlKey)&&e.keyCode==86)||(e.shiftKey&&e.keyCode==45))return false;});a.pasteAsPlainText=g(a,'paste_text_sticky_default');function p(o,e){var h=a.dom,r;t.onPreProcess.dispatch(t,o);o.node=h.create('div',0,o.content);if(tinymce.isGecko){r=a.selection.getRng(true);if(r.startContainer==r.endContainer&&r.startContainer.nodeType==3){if(o.node.childNodes.length===1&&/^(p|h[1-6]|pre)$/i.test(o.node.firstChild.nodeName)&&o.content.indexOf('__MCE_ITEM__')===-1)h.remove(o.node.firstChild,true);}}t.onPostProcess.dispatch(t,o);o.content=a.serializer.serialize(o.node,{getInner:1,forced_root_block:''});if((!e)&&(a.pasteAsPlainText)){t._insertPlainText(o.content);if(!g(a,"paste_text_sticky")){a.pasteAsPlainText=false;a.controlManager.setActive("pastetext",false);}}else{t._insert(o.content);}}a.addCommand('mceInsertClipboardContent',function(u,o){p(o,true);});if(!g(a,"paste_text_use_dialog")){a.addCommand('mcePasteText',function(u,v){var e=tinymce.util.Cookie;a.pasteAsPlainText=!a.pasteAsPlainText;a.controlManager.setActive('pastetext',a.pasteAsPlainText);if((a.pasteAsPlainText)&&(!e.get("tinymcePasteText"))){if(g(a,"paste_text_sticky")){a.windowManager.alert(a.translate('paste.plaintext_mode_sticky'));}else{a.windowManager.alert(a.translate('paste.plaintext_mode'));}if(!g(a,"paste_text_notifyalways")){e.set("tinymcePasteText","1",new Date(new Date().getFullYear()+1,12,31))}}});}a.addButton('pastetext',{title:'paste.paste_text_desc',cmd:'mcePasteText'});a.addButton('selectall',{title:'paste.selectall_desc',cmd:'selectall'});function f(e){var n,o,r,i,s=a.selection,j=a.dom,k=a.getBody(),l,m;if(e.clipboardData||j.doc.dataTransfer){m=(e.clipboardData||j.doc.dataTransfer).getData('Text');if(a.pasteAsPlainText){e.preventDefault();p({content:j.encode(m).replace(/\r?\n/g,'<br />')});return;}}if(j.get('_mcePaste'))return;n=j.add(k,'div',{id:'_mcePaste','class':'mcePaste','data-mce-bogus':'1'},'\uFEFF\uFEFF');if(k!=a.getDoc().body)l=j.getPos(a.selection.getStart(),k).y;else l=k.scrollTop+j.getViewPort(a.getWin()).y;j.setStyles(n,{position:'absolute',left:tinymce.isGecko?-40:0,top:l-25,width:1,height:1,overflow:'hidden'});if(tinymce.isIE){i=s.getRng();r=j.doc.body.createTextRange();r.moveToElementText(n);r.execCommand('Paste');j.remove(n);if(n.innerHTML==='\uFEFF\uFEFF'){a.execCommand('mcePasteWord');e.preventDefault();return;}s.setRng(i);s.setContent('');setTimeout(function(){p({content:n.innerHTML});},0);return tinymce.dom.Event.cancel(e);}else{function q(e){e.preventDefault();};j.bind(a.getDoc(),'mousedown',q);j.bind(a.getDoc(),'keydown',q);o=a.selection.getRng();n=n.firstChild;r=a.getDoc().createRange();r.setStart(n,0);r.setEnd(n,2);s.setRng(r);window.setTimeout(function(){var h='',u;if(!j.select('div.mcePaste > div.mcePaste').length){u=j.select('div.mcePaste');b(u,function(n){var v=n.firstChild;if(v&&v.nodeName=='DIV'&&v.style.marginTop&&v.style.backgroundColor){j.remove(v,1);}b(j.select('span.Apple-style-span',n),function(n){j.remove(n,1);});b(j.select('br[data-mce-bogus]',n),function(n){j.remove(n);});if(n.parentNode.className!='mcePaste')h+=n.innerHTML;});}else{h='<p>'+j.encode(m).replace(/\r?\n\r?\n/g,'</p><p>').replace(/\r?\n/g,'<br />')+'</p>';}b(j.select('div.mcePaste'),function(n){j.remove(n);});if(o)s.setRng(o);p({content:h});j.unbind(a.getDoc(),'mousedown',q);j.unbind(a.getDoc(),'keydown',q);},0);}}if(g(a,"paste_auto_cleanup_on_paste")){if(tinymce.isOpera||/Firefox\/2/.test(navigator.userAgent)){a.onKeyDown.addToTop(function(a,e){if(((tinymce.isMac?e.metaKey:e.ctrlKey)&&e.keyCode==86)||(e.shiftKey&&e.keyCode==45))f(e);});}else{a.onPaste.addToTop(function(a,e){return f(e);});}}a.onInit.add(function(){a.controlManager.setActive("pastetext",a.pasteAsPlainText);if(g(a,"paste_block_drop")){a.dom.bind(a.getBody(),['dragend','dragover','draggesture','dragdrop','drop','drag'],function(e){e.preventDefault();e.stopPropagation();return false;});}});t._legacySupport();},getInfo:function(){return{longname:'Paste text/word',author:'Moxiecode Systems AB',authorurl:'http://tinymce.moxiecode.com',infourl:'http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/paste',version:tinymce.majorVersion+"."+tinymce.minorVersion};},_preProcess:function(p,o){var e=this.editor,h=o.content,a=tinymce.grep,c=tinymce.explode,t=tinymce.trim,l,f;function j(i){b(i,function(v){if(v.constructor==RegExp)h=h.replace(v,'');else h=h.replace(v[0],v[1]);});}if(e.settings.paste_enable_default_filters==false){return;}if(tinymce.isIE&&document.documentMode>=9&&/<(h[1-6r]|p|div|address|pre|form|table|tbody|thead|tfoot|th|tr|td|li|ol|ul|caption|blockquote|center|dl|dt|dd|dir|fieldset)/.test(o.content)){j([[/(?:<br>&nbsp;[\s\r\n]+|<br>)*(<\/?(h[1-6r]|p|div|address|pre|form|table|tbody|thead|tfoot|th|tr|td|li|ol|ul|caption|blockquote|center|dl|dt|dd|dir|fieldset)[^>]*>)(?:<br>&nbsp;[\s\r\n]+|<br>)*/g,'$1']]);j([[/<br><br>/g,'<BR><BR>'],[/<br>/g,' '],[/<BR><BR>/g,'<br>']]);}if(/class="?Mso|style="[^"]*\bmso-|w:WordDocument/i.test(h)||o.wordContent){o.wordContent=true;j([/^\s*(&nbsp;)+/gi,/(&nbsp;|<br[^>]*>)+\s*$/gi]);if(g(e,"paste_convert_headers_to_strong")){h=h.replace(/<p [^>]*class="?MsoHeading"?[^>]*>(.*?)<\/p>/gi,"<p><strong>$1</strong></p>");}if(g(e,"paste_convert_middot_lists")){j([[/<!--\[if !supportLists\]-->/gi,'$&__MCE_ITEM__'],[/(<span[^>]+(?:mso-list:|:\s*symbol)[^>]+>)/gi,'$1__MCE_ITEM__'],[/(<p[^>]+(?:MsoListParagraph)[^>]+>)/gi,'$1__MCE_ITEM__']]);}j([/<!--[\s\S]+?-->/gi,/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|img|meta|link|style|\w:\w+)(?=[\s\/>]))[^>]*>/gi,[/<(\/?)s>/gi,"<$1strike>"],[/&nbsp;/gi,"\u00a0"]]);do{l=h.length;h=h.replace(/(<?!(ol|ul)[^>]*\s)(?:id|name|language|type|on\w+|\w+:\w+)=(?:"[^"]*"|\w+)\s?/gi,"$1");h=h.replace(/(<(ol|ul)[^>]*\s)(?:id|name|language|on\w+|\w+:\w+)=(?:"[^"]*"|\w+)\s?/gi,"$1");}while(l!=h.length);if(g(e,"paste_retain_style_properties").replace(/^none$/i,"").length==0){h=h.replace(/<\/?span[^>]*>/gi,"");}else{j([[/<span\s+style\s*=\s*"\s*mso-spacerun\s*:\s*yes\s*;?\s*"\s*>([\s\u00a0]*)<\/span>/gi,function(s,i){return(i.length>0)?i.replace(/./," ").slice(Math.floor(i.length/2)).split("").join("\u00a0"):"";}],[/(<[a-z][^>]*)\sstyle="([^"]*)"/gi,function(k,m,q){var n=[],i=0,s=c(t(q).replace(/&quot;/gi,"'"),";");b(s,function(v){var u,w,x=c(v,":");function y(v){return v+((v!=="0")&&(/\d$/.test(v)))?"px":"";}if(x.length==2){u=x[0].toLowerCase();w=x[1].toLowerCase();switch(u){case"mso-padding-alt":case"mso-padding-top-alt":case"mso-padding-right-alt":case"mso-padding-bottom-alt":case"mso-padding-left-alt":case"mso-margin-alt":case"mso-margin-top-alt":case"mso-margin-right-alt":case"mso-margin-bottom-alt":case"mso-margin-left-alt":case"mso-table-layout-alt":case"mso-height":case"mso-width":case"mso-vertical-align-alt":n[i++]=u.replace(/^mso-|-alt$/g,"")+":"+y(w);return;case"horiz-align":n[i++]="text-align:"+w;return;case"vert-align":n[i++]="vertical-align:"+w;return;case"font-color":case"mso-foreground":n[i++]="color:"+w;return;case"mso-background":case"mso-highlight":n[i++]="background:"+w;return;case"mso-default-height":n[i++]="min-height:"+y(w);return;case"mso-default-width":n[i++]="min-width:"+y(w);return;case"mso-padding-between-alt":n[i++]="border-collapse:separate;border-spacing:"+y(w);return;case"text-line-through":if((w=="single")||(w=="double")){n[i++]="text-decoration:line-through";}return;case"mso-zero-height":if(w=="yes"){n[i++]="display:none";}return;}if(/^(mso|column|font-emph|lang|layout|line-break|list-image|nav|panose|punct|row|ruby|sep|size|src|tab-|table-border|text-(?!align|decor|indent|trans)|top-bar|version|vnd|word-break)/.test(u)){return;}n[i++]=u+":"+x[1];}});if(i>0){return m+' style="'+n.join(';')+'"';}else{return m;}}]]);}}if(g(e,"paste_convert_headers_to_strong")){j([[/<h[1-6][^>]*>/gi,"<p><strong>"],[/<\/h[1-6][^>]*>/gi,"</strong></p>"]]);}j([[/Version:[\d.]+\nStartHTML:\d+\nEndHTML:\d+\nStartFragment:\d+\nEndFragment:\d+/gi,'']]);f=g(e,"paste_strip_class_attributes");if(f!=="none"){function r(m,i){if(f==="all")return'';var k=a(c(i.replace(/^(["'])(.*)\1$/,"$2")," "),function(v){return(/^(?!mso)/i.test(v));});return k.length?' class="'+k.join(" ")+'"':'';};h=h.replace(/ class="([^"]+)"/gi,r);h=h.replace(/ class=([\-\w]+)/gi,r);}if(g(e,"paste_remove_spans")){h=h.replace(/<\/?span[^>]*>/gi,"");}o.content=h;},_postProcess:function(p,o){var t=this,e=t.editor,c=e.dom,s;if(e.settings.paste_enable_default_filters==false){return;}if(o.wordContent){b(c.select('a',o.node),function(a){if(!a.href||a.href.indexOf('#_Toc')!=-1)c.remove(a,1);});if(g(e,"paste_convert_middot_lists")){t._convertLists(p,o);}s=g(e,"paste_retain_style_properties");if((tinymce.is(s,"string"))&&(s!=="all")&&(s!=="*")){s=tinymce.explode(s.replace(/^none$/i,""));b(c.select('*',o.node),function(a){var n={},f=0,i,h,j;if(s){for(i=0;i<s.length;i++){h=s[i];j=c.getStyle(a,h);if(j){n[h]=j;f++;}}}c.setAttrib(a,'style','');if(s&&f>0)c.setStyles(a,n);else if(a.nodeName=='SPAN'&&!a.className)c.remove(a,true);});}}if(g(e,"paste_remove_styles")||(g(e,"paste_remove_styles_if_webkit")&&tinymce.isWebKit)){b(c.select('*[style]',o.node),function(a){a.removeAttribute('style');a.removeAttribute('data-mce-style');});}else{if(tinymce.isWebKit){b(c.select('*',o.node),function(a){a.removeAttribute('data-mce-style');});}}},_convertLists:function(a,o){var c=a.editor.dom,l,e,f=-1,m,h=[],i,j;b(c.select('p',o.node),function(p){var s,v='',t,j,k,n;for(s=p.firstChild;s&&s.nodeType==3;s=s.nextSibling)v+=s.nodeValue;v=p.innerHTML.replace(/<\/?\w+[^>]*>/gi,'').replace(/&nbsp;/g,'\u00a0');if(/^(__MCE_ITEM__)+[\u2022\u00b7\u00a7\u00d8o\u25CF]\s*\u00a0*/.test(v))t='ul';if(/^__MCE_ITEM__\s*\w+\.\s*\u00a0+/.test(v))t='ol';if(t){m=parseFloat(p.style.marginLeft||0);if(m>f)h.push(m);if(!l||t!=i){l=c.create(t);c.insertAfter(l,p);}else{if(m>f){l=e.appendChild(c.create(t));}else if(m<f){k=tinymce.inArray(h,m);n=c.getParents(l.parentNode,t);l=n[n.length-1-k]||l;}}b(c.select('span',p),function(q){var j=q.innerHTML.replace(/<\/?\w+[^>]*>/gi,'');if(t=='ul'&&/^__MCE_ITEM__[\u2022\u00b7\u00a7\u00d8o\u25CF]/.test(j))c.remove(q);else if(/^__MCE_ITEM__[\s\S]*\w+\.(&nbsp;|\u00a0)*\s*/.test(j))c.remove(q);});j=p.innerHTML;if(t=='ul')j=p.innerHTML.replace(/__MCE_ITEM__/g,'').replace(/^[\u2022\u00b7\u00a7\u00d8o\u25CF]\s*(&nbsp;|\u00a0)+\s*/,'');else j=p.innerHTML.replace(/__MCE_ITEM__/g,'').replace(/^\s*[\w|'<'|'>']+\.(&nbsp;|\u00a0)+\s*/,'');;e=l.appendChild(c.create('li',0,j));c.remove(p);f=m;i=t;}else l=f=0;});j=o.node.innerHTML;if(j.indexOf('__MCE_ITEM__')!=-1)o.node.innerHTML=j.replace(/__MCE_ITEM__/g,'');},_insert:function(h,s){var e=this.editor,r=e.selection.getRng();if(!e.selection.isCollapsed()&&r.startContainer!=r.endContainer)e.getDoc().execCommand('Delete',false,null);e.execCommand('mceInsertContent',false,h,{skip_undo:s});},_insertPlainText:function(c){var e=this.editor,l=g(e,"paste_text_linebreaktype"),r=g(e,"paste_text_replacements"),i=tinymce.is;function p(h){b(h,function(v){if(v.constructor==RegExp)c=c.replace(v,"");else c=c.replace(v[0],v[1]);});};if((typeof(c)==="string")&&(c.length>0)){if(/<(?:p|br|h[1-6]|ul|ol|dl|table|t[rdh]|div|blockquote|fieldset|pre|address|center)[^>]*>/i.test(c)){p([/[\n\r]+/g]);}else{p([/\r+/g]);}p([[/<\/(?:p|h[1-6]|ul|ol|dl|table|div|blockquote|fieldset|pre|address|center)>/gi,"\n\n"],[/<br[^>]*>|<\/tr>/gi,"\n"],[/<\/t[dh]>\s*<t[dh][^>]*>/gi,"\t"],/<[a-z!\/?][^>]*>/gi,[/&nbsp;/gi," "],[/(?:(?!\n)\s)*(\n+)(?:(?!\n)\s)*/gi,"$1"]]);var m=Number(g(e,"paste_max_consecutive_linebreaks"));if(m>-1){var a=new RegExp("\n{"+(m+1)+",}","g");var f="";while(f.length<m){f+="\n";}p([[a,f]]);}c=e.dom.decode(tinymce.html.Entities.encodeRaw(c));if(i(r,"array")){p(r);}else if(i(r,"string")){p(new RegExp(r,"gi"));}if(l=="none"){p([[/\n+/g," "]]);}else if(l=="br"){p([[/\n/g,"<br />"]]);}else if(l=="p"){p([[/\n+/g,"</p><p>"],[/^(.*<\/p>)(<p>)$/,'<p>$1']]);}else{p([[/\n\n/g,"</p><p>"],[/^(.*<\/p>)(<p>)$/,'<p>$1'],[/\n/g,"<br />"]]);}e.execCommand('mceInsertContent',false,c);}},_legacySupport:function(){var t=this,e=t.editor;e.addCommand("mcePasteWord",function(){e.windowManager.open({file:t.url+"/pasteword.htm",width:parseInt(g(e,"paste_dialog_width")),height:parseInt(g(e,"paste_dialog_height")),inline:1});});if(g(e,"paste_text_use_dialog")){e.addCommand("mcePasteText",function(){e.windowManager.open({file:t.url+"/pastetext.htm",width:parseInt(g(e,"paste_dialog_width")),height:parseInt(g(e,"paste_dialog_height")),inline:1});});}e.addButton("pasteword",{title:"paste.paste_word_desc",cmd:"mcePasteWord"});}});tinymce.PluginManager.add("paste",tinymce.plugins.PastePlugin);})();
