(function(){tinymce.create('tinymce.plugins.AutolinkPlugin',{init:function(a,u){var t=this;a.onKeyDown.addToTop(function(a,e){if(e.keyCode==13)return t.handleEnter(a);});if(tinyMCE.isIE)return;a.onKeyPress.add(function(a,e){if(e.which==41)return t.handleEclipse(a);});a.onKeyUp.add(function(a,e){if(e.keyCode==32)return t.handleSpacebar(a);});},handleEclipse:function(e){this.parseCurrentLine(e,-1,'(',true);},handleSpacebar:function(e){this.parseCurrentLine(e,0,'',true);},handleEnter:function(e){this.parseCurrentLine(e,-1,'',false);},parseCurrentLine:function(e,a,d,g){var r,b,s,c,f,t,m,p,l;r=e.selection.getRng(true).cloneRange();if(r.startOffset<5){p=r.endContainer.previousSibling;if(p==null){if(r.endContainer.firstChild==null||r.endContainer.firstChild.nextSibling==null)return;p=r.endContainer.firstChild.nextSibling;}l=p.length;r.setStart(p,l);r.setEnd(p,l);if(r.endOffset<5)return;b=r.endOffset;c=p;}else{c=r.endContainer;if(c.nodeType!=3&&c.firstChild){while(c.nodeType!=3&&c.firstChild)c=c.firstChild;if(c.nodeType==3){r.setStart(c,0);r.setEnd(c,c.nodeValue.length);}}if(r.endOffset==1)b=2;else b=r.endOffset-1-a;}s=b;do{r.setStart(c,b>=2?b-2:0);r.setEnd(c,b>=1?b-1:0);b-=1;}while(r.toString()!=' '&&r.toString()!=''&&r.toString().charCodeAt(0)!=160&&(b-2)>=0&&r.toString()!=d);if(r.toString()==d||r.toString().charCodeAt(0)==160){r.setStart(c,b);r.setEnd(c,s);b+=1;}else if(r.startOffset==0){r.setStart(c,0);r.setEnd(c,s);}else{r.setStart(c,b);r.setEnd(c,s);}var t=r.toString();if(t.charAt(t.length-1)=='.'){r.setEnd(c,s-1);}t=r.toString();m=t.match(/^(https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.|(?:mailto:)?[A-Z0-9._%+-]+@)(.+)$/i);if(m){if(m[1]=='www.'){m[1]='http://www.';}else if(/@$/.test(m[1])&&!/^mailto:/.test(m[1])){m[1]='mailto:'+m[1];}f=e.selection.getBookmark();e.selection.setRng(r);tinyMCE.execCommand('createlink',false,m[1]+m[2]);e.selection.moveToBookmark(f);e.nodeChanged();if(tinyMCE.isWebKit){e.selection.collapse(false);var h=Math.min(c.length,s+1);r.setStart(c,h);r.setEnd(c,h);e.selection.setRng(r);}}},getInfo:function(){return{longname:'Autolink',author:'Moxiecode Systems AB',authorurl:'http://tinymce.moxiecode.com',infourl:'http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/autolink',version:tinymce.majorVersion+"."+tinymce.minorVersion};}});tinymce.PluginManager.add('autolink',tinymce.plugins.AutolinkPlugin);})();
