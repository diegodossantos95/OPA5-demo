var ImageDialog={preInit:function(){var u;tinyMCEPopup.requireLangPack();if(u=tinyMCEPopup.getParam("external_image_list_url"))document.write('<script language="javascript" type="text/javascript" src="'+tinyMCEPopup.editor.documentBaseURI.toAbsolute(u)+'"></script>');},init:function(){var f=document.forms[0],a=tinyMCEPopup.editor;document.getElementById('srcbrowsercontainer').innerHTML=getBrowserHTML('srcbrowser','src','image','theme_advanced_image');if(isVisible('srcbrowser'))document.getElementById('src').style.width='180px';e=a.selection.getNode();this.fillFileList('image_list',tinyMCEPopup.getParam('external_image_list','tinyMCEImageList'));if(e.nodeName=='IMG'){f.src.value=a.dom.getAttrib(e,'src');f.alt.value=a.dom.getAttrib(e,'alt');f.border.value=this.getAttrib(e,'border');f.vspace.value=this.getAttrib(e,'vspace');f.hspace.value=this.getAttrib(e,'hspace');f.width.value=a.dom.getAttrib(e,'width');f.height.value=a.dom.getAttrib(e,'height');f.insert.value=a.getLang('update');this.styleVal=a.dom.getAttrib(e,'style');selectByValue(f,'image_list',f.src.value);selectByValue(f,'align',this.getAttrib(e,'align'));this.updateStyle();}},fillFileList:function(i,l){var d=tinyMCEPopup.dom,a=d.get(i),v,c;l=typeof(l)==='function'?l():window[l];if(l&&l.length>0){a.options[a.options.length]=new Option('','');tinymce.each(l,function(o){a.options[a.options.length]=new Option(o[0],o[1]);});}else d.remove(d.getParent(i,'tr'));},update:function(){var f=document.forms[0],n=f.elements,e=tinyMCEPopup.editor,a={},b;tinyMCEPopup.restoreSelection();if(f.src.value===''){if(e.selection.getNode().nodeName=='IMG'){e.dom.remove(e.selection.getNode());e.execCommand('mceRepaint');}tinyMCEPopup.close();return;}if(!e.settings.inline_styles){a=tinymce.extend(a,{vspace:n.vspace.value,hspace:n.hspace.value,border:n.border.value,align:getSelectValue(f,'align')});}else a.style=this.styleVal;tinymce.extend(a,{src:f.src.value.replace(/ /g,'%20'),alt:f.alt.value,width:f.width.value,height:f.height.value});b=e.selection.getNode();if(b&&b.nodeName=='IMG'){e.dom.setAttribs(b,a);tinyMCEPopup.editor.execCommand('mceRepaint');tinyMCEPopup.editor.focus();}else{tinymce.each(a,function(v,c){if(v===""){delete a[c];}});e.execCommand('mceInsertContent',false,tinyMCEPopup.editor.dom.createHTML('img',a),{skip_undo:1});e.undoManager.add();}tinyMCEPopup.close();},updateStyle:function(){var d=tinyMCEPopup.dom,s={},v,f=document.forms[0];if(tinyMCEPopup.editor.settings.inline_styles){tinymce.each(tinyMCEPopup.dom.parseStyle(this.styleVal),function(a,k){s[k]=a;});v=getSelectValue(f,'align');if(v){if(v=='left'||v=='right'){s['float']=v;delete s['vertical-align'];}else{s['vertical-align']=v;delete s['float'];}}else{delete s['float'];delete s['vertical-align'];}v=f.border.value;if(v||v=='0'){if(v=='0')s['border']='0';else s['border']=v+'px solid black';}else delete s['border'];v=f.hspace.value;if(v){delete s['margin'];s['margin-left']=v+'px';s['margin-right']=v+'px';}else{delete s['margin-left'];delete s['margin-right'];}v=f.vspace.value;if(v){delete s['margin'];s['margin-top']=v+'px';s['margin-bottom']=v+'px';}else{delete s['margin-top'];delete s['margin-bottom'];}s=tinyMCEPopup.dom.parseStyle(d.serializeStyle(s),'img');this.styleVal=d.serializeStyle(s,'img');}},getAttrib:function(e,a){var b=tinyMCEPopup.editor,d=b.dom,v,c;if(b.settings.inline_styles){switch(a){case'align':if(v=d.getStyle(e,'float'))return v;if(v=d.getStyle(e,'vertical-align'))return v;break;case'hspace':v=d.getStyle(e,'margin-left');c=d.getStyle(e,'margin-right');if(v&&v==c)return parseInt(v.replace(/[^0-9]/g,''));break;case'vspace':v=d.getStyle(e,'margin-top');c=d.getStyle(e,'margin-bottom');if(v&&v==c)return parseInt(v.replace(/[^0-9]/g,''));break;case'border':v=0;tinymce.each(['top','right','bottom','left'],function(s){s=d.getStyle(e,'border-'+s+'-width');if(!s||(s!=v&&v!==0)){v=0;return false;}if(s)v=s;});if(v)return parseInt(v.replace(/[^0-9]/g,''));break;}}if(v=d.getAttrib(e,a))return v;return'';},resetImageData:function(){var f=document.forms[0];f.width.value=f.height.value="";},updateImageData:function(){var f=document.forms[0],t=ImageDialog;if(f.width.value=="")f.width.value=t.preloadImg.width;if(f.height.value=="")f.height.value=t.preloadImg.height;},getImageData:function(){var f=document.forms[0];this.preloadImg=new Image();this.preloadImg.onload=this.updateImageData;this.preloadImg.onerror=this.resetImageData;this.preloadImg.src=tinyMCEPopup.editor.documentBaseURI.toAbsolute(f.src.value);}};ImageDialog.preInit();tinyMCEPopup.onInit.add(ImageDialog.init,ImageDialog);
