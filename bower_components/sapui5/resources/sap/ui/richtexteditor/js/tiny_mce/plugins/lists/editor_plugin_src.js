(function(){var a=tinymce.each,E=tinymce.dom.Event,b;function c(e,n){while(e&&(e.nodeType===8||(e.nodeType===3&&/^[ \t\n\r]*$/.test(e.nodeValue)))){e=n(e);}return e;}function d(e){return c(e,function(e){return e.previousSibling;});}function g(e){return c(e,function(e){return e.nextSibling;});}function h(f,e,i){return f.dom.getParent(e,function(p){return tinymce.inArray(i,p)!==-1;});}function j(e){return e&&(e.tagName==='OL'||e.tagName==='UL');}function k(e,f){var t,n,i;t=d(e.lastChild);while(j(t)){n=t;t=d(n.previousSibling);}if(n){i=f.create('li',{style:'list-style-type: none;'});f.split(e,n);f.insertAfter(i,n);i.appendChild(n);i.appendChild(n);e=i.previousSibling;}return e;}function l(e,f,i){e=m(e,f,i);return o(e,f,i);}function m(e,f,i){var p=d(e.previousSibling);if(p){return q(p,e,f?p:false,i);}else{return e;}}function o(e,f,i){var n=g(e.nextSibling);if(n){return q(e,n,f?n:false,i);}else{return e;}}function q(e,f,i,n){if(u(e,f,!!i,n)){return x(e,f,i);}else if(e&&e.tagName==='LI'&&j(f)){e.appendChild(f);}return f;}function u(e,f,i,n){if(!e||!f){return false;}else if(e.tagName==='LI'&&f.tagName==='LI'){return f.style.listStyleType==='none'||w(f);}else if(j(e)){return(e.tagName===f.tagName&&(i||e.style.listStyleType===f.style.listStyleType))||v(f);}else return n&&e.tagName==='P'&&f.tagName==='P';}function v(e){var f=g(e.firstChild),i=d(e.lastChild);return f&&i&&j(e)&&f===i&&(j(f)||f.style.listStyleType==='none'||w(f));}function w(e){var f=g(e.firstChild),i=d(e.lastChild);return f&&i&&f===i&&j(f);}function x(e,f,i){var n=d(e.lastChild),p=g(f.firstChild);if(e.tagName==='P'){e.appendChild(e.ownerDocument.createElement('br'));}while(f.firstChild){e.appendChild(f.firstChild);}if(i){e.style.listStyleType=i.style.listStyleType;}f.parentNode.removeChild(f);q(n,p,false);return e;}function y(e,f){var i;if(!f.is(e,'li,ol,ul')){i=f.getParent(e,'li');if(i){e=i;}}return e;}tinymce.create('tinymce.plugins.Lists',{init:function(f){var L='TABBING';var i='EMPTY';var p='ESCAPE';var r='PARAGRAPH';var s='UNKNOWN';var t=s;function z(e){return e.keyCode===tinymce.VK.TAB&&!(e.altKey||e.ctrlKey)&&(f.queryCommandState('InsertUnorderedList')||f.queryCommandState('InsertOrderedList'));}function A(){var e=D();var n=e.parentNode.parentNode;var W=e.parentNode.lastChild===e;return W&&!B(n)&&F(e);}function B(e){if(j(e)){return e.parentNode&&e.parentNode.tagName==='LI';}else{return e.tagName==='LI';}}function C(){return f.selection.isCollapsed()&&F(D());}function D(){var n=f.selection.getStart();return((n.tagName=='BR'||n.tagName=='')&&n.parentNode.tagName=='LI')?n.parentNode:n;}function F(e){var n=e.childNodes.length;if(e.tagName==='LI'){return n==0?true:n==1&&(e.firstChild.tagName==''||e.firstChild.tagName=='BR'||G(e));}return false;}function G(e){var W=tinymce.grep(e.parentNode.childNodes,function(n){return n.tagName=='LI'});var X=e==W[W.length-1];var Y=e.firstChild;return tinymce.isIE9&&X&&(Y.nodeValue==String.fromCharCode(160)||Y.nodeValue==String.fromCharCode(32));}function H(e){return e.keyCode===tinymce.VK.ENTER;}function I(e){return H(e)&&!e.shiftKey;}function J(e){if(z(e)){return L;}else if(I(e)&&A()){return s;}else if(I(e)&&C()){return i;}else{return s;}}function K(f,e){if(t==L||t==i||tinymce.isGecko&&t==p){E.cancel(e);}}function M(){var e=f.selection.getRng(true);var n=e.startContainer;if(n.nodeType==3){var W=n.nodeValue;if(tinymce.isIE9&&W.length>1&&W.charCodeAt(W.length-1)==32){return(e.endOffset==W.length-1);}else{return(e.endOffset==W.length);}}else if(n.nodeType==1){return e.endOffset==n.childNodes.length;}return false;}function N(){var n=f.selection.getNode();var e='h1,h2,h3,h4,h5,h6,p,div';var W=f.dom.is(n,e)&&n.parentNode.tagName==='LI'&&n.parentNode.lastChild===n;return f.selection.isCollapsed()&&W&&M();}function O(f,e){if(I(e)&&N()){var n=f.selection.getNode();var W=f.dom.create("li");var X=f.dom.getParent(n,'li');f.dom.insertAfter(W,X);if(tinymce.isIE6||tinymce.isIE7||tinyMCE.isIE8){f.selection.setCursorLocation(W,1);}else{f.selection.setCursorLocation(W,0);}e.preventDefault();}}function P(f,e){var W;if(!tinymce.isGecko)return;var n=f.selection.getStart();if(e.keyCode!=tinymce.VK.BACKSPACE||n.tagName!=='IMG')return;function X(b1){var c1=b1.firstChild;var $=null;do{if(!c1)break;if(c1.tagName==='LI')$=c1;}while(c1=c1.nextSibling);return $;}function Y(b1,c1){while(b1.childNodes.length>0)c1.appendChild(b1.childNodes[0]);}W=n.parentNode.previousSibling;if(!W)return;var Z;if(W.tagName==='UL'||W.tagName==='OL')Z=W;else if(W.previousSibling&&(W.previousSibling.tagName==='UL'||W.previousSibling.tagName==='OL'))Z=W.previousSibling;else return;var $=X(Z);var _=f.dom.createRng();_.setStart($,1);_.setEnd($,1);f.selection.setRng(_);f.selection.collapse(true);var b=f.selection.getBookmark();var a1=n.parentNode.cloneNode(true);if(a1.tagName==='P'||a1.tagName==='DIV')Y(a1,$);else $.appendChild(a1);n.parentNode.parentNode.removeChild(n.parentNode);f.selection.moveToBookmark(b);}function Q(e){var n=f.dom.getParent(e,'ol,ul');if(n!=null){var W=n.lastChild;f.selection.setCursorLocation(W,0);}}this.ed=f;f.addCommand('Indent',this.indent,this);f.addCommand('Outdent',this.outdent,this);f.addCommand('InsertUnorderedList',function(){this.applyList('UL','OL');},this);f.addCommand('InsertOrderedList',function(){this.applyList('OL','UL');},this);f.onInit.add(function(){f.editorCommands.addCommands({'outdent':function(){var e=f.selection,W=f.dom;function X(n){n=W.getParent(n,W.isBlock);return n&&(parseInt(f.dom.getStyle(n,'margin-left')||0,10)+parseInt(f.dom.getStyle(n,'padding-left')||0,10))>0;}return X(e.getStart())||X(e.getEnd())||f.queryCommandState('InsertOrderedList')||f.queryCommandState('InsertUnorderedList');}},'state');});f.onKeyUp.add(function(f,e){if(t==L){f.execCommand(e.shiftKey?'Outdent':'Indent',true,null);t=s;return E.cancel(e);}else if(t==i){var W=D();var X=f.settings.list_outdent_on_enter===true||e.shiftKey;f.execCommand(X?'Outdent':'Indent',true,null);if(tinymce.isIE){Q(W);}return E.cancel(e);}else if(t==p){if(tinymce.isIE6||tinymce.isIE7||tinymce.isIE8){var n=f.getDoc().createTextNode('\uFEFF');f.selection.getNode().appendChild(n);}else if(tinymce.isIE9||tinymce.isGecko){f.execCommand('Outdent');return E.cancel(e);}}});function R(e,W){var n=f.getDoc().createTextNode('\uFEFF');e.insertBefore(n,W);f.selection.setCursorLocation(n,0);f.execCommand('mceRepaint');}function S(f,e){if(H(e)){var n=D();if(n){var W=n.parentNode;var X=W&&W.parentNode;if(X&&X.nodeName=='LI'&&X.firstChild==W&&n==W.firstChild){R(X,W);}}}}function T(f,e){if(H(e)){var n=D();if(f.dom.select('ul li',n).length===1){var W=n.firstChild;R(n,W);}}}function U(f,e){function n(W){var Z=[];var $=new tinymce.dom.TreeWalker(W.firstChild,W);for(var _=$.current();_;_=$.next()){if(f.dom.is(_,'ol,ul,li')){Z.push(_);}}return Z;}if(e.keyCode==tinymce.VK.BACKSPACE){var W=D();if(W){var X=f.dom.getParent(W,'ol,ul'),Y=f.selection.getRng();if(X&&X.firstChild===W&&Y.startOffset==0){var Z=n(W);Z.unshift(W);f.execCommand("Outdent",false,Z);f.undoManager.add();return E.cancel(e);}}}}function V(f,e){var W=D();if(e.keyCode===tinymce.VK.BACKSPACE&&f.dom.is(W,'li')&&W.parentNode.firstChild!==W){if(f.dom.select('ul,ol',W).length===1){var X=W.previousSibling;f.dom.remove(f.dom.select('br',W));f.dom.remove(W,true);var Y=tinymce.grep(X.childNodes,function(n){return n.nodeType===3});if(Y.length===1){var Z=Y[0];f.selection.setCursorLocation(Z,Z.length);}f.undoManager.add();return E.cancel(e);}}}f.onKeyDown.add(function(_,e){t=J(e);});f.onKeyDown.add(K);f.onKeyDown.add(P);f.onKeyDown.add(O);if(tinymce.isGecko){f.onKeyUp.add(S);}if(tinymce.isIE8){f.onKeyUp.add(T);}if(tinymce.isGecko||tinymce.isWebKit){f.onKeyDown.add(U);}if(tinymce.isWebKit){f.onKeyDown.add(V);}},applyList:function(f,i){var t=this,p=t.ed,s=p.dom,z=[],A=false,B=false,C=false,D,F=p.selection.getSelectedBlocks();function G(e){if(e&&e.tagName==='BR'){s.remove(e);}}function H(e){var n=s.create(f),r;function N(e){if(e.style.marginLeft||e.style.paddingLeft){t.adjustPaddingFunction(false)(e);}}if(e.tagName==='LI'){}else if(e.tagName==='P'||e.tagName==='DIV'||e.tagName==='BODY'){J(e,function(O,P){I(O,P,e.tagName==='BODY'?null:O.parentNode);r=O.parentNode;N(r);G(P);});if(r){if(r.tagName==='LI'&&(e.tagName==='P'||F.length>1)){s.split(r.parentNode.parentNode,r.parentNode);}l(r.parentNode,true);}return;}else{r=s.create('li');s.insertAfter(r,e);r.appendChild(e);N(e);e=r;}s.insertAfter(n,e);n.appendChild(e);l(n,true);z.push(e);}function I(e,r,N){var O,n=e,P;while(!s.isBlock(e.parentNode)&&e.parentNode!==s.getRoot()){e=s.split(e.parentNode,e.previousSibling);e=e.nextSibling;n=e;}if(N){O=N.cloneNode(true);e.parentNode.insertBefore(O,e);while(O.firstChild)s.remove(O.firstChild);O=s.rename(O,'li');}else{O=s.create('li');e.parentNode.insertBefore(O,e);}while(n&&n!=r){P=n.nextSibling;O.appendChild(n);n=P;}if(O.childNodes.length===0){O.innerHTML='<br _mce_bogus="1" />';}H(O);}function J(e,n){var N,O,P=3,S=1,Q='br,ul,ol,p,div,h1,h2,h3,h4,h5,h6,table,blockquote,address,pre,form,center,dl';function R(V,W){var r=s.createRng(),X;b.keep=true;p.selection.moveToBookmark(b);b.keep=false;X=p.selection.getRng(true);if(!W){W=V.parentNode.lastChild;}r.setStartBefore(V);r.setEndAfter(W);return!(r.compareBoundaryPoints(P,X)>0||r.compareBoundaryPoints(S,X)<=0);}function T(r){if(r.nextSibling)return r.nextSibling;if(!s.isBlock(r.parentNode)&&r.parentNode!==s.getRoot())return T(r.parentNode);}N=e.firstChild;var U=false;a(s.select(Q,e),function(r){if(r.hasAttribute&&r.hasAttribute('_mce_bogus')){return true;}if(R(N,r)){s.addClass(r,'_mce_tagged_br');N=T(r);}});U=(N&&R(N,undefined));N=e.firstChild;a(s.select(Q,e),function(r){var V=T(r);if(r.hasAttribute&&r.hasAttribute('_mce_bogus')){return true;}if(s.hasClass(r,'_mce_tagged_br')){n(N,r,O);O=null;}else{O=r;}N=V;});if(U){n(N,undefined,O);}}function K(e){J(e,function(n,r,N){I(n,r);G(r);G(N);});}function L(e){if(tinymce.inArray(z,e)!==-1){return;}if(e.parentNode.tagName===i){s.split(e.parentNode,e);H(e);o(e.parentNode,false);}z.push(e);}function M(e){var n,r,N,O;if(tinymce.inArray(z,e)!==-1){return;}e=k(e,s);while(s.is(e.parentNode,'ol,ul,li')){s.split(e.parentNode,e);}z.push(e);e=s.rename(e,'p');N=l(e,false,p.settings.force_br_newlines);if(N===e){n=e.firstChild;while(n){if(s.isBlock(n)){n=s.split(n.parentNode,n);O=true;r=n.nextSibling&&n.nextSibling.firstChild;}else{r=n.nextSibling;if(O&&n.tagName==='BR'){s.remove(n);}O=false;}n=r;}}}a(F,function(e){e=y(e,s);if(e.tagName===i||(e.tagName==='LI'&&e.parentNode.tagName===i)){B=true;}else if(e.tagName===f||(e.tagName==='LI'&&e.parentNode.tagName===f)){A=true;}else{C=true;}});if(C&&!A||B||F.length===0){D={'LI':L,'H1':H,'H2':H,'H3':H,'H4':H,'H5':H,'H6':H,'P':H,'BODY':H,'DIV':F.length>1?H:K,defaultAction:K,elements:this.selectedBlocks()};}else{D={defaultAction:M,elements:this.selectedBlocks(),processEvenIfEmpty:true};}this.process(D);},indent:function(){var e=this.ed,f=e.dom,i=[];function n(s){var t=f.create('li',{style:'list-style-type: none;'});f.insertAfter(t,s);return t;}function p(s){var t=n(s),z=f.getParent(s,'ol,ul'),A=z.tagName,B=f.getStyle(z,'list-style-type'),C={},D;if(B!==''){C.style='list-style-type: '+B+';';}D=f.create(A,C);t.appendChild(D);return D;}function r(s){if(!h(e,s,i)){s=k(s,f);var t=p(s);t.appendChild(s);l(t.parentNode,false);l(t,false);i.push(s);}}this.process({'LI':r,defaultAction:this.adjustPaddingFunction(true),elements:this.selectedBlocks()});},outdent:function(e,f){var t=this,i=t.ed,n=i.dom,p=[];function r(z){var A,B,C;if(!h(i,z,p)){if(n.getStyle(z,'margin-left')!==''||n.getStyle(z,'padding-left')!==''){return t.adjustPaddingFunction(false)(z);}C=n.getStyle(z,'text-align',true);if(C==='center'||C==='right'){n.setStyle(z,'text-align','left');return;}z=k(z,n);A=z.parentNode;B=z.parentNode.parentNode;if(B.tagName==='P'){n.split(B,z.parentNode);}else{n.split(A,z);if(B.tagName==='LI'){n.split(B,z);}else if(!n.is(B,'ol,ul')){n.rename(z,'p');}}p.push(z);}}var s=f&&tinymce.is(f,'array')?f:this.selectedBlocks();this.process({'LI':r,defaultAction:this.adjustPaddingFunction(false),elements:s});a(p,l);},process:function(e){var t=this,f=t.ed.selection,z=t.ed.dom,A,r;function B(p){var H=tinymce.grep(p.childNodes,function(n){return!(n.nodeName==='BR'||n.nodeName==='SPAN'&&z.getAttrib(n,'data-mce-type')=='bookmark'||n.nodeType==3&&(n.nodeValue==String.fromCharCode(160)||n.nodeValue==''));});return H.length===0;}function C(n){z.removeClass(n,'_mce_act_on');if(!n||n.nodeType!==1||!e.processEvenIfEmpty&&A.length>1&&B(n)){return;}n=y(n,z);var p=e[n.tagName];if(!p){p=e.defaultAction;}p(n);}function D(n){t.splitSafeEach(n.childNodes,C,true);}function F(n,p){return p>=0&&n.hasChildNodes()&&p<n.childNodes.length&&n.childNodes[p].tagName==='BR';}function G(){var n=f.getNode();var p=z.getParent(n,'td');return p!==null;}A=e.elements;r=f.getRng(true);if(!r.collapsed){if(F(r.endContainer,r.endOffset-1)){r.setEnd(r.endContainer,r.endOffset-1);f.setRng(r);}if(F(r.startContainer,r.startOffset)){r.setStart(r.startContainer,r.startOffset+1);f.setRng(r);}}if(tinymce.isIE8){var s=t.ed.selection.getNode();if(s.tagName==='LI'&&!(s.parentNode.lastChild===s)){var i=t.ed.getDoc().createTextNode('\uFEFF');s.appendChild(i);}}b=f.getBookmark();e.OL=e.UL=D;t.splitSafeEach(A,C);f.moveToBookmark(b);b=null;if(!G()){t.ed.execCommand('mceRepaint');}},splitSafeEach:function(e,f,i){if(i||(tinymce.isGecko&&(/Firefox\/[12]\.[0-9]/.test(navigator.userAgent)||/Firefox\/3\.[0-4]/.test(navigator.userAgent)))){this.classBasedEach(e,f);}else{a(e,f);}},classBasedEach:function(e,f){var i=this.ed.dom,n,p;a(e,function(p){i.addClass(p,'_mce_act_on');});n=i.select('._mce_act_on');while(n.length>0){p=n.shift();i.removeClass(p,'_mce_act_on');f(p);n=i.select('._mce_act_on');}},adjustPaddingFunction:function(i){var e,f,n=this.ed;e=n.settings.indentation;f=/[a-z%]+/i.exec(e);e=parseInt(e,10);return function(p){var r,s;r=parseInt(n.dom.getStyle(p,'margin-left')||0,10)+parseInt(n.dom.getStyle(p,'padding-left')||0,10);if(i){s=r+e;}else{s=r-e;}n.dom.setStyle(p,'padding-left','');n.dom.setStyle(p,'margin-left',s>0?s+f:'');};},selectedBlocks:function(){var e=this.ed,s=e.selection.getSelectedBlocks();return s.length==0?[e.dom.getRoot()]:s;},getInfo:function(){return{longname:'Lists',author:'Moxiecode Systems AB',authorurl:'http://tinymce.moxiecode.com',infourl:'http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/lists',version:tinymce.majorVersion+"."+tinymce.minorVersion};}});tinymce.PluginManager.add("lists",tinymce.plugins.Lists);}());
