(function(){var a=tinymce.each;tinymce.create('tinymce.plugins.TemplatePlugin',{init:function(b,u){var t=this;t.editor=b;b.addCommand('mceTemplate',function(c){b.windowManager.open({file:u+'/template.htm',width:b.getParam('template_popup_width',750),height:b.getParam('template_popup_height',600),inline:1},{plugin_url:u});});b.addCommand('mceInsertTemplate',t._insertTemplate,t);b.addButton('template',{title:'template.desc',cmd:'mceTemplate'});b.onPreProcess.add(function(b,o){var d=b.dom;a(d.select('div',o.node),function(e){if(d.hasClass(e,'mceTmpl')){a(d.select('*',e),function(e){if(d.hasClass(e,b.getParam('template_mdate_classes','mdate').replace(/\s+/g,'|')))e.innerHTML=t._getDateTime(new Date(),b.getParam("template_mdate_format",b.getLang("template.mdate_format")));});t._replaceVals(e);}});});},getInfo:function(){return{longname:'Template plugin',author:'Moxiecode Systems AB',authorurl:'http://www.moxiecode.com',infourl:'http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/template',version:tinymce.majorVersion+"."+tinymce.minorVersion};},_insertTemplate:function(u,v){var t=this,e=t.editor,h,b,d=e.dom,s=e.selection.getContent();h=v.content;a(t.editor.getParam('template_replace_values'),function(v,k){if(typeof(v)!='function')h=h.replace(new RegExp('\\{\\$'+k+'\\}','g'),v);});b=d.create('div',null,h);n=d.select('.mceTmpl',b);if(n&&n.length>0){b=d.create('div',null);b.appendChild(n[0].cloneNode(true));}function f(n,c){return new RegExp('\\b'+c+'\\b','g').test(n.className);};a(d.select('*',b),function(n){if(f(n,e.getParam('template_cdate_classes','cdate').replace(/\s+/g,'|')))n.innerHTML=t._getDateTime(new Date(),e.getParam("template_cdate_format",e.getLang("template.cdate_format")));if(f(n,e.getParam('template_mdate_classes','mdate').replace(/\s+/g,'|')))n.innerHTML=t._getDateTime(new Date(),e.getParam("template_mdate_format",e.getLang("template.mdate_format")));if(f(n,e.getParam('template_selected_content_classes','selcontent').replace(/\s+/g,'|')))n.innerHTML=s;});t._replaceVals(b);e.execCommand('mceInsertContent',false,b.innerHTML);e.addVisual();},_replaceVals:function(e){var d=this.editor.dom,b=this.editor.getParam('template_replace_values');a(d.select('*',e),function(e){a(b,function(v,k){if(d.hasClass(e,k)){if(typeof(b[k])=='function')b[k](e);}});});},_getDateTime:function(d,f){if(!f)return"";function b(v,l){var i;v=""+v;if(v.length<l){for(i=0;i<(l-v.length);i++)v="0"+v;}return v;}f=f.replace("%D","%m/%d/%y");f=f.replace("%r","%I:%M:%S %p");f=f.replace("%Y",""+d.getFullYear());f=f.replace("%y",""+d.getYear());f=f.replace("%m",b(d.getMonth()+1,2));f=f.replace("%d",b(d.getDate(),2));f=f.replace("%H",""+b(d.getHours(),2));f=f.replace("%M",""+b(d.getMinutes(),2));f=f.replace("%S",""+b(d.getSeconds(),2));f=f.replace("%I",""+((d.getHours()+11)%12+1));f=f.replace("%p",""+(d.getHours()<12?"AM":"PM"));f=f.replace("%B",""+this.editor.getLang("template_months_long").split(',')[d.getMonth()]);f=f.replace("%b",""+this.editor.getLang("template_months_short").split(',')[d.getMonth()]);f=f.replace("%A",""+this.editor.getLang("template_day_long").split(',')[d.getDay()]);f=f.replace("%a",""+this.editor.getLang("template_day_short").split(',')[d.getDay()]);f=f.replace("%%","%");return f;}});tinymce.PluginManager.add('template',tinymce.plugins.TemplatePlugin);})();
