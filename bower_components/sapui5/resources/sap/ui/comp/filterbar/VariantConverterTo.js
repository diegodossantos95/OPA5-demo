/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2017 SAP SE. All rights reserved
 */
sap.ui.define(['jquery.sap.global','sap/ui/comp/library','sap/ui/comp/valuehelpdialog/ValueHelpDialog','sap/ui/comp/odata/ODataType','sap/ui/comp/util/FormatUtil'],function(q,l,V,O,F){"use strict";var a=function(){};a.prototype.convert=function(k,f,d,o,v){var b,i,j,J,n=null,B,s;var S={SelectionVariantID:k};this._sAPILevel=v;if(d&&f){j=JSON.parse(d);if(j){b=this._getFields(f);if(b&&b.length>0){for(i=0;i<b.length;i++){this._convertField(S,b[i],j,o);}}if(j._CUSTOM){if(typeof j._CUSTOM==="string"){J=JSON.parse(j._CUSTOM);}else{J=j._CUSTOM;}for(n in J){if(n){this._addSingleValue(S,n,a._getValue(J[n],true));}}}if(o&&o.getBasicSearchName){B=o.getBasicSearchName();if(B){s=o.getBasicSearchValue();this._addSingleValue(S,B,a._getValue(s,true));}}}}return JSON.stringify(S);};a.prototype._getParameterMetaData=function(n,f){var i,j,g;var b=f.getFilterBarViewMetadata();if(b){for(i=0;i<b.length;i++){g=b[i];for(j=0;j<g.fields.length;j++){if(n===g.fields[j].fieldName){return g.fields[j];}}}}if(f.getAnalyticalParameters){var A=f.getAnalyticalParameters();if(A){for(j=0;j<A.length;j++){if(n===A[j].fieldName){return A[j];}}}}return null;};a.prototype._convertField=function(s,f,c,o){var b,v,d=null,r,e;if(c&&f&&s){b=c[f];if(b){e=this._getParameterMetaData(f,o);if(e){if(e.isCustomFilterField){return;}if(e.filterRestriction===sap.ui.comp.smartfilterbar.FilterType.single){v=(b.value===undefined)?b:b.value;v=a._getValue(v,true);this._addSingleValue(s,f,v);}else if(e.filterRestriction===sap.ui.comp.smartfilterbar.FilterType.interval){if(b.conditionTypeInfo){this._convertFieldByValue(s,f,c,e);}else{r=a.addRangeEntry(s,f);if((e.type==="Edm.DateTime")&&!b.high){b.high=b.low;}else if((e.type==="Edm.String")&&!b.high){d="EQ";}if(e.type==="Edm.Time"){this._addRangeMultipleRangeValues(r,b.ranges,true);}else if(O.isNumeric(e.type)&&!b.high){var d="BT",g=F.parseFilterNumericIntervalData(b.low);if(g&&(g.length===2)&&g[0]){this._addRangeLowHigh(r,{low:g[0],high:g[1]},"BT");}else{this._addRangeLowHigh(r,b,"EQ");}}else{this._addRangeLowHigh(r,b,d);}}}else if(e.filterRestriction===sap.ui.comp.smartfilterbar.FilterType.multiple){r=a.addRangeEntry(s,f);if(b.items&&b.items.length>0){this._addRangeMultipleSingleValues(r,b.items);}else if(b.ranges&&b.ranges.length>0){this._addRangeMultipleRangeValues(r,b.ranges);}else{this._addRangeSingleValue(r,b.value);}}else{this._convertFieldByValue(s,f,c,e);}}else{this._convertFieldByValue(s,f,c,e);}}}};a.prototype._convertFieldByValue=function(s,f,c,o){var b;var r;if(c&&f&&s){b=c[f];if(b){if(b.conditionTypeInfo){if(b.ranges&&b.ranges.length>0){r=a.addRangeEntry(s,f);a.addRanges(r,b.ranges);}}else if((b.ranges!==undefined)&&(b.items!==undefined)&&(b.value!==undefined)){r=a.addRangeEntry(s,f);if(b.ranges&&b.ranges.length>0){a.addRanges(r,b.ranges);}if(b.items&&b.items.length>0){this._addRangeMultipleSingleValues(r,b.items);}if(b.value){this._addRangeSingleValue(r,b.value);}}else if((b.items!==undefined)&&b.items&&(b.items.length>0)){r=a.addRangeEntry(s,f);this._addRangeMultipleSingleValues(r,b.items);}else if((b.low!==undefined)&&b.low&&(b.high!==undefined)&&b.high){r=a.addRangeEntry(s,f);this._addRangeLowHigh(r,b);}else if((b.value!==undefined)&&b.value){this._addSingleValue(s,f,b.value);}else if(b){this._addSingleValue(s,f,b);}}}};a.addRangeEntry=function(s,f){var o={PropertyName:f,Ranges:[]};if(!s.SelectOptions){s.SelectOptions=[];}s.SelectOptions.push(o);return o.Ranges;};a.addRanges=function(r,R){var s,o,L,h;for(var i=0;i<R.length;i++){s=R[i].exclude?"E":"I";L=a._getValue(R[i].value1,true);h=null;if(R[i].operation===sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.BT){h=a._getValue(R[i].value2);}switch(R[i].operation){case sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.Contains:o="CP";if(L){L="*"+L+"*";}break;case sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.StartsWith:o="CP";if(L){L=L+"*";}break;case sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.EndsWith:o="CP";if(L){L="*"+L;}break;case sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.EQ:case sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.BT:case sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.LE:case sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.GE:case sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.GT:case sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.LT:o=R[i].operation;break;default:q.sap.log.error("ValueHelpRangeOperation is not supported '"+R[i].operation+"'");return;}r.push({Sign:s,Option:o,Low:L,High:h});}};a.prototype._addRangeMultipleSingleValues=function(r,I){for(var i=0;i<I.length;i++){r.push({Sign:"I",Option:"EQ",Low:a._getValue(I[i].key,true),High:null});}};a.prototype._addRangeMultipleRangeValues=function(r,I,t){for(var i=0;i<I.length;i++){r.push({Sign:"I",Option:t?"BT":"EQ",Low:a._getValue(I[i].value1,true),High:t?a._getValue(I[i].value2):null});}};a.prototype._addRangeSingleValue=function(r,v){r.push({Sign:"I",Option:"EQ",Low:a._getValue(v,true),High:null});};a.prototype._addRangeLowHigh=function(r,L,o){var s=o||"BT";r.push({Sign:"I",Option:s,Low:a._getValue(L.low,true),High:a._getValue(L.high)});};a.prototype._addParamaterSingleValue=function(s,f,v){if(!s.Parameters){s.Parameters=[];}s.Parameters.push({PropertyName:f,PropertyValue:v});};a.prototype._createRangeSingleValue=function(s,f,v){var r=a.addRangeEntry(s,f);this._addRangeSingleValue(r,v);};a.prototype._addSingleValue=function(s,f,v){var n;if(this._sAPILevel){n=f.split(sap.ui.comp.ANALYTICAL_PARAMETER_PREFIX);if(n.length>1){this._addParamaterSingleValue(s,n[n.length-1],v);}else{this._createRangeSingleValue(s,f,v);}}else{this._addParamaterSingleValue(s,f,v);}};a.prototype._getFields=function(f){var r=[];if(f){for(var i=0;i<f.length;i++){r.push(f[i].name);}}return r;};a._getValue=function(v,u){if((v===null)||(v===undefined)||(v==="")){return(u?"":null);}return""+v;};return a;},true);
