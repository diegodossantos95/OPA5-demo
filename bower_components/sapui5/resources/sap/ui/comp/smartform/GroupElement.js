/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2017 SAP SE. All rights reserved
 */
sap.ui.define(['jquery.sap.global','sap/m/Label',"sap/m/VBox","sap/m/HBox",'sap/ui/comp/library','sap/ui/core/Element','sap/ui/layout/form/FormElement','sap/ui/comp/smartfield/SmartLabel','sap/ui/comp/smartfield/SmartField','sap/m/FlexItemData','sap/ui/core/VariantLayoutData','sap/ui/layout/GridData'],function(q,L,V,H,l,E,F,S,a,b,c,G){"use strict";var C=l.smartfield.ControlContextType;var d=F.extend("sap.ui.comp.smartform.GroupElement",{metadata:{library:"sap.ui.comp",properties:{useHorizontalLayout:{type:"boolean",group:"Misc",defaultValue:null},horizontalLayoutGroupElementMinWidth:{type:"int",group:"Misc",defaultValue:null},elementForLabel:{type:"int",group:"Misc",defaultValue:0}},defaultAggregation:"elements",aggregations:{elements:{type:"sap.ui.core.Control",multiple:true,singularName:"element"}},events:{visibleChanged:{}},designTime:true},_visibilityDerived:false,_bHorizontalLayoutUsed:false});d._myVBox=undefined;d.prototype._getFieldRelevantForLabel=function(){var i=this.getElements();var I=this.getElementForLabel();if(i.length>I&&(i[I]instanceof a)){return i[I];}return null;};d.prototype._extractFields=function(i,B){var D=[];i.forEach(function(I){if(I.getItems){D=D.concat(I.getItems());}else{D.push(I);}});if(D.some(function(I){return I.getItems;})){D=this._extractFields(D);}if(B){D=D.filter(function(I){return!(I instanceof sap.m.Label);});}return D;};d.prototype.setTooltip=function(T){F.prototype.setTooltip.apply(this,[T]);var R=this._getFieldRelevantForLabel();var i=this._getLabel();_.call(this,i,R);return this;};function _(i,R){if(i==this._oSetLabel){return;}var T;if(this._oSetLabel&&this._oSetLabel instanceof sap.ui.core.Control){T=A.call(this._oSetLabel);}if(!T){T=A.call(this);}if(T){if(i instanceof S){if(R&&R.setTooltipLabel){R.setTooltipLabel(T);}}else{i.setTooltip(T);}}}d.prototype.setLabel=function(i){if(!i&&this._bMoveLabelToVBox){return this.setAggregation("label",i);}if(this._oSetLabel&&(typeof this._oSetLabel!=="string")){this._oSetLabel.detachEvent("_change",e,this);}var O;var B;var D;if(typeof i==="string"){O=this._getLabel();if(O){B=O.getText();}}else if(!i&&this._oSetLabel){B=this.getLabelText();}F.prototype.setLabel.apply(this,[i]);this._oSetLabel=i;f.call(this);if(typeof i==="string"){if(this._oLabel instanceof S&&i!=B&&(i.length>0||B.length>0)){D=this._getFieldRelevantForLabel();if(D&&i!=null){if(D.getTextLabel){if(!D._oTextLabelSetByGroupElement){D._oTextLabelSetByGroupElement={oldText:D.getTextLabel()};}D.setTextLabel(i);}}}if(!this._bHorizontalLayoutUsed){this.setAggregation("_label",this._oLabel,true);}this._oLabel.isRequired=g;}else{if(i){if(i.isRequired){i.isRequired=g;}i.attachEvent("_change",e,this);}else{D=this._getFieldRelevantForLabel();if(D){y.call(this,D,B);}}this.updateLabelOfFormElement();}return this;};d.prototype.destroyLabel=function(){var O=this.getLabelText();F.prototype.destroyLabel.apply(this);delete this._oSetLabel;f.call(this);var i=this._getFieldRelevantForLabel();if(i){y.call(this,i,O);}this.updateLabelOfFormElement();return this;};function e(i){if(i.getParameter("name")=="text"){var B=i.oSource;var T=B.getText();if(this._oLabel){this._oLabel.setText(T);}var D=this._getFieldRelevantForLabel();if(D&&D.getTextLabel){if(!D._oTextLabelSetByGroupElement){D._oTextLabelSetByGroupElement={oldText:D.getTextLabel()};}D.setTextLabel(T);}}}function f(){if(!this._bHorizontalLayoutUsed){return;}var i=this.getFields();var O;if(i.length>0){var B=this.getFields()[0];if(B instanceof V){var I=B.getItems();var N=this._getLabel();if(I.length>0&&I[0]instanceof L){O=I[0];}this._bMoveLabelToVBox=true;if(O&&O!=N){B.removeItem(0);if(O._bCreatedByGroupElement){this.setAggregation("_label",O,true);}else{this.setAggregation("label",O);}}if(N&&O!=N){B.insertItem(N,0);}this._bMoveLabelToVBox=false;h.call(this);}}}function g(){if(this.getRequired&&this.getRequired()){return true;}var B=this.getParent();if(B instanceof sap.m.VBox){B=B.getParent();}var D=B.getElements();for(var i=0;i<D.length;i++){var I=D[i];if(I.getRequired&&I.getRequired()===true&&(!I.getEditable||I.getEditable())&&(!I.getContextEditable||I.getContextEditable())){return true;}}return false;}function h(){var i=this._getFieldRelevantForLabel();if(i){if(this._oLabel){this._oLabel.setLabelFor(i);}return;}var B=this.getFields();i=B.length>0?B[0]:null;if(i instanceof V){var I=i.getItems();if(I[1]instanceof H){i=I[1].getItems()[0];}else{i=I[1];}}var D=this._oLabel;if(D){D.setLabelFor(i);}else{D=this.getLabel();if(D instanceof sap.ui.core.Control){D.setAlternativeLabelFor(i);}}}d.prototype.getLabel=function(){return this._oSetLabel;};d.prototype._getLabel=function(){if(this._oLabel){return this._oLabel;}else{return this._oSetLabel;}};d.prototype.getLabelControl=function(){if(this._bHorizontalLayoutUsed){return null;}else{return this._getLabel();}};d.prototype.getLabelText=function(){var i="";var B=this._getLabel();if(B){i=B.getText();}return i;};d.prototype.setElementForLabel=function(i){this.setProperty("elementForLabel",i);this.updateLabelOfFormElement();return this;};d.prototype._createLabel=function(i){var B=null;var D=this._getFieldRelevantForLabel();if(D){if(D.getShowLabel&&D.getShowLabel()){B=new S(D.getId()+'-label');if(i){if(!D._oTextLabelSetByGroupElement){D._oTextLabelSetByGroupElement={oldText:D.getTextLabel()};}D.setTextLabel(i);B.setText(i);}B.setLabelFor(D);}}else{B=new L();B.setText(i);}if(B){B._bCreatedByGroupElement=true;B.isRequired=g;this._oLabel=B;if(!this.getUseHorizontalLayout()){this.setAggregation("_label",B,true);}if(this._oSetLabel&&typeof this._oSetLabel!=="string"){this._oSetLabel.setAlternativeLabelFor(null);}}return B;};d.prototype.updateLabelOfFormElement=function(){var i=false,O=null;var B=this.getElements();var R=this._getFieldRelevantForLabel();var D=this._getLabel();var I=false;if(D&&D._bCreatedByGroupElement){if(D instanceof S){if(!R||(D._sSmartFieldId&&D._sSmartFieldId!=R.getId())){I=true;}}else if(R){I=true;}if(I){D.destroy();delete this._oLabel;D=null;if(this._oSetLabel&&!R){if(typeof this._oSetLabel==="string"){F.prototype.setLabel.apply(this,[this._oSetLabel]);D=this._oLabel;this._oLabel.isRequired=g;}else{D=this._oSetLabel;}f.call(this);}}}else if(D&&R){if(D==this._oLabel){D.destroy();delete this._oLabel;}D=null;}if(!D){if(this._oSetLabel){if(typeof this._oSetLabel==="string"){O=this._oSetLabel;}else{O=this._oSetLabel.getText();}}else{O="";}}if(!D&&B.length>0){D=this._createLabel(O);i=true;}if(D){if(D instanceof S){if(R&&R.setTextLabel&&R.getTextLabel()){D.setText(R.getTextLabel());}}_.call(this,D,R);}if(i){f.call(this);if(D&&D.setLabelFor&&!(D instanceof S)&&!R&&(B.length>0)){D.setLabelFor(B[0]);}}};d.prototype.setEditMode=function(i){var B=this.getElements();B.forEach(function(D){if(D instanceof a){if(!(D.data("editable")===false)){D.setContextEditable(i);}}});return this;};d.prototype._getVisibilityOfFields=function(B,I){var R=false;var i=0,D=0,J=null;if(B&&B.length){D=B.length;for(i=0;i<D;i++){J=B[i];if(J){if(I&&J instanceof S){continue;}if(J instanceof V){R=this._getVisibilityOfFields(this._extractFields([J]),true);}else{R=J.getVisible();}}if(R){break;}}}return R;};d.prototype._updateFormElementVisibility=function(){var i=this.getVisible();var B=false,D=null;if(i===false&&this._visibilityDerived===false){return;}D=this.getElements();if(D&&D.length){B=this._getVisibilityOfFields(D);}if(i!==B){this._visibilityDerived=true;F.prototype.setVisible.apply(this,[B]);this.fireVisibleChanged({visible:B});if(this.getParent()){this.getParent()._updateLineBreaks();}}};d.prototype._updateLayout=function(){var i=null;var B=null;var D=[];var I=[];var J=null;var U=this.getUseHorizontalLayout();var K;var M=0;var N;if(U==this._bHorizontalLayoutUsed){return;}if(this._bHorizontalLayoutUsed){I=this.getFields();D=this._extractFields(I,true);}else{D=this.getFields();}var O=this._getLabel();if(U){if(D.length>0&&D[0].getLayoutData()){J=D[0].getLayoutData();}this.removeAllFields();if(D.length>0){if(D.length>1){for(M=0;M<D.length;M++){N=D[M];if(M>0){j.call(this,N);}}B=n.call(this,D.slice(0));}if(B){K=[B];}else{K=D.slice(0);}i=m.call(this,K,O,J);this.addField(i);if(O){h.call(this);}}}else{if(I[0]instanceof V){i=I[0];K=i.getItems();if(D.length>1&&K.length>0){if(O){if(K.length>1&&K[1]instanceof H){B=K[1];}}else if(K[0]instanceof H){B=K[0];}if(B){B.removeAllItems();B.destroy();}}i.removeAllItems();i.destroy();}this.removeAllFields();for(M=0;M<D.length;M++){N=D[M];k.call(this,N);this.addField(N);}if(O){if(O==this._oLabel){this.setAggregation("_label",O,true);}else{this.setAggregation("label",O);}}}this._bHorizontalLayoutUsed=U;};function j(i){var B=i.getLayoutData();if(B){if(B.getStyleClass&&!B.getStyleClass()){B.setStyleClass("sapUiCompGroupElementHBoxPadding");}}else{B=new sap.m.FlexItemData({styleClass:"sapUiCompGroupElementHBoxPadding"});B._bCreatedByGroupElement=true;i.setLayoutData(B);}}function k(i){var B=i.getLayoutData();if(B){if(B._bCreatedByGroupElement){B.destroy();}else if(B.getStyleClass&&B.getStyleClass()=="sapUiCompGroupElementHBoxPadding"){B.setStyleClass();}}}function m(i,B,D){if(!d._myVBox){d._myVBox=V.extend("SmartFormVBox",{metadata:{interfaces:["sap.ui.core.IFormContent"]},enhanceAccessibilityState:o,renderer:"sap.m.VBoxRenderer"});}this._bMoveLabelToVBox=true;var I=i.slice(0);if(B){I.splice(0,0,B);}var J=new d._myVBox(this.getId()+"--VBox",{"items":I});this._bMoveLabelToVBox=false;J.addStyleClass("sapUiCompGroupElementVBox");J._oGroupElement=this;if(D&&(D instanceof G||D instanceof c||D.getMetadata().getName()=="sap.ui.layout.ResponsiveFlowLayoutData")){J.setLayoutData(D.clone());}p.call(this,J);return J;}function n(i){var B=new H(this.getId()+"--HBox",{"items":i});B._oGroupElement=this;B.enhanceAccessibilityState=o;return B;}function o(i,B){var D=this._oGroupElement._getLabel();if(D&&D!=i&&!(i instanceof H)){var I=B["labelledby"];if(!I){I=D.getId();}else{var J=I.split(" ");if(q.inArray(D.getId(),J)<0){J.splice(0,0,D.getId());I=J.join(" ");}}B["labelledby"]=I;}return B;}d.prototype._updateGridDataSpan=function(){if(!this.getUseHorizontalLayout()){return;}var i=this.getFields();if(i.length>0){var B=i[0];if(B instanceof V){p.call(this,B);}}};function p(B){var D=this.getParent();if(!D||!D.addGroupElement){return;}var I=D.getParent();while(I&&!I.addGroup&&I.getParent){I=I.getParent();}if(!I){return;}var J="";var K=I.getLayout();if(K){J=K.getGridDataSpan();}var M=B.getLayoutData();var N;if(M){if(!(M instanceof G)&&!(M instanceof c)&&J){N=new G({span:J});N._bFromGroupElement=true;var O=new c({multipleLayoutData:[M,N]});O._bFromGroupElement=true;B.setLayoutData(O);}else if(M instanceof G){if(M._bFromGroupElement){if(!J){M.destroy();}else{M.setSpan(J);}}}else if(M instanceof c){var P=false;M.getMultipleLayoutData().forEach(function(M){if(M instanceof G){P=true;if(M._bFromGroupElement){if(!J){M.destroy();}else{M.setSpan(J);}}}});if(!P&&J){N=new G({span:J});N._bFromGroupElement=true;M.addMultipleLayoutData(N);}if(M._bFromGroupElement&&M.getMultipleLayoutData().length==1){N=M.getMultipleLayoutData()[0];B.setLayoutData(N);M.destroy();}}}else if(J){N=new G({span:J});N._bFromGroupElement=true;B.setLayoutData(N);}var Q=this.getElements();for(var i=0;i<Q.length;i++){var R=Q[i];if(R&&R.setControlContext){if(J){R.setControlContext(C.SmartFormGrid);}else{R.setControlContext(C.Form);}}}}d.prototype._setLinebreak=function(B,D,I,J){if(!this.getUseHorizontalLayout()){return;}var K=this.getFields();if(K.length>0){var M=K[0];if(!(M instanceof V)){return;}var N=M.getLayoutData();if(N){if(N instanceof c){var O=N.getMultipleLayoutData();for(var i=0;i<O.length;i++){N=O[i];if(N instanceof G){N.setLinebreakXL(B);N.setLinebreakL(D);N.setLinebreakM(I);N.setLinebreakS(J);}}}else{N.setLinebreakXL(B);N.setLinebreakL(D);N.setLinebreakM(I);N.setLinebreakS(J);}}}};d.prototype.setVisible=function(i){var B,D=this.getVisible();this._visibilityDerived=false;F.prototype.setVisible.apply(this,arguments);if(i){this._updateFormElementVisibility();}B=this.getVisible();if(!i||B){if(D!=B){this.fireVisibleChanged({visible:B});}}return this;};d.prototype.setUseHorizontalLayout=function(i){var O=this.getUseHorizontalLayout();if(O==i){return this;}this.setProperty("useHorizontalLayout",i);this._updateLayout();return this;};d.prototype.setHorizontalLayoutGroupElementMinWidth=function(i){var B=this.getHorizontalLayoutGroupElementMinWidth();if(B==i){return this;}q.sap.log.error("HorizontalLayoutGroupElementMinWidth is deprecated",this);this.setProperty("horizontalLayoutGroupElementMinWidth",i);this._updateLayout();return this;};d.prototype.getFormElement=function(){return this;};d.prototype.addElement=function(i){if(!i){return this;}i=this.validateAggregation("elements",i,true);s.call(this,i);var B;if(this._oLabel&&this._oLabel._bCreatedByGroupElement&&this._oLabel._sSmartFieldId){B=this._oLabel._sSmartFieldId;}if(this.getUseHorizontalLayout()){r.call(this,i,undefined,true);}else{this.addField(i);}if(B&&B!=this._oLabel._sSmartFieldId){this._oLabel.setLabelFor(B);}this.updateLabelOfFormElement();return this;};d.prototype.insertElement=function(i,I){if(!i){return this;}i=this.validateAggregation("elements",i,true);s.call(this,i);var B;if(this._oLabel&&this._oLabel._bCreatedByGroupElement&&this._oLabel._sSmartFieldId){B=this._oLabel._sSmartFieldId;}if(this.getUseHorizontalLayout()){r.call(this,i,I,false);}else{this.insertField(i,I);}if(B&&B!=this._oLabel._sSmartFieldId){this._oLabel.setLabelFor(B);}this.updateLabelOfFormElement();return this;};d.prototype.getElements=function(){var i;var B;if(this.getUseHorizontalLayout()){i=this.getFields();B=this._extractFields(i,true);}else{B=this.getFields();}return B;};d.prototype.indexOfElement=function(B){var I=-1;if(this.getUseHorizontalLayout()){var D=this.getElements();for(var i=0;i<D.length;i++){if(B==D[i]){I=i;break;}}}else{I=this.indexOfField(B);}return I;};d.prototype.removeElement=function(i){var R;var B;if(this._oLabel&&this._oLabel._bCreatedByGroupElement&&this._oLabel._sSmartFieldId){B=this._oLabel._sSmartFieldId;}if(this.getUseHorizontalLayout()){R=w.call(this,i,false);}else{R=this.removeField(i);}if(R){x.call(this,R);}if(B&&B!=this._oLabel._sSmartFieldId){this._oLabel.setLabelFor(B);}this.updateLabelOfFormElement();return R;};d.prototype.removeAllElements=function(){var R;if(this.getUseHorizontalLayout()){R=w.call(this,undefined,true);}else{R=this.removeAllFields();}if(R&&Array.isArray(R)){for(var i=0;i<R.length;i++){x.call(this,R[i]);}}this.updateLabelOfFormElement();return R;};d.prototype.destroyElements=function(){if(this.getUseHorizontalLayout()){var i=this.getFields();if(i.length>0){var B=this._getLabel();if(B){i[0].removeItem(B);if(B==this._oLabel){this.setAggregation("_label",B,true);}else{this.setAggregation("label",B);}}this.destroyFields();}}else{this.destroyFields();}this.updateLabelOfFormElement();return this;};function r(i,I,B){var D=this._getLabel();var J=this.getFields();var K;var M;var N;if(J.length>0){K=J[0];}else{N=[i];var O=i.getLayoutData();K=m.call(this,N,D,O);this.addField(K);if(D){h.call(this);}return;}if(!(K instanceof V)){return;}N=K.getItems();if(D){if(N.length>1){M=N[1];}}else if(N.length>0){M=N[0];}if(M instanceof H){N=M.getItems();if((B||I>0)&&N.length>0){j.call(this,i);}if(B){M.addItem(i);}else{if(I==0&&N.length>0){j.call(this,N[0]);}M.insertItem(i,I);}}else{var P=M;N=[];if(P){K.removeItem(P);if(B||I>0){N.push(P);N.push(i);j.call(this,i);}else{N.push(i);N.push(P);j.call(this,P);}M=n.call(this,N);K.addItem(M);}else{K.addItem(i);}if(D){h.call(this);}}}function s(i){if(i.getEditable){if(!i.getEditable()){i.data("editable",false);}}if(i.attachVisibleChanged){i.attachVisibleChanged(this._updateFormElementVisibility,this);}if(i.attachInnerControlsCreated){i.attachInnerControlsCreated(this._updateFormElementLabel,this);}if(i.setControlContext){i.setControlContext(C.Form);}if(i.getMetadata().getProperty("mandatory")){i.attachEvent("_change",v,this);}t.call(this,i);}function t(B){if(B instanceof a){var D=this.getCustomData();for(var i=0;i<D.length;i++){u.call(this,B,D[i]);}}}function u(i,B){if(i instanceof a&&sap.ui.comp.smartform.inheritCostomDataToFields(B)){var N=B.clone();N._bFromGroupElement=true;N._sOriginalId=B.getId();i.addCustomData(N);}}function v(i){if(i.getParameter("name")=="mandatory"){var B=this._getLabel();if(B){B.invalidate();}}}function w(B,D){var I=this._getLabel();var J=this.getFields();var K;var M;var N;var R;var O=false;var P;if(J.length>0){K=J[0];}if(!(K instanceof V)){return null;}N=K.getItems();if(I){if(N.length>1){M=N[1];}}else if(N.length>0){M=N[0];}if(M instanceof H){if(D){R=M.removeAllItems();O=true;}else{R=M.removeItem(B);N=M.getItems();if(N.length>0){k.call(this,N[0]);if(N.length==1){P=N[0];M.removeAllItems();K.removeItem(M);M.destroy();K.addItem(P);}}}}else{if(D){R=K.removeAllItems();}else{R=K.removeItem(B);}if(R){O=true;}}if(O){if(I){K.removeItem(I);if(I==this._oLabel){this.setAggregation("_label",I,true);}else{this.setAggregation("label",I);}}this.removeField(K);K.destroy();}if(R){if(Array.isArray(R)){for(var i=0;i<R.length;i++){P=R[i];k.call(this,P);}}else{k.call(this,R);}}return R;}function x(i){if(i.detachVisibleChanged){i.detachVisibleChanged(this._updateFormElementVisibility,this);}if(i.detachInnerControlsCreated){i.detachInnerControlsCreated(this._updateFormElementLabel,this);}if(i.setControlContext){i.setControlContext(C.None);}if(i.getMetadata().getProperty("mandatory")){i.detachEvent("_change",v,this);}z.call(this,i);y.call(this,i,this.getLabelText());}function y(i,B){if(i._oTextLabelSetByGroupElement){if(i.getTextLabel()==B){i.setTextLabel(i._oTextLabelSetByGroupElement.oldText);}delete i._oTextLabelSetByGroupElement;}}function z(B,O){if(B instanceof a){var D=B.getCustomData();for(var i=0;i<D.length;i++){var I=D[i];if(I._bFromGroupElement&&(!O||O==I._sOriginalId)){B.removeCustomData(I);I.destroy();}}}}d.prototype._updateFormElementLabel=function(i){var R=this._getFieldRelevantForLabel();var B=this._getLabel();var D=i.oSource;var I=i.getParameters();if(B instanceof S&&D&&I&&D===R){B.updateLabelFor(I);}};d.prototype.addCustomData=function(B){if(!B){return this;}F.prototype.addCustomData.apply(this,arguments);var D=this.getElements();for(var i=0;i<D.length;i++){u.call(this,D[i],B);}return this;};d.prototype.insertCustomData=function(B,I){if(!B){return this;}F.prototype.insertCustomData.apply(this,arguments);var D=this.getElements();for(var i=0;i<D.length;i++){u.call(this,D[i],B);}return this;};d.prototype.removeCustomData=function(B){var D=F.prototype.removeCustomData.apply(this,arguments);if(D){var I=this.getElements();for(var i=0;i<I.length;i++){z.call(this,I[i],D.getId());}}return D;};d.prototype.removeAllCustomData=function(){var B=F.prototype.removeAllCustomData.apply(this,arguments);if(B.length>0){var D=this.getElements();for(var i=0;i<D.length;i++){z.call(this,D[i]);}}return B;};d.prototype.destroyCustomData=function(){F.prototype.destroyCustomData.apply(this,arguments);var B=this.getElements();for(var i=0;i<B.length;i++){z.call(this,B[i]);}return this;};d.prototype.getVisibleBasedOnElements=function(){var i=true;var B=this.getElements();if(B&&B.length>0){i=B.some(function(D){return D.getVisible();});}return i;};function A(){var T=this.getTooltip();if(!T||typeof T==="string"||T instanceof String){return T;}else{return T.getText();}}d.prototype.clone=function(I,B){var D=this.removeAllElements();var J=F.prototype.clone.apply(this,arguments);for(var i=0;i<D.length;i++){var K=D[i];var M=K.clone(I,B);this.addElement(K);J.addElement(M);}return J;};return d;},true);
