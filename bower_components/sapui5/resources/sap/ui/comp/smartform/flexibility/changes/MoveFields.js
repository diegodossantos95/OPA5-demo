/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2017 SAP SE. All rights reserved
 */
sap.ui.define(["jquery.sap.global","sap/ui/fl/changeHandler/Base","sap/ui/fl/Utils","sap/ui/fl/changeHandler/JsControlTreeModifier"],function(q,B,F,J){"use strict";var M={};M._checkCompleteChangeContentConditions=function(s){if(!s.movedElements){throw new Error("oSpecificChangeInfo.movedElements attribute required");}if(s.movedElements.length===0){throw new Error("MovedElements array is empty");}s.movedElements.forEach(function(m){if(!m.id){throw new Error("MovedElements element has no id attribute");}if(typeof(m.targetIndex)!=="number"){throw new Error("Index attribute at MovedElements element is no number");}});};M._buildStableChangeInfo=function(m){var s=m.source.id;var t=m.target.id;var c={changeType:m.changeType,selector:{id:s},targetId:t!==s?t:null};c[m.changeType]=[];m.movedElements.forEach(function(a){c[m.changeType].push({id:a.id,index:a.targetIndex});});return c;};M.applyChange=function(c,g,p){function a(c,m){if(!c){throw new Error("No change instance");}var C=c.getContent();if(!m.getAggregation(g,"groupElements")){F.log.error("Object has no group elements aggregation",m.getId(g));}if(!C||!C.moveFields||C.moveFields.length===0){throw new Error("Change format invalid");}}function b(o,m,A,v){if(!o.selector&&!o.id){throw new Error("Change format invalid - moveFields element has no id attribute");}if(typeof(o.index)!=="number"){throw new Error("Change format invalid - moveFields element index attribute is no number");}return m.bySelector(o.selector||o.id,A,v);}var m=p.modifier;var v=p.view;var A=p.appComponent;a(c,m);var C=c.getContent();var t=g;if(C.targetSelector||C.targetId){t=m.bySelector(C.targetSelector||C.targetId,A,v);}C.moveFields.forEach(function(o){var f=b(o,m,A,v);if(!f){F.log.warning("Field to move not found");return;}m.removeAggregation(g,"groupElements",f,v);m.insertAggregation(t,"groupElements",f,o.index);});return true;};M.completeChangeContent=function(c,s,p){this._checkCompleteChangeContentConditions(s);s=this._buildStableChangeInfo(s);var C=c.getDefinition();var a=p.appComponent;if(!C.content){C.content={};}if(!C.content.moveFields){C.content.moveFields=[];}s.moveFields.forEach(function(f){var o=J.bySelector(f.id,a);var S=J.getSelector(o,a);C.content.moveFields.push({selector:S,index:f.index});});if(s.targetId){var t=J.bySelector(s.targetId,a);C.content.targetSelector=J.getSelector(t,a);}};return M;},true);
