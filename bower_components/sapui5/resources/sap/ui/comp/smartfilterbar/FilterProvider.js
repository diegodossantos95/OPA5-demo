/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2017 SAP SE. All rights reserved
 */
sap.ui.define(['jquery.sap.global','sap/m/Select','sap/ui/core/Item','sap/m/ComboBox','sap/m/DatePicker','sap/m/DateRangeSelection','sap/m/TimePicker','sap/m/Input','sap/m/MultiComboBox','sap/m/MultiInput','sap/m/SearchField','sap/m/Token','sap/ui/comp/odata/MetadataAnalyser','sap/ui/comp/providers/ValueHelpProvider','sap/ui/comp/providers/ValueListProvider','sap/ui/model/Filter','sap/ui/model/json/JSONModel','sap/ui/comp/odata/ODataType','sap/ui/comp/util/FormatUtil','sap/ui/base/EventProvider','sap/ui/comp/util/IdentifierUtil','sap/ui/comp/providers/TokenParser','sap/ui/core/format/DateFormat'],function(q,S,I,C,D,a,T,b,M,c,d,f,g,V,h,F,J,O,l,E,m,o,p){"use strict";var r=function(P){this._bInitialized=false;this._bPending=true;this._bConsiderAnalyticalParameters=false;if(P){this._oParentODataModel=P.model;this._sServiceURL=P.serviceUrl;this._sBasicSearchFieldName=P.basicSearchFieldName;this._isBasicSearchEnabled=P.enableBasicSearch;this._bUseContainsAsDefault=P.useContainsAsDefaultFilter==="true";this.sEntityType=P.entityType;this.sEntitySet=P.entitySet;this._isRunningInValueHelpDialog=P.isRunningInValueHelpDialog;this._oAdditionalConfiguration=P.additionalConfiguration;this.sDefaultDropDownDisplayBehaviour=P.defaultDropDownDisplayBehaviour;this.sDefaultTokenDisplayBehaviour=P.defaultTokenDisplayBehaviour;if(typeof P.dateFormatSettings==="string"){try{this._oDateFormatSettings=P.dateFormatSettings?JSON.parse(P.dateFormatSettings):undefined;}catch(e){}}else{this._oDateFormatSettings=P.dateFormatSettings;}if(!this._oDateFormatSettings){this._oDateFormatSettings={};}if(!this._oDateFormatSettings.hasOwnProperty("UTC")){this._oDateFormatSettings["UTC"]=true;}this._oSmartFilter=P.smartFilter;this._bConsiderAnalyticalParameters=P.considerAnalyticalParameters;this._bUseDateRangeType=P.useDateRangeType;this._bConsiderSelectionVariants=P.considerSelectionVariants;this._aConsiderNavigations=P.considerNavigations;}this.sFilterModelName=r.FILTER_MODEL_NAME;this._sBasicFilterAreaID=r.BASIC_FILTER_AREA_ID;this._aAnalyticalParameters=[];this._aFilterBarViewMetadata=[];this._aFilterBarFieldNames=[];this._aFilterBarMultiValueFieldMetadata=[];this._aFilterBarDateFieldNames=[];this._aFilterBarTimeFieldNames=[];this._aFilterBarTimeIntervalFieldNames=[];this._aFilterBarDateTimeMultiValueFieldNames=[];this._aFilterBarStringFieldNames=[];this._aFieldGroupAnnotation=[];this._oMetadataAnalyser=new g(this._oParentODataModel||this._sServiceURL);this.oModel=new J();this._aValueListProvider=[];this._aValueHelpDialogProvider=[];this._mTokenHandler={};this._mConditionTypeFields={};this._aSelectionVariants=[];this._intialiseMetadata();this._bInitialized=true;};r.FILTER_MODEL_NAME="fi1t3rM0d31";r.BASIC_FILTER_AREA_ID="_BASIC";r.BASIC_SEARCH_FIELD_ID="_BASIC_SEARCH_FIELD";r.CUSTOM_FIELDS_MODEL_PROPERTY="_CUSTOM";r.FIELD_NAME_REGEX=/\./g;r.prototype._intialiseMetadata=function(){var G,e,s,k,n,i,j,t,u,v,w,x;this._aFilterBarViewMetadata.push({groupName:this._sBasicFilterAreaID,index:0,fields:[]});if(!this.sEntitySet&&this.sEntityType){this.sEntitySet=this._oMetadataAnalyser.getEntitySetNameFromEntityTypeName(this.sEntityType);}this.sEntityType=this._oMetadataAnalyser.getEntityTypeNameFromEntitySetName(this.sEntitySet);n=this._oMetadataAnalyser.getAllFilterableFieldsByEntitySetName(this.sEntitySet,this._bConsiderAnalyticalParameters,this._aConsiderNavigations);if(n){this._updateDisplayBehaviour();this._aFieldGroupAnnotation=this._oMetadataAnalyser.getFieldGroupsByFilterFacetsAnnotation(this.sEntityType);s=this._oMetadataAnalyser.getSelectionFieldsAnnotation(this.sEntityType);if(s&&s.selectionFields){this._aSelectionFields=s.selectionFields;}if(this._aFieldGroupAnnotation){G=this._aFieldGroupAnnotation.length;for(i=0;i<G;i++){k=this._aFieldGroupAnnotation[i];v=this._createGroupMetadata(k);v.index=this._aFilterBarViewMetadata.length;this._aFilterBarViewMetadata.push(v);}}G=n.length;for(i=0;i<G;i++){k=n[i];e=k.fields.length;v=this._createGroupMetadata(k);this._aFilterBarViewMetadata.push(v);for(j=0;j<e;j++){t=k.fields[j];if(t.type.indexOf("Edm.")===0){u=this._createFieldMetadata(t);v.fields.push(u);this._aFilterBarFieldNames.push(u.fieldName);}}}}x=this._getAdditionalConfigurationForCustomGroups(n);G=x.length;for(j=0;j<G;j++){v=this._createGroupMetadataForCustomGroup(x[j]);if(v){this._aFilterBarViewMetadata.push(v);}}w=this._getAdditionalConfigurationForCustomFilterFields();e=w.length;for(j=0;j<e;j++){u=this._createFieldMetadataForCustomFilterFields(w[j]);if(u){this._aFilterBarViewMetadata[0].fields.push(u);}}if(this._hasBasicSearch()){u=this._createBasicSearchFieldMetadata();this._aFilterBarViewMetadata[0].fields.push(u);}if(this._bConsiderAnalyticalParameters){this._createAnalyticalParameters();}if(this._bConsiderSelectionVariants){this._createSelectionVariants();}this._applyGroupId();this._applyIndexes();this._createInitialModel(true);this._initializeConditionTypeFields();this.setPending(this.isPending());};r.prototype._createSelectionVariants=function(){this._aSelectionVariants=this._oMetadataAnalyser.getSelectionVariantAnnotation(this.sEntityType);};r.prototype._createAnalyticalParameters=function(){var i;if(this._oMetadataAnalyser.isSemanticAggregation(this.sEntityType)){q.sap.require("sap.ui.model.analytics.odata4analytics");try{i=new sap.ui.model.analytics.odata4analytics.Model(new sap.ui.model.analytics.odata4analytics.Model.ReferenceByModel(this._oParentODataModel));}catch(e){throw"Failed to instantiate analytical extensions for given OData model: "+e.message;}var Q=i&&i.findQueryResultByName(this.sEntitySet);this._oParameterization=Q&&Q.getParameterization();this._createAnalyticParameters(this._oParameterization);}};r.prototype.attachPendingChange=function(e){if(!this._oEventProvider){this._oEventProvider=new E();}this._oEventProvider.attachEvent("PendingChange",e);};r.prototype.detachPendingChange=function(e){if(this._oEventProvider){this._oEventProvider.detachEvent("PendingChange",e);}};r.prototype.setPending=function(v){var e=this._bPending!==v;this._bPending=v;if(e&&this._oEventProvider){var P={};P.pending=v;this._oEventProvider.fireEvent("PendingChange",P);}};r.prototype.isPending=function(){if(!this._bInitialized){return true;}for(var n in this._mConditionTypeFields){if(this._mConditionTypeFields[n].conditionType.isPending()){return true;}}return false;};r.prototype._updateDisplayBehaviour=function(){this._sTextArrangementDisplayBehaviour=this._oMetadataAnalyser.getTextArrangementValue(this.sEntityType);if(!this.sDefaultDropDownDisplayBehaviour){if(this._sTextArrangementDisplayBehaviour){this.sDefaultDropDownDisplayBehaviour=this._sTextArrangementDisplayBehaviour;}else{this.sDefaultDropDownDisplayBehaviour=sap.ui.comp.smartfilterbar.DisplayBehaviour.descriptionOnly;}}if(!this.sDefaultTokenDisplayBehaviour){if(this._sTextArrangementDisplayBehaviour){this.sDefaultTokenDisplayBehaviour=this._sTextArrangementDisplayBehaviour;}else{this.sDefaultTokenDisplayBehaviour=sap.ui.comp.smartfilterbar.DisplayBehaviour.descriptionAndId;}}};r.prototype._hasBasicSearch=function(){return this._isBasicSearchEnabled;};r.prototype._getAdditionalConfigurationForCustomFilterFields=function(){var e,j,i,R;if(!this._oAdditionalConfiguration){return[];}e=this._oAdditionalConfiguration.getControlConfiguration();if(!this._aFilterBarFieldNames||!this._aFilterBarFieldNames.length){return e;}R=[];j=e.length;for(i=0;i<j;i++){if(this._aFilterBarFieldNames.indexOf(e[i].key)<0){R.push(e[i]);}}return R;};r.prototype._getAdditionalConfigurationForCustomGroups=function(e){var G,k,n,i,R,j,s,t;if(!this._oAdditionalConfiguration){return[];}G=this._oAdditionalConfiguration.getGroupConfiguration();if(!e||!e.length){return G;}R=[];n=e.length;k=G.length;for(i=0;i<k;i++){s=false;for(j=0;j<n;j++){t=e[j].groupName||e[j].groupEntityName;if(t===G[i].key){s=true;break;}}if(!s){R.push(G[i]);}}return R;};r.prototype._createInitialModelForField=function(j,e,u){var i=false,k,n,H=false,s=false,L=null,t=null,v,w=null,x=[],R=[];if(!e||e.isCustomFilterField){return;}if(e.filterRestriction!==sap.ui.comp.smartfilterbar.FilterType.multiple){s=true;}if((e.filterType==="date")||(e.filterType==="time")){i=true;}if(u){k=e.defaultFilterValues;H=k&&k.length;if(!H&&e.defaultFilterValue||e.defaultPropertyValue){if(e.isParameter){k=[{low:e.defaultPropertyValue}];}else{k=[{low:e.defaultFilterValue,high:e.defaultFilterValue,operator:"EQ",sign:"I"}];}H=true;}}if(e.filterRestriction===sap.ui.comp.smartfilterbar.FilterType.single){if(H){n=k[0];L=i?this._createDateTimeValue(e,n.low):n.low;}j[e.fieldName]=L;}else if(e.filterRestriction===sap.ui.comp.smartfilterbar.FilterType.interval&&e.type!=="Edm.Time"){if(H){n=k[0];L=i?this._createDateTimeValue(e,n.low):n.low;t=i?this._createDateTimeValue(e,n.high):n.high;}j[e.fieldName]={low:L,high:t};}else{if(H){v=k.length;while(v--){n=k[v];if(s){w={"exclude":n.sign==="E","operation":n.operator==="CP"?"Contains":n.operator,"keyField":e.fieldName,"value1":i?this._createDateTimeValue(e,n.low):n.low,"value2":i?"":n.high};if((e.filterType==="time")&&n.high){w.value2=new Date(n.high);}}else{w={key:i?this._createDateTimeValue(e,n.low):n.low,text:i?"":n.low};}x.push(w);}}this._aFilterBarMultiValueFieldMetadata.push(e);j[e.fieldName]={value:null};if(s){R=x.slice(0);x=[];j[e.fieldName].ranges=R;}j[e.fieldName].items=x;this._updateMultiValueControl(e.control,x,R);}};r.prototype._createDateTimeValue=function(e,v){if((e.type==="Edm.Time")&&(v.indexOf("PT")===0)){return this._getTime(v);}else{return new Date(v);}};r.prototype._createInitialModel=function(u){var e,G,k,n,j,i;e={};this._bCreatingInitialModel=true;this._aFilterBarMultiValueFieldMetadata=[];if(this._aFilterBarViewMetadata){G=this._aFilterBarViewMetadata.length;for(i=0;i<G;i++){n=this._aFilterBarViewMetadata[i];k=n.fields.length;for(j=0;j<k;j++){this._createInitialModelForField(e,n.fields[j],u);}}}if(this._aAnalyticalParameters){k=this._aAnalyticalParameters.length;for(j=0;j<k;j++){this._createInitialModelForField(e,this._aAnalyticalParameters[j],u);}}this.oModel.setData(e);if(!u){this._clearConditionTypeFields();}this._updateConditionTypeFields();this._bCreatingInitialModel=false;};r.prototype._updateMultiValueControl=function(e,j,R,k){var i=0,t=null,n=null,s=null,u=null,K=null,v,w,x;if(e&&j){i=j.length;if(e instanceof c){t=[];while(i--){u=j[i].text||j[i].key;t.push(new f({key:j[i].key,text:u,tooltip:u}));}if(R){i=R.length;while(i--){s=R[i];if(s.tokenText){u=s.tokenText;}else{v=s.value1;w=s.value2;if(k){if((k.filterType==="date")||(k.filterType==="datetime")||(k.filterType==="time")){if(v&&typeof v==="string"){v=new Date(v);}if(w&&typeof w==="string"){w=new Date(w);}}if((v instanceof Date)||(w instanceof Date)){x=this._getType(k);if(v){v=x.formatValue(v,"string");}if(w){w=x.formatValue(w,"string");}}}u=l.getFormattedRangeText(s.operation,v,w,s.exclude);}n=new f({text:u,tooltip:u});n.data("range",s);t.push(n);}}e.setTokens(t);}if(e instanceof M){K=[];while(i--){K.push(j[i].key);}e.setSelectedKeys(K);}}};r.prototype._applyIndexes=function(){var e,i;if(!this._aFilterBarViewMetadata){return;}this._aFilterBarViewMetadata=this._sortByIndex(this._aFilterBarViewMetadata);e=this._aFilterBarViewMetadata.length;for(i=0;i<e;i++){if(this._aFilterBarViewMetadata[i].fields){this._aFilterBarViewMetadata[i].fields=this._sortByIndex(this._aFilterBarViewMetadata[i].fields);}}};r.prototype._sortByIndex=function(A){var e,i,j,R,k,n;if(!A||!A.length){return A;}R=[];e=[];j=A.length;for(i=0;i<j;i++){n=A[i];k=n.index;if(k>=0){e.push(n);}else{R.push(n);}}j=e.length;if(j){e=e.sort(function(s,t){return s.index-t.index;});if(!R.length){R=e;}else{for(i=0;i<j;i++){n=e[i];if(n.index>=R.length){R.push(n);}else{R.splice(n.index,0,n);}}}}return R;};r.prototype._applyGroupId=function(){var e,i,n,j,s,N,k;e=this._aFilterBarViewMetadata.length;for(i=0;i<e;i++){if(!this._aFilterBarViewMetadata[i].fields){continue;}n=this._aFilterBarViewMetadata[i].fields.length;for(j=0;j<n;j++){s=this._aFilterBarViewMetadata[i].fields[j];if(s&&s.groupId&&s.groupId!==this._aFilterBarViewMetadata[i].groupName){N=undefined;for(k=0;k<e;k++){if(this._aFilterBarViewMetadata[k].groupName===s.groupId){N=this._aFilterBarViewMetadata[k];break;}}if(N){this._aFilterBarViewMetadata[i].fields.splice(j,1);j--;n--;N.fields=N.fields||[];N.fields.push(s);}}}}};r.prototype._createFilterControlId=function(e){var s=this._oSmartFilter.getId();var G=m.replace(e.groupId||"");var n=m.replace(e.fieldName);return s+"-filterItemControl"+G+"-"+n;};r.prototype._createGroupMetadata=function(e){var G,i,s;s=e.groupName||e.groupEntityName;i=this._oAdditionalConfiguration.getGroupConfigurationByKey(s);G={};G.groupName=s;G.groupLabel=this._getGroupLabel(e,i);G.fields=[];G.index=this._getGroupIndex(i);return G;};r.prototype._createGroupMetadataForCustomGroup=function(G){var e;e={};e.groupName=G.key;e.groupLabel=G.label;e.fields=[];e.index=this._getGroupIndex(G);return e;};r.prototype._getTime=function(v){var e=p.getTimeInstance({pattern:"'PT'hh'H'mm'M'ss'S'"});return e.parse(v);};r.prototype._checkMetadataDefaultValue=function(e){var t,s=e.defaultFilterValue||e.defaultPropertyValue;if(s){try{if((e.type==="Edm.Time")&&(s.indexOf("PT")===0)){this._getTime(s);}else{t=this._getType(e);t.parseValue(s,"string");}}catch(i){e.defaultPropertyValue=null;e.defaultFilterValue=null;q.sap.log.error("default value for "+e.fieldName+" could not be parsed.");}}};r.prototype._getType=function(e){var t,i={},j={};if(e.precision||e.scale){j.precision=e.precision;j.scale=e.scale;}if(e.maxLength){j.maxLength=e.maxLength;}if(e.displayFormat){j.displayFormat=e.displayFormat;}if(e.fControlConstructor===a||e.fControlConstructor===D||e.type==="Edm.DateTimeOffset"){i=q.extend({},this._oDateFormatSettings,{UTC:false});}t=O.getType(e.type,i,j);return t;};r.prototype._createControl=function(e){var i,t,j=false,k,n;if(e.customControl){return e.customControl;}t=this._getType(e);i=new e.fControlConstructor(this._createFilterControlId(e));if(e.fControlConstructor===a){i.bindProperty('dateValue',this.sFilterModelName+">/"+e.fieldName+"/low");i.bindProperty('secondDateValue',this.sFilterModelName+">/"+e.fieldName+"/high");}else if((e.fControlConstructor===C)||(e.fControlConstructor===S)){if(i.setForceSelection){i.setForceSelection(true);}if(e.fControlConstructor===S){i.addItem(new I({key:"",text:""}));i.addItem(new I({key:false,text:t.formatValue(false,"string")}));i.addItem(new I({key:true,text:t.formatValue(true,"string")}));}else{this._associateValueList(i,"items",e);i.attachSelectionChange(function(){if(this._bUpdatingFilterData||this._bCreatingInitialModel){return;}i.fireChange({filterChangeReason:e.fieldName,value:""});}.bind(this));}i.bindProperty('selectedKey',this.sFilterModelName+">/"+e.fieldName);}else if(e.fControlConstructor===M){this._associateValueList(i,"items",e);i.attachSelectionChange(function(u){if(this._bUpdatingFilterData||this._bCreatingInitialModel){return;}var v=u.getSource(),w=null,K=[],L;w=v.getSelectedItems();if(w){L=w.length;while(L--){K.push({key:w[L].getKey(),text:w[L].getText()});}}if(this.oModel){this.oModel.setProperty("/"+e.fieldName+"/items",K);}v.fireChange({filterChangeReason:e.fieldName,value:""});}.bind(this));i.bindProperty('value',this.sFilterModelName+">/"+e.fieldName+"/value");}else if(e.fControlConstructor===c){if(e.controlType===sap.ui.comp.smartfilterbar.ControlType.date||e.type==="Edm.Time"){i.setValueHelpOnly(true);if(e.filterRestriction===sap.ui.comp.smartfilterbar.FilterType.interval){this._associateValueHelpDialog(i,e,false,false);}else{this._associateValueHelpDialog(i,e,true,true);}}else{if(e.hasValueHelpDialog){this._associateValueHelpDialog(i,e,e.filterRestriction!==sap.ui.comp.smartfilterbar.FilterType.multiple,true);}else{i.setShowValueHelp(false);}i.bindProperty('value',{path:this.sFilterModelName+">/"+e.fieldName+"/value",type:t});}this._handleMultiInput(i,e,t);}else if(e.fControlConstructor===b){if(e.filterRestriction===sap.ui.comp.smartfilterbar.FilterType.interval){j=true;i.bindProperty('value',this.sFilterModelName+">/"+e.fieldName+"/low");if(!this.oResourceBundle){this.oResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");}if(!this.sIntervalPlaceholder){this.sIntervalPlaceholder=this.oResourceBundle.getText("INTERVAL_PLACEHOLDER_TEXT");}i.setPlaceholder(this.sIntervalPlaceholder);}else{i.bindProperty('value',{path:this.sFilterModelName+">/"+e.fieldName,type:t});}if(e.hasValueHelpDialog){i.setShowValueHelp(true);this._associateValueHelpDialog(i,e,false,false);}}else if(e.fControlConstructor===D||e.fControlConstructor===T){i.bindProperty('dateValue',this.sFilterModelName+">/"+e.fieldName);}if(i instanceof D){if(this._oDateFormatSettings&&this._oDateFormatSettings.style){i.setDisplayFormat(this._oDateFormatSettings.style);}i.attachChange(function(u){var v=u.getParameter("valid");i.data("__mandatoryEmpty",null);if(v){i.setValueState(sap.ui.core.ValueState.None);i.setValueStateText();}else{i.setValueState(sap.ui.core.ValueState.Error);if(t){try{t.parseValue("foo","string");}catch(w){i.setValueStateText(w.message);}}}});}if(e.hasTypeAhead){i.setShowSuggestion(true);i.setFilterSuggests(false);this._associateValueList(i,"suggestionRows",e,true);}if(e.displayFormat==="UpperCase"&&i.attachChange&&i.getValue&&i.setValue){i.attachChange(function(){var v=i.getValue();if(v){i.setValue(v.toUpperCase());}});if(this._mTokenHandler[i.getId()]&&this._mTokenHandler[i.getId()].parser){var s=this._mTokenHandler[i.getId()].parser;s.setDisplayFormat(e.displayFormat);}}if(i instanceof b){if(!e.hasValueListAnnotation&&!j&&e.maxLength){k=parseInt(e.maxLength,10);if(!isNaN(k)){if(this._mTokenHandler[i.getId()]&&this._mTokenHandler[i.getId()].parser){var s=this._mTokenHandler[i.getId()].parser;s.setMaxLength(k);}else{i.setMaxLength(k);}}}}n=function(u){var v=u.getParameter("exception");if(i){if(v){if(i.setValueStateText){i.setValueStateText(v.message);}}if(i.setValueState){i.setValueState(sap.ui.core.ValueState.Error);}i.data("__mandatoryEmpty",null);}};i.attachParseError(n);i.attachFormatError(n);i.attachValidationError(n);i.attachValidationSuccess(function(u){if(i){if(i.setValueState){i.setValueState(sap.ui.core.ValueState.None);}if(i.setValueStateText){i.setValueStateText();}i.data("__mandatoryEmpty",null);delete i.__sValidationText;}});return i;};r.prototype._getControlConstructor=function(e,P){var i=b,j,k,s;s=P?P+e.fieldName:e.fieldName;if(e.isCustomFilterField){i=undefined;}else{j=(e.filterRestriction===sap.ui.comp.smartfilterbar.FilterType.single);k=(e.filterRestriction===sap.ui.comp.smartfilterbar.FilterType.interval);if(e.controlType===sap.ui.comp.smartfilterbar.ControlType.date){e.displayFormat="Date";if(j){i=D;}else{i=k?a:c;}this._aFilterBarDateFieldNames.push(s);if(e.filterRestriction===sap.ui.comp.smartfilterbar.FilterType.multiple){this._aFilterBarDateTimeMultiValueFieldNames.push(s);}}else if(e.controlType===sap.ui.comp.smartfilterbar.ControlType.dropDownList){if(j){i=this._isBooleanWithFixedValuedButWithoutValueListAnnotation(e)?S:C;}else{i=M;}if(!j){e.filterRestriction=sap.ui.comp.smartfilterbar.FilterType.multiple;}}else if(e.type==="Edm.Time"){if(j){i=T;}else{i=c;}this._aFilterBarTimeFieldNames.push(s);if(k){this._aFilterBarTimeIntervalFieldNames.push(s);}else if(e.filterRestriction===sap.ui.comp.smartfilterbar.FilterType.multiple){this._aFilterBarDateTimeMultiValueFieldNames.push(s);}}else if(!j&&!k){i=c;}}return i;};r.prototype._handleMultiInput=function(e,i,t){e.setEnableMultiLineMode(true);e.attachTokenChange(function(n){if(this._bUpdatingFilterData||this._bCreatingInitialModel||(n.getParameter("type")!=="tokensChanged")&&(n.getParameter("type")!=="removed")){return;}var s=n.getSource().getTokens(),u=[],L,v=null,R=null,w=[];if(s){L=s.length;while(L--){v=s[L];R=v.data("range");if(R){R.tokenText=v.getText();w.push(R);}else{u.push({key:v.getKey(),text:v.getText()});}}}if(this.oModel){this.oModel.setProperty("/"+i.fieldName+"/items",u);this.oModel.setProperty("/"+i.fieldName+"/ranges",w);}e.fireChange({filterChangeReason:i.fieldName,value:""});}.bind(this));var j,k=((i.type==="Edm.DateTime"&&i.displayFormat==="Date"));if(i.hasValueListAnnotation||(i.type==="Edm.String")||k){e.attachEvent("_validateOnPaste",function(n){var s=n.getParameter("texts"),P,L,u,v,R;L=s?s.length:0;if(L>1){n.preventDefault();P=this.oModel.getProperty("/"+i.fieldName);R=P.ranges||[];e.setValue("");while(L--){u=s[L];if(u){v=null;if(k){j=this._getDateValue(u,t);if(isNaN(j.getDate())){continue;}else{v=u;u=j;}}R.push({"exclude":false,"operation":"EQ","keyField":i.fieldName,"value1":u,"value2":null,"tokenText":v});}}this.oModel.setProperty("/"+i.fieldName+"/ranges",R);this._updateMultiValueControl(e,P.items,R);}}.bind(this));}};r.prototype._getDateValue=function(v,t){var e;try{e=t.parseValue(v,"string");if(e){return e;}}catch(i){}return new Date(v);};r.prototype._associateValueHelpDialog=function(e,i,s,j){var v=new V({loadAnnotation:i.hasValueListAnnotation,fullyQualifiedFieldName:i.fullName,metadataAnalyser:this._oMetadataAnalyser,control:e,filterModel:this.oModel,filterProvider:this,model:this._oParentODataModel,preventInitialDataFetchInValueHelpDialog:i.preventInitialDataFetchInValueHelpDialog,dateFormatSettings:this._oDateFormatSettings,supportMultiSelect:j,supportRanges:s,isUnrestrictedFilter:i.filterRestriction!==sap.ui.comp.smartfilterbar.FilterType.multiple,isSingleIntervalRange:i.filterRestriction===sap.ui.comp.smartfilterbar.FilterType.interval,fieldName:i.fieldName,type:i.filterType,scale:i.scale,precision:i.precision,maxLength:i.maxLength,displayFormat:i.displayFormat,displayBehaviour:i.displayBehaviour,fieldViewMetadata:i});v.attachValueListChanged(function(k){if(this._oSmartFilter){this._oSmartFilter.fireFilterChange(k);}}.bind(this));if(i.visibleInAdvancedArea||(i.groupId===r.BASIC_FILTER_AREA_ID)){v.loadAnnotation();}this._aValueHelpDialogProvider.push(v);if(s&&e.addValidator){var t=new o();t.addKeyField({key:i.fieldName,label:i.label,type:i.filterType});t.associateInput(e);this._mTokenHandler[e.getId()]={parser:t};}};r.prototype._determineFieldLabel=function(e){var i,L=e.label;if(this._oSmartFilter&&this._oSmartFilter.determineFilterItemByName){i=this._oSmartFilter.determineFilterItemByName(e.name);if(i){L=i.getLabel();}}return L;};r.prototype._associateValueList=function(e,A,i,H){var v;if(i.hasValueListAnnotation){v=new h({control:e,fieldName:i.fieldName,typeAheadEnabled:H,aggregation:A,displayFormat:i.displayFormat,displayBehaviour:i.displayBehaviour,dateFormatSettings:this._oDateFormatSettings,loadAnnotation:true,fullyQualifiedFieldName:i.fullName,metadataAnalyser:this._oMetadataAnalyser,filterModel:this.oModel,filterProvider:this,model:this._oParentODataModel,fieldViewMetadata:i});v.attachValueListChanged(function(j){if(this._oSmartFilter){this._oSmartFilter.fireFilterChange(j);}}.bind(this));if(i.visibleInAdvancedArea||(i.groupId===r.BASIC_FILTER_AREA_ID)){v.loadAnnotation();}this._aValueListProvider.push(v);}else if(this._mTokenHandler[e.getId()]&&this._mTokenHandler[e.getId()].parser){this._mTokenHandler[e.getId()].parser.setDefaultOperation("EQ");}};r.prototype._createAnalyticParameters=function(P){var e,j,k,n,s;if(P){k=P.getAllParameterNames();j=P.getEntitySet();if(j){e=P.getEntitySet().getQName();s=this._oMetadataAnalyser.getFieldsByEntitySetName(e);for(var i=0;i<s.length;i++){if(k.indexOf(s[i].name)>=0){n=this._createAnalyticParameterMetadata(s[i]);if(n.visible){this._aAnalyticalParameters.push(n);}}}}}};r.prototype._createAnalyticParameterMetadata=function(P){var s=sap.ui.comp.ANALYTICAL_PARAMETER_PREFIX;P.filterRestriction="single-value";var e=this._createFieldMetadata(P,s);e.fieldName=s+P.name;e.isMandatory=true;e.isParameter=true;e.visibleInAdvancedArea=true;return e;};r.prototype.getAnalyticParameters=function(){return this._aAnalyticalParameters;};r.prototype.getSelectionVariants=function(){return this._aSelectionVariants;};r.prototype.getAnalyticBindingPath=function(){var v,P=[],e=this.getAnalyticParameters();e.forEach(function(i){P.push(i.fieldName);});v=this.getFilledFilterData(P);return this._createAnalyticBindingPath(e,v);};r.prototype._createAnalyticBindingPath=function(P,v){var s,e="",i;i=this._getParameterizationRequest(this._oParameterization);if(i){P.forEach(function(j){s=v[j.fieldName];if(!s){s="";}else if(j.type==="Edm.Time"&&s instanceof Date){s={__edmType:"Edm.Time",ms:(((s.getHours()*60)+s.getMinutes())*60+s.getSeconds())*1000+s.getMilliseconds()};}else if(this._oDateFormatSettings&&this._oDateFormatSettings.UTC&&s instanceof Date){s=r.getDateInUTCOffset(s);}i.setParameterValue(j.name,s);}.bind(this));e=i.getURIToParameterizationEntry()+'/'+this._oParameterization.getNavigationPropertyToQueryResult();}return e;};r.prototype._getParameterizationRequest=function(){return this._oParameterization?new sap.ui.model.analytics.odata4analytics.ParameterizationRequest(this._oParameterization):null;};r.prototype._createFieldMetadata=function(e,P){var i,j;e.fieldName=this._getFieldName(e);e.fieldNameOData=e.fieldName.replace(r.FIELD_NAME_REGEX,"/");j=this._oAdditionalConfiguration?this._oAdditionalConfiguration.getControlConfigurationByKey(e.fieldName):null;i=q.extend({},e);i.filterRestriction=this._getFilterRestriction(e,j);this._updateValueListMetadata(i,e);i.hasValueHelpDialog=this._hasValueHelpDialog(i,j);i.preventInitialDataFetchInValueHelpDialog=j?j.preventInitialDataFetchInValueHelpDialog:true;i.controlType=this._getControlType(i,j);if(j&&j.displayBehaviour&&j.displayBehaviour!=="auto"){i.displayBehaviour=j.displayBehaviour;}i.isCustomFilterField=!!(j&&j.customControl);i.visibleInAdvancedArea=!!(j&&j.visibleInAdvancedArea);i.label=this._getLabel(e,j);i.isMandatory=this._isMandatory(e,j);i.width=this._getWidth(j);i.isVisible=this._isVisible(j);i.groupId=this._getGroupID(e,j);i.index=this._getIndex(e,j);i.fControlConstructor=this._getControlConstructor(i,P);i.filterType=this._getFilterType(i);i.hasTypeAhead=this._hasTypeAhead(i,e,j);i.customControl=j?j.customControl:undefined;i.fCreateControl=function(u){var v,w;u.control=this._createControl(u);v=this.oModel.getData();w=v[u.fieldName];if(w){this._updateMultiValueControl(u.control,w.items,w.ranges);}}.bind(this);this._applyWidth(i);i.defaultFilterValues=j?j.defaultFilterValues:undefined;if(i.type==="Edm.String"){this._aFilterBarStringFieldNames.push(i.fieldName);}i.conditionType=null;var k=j?j.conditionType:null;if(!k&&this._bUseDateRangeType&&(i.fControlConstructor===a)){k="sap.ui.comp.config.condition.DateRangeType";}if(k){var s="";if(typeof k==="object"){s=k.module;delete k.module;}else{s=k;k=null;}try{q.sap.require(s);var n=q.sap.getObject(s);if(n){i.conditionType=new n(i.fieldName,this,i);this._mConditionTypeFields[i.fieldName]=i;}if(k&&!this._bUseDateRangeType){i.conditionType.applySettings(k);}}catch(t){q.sap.log.error("Module "+s+" could not be loaded");}}this._checkMetadataDefaultValue(i);return i;};r.prototype._getFilterType=function(e){if(O.isNumeric(e.type)){return"numeric";}else if(e.type==="Edm.DateTime"&&e.displayFormat==="Date"){return"date";}else if(e.type==="Edm.String"){return"string";}else if(e.type==="Edm.Boolean"){return"boolean";}else if(e.type==="Edm.Time"){return"time";}return undefined;};r.prototype._updateValueListMetadata=function(e,i){e.hasValueListAnnotation=i["sap:value-list"]!==undefined;if(e.hasValueListAnnotation){e.hasFixedValues=i["sap:value-list"]==="fixed-values";}else if(i["com.sap.vocabularies.Common.v1.ValueList"]){e.hasValueListAnnotation=true;e.hasFixedValues=this._oMetadataAnalyser.getValueListSemantics(i["com.sap.vocabularies.Common.v1.ValueList"])==="fixed-values";if(!e.hasFixedValues){e.hasFixedValues=g.isValueListWithFixedValues(i);}}};r.prototype._createBasicSearchFieldMetadata=function(){var e;var R=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");e={};e.filterRestriction=sap.ui.comp.smartfilterbar.FilterType.single;e.name=r.BASIC_SEARCH_FIELD_ID;e.fieldName=r.BASIC_SEARCH_FIELD_ID;e.label=undefined;e.isMandatory=false;e.isVisible=true;e.groupId=r.BASIC_FILTER_AREA_ID;e.index=-1;e.control=new d(this._oSmartFilter.getId()+"-btnBasicSearch",{showSearchButton:true});if(!this._isRunningInValueHelpDialog){e.control.setPlaceholder(R.getText("FILTER_BAR_BSEARCH_PLACE_HOLDER"));}e.control.bindProperty('value',this.sFilterModelName+">/"+e.fieldName);return e;};r.prototype._applyWidth=function(e){if(e&&e.width&&e.control&&e.control.setWidth&&(typeof e.control.setWidth==='function')){e.control.setWidth(e.width);}};r.prototype._createFieldMetadataForCustomFilterFields=function(e){var i;if(!e||!e.customControl){return undefined;}i={};i.name=e.key;i.fieldName=e.key;i.label=e.label;i.visibleInAdvancedArea=!!(e&&e.visibleInAdvancedArea);i.isVisible=this._isVisible(e);i.groupId=e.groupId;i.isMandatory=this._isMandatory(undefined,e);i.index=e.index;i.width=this._getWidth(e);i.control=e.customControl;i.isCustomFilterField=true;this._applyWidth(i);return i;};r.prototype._getFieldName=function(e){if(!e.parentPropertyName){return e.name;}else{return e.parentPropertyName+"."+e.name;}};r.prototype._hasValueHelpDialog=function(e,i){var v=true;if(i){if(i.controlType===sap.ui.comp.smartfilterbar.ControlType.dropDownList){v=false;}else if(i.hasValueHelpDialog!==true){v=false;}}if(e&&!e.hasValueListAnnotation){if(e.filterRestriction===sap.ui.comp.smartfilterbar.FilterType.single||e.filterRestriction===sap.ui.comp.smartfilterbar.FilterType.multiple){v=false;}}return v;};r.prototype._isVisible=function(e){if(e&&e.isVisible===false){return false;}return true;};r.prototype._getWidth=function(e){if(e&&e.width){return e.width;}return undefined;};r.prototype._isMandatory=function(e,i){if(i&&i.mandatory!==sap.ui.comp.smartfilterbar.MandatoryType.auto){return i.mandatory===sap.ui.comp.smartfilterbar.MandatoryType.mandatory;}if(e){return e.requiredFilterField;}return false;};r.prototype._getFilterRestriction=function(e,i){var s;if(i&&i.filterType&&i.filterType!==sap.ui.comp.smartfilterbar.FilterType.auto){s=i.filterType;}else if(e.filterRestriction==="single-value"){s=sap.ui.comp.smartfilterbar.FilterType.single;}else if(e.filterRestriction==="multi-value"){s=sap.ui.comp.smartfilterbar.FilterType.multiple;}else if(e.filterRestriction==="interval"){s=sap.ui.comp.smartfilterbar.FilterType.interval;}else{s=sap.ui.comp.smartfilterbar.FilterType.auto;}return s;};r.prototype._getControlType=function(e,i){var s;if(i&&i.controlType&&i.controlType!==sap.ui.comp.smartfilterbar.ControlType.auto){s=i.controlType;}else if(e.type==="Edm.DateTime"&&e.displayFormat==="Date"){s=sap.ui.comp.smartfilterbar.ControlType.date;}else if(e.hasValueListAnnotation&&e.hasFixedValues){s=sap.ui.comp.smartfilterbar.ControlType.dropDownList;}else if(this._isBooleanWithFixedValuedButWithoutValueListAnnotation(e)){s=sap.ui.comp.smartfilterbar.ControlType.dropDownList;}else{s=sap.ui.comp.smartfilterbar.ControlType.input;}return s;};r.prototype._isBooleanWithFixedValuedButWithoutValueListAnnotation=function(e){if(e.type==="Edm.Boolean"&&!e.hasFixedValues&&!e.hasValueListAnnotation&&(e.filterRestriction==="single")){return true;}return false;};r.prototype._getGroupID=function(e,i){if(i&&i.groupId){return i.groupId;}else if(e&&(e.requiredFilterField||(this._aSelectionFields&&this._aSelectionFields.indexOf(e.fieldNameOData)>-1))){return this._sBasicFilterAreaID;}return this._getGroupIDFromFieldGroup(e);};r.prototype._getGroupIDFromFieldGroup=function(e){var L=0,i=null,G;if(e&&this._aFieldGroupAnnotation&&this._aFieldGroupAnnotation.length){L=this._aFieldGroupAnnotation.length;while(L--){i=this._aFieldGroupAnnotation[L];if(i&&i.fields&&i.fields.indexOf(e.fieldNameOData)>-1){G=i.groupName;break;}}}return G;};r.prototype._getLabel=function(e,i){if(i&&i.label){return i.label;}return this._getLabelFromFieldGroup(e)||e.fieldLabel||e.fieldName;};r.prototype._getLabelFromFieldGroup=function(e){var L=0,i=null,s;if(e&&this._aFieldGroupAnnotation&&this._aFieldGroupAnnotation.length){L=this._aFieldGroupAnnotation.length;while(L--){i=this._aFieldGroupAnnotation[L];if(i&&i.fields&&i.fields.indexOf(e.fieldNameOData)>-1){s=i.labels[e.fieldNameOData];break;}}}return s;};r.prototype._getIndex=function(e,i){if(i&&(i.index>=0)){return i.index;}else if(this._aSelectionFields&&this._aSelectionFields.indexOf(e.fieldNameOData)>-1){return this._aSelectionFields.indexOf(e.fieldNameOData);}return this._getIndexFromFieldGroup(e);};r.prototype._getIndexFromFieldGroup=function(e){var L=0,i=null,j;if(e&&this._aFieldGroupAnnotation&&this._aFieldGroupAnnotation.length){L=this._aFieldGroupAnnotation.length;while(L--){i=this._aFieldGroupAnnotation[L];if(i&&i.fields){j=i.fields.indexOf(e.fieldNameOData);if(j>-1){break;}j=undefined;}}}return j;};r.prototype._getGroupIndex=function(G){if(G&&(G.index||G.index===0)){return G.index;}};r.prototype._getGroupLabel=function(e,G){if(G&&G.label){return G.label;}return e.groupLabel||e.groupName||e.groupEntityName;};r.prototype._hasTypeAhead=function(e,i,j){var H;H=true;if(j){H=j.hasTypeAhead;}else if(i.type!=="Edm.String"){return false;}if(!(e.fControlConstructor===b||e.fControlConstructor===c)){return false;}return H;};r.prototype.getModel=function(){return this.oModel;};r.prototype.getFilterBarViewMetadata=function(){return this._aFilterBarViewMetadata;};r.prototype.getAssociatedValueHelpProviders=function(){return this._aValueHelpDialogProvider;};r.prototype.getAssociatedValueListProviders=function(){return this._aValueListProvider;};r.prototype.getParameters=function(){var P,B=null;if(this.oModel){B=this.oModel.getProperty("/"+r.BASIC_SEARCH_FIELD_ID);}if(this._sBasicSearchFieldName||B){P={custom:{}};if(this._sBasicSearchFieldName){P.custom["search-focus"]=this._sBasicSearchFieldName;}P.custom["search"]=B||"";}return P;};r.prototype.getFilters=function(e){var i=null;if(this.oModel){i=this.oModel.getData();}return r.generateFilters(e,i,{dateSettings:this._oDateFormatSettings,useContainsAsDefault:this._bUseContainsAsDefault,stringFields:this._aFilterBarStringFieldNames,timeFields:this._aFilterBarTimeFieldNames});};r.prototype.getFilterData=function(){return this.oModel?this.oModel.getData():null;};r.prototype.getFilterDataAsString=function(){return this.oModel?this.oModel.getJSON():null;};r.prototype.getFilledFilterData=function(e){var i,j={},k,s,v;i=this.oModel?this.oModel.getData():null;if(i&&e){k=e.length;while(k--){s=e[k];if(s&&s!==r.BASIC_SEARCH_FIELD_ID){v=i[s];if(v&&v.hasOwnProperty("low")){if(v.low){j[s]=v;}}else if(v&&v.hasOwnProperty("items")){if(v.value&&typeof v.value==="string"){v.value=v.value.trim();}if(v.items.length||(v.ranges&&v.ranges.length)||v.value){j[s]=v;}}else if(v){if(typeof v==="string"){v=v.trim();}if(v){j[s]=v;}}}if(k===0){s=r.CUSTOM_FIELDS_MODEL_PROPERTY;v=i[s];if(v){j[s]=v;}}}}return q.extend(true,{},j);};r.prototype.getFilledFilterDataAsString=function(e){return JSON.stringify(this.getFilledFilterData(e));};r.prototype.setFilterData=function(j,R){var e=null,i=null,k=null;if(this.oModel&&j){this._bUpdatingFilterData=true;try{if(R){this._createInitialModel(false);}e=this._parseFilterData(j,R);if(e){this.oModel.setData(e,true);i=[];var s=arguments[2];if(s){i.push(s);}for(k in e){i.push(k);}this._handleFilterDataUpdate(i);}}finally{this._bUpdatingFilterData=false;}}};r.prototype.setFilterDataAsString=function(j,R){if(j){this.setFilterData(JSON.parse(j),R);}};r.prototype._parseFilterData=function(j,R){return r.parseFilterData(this.oModel.getData(),j,{dateFields:this._aFilterBarDateFieldNames,timeFields:this._aFilterBarTimeFieldNames,timeIntervalFields:this._aFilterBarTimeIntervalFieldNames,dateTimeMultiValueFields:this._aFilterBarDateTimeMultiValueFieldNames,conditionTypeFields:this._mConditionTypeFields},R);};r.prototype._handleFilterDataUpdate=function(e){var i=0,j,k,n;if(this._aFilterBarMultiValueFieldMetadata){i=this._aFilterBarMultiValueFieldMetadata.length;while(i--){if(!k){k=this.oModel.getData();}if(k){j=this._aFilterBarMultiValueFieldMetadata[i];if(e.indexOf(j.fieldName)>-1){n=k[j.fieldName];if(n){this._updateMultiValueControl(j.control,n.items,n.ranges,j);}}}}this._updateConditionTypeFields();}};r.prototype.clear=function(){this._createInitialModel(false);};r.prototype.reset=function(){this._createInitialModel(true);};r.prototype._initializeConditionTypeFields=function(){var e=function(i){this.setPending(this.isPending());}.bind(this);for(var n in this._mConditionTypeFields){this._mConditionTypeFields[n].conditionType.initialize(this.oModel.getData()[n]);if(this._mConditionTypeFields[n].conditionType.getAsync()){this._mConditionTypeFields[n].conditionType.attachPendingChange(e);}}};r.prototype._updateConditionTypeFields=function(){var e=this._oldData;var i=this.oModel.getData();this._oldData=q.extend(true,{},i);if(e!==undefined){var u=[],n;for(n in i){var N=JSON.stringify(i[n]);var s=JSON.stringify(e[n]);if(N!==s){u.push(n);}}if(u.length>0){for(n in this._mConditionTypeFields){this._mConditionTypeFields[n].conditionType.providerDataUpdated(u,i);}}}};r.prototype._clearConditionTypeFields=function(){var e=this.oModel.getData();for(var n in this._mConditionTypeFields){this._mConditionTypeFields[n].conditionType.initialize(e[n]);}};r.prototype._validateConditionTypeFields=function(){var i=false;for(var n in this._mConditionTypeFields){var v=this._mConditionTypeFields[n].conditionType.validate();if(!v&&!i){i=true;}}return i;};r.generateFilters=function(e,i,s){var j=[],A=null,k=null,n=null,t=null,u=r.FIELD_NAME_REGEX,v=null,w,x,y=null,L=0,z=0;var B,G,H,K,U,N;if(s){B=s.dateSettings;G=s.useContainsAsDefault;H=s.stringFields;K=s.timeFields;}if(e&&i){z=e.length;while(z--){N=false;t=e[z];if(t&&t!==r.BASIC_SEARCH_FIELD_ID){U=false;if(G&&H){if(H.indexOf(t)>-1){U=true;}}else if(K&&K.indexOf(t)>-1){N=true;}v=i[t];t=t.replace(u,"/");if(v&&v.hasOwnProperty("low")){if(v.low&&v.high){w=v.low;x=v.high;if(B&&B.UTC&&w instanceof Date&&x instanceof Date){w=r.getDateInUTCOffset(w);x=r.getDateInUTCOffset(x);}j.push(new F(t,sap.ui.model.FilterOperator.BT,w,x));}else if(v.low){if(v.low instanceof Date){w=v.low;if(B&&B.UTC){w=r.getDateInUTCOffset(w);}j.push(new F(t,sap.ui.model.FilterOperator.EQ,w));}else if(typeof v.low==="string"){y=l.parseFilterNumericIntervalData(v.low);if(y&&y.length===2){j.push(new F(t,sap.ui.model.FilterOperator.BT,y[0],y[1]));}else{j.push(new F(t,U?sap.ui.model.FilterOperator.Contains:sap.ui.model.FilterOperator.EQ,v.low));}}}}else if(v&&v.hasOwnProperty("items")){A=[];n=[];k=null;if(v&&v.hasOwnProperty("ranges")){y=v.ranges;L=y.length;while(L--){w=y[L].value1;x=y[L].value2;if(N){if(w instanceof Date){w=l.getEdmTimeFromDate(w);}if(x instanceof Date){x=l.getEdmTimeFromDate(x);}}else if(B&&B.UTC){if(w instanceof Date){w=r.getDateInUTCOffset(w);}if(x instanceof Date){x=r.getDateInUTCOffset(x);}}if(y[L].exclude){if(y[L].operation===sap.ui.model.FilterOperator.EQ){n.push(new F(t,sap.ui.model.FilterOperator.NE,w));}}else{A.push(new F(t,y[L].operation,w,x));}}if(n.length){k=new F(n,true);}}y=v.items;L=y.length;while(L--){A.push(new F(t,sap.ui.model.FilterOperator.EQ,y[L].key));}if(v.value||v.value===0||v.value===false){if(typeof v.value==="string"){v.value=v.value.trim();}if(v.value||v.value===0||v.value===false){A.push(new F(t,U?sap.ui.model.FilterOperator.Contains:sap.ui.model.FilterOperator.EQ,v.value));}}if(A.length){if(k){j.push(new F([new F(A,false),k],true));}else{j.push(new F(A,false));}}else if(k){j.push(k);}}else if(v||v===0||v===false){if(typeof v==="string"){v=v.trim();}if(v&&v instanceof Date){if(N){v=l.getEdmTimeFromDate(v);}else if(B&&B.UTC){v=r.getDateInUTCOffset(v);}}if(v||v===0||v===false){j.push(new F(t,U?sap.ui.model.FilterOperator.Contains:sap.ui.model.FilterOperator.EQ,v));}}}}}return(j.length>1)?[new F(j,true)]:j;};r.parseFilterData=function(e,j,s,R){var k={},n=null,t=null,v=null,N,u,i,L,w,x,y,z,A,B;if(s){x=s.dateFields;y=s.timeFields;z=s.timeIntervalFields;A=s.dateTimeMultiValueFields;n=s.conditionTypeFields||{};}if(!x){x=[];}if(!y){y=[];}if(!z){z=[];}if(!A){A=[];}if(e&&j){u=q.extend({},j,true);for(t in u){if(e.hasOwnProperty(t)&&t!==r.CUSTOM_FIELDS_MODEL_PROPERTY){v=e[t];N=u[t];if(t in n){if("conditionTypeInfo"in N||(!("conditionTypeInfo"in N)&&N.ranges)){n[t].conditionType.initialize(N);}}else if(v&&v.hasOwnProperty("low")){k[t]=N;if(N){if(N.low&&N.high){if((x.indexOf(t)>-1)||(y.indexOf(t)>-1)){if(!(N.low instanceof Date)){k[t].low=new Date(N.low);}if(!(N.high instanceof Date)){k[t].high=new Date(N.high);}}else{k[t].low=N.low+'-'+N.high;k[t].high=null;}}else if((N.low||N.value)&&!N.high){if(!N.low&&N.value){N.low=N.value;}if((x.indexOf(t)>-1||y.indexOf(t)>-1)&&!(N.low instanceof Date)){k[t].low=new Date(N.low);}else{k[t].low=N.low;}k[t].high=null;}}}else if(v&&v.hasOwnProperty("items")){if(N&&(N.items||N.ranges)){if(N.ranges&&N.ranges.length){if(z.indexOf(t)>-1){L=N.ranges.length;for(i=0;i<L;i++){w=N.ranges[i];if(!w.exclude&&(w.operation==="EQ"||w.operation==="BT")){break;}w=null;}if(w){if(w.value1&&typeof w.value1==="string"){w.value1=new Date(w.value1);}if(w.value2&&typeof w.value2==="string"){w.value2=new Date(w.value2);}k[t]={ranges:[w],items:[],value:""};}continue;}else if(A.indexOf(t)>-1){L=N.ranges.length;B=[];for(i=0;i<L;i++){w=N.ranges[i];if(!w.exclude&&w.operation==="EQ"){if(w.value1&&typeof w.value1==="string"){w.value1=new Date(w.value1);}B.push(w);}}k[t]={ranges:B,items:[],value:""};continue;}else if(x.indexOf(t)>-1||y.indexOf(t)>-1){L=N.ranges.length;for(i=0;i<L;i++){w=N.ranges[i];if(w.value1&&typeof w.value1==="string"){w.value1=new Date(w.value1);}if(w.value2&&typeof w.value2==="string"){w.value2=new Date(w.value2);}}}else if((N.ranges.length===1)&&(N.ranges[0].operation==="EQ")&&!N.ranges[0].value1){continue;}}k[t]=N;if(!R&&k[t].ranges){for(i=0;i<k[t].ranges.length;i++){k[t].ranges[i].tokenText=null;}}}else if(typeof N==="string"||typeof N==="number"||N instanceof Date){if(N&&(x.indexOf(t)>-1||y.indexOf(t)>-1)){if(typeof N==="string"){N=new Date(N);}k[t]={ranges:[{"exclude":false,"operation":"EQ","keyField":t,"value1":N,"value2":null}],items:[],value:""};}else{k[t]={value:N,items:[]};}}}else{k[t]=null;if(typeof N==="string"||typeof N==="boolean"||typeof N==="number"||N instanceof Date){if(typeof N==="string"&&(x.indexOf(t)>-1||y.indexOf(t)>-1)){k[t]=new Date(N);}else{k[t]=N;}}else if(N&&(N.value||N.value===0||N.value===false)){k[t]=N.value;}else if(N&&N.items&&N.items.length){k[t]=N.items[0].key;}else if(N&&N.ranges&&N.ranges.length){L=N.ranges.length;for(i=0;i<L;i++){w=N.ranges[i];if(!w.exclude&&w.operation==="EQ"){break;}w=null;}if(w&&w.value1){if(typeof w.value1==="string"&&(x.indexOf(t)>-1||y.indexOf(t)>-1)){k[t]=new Date(w.value1);}else{k[t]=w.value1;}}}}}else if(R||t===r.CUSTOM_FIELDS_MODEL_PROPERTY){k[t]=u[t];}}}return k;};r.getDateInUTCOffset=function(e){return new Date(e.valueOf()-e.getTimezoneOffset()*60*1000);};r.prototype.destroy=function(){var e=function(A){var i;if(A){i=A.length;while(i--){A[i].destroy();}}};this._oParentODataModel=null;this._aAnalyticalParameters=null;this._aFilterBarViewMetadata=null;this._oParameterization=null;this._aFilterBarFieldNames=null;this._aFilterBarDateFieldNames=null;this._aFilterBarTimeFieldNames=null;this._aFilterBarTimeIntervalFieldNames=null;this._aFilterBarDateTimeMultiValueFieldNames=null;this._aFilterBarStringFieldNames=null;this._aFilterBarMultiValueFieldMetadata=null;this._aFieldGroupAnnotation=null;this._aSelectionFields=null;this._aSelectionVariants=null;if(this._oMetadataAnalyser&&this._oMetadataAnalyser.destroy){this._oMetadataAnalyser.destroy();}this._oMetadataAnalyser=null;e(this._aValueHelpDialogProvider);this._aValueHelpDialogProvider=null;e(this._aValueListProvider);this._aValueListProvider=null;if(this._mTokenHandler){for(var H in this._mTokenHandler){var j=this._mTokenHandler[H];if(j.parser){j.parser.destroy();j.parser=null;}}delete this._mTokenHandler;}this.oResourceBundle=null;this.sIntervalPlaceholder=null;this.sDefaultDropDownDisplayBehaviour=null;this.sDefaultTokenDisplayBehaviour=null;this._oSmartFilter=null;if(this._oEventProvider){if(this._oEventProvider.destroy){this._oEventProvider.destroy();}this._oEventProvider=null;}for(var n in this._mConditionTypeFields){this._mConditionTypeFields[n].conditionType.destroy();}this._mConditionTypeFields=null;if(this.oModel){this.oModel.destroy();this.oModel=null;}this.bIsDestroyed=true;};return r;},true);
