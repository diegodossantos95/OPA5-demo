/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2017 SAP SE. All rights reserved
 */
sap.ui.define(['jquery.sap.global','sap/ui/comp/library','sap/ui/comp/personalization/Controller','sap/ui/comp/personalization/Util','./Util','sap/ui/comp/navpopover/flexibility/changes/AddLink','sap/ui/comp/navpopover/flexibility/changes/RemoveLink','sap/ui/fl/changeHandler/JsControlTreeModifier','./Factory'],function(q,C,a,P,U,A,R,J,F){"use strict";var b={};b.isSettingsAvailable=function(){return!!F.getService("CrossApplicationNavigation");};b.getStableElements=function(n){if(!n||!(n instanceof sap.ui.comp.navpopover.NavigationPopoverHandler)){return null;}var s=n.getNavigationPopoverStableId();if(!s){return null;}var o=n._getAppComponent();if(!o){return null;}return[{id:s,appComponent:o}];};b.execute=function(n,g){return new Promise(function(r,c){if(!n||!(n instanceof sap.ui.comp.navpopover.NavigationPopoverHandler)){return c(new Error("oNavigationPopoverHandler is not of supported type sap.ui.comp.navpopover.NavigationPopoverHandler"));}if(!n.getNavigationPopoverStableId()){return c(new Error("StableId is not defined. SemanticObject="+n.getSemanticObject()));}var o=n._getAppComponent();if(!o){return c(new Error("AppComponent is not defined. oControl="+n.getControl()));}n._getNavigationContainer().then(function(N){var d=[];var e=[];var f=function(h){var i=h.filter(function(m){return m.visible===true;});var j=h.filter(function(m){return m.visible===false;});d=b._prepareResult(i,sap.ui.comp.navpopover.ChangeHandlerType.addLink,N.getId(),o);e=b._prepareResult(j,sap.ui.comp.navpopover.ChangeHandlerType.removeLink,N.getId(),o);};b._applyUnsavedChanges(g,N,o);N.openSelectionDialog(true,false,f,false).then(function(){N.destroy();r(d.concat(e));});});});};b._prepareResult=function(m,c,s,o){return m.map(function(M){return{selectorControl:{id:s,controlType:"sap.ui.comp.navpopover.NavigationContainer",appComponent:o},changeSpecificData:{changeType:c,content:M}};});};b._applyUnsavedChanges=function(g,n,o){var c=g(n.getId(),[sap.ui.comp.navpopover.ChangeHandlerType.addLink,sap.ui.comp.navpopover.ChangeHandlerType.removeLink]);c.forEach(function(d){switch(d.getChangeType()){case sap.ui.comp.navpopover.ChangeHandlerType.addLink:A.applyChange(d,n,{modifier:J,appComponent:o});break;case sap.ui.comp.navpopover.ChangeHandlerType.removeLink:R.applyChange(d,n,{modifier:J,appComponent:o});break;}});};return b;},true);
