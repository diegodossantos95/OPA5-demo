/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2017 SAP SE. All rights reserved
 */
sap.ui.define(['jquery.sap.global','sap/ui/base/ManagedObject','./Util','./ColumnWrapper'],function(q,M,U,C){"use strict";var a=M.extend("sap.ui.comp.personalization.ColumnHelper",{constructor:function(i,s){M.apply(this,arguments);},metadata:{properties:{callbackOnSetVisible:{type:"object",defaultValue:null},callbackOnSetSummed:{type:"object",defaultValue:null}}}});a.prototype.init=function(){this._oColumnKey2ColumnMap={};this._oColumnKeyIsMonkeyPatched={};this._oStoredColumnMapForColumnKeys={};};a.prototype.addColumnMap=function(c){if(!c){return;}for(var s in c){this._addColumnToMap(s,c[s]);}};a.prototype.addColumnsToMap=function(c){if(!c){return;}c.forEach(function(o){var s=U.getColumnKey(o);this._addColumnToMap(s,o);},this);};a.prototype._addColumnToMap=function(c,o){if(!this._oColumnKey2ColumnMap[c]){this._oColumnKey2ColumnMap[c]=o;this._monkeyPatchColumn(o,c);}};a.prototype.getColumnMap=function(){return this._oColumnKey2ColumnMap;};a.prototype.getColumnMapOfValidColumnKeys=function(t,i){this._invalidateStoredColumnMapForColumnKeys(t);if(this._oStoredColumnMapForColumnKeys[t]){return this._oStoredColumnMapForColumnKeys[t].map;}if(!i||!i.length){this._oStoredColumnMapForColumnKeys[t]={columnKeys:this.getColumnKeysOfMap(),map:this._oColumnKey2ColumnMap};return this._oStoredColumnMapForColumnKeys[t].map;}this._oStoredColumnMapForColumnKeys[t]={columnKeys:this.getColumnKeysOfMap(),map:q.extend(true,{},this._oColumnKey2ColumnMap)};i.forEach(function(c){delete this._oStoredColumnMapForColumnKeys[t].map[c];},this);return this._oStoredColumnMapForColumnKeys[t].map;};a.prototype._invalidateStoredColumnMapForColumnKeys=function(t){var v=this._oStoredColumnMapForColumnKeys[t];if(!v){return;}var c=this.getColumnKeysOfMap();var d=c.filter(function(s){return v.columnKeys.indexOf(s)<0;});if(d.length){delete this._oStoredColumnMapForColumnKeys[t];}};a.prototype.getColumnKeysOfMap=function(){var c=[];for(var s in this._oColumnKey2ColumnMap){c.push(s);}return c;};a.prototype.getVisibleColumnKeys=function(){var c=[];for(var s in this._oColumnKey2ColumnMap){var o=this._oColumnKey2ColumnMap[s];if(o.getVisible&&o.getVisible()){c.push(s);}}return c;};a.prototype.getColumnKeysOfType=function(t){var c=[];for(var s in this._oColumnKey2ColumnMap){var o=this._oColumnKey2ColumnMap[s];if(U.getColumnType(o)===t){c.push(s);}}return c;};a.prototype.hasFilterableColumns=function(){for(var c in this._oColumnKey2ColumnMap){if(U.isFilterable(this._oColumnKey2ColumnMap[c])){return true;}}return false;};a.prototype.hasSortableColumns=function(){for(var c in this._oColumnKey2ColumnMap){if(U.isSortable(this._oColumnKey2ColumnMap[c])){return true;}}return false;};a.prototype._monkeyPatchColumn=function(c,s){if(c instanceof C){return;}if(this._oColumnKeyIsMonkeyPatched[s]){return;}this._oColumnKeyIsMonkeyPatched[s]=true;var f=this.getCallbackOnSetVisible();var S=c.setVisible.bind(c);var b=function(v){if(f){f(v,s);}S(v);};c.setVisible=b;if(c.setSummed){var d=this.getCallbackOnSetSummed();var e=c.setSummed.bind(c);var g=function(i){if(d){d(i,c);}e(i);};c.setSummed=g;}};a.prototype.exit=function(){this._oColumnKey2ColumnMap=null;this._oColumnKeyIsMonkeyPatched=null;this._oStoredColumnMapForColumnKeys=null;};return a;},true);
