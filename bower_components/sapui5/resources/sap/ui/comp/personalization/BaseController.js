/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2017 SAP SE. All rights reserved
 */
sap.ui.define(['sap/ui/base/ManagedObject','./Util'],function(M,U){"use strict";var B=M.extend("sap.ui.comp.personalization.BaseController",{metadata:{"abstract":true,library:"sap.ui.comp",properties:{type:{type:"string",group:"Misc",defaultValue:null},model:{type:"sap.ui.model.json.JSONModel",group:"Misc",defaultValue:null},persistentDataRestore:{type:"object",group:"Misc",defaultValue:null,visibility:"hidden"},ignoreColumnKeys:{type:"object",group:"Misc",defaultValue:[],visibility:"hidden"},columnHelper:{type:"sap.ui.comp.personalization.ColumnHelper",defaultValue:null,visibility:"hidden"}},associations:{table:{type:"sap.ui.core.Control",multiple:false}},events:{beforePotentialTableChange:{},afterPotentialTableChange:{}}}});B.prototype.init=function(){this._aColumnKeys=[];};B.prototype.setModelFunction=function(){var t=this;return function(){if(!this.getModel("$sapmP13nPanel")){this.setModel(t.getModel("$sapuicomppersonalizationBaseController"),"$sapmP13nPanel");}};};B.prototype.getTable=function(){var t=this.getAssociation("table");if(typeof t==="string"){t=sap.ui.getCore().byId(t);}return t;};B.prototype.createPersistentStructure=function(i){i=i||[];var p={};p[this.getType()]={};p[this.getType()][this.getItemType()]=i;return p;};B.prototype.createTransientStructure=function(i){i=i||[];var t={};t[this.getType()]={};t[this.getType()].items=i;return t;};B.prototype.getItemType=function(){return this.getType()+"Items";};B.prototype.getPersistentData=function(){var d=this.getModel("$sapuicomppersonalizationBaseController").getData();var p={};if(!d.persistentData[this.getType()]){p=this.createPersistentStructure();}else{p[this.getType()]=d.persistentData[this.getType()];}return p;};B.prototype.setPersistentData=function(d){var D=this.getModel("$sapuicomppersonalizationBaseController").getData();D.persistentData[this.getType()]=d[this.getType()];};B.prototype.getPersistentDataItems=function(){return this.getPersistentData()[this.getType()][this.getItemType()];};B.prototype.getTransientData=function(){var d=this.getModel("$sapuicomppersonalizationBaseController").getData();var t={};if(!d.transientData[this.getType()]){t=this.createTransientStructure();}else{t[this.getType()]=d.transientData[this.getType()];}return t;};B.prototype.setTransientData=function(d){var D=this.getModel("$sapuicomppersonalizationBaseController").getData();D.transientData[this.getType()]=d[this.getType()];};B.prototype.initializeModel=function(m){this.setModel(m,"$sapuicomppersonalizationBaseController");this.setTransientData(this.getTransientData());this.setPersistentData(this.getPersistentData());};B.prototype.getColumnMap=function(o){return o?this.getColumnHelper().getColumnMapOfValidColumnKeys(this.getType(),this.getIgnoreColumnKeys()):this.getColumnHelper().getColumnMap();};B.prototype.createTableRestoreJson=function(c){this._aColumnKeys=c;this.setPersistentDataRestore(this._getTable2JsonRestore(c));};B.prototype.getTableRestoreJson=function(){return U.copy(this.getPersistentDataRestore());};B.prototype.reducePersistentModel=function(){var t=this.getTable();if(!t){return;}var i=[];var p=this.getPersistentData();p[this.getType()][this.getItemType()].forEach(function(I){if(this._aColumnKeys.indexOf(I.columnKey)>-1){i.push(I);}},this);p[this.getType()][this.getItemType()]=i;this.setPersistentData(p);};B.prototype._getTable2Json=function(){};B.prototype._getTable2JsonRestore=function(c){return this._getTable2Json();};B.prototype.syncTable2PersistentModel=function(){this.setPersistentData(this._getTable2Json());};B.prototype.syncTable2TransientModel=function(){};B.prototype.getPanel=function(){};B.prototype.onAfterSubmit=function(p){this.syncJsonModel2Table(this.getModel("$sapuicomppersonalizationBaseController").getData().persistentData);};B.prototype.onAfterReset=function(p){};B.prototype.syncJsonModel2Table=function(j){};B.prototype.getChangeType=function(p,P){};B.prototype.getChangeData=function(p,P){};B.prototype.getUnionData=function(p,P){};B.prototype.determineNeededColumnKeys=function(p){var r={};r[this.getType()]=[];if(!p||!p[this.getType()]||!p[this.getType()][this.getItemType()]){return r;}p[this.getType()][this.getItemType()].forEach(function(m){r[this.getType()].push(m.columnKey);},this);return r;};B.prototype.exit=function(){this._aColumnKeys=null;};return B;},true);
