/*
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2017 SAP SE. All rights reserved
 */
sap.ui.define(["jquery.sap.global","sap/m/TextArea","sap/m/Link","sap/m/CheckBox","sap/m/ComboBox","sap/m/DatePicker","sap/m/DateTimePicker","sap/m/FlexItemData","sap/m/FlexJustifyContent","sap/m/HBox","sap/m/Input","sap/m/InputType","sap/m/Select","sap/m/Text","sap/ui/core/Renderer","sap/ui/core/TextAlign","sap/ui/comp/navpopover/SmartLink","./ControlFactoryBase","./FieldControl","./ODataControlSelector","./ODataHelper","./ODataTypes","sap/m/ObjectNumber","sap/m/ObjectIdentifier","sap/m/ObjectStatus","sap/ui/core/ValueState","sap/m/TimePicker","sap/ui/comp/navpopover/SemanticObjectController","sap/ui/comp/util/FormatUtil","sap/ui/comp/odata/MetadataAnalyser"],function(q,T,L,C,a,D,b,F,c,H,I,d,S,e,R,f,g,h,i,O,j,k,l,m,o,V,p,r,s,M){"use strict";var t=h.extend("sap.ui.comp.smartfield.ODataControlFactory",{constructor:function(n,P,u){h.apply(this,[n,P]);this.sName="ODataControlFactory";this._oMetaData={annotations:{}};this._oMeta=u;this._oHelper=new j(n,this._oBinding);this._oFieldControl=new i(P,this._oHelper);this._oTypes=new k(P);this._oSelector=new O(this._oMetaData,P,this._oTypes);this._bInitialized=false;this.bPending=false;}});t.prototype._init=function(n){this._oMetaData.model=n.model;this._oMetaData.path=n.path;this._oMetaData.entitySet=n.entitySetObject||this._oHelper.oMeta.getODataEntitySet(n.entitySet);this._oMetaData.entityType=n.entityType||this._oHelper.oMeta.getODataEntityType(this._oMetaData.entitySet.entityType);this._oMetaData.navigationPath=n.navigationPath||null;if(this._oModel){this._oHelper.checkNavigationProperty(this._oMetaData,this._oParent);this._oHelper.getProperty(this._oMetaData);var u=this.getEdmProperty();if(u){if(this._oParent&&this._oParent.getExpandNavigationProperties()){var v=this._oParent.getBindingContext();var w=v.getObject().__metadata.created;if(!w){var A=this._oHelper.getAutoExpandProperties(u);if(A.length>0){this._oParent.bindElement({path:"",parameters:{expand:A,select:A}});}}}this._oMetaData.annotations.text=this._oHelper.getTextProperty2(this._oMetaData);this._oMetaData.annotations.uom=this._oHelper.getUnitOfMeasure2(this._oMetaData);this._oHelper.getValueListData(this._oMetaData);this._oMetaData.annotations.lineitem=this._oHelper.getAnalyzer().getLineItemAnnotation(this._oMetaData.entitySet.entityType);this._oHelper.getUOMValueListAnnotationPath(this._oMetaData);this._oMetaData.annotations.semantic=M.getSemanticObjectsFromProperty(u);this._oMetaData.annotations.semanticKeys=this._oHelper.getAnalyzer().getSemanticKeyAnnotation(this._oMetaData.entitySet.entityType);if(this._oMetaData.annotations.uom){this._oMetaData.annotations.uom.annotations={};this._oHelper.getValueListData(this._oMetaData.annotations.uom);}this._oHelper.getUOMTextAnnotation(this._oMetaData);}else{q.sap.log.warning("SmartField: Property "+n.path+" does not exist","SmartField: Property "+n.path+" does not exist","sap.ui.comp.smartfield.ODataControlFactory");}}else{this._oMetaData.modelObject=n.modelObject;this._oMetaData.property=n.property;this._oMetaData.annotations.text=n.annotations.text;this._oMetaData.annotations.uom=n.annotations.uom;if(this._oMetaData.annotations.uom&&!this._oMetaData.annotations.uom.annotations){this._oMetaData.annotations.uom.annotations={};}this._oMetaData.annotations.valuelist=n.annotations.valuelist;this._oMetaData.annotations.valuelistType=n.annotations.valuelistType;this._oMetaData.annotations.lineitem=n.annotations.lineitem;this._oMetaData.annotations.semantic=n.annotations.semantic;this._oMetaData.annotations.valuelistuom=n.annotations.valuelistuom;}};t.prototype._createEdmDisplay=function(){var n,u,A,v,w,x,y,z,B=this,N={width:true,textAlign:true},E=this.getEdmProperty();if(E){z=this._oHelper.oAnnotation.getText(E);}n=this._oParent.data("configdata");var G=((n&&(n.isInnerControl!==true))||this._oParent.isContextTable());var J=this._oSelector.checkComboBox(G);if(J&&J.combobox&&(this._oParent.getFetchValueListReadOnly()||!z)){return this._createComboBox({annotation:J.annotation,noDialog:true,noTypeAhead:true},true);}if(this._checkLink()&&!this._oSelector.useObjectIdentifier()){return this._createLink();}A=this.createAttributes(null,this._oMetaData.property,N);x=this._oSelector.checkDatePicker();if(x){v=this.getFormatSettings("dateFormatSettings");A.text={model:this._oMetaData.model,path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property,v,{displayFormat:"Date"})};}else{A.text={model:this._oMetaData.model,path:this._oHelper.getEdmDisplayPath(this._oMetaData),type:this._oTypes.getType(this._oMetaData.property)};}if(E){w=this._oHelper.oAnnotation.isMasked(E);if(w){A.text.formatter=function(Q){if(Q){return Q.replace(new RegExp(".","igm"),"*");}return Q;};}if(z){y=this._oSelector.useObjectIdentifier(x,w);if(y){delete A.width;delete A.textAlign;A.text={path:this._oMetaData.path};A.title={path:this._oHelper.getEdmDisplayPath(this._oMetaData)};if(this._oParent.hasListeners("press")){A.titleActive=true;A.titlePress=function(Q){B._oParent.firePress(Q);};}else if(this._oMetaData.annotations.semantic&&this._oMetaData.annotations.semantic.defaultSemanticObject){var K;var P;r.getDistinctSemanticObjects().then(function(Q){K=r.hasDistinctSemanticObject(B._oMetaData.annotations.semantic.defaultSemanticObject,Q);if(K){var U=B._oParent.getBindingInfo("value");var W=U.parts[0].path;var X=B._oMetaData.property.property["sap:label"];if(B._oMetaData.annotations.lineitem&&B._oMetaData.annotations.lineitem.labels&&B._oMetaData.annotations.lineitem.labels[W]){X=B._oMetaData.annotations.lineitem.labels[W];}q.sap.require("sap.ui.comp.navpopover.NavigationPopoverHandler");P=new sap.ui.comp.navpopover.NavigationPopoverHandler({semanticObject:B._oMetaData.annotations.semantic.defaultSemanticObject,additionalSemanticObjects:B._oMetaData.annotations.semantic.additionalSemanticObjects,semanticObjectLabel:X,fieldName:W,navigationTargetsObtained:function(Y){var Z=sap.ui.getCore().byId(Y.getSource().getControl());var $=Y.getParameters().mainNavigation;if($){$.setDescription(Z.getText());}Y.getParameters().show(Z.getTitle(),$,undefined,undefined);}});}});A.titleActive={path:"$sapuicompsmartfield_distinctSO>/distinctSemanticObjects/"+this._oMetaData.annotations.semantic.defaultSemanticObject,formatter:function(Q){return!!Q;}};A.titlePress=function(Q){if(K&&P){P.setControl(Q.getSource(Q.getParameter("domRef")));P.openPopover();}};}}else if(!(n&&(n.isInnerControl===true))){A.text={};A.text.parts=[];A.text.parts.push(this._oMetaData.path);A.text.parts.push(this._oHelper.getEdmDisplayPath(this._oMetaData));A.text.formatter=function(Q,U){if(J&&J.combobox){return B._formatDisplayBehaviour("defaultComboBoxReadOnlyDisplayBehaviour",Q,U);}else{return B._formatDisplayBehaviour("defaultInputFieldDisplayBehaviour",Q,U);}};}}else if(this._oSelector.checkCheckBox()){A.text.formatter=function(Q){return B._formatDisplayBehaviour("defaultCheckBoxDisplayBehaviour",Q);};}}if(y){u=new m(this._oParent.getId()+"-objIdentifier",A);if(this._oMetaData.annotations.semantic){u.setModel(r.getJSONModel(),"$sapuicompsmartfield_distinctSO");}}else{if(A.text.type&&(A.text.type instanceof sap.ui.comp.smartfield.type.DateTime)&&A.text.type.oConstraints&&A.text.type.oConstraints.isDateOnly){A.wrapping=false;}if(this._oParent.isContextTable()&&sap.ui.getCore().getConfiguration().getRTL()){A.textDirection="LTR";}u=new e(this._oParent.getId()+"-text",A);}if(!y&&n&&n.configdata&&n.configdata.onText){n.configdata.onText(u);}return{control:u,onCreate:"_onCreate",params:{noValidations:true}};};t.prototype._createEdmTime=function(){var A,n,N={placeholder:true,valueState:true,valueStateText:true};A=this.createAttributes("value",this._oMetaData.property,N,{event:"change"});A.valueFormat="HH:mm:ss";n=new p(this._oParent.getId()+"-timePicker",A);return{control:n,onCreate:"_onCreate",params:{getValue:"getValue",type:{type:A.value.type,property:this._oMetaData.property}}};};t.prototype._createObjectStatus=function(){var A,n,u;A=this.createAttributes(null,this._oMetaData.property,null);n=this._oHelper.oAnnotation.getText(this.getEdmProperty());if(n){A.text={parts:[]};A.text.parts.push(this._oHelper.getEdmDisplayPath(this._oMetaData));}else{A.text={model:this._oMetaData.model,path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property)};}this._addObjectStatusAttributes(A);u=new o(this._oParent.getId()+"-objStatus",A);return{control:u,onCreate:"_onCreate",params:{getValue:"getText",noValidation:true}};};t.prototype._addObjectStatusAttributes=function(A){var n,P=this._oParent.getControlProposal(),u=P.getObjectStatus();if(u){n=u.getBindingInfo("criticality");}var v=function(x){var y={0:V.None,1:V.Error,2:V.Warning,3:V.Success};var z={"com.sap.vocabularies.UI.v1.CriticalityType/Neutral":V.Neutral,"com.sap.vocabularies.UI.v1.CriticalityType/Negative":V.Warning,"com.sap.vocabularies.UI.v1.CriticalityType/Critical":V.Error,"com.sap.vocabularies.UI.v1.CriticalityType/Positive":V.Success};return z[x]||y[x]||V.None;};var w=function(){var x,y={"Error":"sap-icon://status-negative","Warning":"sap-icon://status-critical","Success":"sap-icon://status-positive","None":"sap-icon://status-inactive"};if(n){if(n.formatter){x=n.formatter.apply(null,arguments);}else{x=arguments[0];}}else{x=u.getCriticality();}if((x===undefined)||(x===null)){return null;}return y[v(x)];};if(n){A.state={formatter:function(){var x;if(n.formatter){x=n.formatter.apply(null,arguments);}else{x=arguments[0];}return v(x);},parts:n.parts};if(u.getCriticalityRepresentationType()!==sap.ui.comp.smartfield.CriticalityRepresentationType.WithoutIcon){A.icon={formatter:w,parts:n.parts};}}else{if(u){A.state=v(u.getCriticality());if(u.getCriticalityRepresentationType()!==sap.ui.comp.smartfield.CriticalityRepresentationType.WithoutIcon){A.icon=w();}}else{A.icon=w();}}};t.prototype._createEdmString=function(){var n,u,v,A,w,x,N={width:true,textAlign:true,placeholder:true,tooltip:true,name:true,valueState:true,valueStateText:true};if(this._oSelector.checkCheckBox()){return this._createCheckBox();}w=this._oSelector.checkSelection();if(w.selection){return this._createSelect({annotation:w.annotation,noDialog:true,noTypeAhead:true});}w=this._oSelector.checkComboBox();if(w.combobox){return this._createComboBox({annotation:w.annotation,noDialog:true,noTypeAhead:true});}var y=this.getEdmProperty();if(y){u=this._oHelper.oAnnotation.isMultiLineText(y);if(u){delete N["width"];return this._createMultiLineText(N);}}A=this.createAttributes("value",this._oMetaData.property,N);this._addMaxLength(A,w.annotation);x=new I(this._oParent.getId()+"-input",A);if(y){n=this._oHelper.oAnnotation.isMasked(y);if(n){x.setType(d.Password);}this._handleEventingForEdmString(x,this._oMetaData.property);}v=this._oParent.data("configdata");if(v&&v.configdata&&v.configdata.onInput){v.configdata.onInput(x);}return{control:x,onCreate:"_onCreate",params:{valuehelp:{annotation:w.annotation,noDialog:!this._oParent.getShowValueHelp(),noTypeAhead:!this._oParent.getShowSuggestion(),aggregation:"suggestionRows"},getValue:"getValue",type:{type:A.value.type,property:this._oMetaData.property}}};};t.prototype._addMaxLength=function(A,n){var u;u=this._getMaxLength();if(u>0){if(!n||!this._oParent.getShowSuggestion()){A.maxLength=u;}}};t.prototype._getMaxLength=function(){var B;B=this._oParent.getBindingInfo("value");return this._oTypes.getMaxLength(this._oMetaData.property,B);};t.prototype._addAriaLabelledBy=function(n){var u,v,w;if((this._oParent.getControlContext()===sap.ui.comp.smartfield.ControlContextType.None)||(this._oParent.getControlContext()===sap.ui.comp.smartfield.ControlContextType.Form)||(this._oParent.getControlContext()===sap.ui.comp.smartfield.ControlContextType.SmartFormGrid)){h.prototype._addAriaLabelledBy.apply(this,arguments);w=this._oParent.data("configdata");if(w&&w.configdata.isInnerControl&&w.configdata.isUOM){if(n){v=n.control;if(v instanceof H){if(v.getItems().length>0){v=v.getItems()[0];}}}if(v&&v.getAriaLabelledBy&&v.getAriaLabelledBy().length===0){var E=this.getEdmProperty();if(this._oHelper.oAnnotation.getLabel(E)){q.sap.require("sap.ui.core.InvisibleText");u=new sap.ui.core.InvisibleText({text:this._oHelper.oAnnotation.getLabel(E)});v.addAriaLabelledBy(u);this._oParent.addAggregation("_ariaLabelInvisibleText",u);}}}}};t.prototype._handleEventingForEdmString=function(n,P){var u,v=this;if(n){u=this._oHelper.oAnnotation.isUpperCase(P.property);n.attachChange(function(E){var N={};if(E&&E.mParameters){var w=E.mParameters.value;if(u&&w){w=w.toUpperCase();n.setValue(w);}N.value=w;N.newValue=w;if(E.mParameters.validated){N.validated=E.mParameters.validated;}if(n._oSuggestionPopup&&n._oSuggestionPopup.isOpen()){if(!E.mParameters.validated){if(n._iPopupListSelectedIndex>=0){return;}}}try{v._oParent.fireChange(N);}catch(x){q.sap.log.warning(x);}}});}};t.prototype._createComboBox=function(v,n){var u=null,w,A,N={width:true,textAlign:true,placeholder:true,tooltip:true,name:true};w=this._oParent.data("configdata");A=this.createAttributes("selectedKey",this._oMetaData.property,N);A.selectionChange=this._oHelper.getSelectionChangeHandler(this._oParent);A.change=function(E){if(E.getParameter("itemPressed")){return;}var x=E.getSource().getSelectedKey();this._oParent.fireChange({value:x,newValue:x});}.bind(this);if(A.width===""){A.width="100%";}if(n){u=this._createDisplayedComboBox(A);}else{u=new a(this._oParent.getId()+"-comboBoxEdit",A);}if(w&&w.configdata&&w.configdata.onText){w.configdata.onText(u);}return{control:u,onCreate:"_onCreate",params:{valuehelp:{annotation:v.annotation,aggregation:"items",noDialog:v.noDialog,noTypeAhead:v.noTypeAhead},getValue:"getSelectedKey",type:{type:A.selectedKey.type,property:this._oMetaData.property}}};};t.prototype._createDisplayedComboBox=function(A){var n=a.extend("sap.ui.comp.smartfield.DisplayComboBox",{metadata:{library:"sap.ui.comp"},renderer:function(u,v){var w=v.getWidth(),x=v.getValue(),y=v.getTextDirection(),z=v.getTextAlign();x.replace(/\r\n/g,"\n");u.write("<span");u.writeControlData(v);u.addClass("sapMText");u.addClass("sapUiSelectable");if(w){u.addStyle("width",w);}else{u.addClass("sapMTextMaxWidth");}if(y!==sap.ui.core.TextDirection.Inherit){u.writeAttribute("dir",y.toLowerCase());}if(z){z=R.getTextAlign(z,y);if(z){u.addStyle("text-align",z);}}u.writeClasses();u.writeStyles();u.write(">");u.writeEscaped(x);u.write("</span>");},updateDomValue:function(v){if(!this.isActive()){return this;}v=this._getInputValue(v);if(this.$().text()!==v){this.$().text(v);this._bCheckDomValue=true;}return this;},getValue:function(){return this.getProperty("value");},getFocusDomRef:function(){return this.getDomRef();},getEditable:function(){return false;}});return new n(this._oParent.getId()+"-comboBoxDisp",A);};t.prototype._createSelect=function(v){var n={width:true,name:true},A=this.createAttributes("selectedKey",this._oMetaData.property,n);A.change=this._oHelper.getSelectionChangeHandler(this._oParent);A.forceSelection=false;if(A.width===""){A.width="100%";}return{control:new S(this._oParent.getId()+"-select",A),onCreate:"_onCreate",params:{valuehelp:{annotation:v.annotation,aggregation:"items",noDialog:v.noDialog,noTypeAhead:v.noTypeAhead},getValue:"getSelectedKey",type:{type:A.selectedKey.type,property:this._oMetaData.property}}};};t.prototype._createCheckBox=function(){var A=this.createAttributes("selected",null,{},{event:"select",parameter:"selected"});A.editable=(this._oParent.getEditable()&&this._oParent.getEnabled()&&this._oParent.getContextEditable());A.selected.type=this._oTypes.getAbapBoolean();return{control:new C(this._oParent.getId()+"-cBox",A),onCreate:"_onCreate",params:{getValue:"getSelected"}};};t.prototype._createEdmDateTime=function(){var n={width:true,textAlign:true,placeholder:true,name:true},A=this.createAttributes(null,this._oMetaData.property,n,{event:"change",parameter:"value"}),u=this.getFormatSettings("dateFormatSettings");if(this._oSelector.checkDatePicker()){A.value={path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property,u,{displayFormat:"Date"}),model:this._oMetaData.model};if(u&&u.style){A.displayFormat=u.style;}return{control:new D(this._oParent.getId()+"-datePicker",A),onCreate:"_onCreate",params:{getValue:"getValue",type:{type:A.value.type,property:this._oMetaData.property}}};}A.value={path:this._oMetaData.path,model:this._oMetaData.model,type:this._oTypes.getType(this._oMetaData.property,u)};return{control:new b(this._oParent.getId()+"-input",A),onCreate:"_onCreate",params:{getValue:"getValue",type:{type:A.value.type,property:this._oMetaData.property}}};};t.prototype._createEdmDateTimeOffset=function(){var n=this.getFormatSettings("dateFormatSettings");if(n){n.UTC=false;}var N={width:true,textAlign:true,placeholder:true,name:true};var A=this.createAttributes(null,this._oMetaData.property,N,{event:"change",parameter:"value"});A.value={model:this._oMetaData.model,path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property,n)};return{control:new b(this._oParent.getId()+"-input",A),onCreate:"_onCreate",params:{getValue:"getValue",type:{type:A.value.type,property:this._oMetaData.property}}};};t.prototype._createEdmNumeric=function(){var n={width:true,textAlign:true,placeholder:true,name:true},A=this.createAttributes("value",this._oMetaData.property,n,{event:"change",parameter:"value"});if(this._oParent.isContextTable()&&sap.ui.getCore().getConfiguration().getRTL()){A.textDirection="LTR";}return{control:new I(this._oParent.getId()+"-input",A),onCreate:"_onCreate",params:{getValue:"getValue",type:{type:A.value.type,property:this._oMetaData.property}}};};t.prototype._createEdmUOM=function(){var P,n,u,A=this._createEdmUOMAttributes(),v=this._oParent.getObjectBinding(this._oMetaData.model),w,B,x,y=this;this.addObjectBinding(A,v);var z=false;if(this._oParent.isContextTable()&&sap.ui.getCore().getConfiguration().getRTL()){z=true;}if(z){A.textDirection="LTR";}n=new I(this._oParent.getId()+"-input",A);if(this._oParent.data("suppressUnit")==="true"){w={getValue:"getValue"};if(!this._oHelper.oAnnotation.isCurrency(this._oMetaData.annotations.uom.property.property)){w.type={type:A.value.type,property:this._oMetaData.property};}return{control:n,onCreate:"_onCreate",params:w};}if(!this._oHelper.oAnnotation.isCurrency(this._oMetaData.annotations.uom.property.property)){x={type:A.value.type,property:this._oMetaData.property};}P=this._oHelper.getUOMPath(this._oMetaData);A={value:{model:this._oMetaData.model,path:P},change:this._oHelper.getUOMChangeHandler(this._oParent,true),textAlign:this._getEdmUOMTextAlignment()};this.addObjectBinding(A,v);this.mapBindings(A,{"uomEditable":"editable","uomEnabled":"enabled","uomVisible":"visible","mandatory":"mandatory","contextEditable":"contextEditable"});if(this._oParent.getConfiguration()){A.configuration=new sap.ui.comp.smartfield.Configuration({preventInitialDataFetchInValueHelpDialog:this._getPreventInitialDataFetchInVHDialog()});}u=new sap.ui.comp.smartfield.SmartField(this._oParent.getId()+"-sfEdit",A);u.data("configdata",{"configdata":{isInnerControl:true,isUOM:!this._oParent.data("configdata"),model:this._oMetaData.model,navigationPath:this._oMetaData.annotations.uom.navigationPath||null,path:P,entitySetObject:this._oMetaData.annotations.uom.entitySet,entityType:this._oMetaData.annotations.uom.entityType,property:this._oMetaData.annotations.uom.property,annotations:{valuelist:this._oMetaData.annotations.valuelistuom,valuelistType:this._oMetaData.annotations.uom.annotations.valuelistType,text:this._oMetaData.annotations.textuom},modelObject:this._oMetaData.modelObject||this._oModel,onText:function(E){n.setLayoutData(new F({growFactor:1}));u.setLayoutData(new F({shrinkFactor:0}));if(E){if(z&&E.setTextDirection){E.setTextDirection("LTR");}if((y._oParent.getControlContext()!=="table")&&(y._oParent.getControlContext()!=="responsiveTable")){E.addStyleClass("sapUiCompSmartFieldUnit");}}},onInput:function(E){n.setLayoutData(new F({growFactor:1}));u.setLayoutData(new F({growFactor:0}));if(E){if(z&&E.setTextDirection){E.setTextDirection("LTR");}if(y._oParent&&(y._oParent.getControlContext()!=="table")&&(y._oParent.getControlContext()!=="responsiveTable")){E.addStyleClass("sapUiCompSmartFieldUnit");}}}}});u.data("errorCheck","setComplexClientErrorSecondOperandNested");n.addAriaLabelledBy(u);n.addStyleClass("smartFieldPaddingRight");n.addStyleClass("sapUiCompSmartFieldValue");B=new H({justifyContent:c.End,items:[n,u],fitContainer:true,width:this._oParent.getWidth()});B.addStyleClass("sapUiCompUOM");if(this._oParent.isContextTable()){if(z){B.addStyleClass("sapUiCompDirectionLTR");}B.addStyleClass("sapUiCompUOMInTable");}return{control:B,onCreate:"_onCreateUOM",params:{getValue:true,valuehelp:true,type:x}};};t.prototype._createEdmUOMAttributes=function(){var A={textAlign:this._getEdmUOMTextAlignment(),placeholder:this.getAttribute("placeholder"),name:this.getAttribute("name"),change:this._oHelper.getUOMChangeHandler(this._oParent)};if(this._oMetaData.annotations.uom&&this._oHelper.oAnnotation.isCurrency(this._oMetaData.annotations.uom.property.property)){A.value={parts:[{path:this._oMetaData.path},{path:this._oHelper.getUOMPath(this._oMetaData)}],model:this._oMetaData.model,type:this._oTypes.getCurrencyType(this._oMetaData.property)};}else{A.value={model:this._oMetaData.model,path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property)};}return A;};t.prototype._getEdmUOMTextAlignment=function(){var A=this.getAttribute("textAlign");if(!A){A=f.Initial;}if(A===f.Initial){if(this._oParent.isContextTable()){return f.End;}else{return f.Begin;}}return A;};t.prototype._createEdmUOMDisplay=function(){var v,P=this._oHelper.getUOMPath(this._oMetaData),n,A,u=this._getEdmUOMTextAlignment(),B,w=null,E=this.getEdmProperty(),x=this,y=false;if(this._oParent.isContextTable()&&sap.ui.getCore().getConfiguration().getRTL()){y=true;}A={text:{parts:[{path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property)},{path:P}],model:this._oMetaData.model,formatter:this._oTypes.getDisplayFormatter(E,this._oHelper.oAnnotation.isCurrency(E)),useRawValues:true},textAlign:u};if(y){A.textDirection="LTR";}n=this._oParent.getObjectBinding(this._oMetaData.model);this.addObjectBinding(A,n);v=new e(this._oParent.getId()+"-text",A);P=this._oHelper.getUOMPath(this._oMetaData);A={value:{model:this._oMetaData.model,path:P},change:this._oHelper.getUOMChangeHandler(this._oParent,true),textAlign:this._getEdmUOMTextAlignment()};this.addObjectBinding(A,n);this.mapBindings(A,{"uomEditable":"editable","uomEnabled":"enabled","uomVisible":"visible","mandatory":"mandatory","contextEditable":"contextEditable"});v.addStyleClass("smartFieldPaddingRight");v.addStyleClass("sapUiCompSmartFieldValue");if(!this._checkSuppressUnit()){w=new sap.ui.comp.smartfield.SmartField(this._oParent.getId()+"-sfDisp",A);w.data("configdata",{"configdata":{isInnerControl:true,isUOM:!this._oParent.data("configdata"),model:this._oMetaData.model,navigationPath:this._oMetaData.annotations.uom.navigationPath||null,path:P,entitySetObject:this._oMetaData.annotations.uom.entitySet,entityType:this._oMetaData.annotations.uom.entityType,property:this._oMetaData.annotations.uom.property,annotations:{valuelist:this._oMetaData.annotations.valuelistuom,text:this._oMetaData.annotations.textuom},modelObject:this._oMetaData.modelObject||this._oModel,onText:function(z){if(z){if(z.setWrapping){z.setWrapping(false);}if(y&&z.setTextDirection){z.setTextDirection("LTR");}if(x._oParent&&(x._oParent.getControlContext()!=="table")&&(x._oParent.getControlContext()!=="responsiveTable")){z.addStyleClass("sapUiCompSmartFieldUnit");}}},onInput:function(z){v.setLayoutData(new F({growFactor:0}));w.setLayoutData(new F({growFactor:0}));if(z){if(y&&z.setTextDirection){z.setTextDirection("LTR");}if((x._oParent.getControlContext()!=="table")&&(x._oParent.getControlContext()!=="responsiveTable")){z.addStyleClass("sapUiCompSmartFieldUnit");}}},getContextEditable:function(){return x._oParent.getContextEditable();}}});w.data("errorCheck","setComplexClientErrorSecondOperandNested");B=new H({items:[v,w],fitContainer:true,width:this._oParent.getWidth()});if(this._oParent.isContextTable()){B.setJustifyContent("End");this._oParent.addStyleClass("sapUiCompUOMInTable");if(y){B.addStyleClass("sapUiCompDirectionLTR");}B.addStyleClass("sapUiCompUOMInTable");}return{control:B};}return{control:v};};t.prototype._checkSuppressUnit=function(){if(this._oParent.data("suppressUnit")==="true"){return true;}var n=this._oParent.getBindingInfo("uomVisible");return(!n&&!this._oParent.getUomVisible());};t.prototype._createEdmUOMObjectStatus=function(){var n,u,E=this.getEdmProperty(),v=this._oTypes.getDisplayFormatter(E,this._oHelper.oAnnotation.isCurrency(E)),P=this._oHelper.getUOMPath(this._oMetaData),A={text:{parts:[{path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property)},{path:P}],formatter:function(){var w=v.apply(this,arguments);return w+arguments[1];},useRawValues:true}};this._addObjectStatusAttributes(A);n=this._oParent.getObjectBinding(this._oMetaData.model);this.addObjectBinding(A,n);u=new o(this._oParent.getId()+"-objStatus",A);u.addStyleClass("sapUiCompUOM");return{control:u};};t.prototype._createEdmUOMObjectNumber=function(){var A,n,u,v=this._getEdmUOMTextAlignment();if(this._oMetaData.annotations.uom&&this._oHelper.oAnnotation.isCurrency(this._oMetaData.annotations.uom.property.property)){A={number:{parts:[{path:this._oMetaData.path},{path:this._oHelper.getUOMPath(this._oMetaData)}],type:this._oTypes.getCurrencyType(this._oMetaData.property)},unit:{path:this._oHelper.getUOMPath(this._oMetaData)},model:this._oMetaData.model,textAlign:v};}else{A={model:this._oMetaData.model,number:{path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property)},unit:{path:this._oHelper.getUOMPath(this._oMetaData)},textAlign:v};}n=this._oParent.getObjectBinding(this._oMetaData.model);this.addObjectBinding(A,n);u=new l(this._oParent.getId()+"-objNumber",A);u.addStyleClass("sapUiCompUOM");return{control:u};};t.prototype._createEdmSemantic=function(){var A,n,u,v=this,w=this._oParent.getBindingInfo("value"),P=w.parts[0].path,E=this.getEdmProperty(),x=E["sap:label"];if(this._oMetaData.annotations.lineitem&&this._oMetaData.annotations.lineitem.labels&&this._oMetaData.annotations.lineitem.labels[P]){x=this._oMetaData.annotations.lineitem.labels[P];}A={semanticObject:this._oMetaData.annotations.semantic.defaultSemanticObject,additionalSemanticObjects:this._oMetaData.annotations.semantic.additionalSemanticObjects,semanticObjectLabel:x,fieldName:P,width:this.getAttribute("width"),createControlCallback:function(){var y=this.createControl(true);if(y){return y.control;}return null;}.bind(this)};n=this._oHelper.oAnnotation.getText(E);if(n){A.text={parts:[this._oMetaData.path,this._oHelper.getEdmDisplayPath(this._oMetaData)],model:this._oMetaData.model,formatter:function(y,z){if(y&&z){return v._formatDisplayBehaviour("defaultInputFieldDisplayBehaviour",y,z);}return y?y:"";}};A.navigationTargetsObtained=function(y){var B=this.getBinding("text");if(!q.isArray(B.getValue())){y.getParameters().show();return;}var z=B.getValue();var G=v._getDisplayBehaviourConfiguration("defaultInputFieldDisplayBehaviour")||"idOnly";var J=s.getTextsFromDisplayBehaviour(G,z[0],z[1]);var K=y.getParameters().mainNavigation;if(K){K.setDescription(J.secondText);}y.getParameters().show(J.firstText,K,undefined,undefined);};}else{u=this._oHelper.getUOMPath(this._oMetaData);if(u){A.text={parts:[{path:P},{path:u}],model:this._oMetaData.model,formatter:this._oHelper.oAnnotation.isCurrency(this._oMetaData.annotations.uom.property.property)?s.getAmountCurrencyFormatter():s.getMeasureUnitFormatter(),useRawValues:true};A.uom={path:u};}else{A.text={path:P,model:this._oMetaData.model};}}return{control:new g(this._oParent.getId()+"-sl",A),onCreate:"_onCreate",params:{getValue:"getInnerControlValue"}};};t.prototype._createMultiLineText=function(n){var A=this.createAttributes("value",this._oMetaData.property,n);var u=this.getFormatSettings("multiLineSettings");A=q.extend(true,A,u);if(this._oParent.isContextTable()){A.width="100%";}var v=new T(this._oParent.getId()+"-textArea",A);this._handleEventingForEdmString(v,this._oMetaData.property);return{control:v,onCreate:"_onCreate",params:{type:{type:A.value.type,property:this._oMetaData.property},getValue:"getValue"}};};t.prototype.getEdmProperty=function(){var n=this._oHelper;if(n){return n.getEdmProperty(this._oMetaData);}return null;};t.prototype._checkLink=function(){var n=this._oParent.getBindingInfo("url"),P=this.getEdmProperty();if(n||this._oParent.getUrl()||t.isSpecialLink(P)){return true;}return this._oParent.hasListeners("press");};t.prototype._createLink=function(){var n=this;var A={text:"",href:""},P=this._oParent,B=P.getBindingInfo("url");if(B){A.href=this._oBinding.toBinding(B);}else{A.href=P.getUrl();}if(P.hasListeners("press")){A.press=function(E){E.preventDefault();P.firePress(E);};}B=P.getBindingInfo("value");if(B){var u=this._oMetaData,v=u.path,w=u.property.property;if(u.annotations.text&&(w.type==="Edm.String")){A.text={parts:[u.path,this._oHelper.getEdmDisplayPath(u)],formatter:this._formatText.bind(n)};}else if(t.isSpecialLink(w)){var x=t[t._getLinkFormatterFunctionName(w)];A.text={path:v};A.href={path:v,formatter:null};if(typeof x==="function"){A.href.formatter=x;}}else{A.text=this._oBinding.toBinding(B);}}else{A.text=P.getValue();}return{control:new L(P.getId()+"-link",A),onCreate:"_onCreate",params:{noValidation:true}};};t.isSpecialLink=function(P){return M.isEmailAddress(P)||M.isPhoneNumber(P)||M.isURL(P);};t._getLinkFormatterFunctionName=function(P){return"_format"+M.getLinkDisplayFormat(P);};t._formatEmailAddress=function(E){return"mailto:"+E;};t._formatPhoneNumber=function(P){return"tel:"+P;};t._formatURL=function(u){return q.sap.validateUrl(u)?u:"";};t.prototype._formatText=function(n,u){if(n&&u){return this._formatDisplayBehaviour("defaultInputFieldDisplayBehaviour",n,u);}return n||"";};t.prototype._createEdmBoolean=function(){var A,n,u,v=this,w=null,E=false;E=this._oParent.getEditable()&&this._oParent.getEnabled()&&this._oParent.getContextEditable();n=this._oSelector.checkComboBox();if(n.combobox){return this._createComboBox({annotation:n.annotation,noDialog:true,noTypeAhead:true},!E);}if(E){A=this.createAttributes("selected",this._oMetaData.property,{},{event:"select",parameter:"selected"});u=new C(this._oParent.getId()+"-cBoxBool",A);w={getValue:"getSelected"};}else{A=this.createAttributes("text",this._oMetaData.property,{width:true,textAlign:true});A.text={model:this._oMetaData.model,path:this._oMetaData.path};A.text.formatter=function(x){return v._formatDisplayBehaviour("defaultCheckBoxDisplayBehaviour",x);};u=new e(this._oParent.getId()+"-text",A);}return{control:u,onCreate:"_onCreate",params:w};};t.prototype._getCreator=function(B){return this._oSelector.getCreator(B);};t.prototype._onCreate=function(n,P){var G,u,v=true,w=this;if(P){if(P.noValidation){v=false;}if(P.valuehelp){this._getValueHelpDialogTitle(P.valuehelp);P.valuehelp["analyser"]=this._oHelper.getAnalyzer(this._oModel||this._oMetaData.modelObject);this.createValueHelp(n,this.getEdmProperty(),P.valuehelp,this._oModel||this._oMetaData.modelObject,function(E){w._oParent.fireValueListChanged({"changes":E.mParameters.changes});});}if(P.getValue){G=P.getValue;P.getValue=function(){return n[G]();};}if(P.type){u=this._oFieldControl.getMandatoryCheck(P.type.property);if(u){P.type.type.oFieldControl=u;}}}if(v){this.addValidations(n,this._oParent.data("errorCheck")||"setSimpleClientError");if(this._oParent._getMode()!=="display"){n.attachValidationSuccess(function(E){if(!w._oParent.getValue()){if(w._oMetaData.property&&w._oMetaData.property.property&&w._oHelper.oAnnotation.isStaticMandatory(w._oMetaData.property.property)){if(n.setValueStateText){n.setValueStateText(w._oRb.getText("VALUEHELPVALDLG_FIELDMESSAGE"));n.setValueState(sap.ui.core.ValueState.Error);w._oParent.setSimpleClientError(true);}}}});}}if(!this._checkUOM()){n.addStyleClass("sapUiCompSmartFieldValue");}};t.prototype._createValueHelp=function(){var n=this._oParent.getAggregation("_content");if(!n){return;}var v={annotation:this._oMetaData.annotations.valuelist,noDialog:!this._oParent.getShowValueHelp(),noTypeAhead:!this._oParent.getShowSuggestion(),aggregation:"suggestionRows"};this._getValueHelpDialogTitle(v);v["analyser"]=this._oHelper.getAnalyzer(this._oModel||this._oMetaData.modelObject);this.createValueHelp(n,this.getEdmProperty(),v,this._oModel||this._oMetaData.modelObject,function(E){this._oParent.fireValueListChanged({"changes":E.mParameters.changes});}.bind(this));};t.prototype._checkUOM=function(){var n=this._oParent.data("configdata");if(n&&n.configdata){if(n.configdata.onInput||n.configdata.onText){return true;}}return false;};t.prototype._getValueHelpDialogTitle=function(v){v.dialogtitle=this._oParent.getTextLabel();if(!v.dialogtitle){var E=this.getEdmProperty();v.dialogtitle=this._oHelper.oAnnotation.getLabel(E)||E.name;}};t.prototype._onCreateUOM=function(n,P){var u=n.getItems(),v,w=this;this.addValidations(u[0],"setComplexClientErrorFirstOperand");if(this._oParent._getMode()!=="display"){u[0].attachValidationSuccess(function(E){if(!w._oParent.getValue()){if(w._oMetaData.property&&w._oMetaData.property.property&&w._oHelper.oAnnotation.isStaticMandatory(w._oMetaData.property.property)){if(u[0].setValueStateText){u[0].setValueStateText(w._oRb.getText("VALUEHELPVALDLG_FIELDMESSAGE"));u[0].setValueState(sap.ui.core.ValueState.Error);w._oParent.setComplexClientErrorFirstOperand(true);}}}});}if(P&&P.getValue){P.getValue=function(){return u[0].getValue();};}P.uom=function(){return u[1].getValue();};P.uomset=function(x){u[1].setValue(x);};if(P.type){v=this._oFieldControl.getMandatoryCheck(P.type.property);if(v){P.type.type.oFieldControl=v;}}};t.prototype.bind=function(){var n=this,N,u,v=function(w,P){try{n._init(w);n._setUOMEditState();n._bind(P);}catch(x){q.sap.log.warning(x,null,"sap.ui.comp.smartfield.ODataControlFactory.bind.fInit");}};if(!this._bInitialized&&!this.bPending){this._bInitialized=true;N=this._oFieldControl.getBindableAttributes();u=this._oParent.data("configdata");if(u&&u.configdata){v(this._oMeta,N);}else if(this._oModel){this.bPending=true;this._oModel.getMetaModel().loaded().then(function(){n.bPending=false;v(n._oMeta,N);});}}};t.prototype._bind=function(B){var u,v=this._oFieldControl.getControlProperties(this._oMetaData,B);for(var n in v){u=this._oBinding.fromFormatter(this._oMetaData.model,v[n]);this._oParent.bindProperty(n,u);}this._oParent.fireInitialise();};t.prototype.rebindOnCreated=function(){var B,u=this._oFieldControl.getControlProperties(this._oMetaData,["editable"]);for(var n in u){B=this._oBinding.fromFormatter(this._oMetaData.model,u[n]);this._oParent.bindProperty(n,B);}};t.prototype._setUOMEditState=function(){if(this._oFieldControl.hasUomEditState(this._oMetaData)){var n=this._oFieldControl.getUOMEditState(this._oMetaData);if(n){var B=this._oBinding.fromFormatter(this._oMetaData.model,n);this._oParent.bindProperty("uomEditState",B);}}};t.prototype.getDataProperty=function(){return this._oMetaData.property;};t.prototype.getMetaData=function(){return this._oMetaData;};t.prototype.destroy=function(){if(this._oFieldControl){this._oFieldControl.destroy();}if(this._oSelector){this._oSelector.destroy();}if(this._oTypes){this._oTypes.destroy();}if(this._oHelper){this._oHelper.destroy();}this._oHelper=null;this._oFieldControl=null;this._oTypes=null;this._oSelector=null;this._oMetaData=null;h.prototype.destroy.apply(this,arguments);};return t;},true);
