/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2017 SAP SE. All rights reserved
 */
sap.ui.define(['jquery.sap.global','sap/m/Dialog','sap/m/MessageBox','sap/m/MultiInput','sap/m/Token','sap/ui/comp/library','./ItemsCollection','sap/ui/core/Control','sap/ui/core/format/DateFormat','sap/ui/core/format/NumberFormat','sap/m/VBox','sap/m/HBox','sap/m/ButtonType','sap/ui/comp/util/FormatUtil','sap/m/DialogRenderer'],function(q,D,M,a,T,l,I,C,b,N,V,H,B,F,c){"use strict";var d=D.extend("sap.ui.comp.valuehelpdialog.ValueHelpDialog",{metadata:{library:"sap.ui.comp",properties:{basicSearchText:{type:"string",group:"Misc",defaultValue:""},supportMultiselect:{type:"boolean",group:"Misc",defaultValue:true},supportRanges:{type:"boolean",group:"Misc",defaultValue:false},supportRangesOnly:{type:"boolean",group:"Misc",defaultValue:false},key:{type:"string",group:"Misc",defaultValue:""},keys:{type:"string[]",group:"Misc",defaultValue:null},descriptionKey:{type:"string",group:"Misc",defaultValue:""},maxIncludeRanges:{type:"string",group:"Misc",defaultValue:'-1'},maxExcludeRanges:{type:"string",group:"Misc",defaultValue:'-1'},displayFormat:{type:"string",group:"Misc",defaultValue:""},tokenDisplayBehaviour:{type:"string",group:"Misc",defaultValue:""},filterMode:{type:"boolean",group:"Misc",defaultValue:false}},aggregations:{filterBar:{type:"sap.ui.comp.filterbar.FilterBar",multiple:false}},events:{ok:{parameters:{tokens:{type:"sap.m.Token[]"}}},cancel:{},selectionChange:{parameters:{tableSelectionParams:{type:"object"},updateTokens:{type:"object[]"},useDefault:{type:"boolean",defaultValue:false}}},tokenRemove:{parameters:{tokenKeys:{type:"string[]"},useDefault:{type:"boolean",defaultValue:false}}},updateSelection:{parameters:{tokenKeys:{type:"string[]"},useDefault:{type:"boolean",defaultValue:false}}}}},renderer:c.render});d.prototype.setSupportMultiselect=function(e){this.setProperty("supportMultiselect",e);this._updatePropertySupportMultiselect(e);this._oTokenizerGrid.setVisible(e);this._oButtonOk.setVisible(e);return this;};d.prototype._updatePropertySupportMultiselect=function(e){if(!this._oTable){return undefined;}if(!this._isPhone()){if(this._oTable.setSelectionMode){this._oTable.setSelectionMode(e?sap.ui.table.SelectionMode.MultiToggle:sap.ui.table.SelectionMode.Single);}}else if(this._oTable.setMode){this._oTable.setMode(e?sap.m.ListMode.MultiSelect:sap.m.ListMode.SingleSelectLeft);}return this;};d.prototype.setSupportRanges=function(e){this.setProperty("supportRanges",e);this._updateNavigationControl();return this;};d.prototype.setSupportRangesOnly=function(e){this.setProperty("supportRangesOnly",e);this._updateNavigationControl();return this;};d.prototype.setTitle=function(t){this.setProperty("title",t);this._updateDlgTitle();return this;};d.prototype.setFilterBar=function(o){this.setAggregation("filterBar",o);if(this._oMainLayout&&o){if(this._isPhone()){if(this._oFilterBar){this._oVBox.removeItem(this._oFilterBar);this._oFilterBar.detachInitialise(this._handleFilterBarInitialize);}}else if(this._oFilterBar){this._oMainLayout.removeItem(this._oFilterBar);this._oFilterBar.detachInitialise(this._handleFilterBarInitialize);}this._oFilterBar=o;this._oFilterBar.attachInitialise(this._handleFilterBarInitialize,this);if(this._oFilterBar){this._oFilterBar.addStyleClass("compVHSearch");if(this._isPhone()){var s=sap.ui.getCore().byId(this._oFilterBar.getBasicSearch());if(s instanceof sap.m.SearchField){s.setShowSearchButton(true);s.attachSearch(function(E){if(E.mParameters.refreshButtonPressed!==undefined){this.getFilterBar().search();}}.bind(this));}this._oFilterBar.setShowGoOnFB(false);this._oColSearchBox.setLayoutData(new sap.m.FlexItemData({shrinkFactor:0}));this._oVBox.insertItem(this._oColSearchBox,0);this._oFilterBar.setLayoutData(new sap.m.FlexItemData({shrinkFactor:0}));this._oVBox.insertItem(this._oFilterBar,1);this._oFilterBar.attachSearch(function(E){this._updateView(sap.ui.comp.valuehelpdialog._ValueHelpViewMode.PHONE_LIST_VIEW);}.bind(this));if(this._currentViewMode===sap.ui.comp.valuehelpdialog._ValueHelpViewMode.PHONE_LIST_VIEW){this._oFilterBar.setVisible(true);this._oFilterBar.setFilterBarExpanded(false);this._handleFilterBarInitialize();}}else{this._oFilterBar._setCollectiveSearch(this._oColSearchBox);this._oMainLayout.insertItem(this._oFilterBar,0);}}if(this._oFilterBar._oBasicSearchField){var e=this._oFilterBar._oBasicSearchField;e.setValue(this.getBasicSearchText());this.setInitialFocus(e);}}return this;};d.prototype._handleFilterBarInitialize=function(){if(this._currentViewMode===sap.ui.comp.valuehelpdialog._ValueHelpViewMode.PHONE_LIST_VIEW){this._oFilterBar._handleVisibilityOfToolbar();var s=this._oFilterBar&&this._oFilterBar.getFilterGroupItems()&&this._oFilterBar.getFilterGroupItems().length>0;this._oAdvancedSearchLink.setVisible(s);this._oFilterBar.setShowGoButton(!(this._oFilterBar&&this._oFilterBar.getBasicSearch()));}};d.prototype.getFilterBar=function(){return this._oFilterBar;};d.prototype.setBasicSearchText=function(t){this.setProperty("basicSearchText",t);if(this._oFilterBar&&this._oFilterBar._oBasicSearchField){this._oFilterBar._oBasicSearchField.setValue(t);}return this;};d.prototype.setTokens=function(t){if(t.length){var n=0,k;for(var i=0;i<t.length;i++){var e=t[i];if(e.data("range")){var r=e.data("range");k=e.getKey();if(!k){do{k="range_"+n;n++;}while(this._oSelectedRanges[k]);}var f=this._getFormatedRangeTokenText(r.operation,r.value1,r.value2,r.exclude,r.keyField);this._addToken2Tokenizer(k,f,r.exclude?this._oExcludedTokens:this._oSelectedTokens);this._oSelectedRanges[k]=r;}else{k=e.getKey();var s=e.getText();var L=e.data("longKey");var R=e.data("row");if(!L){L=k;}this._oSelectedItems.add(L,R?R:e.getText());this._oSelectedTokens.addToken(new T({key:L,text:s,tooltip:s}));}}}else{this._oSelectedItems.removeAll();this._oSelectedRanges={};}};d.prototype.open=function(){this.bCollectiveSearchActive=this.oSelectionTitle.getVisible()&&this.oSelectionButton.getVisible();if(this._oColSearchBox){this._oColSearchBox.setVisible(this.bCollectiveSearchActive);}if(!this._isPhone()){if(this.getSupportRangesOnly()||this.getFilterMode()){this._updateView(sap.ui.comp.valuehelpdialog._ValueHelpViewMode.DESKTOP_CONDITIONS_VIEW);}else if(!this._oTable){this._createDefaultTable();}this.setContentWidth(this._getDefaultContentWidth());}else{if(!this._oTable){this._createDefaultTable();}this._updateView(sap.ui.comp.valuehelpdialog._ValueHelpViewMode.PHONE_MAIN_VIEW);}D.prototype.open.apply(this);return this;};d.prototype.getTable=function(){if(!this._oTable){this._createDefaultTable();}return this._oTable;};d.prototype.setTable=function(t){if(this._oTable){this._oMainLayout.removeItem(this._oTable);}this._bTableCreatedInternal=(arguments.length>1)&&(arguments[1]==true);if(t instanceof sap.ui.comp.smarttable.SmartTable){this._oTable=t.getTable();}else{this._oTable=t;}this._oTable.setLayoutData(new sap.m.FlexItemData({shrinkFactor:0,growFactor:1}));this.theTable=this._oTable;this._initializeTable();this._oMainLayout.addItem(t);};d.prototype._getDefaultContentWidth=function(){var n=0;if(this._oTable){n=this._oTable.getColumns().length;}var e=Math.max(1080,n*130);return e+"px";};d.prototype.resetTableState=function(){if(this._oTable){if(this._oTable.unbindRows){this._oTable.unbindRows();}this._updateNoDataText(this._oRb.getText("VALUEHELPDLG_TABLE_PRESSSEARCH"));}};d.prototype.TableStateSearchData=function(){this._updateNoDataText(this._oRb.getText("VALUEHELPDLG_TABLE_PRESSSEARCH"));};d.prototype._updateNoDataText=function(n){if(this._oTable){if(this._oTable.setNoData){this._oTable.setNoData(n);}else if(this._oTable.setNoDataText){this._oTable.setNoDataText(n);}}};d.prototype.TableStateDataFilled=function(){this._updateNoDataText(this._oRb.getText("VALUEHELPDLG_TABLE_NODATA"));};d.prototype.TableStateDataSearching=function(){this._updateNoDataText(this._oRb.getText("VALUEHELPDLG_TABLE_SEARCHING"));};d.prototype.init=function(){D.prototype.init.apply(this);this._bTableCreatedInternal=false;this._aIncludeRangeOperations={};this._aExcludeRangeOperations={};this.setStretch(this._isPhone());this.setResizable(!this._isPhone());this.setDraggable(!this._isPhone());this.bCollectiveSearchActive=false;this.addStyleClass("compValueHelpDialog");this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");this._sTableTitle1=this._oRb.getText("VALUEHELPDLG_TABLETITLE1");this._sTableTitle2=this._oRb.getText("VALUEHELPDLG_TABLETITLE2");this._sTableTitleNoCount=this._oRb.getText("VALUEHELPDLG_TABLETITLENOCOUNT");this._currentViewMode=null;this._oSelectedItems=new I();this._oSelectedRanges={};this._createHeaderBar();this._createCollectiveSearch();this._createTokenizer();this._updateTokenizer();this._oVBox=new V({fitContainer:true});this.addContent(this._oVBox);this._oMainLayout=new V({fitContainer:true,items:[this._oFilterBar],layoutData:new sap.m.FlexItemData({growFactor:1,shrinkFactor:0})});this._createNavigationControl();this._updateNavigationControl();this._oVBox.addItem(this._oMainLayout);if(this.getMaxIncludeRanges()==="-1"&&this.getMaxExcludeRanges()!=="0"&&!this.getFilterMode()){this._oVBox.addItem(this._oTokenizerGrid);}this._createFooterControls();this.setVerticalScrolling(false);this.setHorizontalScrolling(false);if(!sap.ui.Device.system.desktop){this._oVBox.attachBrowserEvent("touchmove",function(e){e.setMarked();});}if(!this._isPhone()){this._updateView(sap.ui.comp.valuehelpdialog._ValueHelpViewMode.DESKTOP_LIST_VIEW);}};d.prototype._updateView=function(n){if(this._currentViewMode===n){return;}switch(n){case sap.ui.comp.valuehelpdialog._ValueHelpViewMode.DESKTOP_LIST_VIEW:this._validateRanges(function(){this._oTokenizerGrid.setVisible(this.getSupportMultiselect());this._oMainLayout.removeAllItems();if(this._oTabBar&&this._oTabBar.getSelectedKey()!==sap.ui.comp.valuehelpdialog._ValueHelpViewMode.DESKTOP_LIST_VIEW){this._oTabBar.setSelectedKey(sap.ui.comp.valuehelpdialog._ValueHelpViewMode.DESKTOP_LIST_VIEW);}this._oMainLayout.addItem(this._oFilterBar);this._oMainLayout.addItem(this._oTable);this._updateDlgTitle();}.bind(this),function(){this._oTabBar.setSelectedKey(sap.ui.comp.valuehelpdialog._ValueHelpViewMode.DESKTOP_CONDITIONS_VIEW);this._updateView(sap.ui.comp.valuehelpdialog._ValueHelpViewMode.DESKTOP_CONDITIONS_VIEW);}.bind(this));break;case sap.ui.comp.valuehelpdialog._ValueHelpViewMode.DESKTOP_CONDITIONS_VIEW:if(this.getSupportRanges()){this.bCollectiveSearchActive=this.oSelectionTitle.getVisible()&&this.oSelectionButton.getVisible();this._oMainLayout.removeAllItems();if(this._oTabBar&&this._oTabBar.getSelectedKey()!==sap.ui.comp.valuehelpdialog._ValueHelpViewMode.DESKTOP_CONDITIONS_VIEW){this._oTabBar.setSelectedKey(sap.ui.comp.valuehelpdialog._ValueHelpViewMode.DESKTOP_CONDITIONS_VIEW);}this._oMainLayout.addItem(this._getRanges());this._oButtonOk.setVisible(this.getSupportRangesOnly()||this.getSupportMultiselect());this._oTokenizerGrid.setVisible(this.getSupportMultiselect());if(!(this.getMaxIncludeRanges()==="-1"&&this.getMaxExcludeRanges()!=="0"&&!this.getFilterMode())){this._oTokenizerGrid.setVisible(false);}}break;case sap.ui.comp.valuehelpdialog._ValueHelpViewMode.PHONE_MAIN_VIEW:this.setVerticalScrolling(false);this._oColSearchBox.setVisible(false);this._oMainListMenu.setVisible(true);this._updateNavigationControl();this._oAdvancedSearchLink.setVisible(false);if(this._oFilterBar){this._oFilterBar.setVisible(false);this._oFilterBar.setFilterBarExpanded(false);}this._oTable.setVisible(false);this._oTokenizerGrid.setVisible(this.getSupportMultiselect());if(!(this.getMaxIncludeRanges()==="-1"&&this.getMaxExcludeRanges()!=="0"&&!this.getFilterMode())){this._oTokenizerGrid.setVisible(false);}if(this._oRanges){this._oRanges.setVisible(false);}this._oButtonGo.setVisible(false);this._oButtonClear.setVisible(false);this._oButtonOk.setVisible(true);this._oButtonCancel.setVisible(true);this._oBackButton.setVisible(false);this._bNoneMainView=false;if(!this._oTokenizerGrid.getVisible()&&!(this._oSelectItemLI.getVisible()&&this._oDefineConditionsLI.getVisible())){this._bNoneMainView=true;if(this._oSelectItemLI.getVisible()){this._updateView(sap.ui.comp.valuehelpdialog._ValueHelpViewMode.PHONE_LIST_VIEW);}if(this._oDefineConditionsLI.getVisible()){this._updateView(sap.ui.comp.valuehelpdialog._ValueHelpViewMode.PHONE_CONDITIONS_VIEW);}return;}break;case sap.ui.comp.valuehelpdialog._ValueHelpViewMode.PHONE_LIST_VIEW:this.setVerticalScrolling(true);this._oColSearchBox.setVisible(this.bCollectiveSearchActive);this._oMainListMenu.setVisible(false);if(this._oFilterBar){var s=this._oFilterBar&&this._oFilterBar.getFilterGroupItems()&&this._oFilterBar.getFilterGroupItems().length>0;this._oAdvancedSearchLink.setVisible(s);this._oFilterBar.setShowGoButton(!(this._oFilterBar&&this._oFilterBar.getBasicSearch()));this._oFilterBar.setVisible(true);this._oFilterBar.setFilterBarExpanded(false);}this._oTable.setVisible(true);this._oTokenizerGrid.setVisible(false);if(this._oRanges){this._oRanges.setVisible(false);}this._oButtonGo.setVisible(false);this._oButtonClear.setVisible(false);this._oButtonOk.setVisible(this.getSupportMultiselect());this._oButtonCancel.setVisible(true);this._oBackButton.setVisible(!this._bNoneMainView);break;case sap.ui.comp.valuehelpdialog._ValueHelpViewMode.PHONE_SEARCH_VIEW:this.setVerticalScrolling(true);this._oColSearchBox.setVisible(false);this._oMainListMenu.setVisible(false);if(this._oFilterBar){this._oFilterBar.setVisible(true);this._oFilterBar.setFilterBarExpanded(true);}this._oAdvancedSearchLink.setVisible(false);this._oTable.setVisible(false);this._oTokenizerGrid.setVisible(false);if(this._oRanges){this._oRanges.setVisible(false);}this._oButtonGo.setVisible(true);this._oButtonClear.setVisible(true);this._oButtonOk.setVisible(false);this._oButtonCancel.setVisible(true);this._oBackButton.setVisible(true);break;case sap.ui.comp.valuehelpdialog._ValueHelpViewMode.PHONE_CONDITIONS_VIEW:this.setVerticalScrolling(true);this._oColSearchBox.setVisible(false);this._oMainListMenu.setVisible(false);if(this._oFilterBar){this._oFilterBar.setVisible(false);}this._oAdvancedSearchLink.setVisible(false);this._oTable.setVisible(false);this._oTokenizerGrid.setVisible(false);if(!this._oRanges){this._oMainLayout.addItem(this._getRanges());}this._oRanges.setVisible(true);this._oButtonGo.setVisible(false);this._oButtonClear.setVisible(false);this._oButtonOk.setVisible(true);this._oButtonCancel.setVisible(true);this._oBackButton.setVisible(!this._bNoneMainView);break;default:break;}if(this._oMainListMenu&&this._oVBox){if(this._oFilterBar){this._oFilterBar._handleVisibilityOfToolbar();}this._oVBox.rerender();}this._currentViewMode=n;this._updateDlgTitle();};d.prototype._changeTableRowSelectionForKey=function(k,s){var i;var t=this._oTable;this._bIgnoreSelectionChange=true;if(sap.ui.table.Table&&t instanceof sap.ui.table.Table){var r=t.getBinding("rows");if(r){if(r.aKeys){for(i=0;i<r.aKeys.length;i++){if(decodeURIComponent(r.aKeys[i])===k){if(s){t.addSelectionInterval(i,i);}else{t.removeSelectionInterval(i,i);}break;}}}else{this.oRows=t.getBinding("rows");if(this.oRows.aIndices){for(i=0;i<this.oRows.aIndices.length;i++){var o=t.getContextByIndex(this.oRows.aIndices[i]);if(o){var R=o.getObject();if(R[this.getKey()]===k){if(s){t.addSelectionInterval(i,i);}else{t.removeSelectionInterval(i,i);}break;}}}}}}}else{for(i=0;i<t.getItems().length;i++){var e=t.getItems()[i];var f=e.getBindingContext().getObject();if(f[this.getKey()]===k){t.setSelectedItem(e,s);break;}}}this._bIgnoreSelectionChange=false;};d.prototype.update=function(){var i,j,r,o;var k;var e=this._oSelectedItems.getItems();var f={tokenKeys:e,useDefault:false};this._bIgnoreSelectionChange=true;if(this._hasListeners("updateSelection")){this.fireUpdateSelection(f);}else{f.useDefault=true;}if(f.useDefault){if(sap.ui.table.Table&&this._oTable instanceof sap.ui.table.Table){this.oRows=this._oTable.getBinding("rows");this._oTable.clearSelection();if(this.oRows.aKeys){var K=this.getKeys();var R=K&&K.length>1?this.getKey()+"=":"";for(j=0;j<e.length;j++){k=e[j];var s=R+"'"+k+"'";for(i=0;i<this.oRows.aKeys.length;i++){var g=decodeURIComponent(this.oRows.aKeys[i]);var h=g===k;if(h||g.indexOf(s)>=0){if(!h){this._oSelectedItems.remove(k);var t=this._getTokenByKey(k,this._oSelectedTokens);if(t){t.setKey(g);}}o=this._oTable.getContextByIndex(i);if(o){r=o.getObject();this._oSelectedItems.add(g,r);}this._oTable.addSelectionInterval(i,i);break;}}}}else if(this.oRows.aIndices){this._oTable.clearSelection();for(j=0;j<e.length;j++){var m=e[j];for(i=0;i<this.oRows.aIndices.length;i++){o=this._oTable.getContextByIndex(this.oRows.aIndices[i]);if(o){r=o.getObject();if(r[this.getKey()]===m){this._oSelectedItems.add(r[this.getKey()],r);this._oTable.addSelectionInterval(i,i);break;}}}}}}else{var n=this._oTable;for(j=0;j<e.length;j++){k=e[j];for(i=0;i<n.getItems().length;i++){var p=n.getItems()[i];var u=p.getBindingContext().getObject();if(u[this.getKey()]===k){n.setSelectedItem(p,true);break;}}}}}this._bIgnoreSelectionChange=false;this._updateTitles();};d.prototype._createHeaderBar=function(){this._oTitle=new sap.m.Title();var o=null;if(this._isPhone()){o=new sap.m.Button({visible:false,type:B.Back,press:function(e){if(this._currentViewMode===sap.ui.comp.valuehelpdialog._ValueHelpViewMode.PHONE_SEARCH_VIEW){this._updateView(sap.ui.comp.valuehelpdialog._ValueHelpViewMode.PHONE_LIST_VIEW);}else{this._updateView(sap.ui.comp.valuehelpdialog._ValueHelpViewMode.PHONE_MAIN_VIEW);}}.bind(this)});this._oBackButton=o;}this.setCustomHeader(new sap.m.Bar({contentLeft:o,contentMiddle:this._oTitle}));};d.prototype._createCollectiveSearch=function(){this.oSelectionTitle=new sap.m.Text({visible:false,wrapping:false}).addStyleClass("compVHColSearchText");this.oSelectionButton=new sap.m.Button({icon:"sap-icon://arrow-down",tooltip:this._oRb.getText("VALUEHELPVALDLG_SEARCHTEMPLATES_TOOLTIP"),type:sap.m.ButtonType.Transparent,visible:false,ariaLabelledBy:this.oSelectionTitle}).addStyleClass("compVHColSearchBtn");this._oColSearchBox=new H({fitContainer:true,visible:this.oSelectionButton.getVisible(),items:[this.oSelectionTitle,this.oSelectionButton]});};d.prototype._createFooterControls=function(){this._oButtonOk=new sap.m.Button({text:this._oRb.getText("VALUEHELPDLG_OK"),press:this._onCloseAndTakeOverValues.bind(this),visible:this.getSupportMultiselect(),layoutData:new sap.m.OverflowToolbarLayoutData({priority:sap.m.OverflowToolbarPriority.NeverOverflow})});this._oButtonCancel=new sap.m.Button({text:this._oRb.getText("VALUEHELPDLG_CANCEL"),press:this._onCancel.bind(this),layoutData:new sap.m.OverflowToolbarLayoutData({priority:sap.m.OverflowToolbarPriority.NeverOverflow})});if(this._isPhone()){this._oButtonGo=new sap.m.Button({text:this._oRb.getText("VALUEHELPDLG_GO"),type:sap.m.ButtonType.Emphasized,press:this._onGo.bind(this),visible:false,layoutData:new sap.m.OverflowToolbarLayoutData({priority:sap.m.OverflowToolbarPriority.NeverOverflow})});this._oButtonClear=new sap.m.Button({text:this._oRb.getText("VALUEHELPDLG_CLEAR"),press:this._onClear.bind(this),visible:false,layoutData:new sap.m.OverflowToolbarLayoutData({priority:sap.m.OverflowToolbarPriority.NeverOverflow})});this.addButton(this._oButtonGo);this.addButton(this._oButtonClear);}this.addButton(this._oButtonOk);this.addButton(this._oButtonCancel);};d.prototype._createTokenizer=function(){if(this._oTokenizerGrid){return this._oTokenizerGrid;}this._oSelectedTokenTitle=new sap.ui.core.InvisibleText();this._oSelectedTokens=new sap.m.Tokenizer({tokenUpdate:function(e){if(this._ignoreRemoveToken){return;}if(e.getParameter("type")===sap.m.Tokenizer.TokenChangeType.Removed){var r=e.getParameter("removedTokens");var t=[];var R=[];for(var j=0;j<r.length;j++){var f=r[j];var k=f.getKey();if(this._oSelectedRanges&&this._oSelectedRanges[k]){R.push(k);}else{t.push(k);this._oSelectedItems.remove(k);this._removeTokenFromTokenizer(k,this._oSelectedTokens);}}this._removeRangeByKey(R,false);this._updateTitles();var g={tokenKeys:t,useDefault:false};if(this._hasListeners("tokenRemove")){this._bIgnoreSelectionChange=true;this.fireTokenRemove(g);this._bIgnoreSelectionChange=false;}else{g.useDefault=true;}if(g.useDefault){t.forEach(function(s){this._changeTableRowSelectionForKey(s,false);}.bind(this));}if(r.length===1){setTimeout(function(){if(this._oSelectedTokens.getTokens()){var i=this._oSelectedTokens.getTokens().length-1;if(i>=0){this._oSelectedTokens.getTokens()[i].focus();}}}.bind(this));}this._updateTitles();}}.bind(this),ariaLabelledBy:this._oSelectedTokenTitle}).addStyleClass("compVHTokensDiv");this._oRemoveAllSelectedItemsBtn=new sap.m.Button({type:sap.m.ButtonType.Transparent,icon:sap.ui.core.IconPool.getIconURI("sys-cancel"),tooltip:this._oRb.getText("VALUEHELPVALDLG_REMOVETOKENS_TOOLTIP"),press:function(){this._oSelectedTokens.destroyTokens();this._removeRangeByKey(Object.keys(this._oSelectedRanges),false);this._oSelectedItems.removeAll();this._bIgnoreSelectionChange=true;if(this._oTable&&this._oTable.clearSelection){this._oTable.clearSelection();}if(this._oTable&&this._oTable.removeSelections){this._oTable.removeSelections();}this._bIgnoreSelectionChange=false;this._updateTitles();}.bind(this),ariaLabelledBy:this._oSelectedTokenTitle}).addStyleClass("compVHRemoveAllBtn");var h=new sap.ui.layout.HorizontalLayout({content:[this._oSelectedTokens,this._oRemoveAllSelectedItemsBtn]}).addStyleClass("compVHTokenizerHLayout");this._oIncludeTokenGrid=new sap.ui.layout.Grid({width:"100%",defaultSpan:"L12 M12 S12",hSpacing:0,vSpacing:0,content:[this._oSelectedTokenTitle,h]});this._oExcludedTokenTitle=new sap.m.Text().addStyleClass("compVHSelectedItemsText");this._oExcludedTokens=new sap.m.Tokenizer({tokenChange:function(e){if(this._ignoreRemoveToken){return;}if(e.getParameter("type")===sap.m.Tokenizer.TokenChangeType.Removed||e.getParameter("type")===sap.m.Tokenizer.TokenChangeType.RemovedAll){var r=e.getParameter("removedTokens");var t=[];if(!r||r.length==0){r=[e.getParameter("token")];}if(!r||r.length==0){r=[e.getParameter("tokens")];}for(var j=0;j<r.length;j++){var f=r[j];var k=f.getKey();if(this._oSelectedRanges&&this._oSelectedRanges[k]){t.push(k);}}this._removeRangeByKey(t,true);this._updateTitles();}}.bind(this),ariaLabelledBy:this._oExcludedTokenTitle}).addStyleClass("compVHTokensDiv");this._oRemoveAllExcludeItemsBtn=new sap.m.Button({type:sap.m.ButtonType.Transparent,icon:sap.ui.core.IconPool.getIconURI("sys-cancel"),tooltip:this._oRb.getText("VALUEHELPVALDLG_REMOVETOKENS_TOOLTIP"),press:function(){this._oExcludedTokens.destroyTokens();this._removeRangeByKey(Object.keys(this._oSelectedRanges),true);this._updateTitles();}.bind(this),ariaLabelledBy:this._oExcludedTokenTitle}).addStyleClass("compVHRemoveAllBtn");var o=new sap.ui.layout.HorizontalLayout({content:[this._oExcludedTokens,this._oRemoveAllExcludeItemsBtn]}).addStyleClass("compVHTokenizerHLayout");this._oExcludeTokenGrid=new sap.ui.layout.Grid({width:"100%",defaultSpan:"L12 M12 S12",hSpacing:0,vSpacing:0,content:[this._oExcludedTokenTitle,o]});this._oTokenizerPanel=new sap.m.Panel({expanded:sap.ui.Device.system.desktop,expandable:true,expandAnimation:true,headerText:"",width:"auto",content:[this._oIncludeTokenGrid,this._oExcludeTokenGrid],expand:function(e){this._updateTokenizer();if(e.mParameters.expand&&!(this._oTable instanceof sap.m.Table)){var s=q.sap.domById(this.getId()+"-scrollCont");if(s&&s.scrollTop){s.stop().animate({scrollTop:"1000"},1000);}}}.bind(this)}).addStyleClass("compVHBackgroundTransparent").addStyleClass("compVHTokensPanel").addStyleClass("compValueHelpDialogTokens");if(this._isPhone()){this._oSelectedTokens.addStyleClass("sapMTokenizerMultiLine");this._oExcludedTokens.addStyleClass("sapMTokenizerMultiLine");}this._oTokenizerGrid=new sap.ui.layout.Grid({width:"100%",defaultSpan:"L12 M12 S12",hSpacing:0,vSpacing:0,content:this._oTokenizerPanel}).addStyleClass("compVHDarkBackground");return this._oTokenizerGrid;};d.prototype._addToken2Tokenizer=function(k,t,o){var e=this._getTokenByKey(k,o);var s=(typeof t==="string")?t:"";if(e){e.setText(t);e.setTooltip(s);}else{o.addToken(new T({key:k,text:t,tooltip:s}));this._updateTokenizer();}};d.prototype._getTokenByKey=function(k,t){var e=t.getTokens();for(var i=0;i<e.length;i++){var f=e[i];if(f.getKey()===k){return f;}}return null;};d.prototype._removeToken=function(k){if(!this._removeTokenFromTokenizer(k,this._oSelectedTokens)){this._removeTokenFromTokenizer(k,this._oExcludedTokens);}};d.prototype._removeTokenFromTokenizer=function(k,t){var e=this._getTokenByKey(k,t);if(e){this._ignoreRemoveToken=true;t.removeToken(e);this._ignoreRemoveToken=false;this._updateTokenizer();return true;}return false;};d.prototype._updateTokenizer=function(){var e=false;if(this._oTokenizerPanel){e=this._oTokenizerPanel.getExpanded();}var n=this._oSelectedTokens.getTokens().length;var f=this._oExcludedTokens.getTokens().length;var s=this._oRb.getText("VALUEHELPDLG_SELECTEDITEMS");var g=this._oRb.getText("VALUEHELPDLG_NONESELECTEDITEMS");var S=s.replace("{0}",n.toString());var E=this._oRb.getText("VALUEHELPDLG_EXCLUDEDITEMS",f.toString());var t=n===0?g:S;if(this._oTokenizerPanel){if(!e){if(this._isPhone()){S=this._oRb.getText("VALUEHELPDLG_SELECTEDITEMS_SHORT",n.toString());E=this._oRb.getText("VALUEHELPDLG_EXCLUDEDITEMS_SHORT",f.toString());}t="";if(n!==0){t=S;}if(f!==0){t+=(n!==0?" / ":"")+E;}if(t===""){t=g;}}else if(n===0&&f!==0){t=E;E="";}this._oTokenizerPanel.setHeaderText(t);this._oSelectedTokenTitle.setText(t);}else{this._oSelectedTokenTitle.setText(t);}this._oRemoveAllSelectedItemsBtn.setEnabled(n!==0);this._oExcludedTokenTitle.setText(E);if(n===0&&f!==0){this._oIncludeTokenGrid.addStyleClass("displayNone");if(!this._isPhone()){this._oExcludedTokenTitle.addStyleClass("displayNone");}}else{this._oIncludeTokenGrid.removeStyleClass("displayNone");this._oExcludedTokenTitle.removeStyleClass("displayNone");}if(f===0){this._oExcludeTokenGrid.addStyleClass("displayNone");}else{this._oExcludeTokenGrid.removeStyleClass("displayNone");}};d.prototype._createNavigationControl=function(){if(!this._isPhone()){this._oTabBar=new sap.m.IconTabBar({upperCase:true,expandable:false,items:[new sap.m.IconTabFilter({visible:true,text:this._oRb.getText("VALUEHELPDLG_ITEMSTABLE"),key:sap.ui.comp.valuehelpdialog._ValueHelpViewMode.DESKTOP_LIST_VIEW}),new sap.m.IconTabFilter({visible:true,text:this._oRb.getText("VALUEHELPDLG_RANGES"),key:sap.ui.comp.valuehelpdialog._ValueHelpViewMode.DESKTOP_CONDITIONS_VIEW})],select:function(o){this._updateView(o.getParameters().key);}.bind(this)});this._oTabBar.setLayoutData(new sap.m.FlexItemData({shrinkFactor:0}));this._oVBox.addItem(this._oTabBar);}else{this._oSelectItemLI=new sap.m.StandardListItem({type:sap.m.ListType.Navigation,title:this._oRb.getText("VALUEHELPDLG_ITEMSTABLE")}).data("key",sap.ui.comp.valuehelpdialog._ValueHelpViewMode.PHONE_LIST_VIEW);this._oDefineConditionsLI=new sap.m.StandardListItem({type:sap.m.ListType.Navigation,title:this._oRb.getText("VALUEHELPDLG_RANGES")}).data("key",sap.ui.comp.valuehelpdialog._ValueHelpViewMode.PHONE_CONDITIONS_VIEW);this._oMainListMenu=new sap.m.List({mode:sap.m.ListMode.None,items:[this._oSelectItemLI,this._oDefineConditionsLI],itemPress:function(e){if(e){this._updateView(e.mParameters.listItem.data("key"));}}.bind(this)});this._oMainListMenu.setLayoutData(new sap.m.FlexItemData({shrinkFactor:0}));this._oVBox.addItem(this._oMainListMenu);this._oAdvancedSearchLink=new sap.m.Link({text:this._oRb.getText("VALUEHELPDLG_ADVANCEDSEARCH"),press:function(){this._updateView(sap.ui.comp.valuehelpdialog._ValueHelpViewMode.PHONE_SEARCH_VIEW);}.bind(this)}).addStyleClass("compVHAdvancedSearchLink");this._oAdvancedSearchLink.setLayoutData(new sap.m.FlexItemData({shrinkFactor:0}));this._oVBox.addItem(this._oAdvancedSearchLink);}};d.prototype._updateNavigationControl=function(){var L=!this.getSupportRangesOnly();var r=this.getSupportRangesOnly()||this.getSupportRanges();if(this._oTabBar){var t=this._oTabBar.getItems();t[0].setVisible(L);t[1].setVisible(r);this._oTabBar.setVisible(L&&r);this._updateDlgTitle();}if(this._oMainListMenu){this._oSelectItemLI.setVisible(L);this._oDefineConditionsLI.setVisible(r);}};d.prototype._removeRangeByKey=function(k,i){var K=k;if(typeof K==="string"){K=[K];}K.forEach(function(k,e,K){var r=this._oSelectedRanges[k];if(r.exclude===i){if(!r._oGrid){delete this._oSelectedRanges[k];if(this._oFilterPanel){var o=r.exclude?this._oFilterPanel._oExcludeFilterPanel:this._oFilterPanel._oIncludeFilterPanel;if(K.length==1){o.removeCondition(k);}else{o._removeConditionFromMap(k);}}}}},this);if(K.length>1&&this._oFilterPanel){var o=i?this._oFilterPanel._oExcludeFilterPanel:this._oFilterPanel._oIncludeFilterPanel;o._clearConditions();o._fillConditions();}};d.prototype._getRanges=function(){if(!this._oRanges){this._oRanges=this._createRanges();}return this._oRanges;};d.prototype._createRanges=function(){q.sap.require("sap.m.P13nConditionPanel");q.sap.require("sap.m.P13nFilterPanel");this._oFilterPanel=new sap.m.P13nFilterPanel({maxIncludes:this.getMaxIncludeRanges(),maxExcludes:this.getMaxExcludeRanges(),containerQuery:true,addFilterItem:function(E){var p=E.mParameters;var o={exclude:p.filterItemData.getExclude(),keyField:p.filterItemData.getColumnKey(),operation:p.filterItemData.getOperation(),value1:p.filterItemData.getValue1(),value2:p.filterItemData.getValue2()};this._oSelectedRanges[p.key]=o;var f=this._getKeyFieldByKey(o.keyField);o.value1=this._convertValue2Object(o.value1,f.type);o.value2=this._convertValue2Object(o.value2,f.type);this._oFilterPanel.addFilterItem(p.filterItemData);var s=this._getFormatedRangeTokenText(o.operation,o.value1,o.value2,o.exclude,o.keyField);this._addToken2Tokenizer(p.key,s,o.exclude?this._oExcludedTokens:this._oSelectedTokens);this._updateTokenizer();}.bind(this),removeFilterItem:function(E){var p=E.mParameters;delete this._oSelectedRanges[p.key];this._removeToken(p.key);this._updateTokenizer();}.bind(this),updateFilterItem:function(E){var p=E.mParameters;var o=this._oSelectedRanges[p.key];o.exclude=p.filterItemData.getExclude();o.keyField=p.filterItemData.getColumnKey();o.operation=p.filterItemData.getOperation();o.value1=p.filterItemData.getValue1();o.value2=p.filterItemData.getValue2();var f=this._getKeyFieldByKey(o.keyField);o.value1=this._convertValue2Object(o.value1,f.type);o.value2=this._convertValue2Object(o.value2,f.type);var s=this._getFormatedRangeTokenText(o.operation,o.value1,o.value2,o.exclude,o.keyField);this._addToken2Tokenizer(p.key,s,o.exclude?this._oExcludedTokens:this._oSelectedTokens);this._updateTokenizer();}.bind(this)});this._oFilterPanel._oIncludeFilterPanel.setDisplayFormat(this.getDisplayFormat());this._oFilterPanel._oExcludeFilterPanel.setDisplayFormat(this.getDisplayFormat());this._oFilterPanel._oIncludeFilterPanel._fSuggestCallback=this._fSuggestCallback;this._oFilterPanel._oExcludeFilterPanel._fSuggestCallback=this._fSuggestCallback;this._oFilterPanel._oIncludeFilterPanel._sAddRemoveIconTooltipKey="CONDITION";this._oFilterPanel._oExcludeFilterPanel._sAddRemoveIconTooltipKey="CONDITION";var t;if(this._aIncludeRangeOperations){for(t in this._aIncludeRangeOperations){this._oFilterPanel.setIncludeOperations(this._aIncludeRangeOperations[t],t);}}if(this._aExcludeRangeOperations){for(t in this._aExcludeRangeOperations){this._oFilterPanel.setExcludeOperations(this._aExcludeRangeOperations[t],t);}}if(this._aRangeKeyFields){this._aRangeKeyFields.forEach(function(i){this._oFilterPanel.addItem(new sap.m.P13nItem({columnKey:i.key,text:i.label,type:i.type,maxLength:i.maxLength,scale:i.scale,precision:i.precision,isDefault:i.isDefault,values:i.type==="boolean"?this._getBooleanValues():null}));},this);}if(this._oSelectedRanges){for(var r in this._oSelectedRanges){var e=this._oSelectedRanges[r];this._oFilterPanel.addFilterItem(new sap.m.P13nFilterItem({key:r,exclude:e.exclude,columnKey:e.keyField,operation:e.operation,value1:e.value1,value2:e.value2}));}}var R=new sap.ui.layout.Grid({width:"100%",defaultSpan:"L12 M12 S12",vSpacing:0,hSpacing:0,content:[this._oFilterPanel]});this._sValidationDialogTitle=this._oRb.getText("VALUEHELPVALDLG_TITLE");this._sValidationDialogMessage=this._oRb.getText("VALUEHELPVALDLG_MESSAGE");this._sValidationDialogFieldMessage=this._oRb.getText("VALUEHELPVALDLG_FIELDMESSAGE");return R;};d.prototype.suggest=function(s){this._fSuggestCallback=s;if(this._oFilterPanel){if(this._oFilterPanel._oIncludeFilterPanel){this._oFilterPanel._oIncludeFilterPanel._fSuggestCallback=this._fSuggestCallback;}if(this._oFilterPanel._oExcludeFilterPanel){this._oFilterPanel._oExcludeFilterPanel._fSuggestCallback=this._fSuggestCallback;}}};d.prototype._getBooleanValues=function(){q.sap.require("sap.ui.model.odata.type.Boolean");var o=new sap.ui.model.odata.type.Boolean();var e=null;if(o){e=["",o.formatValue(false,"string"),o.formatValue(true,"string")];}return e;};d.prototype._convertValue2Object=function(v,t){if(!v){return v;}var e=v;if(t==="date"){e=new Date(v);}if(t==="time"){e=new Date(v);}if(t==="numeric"){e=parseFloat(v);}if(t==="boolean"){if(v===""){e=null;}else{e=v=='true';}}return e;};d.prototype._getKeyFieldByKey=function(k){var o;if(this._aRangeKeyFields){this._aRangeKeyFields.some(function(e){if(typeof e!=="string"){if(e.key===k){o=e;return true;}}return false;});}return o;};d.prototype._validateRanges=function(f,e){if(this._oRanges){if(!this._oRanges.getParent()){f();return;}var i=this._oFilterPanel.validateConditions();if(!i){M.show(this._sValidationDialogMessage,{icon:M.Icon.WARNING,title:this._sValidationDialogTitle,actions:[M.Action.OK,M.Action.CANCEL],styleClass:this.$().closest(".sapUiSizeCompact").length?"sapUiSizeCompact":"",onClose:function(r){if(r===M.Action.OK&&f){f();}if(r===M.Action.CANCEL&&e){e();}}});return;}}f();};d.prototype.setUpdateSingleRowCallback=function(s){this.fSingleRowCallback=s;this._updateNavigationControl();};d.prototype._createDefaultTable=function(){if(!this._isPhone()){sap.ui.getCore().loadLibrary("sap.ui.table");q.sap.require("sap.ui.table.Table");this.setTable(new sap.ui.table.Table(),true);}else{this.setTable(new sap.m.Table(),true);this.TableStateSearchData();}};d.prototype._initializeTable=function(){if(sap.ui.table.Table&&this._oTable instanceof sap.ui.table.Table){this._oTable.setTitle(sap.ui.Device.system.desktop?this._sTableTitleNoCount:null);if(this._bTableCreatedInternal){this._oTable.setSelectionBehavior(sap.ui.table.SelectionBehavior.Row);}this._oTable.setSelectionMode(this.getSupportMultiselect()?sap.ui.table.SelectionMode.MultiToggle:sap.ui.table.SelectionMode.Single);this._updateNoDataText(this._oRb.getText("VALUEHELPDLG_TABLE_PRESSSEARCH"));this._oTable.setVisibleRowCountMode(sap.ui.table.VisibleRowCountMode.Fixed);this._oTable.setMinAutoRowCount(sap.ui.Device.system.desktop?5:4);this._oTable.attachRowSelectionChange(function(o){if(this._bIgnoreSelectionChange||!o.getParameter("userInteraction")){return;}var e={tableSelectionParams:o.mParameters,updateTokens:[],useDefault:false};if(this._hasListeners("selectionChange")){this._bIgnoreSelectionChange=true;this.fireSelectionChange(e);this._bIgnoreSelectionChange=false;e.updateTokens.forEach(function(j){this._addRemoveTokenByKey(j.sKey,j.oRow,j.bSelected);}.bind(this));}else{e.useDefault=true;}if(e.useDefault){var t=o.getSource();var f=o.getParameter("rowIndices");var i,n=f.length;var g;var h;var r;for(i=0;i<n;i++){g=f[i];h=t.getContextByIndex(g);r=h?h.getObject():null;if(!r){M.show(this._oRb.getText("VALUEHELPDLG_SELECTIONFAILED"),{icon:M.Icon.ERROR,title:this._oRb.getText("VALUEHELPDLG_SELECTIONFAILEDTITLE"),actions:[M.Action.OK],styleClass:this.$().closest(".sapUiSizeCompact").length?"sapUiSizeCompact":""});return;}}var u=false;if(t.getBinding("rows").aKeys){u=true;}for(i=0;i<n;i++){g=f[i];h=t.getContextByIndex(g);r=h?h.getObject():null;if(r){var k;if(u){k=h.sPath.substring(1);}else{k=r[this.getKey()];}this._addRemoveTokenByKey(k,r,t.isIndexSelected(g));}}}this._updateTitles();if(!this.getSupportMultiselect()){this._bIgnoreSelectionChange=true;this._onCloseAndTakeOverValues();}}.bind(this));this._oTable.addStyleClass("compVHMainTable");if(!(this._oTable.getParent()instanceof sap.ui.comp.smarttable.SmartTable)){this._oTable.bindAggregation("columns","columns>/cols",function(i,o){var e,t;if(o.getProperty("type")==="string"){t={path:o.getProperty("template")};}if(o.getProperty("type")==="boolean"){e=new sap.m.CheckBox({enabled:false,selected:{path:o.getProperty("template")}});}else{e=new sap.m.Text({wrapping:false,text:{path:o.getProperty("template"),type:o.getProperty("oType")},tooltip:t});}if(this._oTable instanceof sap.ui.table.AnalyticalTable){return new sap.ui.table.AnalyticalColumn(i,{label:"{columns>label}",tooltip:"{columns>tooltip}",template:e,width:"{columns>width}",hAlign:e instanceof sap.m.CheckBox?sap.ui.core.HorizontalAlign.Center:sap.ui.core.HorizontalAlign.Begin,filterProperty:o.getProperty("filter")});}else{return new sap.ui.table.Column(i,{label:"{columns>label}",tooltip:"{columns>tooltip}",template:e,width:"{columns>width}",hAlign:e instanceof sap.m.CheckBox?sap.ui.core.HorizontalAlign.Center:sap.ui.core.HorizontalAlign.Begin,sortProperty:o.getProperty("sort"),sorted:o.getProperty("sorted"),sortOrder:o.getProperty("sortOrder"),filterProperty:o.getProperty("filter")});}}.bind(this));}}else{this._oTable.setMode(this.getSupportMultiselect()?sap.m.ListMode.MultiSelect:sap.m.ListMode.SingleSelectLeft);this._oTable.setGrowing(true);this._oTable.attachSelectionChange(function(o){if(this._bIgnoreSelectionChange){return;}var e=o.mParameters;var f={tableSelectionParams:o.mParameters,updateTokens:[],useDefault:false};if(this._hasListeners("selectionChange")){this._bIgnoreSelectionChange=true;this.fireSelectionChange(f);this._bIgnoreSelectionChange=false;f.updateTokens.forEach(function(j){this._addRemoveTokenByKey(j.sKey,j.oRow,j.bSelected);}.bind(this));}else{f.useDefault=true;}if(f.useDefault){var s=e.selected;var i,n=e.listItems.length;for(i=0;i<n;i++){var g=e.listItems[i];var h=g.getBindingContext();var r=h?h.getObject():null;if(r){var k=r[this.getKey()];this._addRemoveTokenByKey(k,r,s);}}}if(!this.getSupportMultiselect()){this._onCloseAndTakeOverValues();}}.bind(this));if(!(this._oTable.getParent()instanceof sap.ui.comp.smarttable.SmartTable)){this._oTable.bindAggregation("columns","columns>/cols",function(i,o){var e=o.getProperty("label");var f=this._oTable.getColumns().length>=2;return new sap.m.Column({header:new sap.m.Label({text:e}),demandPopin:f,minScreenWidth:f?(this._oTable.getColumns().length+1)*10+"rem":"1px"});}.bind(this));}}};d.prototype._addRemoveTokenByKey=function(k,r,A){k=decodeURIComponent(k);if(A){this._oSelectedItems.add(k,r);this._addToken2Tokenizer(k,this._getFormatedTokenText(k),this._oSelectedTokens);}else{this._oSelectedItems.remove(k);this._removeTokenFromTokenizer(k,this._oSelectedTokens);}};d.prototype._onCloseAndTakeOverValues=function(){var t=this;var f=function(){var r;var e=t._oSelectedItems.getSelectedItemsTokenArray(t.getKey(),t.getDescriptionKey(),t.getTokenDisplayBehaviour());if(t._oSelectedRanges){var i=0;for(var g in t._oSelectedRanges){r=t._oSelectedRanges[g];var s=r.tokenValue;if(!s){s=t._getFormatedRangeTokenText(r.operation,r.value1,r.value2,r.exclude,r.keyField);}if(!r._oGrid||r._oGrid.select.getSelected()){e.push(new T({key:"range_"+i,text:s,tooltip:typeof s==="string"?s:null}).data("range",{"exclude":r.exclude,"operation":r.operation,"keyField":r.keyField,"value1":r.value1,"value2":r.value2}));i++;}}}t.fireOk({"tokens":e});};this._validateRanges(f);};d.prototype._onCancel=function(){this.fireCancel();};d.prototype._onGo=function(){this._oFilterBar.search();};d.prototype._onClear=function(){this._oFilterBar.clear();};d.prototype._updateTitles=function(){this._updateTableTitle();this._updateTokenizer();};d.prototype._updateDlgTitle=function(){var m="";var s;if(this._oTitle){if(this._oTabBar&&!this._oTabBar.getVisible()&&!this.getFilterMode()){if(this._oTabBar.getSelectedKey()===sap.ui.comp.valuehelpdialog._ValueHelpViewMode.DESKTOP_LIST_VIEW){m="VALUEHELPDLG_TITLE";}else if(this._oTabBar.getSelectedKey()===sap.ui.comp.valuehelpdialog._ValueHelpViewMode.DESKTOP_CONDITIONS_VIEW){if(this.getMaxIncludeRanges()==="1"&&this.getMaxExcludeRanges()==="0"){m="VALUEHELPDLG_SINGLECONDITION_TITLE";}else{m="VALUEHELPDLG_RANGESTITLE";}}}else if(this._isPhone()&&!this.getFilterMode()){switch(this._currentViewMode){case sap.ui.comp.valuehelpdialog._ValueHelpViewMode.PHONE_MAIN_VIEW:m="";break;case sap.ui.comp.valuehelpdialog._ValueHelpViewMode.PHONE_LIST_VIEW:m="VALUEHELPDLG_ITEMSTABLE";break;case sap.ui.comp.valuehelpdialog._ValueHelpViewMode.PHONE_SEARCH_VIEW:m="VALUEHELPDLG_ADVANCEDSEARCH";break;case sap.ui.comp.valuehelpdialog._ValueHelpViewMode.PHONE_CONDITIONS_VIEW:if(this.getMaxIncludeRanges()==="1"&&this.getMaxExcludeRanges()==="0"){m="VALUEHELPDLG_SINGLECONDITION_TITLE";}else{m="VALUEHELPDLG_RANGES";}break;default:break;}}if(!s){s=this.getTitle();}if(m){s=this._oRb.getText(m,s);}if(s){this._oTitle.setText(s);}}};d.prototype._updateTableTitle=function(){if(!this._oTable){return;}var e=0;this.oRows=this._oTable.getBinding("rows");var s=false;if(s&&this.getModel()&&this.getModel().isCountSupported){s=this.getModel().isCountSupported();}if(s){if(this.oRows){e=this.oRows.getLength();}this._setTableTitle(this._sTableTitle1.replace("{0}",e));}else{this._setTableTitle(this._sTableTitleNoCount);}};d.prototype._setTableTitle=function(t){if(sap.ui.Device.system.desktop&&!(this._oTable instanceof sap.m.Table)){if(this._oTable.getTitle()){this._oTable.getTitle().setText(t);}else{this._oTable.setTitle(t);}}};d.prototype.onAfterRendering=function(){D.prototype.onAfterRendering.apply(this);if(this._oTable){this._updateTitles();}if(!this._isPhone()&&this.getContentHeight()===""){if(this.getSupportRangesOnly()&&(this.getMaxExcludeRanges()==="-1"||this.getMaxIncludeRanges()==="-1")){this.setContentHeight("70%");}else{var r=this.getDomRef("scroll");var _=r.clientHeight;this.setContentHeight(_+"px");}if(sap.ui.table.Table&&this._oTable&&this._oTable instanceof sap.ui.table.Table){this._oTable.setVisibleRowCountMode(sap.ui.table.VisibleRowCountMode.Auto);}}};d.prototype._getDialogOffset=function(w){var W=w||this._$Window.width();var s={small:600,large:1024};var r=function(e){var R=parseInt(window.getComputedStyle(document.body).fontSize,10);return(e*R)*2;};var e=1;if(W>s.small&&W<s.large){e=2;}else if(W>=s.large){e=2;}return{top:r(e),left:r(e)};};d.prototype.exit=function(){var e=function(o){if(o&&o.destroy){o.destroy();}return null;};this._oTokenizerGrid=e(this._oTokenizerGrid);this._oRanges=e(this._oRanges);this._oFilterPanel=e(this._oFilterPanel);if(this._bTableCreatedInternal){this._oTable=e(this._oTable);}this._oTable=null;this.theTable=null;this._oTabBar=e(this._oTabBar);this._oMainListMenu=e(this._oMainListMenu);this._oVBox=e(this._oVBox);this._oVarManagment=e(this._oVarManagment);this._aRangeKeyFields=e(this._aRangeKeyFields);this._aIncludeRangeOperations=e(this._aIncludeRangeOperations);this._aExcludeRangeOperations=e(this._aExcludeRangeOperations);if(this._oFilterBar){this._oFilterBar.detachInitialise(this._handleFilterBarInitialize);this._oFilterBar=e(this._oFilterBar);}this._oRb=e(this._oRb);this._sTableTitle1=e(this._sTableTitle1);this._sTableTitle2=e(this._sTableTitle2);this._sTableTitleNoCount=e(this._sTableTitleNoCount);this._sValidationDialogTitle=e(this._sValidationDialogTitle);this._sValidationDialogMessage=e(this._sValidationDialogMessage);this._sValidationDialogFieldMessage=e(this._sValidationDialogFieldMessage);this._oSelectedItems=e(this._oSelectedItems);this._oSelectedRanges=e(this._oSelectedRanges);this._oButtonOk=e(this._oButtonOk);this._oButtonCancel=e(this._oButtonCancel);if(this._oButtonGo){this._oButtonGo=e(this._oButtonGo);}if(this._oButtonClear){this._oButtonClear=e(this._oButtonClear);}if(this._oColSearchBox){this._oColSearchBox=e(this._oColSearchBox);}};d.prototype.setRangeKeyFields=function(r){this._aRangeKeyFields=r;};d.prototype.getRangeKeyFields=function(){return this._aRangeKeyFields;};d.prototype.setIncludeRangeOperations=function(o,t){t=t||"default";this._aIncludeRangeOperations[t]=o;if(this._oFilterPanel){this._oFilterPanel.setIncludeOperations(this._aIncludeRangeOperations[t],t);}};d.prototype.setExcludeRangeOperations=function(o,t){t=t||"default";this._aExcludeRangeOperations[t]=o;if(this._oFilterPanel){this._oFilterPanel.setExcludeOperations(this._aExcludeRangeOperations[t],t);}};d.prototype._getFormatedTokenText=function(k){var i=this._oSelectedItems.getItem(k);var t=i[this.getDescriptionKey()];var s=i[this.getKey()];if(t===undefined){if(typeof i==="string"){t=i;}else{t=k;}}else{t=F.getFormattedExpressionFromDisplayBehaviour(this.getTokenDisplayBehaviour()?this.getTokenDisplayBehaviour():sap.ui.comp.smartfilterbar.DisplayBehaviour.descriptionAndId,s,t);}return t;};d.prototype._getFormatedRangeTokenText=function(o,v,s,e,k){var t="";var f;var g=this._getKeyFieldByKey(k);if(g){switch(g.type){case"numeric":var h;if(g.precision||g.scale){h={};if(g.precision){h["maxIntegerDigits"]=parseInt(g.precision,10);}if(g.scale){h["maxFractionDigits"]=parseInt(g.scale,10);}}f=N.getFloatInstance(h);break;case"date":f=b.getDateInstance();v=new Date(v);s=new Date(s);break;case"time":f=b.getTimeInstance();v=new Date(v);s=new Date(s);break;case"boolean":var i=this._getBooleanValues();v=i[v?2:1];s=i[s?2:1];break;default:break;}if(f){if(v){v=f.format(v);}if(s){s=f.format(s);}}}if(v!==""){switch(o){case sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.Initial:t="=''";break;case sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.EQ:t="="+v;break;case sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.GT:t=">"+v;break;case sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.GE:t=">="+v;break;case sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.LT:t="<"+v;break;case sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.LE:t="<="+v;break;case sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.Contains:t="*"+v+"*";break;case sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.StartsWith:t=v+"*";break;case sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.EndsWith:t="*"+v;break;case sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.BT:if(s!==""){t=v+"..."+s;break;}break;default:break;}}if(e&&t!==""){t="!("+t+")";}if(this._aRangeKeyFields&&this._aRangeKeyFields.length>1&&g&&g.label&&t!==""){t=g.label+": "+t;}return t;};d.prototype._isPhone=function(){return sap.ui.Device.system.phone;};d.prototype._hasListeners=function(e){if(this._bTableCreatedInternal){return false;}return this.hasListeners(e);};d.prototype._rotateSelectionButtonIcon=function(f){if(!sap.ui.Device.system.phone){var o=sap.ui.getCore().byId(this.oSelectionButton.$("img")[0].id);if(f){o.addStyleClass("sapUiVHImageExpand");}else{o.removeStyleClass("sapUiVHImageExpand");}}};sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation={BT:"BT",EQ:"EQ",Contains:"Contains",StartsWith:"StartsWith",EndsWith:"EndsWith",LT:"LT",LE:"LE",GT:"GT",GE:"GE",Initial:"Initial"};sap.ui.comp.valuehelpdialog._ValueHelpViewMode={DESKTOP_LIST_VIEW:"DESKTOP_LIST_VIEW",DESKTOP_CONDITIONS_VIEW:"DESKTOP_CONDITIONS_VIEW",PHONE_MAIN_VIEW:"PHONE_MAIN_VIEW",PHONE_SEARCH_VIEW:"PHONE_SEARCH_VIEW",PHONE_LIST_VIEW:"PHONE_LIST_VIEW",PHONE_CONDITIONS_VIEW:"PHONE_CONDITIONS_VIEW"};return d;},true);
