
VBI.Utilities.SceneBindDesignSpotBoxSize=function(o){"use strict";var s=this.m_Scene;if(o.m_Design&&(o.m_Hit==VBI.HTBOXHANDLE)&&this.m_Scale.IsChangeable(s.m_Ctx)){if(o.m_Handle>6){return;}var z=s.GetStretchFactor4Mode();var n=o.m_ClientX/z[0];var a=o.m_ClientY/z[0];var b=o.m_DhOrig[0];var m=(b[0]+b[2])/2.0;var w=(b[2]-b[0])/2.0;var h=(b[3]-b[1]);var f=1.0,c=1.0;switch(o.m_Handle){case 1:c=Math.abs(a-b[3])/h;break;case 2:case 5:if(o.m_Handle==2){c=Math.abs(a-b[3])/h;}f=Math.abs(n-m)/w;break;case 0:case 3:if(o.m_Handle==0){c=Math.abs(a-b[3])/h;}f=Math.abs(n-m)/w;break;default:break;}var d=o.m_ScaleOrig.slice(0);d[0]*=f;d[1]*=c;this.m_Scale.SetValueVector(s.m_Ctx,d);}};
VBI.Utilities.SceneBindDesignBoxBoxSize=function(k,o){"use strict";var s=this.m_Scene;if(o.m_Design&&(o.m_Hit==VBI.HTBOXHANDLE)&&this.m_Scale.IsChangeable(s.m_Ctx)){var z=s.GetStretchFactor4Mode();var n=o.m_ClientX/z[0];var a=o.m_ClientY/z[0];var b=o.m_DhOrig[0];var m=(b[0]+b[2])/2.0;var c=(b[1]+b[3])/2.0;var w=(b[2]-b[0])/2.0;var h=(b[3]-b[1])/2.0;var f=1.0,d=1.0;switch(o.m_Handle){case 0:case 2:case 6:case 8:f=Math.abs(n-m)/w;d=Math.abs(a-c)/h;if(k){f=d=Math.max(f,d);}break;case 1:case 7:d=Math.abs(a-c)/h;if(k){f=d;}break;case 3:case 5:f=Math.abs(n-m)/w;if(k){d=f;}break;default:break;}var e=o.m_ScaleOrig.slice(0);e[0]*=f;e[1]*=d;this.m_Scale.SetValueVector(s.m_Ctx,e);}};
VBI.Utilities.SceneBindMeterRadiusDesignBoxSize=function(o){"use strict";var s=this.m_Scene;if(o.m_Design){var c=this.m_Pos.GetValueVector(s.m_Ctx);var a=s.GetPosFromPoint([o.m_ClientX,o.m_ClientY,0]);var r=0;switch(o.m_Handle){case 1:case 7:r=VBI.MathLib.Distance(VBI.MathLib.DegToRad(c),VBI.MathLib.DegToRad([c[0],a[1]]));break;case 3:case 5:r=VBI.MathLib.Distance(VBI.MathLib.DegToRad(c),VBI.MathLib.DegToRad([a[0],c[1]]));break;default:break;}this.m_Radius.SetValueFloat(s.m_Ctx,Math.abs(r));}};
VBI.Utilities.SceneBindRadiusDesignBoxSize=function(o){"use strict";var s=this.m_Scene;if(o.m_Design){var c=this.m_Pos.GetValueVector(s.m_Ctx);var a=s.GetPointFromPos(c);a[0]+=o.m_IO;var r=0;switch(o.m_Handle){case 1:case 7:r=(a[1]-o.m_ClientY);break;case 3:case 5:r=(a[0]-o.m_ClientX);break;default:break;}this.m_Radius.SetValueFloat(s.m_Ctx,Math.abs(r));}};
VBI.Utilities.SceneBindPosArrayDesignBoxSize=function(o){"use strict";var s=this.m_Scene;if(o.m_Design){var p=s.GetPosFromPoint([o.m_ClientX-o.m_IO,o.m_ClientY,0]);var m=Number.MAX_VALUE;var a=-Number.MAX_VALUE;var b=Number.MAX_VALUE;var c=-Number.MAX_VALUE;var d=o.m_PosOrig.slice(0);var n,l=d.length/3,i;for(n=0;n<l;++n){i=n*3;if(m>d[i]){m=d[i];}if(a<d[i]){a=d[i];}if(b>d[i+1]){b=d[i+1];}if(c<d[i+1]){c=d[i+1];}}var e=0,f=1;var g=0,h=1;switch(o.m_Handle){case 0:case 1:if(o.m_Handle==0){e=a;f=(p[0]-a)/(m-a);}g=b;h=(p[1]-b)/(c-b);break;case 2:case 5:if(o.m_Handle==2){g=b;h=(p[1]-b)/(c-b);}e=m;f=(p[0]-m)/(a-m);break;case 6:case 3:if(o.m_Handle==6){g=c;h=(p[1]-c)/(b-c);}e=a;f=(p[0]-a)/(m-a);break;case 8:case 7:if(o.m_Handle==8){e=m;f=(p[0]-m)/(a-m);}g=c;h=(p[1]-c)/(b-c);break;default:break;}for(n=0;n<l;++n){i=n*3;d[i]=e+(d[i]-e)*f;d[i+1]=g+(d[i+1]-g)*h;}this.m_Pos.SetValueVector(s.m_Ctx,d);}};
VBI.Utilities.BackupFont=function(d){"use strict";d.m_BackupFont=[];d.m_BackupFont.m_font=d.m_font=d.font;d.m_BackupFont.m_fillStyle=d.fillStyle;d.m_BackupFont.m_strokeStyle=d.strokeStyle;d.m_BackupFont.m_textAlign=d.textAlign;d.m_BackupFont.m_textBaseline=d.textBaseline;};
VBI.Utilities.RestoreFont=function(d){"use strict";d.m_font=d.font=d.m_BackupFont.m_font;d.fillStyle=d.m_BackupFont.m_fillStyle;d.strokeStyle=d.m_BackupFont.m_strokeStyle;d.textAlign=d.m_BackupFont.m_textAlign;d.textBaseline=d.m_BackupFont.m_textBaseline;};
VBI.Utilities.SetTextAttributes=function(d,n,a,b,c,e){"use strict";if((n!=undefined)&&(d.m_font!=n)){d.m_font=d.font=n;}var C;if(a){C=VBI.Types.string2rgba(a);d.fillStyle=VBI.Utilities.RgbToHex(C[0],C[1],C[2]);}if(b){C=VBI.Types.string2rgba(b);d.strokeStyle=VBI.Utilities.RgbToHex(C[0],C[1],C[2]);}d.textAlign=c;d.textBaseline=e;};
VBI.Utilities.SetFont=function(d,n){"use strict";if((n!=undefined)&&(d.m_font!=n)){d.m_font=d.font=n;}};
VBI.DnDInfo=function(){"use strict";var d={};d.m_datasource=null;d.m_boundtype=null;d.m_type=[];d.clear=function(){for(var n=0;n<d.m_type.length;++n){d.m_type[n].clear();}if(d.m_boundtype){d.m_boundtype.clear();}if(d.m_datasource){d.m_datasource.clear();}d.m_datasource=null;d.m_boundtype=null;d.m_type=[];};d.load=function(a,c,i){if(a){if(jQuery.type(a)=='array'){for(var n=0;n<a.length;++n){if(jQuery.type(a[n])=='object'){if(a[n].datasource){d.m_datasource=new VBI.NodeProperty(a[n],'datasource',i.m_DataSource,c);d.m_boundtype=new VBI.AttributeProperty(a[n],'type',d.m_datasource,c);}else{d.m_type.push(new VBI.AttributeProperty(a[n],'type',null,c));}}}}else if(jQuery.type(a)=='object'){if(a.datasource){d.m_datasource=new VBI.NodeProperty(a,'datasource',i.m_DataSource,c);d.m_boundtype=new VBI.AttributeProperty(a,'type',d.m_datasource,c);}else{d.m_type.push(new VBI.AttributeProperty(a,'type',null,c));}}}};d.getItemArray=function(c){var v=[];var n;if(d.m_datasource){var a=d.m_datasource;var b;if((b=a.GetCurrentNode(c))){for(n=0;n<b.m_dataelements.length;++n){a.Select(n);v.push(d.m_boundtype.GetValueString(c));}}}if(d.m_type.length){for(n=0;n<d.m_type.length;++n){v.push(d.m_type[n].GetValueString(c));}}return v;};return d;};
VBI.NodeProperty=function(d,n,p,c){"use strict";var a=null;if(!(a=d[n])){a=d[n+".bind"];}this.m_NPath=a.split(".");this.m_Path=a.split(".");this.m_PNP=p;this.m_nCurElement=0;this.m_CurElement=null;this.m_DTN=c.m_DataTypeProvider.FindTypeNodeFromPath(this.m_Path);var t=this;while((t=t.m_PNP)){if(c.m_DataTypeProvider.isParentOf(t.m_DTN,this.m_DTN)){var b,e=t.m_DTN.GetPath();for(b=0;b<e.length;++b){if(this.m_NPath[0]==e[b]){this.m_NPath.splice(0,1);}else{break;}}break;}}this.m_PNP=t;this.NotifyDataChange=function(c){this.m_CurElement=null;this.m_DTN=c.m_DataTypeProvider.FindTypeNodeFromPath(this.m_Path);};this.clear=function(){this.m_PNP=null;this.m_CurElement=null;this.m_DTN=null;this.m_NPath=null;this.m_Path=null;};this.GetCurrentElement=function(c){if(this.m_CurElement){return this.m_CurElement;}var f=this.GetCurrentNode(c);if(!f){return null;}this.m_CurElement=f.m_dataelements[this.m_nCurElement];return(this.m_CurElement);};this.GetIndexedElement=function(c,i){var f=this.GetCurrentNode(c);if(!f){return null;}return f.m_dataelements[i];};this.GetCurrentNode=function(c){var f=null;if(this.m_PNP){var g=this.m_PNP.GetCurrentElement(c);f=g.FindNodeFromPath(this.m_NPath);}else{f=c.m_DataProvider.FindNodeFromPath(this.m_NPath);}return f;};this.Select=function(i){this.m_CurElement=null;this.m_nCurElement=i;};this.SetEditMode=function(c,m){var f;if((f=this.GetCurrentElement(c))){f.m_EditMode=m;}};this.GetEditMode=function(c){var f;if((f=this.GetCurrentElement(c))&&(f.m_EditMode!=undefined)){return f.m_EditMode;}return VBI.EMHandle;};this.IsElementSelected=function(c){var f;if((f=this.GetCurrentElement(c))){return f.IsSelected();}return false;};this.SetSelected=function(c,s){return;};return this;};
VBI.AttributeProperty=function(d,n,p,c,a){"use strict";var v;this.m_DefaultValue=a;if((v=d[n])){this.m_Name=n;this.m_Value=v;}else if((v=d[n+".bind"])){this.m_PNP=p;this.m_Name=n;this.m_RelBind=v.split(".");this.m_AbsBind=v.split(".");this.m_DTA=c.m_DataTypeProvider.FindTypeAttributeFromPath(this.m_AbsBind);var t=this;while((t=t.m_PNP)){if(c.m_DataTypeProvider.isParentOf(t.m_DTN,this.m_DTA)){var b,e=t.m_DTN.GetPath();for(b=0;b<e.length;++b){if(this.m_RelBind[0]==e[b]){this.m_RelBind.splice(0,1);}else{break;}}break;}}this.m_PNP=t;}this.NotifyDataChange=function(c){if(this.m_AbsBind){this.m_DTA=c.m_DataTypeProvider.FindTypeAttributeFromPath(this.m_AbsBind);}};this.clear=function(){this.m_PNP=null;this.m_DTA=null;this.m_DefaultValue=null;if(this.m_Name){this.m_Name=null;}if(this.m_Value){this.m_Value=null;}if(this.m_PNP){this.m_PNP=null;}if(this.m_RelBind){this.m_RelBind=null;}if(this.m_AbsBind){this.m_AbsBind=null;}};this.IsChangeable=function(c){var f;if((f=this.GetAttributeObject(c))){return f.IsChangeable();}return false;};this.GetAttributeObject=function(c){if(this.m_RelBind){if(this.m_PNP){return this.m_PNP.GetCurrentElement(c).FindAttributeFromPath(this.m_RelBind);}else{return c.m_DataProvider.FindAttributeFromPath(this.m_RelBind);}}return null;};this.GetValueFloat=function(c){if(this.m_Value){return VBI.Types.string2float(this.m_Value);}if(this.m_RelBind){var f;if((f=this.GetAttributeObject(c))){if(f.m_dta.m_Type==VBI.Types.st_float){return f.m_Value;}if(f.m_dta.m_Type==VBI.Types.st_string){return VBI.Types.string2float(f.m_Value);}if(f.m_dta.m_Type==VBI.Types.st_long){return VBI.Types.long2float(f.m_Value);}if(f.m_dta.m_Type==VBI.Types.st_bool){return f.m_Value?1.0:0.0;}}}return this.m_DefaultValue;};this.GetValueString=function(c){if(this.m_Value){return this.m_Value;}if(this.m_RelBind){var f;if((f=this.GetAttributeObject(c))){if(f.m_dta.m_Type==VBI.Types.st_string){return f.m_Value;}else{return f.GetStringValue();}}}return this.m_DefaultValue;};this.GetValueLong=function(c){if(this.m_Value){return VBI.Types.string2long(this.m_Value);}if(this.m_RelBind){var f;if((f=this.GetAttributeObject(c))){if(f.m_dta.m_Type==VBI.Types.st_long){return f.m_Value;}if(f.m_dta.m_Type==VBI.Types.st_bool){return f.m_Value;}if(f.m_dta.m_Type==VBI.Types.st_string){return VBI.Types.string2long(f.m_Value);}if(f.m_dta.m_Type==VBI.Types.st_float){return VBI.Types.float2long(f.m_Value);}}}return this.m_DefaultValue;};this.GetValueBool=function(c){if(this.m_Value){return VBI.Types.string2bool(this.m_Value);}if(this.m_RelBind){var f;if((f=this.GetAttributeObject(c))){if(f.m_dta.m_Type==VBI.Types.st_bool){return f.m_Value;}if(f.m_dta.m_Type==VBI.Types.st_string){return VBI.Types.string2bool(f.m_Value);}}}return this.m_DefaultValue;};this.GetValueVector=function(c){if(this.m_Value){if(typeof(this.m_Value)==="string"){return VBI.Types.string2vector(this.m_Value);}else{return VBI.Types.stringarray2vectorarray(this.m_Value);}}if(this.m_RelBind){var f;if((f=this.GetAttributeObject(c))){if((f.m_dta.m_Type==VBI.Types.st_vector)||(f.m_dta.m_Type==VBI.Types.st_vectorarray)||(f.m_dta.m_Type==VBI.Types.st_vectorarraymulti)){return f.m_Value;}if(f.m_dta.m_Type==VBI.Types.st_string){return VBI.Types.string2vector(f.m_Value);}}}return this.m_DefaultValue;};this.GetValueColor=function(c){var r;if(this.m_Value){r=VBI.Types.string2rgba(this.m_Value);return"rgba("+r[0]+","+r[1]+","+r[2]+","+r[3]+")";}if(this.m_RelBind){var f;if((f=this.GetAttributeObject(c))){if((f.m_dta.m_Type==VBI.Types.st_color)){return f.m_Value;}if(f.m_dta.m_Type==VBI.Types.st_string){r=VBI.Types.string2rgba(f.m_Value);return"rgba("+r[0]+","+r[1]+","+r[2]+","+r[3]+")";}}}return this.m_DefaultValue;};this.SetValueVector=function(c,v){if(this.m_Value){return null;}if(this.m_RelBind){var f;if((f=this.GetAttributeObject(c))){if((f.m_dta.m_Type==VBI.Types.st_vector)||(f.m_dta.m_Type==VBI.Types.st_vectorarray)){f.set(v);}if(f.m_dta.m_Type==VBI.Types.st_string){f.set(VBI.Types.float2string(v));}}}return null;};this.SetValueFloat=function(c,v){if(this.m_Value){return null;}if(this.m_RelBind){var f;if((f=this.GetAttributeObject(c))){if((f.m_dta.m_Type==VBI.Types.st_float)){f.set(v);}else if((f.m_dta.m_Type==VBI.Types.st_long)){f.set(VBI.Types.float2long(v));}else if(f.m_dta.m_Type==VBI.Types.st_string){f.set(VBI.Types.float2string(v));}}}return null;};this.IsBound=function(){return this.m_RelBind?true:false;};return this;};
