(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.XLSXExportUtils = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
var ODataDataProvider=require("./provider/ODataDataProvider.js");var FileSaver=require("./filesaver/FileSaver.js");module.exports={oData:{fetch:ODataDataProvider.requestData,getConverter:ODataDataProvider.getConverter},saveFile:FileSaver.saveFile};

},{"./filesaver/FileSaver.js":2,"./provider/ODataDataProvider.js":3}],2:[function(require,module,exports){
function saveFile(blob,name){var link,downloadSupported,fnSave;if(!(blob instanceof Blob)){return}link=document.createElementNS("http://www.w3.org/1999/xhtml","a");downloadSupported="download"in link;if(downloadSupported){fnSave=function(data,fileName){link.download=fileName;link.href=URL.createObjectURL(data);link.dispatchEvent(new MouseEvent("click"))}}if(typeof fnSave==="undefined"){fnSave=function(data){var reader=new FileReader;reader.onloadend=function(){var opened,url;url=reader.result.replace(/^data:[^;]*;/,"data:attachment/file;");opened=window.open(url,"_blank");if(!opened){window.location.href=url}};reader.readAsDataURL(blob)}}if(typeof navigator!=="undefined"&&navigator.msSaveOrOpenBlob){fnSave=function(data,fileName){window.navigator.msSaveOrOpenBlob(data,fileName)}}fnSave(blob,name)}module.exports={saveFile:saveFile};

},{}],3:[function(require,module,exports){
var RequestHandler=require("./RequestHandler.js");var jsonDateRE=/^\/Date\((-?\d+)(\+|-)?(\d+)?\)\/$/;var MAX_ROWS=1e6;function parseDate(sValue){var array,date,offset;if(sValue==null){return null}if(typeof sValue==="object"){sValue=sValue.valueOf()}if(typeof sValue==="number"){return sValue}if(jsonDateRE.test(sValue)){array=jsonDateRE.exec(sValue);date=new Date(parseInt(array[1],10));if(array[2]&&array[3]){offset=parseInt(array[2]+array[3],10);date.setUTCMinutes(date.getUTCMinutes()-offset)}return date.getTime()}if(isFinite(sValue)){return parseInt(sValue,10)}date=new Date(sValue);if(isFinite(date)){return date.getTime()}return null}function getValue(oRow,oCol){var value=oCol.keys.reduce(function(obj,key){return obj&&obj[key]},oRow);return value&&(oCol.type==="date"||oCol.type==="datetime")?parseDate(value):value}function convertData(aRows,aCols){aCols.forEach(function(col){aRows.forEach(function(row){row[col.property]=getValue(row,col)})});return aRows}function getColsToConvert(mSettings){return mSettings.workbook.columns.reduce(function(result,col){var aKeys=col.property.split("/");if(aKeys.length>1||col.type==="date"||col.type==="datetime"){result.push({property:col.property,keys:aKeys,type:col.type})}return result},[])}function getDataConverter(mSettings){var aColumns=getColsToConvert(mSettings);return function(aRows){return convertData(aRows,aColumns)}}function requestData(mSettings,fnProcessCallback){var iAvailableRows=0;var mDataSource=mSettings.dataSource;var iTotalRows=Math.min(mDataSource.count||MAX_ROWS,MAX_ROWS);var iBatchSize=Math.min(mDataSource.sizeLimit||MAX_ROWS,mSettings.batchSize||MAX_ROWS,iTotalRows);var bCancelled=false;var dataUrl=mDataSource.dataUrl;var fnConvertData=getDataConverter(mSettings);var url;var mRequest;function cleanUrl(url){if(!url)return"";var mUri=URI.parse(url);mUri.path=mUri.path||"";if(mUri.path.slice(-1)!=="/"){mUri.path=mUri.path+"/"}delete mUri.query;delete mUri.hash;delete mUri.fragment;return(URI.serialize||URI.build)(mUri)}function getUrl(iSkip,iTop,sNextUrl){var mDataUrl=URI.parse(dataUrl);if(sNextUrl){var mNextUrl=URI.parse(sNextUrl);mDataUrl.query=mNextUrl.query}else{var aQuery=(mDataUrl.query||"").split("&");var mQuery={};aQuery.forEach(function(query){var keyValue=query.split("=");if(keyValue[0]){mQuery[keyValue[0]]=keyValue[1]}});mQuery["$skip"]=iSkip;mQuery["$top"]=iTop;aQuery=[];for(var key in mQuery){aQuery.push(key+(mQuery[key]==null?"":"="+mQuery[key]))}mDataUrl.query=aQuery.join("&")}return(URI.serialize||URI.build)(mDataUrl)}function fnOnError(sMessage){fnProcessCallback({error:sMessage})}function fnOnDataReceived(oResult){var aData,sNextUrl,iFetchedRows,fPercent,iRemainingRows;var mCallbackParams={};if(bCancelled){return}aData=oResult&&oResult.d&&(oResult.d.results||oResult.d)||oResult;aData=Array.isArray(aData)?aData:[];iFetchedRows=aData.length;iAvailableRows+=iFetchedRows;iRemainingRows=iTotalRows-iAvailableRows;fPercent=iAvailableRows/iTotalRows;mCallbackParams.finished=iFetchedRows===0||iRemainingRows<=0;mCallbackParams.progress=Math.round(fPercent*100);sNextUrl=oResult&&oResult.d&&oResult.d.__next||null;if(!mCallbackParams.finished){mRequest.dataUrl=getUrl(iAvailableRows,Math.min(iBatchSize,iRemainingRows),sNextUrl);RequestHandler.sendRequest(mRequest).then(fnOnDataReceived).catch(fnOnError)}mCallbackParams.rows=fnConvertData(aData);fnProcessCallback(mCallbackParams)}mRequest={serviceUrl:cleanUrl(mDataSource.serviceUrl),dataUrl:getUrl(0,iBatchSize),method:mDataSource.useBatch?"BATCH":"GET",headers:mDataSource.headers};RequestHandler.sendRequest(mRequest).then(fnOnDataReceived).catch(fnOnError);return{cancel:function(){bCancelled=true}}}module.exports={requestData:requestData,getConverter:getDataConverter};

},{"./RequestHandler.js":4}],4:[function(require,module,exports){
function sendRequest(oRequest){if(typeof oRequest!=="object"||oRequest===null||typeof oRequest.dataUrl!=="string"){throw new Error("Unable to send request - Mandatory parameters missing.")}return(oRequest.method==="BATCH"&&oRequest.serviceUrl?sendBatchRequest:sendGetRequest)(oRequest)}function sendGetRequest(oRequest){return new Promise(function(fnResolve,fnReject){var xhr=new XMLHttpRequest;xhr.onload=function(){if(this.status>=400){fnReject(this.responseText);return}try{fnResolve(JSON.parse(this.responseText))}catch(e){fnReject("Server response is not a valid JSON:\n"+this.responseText)}};xhr.onerror=function(){fnReject(this.responseText)};xhr.open("GET",oRequest.dataUrl,true);xhr.setRequestHeader("accept","application/json");xhr.send()})}function createGuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c==="x"?r:r&3|8;return v.toString(16)})}function sendBatchRequest(oRequest){return new Promise(function(fnResolve,fnReject){var xhr=new XMLHttpRequest;var boundary="batch_"+createGuid();var getUrl=oRequest.dataUrl.split(oRequest.serviceUrl)[1];var body=[];xhr.onload=function(){var responseText=this.responseText;var aLines=this.responseText.split("\r\n");var iStart=0,iLength=aLines.length,iEnd=iLength-1;while(iStart<iLength&&aLines[iStart].slice(0,1)!=="{"){iStart++}while(iEnd>0&&aLines[iEnd].slice(-1)!=="}"){iEnd--}aLines=aLines.slice(iStart,iEnd+1);responseText=aLines.join("\r\n");try{var responseData=JSON.parse(responseText);fnResolve(responseData)}catch(e){fnReject("Server response is not a valid JSON")}};xhr.onerror=function(){fnReject(this.responseText)};xhr.open("POST",oRequest.serviceUrl+"$batch",true);xhr.setRequestHeader("Accept","multipart/mixed");xhr.setRequestHeader("Content-Type","multipart/mixed;boundary="+boundary);for(var key in oRequest.headers){if(key.toLowerCase()!="accept"){xhr.setRequestHeader(key,oRequest.headers[key])}}body.push("--"+boundary);body.push("Content-Type: application/http");body.push("Content-Transfer-Encoding: binary");body.push("");body.push("GET "+getUrl+" HTTP/1.1");for(var key in oRequest.headers){body.push(key+":"+oRequest.headers[key])}body.push("");body.push("");body.push("--"+boundary+"--");body.push("");body=body.join("\r\n");xhr.send(body)})}module.exports={sendRequest:sendRequest};

},{}]},{},[1])(1)
});
//# sourceMappingURL=XLSXExportUtils.js.map
