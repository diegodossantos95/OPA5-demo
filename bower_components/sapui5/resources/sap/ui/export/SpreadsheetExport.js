/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2017 SAP SE. All rights reserved
	
 */
sap.ui.define(['jquery.sap.global'],function(q){'use strict';var L="sap/ui/thirdparty/jszip",a="sap/ui/export/js/XLSXExportUtils",b="sap/ui/export/js/XLSXBuilder";function d(p,c){function f(m){return c&&c(m);}function o(v){f({progress:v});}function g(e){f({error:e});}function h(){f({finish:true});}function i(){var s;var S;var C;var t;function e(X,v){S=X.saveFile;C=X.oData.getConverter(p);s=new v(p.workbook.columns);o(0);t=window.setTimeout(l,0);}function l(){if(s){var D=p.dataSource.data||[];var R=C(D.slice());s.append(R);o(50);t=window.setTimeout(m,0);}}function m(){if(s){s.build().then(r);}}function r(v){if(v){S(new Blob([v]),p.fileName);}h();s=null;}function u(){window.clearTimeout(t);r();}sap.ui.require([a,b,L],e);return{cancel:u};}function n(u){return u?window.URI(u).absoluteTo(window.location.href).toString():u;}function j(){var s,r,S;function e(X,u){S=X.saveFile;s=new u(p.workbook.columns);r=X.oData.fetch(p,l);o(0);}function l(M){if(M.rows){s.append(M.rows);}if(M.progress){o(M.progress);}if(M.error){s=null;return g(M.error);}return M.finished&&s.build().then(m);}function m(u){S(new Blob([u]),p.fileName);h();s=null;}function t(){r.cancel();h();s=null;}sap.ui.require([a,b,L],e);return{cancel:t};}function k(){var l;var s;var m=q.extend(true,{},p);var w=typeof m.worker==="object"?m.worker:{};var C=function(){s.postMessage({cancel:true});h();};function r(x){var y=new Worker(x);y.onmessage=function(e){if(e.data.status){o(e.data.status);}else if(e.data.error){g(e.data.error);}else{l.saveFile(new Blob([e.data]),m.fileName);h();}};y.postMessage(m);return y;}function t(){q.sap.log.warning("Direct worker is not allowed. Load the worker via blob.");var e=window.URI(w.base).absoluteTo().search("").hash("").toString();w.src=e+w.ref;var x='self.origin = "'+e+'"; '+'importScripts("'+w.src+'")';var y=new Blob([x]);var z=window.URL.createObjectURL(y);return r(z);}function u(){q.sap.log.warning("Blob worker is not allowed. Use in-process export.");C=j(m).cancel;}function v(X){l=X;try{s=r(w.src);s.addEventListener("error",function(e){s=t();s.addEventListener("error",function(e){u();e.preventDefault();});e.preventDefault();});}catch(x){try{s=t();}catch(y){u();}}}m.dataSource.dataUrl=n(m.dataSource.dataUrl);m.dataSource.serviceUrl=n(m.dataSource.serviceUrl);w.base=w.base||sap.ui.resource("sap.ui.export.js","");w.ref=w.ref||"SpreadsheetWorker.js";w.src=w.base+w.ref;sap.ui.require([a],v);return{cancel:function(){C();}};}if(p.dataSource.type==="array"){return i();}else if(p.worker===false){return j();}else{return k();}}return{execute:d};},true);
