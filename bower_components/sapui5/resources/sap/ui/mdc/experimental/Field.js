/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2017 SAP SE. All rights reserved
 */
sap.ui.define(['jquery.sap.global','sap/ui/core/Control','sap/ui/model/base/ManagedObjectModel','sap/ui/model/BindingMode','sap/m/Input','sap/m/Text','sap/ui/mdc/library'],function(q,C,M,B,I,T,l){"use strict";var D;var a;var b;var E=l.EditMode;var F=l.FieldDisplay;var c=C.extend("sap.ui.mdc.experimental.Field",{metadata:{interfaces:["sap.ui.core.IFormContent"],library:"sap.ui.mdc",properties:{value:{type:"any",defaultValue:null},additionalValue:{type:"any",defaultValue:null},dataType:{type:"string",group:"Data",defaultValue:'sap.ui.model.type.String'},dataTypeConstraints:{type:"object",group:"Data",defaultValue:null},dataTypeFormatOptions:{type:"object",group:"Data",defaultValue:null},width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:""},editMode:{type:"sap.ui.mdc.EditMode",group:"Data",defaultValue:E.Editable},required:{type:"boolean",group:"Data",defaultValue:false},icon:{type:"sap.ui.core.URI",group:"Appearance",defaultValue:null},display:{type:"sap.ui.mdc.FieldDisplay",defaultValue:F.Value},textAlign:{type:"sap.ui.core.TextAlign",group:"Appearance",defaultValue:sap.ui.core.TextAlign.Initial},textDirection:{type:"sap.ui.core.TextDirection",group:"Appearance",defaultValue:sap.ui.core.TextDirection.Inherit},placeholder:{type:"string",group:"Misc",defaultValue:null},valueState:{type:"sap.ui.core.ValueState",group:"Appearance",defaultValue:sap.ui.core.ValueState.None},valueStateText:{type:"string",group:"Misc",defaultValue:null}},events:{change:{parameters:{value:{type:"string"},valid:{type:"boolean"}}},liveChange:{parameters:{value:{type:"string"},escPressed:{type:"boolean"},previousValue:{type:"string"}}},dataChanged:{}},aggregations:{content:{type:"sap.ui.core.Control",multiple:false},_content:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},fieldHelp:{type:"sap.ui.mdc.experimental.FieldHelpBase",multiple:false}},associations:{ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},publicMethods:[],defaultAggregation:"content",defaultProperty:"value"},_oManagedObjectModel:null});c.prototype.init=function(){this._oManagedObjectModel=new M(this);};c.prototype.exit=function(){this._oManagedObjectModel.destroy();delete this._oManagedObjectModel;};c.prototype.onBeforeRendering=function(){d.call(this);};c.prototype.setValue=function(v){this.setProperty("value",v);_.call(this,v);return this;};c.prototype.setDisplay=function(v){this.setProperty("display",v);_.call(this,this.getValue());return this;};function _(K){if(!this.isBound("additionalValue")){var v=this.getFieldHelp();if(v&&this.getDisplay()==sap.ui.mdc.FieldDisplay.Description){var A;if(K){A=v.getTextforKey(K);}this.setAdditionalValue(A);}}}c.formatText=g;function d(){if(!this._getContent()){var v=this.getEditMode();var w=this.getDataType();var x;var y=this.getId()+"-inner";switch(v){case E.Display:switch(w){case"Edm.Date":case"Edm.DateTimeOffset":case"Edm.TimeOfDay":x=new T(y,{text:{path:"$field>value",type:this._getDataType()},textAlign:"{$field>textAlign}",textDirection:"{$field>textDirection}",wrapping:false});break;default:x=new T(y,{text:{parts:[{path:"$field>value"},{path:"$field>additionalValue"},{path:"$field>display"}],formatter:g},textAlign:"{$field>textAlign}",textDirection:"{$field>textDirection}",wrapping:false});break;}break;default:switch(w){case"Edm.Date":x=j.call(this,y);break;case"Edm.DateTimeOffset":x=k.call(this,y);break;case"Edm.TimeOfDay":x=m.call(this,y);break;default:var P="$field>value";if(this.getDisplay()==sap.ui.mdc.FieldDisplay.Description){P="$field>additionalValue";}x=new I(y,{value:{path:P},placeholder:"{$field>placeholder}",textAlign:"{$field>textAlign}",textDirection:"{$field>textDirection}",required:"{$field>required}",editable:{path:"$field>editMode",formatter:e},enabled:{path:"$field>editMode",formatter:f},valueState:"{$field>valueState}",valueStateText:"{$field>valueStateText}",showValueHelp:!!this.getFieldHelp(),change:o.bind(this),liveChange:p.bind(this),valueHelpRequest:r.bind(this)});break;}break;}if(x){this.setAggregation("_content",x,true);n.call(this,x);}}}c.prototype._getContent=function(){return this.getContent()||this.getAggregation("_content");};function e(v){if(v&&v==E.Editable){return true;}else{return false;}}function f(v){if(v&&v!=E.Disabled){return true;}else{return false;}}function g(v,A,w){var x=v?v:"";var y=A?A:"";var z="";switch(w){case F.Description:z=y;break;case F.ValueDescription:z=x+" ("+y+")";break;case F.DescriptionValue:z=y+" ("+x+")";break;default:z=x;}if(z.replace){z=z.replace(" ()","");}return z;}function h(D,v){var w=new D(v,{value:{path:"$field>value",type:this._getDataType()},placeholder:"{$field>placeholder}",textAlign:"{$field>textAlign}",textDirection:"{$field>textDirection}",required:"{$field>required}",editable:{path:"$field>editMode",formatter:e},enabled:{path:"$field>editMode",formatter:f},valueState:"{$field>valueState}",valueStateText:"{$field>valueStateText}",width:"100%",change:o.bind(this)});return w;}function i(D){var v=this.getId()+"-inner";var w=h.call(this,D,v);this.setAggregation("_content",w);n.call(this,w);}function j(v){if(!D){D=sap.ui.require("sap/m/DatePicker");if(!D){sap.ui.require(["sap/m/DatePicker"],i.bind(this));return null;}}return h.call(this,D,v);}function k(v){if(!a){a=sap.ui.require("sap/m/DateTimePicker");if(!a){sap.ui.require(["sap/m/DateTimePicker"],i.bind(this));return null;}}return h.call(this,a,v);}function m(v){if(!b){b=sap.ui.require("sap/m/TimePicker");if(!b){sap.ui.require(["sap/m/TimePicker"],i.bind(this));return null;}}return h.call(this,b,v);}function n(v){v.setModel(this._oManagedObjectModel,"$field");v.bindElement({path:"/",model:"$field"});}c.prototype.setEditMode=function(v){var O=this.getEditMode();if(O!=v){if(this.getAggregation("_content")){this.destroyAggregation("_content");}this.setProperty("editMode",v);d.call(this);}return this;};c.prototype.setContent=function(v){var O=this.getContent();if(O){O.unbindElement("$field");if(O.getMetadata().getEvents().change){O.detachEvent("change",o,this);}if(O.getMetadata().getEvents().liveChange){O.detachEvent("liveChange",p,this);}}if(this.getAggregation("_content")){this.destroyAggregation("_content");}this.setAggregation("content",v);if(v){n.call(this,v);if(v.getMetadata().getEvents().change){v.attachEvent("change",o,this);}if(v.getMetadata().getEvents().liveChange){v.attachEvent("liveChange",p,this);}}else{d.call(this);}return this;};c.prototype.destroyContent=function(){var O=this.getContent();if(O){O.unbindElement("$field");if(O.getMetadata().getEvents().change){O.detachEvent("change",o,this);}}this.destroyAggregation("content");d.call(this);return this;};c.prototype.setFieldHelp=function(v){var O=this.getFieldHelp();if(O){O.detachEvent("select",s,this);O.detachEvent("navigate",t,this);O.detachEvent("dataUpdate",u,this);}this.setAggregation("fieldHelp",v);if(v){v.attachEvent("select",s,this);v.attachEvent("navigate",t,this);v.attachEvent("dataUpdate",u,this);_.call(this,this.getValue());}var w=this.getAggregation("_content");if(w&&w.setShowValueHelp){w.setShowValueHelp(!!v);}return this;};c.prototype.destroyFieldHelp=function(){var O=this.getFieldHelp();if(O){O.detachEvent("select",s,this);O.detachEvent("navigate",t,this);}this.destroyAggregation("fieldHelp");var v=this.getAggregation("_content");if(v&&v.setShowValueHelp){v.setShowValueHelp(false);}return this;};c.prototype.getIdForLabel=function(){var v;var w=this._getContent();if(w){v=w.getId();}else{v=this.getId();}return v;};function o(v){var V;var w=true;if("value"in v.getParameters()){V=v.getParameter("value");}else{V=this.getValue();}if("valid"in v.getParameters()){w=v.getParameter("valid");}var x=this.getFieldHelp();if(x){x.close();if(this.getDisplay()==sap.ui.mdc.FieldDisplay.Description){V=x.getSelectedKey();}}this.fireChange({value:V,valid:w});}function p(v){var V;var P;var w=false;if("value"in v.getParameters()){V=v.getParameter("value");}if("escPressed"in v.getParameters()){w=v.getParameter("escPressed");}if("previousValue"in v.getParameters()){P=v.getParameter("previousValue");}else{P=this.getValue();}var x=this.getFieldHelp();if(x){x.setFilterValue(V);if(this.getDisplay()==sap.ui.mdc.FieldDisplay.Description){x.setSelectedKey("");}if(x.openByTyping()){x.open();}}this.fireLiveChange({value:V,escPressed:w,previousValue:P});}c.prototype.getFocusDomRef=function(){var v=this._getContent();if(v){return v.getFocusDomRef();}else{return this.getDomRef();}};c.prototype.setDataType=function(v){delete this._oDataType;this.setProperty("dataType",v,true);};c.mapEdmTypes={"Edm.Boolean":"sap.ui.model.odata.type.Boolean","Edm.Byte":"sap.ui.model.odata.type.Byte","Edm.Date":"sap.ui.model.odata.type.Date","Edm.DateTime":"sap.ui.model.odata.type.DateTime","Edm.DateTimeOffset":"sap.ui.model.odata.type.DateTimeOffset","Edm.Decimal":"sap.ui.model.odata.type.Decimal","Edm.Double":"sap.ui.model.odata.type.Double","Edm.Float":"sap.ui.model.odata.type.Single","Edm.Guid":"sap.ui.model.odata.type.Guid","Edm.Int16":"sap.ui.model.odata.type.Int16","Edm.Int32":"sap.ui.model.odata.type.Int32","Edm.Int64":"sap.ui.model.odata.type.Int64","Edm.SByte":"sap.ui.model.odata.type.SByte","Edm.Single":"sap.ui.model.odata.type.Single","Edm.String":"sap.ui.model.odata.type.String","Edm.Time":"sap.ui.model.odata.type.Time","Edm.TimeOfDay":"sap.ui.model.odata.type.TimeOfDay"};c.prototype._createDataType=function(v){var O=q.sap.getObject(v);if(!O){var N=c.mapEdmTypes[v];if(!N){q.sap.log.error("Field","dataType for "+v+" can not be created!");return null;}return this._createDataType(N);}return new O(this.getDataTypeFormatOptions(),this.getDataTypeConstraints());};c.prototype._getDataType=function(v){if(!this._oDataType){this._oDataType=this.getProperty("dataType");if(typeof this._oDataType==="string"){this._oDataType=this._createDataType(this._oDataType);}}return this._oDataType;};c.prototype.enhanceAccessibilityState=function(v,A){var P=this.getParent();if(P&&P.enhanceAccessibilityState){P.enhanceAccessibilityState(this,A);}};c.prototype.onsapup=function(v){var w=this.getFieldHelp();if(w){v.preventDefault();v.stopPropagation();w.navigate(-1);}};c.prototype.onsapdown=function(v){var w=this.getFieldHelp();if(w){v.preventDefault();v.stopPropagation();w.navigate(1);}};function r(v){var w=this.getFieldHelp();if(w){w.setFilterValue("");w.toggleOpen();if(this.getDisplay()==sap.ui.mdc.FieldDisplay.Description){w.setSelectedKey(this.getValue());}}}function s(v){var V=v.getParameter("value");var A=v.getParameter("additionalValue");var K=v.getParameter("key");var N;var w;if(this.getDisplay()==sap.ui.mdc.FieldDisplay.Description){N=K;w=V;}else{N=V;w=A;}this.setProperty("value",N);this.setAdditionalValue(w);this.fireChange({value:N,valid:true});}function t(v){var V=v.getParameter("value");var K=v.getParameter("key");var N;if(this.getDisplay()==sap.ui.mdc.FieldDisplay.Description){N=K;}else{N=V;}var w=this.getAggregation("_content");if(w&&w._$input){w._$input.val(V);w._doSelect();}this.fireLiveChange({value:N});}function u(){_.call(this,this.getValue());}return c;},true);
