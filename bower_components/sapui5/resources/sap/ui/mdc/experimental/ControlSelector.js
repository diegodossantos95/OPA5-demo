/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2017 SAP SE. All rights reserved
 */
sap.ui.define(['jquery.sap.global','sap/ui/core/Control'],function(q,C){"use strict";var a=C.extend("sap.ui.mdc.experimental.ControlSelector",{constructor:function(){C.apply(this,arguments);},metadata:{properties:{selectedIndex:{type:"int",defaultValue:-1},defaultIndex:{type:"int",defaultValue:0},renderRoot:{type:"boolean",defaultValue:false},reuseControls:{type:"boolean",defaultValue:false}},aggregations:{content:{type:"sap.ui.core.Control",multiple:true},_current:{type:"sap.ui.core.Control",multiple:false,hidden:true}},associations:{use:{type:"sap.ui.mdc.ControlSelector",multiple:false}},defaultAggregation:"content"},renderer:function(r,o){var d=o.getCurrentContent(),R=o.getRenderRoot();if(!R&&d&&d.getVisible()){var D=o.getDomRef();if(q.sap.log.isLoggable(q.sap.log.Level.DEBUG)&&D){r.write("<!-- sap.ui.mdc.experimental.ControlSelector with id='"+o.getId()+"' and renderRoot=false, used old id='"+D.id+"' for rerendering -->");if(D.previousSibling&&D.previousSibling.nodeType===8){D.previousSibling.parentNode.removeChild(D.previousSibling);}}if(D){D.parentNode.removeChild(D);}r.renderControl(d);o._sOldId=d.getId();}else{r.write("<div ");if(!R){r.write(" style=\"display:none\"");}r.writeControlData(o);r.write(">");if(R){r.renderControl(d);}r.write("</div>");}}});var b=sap.ui.getCore().byId;var c=-1;a.prototype.init=function(){this._mClones=null;this._sOldId=null;this._oFree={};};a.prototype._setCurrent=function(o){this.setAggregation("_current",o);};a.prototype.getDomRef=function(){var d=q.sap.domById(this.getId());if(d||this.getRenderRoot()){return d;}else if(this._sOldId){return q.sap.domById(this._sOldId);}return null;};a.prototype._setTemplate=function(t,i){this.oTemplate=t;if(!this.getAggregation("_current")){var o=this.oTemplate._getCurrent(i);if(o){this._setCurrent(o.clone(this.getId()+"-content"));this.setProperty("selectedIndex",i,true);}else{this.oTemplate._unregisterClone(this);this.destroyContent();}}};a.prototype.validateAggregation=function(n,o){var r=C.prototype.validateAggregation.apply(this,arguments);if(n==="content"&&o instanceof a){throw new Error("sap.ui.mdc.experimental.ControlSelector cannot be used as content of another sap.ui.mdc.experimental.ControlSelector");}return r;};a.prototype._getPoolIndex=function(v){if(!this.oTemplate){return 0;}var d=this.oTemplate.getContent();if(!d||v<0||v>=d.length-1){v=0;}return v;};a.prototype._getCurrentInstance=function(i){var p=this._getPoolIndex(i),o=null;if(this.oTemplate.getReuseControls()&&this.oTemplate._oFree[p]&&this.oTemplate._oFree[p].length){o=this.oTemplate._oFree[p].pop();}else{var d=this.oTemplate._getCurrent(i);if(d){o=d.clone(this.getId()+"-"+c+"-content");}c++;}return o;};a.prototype.setSelectedIndex=function(i){var o=this.getSelectedIndex();this.setProperty("selectedIndex",i,true);if(o!=i){if(this.oTemplate){var d=this.getAggregation("_current");if(d){if(this.oTemplate.getReuseControls()){var p=this._getPoolIndex(o);if(!this.oTemplate._oFree[p]){this.oTemplate._oFree[p]=[];}this.oTemplate._oFree[p].push(d);}else{d.destroy("KeepDom");}}var e=this._getCurrentInstance(i);if(e){this._setCurrent(e);}}else{if(this._mClones){for(var n in this._mClones){b(n).setSelectedIndex(i);}}else{this.invalidate();}}}return this;};a.prototype._registerClone=function(i){if(!this._mClones){this._mClones={};this._attachModifyAggregation("content",this._updateClones,this);}this._mClones[i.getId()]=null;};a.prototype._unregisterClone=function(i){if(this._mClones){if(typeof i==="string"){delete this._mClones[i];}else if(i instanceof C){delete this._mClones[i.getId()];}if(Object.keys(this._mClones).length===0){this._detachModifyAggregation("content",this._updateClones,this);this._mClones=null;}}};a.prototype._updateClones=function(){if(this._mClones){for(var n in this._mClones){var o=b(n);if(o){o.destroyContent();o._setTemplate(this,o.getSelectedIndex());}else{this._unregisterClone(n);}}}};a.prototype.clone=function(i){var o;if(!this.oTemplate){o=C.prototype.clone.apply(this,[arguments[0],arguments[1],{cloneChildren:false,cloneBindings:true}]);o._setTemplate(this,this.getSelectedIndex());this._registerClone(o);return o;}else{o=C.prototype.clone.apply(this,arguments);o._setTemplate(this.oTemplate,this.getSelectedIndex());this.oTemplate._registerClone(o);return o;}};a.prototype.getCurrentContent=function(){if(this.oTemplate){return this.getAggregation("_current");}else{return this._getCurrent(this.getSelectedIndex());}};a.prototype.getContent=function(){if(this.oTemplate){return this.getAggregation("_current");}return this.getAggregation("content");};a.prototype._getCurrent=function(i){var d=this.getAggregation("content");if(d&&(i<0||i>=d.length)){q.sap.log.debug("Changing index of ControlSelector to defaultIndex: current is "+i);var D=this.getDefaultIndex();if(D<0||D>=d.length){q.sap.log.debug("Changing index of ControlSelector to 0: current is "+i);i=0;}else{i=D;}}if(d&&d[i]){return d[i];}return null;};a.prototype.setUse=function(i){var d=this.getAggregation("content");if(d&&d.length>0){q.sap.log.warning("Content is ignored for "+this.getId()+" because association 'use' is set to reference another ControlSelector instance.");this.destroyAggregation("content");}var u=b(i);if(!u){q.sap.log.warning("ControlSelector with id "+i+" is not available.");return;}if(!(u instanceof a)){q.sap.log.warning("Control with id "+i+" is not a ControlSelector.");return;}this.setAssociation("use",i);this.oTemplate=u;this._setTemplate(this.oTemplate,this.getSelectedIndex());this.oTemplate._registerClone(this);};a.prototype.destroy=function(){if(this._mClones){for(var n in this._mClones){var o=b(n);if(o){o.destroy();}}}else if(this.oTemplate){this.oTemplate._unregisterClone(this);}C.prototype.destroy.apply(this,arguments);};return a;},true);
