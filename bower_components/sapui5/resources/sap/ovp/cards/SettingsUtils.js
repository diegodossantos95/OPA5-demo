/*!
 * Copyright (c) 2009-2014 SAP SE, All Rights Reserved
 */
sap.ui.define(['jquery.sap.global',"sap/m/Dialog","sap/m/Button",'sap/ovp/cards/CommonUtils'],function(q,D,B,C){"use strict";function a(o,v){var i=o.getComponentInstance(),k=i.getComponentData(),A=k.appComponent,l=k.cardId,m=l+'Dialog',M=k.modelName,n=A.getModel(M),p=v.getModel().getData(),r={cards:{}};r.cards[m]={model:M,template:p.template,settings:p};v.setModel(n,M);v.getController()._oManifest=r;C.createCardComponent(v,r,'dialogCard');}function h(o){var i=o.getRootControl().getModel("ovpCardProperties").getData(),t=i.tabs;return(!!t&&t.length!=0)||(i.template==="sap.ovp.cards.linklist"&&!!i.staticContent);}function b(o,v,k){var l=o.getRootControl().getModel("ovpCardProperties").getData(),t=l.tabs,I;if(!!t&&t.length!=0){I=new sap.m.IconTabBar({selectedKey:l.selectedKey,select:function(E){var n=v.byId("dialogCard");var r=n.getComponentInstance().getRootControl();var p=r.getController();p.changeSelection(E,true);}.bind(this)}).addStyleClass("sapOvpITH");for(var i=0;i<t.length;i++){var m=new sap.m.IconTabFilter({text:t[i].value,key:i+1});I.addItem(m);}}else{I=new sap.m.IconTabBar({selectedKey:1,select:function(E){var n=E.getParameters().selectedKey;var p=n-1;var r=v.byId("dialogCard");var R=r.getComponentInstance().getRootControl();var u=R.byId("pictureCarousel");if(u){u.setActivePage(u.getAggregation("pages")[p]);}var M=v.getModel();M.setProperty("/lineItemId","linkListItem--"+n);var w=v.byId("sapOvpSettingsForm").getModel().getData().staticContent[p];var L,x,T=v.byId("sapOvpSettingsLineItemTitle"),y=v.byId("sapOvpSettingsLineItemSubTitle");T.bindValue("/staticContent/"+p+"/title");y.bindValue("/staticContent/"+p+"/subTitle");var V=v.getModel("visibility");if(w.semanticObject&&w.action){V.setProperty("/links",true);V.setProperty("/staticLink",false);L=v.byId("sapOvpSettingsLinks");x=L.getItemByKey("#"+w.semanticObject+"-"+w.action);L.setSelectedItem(x);}else{V.setProperty("/staticLink",true);V.setProperty("/links",false);L=v.byId("sapOvpSettingsStaticLink");L.bindValue("/staticContent/"+p+"/targetUri");}V.refresh();}.bind(this)}).addStyleClass("sapOvpITH");for(var i=0;i<l.staticContent.length;i++){var m=new sap.m.IconTabFilter({text:"Record--"+(i+1),key:i+1});I.addItem(m);}}I.addContent(v);k.addContent(I);}function g(A){if(A.indexOf('#')!==-1){return A.split('#')[1];}else{return"Default";}}function c(E,k){if(k.indexOf(",")!==-1){k=k.split(",")[0];}if(k.indexOf(".Identification")!==-1){if(E[k]){var r=sap.ovp.cards.AnnotationHelper.sortCollectionByImportance(E[k]);for(var i=0;i<r.length;i++){var I=r[i];if(I.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){if(I&&I["Label"]){return I["Label"].String;}else{return I["SemanticObject"].String+"-"+I["Action"].String;}}if(I.RecordType==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"){if(I&&I["Label"]){return I["Label"].String;}else{return I["Url"].String;}}}}return"No Navigation";}else{var l="",A=g(k);if(A!=="Default"){l="#"+A;}var L="com.sap.vocabularies.Common.v1.Label"+l;if(E[k]&&E[k][L]){return E[k][L].String;}else{return A;}}}function d(t,T){switch(T){case"listType":var i=["sap.ovp.cards.list"];return(i.indexOf(t)!==-1);case"listFlavor":var k=["sap.ovp.cards.list","sap.ovp.cards.linklist"];return(k.indexOf(t)!==-1);case"kpiHeader":var l=["sap.ovp.cards.list","sap.ovp.cards.table","sap.ovp.cards.charts.analytical","sap.ovp.cards.charts.bubble","sap.ovp.cards.charts.donut","sap.ovp.cards.charts.line"];return(l.indexOf(t)!==-1);case"chart":var m=["sap.ovp.cards.charts.analytical","sap.ovp.cards.charts.bubble","sap.ovp.cards.charts.donut","sap.ovp.cards.charts.line"];return(m.indexOf(t)!==-1);case"lineItem":var n=["sap.ovp.cards.list","sap.ovp.cards.table"];return(n.indexOf(t)!==-1);default:break;}}function e(o,E){switch(E){case"subTitle":case"title":return(!!o[E]);case"valueSelectionInfo":if(!o.valueSelectionInfo){o.valueSelectionInfo=' ';}return(!!o.dataPointAnnotationPath&&d(o.template,"kpiHeader"));case"listType":case"listFlavor":return d(o.template,E);case"sortOrder":case"sortBy":return(!!o[E]&&!o.staticContent);case"dataPoint":return(d(o.template,"kpiHeader")&&!!o.dataPointAnnotationPath);case"identification":case"presentationVariant":case"selectionVariant":return(!o.staticContent);case"kpiHeader":case"lineItem":case"chart":return d(o.template,E);case"lineItemSubTitle":case"lineItemTitle":case"staticLink":case"links":var F=(o.template==="sap.ovp.cards.linklist"&&!!o.staticContent);if(E==="staticLink"){return(F&&!!o.staticContent[0].targetUri);}else if(E==="links"){return(F&&!!o.staticContent[0].semanticObject);}else{return F;}default:break;}}function s(o){this.oVisibility["title"]=e(o,"title");this.oVisibility["subTitle"]=e(o,"subTitle");this.oVisibility["kpiHeader"]=e(o,"kpiHeader");this.oVisibility["valueSelectionInfo"]=e(o,"valueSelectionInfo");this.oVisibility["listType"]=e(o,"listType");this.oVisibility["listFlavor"]=e(o,"listFlavor");this.oVisibility["sortOrder"]=e(o,"sortOrder");this.oVisibility["sortBy"]=e(o,"sortBy");this.oVisibility["staticLink"]=e(o,"staticLink");this.oVisibility["links"]=e(o,"links");this.oVisibility["lineItemTitle"]=e(o,"lineItemTitle");this.oVisibility["lineItemSubTitle"]=e(o,"lineItemSubTitle");}function _(){var r=sap.ui.getCore().getLibraryResourceBundle("sap.ovp");var o=r?new sap.ui.model.resource.ResourceModel({bundleUrl:r.oUrlInfo.url}):null;return o;}function f(o){var E=o.entityType,v=[{sVariant:".SelectionVariant",sPath:"selectionVariant"},{sVariant:".PresentationVariant",sPath:"presentationVariant"},{sVariant:".Identification",sPath:"identification"},{sVariant:".DataPoint",sPath:"dataPoint"},{sVariant:".Chart",sPath:"chart"},{sVariant:".LineItem",sPath:"lineItem"}];for(var i=0;i<v.length;i++){var V=[];for(var k in E){if(E.hasOwnProperty(k)&&k.indexOf(v[i].sVariant)!==-1){if(v[i].sVariant===".LineItem"){var l={name:c(E,k),value:k,fields:sap.ovp.cards.AnnotationHelper.sortCollectionByImportance(E[k])};V.push(l);if(k===o.annotationPath){o.lineItemQualifier=l.name;}}else{V.push({name:c(E,k),value:k});}}}if(V.length!==0&&(v[i].sPath!=="dataPoint"||d(o.template,"kpiHeader"))){o[v[i].sPath]=V;}this.oVisibility[v[i].sPath]=(e(o,v[i].sPath)&&V.length!==0);}return o;}function j(m){var o=m.getData();sap.ushell.Container.getService('CrossApplicationNavigation').getLinks().done(function(l){var A=[],L={};for(var i=0;i<l.length;i++){A.push(l[i].intent);L[l[i].intent]=l[i].text;}sap.ushell.Container.getService('CrossApplicationNavigation').isIntentSupported(A).done(function(r){var l=[];for(var k in r){if(r.hasOwnProperty(k)&&r[k].supported===true&&L&&L[k]){l.push({name:L[k],value:k});}}var n=o;if(l.length!==0||l.length!==0){n['links']=l;}m.refresh();}).fail(function(E){q.sap.log.error(E);});}).fail(function(E){q.sap.log.error(E);});}var S={dialogBox:undefined,FORM_ITEM_NAME_FOR_LIST_FLAVOR_IN_LINKLIST:sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("OVP_KEYUSER_CAROUSEL"),FORM_ITEM_NAME_FOR_LIST_FLAVOR_IN_LIST:sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("OVP_KEYUSER_BARLIST"),addManifestSettings:f,setVisibilityForFormElements:s,oVisibility:{"title":true,"subTitle":true,"kpiHeader":true,"valueSelectionInfo":true,"listType":true,"listFlavor":true,"sortOrder":true,"sortBy":true,"selectionVariant":true,"presentationVariant":true,"lineItem":true,"identification":true,"dataPoint":true,"chart":true,"links":false,"lineItemTitle":false,"lineItemSubTitle":false,"staticLink":false},getDialogBox:function(o){return new Promise(function(r,i){if(!this.dialogBox){this.oSaveButton=new B("settingsSaveBtn",{text:sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("save")});var k=new B("settingsCancelBtn",{text:sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("cancelBtn")});this.dialogBox=new D("settingsDialog",{title:sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("settingsDialogTitle"),buttons:[this.oSaveButton,k],resizable:true,contentWidth:"70%",afterClose:function(E){this.dialogBox.destroyContent();}.bind(this)});this.dialogBox.setBusyIndicatorDelay(0);k.attachPress(function(E){this.dialogBox.close();}.bind(this));}var l=o.getComponentInstance().getRootControl().getModel("ovpCardProperties").getData(),l=this.addManifestSettings(l),m=new sap.ui.model.json.JSONModel(l),n=_();if(l.template==="sap.ovp.cards.linklist"){m.setProperty("/listFlavorName",this.FORM_ITEM_NAME_FOR_LIST_FLAVOR_IN_LINKLIST);}else{m.setProperty("/listFlavorName",this.FORM_ITEM_NAME_FOR_LIST_FLAVOR_IN_LIST);}if(l.template==="sap.ovp.cards.linklist"&&l.staticContent){j(m);m.setProperty("/lineItemId","linkListItem--1");}this.setVisibilityForFormElements(l);var v=new sap.ui.model.json.JSONModel(this.oVisibility);var p=new sap.ui.view("settingsView",{viewName:"sap.ovp.cards.rta.SettingsDialog",type:sap.ui.core.mvc.ViewType.XML,preprocessors:{xml:{bindingContexts:{ovpCardProperties:m.createBindingContext("/")},models:{ovpCardProperties:m}}}});p.setModel(m);p.setModel(n,"ovplibResourceBundle");p.setModel(v,"visibility");if(h(o.getComponentInstance())){b(o.getComponentInstance(),p,this.dialogBox);}else{this.dialogBox.addContent(p);}var t=o.getDomRef().offsetHeight;p.loaded().then(function(V){var L=o.getComponentInstance().getComponentData().appComponent.getRootControl().getController().getLayout();V.byId('dialogCard').setWidth(L.getColumnWidth(L.columnStyle)+"rem");a(o,V);V.byId("dialogCard").setHeight(t+"px");r(this.dialogBox);}.bind(this));}.bind(this));}};return S;},true);
