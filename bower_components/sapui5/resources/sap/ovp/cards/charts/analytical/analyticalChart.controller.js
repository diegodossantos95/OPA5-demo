(function(){"use strict";sap.ui.controller("sap.ovp.cards.charts.analytical.analyticalChart",{onInit:function(){sap.ovp.cards.charts.VizAnnotationManager.formatChartAxes();},onBeforeRendering:function(){if(this.bCardProcessed){return;}sap.ovp.cards.charts.VizAnnotationManager.validateCardConfiguration(this);var v=this.getView().byId("analyticalChart");var c=this.getOwnerComponent().getComponentData();if(this.getCardPropertiesModel().getProperty("/layoutDetail")==="resizable"&&c.appComponent){var d=c.appComponent.getDashboardLayoutUtil();var C=d.dashboardLayoutModel.getCardById(c.cardId);if(C.dashboardLayout.autoSpan&&v){v.setHeight("340px");}}var a=this.getView().byId("vbLayout");var n;var i=false;var D=new sap.viz.ui5.data.FlattenedDataset({data:{path:"/"}});this.isVizPropSet=i;this.oDataSet=D;this.vizFrame=v;this.vbLayout=a;if(!v){jQuery.sap.log.error(sap.ovp.cards.charts.VizAnnotationManager.constants.ERROR_NO_CHART+": ("+this.getView().getId()+")");}else{this.vbLayout.setBusy(true);n=v.getModel('ovpCardProperties').getProperty("/navigation");if(n===undefined||n=="datapointNav"||n!="headerNav"){sap.ovp.cards.charts.VizAnnotationManager.getSelectedDataPoint(v,this);}v.destroyDataset();var b=v.getParent().getBinding("data");this._handleKPIHeader();if(b&&b.getPath()){b.attachDataReceived(jQuery.proxy(this.onDataReceived,this));b.attachDataRequested(jQuery.proxy(this.onDataRequested,this));}else{var e=sap.ui.xmlfragment("sap.ovp.cards.charts.generic.noData");var f=this.getCardContentContainer();f.removeAllItems();f.addItem(e);}}this.bCardProcessed=true;},onAfterRendering:function(){var c=this.getOwnerComponent().getComponentData();if(this.getCardPropertiesModel().getProperty("/layoutDetail")==="resizable"&&c.appComponent){var d=c.appComponent.getDashboardLayoutUtil();var C=d.getCardDomId(c.cardId);var o=d.dashboardLayoutModel.getCardById(c.cardId);var e=document.getElementById(C);var h=this.getHeaderHeight();e.getElementsByClassName('sapOvpWrapper')[0].style.height=o.dashboardLayout.rowSpan*d.ROW_HEIGHT_PX+2-(h+2*d.CARD_BORDER_PX)+"px";if(o.dashboardLayout.showOnlyHeader){e.classList.add("sapOvpMinHeightContainer");}var v=this.getView().byId("analyticalChart");if(v){v.setHeight(this._calculateVizFrameHeight()+"px");}}},onDataReceived:function(e){var t=this;var a=this.getView().byId("analyticalChart");var b=this.getView().byId("bubbleText");var c=this.getView().byId("ovpCT");var d=sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("BUBBLESIZE");this.oDataSet.bindData("analyticalmodel>/","");a.setDataset(this.oDataSet);var h=a.getParent();if(!this.isVizPropSet){sap.ovp.cards.charts.VizAnnotationManager.buildVizAttributes(a,h,c);this.isVizPropSet=true;if(b!=undefined){var f=a.getFeeds();jQuery.each(f,function(i,v){if(f[i].getUid()=="bubbleWidth"){b.setText(d+" "+f[i].getValues());}});}sap.ovp.cards.charts.VizAnnotationManager.hideDateTimeAxis(a);}if(this.bFlag==true){this.bFlag=false;this.vbLayout.setBusy(false);}else{setTimeout(function(){t.vbLayout.setBusy(false);},0);}sap.ovp.cards.charts.VizAnnotationManager.checkNoData(e,this.getCardContentContainer(),a);},onDataRequested:function(){this.vbLayout.setBusy(true);},getCardItemsBinding:function(){var v=this.getView().byId("analyticalChart");if(v&&v.getDataset()&&v.getDataset().getBinding("data")){this.vbLayout.setBusy(false);}if(v&&v.getParent()){return v.getParent().getBinding("data");}return null;},resizeCard:function(n){var c=this.getCardPropertiesModel();this.newCardLayout=n;c.setProperty("/cardLayout/rowSpan",n.rowSpan);c.setProperty("/cardLayout/colSpan",n.colSpan);var C=this.getCardPropertiesModel().getProperty("/cardLayout");var h=this.getHeaderHeight();jQuery(this.getView().$()).find(".sapOvpWrapper").css({height:(n.rowSpan*C.iRowHeightPx+2)-(h+2*C.iCardBorderPx)+"px"});var a=this.getView().byId("analyticalChart");var b=this.getView().byId("bubbleText");var d=this.getView().byId("ovpCT");if(a.getVizType()==='timeseries_bubble'||a.getVizType()==="bubble"){if(C.colSpan>1){b.setVisible(false);}else{b.setVisible(true);}}if(a){a.setHeight(this._calculateVizFrameHeight()+"px");a.setWidth(+n.width.split("px")[0]-32+"px");}var o=this.getView().byId('ovpCardContentContainer').getDomRef();if(o){if(!n.showOnlyHeader){o.classList.remove('sapOvpContentHidden');}else{o.classList.add('sapOvpContentHidden');}}var e=sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("BUBBLESIZE");this.oDataSet.bindData("analyticalmodel>/","");this.vizFrame.setDataset(this.oDataSet);var f=a.getParent();if(!this.isVizPropSet){sap.ovp.cards.charts.VizAnnotationManager.buildVizAttributes(a,f,d);this.isVizPropSet=true;if(b!=undefined){var g=a.getFeeds();jQuery.each(g,function(i,v){if(g[i].getUid()=="bubbleWidth"){b.setText(e+" "+g[i].getValues());}});}sap.ovp.cards.charts.VizAnnotationManager.hideDateTimeAxis(a);}sap.ovp.cards.charts.VizAnnotationManager.reprioritizeContent(this.newCardLayout,a);},_calculateVizFrameHeight:function(){var v;var c=this.getOwnerComponent().getComponentData();var d=this.getDashboardLayoutUtil();var C=d.dashboardLayoutModel.getCardById(c.cardId);var a=this.getView().byId("analyticalChart");if(C){var g=this.getView().getController();var D=this.getItemHeight(g,'toolbar');var h=this.getHeaderHeight();var i=this.getView().byId("ovpCT")?20:0;var b=(a.getVizType()==='timeseries_bubble'||a.getVizType()==="bubble")&&C.dashboardLayout.colSpan===1?43:0;v=C.dashboardLayout.rowSpan*d.ROW_HEIGHT_PX+2-(h+2*d.CARD_BORDER_PX+D+i+b+30);}return v;},refreshCard:function(){this.getView().rerender();}});})();
