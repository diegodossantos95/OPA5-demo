(function(){"use strict";jQuery.sap.declare("sap.ovp.cards.charts.Utils");sap.ovp.cards.charts.Utils=sap.ovp.cards.charts.Utils||{};sap.ovp.cards.charts.Utils.constants={CHART_QUALIFIER_KEY:"chartAnnotationPath",SELVAR_QUALIFIER_KEY:"selectionAnnotationPath",PREVAR_QUALIFIER_KEY:"presentationAnnotationPath",ERROR_NO_CHART:"Analytic cards require valid \"chartAnnotationPath\" "+"configured in manifest.json",LABEL_KEY:"sap:label",TEXT_KEY:"sap:text",TYPE_KEY:"type"};sap.ovp.cards.charts.Utils.getQualifier=function(c,a){if(!a){return"";}var s=c.getSetting('ovpCardProperties');if(!s){return"";}var S=s.oData;if(!S){return"";}var f=S&&S[a]?S[a]:"";return f===""?"":f.split("#")[1];};sap.ovp.cards.charts.Utils.wrapInBraces=function(w){return"{"+w+"}";};sap.ovp.cards.charts.Utils.getSapLabel=function(p){var e=this.getModel('ovpCardProperties').getProperty("/entityType");var l=sap.ovp.cards.charts.Utils.getAllColumnLabels(e)[p];return l?l:p;};sap.ovp.cards.charts.Utils.formDimensionPath=function(d){var r="{"+d+"}";var e=this.getModel('ovpCardProperties').getProperty("/entityType");if(!e){return r;}var a=sap.ovp.cards.charts.Utils.getEdmTypeOfAll(e);if(!a||!a[d]){return r;}var t=a[d];if(t=="Edm.DateTime"){return"{path:'"+d+"', formatter: 'sap.ovp.cards.charts.VizAnnotationManager.returnDateFormat'}";}var c=sap.ovp.cards.charts.Utils.getAllColumnTexts(e);if(!c){return r;}r="{"+(c[d]||d)+"}";return r;};sap.ovp.cards.charts.Utils.getAllColumnProperties=function(p,e){var f={};var a=e.property;for(var i=0,l=a.length;i<l;i++){if(a[i].hasOwnProperty(p)&&p=="com.sap.vocabularies.Common.v1.Label"){f[a[i].name]=a[i][p].String;}else if(a[i].hasOwnProperty(p)){f[a[i].name]=a[i][p];}else{f[a[i].name]=a[i].name;}}return f;};sap.ovp.cards.charts.Utils.getAllColumnLabels=function(e){return sap.ovp.cards.charts.Utils.getAllColumnProperties("com.sap.vocabularies.Common.v1.Label",e);};sap.ovp.cards.charts.Utils.getAllColumnTexts=function(e){return sap.ovp.cards.charts.Utils.getAllColumnProperties("sap:text",e);};sap.ovp.cards.charts.Utils.getEdmTypeOfAll=function(e){return sap.ovp.cards.charts.Utils.getAllColumnProperties("type",e);};sap.ovp.cards.charts.Utils.LineChart=sap.ovp.cards.charts.Utils.LineChart||{};sap.ovp.cards.charts.Utils.LineChart.categoryAxisFeedList={};sap.ovp.cards.charts.Utils.LineChart.getVizProperties=function(c,a,b){var r=sap.ovp.cards.charts.Utils.LineChart.getValueAxisFeed(c,b).split(",");var e=sap.ovp.cards.charts.Utils.LineChart.getCategoryAxisFeed(c,a).split(",");var v=[];jQuery.each(r,function(i,m){v.push(m);});var f=[];jQuery.each(e,function(i,d){f.push(d);});var D=true;var n=c.getSetting("ovpCardProperties").getProperty("/navigation");if(n=="chartNav"){D=false;}var D=D?false:true;return"{ valueAxis:{  layout: { maxWidth : 0.4 }, title:{   visible:false,   text: '"+v.join(",")+"'  },  label:{   formatString:'axisFormatter'  } }, categoryAxis:{  title:{   visible:false,   text: '"+f.join(",")+"'  },  label:{   formatString:'axisFormatter'  } }, legend: {  isScrollable: false }, title: {  visible: false }, general: { groupData: false }, interaction:{  noninteractiveMode: "+D+",  selectability: {   legendSelection: false,   axisLabelSelection: false,   mode: 'EXCLUSIVE',   plotLassoSelection: false,   plotStdSelection: true  }, zoom:{   enablement: 'disabled'} } }";};sap.ovp.cards.charts.Utils.LineChart.getVizProperties.requiresIContext=true;sap.ovp.cards.charts.Utils.LineChart.getValueAxisFeed=function(c,a){var e=c.getSetting('ovpCardProperties').getProperty("/entityType");if(!e){return"";}var b=sap.ovp.cards.charts.Utils.getAllColumnLabels(e);var r=[];jQuery.each(a,function(i,m){r.push(b[m.Measure.PropertyPath]||m.Measure.PropertyPath);});return r.join(",");};sap.ovp.cards.charts.Utils.LineChart.getValueAxisFeed.requiresIContext=true;sap.ovp.cards.charts.Utils.LineChart.getCategoryAxisFeed=function(c,a){var e=c.getSetting('ovpCardProperties').getProperty("/entityType");if(!e){return"";}var b=sap.ovp.cards.charts.Utils.getAllColumnLabels(e);var r=[];var q;var f;jQuery.each(a,function(i,d){if(d.Role.EnumMember.split("/")[1]==="Category"){f=b[d.Dimension.PropertyPath];r.push(f?f:d.Dimension.PropertyPath);}});if(r.length<1){f=b[a[0].Dimension.PropertyPath];r.push(f?f:a[0].Dimension.PropertyPath);}q=sap.ovp.cards.charts.Utils.getQualifier(c,sap.ovp.cards.charts.Utils.constants.CHART_QUALIFIER_KEY);sap.ovp.cards.charts.Utils.LineChart.categoryAxisFeedList[q]=r;return r.join(",");};sap.ovp.cards.charts.Utils.LineChart.getCategoryAxisFeed.requiresIContext=true;sap.ovp.cards.charts.Utils.LineChart.getColorFeed=function(c,a){var r=[];var q;var e=c.getSetting('ovpCardProperties').getProperty("/entityType");if(!e){return"";}var b=sap.ovp.cards.charts.Utils.getAllColumnLabels(e);var f;jQuery.each(a,function(i,d){if(d.Role.EnumMember.split("/")[1]==="Series"){f=b[d.Dimension.PropertyPath];r.push(f?f:d.Dimension.PropertyPath);}});q=sap.ovp.cards.charts.Utils.getQualifier(c,sap.ovp.cards.charts.Utils.constants.CHART_QUALIFIER_KEY);r=jQuery.grep(r,function(v){if(!sap.ovp.cards.charts.Utils.LineChart.categoryAxisFeedList[q]){return true;}return v!=sap.ovp.cards.charts.Utils.LineChart.categoryAxisFeedList[q][0];});return r.join(",");};sap.ovp.cards.charts.Utils.LineChart.getColorFeed.requiresIContext=true;sap.ovp.cards.charts.Utils.LineChart.testColorFeed=function(c,d){return sap.ovp.cards.charts.Utils.LineChart.getColorFeed(c,d)!=="";};sap.ovp.cards.charts.Utils.LineChart.testColorFeed.requiresIContext=true;sap.ovp.cards.charts.Utils.BubbleChart=sap.ovp.cards.charts.Utils.BubbleChart||{};sap.ovp.cards.charts.Utils.BubbleChart.getVizProperties=function(c,d,a){var r=sap.ovp.cards.charts.Utils.BubbleChart.getValueAxisFeed(c,a).split(",");var b=sap.ovp.cards.charts.Utils.BubbleChart.getValueAxis2Feed(c,a).split(",");var v=[];jQuery.each(r,function(i,m){v.push(m);});var e=[];jQuery.each(b,function(i,m){e.push(m);});var D=true;var n=c.getSetting("ovpCardProperties").getProperty("/navigation");if(n=="chartNav"){D=false;}var D=D?false:true;return"{ valueAxis:{  layout: { maxWidth : 0.4 }, title:{ visible:true, text: '"+v.join(",")+"'  },  label:{ formatString:'axisFormatter'  } }, valueAxis2:{  title:{ visible:true, text: '"+e.join(",")+"'  },  label:{ formatString:'axisFormatter'  } }, categoryAxis:{  title:{ visible:true  },  label:{ formatString:'axisFormatter'  } }, legend: {  isScrollable: false }, title: {  visible: false }, interaction:{  noninteractiveMode: "+D+",  selectability: { legendSelection: false, axisLabelSelection: false, mode: 'EXCLUSIVE', plotLassoSelection: false, plotStdSelection: true  }, zoom:{   enablement: 'disabled'} } }";};sap.ovp.cards.charts.Utils.BubbleChart.getVizProperties.requiresIContext=true;sap.ovp.cards.charts.Utils.BubbleChart.getMeasurePriorityList=function(c,a){var o;if(!c||!c.getSetting||!(o=c.getSetting('ovpCardProperties'))){return[""];}var e=o.getProperty("/entityType");if(!e){return[""];}var b=sap.ovp.cards.charts.Utils.getAllColumnLabels(e);var r=[null,null,null];jQuery.each(a,function(i,m){if(m.Role.EnumMember.split("/")[1]==="Axis1"){if(r[0]===null){r[0]=b[m.Measure.PropertyPath]||m.Measure.PropertyPath;}else if(r[1]===null){r[1]=b[m.Measure.PropertyPath]||m.Measure.PropertyPath;}else if(r[2]==null){r[2]=b[m.Measure.PropertyPath]||m.Measure.PropertyPath;}}});jQuery.each(a,function(i,m){if(m.Role.EnumMember.split("/")[1]==="Axis2"){if(r[0]===null){r[0]=b[m.Measure.PropertyPath]||m.Measure.PropertyPath;}else if(r[1]===null){r[1]=b[m.Measure.PropertyPath]||m.Measure.PropertyPath;}else if(r[2]==null){r[2]=b[m.Measure.PropertyPath]||m.Measure.PropertyPath;}}});jQuery.each(a,function(i,m){if(m.Role.EnumMember.split("/")[1]==="Axis3"){if(r[0]===null){r[0]=b[m.Measure.PropertyPath]||m.Measure.PropertyPath;}else if(r[1]===null){r[1]=b[m.Measure.PropertyPath]||m.Measure.PropertyPath;}else if(r[2]==null){r[2]=b[m.Measure.PropertyPath]||m.Measure.PropertyPath;}}});return r;};sap.ovp.cards.charts.Utils.BubbleChart.getMeasurePriorityList.requiresIContext=true;sap.ovp.cards.charts.Utils.BubbleChart.getValueAxisFeed=function(c,m){return sap.ovp.cards.charts.Utils.BubbleChart.getMeasurePriorityList(c,m)[0];};sap.ovp.cards.charts.Utils.BubbleChart.getValueAxisFeed.requiresIContext=true;sap.ovp.cards.charts.Utils.BubbleChart.getValueAxis2Feed=function(c,m){return sap.ovp.cards.charts.Utils.BubbleChart.getMeasurePriorityList(c,m)[1];};sap.ovp.cards.charts.Utils.BubbleChart.getValueAxis2Feed.requiresIContext=true;sap.ovp.cards.charts.Utils.BubbleChart.getBubbleWidthFeed=function(c,m){return sap.ovp.cards.charts.Utils.BubbleChart.getMeasurePriorityList(c,m)[2];};sap.ovp.cards.charts.Utils.BubbleChart.getBubbleWidthFeed.requiresIContext=true;sap.ovp.cards.charts.Utils.BubbleChart.getColorFeed=function(c,a){var e=c.getSetting('ovpCardProperties').getProperty("/entityType");if(!e){return"";}var b=sap.ovp.cards.charts.Utils.getAllColumnLabels(e);var r=[];var f;jQuery.each(a,function(i,d){if(d.Role.EnumMember.split("/")[1]==="Series"){f=b[d.Dimension.PropertyPath];r.push(f?f:d.Dimension.PropertyPath);}});return r.join(",");};sap.ovp.cards.charts.Utils.BubbleChart.getColorFeed.requiresIContext=true;sap.ovp.cards.charts.Utils.BubbleChart.getShapeFeed=function(c,a){var e=c.getSetting('ovpCardProperties').getProperty("/entityType");if(!e){return"";}var b=sap.ovp.cards.charts.Utils.getAllColumnLabels(e);var r=[];var f;jQuery.each(a,function(i,d){if(d.Role.EnumMember.split("/")[1]==="Category"){f=b[d.Dimension.PropertyPath];r.push(f?f:d.Dimension.PropertyPath);}});return r.join(",");};sap.ovp.cards.charts.Utils.BubbleChart.getShapeFeed.requiresIContext=true;sap.ovp.cards.charts.Utils.BubbleChart.testColorFeed=function(c,d){return sap.ovp.cards.charts.Utils.BubbleChart.getColorFeed(c,d)!=="";};sap.ovp.cards.charts.Utils.BubbleChart.testColorFeed.requiresIContext=true;sap.ovp.cards.charts.Utils.BubbleChart.testShapeFeed=function(c,d){return sap.ovp.cards.charts.Utils.BubbleChart.getShapeFeed(c,d)!=="";};sap.ovp.cards.charts.Utils.BubbleChart.testShapeFeed.requiresIContext=true;sap.ovp.cards.charts.Utils.validateMeasuresDimensions=function(v,t){var m=null;var d=null;if(!v.getDataset()){jQuery.sap.log.error("OVP-AC: "+t+" Card Error: No Dataset defined for chart.");return false;}m=v.getDataset().getMeasures();d=v.getDataset().getDimensions();switch(t){case"Bubble":if(m.length!==3||d.length<1||!m[0].getName()||!m[1].getName()||!m[2].getName()||!d[0].getName()){jQuery.sap.log.error("OVP-AC: Bubble Card Error: Enter exactly 3 measures and at least 1 dimension.");return false;}break;case"Donut":if(m.length!==1||d.length!==1||!m[0].getName()||!d[0].getName()){jQuery.sap.log.error("OVP-AC: Donut Card Error: Enter exactly 1 measure and 1 dimension.");return false;}break;case"Line":if(m.length<1||d.length<1||!m[0].getName()||!d[0].getName()){jQuery.sap.log.error("OVP-AC: Line Card Error: Configure at least 1 dimensions and 1 measure.");return false;}break;}return true;};sap.ovp.cards.charts.Utils.getSortAnnotationCollection=function(d,p,e){if(p&&p.SortOrder&&p.SortOrder.Path&&p.SortOrder.Path.indexOf('@')>=0){var s=p.SortOrder.Path.split('@')[1];var a=d.getServiceAnnotations()[e.entityType];return a[s];}return p.SortOrder;};}());
