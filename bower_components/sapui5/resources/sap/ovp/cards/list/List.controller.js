(function(){"use strict";jQuery.sap.require("sap.ovp.cards.CommonUtils");sap.ui.controller("sap.ovp.cards.list.List",{counter:0,arrayLength:0,minMaxModel:{},onInit:function(){this.counter=0;this.minMaxModel=new sap.ui.model.json.JSONModel();this.minMaxModel.setData({minValue:0,maxValue:0});this.getView().setModel(this.minMaxModel,"minMaxModel");},onAfterRendering:function(){var i=this.getCardPropertiesModel().oData.imageSupported;var d=this.getCardPropertiesModel().oData.densityStyle;if(i&&i==="true"){var a=this.byId('ovpList');a.attachUpdateFinished(function(){var l=this.byId('ovpList');var b=l.getItems();var f=false;var g=l.getDomRef().getAttribute("class");if(d==="cozy"){g=g+" sapOvpListImageCozy";}else{g=g+" sapOvpListImageCompact";}l.getDomRef().setAttribute("class",g);b.forEach(function(j){if(j.getIcon().indexOf("icon")!=-1){f=true;}});b.forEach(function(j){var k=j.getDomRef();var m;if(k&&k.children[0]&&k.children[0].children[0]){m=k.children[0].children[0];}var n=j.getDescription();var o=j.getIcon();var t=f;var p=j.getTitle();var q=p.split(' ').map(function(v){return v?v[0].toUpperCase():"";}).join('').substring(0,2);if(o!=""&&o.indexOf("icon")==-1){f=false;}if(m&&d==="cozy"&&f===false){if(m){var g=m.getAttribute("class");g=g+" sapOvpImageCozy";m.setAttribute("class",g);}}var r="";if(f===true&&n===""){r=d==="compact"?"sapOvpListWithIconNoDescCompact":"sapOvpListWithIconNoDescCozy";}else if(f===false&&n===""){r=d==="compact"?"sapOvpListWithImageNoDescCompact":"sapOvpListWithImageNoDescCozy";}else{r=d==="compact"?"sapOvpListWithImageIconCompact":"sapOvpListWithImageIconCozy";}j.addStyleClass(r);if(k&&k.children[0]&&o===""&&k.children[0].id!=="ovpIconImagePlaceHolder"){var u=document.createElement('div');u.innerHTML=q;u.setAttribute("id","ovpIconImagePlaceHolder");u.className=f===true?"sapOvpIconPlaceHolder":"sapOvpImagePlaceHolder";if(f===false&&d==="cozy"){u.className=u.className+" sapOvpImageCozy";}k.insertBefore(u,k.children[0]);}f=t;});}.bind(this));}var c=this.getOwnerComponent().getComponentData();if(this.getCardPropertiesModel().getProperty("/layoutDetail")==="resizable"){var D=this.getDashboardLayoutUtil();var C=D.dashboardLayoutModel.getCardById(c.cardId);var h=this.getHeaderHeight();var s=D.getCardDomId(c.cardId);var e=document.getElementById(s);if(!C.dashboardLayout.autoSpan){e.getElementsByClassName('sapOvpWrapper')[0].style.height=(C.dashboardLayout.rowSpan*D.ROW_HEIGHT_PX)-(h+2*D.CARD_BORDER_PX)+"px";}if(C.dashboardLayout.showOnlyHeader){e.classList.add("sapOvpMinHeightContainer");}}},onListItemPress:function(e){if(sap.ovp.cards.CommonUtils.checkIfAPIIsUsed(this)){sap.ovp.cards.CommonUtils.onContentClicked(e);}else{var n=this.getEntityNavigationEntries(e.getSource().getBindingContext(),this.getCardPropertiesModel().getProperty("/annotationPath"));this.doNavigation(e.getSource().getBindingContext(),n[0]);}},_getMinMaxObjectFromContext:function(n){this.counter++;var e=this.getEntityType(),a=this.getCardPropertiesModel().getProperty("/annotationPath"),r=e[a],c=this.getMetaModel().createBindingContext(e.$path+"/"+a),m={minValue:0,maxValue:0};if(sap.ovp.cards.AnnotationHelper.isFirstDataPointPercentageUnit(c,r)){m.minValue=0;m.maxValue=100;return m;}var d=sap.ovp.cards.AnnotationHelper.getFirstDataPointValue(c,r),b=this.getView().byId("ovpList"),l=b.getBinding("items"),M=this.getModel(),f=l.getCurrentContexts();for(var i=0;n?i<n:i<f.length;i++){var o=M.getOriginalProperty(d,f[i]),g=parseFloat(o,10);if(g<m.minValue){m.minValue=g;}else if(g>m.maxValue){m.maxValue=g;}}return m;},_updateMinMaxModel:function(n){var m=this._getMinMaxObjectFromContext(n);this.minMaxModel.setData({minValue:m.minValue,maxValue:m.maxValue});this.minMaxModel.refresh();return m;},returnBarChartValue:function(v){var m=this._updateMinMaxModel();var V=parseFloat(v,10);if(V!==0){return V;}else if(m.maxValue==0&&m.minValue<-10){return-0.1;}else if(m.minValue==0&&m.maxValue>10){return 0.1;}return V;},getCardItemsBinding:function(){var l=this.getView().byId("ovpList");return l.getBinding("items");},getCardItemBindingInfo:function(){var l=this.getView().byId("ovpList");return l.getBindingInfo("items");},resizeCard:function(n,c){var N,a;try{var b=this.getCardItemBindingInfo();var h=this.getHeaderHeight();var o=this.getView().byId('ovpCardContentContainer').getDomRef();var a=n.rowSpan*n.iRowHeightPx-(h+c.dropDownHeight+2*n.iCardBorderPx);if(o){n.showOnlyHeader?o.classList.add('sapOvpContentHidden'):o.classList.remove('sapOvpContentHidden');o.style.height=(n.rowSpan*n.iRowHeightPx)-(h+2*n.iCardBorderPx)+"px";}N=Math.floor(a/c.itemHeight);b.length=Math.abs(N);n.noOfItems=b.length;this._updateMinMaxModel(b.length);this.getCardItemsBinding().refresh();}catch(e){jQuery.sap.log.warning("OVP resize: "+this.cardId+" catch "+e.toString());}}});})();
