// Copyright (c) 2009-2014 SAP SE, All Rights Reserved
(function(){"use strict";jQuery.sap.declare("sap.ovp.cards.AnnotationHelper");jQuery.sap.require("sap.ui.core.format.NumberFormat");jQuery.sap.require("sap.ui.core.format.DateFormat");jQuery.sap.require("sap.ovp.cards.CommonUtils");sap.ovp.cards.AnnotationHelper={};sap.ovp.cards.AnnotationHelper.formatFunctions={count:0};sap.ovp.cards.AnnotationHelper.NumberFormatFunctions={};sap.ovp.cards.AnnotationHelper.DateFormatFunctions={};sap.ovp.cards.AnnotationHelper.CurrencyFormatFunctions={};sap.ovp.cards.AnnotationHelper.criticalityConstants={StateValues:{None:"None",Negative:"Error",Critical:"Warning",Positive:"Success"},ColorValues:{None:"Neutral",Negative:"Error",Critical:"Critical",Positive:"Good"}};sap.ovp.cards.AnnotationHelper.formatterGeo=function(i,j){var k=j.Longitude.Path;var h1=j.Latitude.Path;return"{path:'"+k+"'}; {path:'"+h1+"'}"+";0";};sap.ovp.cards.AnnotationHelper.analyticRegions=function(i,j){return"{path:'"+j.CountryCode.Path+"'}";};sap.ovp.cards.AnnotationHelper.getLabelStateFromValue=function(i){var j;switch(i){case"Default":j=sap.ui.vbm.SemanticType.Default;break;case"Error":j=sap.ui.vbm.SemanticType.Error;break;case"Warning":j=sap.ui.vbm.SemanticType.Warning;break;case"Success":j=sap.ui.vbm.SemanticType.Success;break;default:j=sap.ui.vbm.SemanticType.None;break;}return j;};sap.ovp.cards.AnnotationHelper.getColorStateFromValue=function(i){var j;switch(i){case"0":j="#5E696E";break;case"1":j="#BB0000";break;case"2":j="#E78C07";break;case"3":j="#2B7D2B";break;default:j="#5E696E";break;}return j;};sap.ovp.cards.AnnotationHelper.criticalityType=function(i,j){var k=j.Criticality.Path;return"{path:'"+k+"', formatter: 'sap.ovp.cards.AnnotationHelper.getCriticalityStateFromValue' }";};sap.ovp.cards.AnnotationHelper.getCriticalityStateFromValue=function(i){var j;switch(i){case"0":j=sap.ui.vbm.SemanticType.Default;break;case"1":j=sap.ui.vbm.SemanticType.Error;break;case"2":j=sap.ui.vbm.SemanticType.Warning;break;case"3":j=sap.ui.vbm.SemanticType.Success;break;default:j=sap.ui.vbm.SemanticType.None;break;}return j;};sap.ovp.cards.AnnotationHelper.labelText=function(i,j){var k=i.getSetting('ovpCardProperties');var h1=k.getProperty('/showLabelText');if(h1==="true"){var i1=j.Address[0];if(typeof i1.country!=="undefined"){return"{path:'"+i1.country.Path+"'}";}else if(typeof i1.locality!=="undefined"){return"{path:'"+i1.locality.Path+"'}";}else if(typeof i1.street!=="undefined"){return"{path:'"+i1.street.Path+"'}";}else if(typeof i1.code!=="undefined"){return"{path:'"+i1.code.Path+"'}";}}else{return null;}};function g(i,k){if(i.getSetting){var j=i.getSetting("_ovpCache");if(j){return j[k];}}return undefined;}function s(i,k,j){if(i.getSetting){var h1=i.getSetting("_ovpCache");if(h1){h1[k]=j;}}}function a(i,j){if(!sap.ovp.cards.AnnotationHelper.formatFunctions[j]){sap.ovp.cards.AnnotationHelper.formatFunctions[j]=0;}sap.ovp.cards.AnnotationHelper.formatFunctions[j]++;var k=j+sap.ovp.cards.AnnotationHelper.formatFunctions[j];sap.ovp.cards.AnnotationHelper.formatFunctions[k]=i;return"sap.ovp.cards.AnnotationHelper.formatFunctions."+k;}function c(i,j){var k;if(j){k=j.None;if(i&&i.EnumMember){var h1=i.EnumMember;if(e(h1,'Negative')){k=j.Negative;}else if(e(h1,'Critical')){k=j.Critical;}else if(e(h1,'Positive')){k=j.Positive;}}}return k;}function b(i){if(i=="Error"){i=1;}else if(i=="Warning"){i=2;}else if(i=="Success"){i=3;}else{i=0;}return i;}function e(i,j){return i&&i.indexOf(j,i.length-j.length)!==-1;}function d(i,j,k,h1,i1,j1,k1){var l1={};l1.EnumMember="None";if(i!==undefined){i=Number(i);if(e(j,"Minimize")||e(j,"Minimizing")){if((j1!==undefined&&j1!==null)&&(h1!=undefined&&h1!=null)){if(i<=j1){l1.EnumMember="Positive";}else if(i>h1){l1.EnumMember="Negative";}else{l1.EnumMember="Critical";}}}else if(e(j,"Maximize")||e(j,"Maximizing")){if((i1!==undefined&&i1!==null)&&(k!==undefined&&k!==null)){if(i>=i1){l1.EnumMember="Positive";}else if(i<k){l1.EnumMember="Negative";}else{l1.EnumMember="Critical";}}}else if(e(j,"Target")){if((j1!==undefined&&j1!==null)&&(h1!=undefined&&h1!=null)&&(i1!==undefined&&i1!==null)&&(k!==undefined&&k!==null)){if(i>=i1&&i<=j1){l1.EnumMember="Positive";}else if(i<k||i>h1){l1.EnumMember="Negative";}else{l1.EnumMember="Critical";}}}}return c(l1,k1);}function f(i,j,k,h1){if(!i||!j){return;}i=Number(i);if(!h1&&(i-j>=0)){return"sap-icon://trend-up";}if(!k&&(i-j<=0)){return"sap-icon://trend-down";}if(j&&h1&&(i-j>=h1)){return"sap-icon://trend-up";}if(j&&k&&(i-j<=k)){return"sap-icon://trend-down";}}function h(i,j){var k=i.getPath()+"-DataFields-Sorted";var h1=g(i,k);if(!h1){var i1=l(i,j);var j1=i1.map(function(k1){return k1.Value.Path;});j1=j1.filter(function(k1){return!!k1;});h1=j.filter(function(k1){if(k1.RecordType==="com.sap.vocabularies.UI.v1.DataField"&&j1.indexOf(k1.Value.Path)===-1&&!k1.IconUrl){return true;}return false;});h1=p(h1);s(i,k,h1);}return h1;}function l(j,k){var h1=j.getPath()+"-DataPoints-Sorted";var i1=g(j,h1);if(!i1){i1=k.filter(m);i1=p(i1);var j1;for(var i=0;i<i1.length;i++){j1=j.getPath().substr(0,j.getPath().lastIndexOf("/")+1);i1[i]=j.getModel().getProperty(n(j1,i1[i]));j1="";}s(j,h1,i1);}return i1;}function m(i){if(i.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&i.Target.AnnotationPath.match(/@com.sap.vocabularies.UI.v1.DataPoint.*/)){return true;}return false;}function n(i,j){if(i&&!e(i,'/')){i+='/';}return i+j.Target.AnnotationPath.slice(1);}function o(i){var j,k;if(i["com.sap.vocabularies.UI.v1.Importance"]){j=i["com.sap.vocabularies.UI.v1.Importance"].EnumMember;switch(j){case"com.sap.vocabularies.UI.v1.ImportanceType/High":k=1;break;case"com.sap.vocabularies.UI.v1.ImportanceType/Medium":k=2;break;case"com.sap.vocabularies.UI.v1.ImportanceType/Low":k=3;break;}}else{k=4;}return k;}function p(i){if(i.length<2){return i;}var j=parseInt(i.length/2,10);var k=i.slice(0,j);var h1=i.slice(j,i.length);return q(p(k),p(h1));}function q(i,j){var k=[];while(i.length&&j.length){var h1=o(i[0]),i1=o(j[0]);if(h1<=i1){k.push(i.shift());}else{k.push(j.shift());}}while(i.length){k.push(i.shift());}while(j.length){k.push(j.shift());}return k;}function r(i,j,k){var h1=h(i,j)[k];if(h1){return y(i,h1);}return"";}function t(i,j,k){var h1=h(i,j)[k];if(h1){return h1.Label.String;}return"";}function u(i,j,k){var h1=l(i,j)[k];if(h1&&h1.Title){return h1.Title.String;}return"";}function v(i,j,k){var h1=l(i,j)[k];if(!h1){return"";}var i1=i.getSetting('ovpCardProperties');var j1=i1.getProperty("/entityType");var k1=i1.getProperty("/metaModel");return _(i,h1,j1,k1);}function w(i,j,k){var h1=l(i,j)[k];if(h1&&h1.Criticality){return true;}}function x(i,j,k){var h1=l(i,j)[k];var i1=h1.Criticality.Path;return"{path:'"+i1+"'}";}function _(i,j,k,h1){if(!j||!j.Value){return"";}var i1=i.getSetting('ovpCardProperties');var j1=false;if(i1){var k1=i1.getProperty("/ignoreSapText");j1=k1==undefined?j1:k1;}var l1=h1.getODataProperty(k,j.Value.Path);var m1=false;if(j1==true){if(l1&&(l1["com.sap.vocabularies.Analytics.v1.Measure"]||l1["sap:aggregation-role"]=="measure")){m1=true;}}if(!m1&&l1){var n1;if(l1["com.sap.vocabularies.Common.v1.Text"]){n1=l1["com.sap.vocabularies.Common.v1.Text"].String?l1["com.sap.vocabularies.Common.v1.Text"].String:l1["com.sap.vocabularies.Common.v1.Text"].Path;}else if(l1["sap:text"]){n1=l1["sap:text"];}if(n1){l1=h1.getODataProperty(k,n1);j={Value:{Path:l1.name}};}}return y(i,j);}function y(i,j,k,h1){if(j.Value.Apply){return sap.ui.model.odata.AnnotationHelper.format(i,j.Value);}var i1=i.getSetting('ovpCardProperties');var j1=i1.getProperty("/entityType");var k1=i1.getProperty("/metaModel");return z(i,j,j1,k1,k,h1);}function z(i,j,k,h1,i1,j1,k1){if(j.Value.Apply){return sap.ui.model.odata.AnnotationHelper.format(i,j.Value);}var l1=h1.getODataProperty(k,j.Value.Path),m1="",n1;if(!j1){if(j.Value.Path.split("/").length>1){l1=G(h1,k,j.Value.Path);}if(!l1){return"";}if(l1["type"]==='Edm.DateTime'||l1["type"]==='Edm.DateTimeOffset'){var o1=i.getSetting('ovpCardProperties').oData.showDateInRelativeFormat;n1=D("dateFormatFunction",o1);m1=A([j.Value.Path?j.Value.Path:l1.name],n1);}else if((j.ValueFormat&&j.ValueFormat.NumberOfFractionalDigits)||l1["scale"]){var p1=(j.ValueFormat&&j.ValueFormat.NumberOfFractionalDigits)?j.ValueFormat.NumberOfFractionalDigits.Int:0,q1;if(l1["Org.OData.Measures.V1.ISOCurrency"]){q1=l1["Org.OData.Measures.V1.ISOCurrency"].Path?l1["Org.OData.Measures.V1.ISOCurrency"].Path:l1["Org.OData.Measures.V1.ISOCurrency"].String;}else if(l1["Org.OData.Measures.V1.Unit"]){q1=l1["Org.OData.Measures.V1.Unit"].Path?l1["Org.OData.Measures.V1.Unit"].Path:l1["Org.OData.Measures.V1.Unit"].String;}else if(l1["sap:unit"]){q1=l1["sap:unit"];}var r1=q1?h1.getODataProperty(k,q1):null,s1=[j.Value.Path?j.Value.Path:l1.name];if(p1>2){p1=2;}if(l1["Org.OData.Measures.V1.ISOCurrency"]){var t1=l1["Org.OData.Measures.V1.ISOCurrency"];if(t1.Path){n1=E(p1);s1.push(t1.Path);}else if(t1.String){n1=E(p1,t1.String);}}else if(r1&&(r1["Org.OData.Measures.V1.ISOCurrency"]||r1["sap:semantics"]==="currency-code")){n1=E(p1);s1.push(q1);}else{n1=B(p1);}m1=A(s1,n1);}else{if(k1){m1=sap.ui.model.odata.AnnotationHelper.simplePath(i,j.Value);}else{m1=sap.ui.model.odata.AnnotationHelper.format(i,j.Value);}}if(l1["Org.OData.Measures.V1.Unit"]){var u1=l1["Org.OData.Measures.V1.Unit"];if(u1.Path){m1+=(" "+A([u1.Path]));}else if(u1.String){m1+=(" "+u1.String);}}}if(!i1){if(l1["Org.OData.Measures.V1.ISOCurrency"]){var t1=l1["Org.OData.Measures.V1.ISOCurrency"];if(t1.Path){m1+=(" "+A([t1.Path]));}else if(t1.String){m1+=(" "+t1.String);}}}if(m1[0]===" "){m1=m1.substring(1);}return m1;}function A(j,k){var h1="",i1=j.length;if(i1>1){h1="{parts:[";for(var i=0;i<i1;i++){h1+=("{path: '"+j[i]+"'}"+((i===i1-1)?"]":", "));}}else{h1="{path: '"+j[0]+"'";}h1+=(k?(", formatter: '"+k+"'"):"")+"}";return h1;}function B(i){var j="formatNumberCalculation"+i;if(!sap.ovp.cards.AnnotationHelper.NumberFormatFunctions[j]){sap.ovp.cards.AnnotationHelper.NumberFormatFunctions[j]=C(Number(i));}return"sap.ovp.cards.AnnotationHelper.NumberFormatFunctions."+j;}function C(i){return function(j){var k=sap.ui.core.format.NumberFormat.getFloatInstance({style:'short',showMeasure:false,minFractionDigits:i,maxFractionDigits:i});return k.format(Number(j));};}function D(i,j){var k={'relative':true,'relativeScale':'auto'};if(j!==undefined&&!j){k={'style':'medium'};}if(!sap.ovp.cards.AnnotationHelper.DateFormatFunctions[i]){sap.ovp.cards.AnnotationHelper.DateFormatFunctions[i]=function(h1){var i1=sap.ui.core.format.DateFormat.getInstance(k);if(!h1){h1="";return h1;}return i1.format(new Date(h1));};}return"sap.ovp.cards.AnnotationHelper.DateFormatFunctions."+i;}function E(i,j){var k="formatCurrencyCalculation"+(j?j+i:i);if(!sap.ovp.cards.AnnotationHelper.CurrencyFormatFunctions[k]){sap.ovp.cards.AnnotationHelper.CurrencyFormatFunctions[k]=F(i,j);}return"sap.ovp.cards.AnnotationHelper.CurrencyFormatFunctions."+k;}function F(i,j){return function(k,h1){var i1="";var j1=sap.ui.core.format.NumberFormat.getCurrencyInstance({style:'short',showMeasure:false,minFractionDigits:i,maxFractionDigits:i});if(h1){i1=j1.format(k,h1);}else{i1=j?j1.format(k,j):j1.format(k);}return i1;};}function G(j,k,h1){var i1=h1.split("/");if(i1.length>1){for(var i=0;i<(i1.length-1);i++){var j1=j.getODataAssociationEnd(k,i1[i]);if(j1){k=j.getODataEntityType(j1.type);}}return j.getODataProperty(k,i1[i1.length-1]);}}function H(i,j,k){var h1=l(i,j);var i1="None",j1=sap.ovp.cards.AnnotationHelper.criticalityConstants.StateValues;if(h1.length>k){var k1=h1[k];if(k1&&k1.Criticality){i1=K(i,k1,j1);}else{i1=M(i,k1,j1);}}return i1;}function I(i,j,k){var h1=l(i,j);if(h1&&h1.length){var i1=h1[0];if(i1&&(i1.Criticality||i1.CriticalityCalculation)){return true;}}return false;}sap.ovp.cards.AnnotationHelper.colorPaletteForComparisonMicroChart=function(i,j,k){if(I(i,j,k)){return'';}return'#5cbae6';};function J(i,j,k){var h1=l(i,j),i1="None",j1=sap.ovp.cards.AnnotationHelper.criticalityConstants.ColorValues;if(h1.length>k){var k1=h1[k];if(k1&&k1.Criticality){i1=K(i,k1,j1);}else{i1=M(i,k1,j1);}}return i1;}function K(i,j,k){var h1=sap.ui.core.ValueState.None;var i1;var j1=j.Criticality;if(j1){i1="'{'= ({0} === ''com.sap.vocabularies.UI.v1.CriticalityType/Negative'') || ({0} === ''1'') || ({0} === 1) ? ''"+k.Negative+"'' : "+"({0} === ''com.sap.vocabularies.UI.v1.CriticalityType/Critical'') || ({0} === ''2'') || ({0} === 2) ? ''"+k.Critical+"'' : "+"({0} === ''com.sap.vocabularies.UI.v1.CriticalityType/Positive'') || ({0} === ''3'') || ({0} === 3) ? ''"+k.Positive+"'' : "+"''"+k.None+"'' '}'";if(j1.Path){var k1='$'+sap.ui.model.odata.AnnotationHelper.simplePath(i,j1);h1=jQuery.sap.formatMessage(i1,k1);}else if(j1.EnumMember){var l1="'"+j1.EnumMember+"'";h1=jQuery.sap.formatMessage(i1,l1);}else{jQuery.sap.log.warning("Case not supported, returning the default sap.ui.core.ValueState.None");}}else{jQuery.sap.log.warning("Case not supported, returning the default sap.ui.core.ValueState.None");}return h1;}function L(i,j,k){var h1=l(i,j);var i1="None";if(h1.length>k){var j1=h1[k];if(j1&&j1.Criticality&&j1.Criticality.Path){i1=x(i,j,k);}else{i1=M(i,j1,sap.ovp.cards.AnnotationHelper.criticalityConstants.StateValues);i1=b(i1);}}return i1;}function M(i,j,k){var h1=k.None;if(j.Criticality){h1=c(j.Criticality,k);}else if(j.CriticalityCalculation&&j.Value&&j.Value&&j.Value.Path){h1=N(i,j,k);}return h1;}function N(i,j,k){var h1=Y(j.Value);var i1=j.CriticalityCalculation.ImprovementDirection.EnumMember;var j1=Y(j.CriticalityCalculation.DeviationRangeLowValue);var k1=Y(j.CriticalityCalculation.DeviationRangeHighValue);var l1=Y(j.CriticalityCalculation.ToleranceRangeLowValue);var m1=Y(j.CriticalityCalculation.ToleranceRangeHighValue);var n1=O(j1);var o1=O(k1);var p1=O(l1);var q1=O(m1);var r1="parts: ["+h1;r1+=n1?","+j1:"";r1+=o1?","+k1:"";r1+=p1?","+l1:"";r1+=q1?","+m1:"";r1+="]";var s1=function(){var u1=1;return d(arguments[0],i1,n1?arguments[u1++]:j1,o1?arguments[u1++]:k1,p1?arguments[u1++]:l1,q1?arguments[u1++]:m1,k);};var t1=a(s1,"formatCriticalityCalculation");return"{"+r1+", formatter: '"+t1+"'}";}function O(i){return(typeof i==="string")&&i.charAt(0)==="{";}function P(j,k,h1){var i1="";var j1=h1.split("/");if(j1.length>1){for(var i=0;i<(j1.length-1);i++){var k1=j.getODataAssociationEnd(k,j1[i]);if(k1){k=j.getODataEntityType(k1.type);if(i1){i1=i1+"/";}i1=i1+j1[i];}else{return i1;}}}return i1;}sap.ovp.cards.AnnotationHelper.formatField=function(i,j){return y(i,j);};sap.ovp.cards.AnnotationHelper.formatItems=function(i,j){var k=i.getSetting('ovpCardProperties');var h1=k.getProperty("/addODataSelect");var i1=k.getProperty("/metaModel");var j1=i1.getODataEntityType(j.entityType);var k1=j1[k.getProperty('/selectionAnnotationPath')];var l1=j1[k.getProperty('/presentationAnnotationPath')];var m1="/"+j.name;var n1=Array.prototype.slice.call(arguments,2);if(k1){if(k1&&k1.Parameters&&k1.Parameters.length>0){m1=sap.ovp.cards.AnnotationHelper.resolveParameterizedEntitySet(i.getSetting('dataModel'),j,k1);}}if(k.getProperty("/cardLayout")&&k.getProperty("/cardLayout/noOfItems")){var o1="{path: '"+m1+"', length: "+ +(k.getProperty("/cardLayout/noOfItems"));}else{var o1="{path: '"+m1+"', length: "+$(k);}var p1=[];if(h1){p1=R(i,i1,j1,n1);}var q1=Q(i1,j1,n1);if(p1.length>0||q1.length>0){o1=o1+", parameters: {";if(p1.length>0){o1=o1+"select: '"+p1.join(',')+"'";}if(q1.length>0){if(p1.length>0){o1=o1+", ";}o1=o1+"expand: '"+q1.join(',')+"'";}o1=o1+"}";}var r1=T(k,l1);if(r1.length>0){o1=o1+", sorter:"+JSON.stringify(r1);}var s1=V(k,k1);if(s1.length>0){o1=o1+", filters:"+JSON.stringify(s1);}o1=o1+"}";return o1;};function Q(k,h1,i1){var j1=[];var k1,l1,m1,n1;for(var i=0;i<i1.length;i++){if(!i1[i]){continue;}k1=h1.$path+"/"+i1[i];l1=k.createBindingContext(k1);m1=l1.getObject();m1=m1?m1:[];for(var j=0;j<m1.length;j++){if(m1[j].Value&&m1[j].Value.Path){n1=P(k,h1,m1[j].Value.Path);if(n1&&j1.indexOf(n1)===-1){j1.push(n1);}}}}return j1;}function R(h1,i1,j1,k1){var l1=[];var m1,n1,o1;for(var i=0;i<k1.length;i++){if(!k1[i]){continue;}m1=j1.$path+"/"+k1[i];n1=i1.createBindingContext(m1);var p1={};if(h1&&h1.bDummyContext){jQuery.extend(p1,h1,n1,true);}else{p1=h1;}o1=n1.getObject();if(!o1){o1=[];}else if(jQuery.isPlainObject(o1)){if(o1.Data){o1=o1.Data;}else{o1=[];}}var q1;var r1;var s1;var t1;for(var j=0;j<o1.length;j++){r1=[];q1=o1[j];s1="";t1=q1.RecordType;if(t1==="com.sap.vocabularies.UI.v1.DataField"){s1=z(p1,q1,j1,i1,undefined,undefined,true);}else if(t1==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"){var u1=n(j1.$path,q1);s1=_(p1,i1.getProperty(u1),j1,i1);}else if(t1==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"&&q1.Url){var v1;if(!q1.Url.UrlRef){v1=sap.ui.model.odata.AnnotationHelper.format(p1,q1.Url);}if(v1&&v1.substring(0,2)==="{="){s1=v1;}}if(s1){r1=S(s1);}if(r1&&r1.length>0){var w1;for(var k=0;k<r1.length;k++){w1=r1[k];if(!l1[w1]){l1[w1]=true;var x1=sap.ovp.cards.CommonUtils.getUnitColumn(w1,j1);if(x1&&x1!==w1){l1[x1]=true;}var y1=f1(i1,j1,w1);if(y1&&y1!==w1){l1[y1]=true;}}}}}}return Object.keys(l1);}function S(i){var j=/\${([a-zA-Z0-9\_|\/]*)/g;var k=/[^[{]*[a-zA-Z0-9\_]/g;var h1=/path *\: *\'([a-zA-Z0-9\_]+)*\'/g;var i1,j1,k1=[];if(i.indexOf("{parts:[")!==-1){i=i.replace("{parts:[","");}if(i.substring(0,2)==="{="){i1=j;j1=1;}else if(i.indexOf("path")!==-1){var l1=k.exec(i);while(l1){if(l1[0].indexOf("path")===-1){k1.push(l1[0]);}l1=k.exec(i);}i1=h1;j1=1;}else{i1=k;j1=0;}var m1=i1.exec(i);while(m1){if(m1[j1]){k1.push(m1[j1]);}m1=i1.exec(i);}return k1;}function T(j,k){var h1=[];var i1,j1;var k1=j.getProperty("/sortBy");if(k1){var l1=j.getProperty('/sortOrder');if(l1&&l1.toLowerCase()!=='descending'){j1=false;}else{j1=true;}i1={path:k1,descending:j1};h1.push(i1);}var m1=k&&k.SortOrder||undefined;var n1,k1;if(m1){for(var i=0;i<m1.length;i++){n1=m1[i];k1=n1.Property.PropertyPath;j1=W(n1.Descending,true);i1={path:k1,descending:j1};h1.push(i1);}}return h1;}sap.ovp.cards.AnnotationHelper.getCardSelections=function(i){var j=i.getProperty('/entityType');var k=j[i.getProperty('/selectionAnnotationPath')];return{filters:V(i,k),parameters:U(k)};};sap.ovp.cards.AnnotationHelper.getCardSorters=function(i){var j=i.getProperty('/entityType');var k=j[i.getProperty('/presentationAnnotationPath')];return T(i,k);};function U(j){var k,h1=[];if(!j||!j.Parameters){return h1;}var i1=j.Parameters.length;for(var i=0;i<i1;i++){k=j.Parameters[i];if(!k.PropertyName||!k.PropertyName.PropertyPath){continue;}if(!k.PropertyValue){jQuery.sap.log.error("Missing value for parameter "+k.PropertyName.PropertyPath);continue;}h1[h1.length]={path:k.PropertyName.PropertyPath,value:sap.ovp.cards.AnnotationHelper.getPrimitiveValue(k.PropertyValue)};}return h1;}function V(k,h1){var i1=[];var j1;var k1=k.getProperty("/filters");if(k1){i1=i1.concat(k1);}if(h1&&h1.SelectOptions){j1=h1.SelectOptions;}else{j1=h1;}var l1,m1,n1;if(j1){for(var i=0;i<j1.length;i++){l1=j1[i];m1=l1.PropertyName.PropertyPath;for(var j=0;j<l1.Ranges.length;j++){n1=l1.Ranges[j];if(n1.Sign.EnumMember){var o1={path:m1,operator:n1.Option.EnumMember.split("/")[1],value1:sap.ovp.cards.AnnotationHelper.getPrimitiveValue(n1.Low),value2:sap.ovp.cards.AnnotationHelper.getPrimitiveValue(n1.High),sign:n1.Sign.EnumMember==="com.sap.vocabularies.UI.v1.SelectionRangeSignType/I"?"I":"E"};if(o1.sign==="E"&&o1.operator!==sap.ui.model.FilterOperator.EQ){jQuery.sap.log.error("Exclude sign is supported only with EQ operator");continue;}if(o1.sign==="E"&&o1.operator===sap.ui.model.FilterOperator.EQ){o1.operator=sap.ui.model.FilterOperator.NE;o1.sign="I";}i1.push(o1);}}}}return i1;}function W(i,j){if(i&&i.Boolean){if(i.Boolean.toLowerCase()==="true"){return true;}else if(i.Boolean.toLowerCase()==="false"){return false;}}else if(i&&i.Bool){if(i.Bool.toLowerCase()==="true"){return true;}else if(i.Bool.toLowerCase()==="false"){return false;}}return j;}function X(i){var j;if(i){if(i.String){j=Number(i.String);}else if(i.Int){j=Number(i.Int);}else if(i.Decimal){j=Number(i.Decimal);}else if(i.Double){j=Number(i.Double);}else if(i.Single){j=Number(i.Single);}}return j;}sap.ovp.cards.AnnotationHelper.getPrimitiveValue=function(i){var j;if(i){if(i.String||i.String===""){j=i.String;}else if(i.Boolean||i.Bool){j=W(i);}else{j=X(i);}}return j;};function Y(i){if(i){if(i.Path){return"{path:'"+i.Path+"'}";}else{return sap.ovp.cards.AnnotationHelper.getPrimitiveValue(i);}}else{return"";}}var Z={"List_condensed":{phone:5,tablet:5,desktop:5},"List_extended":{phone:3,tablet:3,desktop:3},"List_condensed_bar":{phone:5,tablet:5,desktop:5},"List_extended_bar":{phone:3,tablet:3,desktop:3},"Table":{phone:5,tablet:5,desktop:5},"Stack_simple":{phone:20,tablet:20,desktop:20},"Stack_complex":{phone:5,tablet:5,desktop:5}};function $(i){var j=i.getProperty('/contentFragment');var k=i.getProperty('/listType');var h1=i.getProperty('/listFlavor');var i1;var j1="desktop";if(sap.ui.Device.system.phone){j1="phone";}else if(sap.ui.Device.system.tablet){j1="tablet";}if(j=="sap.ovp.cards.list.List"){if(k=="extended"){if(h1=="bar"){i1=Z["List_extended_bar"];}else{i1=Z["List_extended"];}}else if(h1=="bar"){i1=Z["List_condensed_bar"];}else{i1=Z["List_condensed"];}}else if(j=="sap.ovp.cards.table.Table"){i1=Z["Table"];}else if(j=="sap.ovp.cards.stack.Stack"){if(i.getProperty('/objectStreamCardsNavigationProperty')){i1=Z["Stack_complex"];}else{i1=Z["Stack_simple"];}}if(i1){return i1[j1];}return 5;}sap.ovp.cards.AnnotationHelper.removeDuplicateDataField=function(i){var j=i.getObject();var k=l(i,j);var h1=k.map(function(i1){return i1.Value.Path;});j.filter(function(i1,j1){if(i1.RecordType==="com.sap.vocabularies.UI.v1.DataField"&&h1.indexOf(i1.Value.Path)>-1){j.splice(j1,1);}});};sap.ovp.cards.AnnotationHelper.formatUrl=function(i,j){if(j.charAt(0)==='/'||j.indexOf("http")===0){return j;}var k=i.getModel().getProperty("/baseUrl");if(k){return k+"/"+j;}return j;};sap.ovp.cards.AnnotationHelper.getDataPointsCount=function(i,j){var k=l(i,j);return k.length;};sap.ovp.cards.AnnotationHelper.getFirstDataPointValue=function(i,j){return sap.ovp.cards.AnnotationHelper.getDataPointValue(i,j,0);};sap.ovp.cards.AnnotationHelper.getSecondDataPointValue=function(i,j){return sap.ovp.cards.AnnotationHelper.getDataPointValue(i,j,1);};sap.ovp.cards.AnnotationHelper.getDataPointValue=function(i,j,k){var h1=l(i,j),i1=h1[k];if(i1&&i1.Value&&i1.Value.Path){return i1.Value.Path;}return"";};sap.ovp.cards.AnnotationHelper.getFirstDataFieldName=function(i,j){return t(i,j,0);};sap.ovp.cards.AnnotationHelper.getSecondDataFieldName=function(i,j){return t(i,j,1);};sap.ovp.cards.AnnotationHelper.getThirdDataFieldName=function(i,j){return t(i,j,2);};sap.ovp.cards.AnnotationHelper.getFourthDataFieldName=function(i,j){return t(i,j,3);};sap.ovp.cards.AnnotationHelper.getFifthDataFieldName=function(i,j){return t(i,j,4);};sap.ovp.cards.AnnotationHelper.formatFirstDataFieldValue=function(i,j){return r(i,j,0);};sap.ovp.cards.AnnotationHelper.formatSecondDataFieldValue=function(i,j){return r(i,j,1);};sap.ovp.cards.AnnotationHelper.formatThirdDataFieldValue=function(i,j){return r(i,j,2);};sap.ovp.cards.AnnotationHelper.formatFourthDataFieldValue=function(i,j){return r(i,j,3);};sap.ovp.cards.AnnotationHelper.formatFifthDataFieldValue=function(i,j){return r(i,j,4);};sap.ovp.cards.AnnotationHelper.formatSixthDataFieldValue=function(i,j){return r(i,j,5);};sap.ovp.cards.AnnotationHelper.formatsemanticObjectOfDataFieldGeneric=function(i,j,k){return b1(i,j,k);};sap.ovp.cards.AnnotationHelper.getFirstDataPointName=function(i,j){return u(i,j,0);};sap.ovp.cards.AnnotationHelper.getSecondDataPointName=function(i,j){return u(i,j,1);};sap.ovp.cards.AnnotationHelper.getThirdDataPointName=function(i,j){return u(i,j,2);};sap.ovp.cards.AnnotationHelper.formatFirstDataPointValue=function(i,j){return v(i,j,0);};sap.ovp.cards.AnnotationHelper.formatImageUrl=function(j,k){for(var i=0;i<k.length;i++){var h1=k[i];if(h1.RecordType==="com.sap.vocabularies.UI.v1.DataField"){if(h1.IconUrl&&h1.IconUrl.String.indexOf('//')!=-1){return h1.IconUrl.String;}if(h1.IconUrl&&h1.Value&&h1.Value.Path){return sap.ui.model.odata.AnnotationHelper.simplePath(j,h1.Value);}}}};sap.ovp.cards.AnnotationHelper.formatSecondDataPointValue=function(i,j){return v(i,j,1);};sap.ovp.cards.AnnotationHelper.formatThirdDataPointValue=function(i,j){return v(i,j,2);};sap.ovp.cards.AnnotationHelper.formatFirstDataPointState=function(i,j){return H(i,j,0);};sap.ovp.cards.AnnotationHelper.formatFirstDataPointColor=function(i,j){return J(i,j,0);};sap.ovp.cards.AnnotationHelper.formatSecondDataPointState=function(i,j){return H(i,j,1);};sap.ovp.cards.AnnotationHelper.formatThirdDataPointState=function(i,j){return H(i,j,2);};sap.ovp.cards.AnnotationHelper.formatFirstDataPointStateForSmartField=function(i,j){return L(i,j,0);};sap.ovp.cards.AnnotationHelper.formatKPIHeaderState=function(i,j){return M(i,j,sap.ovp.cards.AnnotationHelper.criticalityConstants.ColorValues);};sap.ovp.cards.AnnotationHelper.isFirstDataPointCriticality=function(i,j){return w(i,j,0);};sap.ovp.cards.AnnotationHelper.isSecondDataPointCriticality=function(i,j){return w(i,j,1);};sap.ovp.cards.AnnotationHelper.isThirdDataPointCriticality=function(i,j){return w(i,j,2);};sap.ovp.cards.AnnotationHelper.getSortedDataFields=function(i,j){return h(i,j);};sap.ovp.cards.AnnotationHelper.getSortedDataPoints=function(i,j){return l(i,j);};function a1(i,j){var k=i.getPath();var h1=k.slice(0,k.lastIndexOf("/"));h1=h1.slice(0,h1.lastIndexOf("/"));var i1=n(h1,j);j=i.getModel().getProperty(i1);return j;}sap.ovp.cards.AnnotationHelper.formatDataFieldValueGeneric=function(i,j){if(!j){return"";}return y(i,j);};function b1(j,k,h1,i1){var j1;var k1=i1==undefined?h1:h(j,h1)[i1];var l1=j.getSetting('ovpCardProperties');var m1=l1.getProperty("/metaModel");var n1=m1.getODataEntityType(k.entityType);var o1=n1.property;if(o1){for(var i=0;i<o1.length;i++){if(k1.Value.Path===o1[i].name){j1=o1[i]["com.sap.vocabularies.Common.v1.SemanticObject"];if(j1){return sap.ui.model.odata.AnnotationHelper.format(j,j1);}else{return"";}}}}}sap.ovp.cards.AnnotationHelper.checkForSemanticObjectAnnotation=function(i,j,k){return sap.ovp.cards.AnnotationHelper.formatsemanticObjectOfDataFieldGeneric(i,j,k);};sap.ovp.cards.AnnotationHelper.formatDataPointValue=function(i,j){if(!j){return"";}var k=i.getSetting('ovpCardProperties');var h1=k.getProperty("/entityType");var i1=k.getProperty("/metaModel");var j1=jQuery.extend({},j);var k1=jQuery.extend({},i);j=a1(k1,j1);return _(i,j,h1,i1);};sap.ovp.cards.AnnotationHelper.formatDataPointStateGeneric=function(i,j){var k=jQuery.extend({},j);var h1=jQuery.extend({},i);var i1="None",j1=sap.ovp.cards.AnnotationHelper.criticalityConstants.StateValues;j=a1(h1,k);if(j&&j.Criticality){i1=K(i,j,j1);}else{i1=M(i,j,j1);}return i1;};sap.ovp.cards.AnnotationHelper.checkCriticalityGeneric=function(i,j){var k=jQuery.extend({},j);var h1=jQuery.extend({},i);j=a1(h1,k);if(j&&j.Criticality){return true;}};sap.ovp.cards.AnnotationHelper.formatDataPointStateForSmartFieldGeneric=function(i,j){var k=jQuery.extend({},j);var h1=jQuery.extend({},i);j=a1(h1,k);var i1="None";if(j&&j.Criticality&&j.Criticality.Path){i1="{path:'"+j.Criticality.Path+"'}";}else{i1=M(i,j,sap.ovp.cards.AnnotationHelper.criticalityConstants.StateValues);i1=b(i1);}return i1;};sap.ovp.cards.AnnotationHelper.hasActions=function(j,k){var h1;for(var i=0;i<k.length;i++){h1=k[i];if(h1.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"||h1.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAction"||h1.RecordType==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"){return 1;}}return 0;};sap.ovp.cards.AnnotationHelper.isFirstDataPointPercentageUnit=function(i,j){var k=l(i,j)[0];if(k&&k.Value&&k.Value.Path){var h1=i.getPath().substr(0,i.getPath().lastIndexOf("/")+1);var i1=i.getModel();var j1=i1.getProperty(h1);var k1=i1.getODataProperty(j1,k.Value.Path);if(k1&&k1["Org.OData.Measures.V1.Unit"]){return k1["Org.OData.Measures.V1.Unit"].String==="%";}}return false;};sap.ovp.cards.AnnotationHelper.resolveEntityTypePath=function(i){var j=i.getObject();var k=i.getModel();var h1=k.getProperty("/metaModel");var i1=h1.getODataEntitySet(k.getProperty("/entitySet"));var j1=h1.getODataEntityType(i1.entityType);j=j1.$path+"/"+j;return h1.createBindingContext(j);};sap.ovp.cards.AnnotationHelper.resolveParameterizedEntitySet=function(i,j,k){jQuery.sap.require("sap.ui.model.analytics.odata4analytics");var h1="";var i1=new sap.ui.model.analytics.odata4analytics.Model(sap.ui.model.analytics.odata4analytics.Model.ReferenceByModel(i));var j1=i1.findQueryResultByName(j.name);if(!j1){h1="/"+j.name;jQuery.sap.log.error("findQueryResultByName","Entity Set not found in the QueryResultRequest");return h1;}var k1=new sap.ui.model.analytics.odata4analytics.QueryResultRequest(j1);var l1=j1.getParameterization();if(l1){var m1;k1.setParameterizationRequest(new sap.ui.model.analytics.odata4analytics.ParameterizationRequest(l1));jQuery.each(k.Parameters,function(){if(this.RecordType==="com.sap.vocabularies.UI.v1.IntervalParameter"){m1=this.PropertyNameFrom.PropertyPath.split("/");k1.getParameterizationRequest().setParameterValue(m1[m1.length-1],this.PropertyValueFrom.String,this.PropertyValueTo.String);}else{m1=this.PropertyName.PropertyPath.split("/");k1.getParameterizationRequest().setParameterValue(m1[m1.length-1],this.PropertyValue.String);}});}try{h1=k1.getURIToQueryResultEntitySet();}catch(n1){j1=k1.getQueryResult();h1="/"+j1.getEntitySet().getQName();jQuery.sap.log.error("getEntitySetPathWithParameters","binding path with parameters failed - "+n1||n1.message);}return h1;};sap.ovp.cards.AnnotationHelper.getAssociationObject=function(j,k,ns){var h1=j.getServiceMetadata().dataServices.schema[0].association;for(var i=0;i<h1.length;i++){if(ns+"."+h1[i].name===k){return h1[i];}}};sap.ovp.cards.AnnotationHelper.getAggregateNumber=function(i,j,k,h1){var i1,j1,k1;if(k&&k.Value&&k.Value.Path){i1=k.Value.Path;}else if(k&&k.Description&&k.Description.Value&&k.Description.Value.Path){i1=k.Description.Value.Path;}if(k&&k.Description&&k.Description.Path){j1=k.Description.Path;}else if(k&&k.Title&&k.Title.Path){k1=k.Title.Path;}var l1="";var m1=h1&&h1.Parameters;var n1="";if(m1){var o1=i.getSetting("dataModel");var p1=sap.ovp.cards.AnnotationHelper.resolveParameterizedEntitySet(o1,j,h1);l1+="{path: '"+p1+"'";}else{l1+="{path: '/"+j.name+"'";}l1+=", length: 1";var q1=i.getSetting('ovpCardProperties');var r1=q1.getProperty("/entityType");var s1=sap.ovp.cards.CommonUtils.getUnitColumn(i1,r1);var t1=V(q1,h1);if(t1.length>0){n1+=", filters: "+JSON.stringify(t1);}var u1=[];u1.push(i1);if(j1){u1.push(j1);}else if(k1){u1.push(k1);}if(k&&k.CriticalityCalculation&&k.CriticalityCalculation.DeviationRangeLowValue&&k.CriticalityCalculation.DeviationRangeLowValue.Path){u1.push(k.CriticalityCalculation.DeviationRangeLowValue.Path);}if(k&&k.CriticalityCalculation&&k.CriticalityCalculation.ToleranceRangeLowValue&&k.CriticalityCalculation.ToleranceRangeLowValue.Path){u1.push(k.CriticalityCalculation.ToleranceRangeLowValue.Path);}if(k&&k.CriticalityCalculation&&k.CriticalityCalculation.DeviationRangeHighValue&&k.CriticalityCalculation.DeviationRangeHighValue.Path){u1.push(k.CriticalityCalculation.DeviationRangeHighValue.Path);}if(k&&k.CriticalityCalculation&&k.CriticalityCalculation.ToleranceRangeHighValue&&k.CriticalityCalculation.ToleranceRangeHighValue.Path){u1.push(k.CriticalityCalculation.ToleranceRangeHighValue.Path);}if(s1){u1.push(s1);}if(k&&k.TrendCalculation&&k.TrendCalculation.ReferenceValue&&k.TrendCalculation.ReferenceValue.Path){u1.push(k.TrendCalculation.ReferenceValue.Path);}return l1+", parameters:{select:'"+u1.join(",")+"'}"+n1+"}";};sap.ovp.cards.AnnotationHelper.KpiValueFormatter=function(k){if(isNaN(k)){return k;}var i,j,h1=false;if(this.oPropagatedProperties.oModels.ovpCardProperties.oData.NumberOfFractionalDigits){i=Number(this.oPropagatedProperties.oModels.ovpCardProperties.oData.NumberOfFractionalDigits);}if(this.oPropagatedProperties.oModels.ovpCardProperties.oData.percentageAvailable){h1=true;}if(!i||i<0){i=0;}else if(i>2){i=2;}j=k;if(k){var i1=sap.ui.core.format.NumberFormat.getFloatInstance({minFractionDigits:i,maxFractionDigits:i,style:"short",showScale:true,shortRefNumber:j});if(h1){return i1.format(Number(k))+" %";}else{return i1.format(Number(k));}}};sap.ovp.cards.AnnotationHelper.formThePathForAggregateNumber=function(i){if(!i||!i.Value||!i.Value.Path){return"";}if(i&&i.ValueFormat&&i.ValueFormat.NumberOfFractionalDigits&&i.ValueFormat.NumberOfFractionalDigits.Int){this.getModel("ovpCardProperties").oData.NumberOfFractionalDigits=i.ValueFormat.NumberOfFractionalDigits.Int;}var j=this.getModel('ovpCardProperties');var k=j.getProperty("/entityType");var h1=j.getProperty("/metaModel");var i1=h1.getODataProperty(k,i.Value.Path);if(i1["Org.OData.Measures.V1.Unit"]){var j1=i1["Org.OData.Measures.V1.Unit"];if(j1.String=="%"){this.getModel("ovpCardProperties").oData.percentageAvailable=true;}}return"{parts: [{path:'"+i.Value.Path+"'}], formatter: 'sap.ovp.cards.AnnotationHelper.KpiValueFormatter'}";};sap.ovp.cards.AnnotationHelper.formThePathForTrendIcon=function(i,j){if(!j||!j.Value||!j.Value.Path||!j.TrendCalculation){return"";}var k=Y(j.Value);var h1=Y(j.TrendCalculation.ReferenceValue);var i1=Y(j.TrendCalculation.DownDifference);var j1=Y(j.TrendCalculation.UpDifference);var k1=O(h1);var l1=O(i1);var m1=O(j1);var n1="parts: ["+k;n1+=k1?","+h1:"";n1+=l1?","+i1:"";n1+=m1?","+j1:"";n1+="]";var o1=function(){var q1=1;return f(arguments[0],k1?arguments[q1++]:h1,l1?arguments[q1++]:i1,m1?arguments[q1++]:j1);};var p1=a(o1,"formatTrendDirection");return"{"+n1+", formatter: '"+p1+"'}";};sap.ovp.cards.AnnotationHelper.formThePathForSubtitle=function(i,j,k){var h1,i1;if(!j||!j.Value||!j.Value.Path){return k;}h1=y(i,j,false,true);i1=sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("SubTitle_IN");if(h1){return k+" "+i1+" "+h1;}else{return k;}};sap.ovp.cards.AnnotationHelper.formPathForPercentageChange=function(i){if(!i||!i.TrendCalculation||!i.TrendCalculation.ReferenceValue){return"";}if(i&&i.ValueFormat&&i.ValueFormat.NumberOfFractionalDigits&&i.ValueFormat.NumberOfFractionalDigits.Int){this.getModel("ovpCardProperties").oData.NumberOfFractionalDigits=i.ValueFormat.NumberOfFractionalDigits.Int;}if(i.TrendCalculation.ReferenceValue.Path){return"{parts: [{path:'"+i.Value.Path+"'}, {path:'"+i.TrendCalculation.ReferenceValue.Path+"'}], formatter: 'sap.ovp.cards.AnnotationHelper.returnPercentageChange'}";}else{return"{parts: [{path:'"+i.Value.Path+"'}], formatter: 'sap.ovp.cards.AnnotationHelper.returnPercentageChange'}";}};sap.ovp.cards.AnnotationHelper.TargetValueFormatter=function(k,i){var j,h1,i1,j1=false;if(isNaN(k)){return"";}if(this.oPropagatedProperties.oModels.ovpCardProperties.oData.NumberOfFractionalDigits){h1=Number(this.oPropagatedProperties.oModels.ovpCardProperties.oData.NumberOfFractionalDigits);}if(this.oPropagatedProperties.oModels.ovpCardProperties.oData.percentageAvailableForTarget){j1=true;}if(!h1||h1<0){h1=0;}else if(h1>2){h1=2;}if(k==0){i1=i;}else{i1=k;}if(i){j=i;}else if(this.oPropagatedProperties.oModels.ovpCardProperties.oData.ManifestTargetValue){j=this.oPropagatedProperties.oModels.ovpCardProperties.oData.ManifestTargetValue;}if(j){var k1=sap.ui.core.format.NumberFormat.getFloatInstance({minFractionDigits:h1,maxFractionDigits:h1,style:"short",showScale:true,shortRefNumber:i1});if(j1){return k1.format(Number(j))+" %";}else{return k1.format(Number(j));}}};sap.ovp.cards.AnnotationHelper.formPathForTargetValue=function(i){if(!i||!i.TrendCalculation||!i.TrendCalculation.ReferenceValue){return"";}if(!i||!i.Value||!i.Value.Path){return"";}if(i&&i.ValueFormat&&i.ValueFormat.NumberOfFractionalDigits&&i.ValueFormat.NumberOfFractionalDigits.Int){this.getModel("ovpCardProperties").oData.NumberOfFractionalDigits=i.ValueFormat.NumberOfFractionalDigits.Int;}if(i.TrendCalculation.ReferenceValue){if(i.TrendCalculation.ReferenceValue.String){this.getModel("ovpCardProperties").oData.ManifestTargetValue=i.TrendCalculation.ReferenceValue.String;return"{parts: [{path:'"+i.Value.Path+"'}], formatter: 'sap.ovp.cards.AnnotationHelper.TargetValueFormatter'}";}if(i.TrendCalculation.ReferenceValue.Path){var j=this.getModel('ovpCardProperties');var k=j.getProperty("/entityType");var h1=j.getProperty("/metaModel");var i1=h1.getODataProperty(k,i.TrendCalculation.ReferenceValue.Path);if(i1["Org.OData.Measures.V1.Unit"]){var j1=i1["Org.OData.Measures.V1.Unit"];if(j1.String=="%"){this.getModel("ovpCardProperties").oData.percentageAvailableForTarget=true;}}return"{parts: [{path:'"+i.Value.Path+"'},{path:'"+i.TrendCalculation.ReferenceValue.Path+"'}], formatter: 'sap.ovp.cards.AnnotationHelper.TargetValueFormatter'}";}}};sap.ovp.cards.AnnotationHelper.returnPercentageChange=function(i,j){jQuery.sap.require("sap.ui.core.format.NumberFormat");var k="";var h1;if(isNaN(i)){return"";}i=Number(i);var i1=this.getModel("ovpCardProperties");if(!i1){return k;}var j1=i1.getProperty("/dataPointAnnotationPath");var k1=i1.getProperty("/entityType")[j1];var l1;if(!k1.TrendCalculation){return k;}if(this.oPropagatedProperties.oModels.ovpCardProperties.oData.NumberOfFractionalDigits){h1=Number(this.oPropagatedProperties.oModels.ovpCardProperties.oData.NumberOfFractionalDigits);}if(!h1||h1<0){h1=0;}else if(h1>2){h1=2;}if(k1.TrendCalculation.ReferenceValue){if(k1.TrendCalculation.ReferenceValue.String){l1=Number(k1.TrendCalculation.ReferenceValue.String);}if(k1.TrendCalculation.ReferenceValue.Path){l1=Number(j);}if(!l1||l1==0){return k;}var m1=((Number(i)-l1)/l1);var n1=sap.ui.core.format.NumberFormat.getPercentInstance({style:'short',minFractionDigits:h1,maxFractionDigits:h1,showScale:true});return n1.format(m1);}};sap.ovp.cards.AnnotationHelper.isPresentationVarientPresent=function(i){if(i&&i.GroupBy&&!(jQuery.isEmptyObject(i.GroupBy))&&i.GroupBy[0].hasOwnProperty('PropertyPath')){return true;}else{return false;}};sap.ovp.cards.AnnotationHelper.listGroupBy=function(i){var j="";var k=i&&i.GroupBy;if(!k){return j;}var h1=this.getModel('ovpCardProperties').getProperty("/metaModel");var i1=this.getModel('ovpCardProperties').getProperty("/entityType");var j1;if(i.GroupBy.constructor===Array){j1=i.GroupBy;}else if(!i.GroupBy.Collection){return j;}else{j1=i.GroupBy.Collection;}var k1;jQuery.each(j1,function(){k1=e1(h1,i1,this.PropertyPath);if(!k1){return;}j+=k1;j+=", ";});if(j[j.length-1]===" "&&j[j.length-2]===","){j=j.substring(0,j.length-2);}return j==""?"":sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("By",[j]);};sap.ovp.cards.AnnotationHelper.formTheFilterByString=function(i,j,k){var h1=true;var i1=k["SelectOptions"].length-1;if(j.PropertyName.PropertyPath===k["SelectOptions"][i1].PropertyName.PropertyPath){h1=false;}j=[j];var j1=i.getSetting('ovpCardProperties');var k1=j1.getProperty("/entityType");var l1=j1.getProperty("/metaModel");var m1=V(j1,j);if(m1.length==0){return"";}var n1;var o1;n1=m1[0].path;o1=f1(l1,k1,n1);if(o1!==n1){return"";}var p1=c1(m1);if(h1===true){return p1+", ";}return p1;};sap.ovp.cards.AnnotationHelper.formTheIdForFilter=function(i){return i.id;};function c1(j){var k=[];for(var i=0;i<j.length;i++){k.push(d1(j[i]));}return k.join(', ');}function d1(i){var j=false;var k=i.value1;if(i.operator[0]==="N"){j=true;}if(i.value2){k+=" - "+i.value2;}if(j){k=sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("kpiHeader_Filter_NotOperator",[k]);}return k;}function e1(i,j,k){return g1(i,j,k,"com.sap.vocabularies.Common.v1.Label");}function f1(i,j,k){return g1(i,j,k,"sap:text");}function g1(i,j,k,h1){var i1=i.getODataProperty(j,k);if(!i1){jQuery.sap.log.error("No Property Found for with Name '"+k+" For Entity-Type '"+j.name+"'");return;}var j1=i1[h1];if(j1){if(h1==="com.sap.vocabularies.Common.v1.Label"){return j1.String;}return j1;}return i1.name;}sap.ovp.cards.AnnotationHelper._criticality2state=c;sap.ovp.cards.AnnotationHelper._calculateCriticalityState=d;sap.ovp.cards.AnnotationHelper._calculateTrendDirection=f;sap.ovp.cards.AnnotationHelper._getPropertiesFromBindingString=S;sap.ovp.cards.AnnotationHelper.sortCollectionByImportance=p;sap.ovp.cards.AnnotationHelper.formatterGeo.requiresIContext=true;sap.ovp.cards.AnnotationHelper.analyticRegions.requiresIContext=true;sap.ovp.cards.AnnotationHelper.criticalityType.requiresIContext=true;sap.ovp.cards.AnnotationHelper.labelText.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatField.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formThePathForTrendIcon.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formThePathForSubtitle.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formTheFilterByString.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getAggregateNumber.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getFirstDataFieldName.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getSecondDataFieldName.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getThirdDataFieldName.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getFourthDataFieldName.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getFifthDataFieldName.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatFirstDataFieldValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatSecondDataFieldValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatThirdDataFieldValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatFourthDataFieldValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatFifthDataFieldValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatSixthDataFieldValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getDataPointsCount.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getFirstDataPointName.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getSecondDataPointName.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getThirdDataPointName.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatFirstDataPointValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatSecondDataPointValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatThirdDataPointValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatFirstDataPointState.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatFirstDataPointColor.requiresIContext=true;sap.ovp.cards.AnnotationHelper.colorPaletteForComparisonMicroChart.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatSecondDataPointState.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatThirdDataPointState.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatFirstDataPointStateForSmartField.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatKPIHeaderState.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatItems.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatUrl.requiresIContext=true;sap.ovp.cards.AnnotationHelper.hasActions.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getFirstDataPointValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatImageUrl.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getSecondDataPointValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.isFirstDataPointPercentageUnit.requiresIContext=true;sap.ovp.cards.AnnotationHelper.isFirstDataPointCriticality.requiresIContext=true;sap.ovp.cards.AnnotationHelper.isSecondDataPointCriticality.requiresIContext=true;sap.ovp.cards.AnnotationHelper.isThirdDataPointCriticality.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatDataFieldValueGeneric.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatDataPointValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatDataPointStateGeneric.requiresIContext=true;sap.ovp.cards.AnnotationHelper.checkCriticalityGeneric.requiresIContext=true;sap.ovp.cards.AnnotationHelper.removeDuplicateDataField.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatDataPointStateForSmartFieldGeneric.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatsemanticObjectOfDataFieldGeneric.requiresIContext=true;sap.ovp.cards.AnnotationHelper.checkForSemanticObjectAnnotation.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getSortedDataPoints.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getSortedDataFields.requiresIContext=true;}());
