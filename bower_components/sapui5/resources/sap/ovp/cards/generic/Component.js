(function(){"use strict";jQuery.sap.declare("sap.ovp.cards.generic.Component");jQuery.sap.require("sap.ui.core.UIComponent");jQuery.sap.require("sap.ovp.cards.AnnotationHelper");jQuery.sap.require("sap.ovp.cards.LoadingUtils");jQuery.sap.require("sap.ovp.cards.CommonUtils");sap.ui.core.UIComponent.extend("sap.ovp.cards.generic.Component",{metadata:{properties:{"contentFragment":{"type":"string"},"headerExtensionFragment":{"type":"string"},"contentPosition":{"type":"string","defaultValue":"Middle"},"headerFragment":{"type":"string","defaultValue":"sap.ovp.cards.generic.Header"},"footerFragment":{"type":"string"},"identificationAnnotationPath":{"type":"string","defaultValue":"com.sap.vocabularies.UI.v1.Identification"},"selectionAnnotationPath":{"type":"string"},"filters":{"type":"object"},"addODataSelect":{"type":"boolean","defaultValue":false}},version:"1.50.4",library:"sap.ovp",includes:[],dependencies:{libs:[],components:[]},config:{}},getCustomPreprocessor:function(){},getPreprocessors:function(p){var c=this.getComponentData(),s=c.settings,m=c.model,M,e,E,o;if(s.description&&!s.subTitle){s.subTitle=s.description;}if(m){M=m.getMetaModel();if(s.entitySet){var a=M.getODataEntitySet(s.entitySet);var b=M.getODataEntitySet(s.entitySet,true);e=M.getODataEntityType(a.entityType);o=M.createBindingContext(b);E=M.createBindingContext(e.$path);}}var C=this._getCardPropertyDefaults();var d=this._completeLayoutDefaults(C,s);var f;var g;if(c.appComponent&&c.appComponent.getModel("ui")&&c.appComponent.getModel("ui").oData){f=c.appComponent.getModel("ui").oData.showDateInRelativeFormat;g=c.appComponent.getModel("ui").oData.disableTableCardFlexibility;}else{if(c.showDateInRelativeFormat){f=c.showDateInRelativeFormat;}if(c.disableTableCardFlexibility){g=c.disableTableCardFlexibility;}}var A={metaModel:M,entityType:e,webkitSupport:sap.ui.Device.browser.webkit,layoutDetail:d&&d.cardLayout?d.cardLayout.containerLayout:'fixed',showDateInRelativeFormat:f,disableTableCardFlexibility:g};if(!!c&&!!c.cardId){var h=c.mainComponent;var t=null;if(!!h){t=h._getCardFromManifest(c.cardId)?h._getCardFromManifest(c.cardId).template:null;}else{t=c.template;}if(!!t){A.template=t;}}C.densityStyle=sap.ovp.cards.CommonUtils._setCardpropertyDensityAttribute();if(d){A.cardLayout=d.cardLayout;}if(C.state!=="Loading"){if(s&&s.selectionPresentationAnnotationPath){var S=e[s.selectionPresentationAnnotationPath];if(S){var j=S.SelectionVariant&&S.SelectionVariant.Path;if(j){if(/^@/.test(j)){j=j.slice(1);}s.selectionAnnotationPath=j;}var P=S.PresentationVariant&&S.PresentationVariant.Path;if(P){if(/^@/.test(P)){P=P.slice(1);}s.presentationAnnotationPath=P;var v=e[P].Visualizations;var k;for(k=0;k<v.length;k++){var V=v[k].AnnotationPath;if(V){if(/^@/.test(V)){V=V.slice(1);}if(/.LineItem/.test(V)){s.annotationPath=V;break;}}}for(k=0;k<v.length;k++){var V=v[k].AnnotationPath;if(V){if(/^@/.test(V)){V=V.slice(1);}if(/.Chart/.test(V)){s.chartAnnotationPath=V;break;}}}}}}}if(!!A.entityType&&!!s.selectionAnnotationPath&&!!A.entityType[s.selectionAnnotationPath]){var l=A.entityType[s.selectionAnnotationPath].SelectOptions;for(var n=0;!!l&&n<l.length;n++){l[n].id="headerFilterText--"+(n+1);}A.entityType[s.selectionAnnotationPath].SelectOptions=l;}if(A.template==="sap.ovp.cards.linklist"&&!!s.staticContent){for(var i=0;i<s.staticContent.length;i++){s.staticContent[i].id="linkListItem--"+(i+1);}}if(C.state&&(C.state==="Loading"||C.state==="Error")&&sap.ovp.cards.LoadingUtils.bPageAndCardLoading){C.footerFragment="sap.ovp.cards.loading.LoadingContent";}C=jQuery.extend(true,A,C,s);var O=new sap.ui.model.json.JSONModel(C);var D=new sap.ui.model.json.JSONModel(sap.ui.Device);D.setDefaultBindingMode("OneWay");var q={xml:{bindingContexts:{entityType:E,entitySet:o},models:{device:D,entityType:M,entitySet:M,ovpMeta:M,ovpCardProperties:O,ovplibResourceBundle:p},ovpCardProperties:O,dataModel:m,_ovpCache:{}}};return jQuery.extend(true,{},this.getCustomPreprocessor(),q);},_completeLayoutDefaults:function(c,s){var C={},o=this.getComponentData(),u=null,a=null,d=null;if(o.appComponent){u=o.appComponent.getModel("ui");a=o.appComponent.getOvpConfig();}if(!a){return null;}if(a.containerLayout==="resizable"&&o.cardId&&c.contentFragment!=="sap.ovp.cards.quickview.Quickview"){d=o.appComponent.getDashboardLayoutUtil();var D=u.getProperty("/initialDashboardLayout");var b=o.cardId;var e=d.aCards.filter(function(i){return i.id===b;});if(D){var f=D[0].filter(function(i){return i.id===b;});if(f){C.cardLayout=f[0].dashboardLayout["C"+d.dashboardLayoutModel.iColCount];}}else{C.cardLayout=e[0].dashboardLayout;}C.cardLayout.containerLayout=a.containerLayout;C.cardLayout.iRowHeightPx=d.ROW_HEIGHT_PX;C.cardLayout.iCardBorderPx=d.CARD_BORDER_PX;C.cardLayout.headerHeight=e[0].dashboardLayout.headerHeight;}return C;},_getCardPropertyDefaults:function(){var c={};var p=this.getMetadata().getAllProperties();var P;for(var a in p){P=p[a];if(P.defaultValue!==undefined){c[P.name]=P.defaultValue;}}return c;},getOvplibResourceBundle:function(){if(!this.ovplibResourceBundle){var r=sap.ui.getCore().getLibraryResourceBundle("sap.ovp");this.ovplibResourceBundle=r?new sap.ui.model.resource.ResourceModel({bundleUrl:r.oUrlInfo.url}):null;}return this.ovplibResourceBundle;},_getCacheKeys:function(){return;var c=this.getComponentData&&this.getComponentData();var I=c&&c.settings&&c.settings.isObjectStream;if(I){return;}var m=c&&c.model;if(m){var C=[];var p=m.metadataLoaded().then(function(P){var s;if(P&&P.lastModified){s=new Date(P.lastModified).getTime()+"";}else{jQuery.sap.log.error("No valid cache key segment last modification date provided by the OData Model");s=new Date().getTime()+"";}return s;});C.push(p);var a=m.annotationsLoaded().then(function(P){var b=0;if(P){for(var i=0;i<P.length;i++){if(P[i].lastModified){var l=new Date(P[i].lastModified).getTime();if(l>b){b=l;}}}}if(b===0){jQuery.sap.log.error("No valid cache key segment last modification date provided by OData annotations");b=new Date().getTime();}return b+"";});C.push(a);return C;}},createContent:function(){var c=this.getComponentData&&this.getComponentData();var m=c.model;var p;var P;var M=c&&c.mainComponent;var o=M&&M.oModelViewMap;var s=c&&c.modelName;var C=function(){if(m&&s){m.bIncludeInCurrentBatch=false;if(o&&s&&o[s]&&o[s][c.cardId]){delete o[s][c.cardId];if(Object.keys(o[s]).length>0){m.bIncludeInCurrentBatch=true;}}}};if(c&&c.mainComponent){p=c.mainComponent._getOvplibResourceBundle();}else{p=this.getOvplibResourceBundle();}P=this.getPreprocessors(p);var v={preprocessors:P,type:sap.ui.core.mvc.ViewType.XML,viewName:"sap.ovp.cards.generic.Card"};var a=this._getCacheKeys();if(a&&a.length&&a.length>0){v.async=true;v.cache={keys:a};}var l=this._getCardPropertyDefaults().state;var i=c.cardId+(l?l:"Original");if(!l){i=i+(c.settings.selectedKey?"_Tab"+c.settings.selectedKey:"");}if(!v.async){C();}var V=sap.ui.view(c.containerId==="dialogCard"?undefined:i,v);if(v.async){var O=V.onControllerConnected;V.onControllerConnected=function(){C();O.apply(V,arguments);};}V.setModel(m);if(c.i18n){V.setModel(c.i18n,"@i18n");}V.setModel(P.xml.ovpCardProperties,"ovpCardProperties");V.setModel(p,"ovplibResourceBundle");return V;}});})();
