/*!
 * Copyright (c) 2009-2014 SAP SE, All Rights Reserved
 */
sap.ui.define(["jquery.sap.global","sap/ovp/ui/DashboardLayoutUtil","sap/ovp/library"],function(q,D){"use strict";var a=sap.ui.core.Control.extend("sap.ovp.ui.DashboardLayout",{metadata:{designTime:true,library:"sap.ovp",aggregations:{content:{type:"sap.ui.core.Control",multiple:true,singularName:"content"}},defaultAggregation:"content",events:{afterRendering:{},afterDragEnds:{}},properties:{dragAndDropRootSelector:{group:"Misc",type:"string"},dragAndDropEnabled:{group:"Misc",type:"boolean",defaultValue:true},debounceTime:{group:"Misc",type:"int",defaultValue:150}}},renderer:{render:function(r,c){var b=c.$().width();var l=c.dashboardLayoutUtil.updateLayoutData(b?b:q(window).width());var C=c.dashboardLayoutUtil.getCards(l.colCount);var f=c.getContent().filter(function(i){return i.getVisible();});r.write("<div");r.writeControlData(c);r.addClass("sapUshellEasyScanLayout");if(!sap.ui.Device.system.phone){r.addClass("sapOvpDashboardDragAndDrop");}r.addClass("sapOvpDashboard");r.writeClasses();r.addStyle("margin-left",l.marginPx+"px");r.writeStyles();r.write(">");r.write("<div class='sapUshellEasyScanLayoutInner' tabindex='0'>");if(C.length>0){var d={};f.forEach(function(i,e){d=C.filter(function(g){return g.id===this.getId().split("--")[1];}.bind(i))[0];c.dashboardLayoutUtil.setCardCssValues(d);if(d.template==="sap.ovp.cards.stack"||d.settings.stopResizing){r.write("<div id='"+c.dashboardLayoutUtil.getCardDomId(d.id)+"' class='easyScanLayoutItemWrapper sapOvpDashboardLayoutItem sapOvpDashboardLayoutItemNoDragIcon' style='"+"; transform:translate3d("+d.dashboardLayout.left+" ,"+d.dashboardLayout.top+" ,0px)"+"; -ms-transform:translate3d("+d.dashboardLayout.left+" ,"+d.dashboardLayout.top+" ,0px)"+"; -moz-transform:translate3d("+d.dashboardLayout.left+" ,"+d.dashboardLayout.top+" ,0px)"+"; -webkit-transform:translate3d("+d.dashboardLayout.left+" ,"+d.dashboardLayout.top+" ,0px)"+"; height:"+d.dashboardLayout.height+"; width:"+d.dashboardLayout.width+";'"+" tabindex='0'; aria-setsize="+f.length+" aria-posinset="+e+">");}else if(!sap.ui.Device.support.touch){r.write("<div id='"+c.dashboardLayoutUtil.getCardDomId(d.id)+"' class='easyScanLayoutItemWrapper sapOvpDashboardLayoutItem' style='"+"; transform:translate3d("+d.dashboardLayout.left+" ,"+d.dashboardLayout.top+" ,0px)"+"; -ms-transform:translate3d("+d.dashboardLayout.left+" ,"+d.dashboardLayout.top+" ,0px)"+"; -moz-transform:translate3d("+d.dashboardLayout.left+" ,"+d.dashboardLayout.top+" ,0px)"+"; -webkit-transform:translate3d("+d.dashboardLayout.left+" ,"+d.dashboardLayout.top+", 0px)"+"; height:"+d.dashboardLayout.height+"; width:"+d.dashboardLayout.width+";'"+" tabindex='0'; aria-setsize="+f.length+" aria-posinset="+e+">");}else{r.write("<div id='"+c.dashboardLayoutUtil.getCardDomId(d.id)+"' class='easyScanLayoutItemWrapper sapOvpDashboardLayoutItem sapOvpDashboardLayoutItemTouch' style='"+"; transform:translate3d("+d.dashboardLayout.left+" ,"+d.dashboardLayout.top+" ,0px)"+"; -ms-transform:translate3d("+d.dashboardLayout.left+" ,"+d.dashboardLayout.top+" ,0px)"+"; -moz-transform:translate3d("+d.dashboardLayout.left+" ,"+d.dashboardLayout.top+" ,0px)"+"; -webkit-transform:translate3d("+d.dashboardLayout.left+","+d.dashboardLayout.top+", 0px)"+"; height:"+d.dashboardLayout.height+"; width:"+d.dashboardLayout.width+";'"+" tabindex='0'; aria-setsize="+f.length+" aria-posinset="+e+">");}r.renderControl(i);r.write("</div>");});}r.write("</div>");r.write("</div>");}},init:function(){this.oColumnLayoutData={};this.resizeHandlerId=this.initResizeHandler();var c=sap.ui.getCore().getComponent(this._sOwnerId);this.dashboardLayoutUtil=c.getDashboardLayoutUtil();this.dashboardLayoutUtil.setLayout(this);},exit:function(){if(this.resizeHandlerId){sap.ui.core.ResizeHandler.deregister(this.resizeHandlerId);}if(this.layoutDragAndDrop){this.layoutDragAndDrop.destroy();delete this.layoutDragAndDrop;}},onBeforeRendering:function(){},onAfterRendering:function(){if(!this.getDragAndDropRootSelector()){this.setDragAndDropRootSelector("#"+this.getId());}if(this.layoutDragAndDrop){this.layoutDragAndDrop.destroy();}if(this.getDragAndDropEnabled()){this.layoutDragAndDrop=this.dashboardLayoutUtil.getRearrange({rootSelector:this.getDragAndDropRootSelector(),layout:this});this.fireAfterRendering();}},getLayoutDataJSON:function(){return this.dashboardLayoutUtil.getDashboardLayoutModel().getLayoutVariants4Pers();},getDashboardLayoutUtil:function(){return this.dashboardLayoutUtil;},getDashboardLayoutModel:function(){return this.dashboardLayoutUtil.getDashboardLayoutModel();},getVisibleLayoutItems:function(){var c=this.getContent();var f=c.filter(function(i){return i.getVisible();});return f;},initResizeHandler:function(){var r;var d=this.getDebounceTime();var b=function(e){window.clearTimeout(r);r=window.setTimeout(this.oControl.resizeHandler.bind(this,e),d);};return sap.ui.core.ResizeHandler.register(this,b);},resizeHandler:function(e){this.oControl.dashboardLayoutUtil.resizeLayout(e.size.width);}});return a;},true);
