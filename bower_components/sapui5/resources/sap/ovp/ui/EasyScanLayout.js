/*!
 * Copyright (c) 2009-2014 SAP SE, All Rights Reserved
 */
sap.ui.define(["jquery.sap.global",'sap/ovp/cards/CommonUtils',"sap/ovp/library"],function(q,c){"use strict";q.sap.require('sap.ovp.ui.UIActions');var R=function(s){this.init(s);};R.prototype.init=function(s){s.beforeDragCallback=this._beforeDragHandler.bind(this);s.dragStartCallback=this._dragStartHandler.bind(this);s.dragMoveCallback=this._dragMoveHandler.bind(this);s.dragEndCallback=this._dragEndHandler.bind(this);s.endCallback=this._endHandler.bind(this);this.layout=s.layout;this.afterReplaceElements=s.afterReplaceElements||function(){};this.settings=s;delete s.afterReplaceElements;this.destroy();this.uiActions=new sap.ovp.ui.UIActions(this.settings).enable();this.aCardsOrder=null;this.verticalMargin=null;this.horizontalMargin=null;this.columnCount=null;this.top=null;this.left=null;this.width=null;this.layoutOffset=null;this.jqLayout=null;this.jqLayoutInner=null;this.isRTLEnabled=null;this.lastCollidedEl=null;this.lastCollisionTop=null;this.SCROLL_OFFSET=16;};R.prototype.findCollision=function(d,e,f){var h;for(var i=0;i<f.length;i++){var j=f[i];var k=!(j.posDnD.right<d||j.posDnD.left>d);var l=!(j.posDnD.bottom<e||j.posDnD.top>e);if(k&&l){h=j;break;}}return h;};R.prototype.isCollisionTop=function(d,e,i){var h=((i.posDnD.bottom-i.posDnD.top)/2)+i.posDnD.top;var f=!(h<e||i.posDnD.top>e);return f;};R.prototype._dragMoveHandler=function(d,e){var s=d.element;var f=d.moveX-this.layoutOffset.left;var h=d.moveY-this.jqLayout.get(0).getBoundingClientRect().top+this.jqLayout.scrollTop();if(!e){var v=document.getElementsByClassName("sapFDynamicPageContentWrapper")[0];var i=v.offsetHeight;var j=v.getBoundingClientRect();if((d.evt.clientY-v.offsetTop+this.SCROLL_OFFSET)>i){v.scrollTop=v.scrollTop+this.SCROLL_OFFSET;}else if(((d.evt.clientY-v.offsetTop)<j.top+this.SCROLL_OFFSET)&&v.scrollTop!==0){v.scrollTop=v.scrollTop-this.SCROLL_OFFSET;}}var k=this.findCollision(f,h,this.aCardsOrder);if(!k){return;}var l=this.isCollisionTop(f,h,k);if(k===s){this.lastCollidedEl=k;return;}if(k===this.lastCollidedEl){if(this.lastCollisionTop===l){return;}if(this.lastCollisionTop){this.lastCollisionTop=l;if(s.posDnD.top>k.posDnD.top){return;}}else{this.lastCollisionTop=l;if(s.posDnD.top<k.posDnD.top){return;}}}if(this.lastCollidedEl&&(this.lastCollidedEl!==k&&this.lastCollidedEl!==s)&&(this.lastCollidedEl.posDnD.left===k.posDnD.left&&this.lastCollidedEl.posDnD.left===s.posDnD.left)){k=this.lastCollidedEl;}this.dragAndDropElement(s,k);this.lastCollidedEl=this.findCollision(f,h,this.aCardsOrder);if(this.lastCollidedEl){this.lastCollisionTop=this.isCollisionTop(f,h,this.lastCollidedEl);}};R.prototype.dragAndDropElement=function(s,t){if(s&&t){this.aCardsOrder=this.dragAndDropSwapElement(s,t,this.aCardsOrder);this.drawLayout(this.aCardsOrder);}};R.prototype.dragAndDropSwapElement=function(s,t,i){var n=i.slice();var d=i.indexOf(s);var e=i.indexOf(t);n[e]=s;n[d]=t;return n;};R.prototype.dragAndDropSwapElementForKeyboardNavigation=function(s,t){if(s&&t){var l=this.layout.getVisibleLayoutItems().map(function(e){return e.$().parent()[0];});var d=0;for(var i=0;i<l.length;i++){if(l[i]===s){l[i]=t;d++;continue;}if(l[i]===t){l[i]=s;d++;continue;}}if(d===2){this.afterReplaceElements(l);}}};R.prototype.initCardsSettingsForDragAndDrop=function(){this.jqLayout=this.layout.$();this.jqLayoutInner=this.jqLayout.children().first();var l=this.jqLayout.scrollTop();var d=this.jqLayoutInner.height();this.isRTLEnabled=sap.ui.getCore().getConfiguration().getRTL()?1:-1;this.aCardsOrder=[];this.layoutOffset=this.jqLayout.offset();if(sap.ui.Device.system.tablet===true&&sap.ui.Device.system.desktop===false){this.jqLayout.css('height',this.jqLayoutInner.height());}var v=this.layout.getVisibleLayoutItems();if(!v){return;}this.aCardsOrder=v.map(function(i){var h=i.$().parent()[0];h.posDnD={width:h.offsetWidth,height:h.offsetHeight};h.style.width=h.offsetWidth+"px";return h;});var j=this.jqLayoutInner.children().first();var e=(this.isRTLEnabled===1)?"margin-left":"margin-right";this.verticalMargin=parseInt(j.css(e),10);var f=this.aCardsOrder[0];this.horizontalMargin=parseInt(q(f).css("margin-bottom"),10);this.columnCount=this.layout.getColumnCount();this.top=f.getBoundingClientRect().top-this.jqLayoutInner[0].getBoundingClientRect().top;this.left=f.getBoundingClientRect().left-this.jqLayoutInner[0].getBoundingClientRect().left;this.width=f.offsetWidth;q(this.aCardsOrder).css("position","absolute");this.drawLayout(this.aCardsOrder);this.jqLayoutInner.height(d);this.jqLayout.scrollTop(l);};R.prototype.drawLayout=function(C){var o=[];for(var i=0;i<this.columnCount;i++){o[i]=0;}for(var n=0;n<C.length;n++){var d=n%this.columnCount;var e=o[d]++;var f=this.left-this.isRTLEnabled*(d*this.verticalMargin+d*this.width);var h=this.top;var k=C[n];for(var j=0;j<e;j++){h+=this.horizontalMargin;var p=n-(j+1)*this.columnCount;h+=C[p].posDnD.height;}k.posDnD.top=h;k.posDnD.bottom=h+k.posDnD.height;k.posDnD.left=f;k.posDnD.right=f+k.posDnD.width;this.updateElementCSS(C[n]);}};R.prototype.updateElementCSS=function(e){q(e).css({top:e.posDnD.top,left:e.posDnD.left});};R.prototype._dragStartHandler=function(e,d){if(sap.ui.Device.system.desktop){q('body').addClass("sapOVPDisableUserSelect sapOVPDisableImageDrag");}if(window.getSelection){var s=window.getSelection();s.removeAllRanges();}this.initCardsSettingsForDragAndDrop();};R.prototype._beforeDragHandler=function(e,u){if(sap.ui.Device.browser.mobile){this.selectableElemets=q(u).find('.sapUiSelectable');this.selectableElemets.removeClass('sapUiSelectable');}q(this.settings.wrapper).addClass("dragAndDropMode");};R.prototype._dragEndHandler=function(e,u){this.lastCollidedEl=null;if(e.type=='mouseup'||e.type=='touchend'){if(this.aCardsOrder){this.afterReplaceElements(this.aCardsOrder);}}if(sap.ui.Device.system.desktop){q('body').removeClass("sapOVPDisableUserSelect sapOVPDisableImageDrag");}q(this.settings.wrapper).removeClass("dragAndDropMode");if(this.jqLayoutInner){this.jqLayoutInner.removeAttr("style");}if(this.aCardsOrder){q(this.aCardsOrder).removeAttr("style");}this.uiActions.removeClone();};R.prototype._endHandler=function(e,u){if(sap.ui.Device.browser.mobile&&this.selectableElemets){this.selectableElemets.addClass('sapUiSelectable');}};R.prototype.getSwapItemsFunction=function(){return this.dragAndDropSwapElementForKeyboardNavigation.bind(this);};R.prototype.destroy=function(){if(this.uiActions){this.uiActions.disable();this.uiActions=null;}};var D={buildReplaceItemsInstance:function(s){var d={containerSelector:".sapUshellEasyScanLayoutInner",wrapper:".sapUshellEasyScanLayout",draggableSelector:".easyScanLayoutItemWrapper",placeHolderClass:"easyScanLayoutItemWrapper-placeHolder",cloneClass:"easyScanLayoutItemWrapperClone",moveTolerance:10,switchModeDelay:800,isTouch:!sap.ui.Device.system.desktop,debug:false};s=q.extend(d,s);return new R(s);}};var K=function(e,s){this.init(e,s);};K.prototype.init=function(e,s){this.easyScanLayout=e;this.swapItemsFunction=(typeof s==="function")?s:function(){};this.keyCodes=q.sap.KeyCodes;this.jqElement=e.$();this.jqElement.on('keydown.keyboardNavigation',this.keydownHandler.bind(this));this.jqElement.find(".after").on("focus.keyboardNavigation",this.afterFocusHandler.bind(this));this.jqElement.find(".sapUshellEasyScanLayoutInner").on("focus.keyboardNavigation",this.layoutFocusHandler.bind(this));this.jqElement.on("focus.keyboardNavigation",".easyScanLayoutItemWrapper",this.layoutItemFocusHandler.bind(this));this._ignoreSelfFocus=false;this.swapSourceElement=null;this.lastFocussedElement=null;this.lastFocussedClassId=null;this.jqElement.on('keyup',this.ctrlArrowUpDownHandler.bind(this));};K.prototype.ctrlArrowUpDownHandler=function(e){switch(e.keyCode){case this.keyCodes.ARROW_UP:if(e.ctrlKey==true){this.ctrlArrowHandler(e);this.arrowUpDownHandler(e,true);}break;case this.keyCodes.ARROW_DOWN:if(e.ctrlKey==true){this.ctrlArrowHandler(e);this.arrowUpDownHandler(e,false);}break;case this.keyCodes.PAGE_UP:if(e.ctrlKey){this.ctrlArrowHandler(e);this.pageUpDownHandler(e,true);}break;case this.keyCodes.PAGE_DOWN:if(e.ctrlKey){this.ctrlArrowHandler(e);this.pageUpDownHandler(e,false);}break;}};K.prototype.destroy=function(){if(this.jqElement){this.jqElement.off(".keyboardNavigation");this.jqElement.find(".after").off(".keyboardNavigation");this.jqElement.find(".sapUshellEasyScanLayoutInner").off(".keyboardNavigation");}delete this.jqElement;delete this.easyScanLayout;};K.prototype.getVisibleLayoutItems=function(){var d=this.easyScanLayout.getContent();var f=d.filter(function(i){return i.getVisible();});return f;};K.prototype.afterFocusHandler=function(){if(this._ignoreSelfFocus){this._ignoreSelfFocus=false;return;}var j=this.jqElement.find(".easyScanLayoutItemWrapper:sapTabbable").first();var l=j.find(":sapTabbable").last();if(!l.length){l=j;}l.focus();};K.prototype.layoutFocusHandler=function(){if(this._ignoreSelfFocus){this._ignoreSelfFocus=false;return;}this.jqElement.find(".easyScanLayoutItemWrapper:sapTabbable").first().focus();};K.prototype.layoutItemFocusHandler=function(){var j=q(document.activeElement);if(j){var l=j.find("[aria-label]");var i,s="";if(j.find('.valueStateText').length==1){var t=j.find('.valueStateText').find('.sapMObjectNumberText').text();var v=j.find('.valueStateText').find('.sapUiInvisibleText').text();j.find('.valueStateText').attr('aria-label',t+" "+v);j.find('.valueStateText').attr('aria-labelledby',"");}if(q(l).hasClass('kpiHeaderClass')){var k=q(l).closest('div.kpiHeaderClass').text();q(l).closest('div.kpiHeaderClass').attr('aria-label',k);}j.find("[role='listitem']").attr('aria-label',"");if(j.hasClass('easyScanLayoutItemWrapper')){var C="";var d=j.find('.cardCount');var e=sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("cardPositionInApp",[j.attr('aria-posinset'),j.attr('aria-setsize')]);if(d.length===0){C="countDiv_"+new Date().getTime();var f='<div id="'+C+'" class="cardCount" aria-label="'+e+'" hidden></div>';j.append(f);}else{C=d[0].id;d.attr('aria-label',e);}s+=C+" ";var o=j.find('.cardType');if(o.length!==0){s+=o[0].id+" ";}}if(j.hasClass('sapOvpCardHeader')&&!j.hasClass('sapOvpStackCardContent')){var h="";var n=j.find('.cardHeaderType');if(n.length===0){var p=sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("CardHeaderType");h="cardHeaderType_"+new Date().getTime();var r='<div id="'+h+'" class="cardHeaderType" aria-label="'+p+'" hidden></div>';j.append(r);}else{h=n[0].id;}s+=h+" ";}for(i=0;i<l.length;i++){if(l[i].getAttribute("role")==="heading"){s+=l[i].id+" ";}}if(j.hasClass('sapOvpCardHeader')){var u=j.find('.cardHeaderText');if(u.length!==0){for(var i=0;i<u.length;i++){s+=u[i].id+" ";}}}if(s.length){j.attr("aria-labelledby",s);}}};K.prototype._getLayoutItemIndex=function(j){if(!j.hasClass("easyScanLayoutItemWrapper")){return false;}var d=j.children().attr("id");var i=false;this.getVisibleLayoutItems().forEach(function(e,f){if(d==e.getId()){i=f;}});return i;};K.prototype._changeItemsFocus=function(j){var d=q('.easyScanLayoutItemWrapper');d.attr("tabindex","-1");j.attr("tabindex",0);setTimeout(function(){j.focus();},500);};K.prototype._swapItemsFocus=function(e,j,d){e.preventDefault();j.attr("tabindex","-1");setTimeout(function(){d.attr("tabindex","0").focus();},0);};K.prototype.tabButtonHandler=function(e){var j=q(document.activeElement);if(j.hasClass("easyScanLayoutItemWrapper")){return;}var d=j.closest(".easyScanLayoutItemWrapper");if(!d.length){return;}var f=d.find(":sapTabbable");f=f.filter(":not([id$=after])");if(f.eq(f.length-1).is(j)){e.stopPropagation();e.stopImmediatePropagation();var h=this.jqElement.scrollTop();this._ignoreSelfFocus=true;this.jqElement.find(".after").focus();this.jqElement.scrollTop(h);}};K.prototype.f7Handler=function(e){var j=q(document.activeElement);if(j.hasClass("easyScanLayoutItemWrapper")){j.find(":sapTabbable").first().focus();}else{j.closest(".easyScanLayoutItemWrapper").focus();}e.preventDefault();};K.prototype.shiftTabButtonHandler=function(e){var j=q(document.activeElement);if(!j.hasClass("easyScanLayoutItemWrapper")){return;}this._ignoreSelfFocus=true;this.jqElement.find(".sapUshellEasyScanLayoutInner").focus();};K.prototype.arrowUpDownHandler=function(e,i){e.preventDefault();var n=i?"prev":"next";var j=q(document.activeElement);if(!j.hasClass("sapOvpCardHeader")){var d=q(j)[n](".easyScanLayoutItemWrapper");if(!d.is(j)){this._swapItemsFocus(e,j,d);}}};K.prototype.arrowRightLeftHandler=function(e,i){var d=i?1:-1;var j=q(document.activeElement);var f=this._getLayoutItemIndex(j);if(f===false){return;}var I=this.getVisibleLayoutItems()[f+d];if(I){this._swapItemsFocus(e,j,I.$().parent());}};K.prototype.altPageUpAndHomeHandler=function(e){var j=q(document.activeElement);var f=this._getLayoutItemIndex(j);if(f===false){return;}var d=this.easyScanLayout.getColumnCount();var i=f%d;var h;var l=this.getVisibleLayoutItems();if(i==0){h=l[0];}else{h=l[f-i];}this._swapItemsFocus(e,j,h.$().parent());};K.prototype.altPageDownAndEndHandler=function(e){var j=q(document.activeElement);var f=this._getLayoutItemIndex(j);if(f===false){return;}var d=this.easyScanLayout.getColumnCount();var i=f%d;var h;var l=this.getVisibleLayoutItems();if((i==(d-1))||((f+(d-i))>l.length)){h=l[(l.length-1)];}else{h=l[f+(d-i-1)];}this._swapItemsFocus(e,j,h.$().parent());};K.prototype.ctrlHomeHandler=function(e){var j=q(document.activeElement);var f=this._getLayoutItemIndex(j);if(f===false){return;}var d=this.easyScanLayout.getColumnCount();var i=f%d;var v=this.getVisibleLayoutItems();var h=v[i];var n=h.$().parent();if(n.is(j)){n=v[0].$().parent();}this._swapItemsFocus(e,j,n);};K.prototype.ctrlEndHandler=function(e){var j=q(document.activeElement);var f=this._getLayoutItemIndex(j);if(f<0){return;}var d=this.easyScanLayout.getColumnCount();var h=f%d;var k;var v=this.getVisibleLayoutItems();for(var i=v.length-1;i>=0;i--){if((i%d)==h){k=v[i];break;}}var n=k.$().parent();if(n.is(j)){n=v[v.length-1].$().parent();}this._swapItemsFocus(e,j,n);};K.prototype.pageUpDownHandler=function(e,i){var n=i?"prev":"next";var j=q(document.activeElement);if(!j.hasClass("easyScanLayoutItemWrapper")){return;}if(!j[n]().length){return;}var d=false;var f=j;var w=q(window).height();while(!d){var h=f[n]();if(!h.length){d=f;break;}if(!i&&h.offset().top>w){d=h;break;}var o=h.offset().top;var s=o?o<0?-1:1:0;if(i&&(s<=0)){d=h;break;}f=h;}this._swapItemsFocus(e,j,d);};K.prototype.ctrlArrowHandler=function(e){if(this.swapSourceElement==null){this.swapSourceElement=q(document.activeElement);if(!this.swapSourceElement.hasClass("easyScanLayoutItemWrapper")){this.endSwap();}else{this.jqElement.on('keyup.keyboardNavigation',this.keyupHandler.bind(this));this.jqElement.addClass('dragAndDropMode');this.swapSourceElement.addClass('dragHovered');}}};K.prototype.keyupHandler=function(e){if(this.swapSourceElement!=null&&e.keyCode===this.keyCodes.CONTROL){var j=q(document.activeElement);if(j.hasClass("easyScanLayoutItemWrapper")){this.swapItemsFunction(this.swapSourceElement[0],j[0]);this._changeItemsFocus(this.swapSourceElement);}this.endSwap();}};K.prototype.endSwap=function(e){this.swapSourceElement.removeClass('dragHovered');this.jqElement.removeClass('dragAndDropMode');this.swapSourceElement=null;this.jqElement.off('keyup.keyboardNavigation');};K.prototype.checkIfSwapInterrupted=function(e){if(this.swapSourceElement!=null&&e.keyCode!=this.keyCodes.ARROW_LEFT&&e.keyCode!=this.keyCodes.ARROW_RIGHT&&e.keyCode!=this.keyCodes.ARROW_UP&&e.keyCode!=this.keyCodes.ARROW_DOWN){this.endSwap();}};K.prototype.spacebarHandler=function(e){var i=sap.ui.getCore().byId(e.target.id);if(i&&i.mEventRegistry.hasOwnProperty('press')){q('#'+e.target.id).addClass('sapMLIBActive');q('#'+e.target.id+' span').css('color','#FFFFFF');i.firePress();}};K.prototype.keydownHandler=function(e){this.checkIfSwapInterrupted(e);switch(e.keyCode){case this.keyCodes.TAB:(e.shiftKey)?this.shiftTabButtonHandler(e):this.tabButtonHandler(e);break;case this.keyCodes.F6:if(e.shiftKey){this._ignoreSelfFocus=true;this.jqElement.find(".sapUshellEasyScanLayoutInner").focus();q.sap.handleF6GroupNavigation(e);}else{this._ignoreSelfFocus=true;var d=this.jqElement.scrollTop();this.jqElement.find(".after").focus();q.sap.handleF6GroupNavigation(e);this.jqElement.scrollTop(d);}break;case this.keyCodes.F7:this.f7Handler(e);break;case this.keyCodes.ARROW_UP:if(e.ctrlKey==true){this.ctrlArrowHandler(e);}this.arrowUpDownHandler(e,true);break;case this.keyCodes.ARROW_DOWN:if(e.ctrlKey==true){this.ctrlArrowHandler(e);}this.arrowUpDownHandler(e,false);break;case this.keyCodes.ARROW_RIGHT:if(e.ctrlKey==true){this.ctrlArrowHandler(e);}this.arrowRightLeftHandler(e,true);break;case this.keyCodes.ARROW_LEFT:if(e.ctrlKey==true){this.ctrlArrowHandler(e);}this.arrowRightLeftHandler(e,false);break;case this.keyCodes.HOME:(e.ctrlKey==true)?this.ctrlHomeHandler(e):this.altPageUpAndHomeHandler(e);break;case this.keyCodes.END:(e.ctrlKey==true)?this.ctrlEndHandler(e):this.altPageDownAndEndHandler(e);break;case this.keyCodes.PAGE_UP:(e.altKey==true)?this.altPageUpAndHomeHandler(e):this.pageUpDownHandler(e,true);if(e.ctrlKey){this.ctrlArrowHandler(e);this.pageUpDownHandler(e,true);}break;case this.keyCodes.PAGE_DOWN:(e.altKey==true)?this.altPageDownAndEndHandler(e):this.pageUpDownHandler(e,false);if(e.ctrlKey){this.ctrlArrowHandler(e);this.pageUpDownHandler(e,false);}break;case this.keyCodes.SPACE:case this.keyCodes.ENTER:this.spacebarHandler(e);break;}};var E=sap.ui.core.Control.extend("sap.ovp.ui.EasyScanLayout",{metadata:{designTime:true,library:"sap.ovp",aggregations:{content:{type:"sap.ui.core.Control",multiple:true,singularName:"content"}},defaultAggregation:"content",events:{afterRendering:{},afterDragEnds:{}},properties:{useMediaQueries:{group:"Misc",type:"boolean",defaultValue:false},dragAndDropRootSelector:{group:"Misc",type:"string"},dragAndDropEnabled:{group:"Misc",type:"boolean",defaultValue:true},debounceTime:{group:"Misc",type:"int",defaultValue:150}}},renderer:{render:function(r,C){r.write("<div");r.writeControlData(C);r.addClass("sapUshellEasyScanLayout");r.writeClasses();r.write(">");r.write("<div class='sapUshellEasyScanLayoutInner' role='list' tabindex='0' aria-label='Cards'>");var d=C.columnCount;var e=Array.apply(null,new Array(d)).map(function(){return[];});var f=C.getContent().filter(function(j){return j.getVisible();});for(var i=0;i<f.length;i++){e[i%d].push(f[i]);}var h=1;e.forEach(function(j){r.write("<div");r.addClass("easyScanLayoutColumn");r.writeClasses();r.write(">");j.forEach(function(k,l){r.write("<div ");(h===1)?r.write("tabindex='0' "):r.write("tabindex='-1' ");r.addClass("easyScanLayoutItemWrapper");r.write("aria-setsize="+f.length+" aria-posinset="+h);h++;r.writeClasses();r.write(">");r.renderControl(k);r.write("</div>");});r.write("</div>");});r.write("</div>");r.write("<div class='after' tabindex='0'></div>");r.write("</div>");}}});var g=function(){return[{minWidth:0,styleClass:"columns-blank",columnCount:1},{minWidth:240,styleClass:"columns-block",columnCount:1},{minWidth:352,styleClass:"columns-narrow",columnCount:1},{minWidth:433,styleClass:"columns-wide",columnCount:1},{minWidth:704,styleClass:"columns-narrow",columnCount:2},{minWidth:864,styleClass:"columns-wide",columnCount:2},{minWidth:1024,styleClass:"columns-narrow",columnCount:3},{minWidth:1280,styleClass:"columns-wide",columnCount:3},{minWidth:1440,styleClass:"columns-narrow",columnCount:4},{minWidth:1800,styleClass:"columns-wide",columnCount:4},{minWidth:2560,styleClass:"columns-narrow",columnCount:5},{minWidth:3008,styleClass:"columns-wide",columnCount:5},{minWidth:3600,styleClass:"columns-narrow",columnCount:4},{minWidth:3840,styleClass:"columns-wide",columnCount:4},{minWidth:5120,styleClass:"columns-wide",columnCount:5},{minWidth:6016,styleClass:"columns-wide",columnCount:5}];};E.prototype.init=function(){this.data("sap-ui-fastnavgroup","true",true);this.columnResolutionList=g();this.columnCount=this.columnResolutionList[0].columnCount;this.columnStyle="";this.updateColumnClass(this.columnResolutionList[0].styleClass);var d=sap.ui.Device.browser.msie&&sap.ui.Device.browser.version>9;if(d&&this.getUseMediaQueries()){this.mediaQueryList=this.initMediaListeners(this.columnResolutionList);}else{this.resizeHandlerId=this.initResizeHandler(this.columnResolutionList);}};var m;var a=function(d,e,f){var h=function(i,j){this.updateColumnClass(j);this.refreshColumnCount(i,this.getContent());};if(f.matches){window.clearTimeout(m);m=window.setTimeout(h.bind(this,d,e),this.getDebounceTime());}};var b=function(d,t){var e=d.minWidth;var f=t&&t.minWidth;return"(min-width: "+e+"px)"+(f?" and (max-width: "+(f-1)+"px)":"");};E.prototype.initMediaListeners=function(d){var e=[];for(var i=0;i<d.length;i++){var f=b(d[i],d[i+1]);var h=window.matchMedia(f);var j=a.bind(this,d[i].columnCount,d[i].styleClass);h.addListener(j);h.bindedListener=j;j(h);e.push(h);}return e;};E.prototype.initResizeHandler=function(d){var r;var e=this.getDebounceTime();var f=function(){window.clearTimeout(r);r=window.setTimeout(this.oControl.resizeHandler.bind(this,d),e);};return sap.ui.core.ResizeHandler.register(this,f);};E.prototype.resizeHandler=function(d){var w=this.iWidth;var t=this;var C=this.oControl;var r;if(q(".sapFDynamicPageContent").length>0){w=window.innerWidth;}for(var i=0;i<d.length;i++){if(!d[i+1]){r=d[i];break;}if(d[i].minWidth<=w&&d[i+1].minWidth>w){r=d[i];break;}}C.refreshColumnCount(r.columnCount,C.getContent(),t);C.updateColumnClass(r.styleClass);};E.prototype.getColumnWidth=function(s){var d;switch(s){case"columns-blank":d=0;break;case"columns-narrow":d=20;break;case"columns-wide":d=25;break;}return d;};E.prototype.refreshColumnCount=function(d,e,t){this.columnCount=d;var f=q();for(var i=0;i<d;i++){f=f.add("<div class='easyScanLayoutColumn'/>");}var h=e.filter(function(k){return k.getVisible();});var n=1;for(var j=0;j<h.length;j++){q(h[j].getDomRef()).parent().attr('aria-posinset',n);n++;f.get(j%d).appendChild(h[j].getDomRef().parentNode);}this.$().children(".sapUshellEasyScanLayoutInner").empty().append(f);if(t&&t.iWidth){this.headerMargin(t);}};E.prototype.headerMargin=function(t){var d=0,e=0;var w=t.iWidth;var r,f,h,s=0,j,v=0;var k=g();var l=c.getPixelPerRem();var n=(window.innerWidth*1.0)/l;if(q(".sapFDynamicPageContent").length>0){w=window.innerWidth;}for(var i=0;i<k.length;i++){if(!k[i+1]){r=k[i];break;}if(k[i].minWidth<=w&&k[i+1].minWidth>w){r=k[i];break;}}j=this.getColumnWidth(r.styleClass);h=(r.columnCount*j+(r.columnCount-1)*1);if(sap.ui.Device.system.desktop){s=q('.sapFDynamicPageScrollBar').css('width');if(typeof s==="string"||s instanceof String){v=s.length>0?parseInt(s.split("px")[0],10):0;}s=(v*1.0)/l;}f=(n-s-h)/2;q('.sapFDynamicPageTitle').css({"margin-left":f+"rem","margin-right":f+"rem","visibility":"visible"});q('.sapFDynamicPageHeader').css({"margin-left":f+"rem","margin-right":f+"rem","visibility":"visible"});if(sap.ui.Device.system.desktop){n=q("body").width();if(q(".sapFDynamicPageContentFitContainer").length>0){d=q(".sapFDynamicPageContentFitContainer")[0].clientWidth;}if(n===d){var o=q('.sapFDynamicPageTitle').css('margin-left');var p=q('.sapFDynamicPageTitle').css('margin-right');if(typeof o==="string"||o instanceof String){o=o.length>0?parseInt(o.split("px")[0],10):0;}if(typeof p==="string"||p instanceof String){p=p.length>0?parseInt(p.split("px")[0],10):0;}s=q('.sapFDynamicPageScrollBar').css('width');if(typeof s==="string"||s instanceof String){v=s.length>0?parseInt(s.split("px")[0],10):0;}s=v;e=s/2;o=(o+e)/(l*1.0);p=(p+e)/(l*1.0);q('.sapFDynamicPageTitle').css({"margin-left":o+"rem","margin-right":p+"rem","visibility":"visible"});q('.sapFDynamicPageHeader').css({"margin-left":o+"rem","margin-right":p+"rem","visibility":"visible"});}}};E.prototype.getColumnCount=function(){return this.columnCount;};E.prototype.getVisibleLayoutItems=function(){var d=this.getContent();var f=d.filter(function(i){return i.getVisible();});return f;};E.prototype.updateColumnClass=function(d){if(this.columnStyle===d){return;}this.removeStyleClass(this.columnStyle);this.addStyleClass(d);this.columnStyle=d;};E.prototype.afterDragAndDropHandler=function(e){var A=this.removeAllAggregation("content",true);var v=[];var V=0;e.forEach(function(d,f){var h=d.children[0].getAttribute("id");var C=sap.ui.getCore().byId(h);v.push(C);q(d).attr('aria-posinset',f+1);});for(var i=0;i<A.length;i++){if(A[i].getVisible()){this.addAggregation("content",v[V],true);V++;}else{this.addAggregation("content",A[i],true);}}this.fireAfterDragEnds();this.refreshColumnCount(this.getColumnCount(),this.getContent());};E.prototype.onAfterRendering=function(){if(!this.getDragAndDropRootSelector()){this.setDragAndDropRootSelector("#"+this.getId());}if(this.layoutDragAndDrop){this.layoutDragAndDrop.destroy();}if(this.getDragAndDropEnabled()){this.layoutDragAndDrop=D.buildReplaceItemsInstance({afterReplaceElements:this.afterDragAndDropHandler.bind(this),rootSelector:this.getDragAndDropRootSelector(),layout:this});}if(this.keyboardNavigation){this.keyboardNavigation.destroy();}var s=this.layoutDragAndDrop?this.layoutDragAndDrop.getSwapItemsFunction():null;this.keyboardNavigation=new K(this,s);this.fireAfterRendering();};E.prototype.exit=function(){if(this.mediaQueryList){this.mediaQueryList.forEach(function(d){d.removeListener(d.bindedListener);});delete this.mediaQueryList;}if(this.resizeHandlerId){sap.ui.core.ResizeHandler.deregister(this.resizeHandlerId);}if(this.layoutDragAndDrop){this.layoutDragAndDrop.destroy();delete this.layoutDragAndDrop;}};return E;},true);
