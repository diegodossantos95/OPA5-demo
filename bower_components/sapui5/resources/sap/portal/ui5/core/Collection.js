"use strict";jQuery.sap.require('sap.portal.ui5.core.Object');jQuery.sap.require('sap.portal.ui5.core.PropertyObserver');jQuery.sap.declare('sap.portal.ui5.core.Collection');sap.portal.ui5.core.Object.extend('sap.portal.ui5.core.Collection',{metadata:{properties:{items:{type:'any',defaultValue:null},itemType:{type:'string',defaultValue:null},castItems:{type:'boolean',defaultValue:false},autoDestroyItems:{type:'boolean',defaultValue:false}},events:{itemAdded:{},itemRemoved:{},itemModified:{},itemReplaced:{},collectionModified:{},collectionReplaced:{},beforeCollectionReplaced:{},}},aCollection:null,init:function init(){this.aCollection=this.factoryCollection();if(this._super){this._super.apply(this,arguments);}},factoryCollection:function factoryCollection(){return[];},_processCollection:sap.portal.ui5.core.PropertyObserver(['items'],function processCollection(k,c,o,O){this.fireEvent('beforeCollectionReplaced',{newValue:c,oldValue:o});if(c===null&&o===null){c=this.factoryCollection();}if(!jQuery.isArray(c)){throw new TypeError('Given collection items is not array');}if(o){this.removeItems(o);}this.aCollection=c;this.addItems(c,0);O.updatePropertyValue(c);this.fireEvent('collectionReplaced',{newValue:c,oldValue:o});}).callOnInit(),validateContentItemType:function validateContentItemType(i){var t=this.getItemType();if(jQuery.type(i)===t){return true;}var I=jQuery.sap.getObject(t);switch(true){case typeof(I)==='function':return(i instanceof I);default:throw new Error('Path: '+t+' is not function');}},castItem:function castItem(i){var t=this.getItemType();if(jQuery.isPlainObject(i)&&i.uctype){t=i.uctype;delete i.uctype;}var c=jQuery.sap.getObject(t),r=i;if(!c){jQuery.sap.require(t);c=jQuery.sap.getObject(t);}switch(true){case typeof(c)==='function':r=new c(i);break;default:throw new Error('Path: '+t+' is not function');}if(!this.validateContentItemType(r)){throw new Error;}return r;},getLength:function getLength(){return this.aCollection.length;},addItems:function addItems(n,s){if(!jQuery.isArray(n)){throw new TypeError();}var i,I,l=n.length,s=(s===undefined?this.getLength():s);for(i=0;i<l;i++){I=n[i];this.addByIndex(s++,I);}return true;},removeItems:function removeItems(i){if(!jQuery.isArray(i)){throw new TypeError();}var I,o,l=i.length,r;for(I=0;I<l;I++){o=i[I];r=this.indexOf(o);if(r===-1){continue;}this.removeByIndex(r);}return true;},addItem:function addItem(i){return this.addItems([i]);},removeItem:function removeItem(i){return this.removeItems([i]);},addByIndex:function addByIndex(i,I){if(this.getItemType()&&!this.validateContentItemType(I)){var t=this.getItemType();if(!this.getCastItems()){throw new TypeError('Item #'+i+' '+String(I)+' is not type of '+t);}try{I=this.castItem(I);}catch(e){var E=new Error('Unable to cast item #'+i+' '+String(I)+' into '+t+': '+e.message);E.parent=e;throw E;}}this.observeItemModifications(I);var c=this.aCollection,C=c.length;if(i<0){throw new Error('Out of range');}else if((C-1)<i||i===0){c[i]=I;this.fireEvent('_change',{"id":this.getId(),"name":'items.length',"oldValue":C,"newValue":c.length});this.fireEvent('itemAdded',{index:i,item:I});this.fireEvent('collectionModified',{action:'itemAdded',index:i,item:I});}else{var o=c.splice(i,1,I)[0];this.fireEvent('itemReplaced',{index:i,item:I,oldItem:o});this.fireEvent('collectionModified',{action:'itemReplaced',index:i,item:I});}},removeByIndex:function removeByIndex(i){var I=this.getItemAtIndex(i),c=this.aCollection;var C=c.length;if(i<0||!(i<C)){throw new Error('out of range');}this.unobserveItemModifications(I);c.splice(i,1);this.fireEvent('_change',{"id":this.getId(),"name":'items.length',"oldValue":C,"newValue":c.length});this.fireEvent('itemRemoved',{index:i,item:I});this.fireEvent('collectionModified',{action:'itemRemoved',index:i,item:I});return true;},getItemAtIndex:function getItemAtIndex(i){return this.aCollection[i];},indexOf:function indexOf(i){var c=this.aCollection;if(c.indexOf instanceof Function){return c.indexOf(i);}else if(c instanceof Array){return jQuery.indexOf(i);}else{throw new Error;}},lastIndexOf:function lastIndexOf(i){var c=this.aCollection;if(c.lastIndexOf instanceof Function){return c.lastIndexOf(i);}else if(c instanceof Array){return jQuery.lastIndexOf(i);}else{throw new Error;}},notifyItemModification:function notifyItemModification(e){var i=e.getSource(),p=e.getParameters(),P=e.getParameter('name');var I=this.indexOf(i);this.fireEvent('itemModified',{oldValue:p.oldValue,newValue:p.newValue,index:I,property:P,target:this});this.fireEvent('collectionModified',{action:'itemModified',index:I,property:P,item:i});},observeItemModifications:function observeItemModifications(i){if(i instanceof sap.ui.base.EventProvider){i.attachEvent('_change',this.notifyItemModification.bind(this));}},unobserveItemModifications:function unobserveItemModifications(i){},forEach:function forEach(c){if(typeof(c)!=='function'){throw new TypeError;}var C=this.aCollection,i,l=C.length,r=[];for(i=0;i<l;i++){r.push(c.call(this,C[i],i));}return r;},queryBy:function queryBy(c){if(typeof(c)!=='function'){throw new TypeError;}var C=this.aCollection,i,l=C.length,r=[];for(i=0;i<l;i++){if(c.call(this,C[i],i)===true){r.push(C[i]);}}return r;},findBy:function findBy(c,f){if(typeof(c)!=='function'){throw new TypeError;}var C=this.aCollection,i,l=C.length;for(i=(f||0);i<l;i++){if(c.call(this,C[i],i)===true){return i;}}return-1;},findByProperty:function findByProperty(p,v){return this.findBy(function fnIterator(i){if(i instanceof sap.ui.base.ManagedObject){return(i.getProperty(p)===v);}else if(i instanceof Object&&i!==null){return(i[p]===v);}else{throw new TypeError;}});},getByProperty:function getByProperty(p,v){var c=this.aCollection,i,I,l=c.length;for(I=0;I<l;I++){i=c[I];if(i instanceof sap.ui.base.ManagedObject){if(i.getProperty(p)===v){return i;}}else if(i instanceof Object&&i!==null){if(i[p]===v){return i;}}else{throw new TypeError;}}return undefined;},queryByProperty:function queryByProperty(p,v){return this.queryBy(function fnIterator(i){if(i instanceof sap.ui.base.ManagedObject){return(i.getProperty(p)===v);}else if(i instanceof Object&&i!==null){return(i[p]===v);}else{throw new TypeError;}});},destroy:function destroy(){var p=[],s=this._super.bind(this,arguments),i=this.getId();if(this.getAutoDestroyItems()){p.push(this.destroyItems());}return jQuery.when.apply(jQuery,p).always(function(){return s();});},destroyItems:function destroyItems(){var c=this.aCollection,i,I,l=c.length,p=[];for(I=0;I<l;I++){i=c[I];if(i instanceof sap.ui.base.ManagedObject||(typeof(i)==='object'&&i!==null&&typeof(i.destroy)==='function')){p.push(i.destroy());}}return jQuery.when.apply(jQuery,p);}});
