sap.ui.define(["sap/ushell/services/_Personalization/constants","sap/ushell/services/_Personalization/constants.private","jquery.sap.global"],function(s,i,q){"use strict";return Object.create(null,{PersonalizationAdapter:{value:P},getStorageResourceRoot:{value:g},getContainerUrl:{value:a},delAdapterContainer:{value:d},createContainerData:{value:c},getAdapterContainer:{value:A},getContainerCategory:{value:e},isCategoryPContainer:{value:f},trimContainerKey:{value:t},save:{value:h},load:{value:l},del:{value:j},clearContainerData:{value:k},getItemKeys:{value:o},containsItem:{value:p},setItemValue:{value:r},getItemValue:{value:u},delItem:{value:v},addPrefixToItemKey:{value:m},stripPrefixFromItemKey:{value:n}});function P(H,C,S,w,x){var y;x=x&&x.config;if(!x){throw new Error("PersonalizationAdapter: missing configuration.");}if(!C){C=Object.create(null);}y=g(x);return Object.create(null,{getAdapterContainer:{value:A.bind(null,C,H,y)},delAdapterContainer:{value:d.bind(null,C,H,y)}});}function g(C){var R=!C||!C.storageResourceRoot;if(R){throw new Error("Configuration error: storage resource root is not defined.");}return C.storageResourceRoot;}function a(S,C,w){var x=w+"/"+e(S)+"/"+encodeURIComponent(t(C))+".json";return x.replace(/(https?:)?\/{2,}/g,function($,y){return(y||"")+(y?"\/\/":"\/");});}function t(C){var w=i.S_CONTAINER_PREFIX,x,R;if(q.type(C)!=="string"||C.length===0){throw new Error("Personalization container key must be a non-empty string");}if(C.substring(0,w.length)===w){x=C.substring(w.length);}else{q.sap.log.error("Unexpected personalization container key: "+C,"should always be prefixed with "+w,"sap.ushell.adapters.cdm.PersonalizationAdapter");x=C;}if(x.length<=40){R=x;}else{R=x.substring(0,40);q.sap.log.error("Invalid personalization container key: '"+x+"'"+" exceeds maximum key length (40 characters) and is shortened to '"+R+"'",undefined,"sap.ushell.adapters.cdm.PersonalizationAdapter");}return R;}function b(){return{validity:Infinity,keyCategory:s.keyCategory.GENERATED_KEY,writeFrequency:s.writeFrequency.HIGH,clientStorageAllowed:false};}function d(C,H,U){var w=C&&C[U];if(w){delete C[U];}return j(H,U);}function c(S,w){var C;if((!w&&w!=="")||w.constructor!==String){q.sap.log.warning("Personalization container has an invalid app name; must be a non-empty string",null,"sap.ushell.adapters.cdm.PersonalizationAdapter");}if(!S){S=b();}C=Object.create(null,{__metadata:{value:Object.create(null,{loaded:{value:false,enumerable:false,writable:true},appName:{value:w,enumerable:true},created:{value:(new Date()).toISOString(),enumerable:true,writable:true},validity:{value:S.validity,enumerable:true,writable:true},category:{value:e(S),enumerable:true}}),enumerable:true}});return C;}function A(C,H,S,w,x,y){var z,U=a(x,w,S);if(C&&C[U]){return C[U];}z=c(x,y);return Object.create(null,{save:{value:h.bind(null,H,z,U)},load:{value:l.bind(null,H,z,U)},del:{value:j.bind(null,H,z,U)},getItemKeys:{value:o.bind(null,z)},containsItem:{value:p.bind(null,z)},setItemValue:{value:r.bind(null,z)},getItemValue:{value:u.bind(null,z)},delItem:{value:v.bind(null,z)},_containerData:{value:z},_containerKey:{value:w}});}function e(S){return f(S)?"p":"u";}function f(S){return S&&S.keyCategory===s.keyCategory.FIXED_KEY&&S.writeFrequency===s.writeFrequency.LOW&&S.clientStorageAllowed;}function h(H,C,U){return new q.Deferred(function(D){H.put(U,{data:C}).then(function(R){if(R.status===200){var w=JSON.parse(R.responseText);C.validity=w.validity;C.items=w.items;C.created=w.created;}D.resolve();}).catch(function(R){q.sap.log.error("Failed to save personalization container; response: "+(typeof R==="object"?JSON.stringify(R):R),R.stack?R.stack:null,"sap.ushell.adapters.cdm.PersonalizationAdapter");D.reject(R);});}).promise();}function l(H,C,U){return new q.Deferred(function(D){H.get(U).then(function(R){var w=JSON.parse(R.responseText);C.validity=w.validity;C.items=w.items;C.created=w.created;D.resolve();}).catch(function(R){k(C);if(R.status===404){D.resolve();}else{D.reject(R);}});}).promise();}function j(H,U){return new q.Deferred(function(D){H.delete(U).then(function(){D.resolve();}).catch(function(R){D.reject(R);});}).promise();}function k(C){Object.keys(C).forEach(function(K){if(K!=="__metadata"){delete C[K];}})}function m(K){if(K==="__metadata"){return undefined;}else if(K.indexOf(i.S_VARIANT_PREFIX)===0||K.indexOf(i.S_ADMIN_PREFIX)===0){return K;}else{return i.S_ITEM_PREFIX+K;}}function n(K){if(K.indexOf(i.S_ITEM_PREFIX)===0){return K.substring(i.S_ITEM_PREFIX.length);}else if(K.indexOf(i.S_VARIANT_PREFIX)===0||K.indexOf(i.S_ADMIN_PREFIX)===0){return K;}else{throw new Error(["Illegal item key for personalization container: '",K,"'; must be prefixed with one of the following: [",i.S_ITEM_PREFIX,", ",i.S_VARIANT_PREFIX,", ",i.S_ADMIN_PREFIX,"] "].join(""));}}function o(C){return Object.keys(C).map(m).filter(function(K){return!!K});}function p(C,K){return C.hasOwnProperty(n(K));}function r(C,K,V){C[n(K)]=V;}function u(C,K){return C[n(K)];}function v(C,K){delete C[n(K)];}});
