// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(['sap/ushell/utils'],function(u){"use strict";var m;var P=function(U,a,A){this._sStorageType=jQuery.sap.getObject("config.storageType",undefined,A)||P.prototype.constants.storage.LOCAL_STORAGE;switch(this._sStorageType){case P.prototype.constants.storage.LOCAL_STORAGE:sap.ui.require(['jquery.sap.storage']);break;case P.prototype.constants.storage.MEMORY:m=jQuery.sap.getObject("config.personalizationData",undefined,A)||{};break;default:throw new u.Error("Personalization Adapter Local Platform: unsupported storage type '"+this._sStorageType+"'");}};P.prototype.constants={"storage":{"MEMORY":"MEMORY","LOCAL_STORAGE":"LOCAL_STORAGE"}};P.prototype.getAdapterContainer=function(C){return new sap.ushell.adapters.local.AdapterContainer(C,this._sStorageType);};P.prototype.delAdapterContainer=function(C){return this.getAdapterContainer(C).del();};sap.ushell.adapters.local.AdapterContainer=function(C,S){this._sContainerKey=C;this._sStorageType=S;this._oItemMap=new u.Map();};function g(){return jQuery.sap.storage(jQuery.sap.storage.Type.local,"com.sap.ushell.adapters.sandbox.Personalization");}function p(j){try{return JSON.parse(j);}catch(e){return undefined;}}function s(j){return JSON.stringify(j);}function c(j){if(j===undefined){return undefined;}try{return JSON.parse(JSON.stringify(j));}catch(e){return undefined;}}sap.ushell.adapters.local.AdapterContainer.prototype.load=function(){var d=new jQuery.Deferred(),l,i,t=this;switch(this._sStorageType){case P.prototype.constants.storage.LOCAL_STORAGE:l=g();setTimeout(function(){i=l.get(t._sContainerKey);t._oItemMap.entries=p(i)||{};d.resolve(t);},0);break;case P.prototype.constants.storage.MEMORY:setTimeout(function(){t._oItemMap.entries=c(m[t._sContainerKey])||{};d.resolve(t);},0);break;default:setTimeout(function(){d.reject("unknown storage type");},0);}return d.promise();};sap.ushell.adapters.local.AdapterContainer.prototype.save=function(){var d=new jQuery.Deferred(),l,i,t=this;switch(this._sStorageType){case P.prototype.constants.storage.LOCAL_STORAGE:l=g();setTimeout(function(){i=s(t._oItemMap.entries);l.put(t._sContainerKey,i);d.resolve();},0);break;case P.prototype.constants.storage.MEMORY:setTimeout(function(){m[t._sContainerKey]=c(t._oItemMap.entries);d.resolve();},0);break;default:setTimeout(function(){d.reject("unknown storage type");},0);}return d.promise();};sap.ushell.adapters.local.AdapterContainer.prototype.del=function(){var d=new jQuery.Deferred(),l,t=this;switch(this._sStorageType){case P.prototype.constants.storage.LOCAL_STORAGE:l=g();setTimeout(function(){l.remove(t._sContainerKey);t._oItemMap.entries={};d.resolve();},0);break;case P.prototype.constants.storage.MEMORY:setTimeout(function(){if(m&&m[t._sContainerKey]){delete m[t._sContainerKey];}t._oItemMap.entries={};d.resolve();},0);break;default:setTimeout(function(){d.reject("unknown storage type");},0);}return d.promise();};sap.ushell.adapters.local.AdapterContainer.prototype.getItemKeys=function(){return this._oItemMap.keys();};sap.ushell.adapters.local.AdapterContainer.prototype.containsItem=function(i){return this._oItemMap.containsKey(i);};sap.ushell.adapters.local.AdapterContainer.prototype.getItemValue=function(i){return this._oItemMap.get(i);};sap.ushell.adapters.local.AdapterContainer.prototype.setItemValue=function(i,I){this._oItemMap.put(i,I);};sap.ushell.adapters.local.AdapterContainer.prototype.delItem=function(i){this._oItemMap.remove(i);};return P;},true);
