sap.ui.define(function(){"use strict";var C=function(s){this.init(s);};C.prototype={settings:null,tileWidth:0,tileHeight:0,tileMargin:0,curTouchMatrixCords:null,tilesInRow:null,groupsList:null,item:null,matrix:null,tiles:null,collisionLeft:false,startGroup:null,currentGroup:null,endGroup:null,init:function(s){this.curTouchMatrixCords={column:null,row:null};this.endGroup=null;this.groupSwitched=false;this.item=null;this.matrix=null;this.tiles=null;this.collisionLeft=false;this.startArea=null;this.currentArea=null;this.endArea=undefined;this.startGroup=null;this.draggedTileDomRef=null;this.sDragStartGroupModelId=undefined;this.sDragTargetGroupModelId=undefined;this.currentGroup=null;this.groupsList=null;this.allGroups=null;this.settings=this.settings||s;jQuery.extend(this,this.settings);this.tileWidth=this.thisLayout.styleInfo.tileWidth;this.tileHeight=this.thisLayout.styleInfo.tileHeight;this.tileMargin=this.thisLayout.styleInfo.tileMarginWidth;this.aExcludedControlClass=this.aExcludedControlClass||[];this.reorderElementsCallback=this.reorderElementsCallback||function(){};this.rightToLeft=sap.ui.getCore().getConfiguration().getRTL();this.tabBarArrowCollisionRight=false;this.tabBarArrowCollisionLeft=false;this.collidedLinkAreas=[];this.intersectedLink=null;this.aLinksBoundingRects=[];this.intersectedLinkPlaceHolder=undefined;this.isLinkPersonalizationSupported=sap.ushell.Container?sap.ushell.Container.getService("LaunchPage").isLinkPersonalizationSupported():null;this.isLinkMarkerShown=false;this.bIsTabBarCollision=false;},isTabBarCollision:function(){return this.bIsTabBarCollision;},moveDraggable:function(m,b,t){var c=this.getCollisionObject(m,b,t),n;if(c){this._toggleAnchorItemHighlighting(false);if(c.collidedObjectType!=="TabBar"){this._toggleTabBarOverflowArrows(false);this.thisLayout.setOnTabBarElement(false);this._resetOverFlowButtonElements();this.bIsTabBarCollision=false;}else{this.bIsTabBarCollision=true;this._toggleTabBarOverflowArrows(true);this.removePlaceHolders();this._handleTabBarCollision(m,t);}if(this.isLinkPersonalizationSupported&&c.collidedObjectType==="Group-link"){n=this._handleLinkAreaIntersection(c.collidedObject,m,b);}else if(c.collidedObjectType==="Group-tile"){n=this._handleTileAreaIntersection(c.collidedObject,m,b);this._toggleTileCloneHoverOpacity(false);}if(n||this.endAreaChanged){this.handlePlaceHolder(c.collidedObject);}}else{this._removeEmptyLinkAreaMark();}},_toggleAnchorItemHighlighting:function(h){if(this.targetGroup){this.targetGroup.classList.toggle('sapUshellAnchorItemDropCollision',h);this.targetGroup.firstElementChild.classList.toggle('sapUshellAnchorInnerMarker',h);}},removePlaceHolders:function(){this._removeLinkDropMarker();this._removeEmptyLinkAreaMark();this._handleChangedGroup(this.currentGroup);},handlePlaceHolder:function(c){if(this.endArea==="tiles"){if(this.endAreaChanged){this._removeLinkDropMarker();}this.handlePlaceholderChange();}else if(this.endArea==="links"&&this.intersectedLink){this._changeLinkPlaceholder(this.intersectedLink,c);if(this.endAreaChanged){this.handlePlaceholderChange();}}},switchLinkWithClone:function(i){if(i){this.intersectedLinkPlaceHolder=i.getDomRef().cloneNode(true);this.intersectedLinkPlaceHolder.id="sapUshellIntersectedLinkPlaceHolder";jQuery(i.getDomRef()).replaceWith(this.intersectedLinkPlaceHolder);}},_removeLinkDropMarker:function(){jQuery("#sapUshellLinkDropMarker").remove();this.isLinkMarkerShown=false;},saveLinkBoundingRects:function(e){var l=sap.ui.getCore().byId(e.id);this.draggedLinkBoundingRects=l.getBoundingRects();},_getMarkerOffset:function(r,c){var n=jQuery(c.getDomRef()).find(".sapUshellLineModeContainer")[0].getBoundingClientRect().left,b=jQuery(c.getDomRef()).find(".sapUshellLineModeContainer")[0].getBoundingClientRect().top,d=this.rightToLeft?20:-1,e=this.rightToLeft?42:21,f=r[r.length-1].offset.x-n+r[r.length-1].width-d,l=r[this.rightToLeft?r.length-1:0].offset.x-n-e,t=r[this.rightToLeft?r.length-1:0].offset.y-b,g=r[this.rightToLeft?0:r.length-1].offset.y-b;if(jQuery("body.sapUiSizeCompact").length){t-=6;g-=6;}if(this.rightToLeft){if(jQuery(c.getDomRef()).find(".sapUshellLineModeContainer")[0].getBoundingClientRect().right-r[r.length-1].offset.x-r[r.length-1].width<16){f=f-8;}}else if(l<16){l=0;}return{right:f,left:l,topLeft:t,topRight:g};},_changeLinkPlaceholder:function(l,c){var o=this.aLinksBoundingRects[l.link.getId()],b=o.left,t=o.topLeft,d=o.topRight,r=o.right;if(jQuery(c.getDomRef()).find("#sapUshellLinkDropMarker").length===0){this._removeLinkDropMarker();jQuery(c.getDomRef()).find(".sapUshellLinksInnerContainer").prepend(this.LinkDropMarker);}jQuery(this.LinkDropMarker).css({left:l.leftSide?b:r,top:l.leftSide?t:d});this.isLinkMarkerShown=true;},showTilePlaceholder:function(c,t,T){var b,r=this.curTouchMatrixCords.row,d=this.curTouchMatrixCords.column;this.domRef=this.item.getDomRef()?this.item.getDomRef():this.domRef;jQuery(this.domRef).show();this.removeExcludedElementsFromMatrix(this.aExcludedControlClass);b=this.tiles||this.thisLayout.getGroupTiles(this.endGroup).slice(0);if(this.matrix[r]&&typeof this.matrix[r][d]==="object"){this.handleMatrixCollision(b,c,t,T);return;}this._handleMoveOutOfBorders(b,c);},removeTilePlaceholder:function(g,A){var c,b,h,f=function(){if(this.thisLayout.isAnimationsEnabled()){this.thisLayout.initGroupDragMode(this.endGroup);b=this.thisLayout.organizeGroup(c);this.thisLayout.renderLayoutGroup(this.currentGroup,b);}}.bind(this);this.domRef=this.item.getDomRef()?this.item.getDomRef():this.domRef;c=this.thisLayout.getGroupTiles(this.currentGroup);c=c.slice(0);if(this.startArea!=='links'&&c.indexOf(this.item)>-1){c.splice(c.indexOf(this.item),1);}if(!jQuery(this.domRef.parentNode).hasClass("sapUshellLinksInnerContainer")){jQuery(this.domRef).hide();}if(A){h=jQuery(this.currentGroup.getDomRef()).find(".sapUshellTilesContainer-sortable").height()-jQuery(this.domRef).height();this.collidedLinkAreas=[];jQuery(this.currentGroup.getDomRef()).find(".sapUshellTilesContainer-sortable").animate({height:h},300,f);}else{f();}},handlePlaceholderChange:function(){var c=this.currentGroup,t=(this.endGroup!==this.currentGroup),T=this.endAreaChanged&&this.endArea==='links',i=this.thisLayout.isTabBarActive()&&this.groupSwitched,A=false,m=this.matrix[this.matrix.length-1];if(this.item&&m[0]){if(!m[1]){A=true;}if(m[0].getLong&&m[0].getLong()&&m[1]&&!m[2]){A=true;}}this.tiles=this.thisLayout.getGroupTiles(this.endGroup).slice(0);this.matrix=this.thisLayout.organizeGroup(this.tiles);if(i){this.handleTabBarSwitch(c);}if(t){this._handleChangedGroup(c);}else if(T){this.removeTilePlaceholder(undefined,A);}if(!T){this.showTilePlaceholder(c,t,T);}},handleMatrixCollision:function(t,c,T,b){var r,d,e,n;r=this.matrix[this.curTouchMatrixCords.row][this.curTouchMatrixCords.column];d=t.indexOf(r);e=t.indexOf(this.item);if(this.rightToLeft){this.collisionLeft=!this.collisionLeft;}if(e>-1&&e<d){r=t[d+1];}if(r===this.item){if(T||b){t.splice(t.indexOf(this.item),1);}this._handleTileReplace(t,c);return;}n=this.changeTilesOrder(this.item,r,t,this.matrix);if(n&&!this.isLinkMarkerShown){this._handleTileReplace(n,c);}},handleTabBarSwitch:function(c){var b=this.thisLayout.getGroupTiles(c),d;this._appendTargetGroupDomRefWithDraggedTile();if(!this.item.getDomRef()){this.endGroup.getInnerContainersDomRefs()[0].appendChild(this.draggedTileDomRef);}else{this.endGroup.getInnerContainersDomRefs()[0].appendChild(this.item.getDomRef());}this.currentGroup=this.endGroup;if(this.thisLayout.isAnimationsEnabled()){this.thisLayout.initGroupDragMode(this.endGroup);d=this.thisLayout.organizeGroup(b);this.thisLayout.renderLayoutGroup(c,d);}},_handleMoveOutOfBorders:function(t,c){var m=this.findTileToPlaceAfter(this.matrix,t),r;if(t[m+1]==this.item){return;}if(t[m+1]){r=t[m+1];}else if(this.currentGroup.getShowPlaceholder()){r=t[0];}var n=this.changeTilesOrder(this.item,r,t,this.matrix);if(n){this._handleTileReplace(n,c);}},_handleChangedGroup:function(c){var b=this.thisLayout.getGroupTiles(this.currentGroup),i;if(this.currentGroup===this.startGroup&&(this.startArea==="tiles"||this.intersectedLinkPlaceHolder)){b=b.slice(0);if(b.indexOf(this.item)>-1){b.splice(b.indexOf(this.item),1);}}if(this.startGroup===this.endGroup&&this.startArea==="tiles"){this.tiles.splice(this.tiles.indexOf(this.item),1);}i=this.item.getDomRef()||this.domRef;if(this.startArea==="links"&&!this.intersectedLinkPlaceHolder){this.switchLinkWithClone(this.item);}if(this.endArea==='tiles'){this.endGroup.getInnerContainersDomRefs()[0].appendChild(i);}if(!jQuery(i.parentNode).hasClass("sapUshellLinksInnerContainer")){jQuery(i).hide();}this.currentGroup=this.endGroup;if(this.thisLayout.isAnimationsEnabled()){this.thisLayout.initGroupDragMode(this.endGroup);var d=this.thisLayout.organizeGroup(b);this.thisLayout.renderLayoutGroup(c,d);}},_handleTileReplace:function(t,c){this.reorderElementsCallback({currentGroup:c,endGroup:this.endGroup,tiles:t,item:this.item});this.reorderTilesView(t,this.endGroup);this.reorderTilesInDom();if(this.thisLayout.isAnimationsEnabled()){this.thisLayout.renderLayoutGroup(this.endGroup,this.matrix);}},_getIntersectedLink:function(c,m,b){var e=jQuery(".sapUshellLinkTile")[0];if(!e){return;}var d=c.getDomRef().querySelector(".sapUshellLineModeContainer").getBoundingClientRect(),f=!jQuery("body.sapUiSizeCompact").length,r=Math.floor((b-d.top)/(f?45:31)),g=this.collidedLinkAreas[c.getId()],h;if(this.rightToLeft){h=Math.floor((d.right-m)/20);}else{h=Math.floor((m-d.left)/20);}if(r<g.length&&g[r]&&h<g[r].length){return g[r][h];}else if(g.length){var l=g.length;if(r>=l){r=l-1;}if(!this.collidedLinkAreas[c.getId()][r]){return;}h=this.collidedLinkAreas[c.getId()][r].length;return this.collidedLinkAreas[c.getId()][r][h-1];}},_mapGroupLinks:function(c){var g=c.getId(),l,r,R=0;if(!this.collidedLinkAreas[g]||this.bElapseGroupLinksMap){this.bElapseGroupLinksMap=false;var b=c.getLinks(),d=[];this.collidedLinkAreas.push(c.getId());b.forEach(function(i){r=this._getLinkBoundingRects(i,c);r.forEach(function(o){if(o.offset.y>l){R++;}l=o.offset.y;this._addLinkToHashMap(d,c,o,R,i);}.bind(this));}.bind(this));this.collidedLinkAreas[g]=d;}},_getLinkBoundingRects:function(l,c){var r=l.getBoundingRects();if(this.item&&this.item.getId()===l.getId()){r=this.draggedLinkBoundingRects;}if(r.length){this.aLinksBoundingRects[l.getId()]=this._getMarkerOffset(r,c);}return r;},_addLinkToHashMap:function(c,b,r,d,l){if(!c[d]){c[d]=[];}for(var i=0;i<=(r.width+20)/20;i++){var e={link:l,leftSide:!this.rightToLeft};if(i>((r.width+20)/20)/2){e.leftSide=this.rightToLeft;}c[d].push(e);}},_isLinkAreaIntersection:function(c,m,b){var i=c.getInnerContainersDomRefs();if(i[1]){return this._isElementCollideByGivenCordinates(i[1],m,b);}else{return false;}},_isLinksEquals:function(l,o){if(!l||!o){return false;}if(l.link.getId()!==o.link.getId()){return false;}if(l.link.leftSide!==o.link.leftSide){return false;}return true;},_toggleTileCloneHoverOpacity:function(v){jQuery(".sapUshellTile-clone").toggleClass("sapUshellTileDragOpacity",v);},_handleLinkAreaIntersection:function(c,m,b){var i,d=false;if(this.isLinkPersonalizationSupported){this._toggleTileCloneHoverOpacity(true);}this._mapGroupLinks(c);this.matrix=this.matrix||this.thisLayout.organizeGroup(this.thisLayout.getGroupTiles(c));i=this._getIntersectedLink(c,m,b);if(i){d=this._isLinksEquals(this.intersectedLink,i);this.intersectedLink=i;}else{this.removeTilePlaceholder(c);}this._markEmptyLinkArea(c);return d;},_markEmptyLinkArea:function(c){if(!c.getLinks().length){jQuery(c.getDomRef()).find(".sapUshellLineModeContainer").addClass("sapUshellEmptyLinkAreaHover");}},_removeEmptyLinkAreaMark:function(){jQuery(".sapUshellLineModeContainer").removeClass("sapUshellEmptyLinkAreaHover");},reorderTilesInDom:function(){var j=this.item.getDomRef()?this.item.getDomRef():this.domRef,s=jQuery(j).index(),b=jQuery(j).closest(".sapUshellTilesContainer-sortable"),d=this.calcDestIndexInGroup(),c=jQuery(this.endGroup.getDomRef()).find(".sapUshellTilesContainer-sortable"),e=c.find(".sapUshellTile");if(this.startArea==="tiles"){b.find(e[s]).remove();}else if(!this.intersectedLinkPlaceHolder){this.switchLinkWithClone(this.item);}if(this.endArea!=='links'){e=c.find(".sapUshellTile");c[0].insertBefore(j,e[d]);}},isLinkIntersected:function(){return this.intersectedLink!==undefined;},calcDestIndexInGroup:function(){var l,t=0,i,j,I=false;for(i=0;i<this.matrix.length&&!I;i++){for(j=0;j<this.matrix[i].length;j++){if(this.matrix[i][j]!==undefined){if(this.item.sId!==this.matrix[i][j].sId){if(l!==this.matrix[i][j].sId){l=this.matrix[i][j].sId;t++;}}else{I=true;break;}}}}return t;},layoutStartCallback:function(e){this.init();this.item=sap.ui.getCore().byId(e.id);this.tilesInRow=this.thisLayout.getTilesInRow();this.groupsList=this.thisLayout.getGroups();this.allGroups=this.thisLayout.getAllGroups();this.startGroup=this.currentGroup=this.item.getParent();this.groupSwitched=false;this.startArea=this.isLinkPersonalizationSupported&&this.item.getMode&&this.item.getMode()==='LineMode'?"links":"tiles";this.currentArea=this.startArea;if(this.thisLayout.isAnimationsEnabled()){this.thisLayout.initDragMode();}if(this.isLinkPersonalizationSupported){this.LinkDropMarker=this._getLinkDropMarkerElement();}},_getLinkDropMarkerElement:function(){var e=document.createElement("DIV"),b=document.createElement("DIV"),c=document.createElement("DIV");e.setAttribute("id","sapUshellLinkDropMarker");b.setAttribute("id","sapUshellLinkDropMarkerDot");c.setAttribute("id","sapUshellLinkDropMarkerLine");e.appendChild(b);e.appendChild(c);return e;},isAreaChanged:function(){return(this.currentArea&&this.endArea)?this.currentArea!==this.endArea:false;},isOriginalAreaChanged:function(){return(this.startArea&&this.endArea)?this.startArea!==this.endArea:false;},_getDestinationIndex:function(t){if(t==="links"){if(this.intersectedLink){var i=this.endGroup.getLinks().indexOf(this.intersectedLink.link),d=this.endGroup.getLinks().indexOf(this.item);if(this.intersectedLink.leftSide){i=this.rightToLeft?i+1:i-1;}if(d<0||d>i){i=this.rightToLeft?i:i+1;}return i;}else{return this.endGroup.getLinks().length;}}else{return this._getDestinationTileIndex();}},layoutEndCallback:function(){var r,s,d;this._removeLinkDropMarker();if(this.endArea!=="links"&&!this.tiles){return{tile:this.item};}s=this._getDragSourceGroup();d=this._getDestGroupObject(this.targetGroup);r={srcGroup:s,dstGroup:d,dstGroupData:this._getDropTargetGroup(),tile:this.item,dstTileIndex:this._getDestinationIndex(this.endArea),tileMovedFlag:true,srcArea:this.startArea,dstArea:this.bIsTabBarCollision?undefined:this.endArea};return r;},_getDestGroupObject:function($){return $?sap.ui.getCore().byId(($.getAttribute('id'))):this.endGroup;},_getDragSourceGroup:function(){var s;s=this.startGroup;if(this.thisLayout.isTabBarActive()&&(this.groupSwitched===true)){s={groupId:this.sDragStartGroupModelId};}return s;},_getDropTargetGroup:function(){var d;if(this.thisLayout.isTabBarActive()&&this.thisLayout.isOnTabBarElement()){d={groupId:this.sDragTargetGroupModelId};}else{d=this.endGroup;}return d;},_getDestinationTileIndex:function(){var d,m;if(this.thisLayout.isTabBarActive()&&this.thisLayout.isOnTabBarElement()){d=this._getDropTargetGroup().groupId;m=this._getModelGroupById(d);return m.tiles.length;}return this.tiles.indexOf(this.item);},compareArrays:function(b,c){if(b.length!==c.length){return false;}for(var i=0;i<b.length;i++){if(b[i]!==c[i]){return false;}}return true;},reorderTilesView:function(t,g){this.tiles=t;this.matrix=this.thisLayout.organizeGroup(t);},changeTilesOrder:function(i,r,t,m){var n=t.slice(0),d=n.indexOf(i),b,c,e;if(d>-1){n.splice(d,1);}if(r){n.splice(n.indexOf(r),0,this.item);}else{n.push(i);}if(this.currentGroup==this.endGroup){if(this.compareArrays(t,n)){return false;}b=this.thisLayout.organizeGroup(n);c=this.thisLayout.getTilePositionInMatrix(i,m);e=this.thisLayout.getTilePositionInMatrix(i,b);if((c.row==e.row)&&(c.col==e.col)){return false;}}this.tiles=n;this.currentGroup=this.endGroup;return n;},setMatrix:function(n){this.matrix=n;},findTileToPlaceAfter:function(c,t){var x=(this.thisLayout.rightToLeft)?0:this.curTouchMatrixCords.column,I=(this.thisLayout.rightToLeft)?1:-1,m=0,i,j,b,r=c[0].length;for(i=this.curTouchMatrixCords.row;i>=0;i--){for(j=x;j>=0&&j<r;j+=I){if(!c[i]||typeof c[i][j]!=="object"){continue;}b=t.indexOf(c[i][j]);m=b>m?b:m;}x=c[0].length-1;}return m||(t.length-1);},_isElementCollideByGivenCordinates:function(e,m,b){var t=e.getBoundingClientRect(),i=t.right>m&&t.left<m,c=t.bottom>b&&t.top<b;return i&&c;},_getMatrixCordinatesOfTouchedTile:function(c,m,b){var d=jQuery.extend({},this.curTouchMatrixCords),t=c.getInnerContainersDomRefs()[0].getBoundingClientRect();this.matrix=this.matrix||this.thisLayout.organizeGroup(this.thisLayout.getGroupTiles(c));var o=this.rightToLeft?(t.right+(-1)*m):(t.left*(-1)+m),e=(t.top*(-1)+b)/(this.tileHeight+this.tileMargin),f=o/(this.tileWidth+this.tileMargin);d={row:Math.floor(e),column:Math.floor(f)};return d;},_getCollidedGroup:function(m,b){for(var i=0;i<this.groupsList.length;i++){var g=this.groupsList[i],c=g.getInnerContainersDomRefs();for(var j=0;j<c.length;j++){if(c[j]&&this._isElementCollideByGivenCordinates(c[j],m,b)){return g;}}}},_handleTileAreaIntersection:function(c,m,b){var d=this._getMatrixCordinatesOfTouchedTile(c,m,b);if((c===this.endGroup)&&(d.column===this.curTouchMatrixCords.column)&&(d.row===this.curTouchMatrixCords.row)){return false;}if(this.rightToLeft){this.collisionLeft=(this.curTouchMatrixCords.column-d.column)>0;}else{this.collisionLeft=(d.column-this.curTouchMatrixCords.column)>0;}if(d.column===this.curTouchMatrixCords.column){this.collisionLeft=false;}jQuery.extend(this.curTouchMatrixCords,d);return true;},_getGroupCollisionObject:function(m,b){var c,l;c=this._getCollidedGroup(m,b);if(!c||c.getIsGroupLocked()){return undefined;}l=this._isLinkAreaIntersection(c,m,b);this.endGroup=c;if(!this.tiles){this.tiles=this.thisLayout.getGroupTiles(this.endGroup).slice(0);}this.endArea=l?'links':'tiles';this.endAreaChanged=this.isAreaChanged();this.currentArea=this.endArea;return{"collidedObjectType":l?"Group-link":"Group-tile","collidedObject":c};},getCollisionObject:function(m,b){if(this.thisLayout.oTabBarItemClickTimer){clearTimeout(this.thisLayout.oTabBarItemClickTimer);}if(this.thisLayout.isTabBarActive()&&this._isTabBarCollision(b)){return{"collidedObjectType":"TabBar"};}return this._getGroupCollisionObject(m,b);},_isTabBarScrollArea:function(m){var A=jQuery("#anchorNavigationBar").height(),o=jQuery("#anchorNavigationBar").offset(),i=o.top;return((m>A+i)&&(m<A+i+30));},_cancelLongDropTimmer:function(){clearTimeout(this.thisLayout.oTabBarItemClickTimer);},_isTabBarCollision:function(m){var A=jQuery("#anchorNavigationBar").height(),o=jQuery("#anchorNavigationBar").offset(),i=o.top;return(m<A+i&&m>i);},_handleTabBarCollision:function(m,t){var b=this,h=this._getTabBarHoverItem(m,t),T,H,i,d,D;if(sap.ushell.Layout.isTabBarActive()){this._toggleTileCloneHoverOpacity(true);}this.lastHighlitedTabItem=h;this.thisLayout.setOnTabBarElement(true);i=this._handleOverflowCollision(m);if(i){return;}if(!h){return;}this.targetGroup=h;this.sDragTargetGroupModelId=h.getAttribute('modelGroupId');T=this._getTabBarGroupIndexByModelId(this.sDragTargetGroupModelId);if(this.thisLayout.oTabBarItemClickTimer){clearTimeout(this.thisLayout.oTabBarItemClickTimer);}D=this._getModelGroupById(this._getDropTargetGroup().groupId);if(D.isGroupLocked){this._toggleTabBarOverflowArrows(false);this.thisLayout.setOnTabBarElement(false);this._resetOverFlowButtonElements();return;}this._toggleAnchorItemHighlighting(true);if(!this.sDragStartGroupModelId){this.sDragStartGroupModelId=this.startGroup.getGroupId();}this.thisLayout.oTabBarItemClickTimer=setTimeout(function(){var c=b._getSelectedTabBarItem();if(b.lastHighlitedTabItem===c){return;}b.draggedTileModelPath=b.item.getBindingContext().getPath();b._prepareDomForDragAndDrop();b.startGroup.removeAggregation('tiles',b.item,true);d=b.sDragStartGroupModelId===b.sDragTargetGroupModelId;b.item.getBindingContext().oModel.setProperty(b.draggedTileModelPath+"/draggedInTabBarToSourceGroup",d);b.groupSwitched=true;sap.ui.getCore().getEventBus().publish("launchpad","switchTabBarItem",{iGroupIndex:T});var e=b.thisLayout.getGroups();b.endGroup=e[0];b.bElapseGroupLinksMap=true;},800);if((this.tiles===null)&&(this.endGroup)){this.tiles=this.thisLayout.getGroupTiles(this.endGroup).slice(0);}H=jQuery('.sapUshellTabBarHoverOn');H.removeClass('sapUshellTabBarHoverOn');h.classList.add('sapUshellTabBarHoverOn');return true;},_prepareDomForDragAndDrop:function(){if(sap.ui.Device.system.tablet){var c=this.item.$().clone();var $=this.item.$();var b=$.parent();this.origItemId=$.attr("id");this.origItemDataSapUi=$.attr("data-sap-ui");$.removeAttr("id").removeAttr("data-sap-ui");$.hide();c.hide();jQuery("#dashboardGroups").parent().append($);b.append(c);this.draggedTileDomRef=$.get(0);}else if(!this.draggedTileDomRef){this.draggedTileDomRef=this.item.getDomRef();}},_appendTargetGroupDomRefWithDraggedTile:function(){if(!this.item.getDomRef()){if(sap.ui.Device.system.tablet){jQuery(this.draggedTileDomRef).attr("id",this.origItemId);jQuery(this.draggedTileDomRef).attr("data-sap-ui",this.origItemDataSapUi);jQuery(this.draggedTileDomRef).show();}this.endGroup.getInnerContainerDomRef().appendChild(this.draggedTileDomRef);}else{this.endGroup.getInnerContainerDomRef().appendChild(this.item.getDomRef());if(sap.ui.Device.system.tablet){jQuery(this.item.getDomRef()).show();}}},_getSelectedTabBarItem:function(){return jQuery('.sapUshellAnchorItemSelected')[0];},_getTabBarGroupIndexByModelId:function(g){var i,t;for(i=0;i<this.allGroups.length;i++){t=this.allGroups[i].groupId;if(g===t){return i;}}},_getModelGroupById:function(g){var m=this.thisLayout.getAllGroups(),i,t,T;for(i=0;i<m.length;i++){t=m[i];T=t.groupId;if(T===g){return t;}}},_handleOverflowCollision:function(m){var A=sap.ui.getCore().byId("anchorNavigationBar"),o=this._calculateOverflowButtonSideCollision(m);if(o=="right"){if(!this.tabBarArrowCollisionRight){A._scrollToGroupByGroupIndex(A.anchorItems.length-1,5000);this.tabBarArrowCollisionRight=true;}return true;}else if(o=="left"){if(!this.tabBarArrowCollisionLeft){A._scrollToGroupByGroupIndex(0,5000);this.tabBarArrowCollisionLeft=true;}return true;}else{this._resetOverFlowButtonElements();return false;}},_calculateOverflowButtonSideCollision:function(m){var b=jQuery(".sapUshellAnchorRightOverFlowButton"),c=b.offset().left,d=jQuery(".sapUshellAnchorItemOverFlow"),e=d.offset().left,f=jQuery(".sapUshellAnchorLeftOverFlowButton"),g=f.offset().left,h=32,j=jQuery("#anchorNavigationBar"),i=j.offset().left;if(m>c&&m<e){return"right";}if(m>i&&(m<g+h)){return"left";}},_resetOverFlowButtonElements:function(){var t=sap.ui.Device.system.tablet,b=jQuery(t?'.sapUshellAnchorNavigationBarItemsScroll':'.sapUshellAnchorNavigationBarItems');b.stop();this.tabBarArrowCollisionRight=false;this.tabBarArrowCollisionLeft=false;},_toggleTabBarOverflowArrows:function(s){var b=jQuery(".sapUshellAnchorRightOverFlowButton"),c=jQuery(".sapUshellAnchorLeftOverFlowButton");c.toggleClass("sapUshellTabBarOverflowButton",s);b.toggleClass("sapUshellTabBarOverflowButton",s);},_getTabBarHoverItem:function(m,t){var n,l,h,T,H;l=jQuery(".sapUshellAnchorItem:not(.sapUshellShellHidden)").first().offset().left;if(m-l<=0){return;}n=Math.round((m-l)/10);if(n>=t.length){n=t.length-1;}h=t[n];T=jQuery(".sapUshellAnchorItem");H=T[h];return H;},removeExcludedElementsFromMatrix:function(e){if(!e.length){return;}if(!this.matrix){return;}var n=this.matrix.map(function(r){return r.map(function(i){var b=e.some(function(c){return i instanceof c;});return(b)?undefined:i;});});this.setMatrix(n);},setExcludedControl:function(c){if(c){this.aExcludedControlClass.push(c);}},setReorderTilesCallback:function(f){if(typeof f==="function"){this.reorderElementsCallback=f;}}};var L=function(){};L.prototype={_initDeferred:jQuery.Deferred(),init:function(c){var t=function(){var s=this.getStyleInfo(this.container);if(s.tileWidth>0){this.isInited=true;this.reRenderGroupsLayout();this.layoutEngine=new C({thisLayout:this});this._initDeferred.resolve();return;}setTimeout(t,100);}.bind(this);this.cfg=c||this.cfg;this.cfg.animationsEnabled=!!this.cfg.animationsEnabled;this.minTilesinRow=2;this.container=this.cfg.container||document.getElementById('dashboardGroups');this.oTabBarItemClickTimer=new Date();this.bTabBarModeActive=false;this.bOnTabBarElement=false;t();sap.ui.getCore().getEventBus().subscribe('launchpad','tabBarChange',this._onTabBarChange,this);return this.getInitPromise();},setOnTabBarElement:function(o){this.bOnTabBarElement=o;},isOnTabBarElement:function(){return this.bOnTabBarElement;},_onTabBarChange:function(c,e,d){if(d==="tabs"){this.bTabBarModeActive=true;}else{this.bTabBarModeActive=false;}},tabBarTileDropped:function(){if(this.oTabBarItemClickTimer){clearTimeout(this.oTabBarItemClickTimer);}},getInitPromise:function(){return this._initDeferred.promise();},isAnimationsEnabled:function(){return this.cfg.animationsEnabled;},getLayoutEngine:function(){return this.layoutEngine;},getStyleInfo:function(c){var t=document.createElement('div'),b=c.getAttribute('id');c=b?document.getElementById(b):c;t.className="sapUshellTile";t.setAttribute('style','position: absolute; visibility: hidden;');c.appendChild(t);var d=window.getComputedStyle(t);var i={"tileMarginHeight":parseFloat(d.marginBottom,10)+parseFloat(d.marginTop,10),"tileMarginWidth":parseFloat(d.marginLeft,10)+parseFloat(d.marginRight,10),"tileWidth":t.offsetWidth,"tileHeight":t.offsetHeight,"containerWidth":c.offsetWidth-(c.style.marginLeft?parseFloat(c.style.marginLeft,10):0)};t.parentNode.removeChild(t);return i;},getGroups:function(){return this.cfg.getGroups();},getAllGroups:function(){return this.cfg.getAllGroups?this.cfg.getAllGroups():[];},isTabBarActive:function(){return this.cfg.isTabBarActive?this.cfg.isTabBarActive():false;},getTilesInRow:function(i){return this.tilesInRow;},setTilesInRow:function(t){this.tilesInRow=t;},checkPlaceForTile:function(t,m,b,l,i){if(typeof m[b.y]==="undefined"){m.push(new Array(m[0].length));}if(typeof m[b.y+1]==="undefined"){m.push(new Array(m[0].length));}if(typeof m[b.y][b.x]!=="undefined"){return false;}var p=jQuery.extend({},b);if(i||(t.getLong&&!t.getLong())){return[p];}var c=[p];if(t.getLong&&t.getLong()){if((b.x+1)>=m[0].length||(typeof m[p.y][p.x+1]!=="undefined")){return false;}c.push({y:p.y,x:p.x+1});}return c;},placeTile:function(t,m,c){for(var i=0;i<c.length;i++){m[c[i].y][c[i].x]=t;}},getTilePositionInMatrix:function(t,m){for(var r=0;r<m.length;r++){for(var c=0;c<m[0].length;c++){if(m[r][c]==t){return{row:r,col:c};}}}return false;},fillRowsInLine:function(m,t,r,i){if(!t.length){return 0;}var c;for(var j=0;j<m[0].length&&t.length;j++){c=this.checkPlaceForTile(t[0],m,{x:j,y:r},i);if(c){this.placeTile(t[0],m,c);t.shift();}}},organizeGroup:function(t,I){var b=t.slice(0);var c=[];var d=0;c.push(new Array(I?Math.floor(this.tilesInRow/2):this.tilesInRow));while(b.length){this.fillRowsInLine(c,b,d,I);d++;}if(this.rightToLeft){for(var i=0;i<c.length;i++){c[i].reverse();}}c=this.cleanRows(c);return c;},cleanRows:function(t){var d=false;for(var r=t.length-1;r>0&&!d;r--){for(var c=0;c<t[r].length&&!d;c++){if(typeof t[r][c]==="object"){d=true;}}if(!d){t.pop();}}return t;},setGroupsLayout:function(g,m){var i;if(this.cfg.isLockedGroupsCompactLayoutEnabled&&g.getIsGroupLocked()&&m.length>0){var p=g.getDomRef().parentElement;if(this.cfg.isLockedGroupsCompactLayoutEnabled()){var t=m[0].length;if(this.rightToLeft){for(i=m[0].length-1;i>=0;i--){if(!m[0][i]){t=(m[0].length-1)-i;break;}}}else{for(i=0;i<m[0].length;i++){if(!m[0][i]){t=i;break;}}}var c=t>0?t*(this.styleInfo.tileWidth+this.styleInfo.tileMarginWidth)+this.styleInfo.tileMarginWidth:0;g.getDomRef().style.width="auto";p.style.width=c+"px";p.style.display="inline-block";}else{g.getDomRef().style.width="";p.style.width="";p.style.display="";}}},calcTilesInRow:function(c,t,b){var d=Math.floor(c/(t+b));d=(d<this.minTilesinRow?this.minTilesinRow:d);return d;},getGroupTiles:function(g){var t=g.getTiles();if(g.getShowPlaceholder()){t.push(g.oPlusTile);}return t;},reRenderGroupsLayout:function(g){if(!this.isInited){return;}var s=this.getStyleInfo(this.container);if(!s.tileWidth){return;}this.styleInfo=s;this.tilesInRow=this.calcTilesInRow(s.containerWidth,s.tileWidth,s.tileMarginWidth);g=g||this.getGroups();for(var i=0;i<g.length;i++){if(g[i].getDomRef&&!g[i].getDomRef()){continue;}var t=this.getGroupTiles(g[i]);var b=this.organizeGroup(t);this.setGroupsLayout(g[i],b);}},initDragMode:function(){this.initGroupDragMode(this.layoutEngine.currentGroup);},endDragMode:function(){var g=this.getGroups();for(var i=0;i<g.length;i++){var b=g[i].$();if(!b.hasClass("sapUshellInDragMode")){continue;}b.removeClass("sapUshellInDragMode sapUshellEnableTransition");var t=this.getGroupTiles(g[i]);for(var j=0;j<t.length;j++){t[j].$().removeAttr("style");}b.find('.sapUshellInner').removeAttr("style");}},initGroupDragMode:function(g){if(g.$().hasClass("sapUshellInDragMode")){return;}var t=this.getGroupTiles(g);var b=this.organizeGroup(t);g.$().addClass("sapUshellInDragMode");this.renderLayoutGroup(g,b);setTimeout(function(){g.$().addClass("sapUshellEnableTransition");});},calcTranslate:function(r,c){var t=c*(this.styleInfo.tileWidth+this.styleInfo.tileMarginWidth);var b=r*(this.styleInfo.tileHeight+this.styleInfo.tileMarginHeight);if(this.layoutEngine.rightToLeft){t=-t;}return{x:t,y:b};},renderLayoutGroup:function(g,b){var h=b.length*(this.styleInfo.tileHeight+this.styleInfo.tileMarginHeight);g.$().find('.sapUshellInner').height(h);var c;for(var i=0;i<b.length;i++){for(var j=0;j<b[i].length;j++){if(c==b[i][j]){continue;}else{c=b[i][j];}if(typeof c=="undefined"){break;}var t=this.calcTranslate(i,j);var d="translate("+t.x+"px,"+t.y+"px) translatez(0)";b[i][j].getDomRef().style.transform=d;}}}};var a=new L();return a;},true);
