/*!
 * Copyright (c) 2009-2017 SAP SE, All Rights Reserved
 */
sap.ui.define(['jquery.sap.global','sap/ui/Device','sap/ui/core/Control','sap/ushell/library','./ShellHeader','./SplitContainer','./ToolArea'],function(q,D,C,S,a,T){"use strict";var b=C.extend("sap.ushell.ui.shell.ShellLayout",{metadata:{properties:{headerHiding:{type:"boolean",group:"Appearance",defaultValue:false},headerVisible:{type:"boolean",group:"Appearance",defaultValue:true},toolAreaVisible:{type:"boolean",group:"Appearance",defaultValue:false},floatingContainerVisible:{type:"boolean",group:"Appearance",defaultValue:false},backgroundColorForce:{type:"boolean",group:"Appearance",defaultValue:true},showBrandLine:{type:"boolean",group:"Appearance",defaultValue:true},showAnimation:{type:"boolean",group:"Appearance",defaultValue:true},enableCanvasShapes:{type:"boolean",group:"Appearance",defaultValue:false}},aggregations:{header:{type:"sap.ushell.ui.shell.ShellHeader",multiple:false},toolArea:{type:"sap.ushell.ui.shell.ToolArea",multiple:false},rightFloatingContainer:{type:"sap.ushell.ui.shell.RightFloatingContainer",multiple:false},canvasSplitContainer:{type:"sap.ushell.ui.shell.SplitContainer",multiple:false},floatingActionsContainer:{type:"sap.ushell.ui.shell.ShellFloatingActions",multiple:false}},associations:{floatingContainer:{type:"sap.ushell.ui.shell.FloatingContainer",multiple:false}}}});b._SIDEPANE_WIDTH_PHONE=13;b._SIDEPANE_WIDTH_TABLET=13;b._SIDEPANE_WIDTH_DESKTOP=15;b._HEADER_ALWAYS_VISIBLE=true;b._HEADER_AUTO_CLOSE=true;b._HEADER_TOUCH_TRESHOLD=15;if(D.browser.chrome&&D.browser.version<36){b._HEADER_TOUCH_TRESHOLD=10;}b.prototype.init=function(){this._rtl=sap.ui.getCore().getConfiguration().getRTL();this._showHeader=true;this._iHeaderHidingDelay=3000;this._useStrongBG=false;D.media.attachHandler(this._handleMediaChange,this,D.media.RANGESETS.SAP_STANDARD);};b.prototype.exit=function(){D.media.detachHandler(this._handleMediaChange,this,D.media.RANGESETS.SAP_STANDARD);};b.prototype.onAfterRendering=function(){var t=this;function h(B){var e=q.event.fix(B);if(q.sap.containsOrEquals(t.getDomRef("hdr"),e.target)){t._timedHideHeader(e.type==="focus");}}if(window.addEventListener&&!b._HEADER_ALWAYS_VISIBLE){var H=this.getDomRef("hdr");H.addEventListener("focus",h,true);H.addEventListener("blur",h,true);}this.getCanvasSplitContainer()._applySecondaryContentSize();this._setSidePaneWidth();};b.prototype.renderFloatingContainerWrapper=function(){var f=document.getElementById("sapUshellFloatingContainerWrapper"),c=document.getElementsByTagName('body'),s=q.sap.storage?q.sap.storage(q.sap.storage.Type.local,"com.sap.ushell.adapters.local.FloatingContainer"):undefined;if(!f){f=document.createElement("DIV");f.setAttribute("id",'sapUshellFloatingContainerWrapper');f.setAttribute("class",'sapUshellShellFloatingContainerWrapper sapUshellShellHidden');c[0].appendChild(f);}if(s&&s.get("floatingContainerStyle")){f.setAttribute("style",s.get("floatingContainerStyle"));}};b.prototype.renderFloatingContainer=function(f){this.renderFloatingContainerWrapper();if(f&&!f.getDomRef()){q('#sapUshellFloatingContainerWrapper').toggleClass("sapUshellShellHidden",true);f.placeAt("sapUshellFloatingContainerWrapper");}};b.prototype.onThemeChanged=function(){this._refreshAfterRendering();};(function(){function _(s){if(s._startY===undefined||s._currY===undefined){return;}var y=s._currY-s._startY;if(Math.abs(y)>b._HEADER_TOUCH_TRESHOLD){s._doShowHeader(y>0);s._startY=s._currY;}}if(D.support.touch){b._HEADER_ALWAYS_VISIBLE=false;b.prototype.ontouchstart=function(e){this._startY=e.touches[0].pageY;if(this._startY>2*48){this._startY=undefined;}this._currY=this._startY;};b.prototype.ontouchend=function(){_(this);this._startY=undefined;this._currY=undefined;};b.prototype.ontouchcancel=b.prototype.ontouchend;b.prototype.ontouchmove=function(e){this._currY=e.touches[0].pageY;_(this);};}})();b.prototype.setHeaderHiding=function(e){e=!!e;return this._modifyAggregationOrProperty(function(r){return this.setProperty("headerHiding",e,r);},function(){this._doShowHeader(!e?true:this._showHeader);});};b.prototype.setHeaderHidingDelay=function(d){this._iHeaderHidingDelay=d;return this;};b.prototype.getHeaderHidingDelay=function(){return this._iHeaderHidingDelay;};b.prototype.setToolAreaVisible=function(v){this.setProperty("toolAreaVisible",!!v,true);this.getToolArea().$().toggleClass("sapUshellShellHidden",!v);this.getCanvasSplitContainer()._applySecondaryContentSize();return this;};b.prototype.setFloatingContainer=function(c){this.setAssociation('floatingContainer',c,true);this.renderFloatingContainer(c);};b.prototype.setFloatingContainerVisible=function(v){this.setProperty("floatingContainerVisible",!!v,true);if(this.getDomRef()){var s=q.sap.storage?q.sap.storage(q.sap.storage.Type.local,"com.sap.ushell.adapters.local.FloatingContainer"):undefined,f=document.getElementById("sapUshellFloatingContainerWrapper");if(v&&s&&!s.get("floatingContainerStyle")){var e=q(".sapUshellShellHeadItm").position()?q(".sapUshellShellHeadItm").position().left:0;var l=(q(window).width()-q("#shell-floatingContainer").width()-e)*100/q(window).width();var t=q(".sapUshellShellHeadContainer").height()*100/q(window).height();f.setAttribute("style","left:"+l+"%;"+"top:"+t+"%;position:absolute;");s.put("floatingContainerStyle",f.getAttribute("style"));}q('.sapUshellShellFloatingContainerWrapper').toggleClass("sapUshellShellHidden",!v);}return this;};b.prototype.setFloatingActionsContainer=function(c){this.setAggregation('floatingActionsContainer',c,true);};b.prototype.setHeaderVisible=function(h){this.setProperty("headerVisible",!!h,true);this.$().toggleClass("sapUshellShellNoHead",!h);return this;};b.prototype._setStrongBackground=function(u){this._useStrongBG=!!u;this.$("strgbg").toggleClass("sapUiStrongBackgroundColor",this._useStrongBG);};b.prototype._modifyAggregationOrProperty=function(u,d){var r=!!this.getDomRef();var c=u.apply(this,[r]);if(r&&d){if(d instanceof sap.ushell.ui.shell.shell_ContentRenderer){d.render();}else{d.apply(this);}}return c;};b.prototype._doShowHeader=function(s){var w=this._showHeader;this._showHeader=this._isHeaderHidingActive()?!!s:true;this.$().toggleClass("sapUshellShellHeadHidden",!this._showHeader).toggleClass("sapUshellShellHeadVisible",this._showHeader);if(this._showHeader){this._timedHideHeader();}if(w!==this._showHeader&&this._isHeaderHidingActive()){q.sap.delayedCall(500,this,function(){try{var r=document.createEvent("UIEvents");r.initUIEvent("resize",true,false,window,0);window.dispatchEvent(r);}catch(e){q.sap.log.error(e);}});}};b.prototype._timedHideHeader=function(c){if(this._headerHidingTimer){q.sap.clearDelayedCall(this._headerHidingTimer);this._headerHidingTimer=null;}if(c||!b._HEADER_AUTO_CLOSE||!this._isHeaderHidingActive()||this._iHeaderHidingDelay<=0){return;}this._headerHidingTimer=q.sap.delayedCall(this._iHeaderHidingDelay,this,function(){if(this._isHeaderHidingActive()&&this._iHeaderHidingDelay>0&&!q.sap.containsOrEquals(this.getDomRef("hdr"),document.activeElement)){this._doShowHeader(false);}});};b.prototype._isHeaderHidingActive=function(){if(b._HEADER_ALWAYS_VISIBLE||!this.getHeaderHiding()||sap.ushell.ui.shell.shell_iNumberOfOpenedShellOverlays>0||!this.getHeaderVisible()){return false;}return true;};b.prototype._setSidePaneWidth=function(r){var s=this.getCanvasSplitContainer();if(s){if(!r){r=D.media.getCurrentRange(D.media.RANGESETS.SAP_STANDARD).name;}var w=b["_SIDEPANE_WIDTH_"+r.toUpperCase()]+"rem";s.setSecondaryContentSize(w);}};b.prototype._handleMediaChange=function(p){if(!this.getDomRef()){return false;}this._setSidePaneWidth(p.name);this.getCanvasSplitContainer()._applySecondaryContentSize();};b.prototype._refreshAfterRendering=function(){var d=this.getDomRef();if(!d){return false;}this._timedHideHeader();return true;};return b;},true);
