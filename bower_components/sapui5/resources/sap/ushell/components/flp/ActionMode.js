// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define([],function(){"use strict";var A=function(){this.oEventBus=sap.ui.getCore().getEventBus();this.oEventBus.subscribe('launchpad','actionModeInactive',this.scrollToViewPoint,this);this.oEventBus.subscribe('launchpad','actionModeActive',this.scrollToViewPoint,this);this.viewPoint=undefined;this.init=function(m){this.oModel=m;};};A.prototype.activate=function(){var t;this.oModel.setProperty('/tileActionModeActive',true);this.aOrigHiddenGroupsIds=sap.ushell.utils.getCurrentHiddenGroupIds(this.oModel);var d=sap.ui.getCore().byId("dashboardGroups");d.addLinksToUnselectedGroups();t=sap.ui.getCore().byId("ActionModeBtn");if(t){t.setTooltip(sap.ushell.resources.i18n.getText("exitEditMode"));t.setText(sap.ushell.resources.i18n.getText("exitEditMode"));if(t.data("isShellHeader")){t.setSelected(true);}}this.oEventBus.publish('launchpad','actionModeActive');};A.prototype.scrollToViewPoint=function(){var d=this.viewPoint;d.restoreLastFocusedTile=true;if(!this.oModel.getProperty('/tileActionModeActive')){var j=jQuery(".sapUshellTileContainerHeader[tabindex=0]");if(j&&j.length>0){var a=j[0].closest('.sapUshellTileContainer');if(a){d.restoreLastFocusedTileContainerById=a.id;}}}d.iDuration=0;window.setTimeout(jQuery.proxy(this.oEventBus.publish,this.oEventBus,"launchpad","scrollToGroup",d),0);};A.prototype.deactivate=function(){var t=sap.ui.getCore().byId("TileActions"),T;this.oModel.setProperty('/tileActionModeActive',false);this.oEventBus.publish("launchpad",'actionModeInactive',this.aOrigHiddenGroupsIds);if(t!==undefined){t.destroy();}sap.ui.require(['sap/m/MessageToast'],function(M){M.show(sap.ushell.resources.i18n.getText("savedChanges"),{duration:4000});});T=sap.ui.getCore().byId("ActionModeBtn");if(T){T.setTooltip(sap.ushell.resources.i18n.getText("activateEditMode"));T.setText(sap.ushell.resources.i18n.getText("activateEditMode"));if(T.data("isShellHeader")){T.setSelected(false);}}};A.prototype.toggleActionMode=function(m,s,d){var t=m.getProperty('/tileActionModeActive');var c=m.getProperty('/topGroupInViewPortIndex');var h=m.getProperty("/homePageGroupDisplay");if(!d){d=[];}var v=d.filter(function(f){return f.getVisible();});var a=v[c];if(a){var e=t?-49:49;var b=(h==="tabs")?d[0].getDomRef():a.getDomRef();var S=0;if(b){S=b.offsetTop;}var g=document.getElementById("sapUshellDashboardPage-cont").scrollTop-S;this.viewPoint={group:v[c],fromTop:g+e};}else{this.viewPoint={fromTop:0};}if(t){this.deactivate();}else{this.activate();}};A.prototype.activateGroupEditMode=function(g){var j=jQuery(g.getDomRef()).find('.sapUshellTileContainerContent');j.addClass("sapUshellTileContainerEditMode");};A.prototype._openActionsMenu=function(e,v){var t=this,T=v?v:e.getSource(),l=sap.ushell.Container.getService("LaunchPage"),a=[],o=sap.ui.getCore().byId("TileActions"),i,n,b,c,d,h,f,g;if(T){d=T.getBindingContext().getObject().object;a=l.getTileActions(d);}t.oTileControl=T;jQuery(".sapUshellTileActionLayerDivSelected").removeClass("sapUshellTileActionLayerDivSelected");f=jQuery(e.getSource().getDomRef()).find(".sapUshellTileActionLayerDiv");f.addClass("sapUshellTileActionLayerDivSelected");if(o===undefined){o=new sap.m.ActionSheet("TileActions",{placement:sap.m.PlacementType.Bottom,afterClose:function(){$(".sapUshellTileActionLayerDivSelected").removeClass("sapUshellTileActionLayerDivSelected");var E=sap.ui.getCore().getEventBus();E.publish("dashboard","actionSheetClose",t.oTileControl);}});}else{o.destroyButtons();}if(a.length===0||T.oParent.getProperty("isGroupLocked")){n=new sap.m.Button({text:sap.ushell.resources.i18n.getText("tileHasNoActions"),enabled:false});o.addButton(n);}else{for(i=0;i<a.length;i++){c=a[i];h=function(c){return function(){t._handleActionPress(c,T);};}(c);b=new sap.m.Button({text:c.text,icon:c.icon,press:h});o.addButton(b);}}g=e.getSource().getActionSheetIcon?e.getSource().getActionSheetIcon():undefined;if(g){o.openBy(g);}else{var m=sap.ui.getCore().byId(e.getSource().getId()+"-action-more");if(m){o.openBy(m);}else{o.openBy(e.getSource());}}};A.prototype._handleActionPress=function(a,t){if(a.press){a.press.call(a,t);}else if(a.targetURL){if(a.targetURL.indexOf("#")===0){hasher.setHash(a.targetURL);}else{window.open(a.targetURL,'_blank');}}else{sap.ui.require(['sap/m/MessageToast'],function(M){M.show("No Action");});}};return new A();},true);
