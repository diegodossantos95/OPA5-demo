// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(function(){"use strict";sap.ui.jsview("sap.ushell.components.flp.launchpad.appfinder.AppFinder",{createContent:function(){this.oController=this.getController();this.parentComponent=sap.ui.core.Component.getOwnerComponentFor(this);this.setModel(this.parentComponent.getModel());this.enableEasyAccessSAPMenu=this.getModel().getProperty("/enableEasyAccessSAPMenu");this.enableEasyAccessUserMenu=this.getModel().getProperty("/enableEasyAccessUserMenu");if((!this.enableEasyAccessSAPMenu&&!this.enableEasyAccessUserMenu)||(sap.ui.Device.system.phone||sap.ui.Device.system.tablet&&(!sap.ui.Device.system.combi))){this.showEasyAccessMenu=false;}else{this.showEasyAccessMenu=true;}var r=sap.ushell.resources.i18n;this.oPage=new sap.m.Page("appFinderPage",{showHeader:false,showSubHeader:false,showFooter:false,showNavButton:false,enableScrolling:false,title:{parts:["/groupContext/title"],formatter:function(t){return!t?r.getText("appFinderTitle"):r.getText("appFinder_group_context_title",t);}}});return this.oPage;},_showSearch:function(m){var M="searchFiltering";if(m==="userMenu"){M="enableEasyAccessUserMenuSearch";}else if(m==="sapMenu"){M="enableEasyAccessSAPMenuSearch";}return this.getModel().getProperty("/"+M);},_showSearchTag:function(m){if(m==="userMenu"||m==="sapMenu"){return false;}return this.getModel().getProperty("/tagFiltering");},onAfterHide:function(){var c=this.getController(),r=c.oSubHeaderModel.getProperty("/search/searchMode")||c.oSubHeaderModel.getProperty("/search/searchTerm");if(r){c._resetSubHeaderModel();this.oAppFinderSearchControl.setValue("");}},createSubHeader:function(){if(!this.oToolbar){this.oToolbar=new sap.m.Toolbar("appFinderSubHeader",{});this.oToolbar.addEventDelegate({onsapskipback:function(e){e.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.setIsFocusHandledByAnotherHandler(true);sap.ushell.renderers.fiori2.AccessKeysHandler.sendFocusBackToShell(e);},onsapskipforward:function(e){var o=sap.ui.getCore().byId("openCloseButtonAppFinderSubheader");if(o.getVisible()&&!o.getPressed()){e.preventDefault();sap.ushell.components.flp.ComponentKeysHandler.setFocusOnCatalogTile();}},onAfterRendering:function(){jQuery("#catalog").attr("accesskey","a");}});this.oToolbar.addCustomData(new sap.ushell.ui.launchpad.AccessibilityCustomData({key:"role",value:"heading",writeToDom:true}));this.oToolbar.addCustomData(new sap.ushell.ui.launchpad.AccessibilityCustomData({key:"aria-level",value:"2",writeToDom:true}));this.oToolbar.addStyleClass('sapUshellAppFinderHeader');this.oPage.setSubHeader(this.oToolbar);this.oPage.setShowSubHeader(true);}if(!this.openCloseSplitAppButton){this.openCloseSplitAppButton=new sap.m.ToggleButton("openCloseButtonAppFinderSubheader",{icon:"sap-icon://menu2",visible:"{/openCloseSplitAppButtonVisible}",pressed:"{/openCloseSplitAppButtonToggled}",press:function(e){this.getController().oSubHeaderModel.setProperty('/openCloseSplitAppButtonToggled',e.getSource().getPressed());this.openCloseSplitAppButton.setTooltip(e.getParameter("pressed")?sap.ushell.resources.i18n.getText("ToggleButtonHide"):sap.ushell.resources.i18n.getText("ToggleButtonShow"))}.bind(this),tooltip:sap.ushell.resources.i18n.getText("ToggleButtonShow")});this.openCloseSplitAppButton.addEventDelegate({onsaptabprevious:function(e){e.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.setIsFocusHandledByAnotherHandler(true);sap.ushell.renderers.fiori2.AccessKeysHandler.sendFocusBackToShell(e);}});this.openCloseSplitAppButton.setModel(this.getController().oSubHeaderModel);this.oToolbar.addContent(this.openCloseSplitAppButton);}},updateSubHeader:function(m,e){var s,a;this.oToolbar.removeAllContent();this.oToolbar.addContent(this.openCloseSplitAppButton);if(e){s=this.createSegmentedButtons(m);this.oPage.addStyleClass('sapUshellAppFinderWithEasyAccess');this.oToolbar.addContent(s);}if(this._showSearch(m)){a=this.createSearchControl(m);this.oToolbar.addContent(a);}this.getController()._updateCurrentMenuName(m);},createSegmentedButtons:function(m){var c,r,s,b,a,i;if(this.segmentedButton){this.segmentedButton.setSelectedButton(m);return this.segmentedButton;}c=this.getController();r=sap.ushell.resources.i18n;s=[];s.push(new sap.m.Button("catalog",{text:r.getText("appFinderCatalogTitle"),press:function(e){c.onSegmentButtonClick(e);}}));if(this.enableEasyAccessUserMenu){s.push(new sap.m.Button('userMenu',{text:r.getText("appFinderUserMenuTitle"),press:function(e){c.onSegmentButtonClick(e);}}));}if(this.enableEasyAccessSAPMenu){s.push(new sap.m.Button('sapMenu',{text:r.getText("appFinderSapMenuTitle"),press:function(e){c.onSegmentButtonClick(e);}}));}this.segmentedButton=new sap.m.SegmentedButton("appFinderSegmentedButtons",{buttons:s});this.segmentedButton.addEventDelegate({onsaptabprevious:function(e){var o=sap.ui.getCore().byId("openCloseButtonAppFinderSubheader");if(!o.getVisible()){e.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.setIsFocusHandledByAnotherHandler(true);sap.ushell.renderers.fiori2.AccessKeysHandler.sendFocusBackToShell(e);}}});this.segmentedButton.setSelectedButton(m);b=this.segmentedButton.getButtons();for(i=0;i<b.length;i++){a=b[i];a.addCustomData(new sap.ushell.ui.launchpad.AccessibilityCustomData({key:"aria-controls",value:a.getId()+"View",writeToDom:true}));}return this.segmentedButton;},_handleSearch:function(){this.getController().searchHandler.apply(this.getController(),arguments);jQuery('#appFinderSearch input').select();},createSearchControl:function(m){if(!this.oAppFinderSearchContainer){this.oAppFinderSearchContainer=new sap.m.FlexBox("appFinderSearchContainer");}this.oAppFinderSearchContainer.removeAllItems();if(m==='catalog'&&this._showSearchTag('catalog')){this.createTagControl();this.oAppFinderSearchContainer.addItem(this.oAppFinderTagFilter);}if(!this.oAppFinderSearchControl){this.oAppFinderSearchControl=new sap.m.SearchField("appFinderSearch",{search:this._handleSearch.bind(this),value:{path:'subHeaderModel>/search/searchTerm',mode:sap.ui.model.BindingMode.OneWay}}).addStyleClass('help-id-catalogSearch');this.oAppFinderSearchControl.addCustomData(new sap.ushell.ui.launchpad.AccessibilityCustomData({key:"aria-controls",value:"",writeToDom:true}));this.oAppFinderSearchControl.addEventDelegate({onsaptabnext:function(e){var o=sap.ui.getCore().byId("openCloseButtonAppFinderSubheader");if(o.getVisible()&&!o.getPressed()){e.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.setIsFocusHandledByAnotherHandler(true);sap.ushell.components.flp.ComponentKeysHandler.setFocusOnCatalogTile();}}});}this.oAppFinderSearchContainer.addItem(this.oAppFinderSearchControl);this._updateSearchWithPlaceHolder(m);return this.oAppFinderSearchContainer;},_updateSearchWithPlaceHolder:function(m){var s="";if(m==='catalog'){s="EasyAccessMenu_SearchPlaceHolder_Catalog";}else if(m==='userMenu'){s="EasyAccessMenu_SearchPlaceHolder_UserMenu";}else if(m==='sapMenu'){s="EasyAccessMenu_SearchPlaceHolder_SAPMenu";}if(s&&this.oAppFinderSearchControl){this.oAppFinderSearchControl.setPlaceholder(sap.ushell.resources.i18n.getText(s));this.oAppFinderSearchControl.setTooltip(sap.ushell.resources.i18n.getText(s));}},createTagControl:function(){if(this.oAppFinderTagFilter){return this.oAppFinderTagFilter;}this.oAppFinderTagFilter=new sap.m.MultiComboBox("appFinderTagFilter",{selectedKeys:{path:"subHeaderModel>/tag/selectedTags"},tooltip:"{i18n>catalogTilesTagfilter_tooltip}",placeholder:"{i18n>catalogTilesTagfilter_HintText}",items:{path:"/tagList",sorter:new sap.ui.model.Sorter("tag",false,false),template:new sap.ui.core.ListItem({text:"{tag}",key:"{tag}"})},selectionChange:[this.oController.onTagsFilter,this.oController]}).addStyleClass('help-id-catalogTagFilter');return this.oAppFinderTagFilter;},getControllerName:function(){return"sap.ushell.components.flp.launchpad.appfinder.AppFinder";}});},false);
