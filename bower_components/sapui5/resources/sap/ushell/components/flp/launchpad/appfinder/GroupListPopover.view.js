// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(function(){"use strict";sap.ui.jsview("sap.ushell.components.flp.launchpad.appfinder.GroupListPopover",{createContent:function(c){this.iPopoverDataSectionHeight=192;this.oGroupsContainer=this._createPopoverContainer(this.iPopoverDataSectionHeight);this.oLaunchPageService=sap.ushell.Container.getService("LaunchPage");this.oPopover=new sap.m.ResponsivePopover({id:"groupsPopover",placement:"Auto",title:sap.ushell.resources.i18n.getText("addTileToGroups_popoverTitle"),contentWidth:'20rem',beginButton:this._createCloseButton(),content:this.oGroupsContainer,afterClose:this.getController()._afterCloseHandler.bind(this.getController())});this.oPopover.setInitialFocus('newGroupItem');},open:function(o){if(document.body.clientHeight-o.getDomRef().getBoundingClientRect().bottom>=310){this.oPopover.setPlacement("Bottom");}this.oPopover.openBy(o);if(this.getViewData().singleGroupSelection){this.getController()._setFooterVisibility(false);}this.deferred=jQuery.Deferred();return this.deferred.promise();},_createPopoverContainer:function(p){var n=this._createNewGroupUiElements(),g=this._createPopoverGroupList();var a=new sap.m.ScrollContainer({id:"popoverContainer",horizontal:false,vertical:true,content:[n,g]});if(!sap.ui.Device.system.phone){a.setHeight((p-2)+"px");}else{a.setHeight("100%");}return a;},_createNewGroupUiElements:function(){var n=new sap.m.StandardListItem({id:"newGroupItem",title:sap.ushell.resources.i18n.getText("newGroup_listItemText"),type:"Navigation",press:this.getController()._navigateToCreateNewGroupPane.bind(this.getController())});var N=new sap.m.List({});if(this.getViewData().enableHelp){n.addStyleClass('help-id-newGroupItem');}N.addItem(n);N.addEventDelegate({onsapdown:function(E){try{E.preventDefault();E._bIsStopHandlers=true;var j=jQuery("#popoverContainer .sapMListModeMultiSelect li, #popoverContainer .sapMListModeSingleSelectMaster li").first();j.focus();}catch(e){}},onsaptabnext:function(E){try{E.preventDefault();E._bIsStopHandlers=true;var j=jQuery("#closeButton");j.focus();}catch(e){}}});return N;},_createNewGroupInput:function(){var n=new sap.m.Input({id:"newGroupNameInput",type:"Text",placeholder:sap.ushell.resources.i18n.getText("new_group_name")});n.setValueState(sap.ui.core.ValueState.None);n.setPlaceholder(sap.ushell.resources.i18n.getText("new_group_name"));n.enabled=true;n.addStyleClass("sapUshellCatalogNewGroupInput");return n;},_createHeadBarForNewGroup:function(){var b=new sap.m.Button({icon:sap.ui.core.IconPool.getIconURI("nav-back"),press:this.getController()._backButtonHandler.bind(this.getController()),tooltip:sap.ushell.resources.i18n.getText("newGroupGoBackBtn_tooltip")});b.addStyleClass("sapUshellCatalogNewGroupBackButton");var h=new sap.m.Bar({contentLeft:[b],contentMiddle:[new sap.m.Label({text:sap.ushell.resources.i18n.getText("newGroup_popoverTitle")})]});return h;},getControllerName:function(){return"sap.ushell.components.flp.launchpad.appfinder.GroupListPopover";},_createPopoverGroupList:function(){var l=new sap.m.DisplayListItem({label:"{oGroup/title}",selected:"{selected}",tooltip:"{oGroup/title}",type:sap.m.ListType.Active,press:this.getController().groupListItemClickHandler.bind(this.getController())});var u=[];u.push(new sap.ui.model.Filter("oGroup/isGroupLocked",sap.ui.model.FilterOperator.EQ,false));if(this.getViewData().enableHideGroups){u.push(new sap.ui.model.Filter("oGroup/isGroupVisible",sap.ui.model.FilterOperator.EQ,true));}var s=this.getViewData().singleGroupSelection,L=new sap.m.List({mode:s?sap.m.ListMode.SingleSelectMaster:sap.m.ListMode.MultiSelect,growing:true,growingThreshold:200,items:{path:"/userGroupList",template:l,filters:u}});if(s){L.attachSelect(this.getController().okButtonHandler.bind(this.getController()));}else{L.attachSelectionChange(this.getController().checkboxClickHandler.bind(this.getController()));}L.addEventDelegate({onsapup:function(E){try{E.preventDefault();var j,c=jQuery(":focus");if(c.index()==0){j=jQuery("#newGroupItem");j.focus();E._bIsStopHandlers=true;}}catch(e){jQuery.sap.log.error("Groups popup Accessibility `up` key failed");}}});return L;},_createOkButton:function(){var o=new sap.m.Button({id:"okButton",press:this.getController().okButtonHandler.bind(this.getController()),text:sap.ushell.resources.i18n.getText("okBtn")});o.addEventDelegate({onsaptabprevious:function(E){try{E.preventDefault();E._bIsStopHandlers=true;var j=jQuery("#newGroupItem");if(!j.length){j=jQuery("#newGroupNameInput input");}j.focus();}catch(e){jQuery.sap.log.error("Groups popup Accessibility `shift-tab` key failed");}}});return o;},_createCancelButton:function(){return new sap.m.Button({id:"cancelButton",press:this.getController()._closeButtonHandler.bind(this.getController()),text:sap.ushell.resources.i18n.getText("cancelBtn")});},_createCloseButton:function(){return new sap.m.Button({id:"closeButton",press:this.getController()._switchGroupsPopoverButtonPress.bind(this.getController()),text:sap.ushell.resources.i18n.getText(sap.ushell.resources.i18n.getText("close"))});}});},false);
