// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(['sap/ui/core/HTML','sap/ui/core/IconPool','sap/ushell/ui/appfinder/AppBox','sap/ushell/ui/appfinder/PinButton','sap/ushell/ui/launchpad/CatalogEntryContainer','sap/ushell/ui/launchpad/CatalogTileContainer','sap/ushell/ui/launchpad/CatalogsContainer','sap/ushell/ui/launchpad/Panel','sap/ushell/ui/launchpad/Tile','sap/ushell/ui/launchpad/TileContainerUtils'],function(H,I,A,P,C,a,b,c,T,d){"use strict";sap.ui.jsview("sap.ushell.components.flp.launchpad.appfinder.Catalog",{oController:null,createContent:function(o){var t=this;this.oViewData=this.getViewData();this.parentComponent=this.oViewData.parentComponent;var m=this.parentComponent.getModel();this.setModel(m);this.setModel(this.oViewData.subHeaderModel,"subHeaderModel");this.oController=o;function i(L){return((L!==null)&&(L==="1x2"||L==="2x2"))||false;}function f(v){return parseInt(v,10)||0;}function g(e,v,G,w,x,y){var z;if(w){var R=sap.ushell.resources.i18n,B=$.inArray(x,G);z=R.getText(B!==-1?"removeAssociatedTileFromContextGroup":"addAssociatedTileToContextGroup",y);}else{z=G&&G.length?v:e;}return z;}var h=new P({icon:'sap-icon://pushpin-off',selected:{parts:["associatedGroups","associatedGroups/length","/groupContext/path","/groupContext/id"],formatter:function(e,v,G,w){if(G){var x=$.inArray(w,e);return x!==-1;}else{return!!v;}}},tooltip:{parts:["i18n>EasyAccessMenu_PinButton_UnToggled_Tooltip","i18n>EasyAccessMenu_PinButton_Toggled_Tooltip","associatedGroups","associatedGroups/length","/groupContext/path","/groupContext/id","/groupContext/title"],formatter:function(e,v,G,w,x,y,z){return g(e,v,G,x,y,z);}},press:[o.onTilePinButtonClick,o]});var j=new P({icon:'sap-icon://pushpin-off',selected:{parts:["associatedGroups","associatedGroups/length","/groupContext/path","/groupContext/id"],formatter:function(e,v,G,w){if(G){var x=$.inArray(w,e);return x!==-1;}else{return!!v;}}},tooltip:{parts:["i18n>EasyAccessMenu_PinButton_UnToggled_Tooltip","i18n>EasyAccessMenu_PinButton_Toggled_Tooltip","associatedGroups","associatedGroups/length","/groupContext/path","/groupContext/id","/groupContext/title"],formatter:function(e,v,G,w,x,y,z){return g(e,v,G,x,y,z);}},press:[o.onTilePinButtonClick,o]});this.oAppBoxesTemplate=new A({title:'{title}',icon:'{icon}',subtitle:'{subtitle}',url:'{url}',navigationMode:'{navigationMode}',pinButton:j,press:[o.onAppBoxPressed,o]});j.addCustomData(new sap.ushell.ui.launchpad.AccessibilityCustomData({key:"tabindex",value:"-1",writeToDom:true}));j.addStyleClass("sapUshellPinButton");h.addCustomData(new sap.ushell.ui.launchpad.AccessibilityCustomData({key:"tabindex",value:"-1",writeToDom:true}));h.addStyleClass("sapUshellPinButton");this.oTileTemplate=new T({tileViews:{path:"content",factory:function(e,v){return v.getObject();}},"long":{path:"size",formatter:i},index:{path:"id",formatter:f},tileCatalogId:"{id}",pinButton:h,press:[o.catalogTilePress,o],afterRendering:o.onTileAfterRendering});this.oCatalogSelect=new sap.m.List("catalogSelect",{visible:"{/catalogSelection}",name:"Browse",rememberSelections:true,mode:"SingleSelectMaster",items:{path:"/masterCatalogs",template:new sap.m.StandardListItem({type:"Active",title:"{title}"})},showNoData:false,itemPress:[o._handleCatalogListItemPress,o]});this.getCatalogSelect=function(){return this.oCatalogSelect;};var k=this.oCatalogSelect.onAfterRendering;this.oCatalogSelect.addEventDelegate({onsaptabnext:function(v){try{v.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.setIsFocusHandledByAnotherHandler(true);sap.ushell.components.flp.ComponentKeysHandler.setFocusOnCatalogTile();}catch(e){}},onsapskipforward:function(v){try{v.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.setIsFocusHandledByAnotherHandler(true);sap.ushell.components.flp.ComponentKeysHandler.setFocusOnCatalogTile();}catch(e){}},onsapskipback:function(v){try{v.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.setIsFocusHandledByAnotherHandler(true);var w=sap.ui.getCore().byId("openCloseButtonAppFinderSubheader");if(w.getVisible()){w.focus();}else{sap.ushell.components.flp.ComponentKeysHandler.appFinderFocusMenuButtons(v);}}catch(e){}}});if(m.getProperty("/enableHelp")){this.oCatalogSelect.addStyleClass('help-id-catalogCategorySelect');}this.setCategoryFilterSelection=function(e){var v=t.getCatalogSelect(),w=v.getItems(),x=t.oController.oSubHeaderModel.getProperty('/tag/tagMode'),y=t.oController.oSubHeaderModel.getProperty('/search/searchMode'),z=e;if(y||x){v.setSelectedItem();}else{w.forEach(function(L,B){if(L.getTitle()===z){v.setSelectedItem(L);}});}};this.oCatalogSelect.onAfterRendering=function(){var e=t.oController.categoryFilter||sap.ushell.resources.i18n.getText('all');t.setCategoryFilterSelection(e);if(k){k.apply(this,arguments);}if(!this.getSelectedItem()){this.setSelectedItem(this.getItems()[0]);}setTimeout(function(){var v=jQuery("#catalog, #userMenu, #sapMenu").filter("[tabindex=0]");if(v.length){v.eq(0).focus();}else{jQuery("#catalog").focus();}},0);};var l=this.oCatalogSelect._onAfterRenderingPopover;this.oCatalogSelect._onAfterRenderingPopover=function(){if(this._oPopover){this._oPopover.setFollowOf(false);}if(l){l.apply(this,arguments);}};var E=sap.ui.getCore().getEventBus(),D,u=function(){this.splitApp.toMaster('catalogSelect','show');if(!sap.ui.Device.system.phone){D=this._calculateDetailPageId();if(D!=this.splitApp.getCurrentDetailPage().getId()){this.splitApp.toDetail(D);}}};E.subscribe("launchpad","catalogContentLoaded",function(){setTimeout(u.bind(this),500);},this);E.subscribe("launchpad","afterCatalogSegment",u,this);var n=new H("sapUshellCatalogAccessibilityTileText",{content:"<div style='height: 0px; width: 0px; overflow: hidden; float: left;'>"+sap.ushell.resources.i18n.getText("tile")+"</div>"});var p=new C({header:"{title}",customTilesContainer:{path:"customTiles",template:this.oTileTemplate,templateShareable:true},appBoxesContainer:{path:"appBoxes",template:this.oAppBoxesTemplate,templateShareable:true}});this.oMessagePage=new sap.m.MessagePage({visible:true,showHeader:false,text:sap.ushell.resources.i18n.getText('EasyAccessMenu_NoAppsToDisplayMessagePage_Text'),description:''});this.oCatalogsContainer=new b("catalogTiles",{categoryFilter:"{/categoryFilter}",catalogs:{path:"/catalogs",templateShareable:true,template:p},busy:true});this.oCatalogsContainer.addStyleClass('sapUshellCatalogTileContainer');this.oCatalogsContainer.addEventDelegate({onsaptabprevious:function(e){var v=sap.ui.getCore().byId("openCloseButtonAppFinderSubheader"),w=jQuery(e.srcControl.getDomRef());if(v.getVisible()&&!v.getPressed()&&!w.hasClass("sapUshellPinButton")){e.preventDefault();var x=sap.ui.getCore().byId("appFinderSearch");x.focus();}},onsapskipback:function(e){var v=sap.ui.getCore().byId("openCloseButtonAppFinderSubheader");if(v.getVisible()&&!v.getPressed()){e.preventDefault();v.focus();}}});this.oCatalogsContainer.onAfterRendering=function(){var e=sap.ui.getCore().byId('catalogTilesDetailedPage');if(!this.getBusy()){e.setBusy(false);jQuery.sap.measure.end("FLP:AppFinderLoadingStartToEnd");}else{e.setBusy(true);}jQuery("#catalogTilesDetailedPage-cont").scroll(function(){var v=sap.ui.getCore().byId('catalogTilesDetailedPage'),w=v.getScrollDelegate(),x=w.getScrollTop(),y=w.getMaxScrollTop();if(y-x<=30+t.oController.PagingManager.getTileHeight()){t.oController.allocateNextPage();}});};this.oCatalogEntrySearchContainer=new C({header:"{i18n>results_count}"});this.oCatalogEntrySearchContainer.addStyleClass('sapUshellCatalogTileContainer');this.oCatalogsSearchContainer=new b("catalogSearchContainer",{catalogs:[this.oCatalogEntrySearchContainer]});this.wrapCatalogsContainerInDetailPage=function(e,v){var w=new sap.m.Page(v,{showHeader:false,showFooter:false,showNavButton:false,content:[new c({translucent:true,content:e}).addStyleClass("sapUshellCatalogPage")]});return w},this.getCatalogContainer=function(){return this.oCatalogsContainer;};new sap.m.Page({showHeader:false,showFooter:false,showNavButton:false,content:[new c({translucent:true,content:[n,this.getCatalogContainer()]}).addStyleClass("sapUshellCatalogPage")]});var q=this.wrapCatalogsContainerInDetailPage([n,this.getCatalogContainer()],'catalogTilesDetailedPage'),r=new sap.m.Page('catalogMessagePage',{showHeader:false,showFooter:false,showNavButton:false,content:[this.oMessagePage]}),s=this.wrapCatalogsContainerInDetailPage([this.oCatalogsSearchContainer],'catalogTilesSearchPage');s.addEventDelegate({onAfterShow:function(e){jQuery(".sapUshellTile").find('[tabindex*=0]').attr("tabindex",-1);jQuery(".sapUshellAppBox:visible, .sapUshellTile:visible").first().attr("tabindex",0);}});var S=new sap.m.BusyIndicator('catalogSelectBusyIndicator',{size:"1rem"});this.splitApp=new sap.m.SplitApp('catalogViewMasterDetail',{masterPages:[S,this.oCatalogSelect],detailPages:[q,s,r]});document.toSearch=function(){this.splitApp.toDetail('catalogTilesSearchPage');}.bind(this);document.toDetail=function(){this.splitApp.toDetail('catalogTilesDetailedPage');}.bind(this);document.toMessage=function(){this.splitApp.toDetail('catalogMessagePage');}.bind(this);return this.splitApp;},_calculateDetailPageId:function(){var s=this.getModel('subHeaderModel');var S=s.getProperty('/search/searchMode');var t=s.getProperty('/tag/tagMode');var e=this.getModel().getProperty("/catalogs");var i;if(S||t){i=this.getController().bSearchResults?'catalogTilesSearchPage':'catalogMessagePage';}else if(e&&!e.length){i="catalogMessagePage";}else{i="catalogTilesDetailedPage";}return i;},getControllerName:function(){return"sap.ushell.components.flp.launchpad.appfinder.Catalog";}});},false);
