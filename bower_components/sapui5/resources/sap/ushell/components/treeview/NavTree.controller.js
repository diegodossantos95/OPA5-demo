// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(function(){"use strict";sap.ui.controller("sap.ushell.components.treeview.NavTree",{onInit:function(){var v=this.getView().getViewData(),r=v.data.items,s=v.data.serviceURL||'',t={items:[],entryObject:{}};var m=new sap.ui.model.json.JSONModel(t);this.getView().setModel(m);jQuery.getJSON(s).done(function(r){this.buidModelData(r);}.bind(this)).fail(function(j,a,e){var b=a+", "+e;jQuery.sap.log.error("Request Failed: "+b);this.buidModelData(r);}.bind(this));},buidModelData:function(r){var i,e,g=0,t={items:[],entryObject:{}};for(i in r.nodes){var a=r.nodes[i];if(a.type==='SUBMENU'){var b=a.title;for(e in a.nodes){var c=a.nodes[e];c.groupIndex=g.toString();c.groupName=b;t.items.push(c);t.entryObject[g.toString()]={title:a.title,type:a.type};}}else if(a.type==='URL'||a.type==='APP'){a.groupIndex=g.toString();a.groupName="";t.items.push(a);t.entryObject[g.toString()]={title:a.title,type:a.type,href:a.target};}g++;}var m=new sap.ui.model.json.JSONModel(t);this.getView().setModel(m);},getGroupHeader:function(g){var e=this.getView().getModel().getData().entryObject[g.key];jQuery.sap.require('sap.m.GroupHeaderListItem');if(e.type==="SUBMENU"){var i=new sap.ui.core.Icon({src:'slim-arrow-right',tooltip:e.title}).addStyleClass('sapUshellGroupListItemIcon');var l=new sap.m.Label({text:e.title}).addStyleClass('sapUshellNavTreeLink');return new sap.m.CustomListItem({press:[this.handleClickOnSubMenu,this],type:sap.m.ListType.Active,content:[i,l]}).addStyleClass('sapUshellNavTreeListItem sapUshellNavTreeParent');}else{return new sap.m.CustomListItem({content:new sap.m.Link({text:e.title,href:e.href}).addStyleClass('sapUshellNavTreeLink')}).addEventDelegate({onclick:this.onNavTreeTitleChange.bind(this)}).addStyleClass('sapUshellNavTreeListItem sapUshellNavTreeSingle');}},onNavTreeTitleChange:function(e){if(this._prevSelect){this._prevSelect.removeStyleClass('sapUshellNavTreeItemSelected');}var i=e.srcControl;if(e.srcControl.getContent){window.location.href=e.srcControl.getContent()[0].getHref();i.addStyleClass('sapUshellNavTreeItemSelected');this._prevSelect=i;}else{i.getParent().addStyleClass('sapUshellNavTreeItemSelected');this._prevSelect=i.getParent();}},handleClickOnSubMenu:function(e){var i=e.getSource().getContent()[0];if(i.getSrc()==='slim-arrow-down'){i.setSrc('slim-arrow-right');this.toggleSubItemsState(e,true);}else{i.setSrc('slim-arrow-down');this.toggleSubItemsState(e,false);}},toggleSubItemsState:function(e,i){if(e){var j=jQuery(e.getSource().getDomRef());if(i){j.nextUntil('.sapUshellNavTreeSingle, .sapUshellNavTreeParent').addClass("sapUshellNavTreeChildHide");}else{j.nextUntil('.sapUshellNavTreeSingle, .sapUshellNavTreeParent').removeClass("sapUshellNavTreeChildHide");}}}});},true);
