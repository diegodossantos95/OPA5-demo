sap.ui.define(function(){"use strict";sap=sap||{};sap.ushell=sap.ushell||{};sap.ushell.components=sap.ushell.components||{};sap.ushell.components.tiles.indicatorTileUtils=sap.ushell.components.tiles.indicatorTileUtils||{};sap.ushell.components.tiles.indicatorTileUtils.util=sap.ushell.components.tiles.indicatorTileUtils.util||{};sap.ushell.components.tiles.indicatorTileUtils.util=(function(g,$){"use strict";var c={};var t={"ANN":"years","WEE":"weeks","DAY":"days","HUR":"hours","MIN":"minutes"};var a={};var b={};return{getScheduledJob:function(k){return a[k];},setScheduledJob:function(k,d){a[k]=d;},isCallInProgress:function(k){return b[k];},setUnsetCallInProgress:function(k,v){b[k]=v;},getTimeUnitMap:function(){return t;},getHanaUser:function(){return authObject.userName;},addSystemToServiceUrl:function(u,s){jQuery.sap.log.info("Hana Adapter --> Add System to Service Url");if(sap.ushell&&sap.ushell.Container){if(s){u=sap.ushell.Container.getService("URLParsing").addSystemToServiceUrl(u,s);}else{u=sap.ushell.Container.getService("URLParsing").addSystemToServiceUrl(u);}}return u;},getODataModelByServiceUri:function(s){s=this.addSystemToServiceUrl(s);if(!c[s]){var m=new sap.ui.model.odata.ODataModel(s,{loadMetadataAsync:true,json:true});c[s]=m;}return c[s];},getEdmType:function(u,p){var d=null;if(u instanceof sap.ui.model.odata.ODataModel){d=u;}else{d=this.getODataModelByServiceUri(u);}if(d&&d.getServiceMetadata()){var s=d.getServiceMetadata();var e=s.dataServices.schema[0].entityType;if(e){for(var i=0;i<e.length;i++){var f=e[i];var h=f.property;for(var j=0;j<h.length;j++){var k=h[j];if(k.name==p){return k.type;}}}}}return null;},getMillisecond:function(d,u){var r;switch(u){case"seconds":r=d*1000;break;case"minutes":r=d*60*1000;break;case"hours":r=d*60*60*1000;break;case"days":r=d*24*60*60*1000;break;case"weeks":r=d*7*24*60*60*1000;break;case"months":r=d*4*7*24*60*60*1000;break;case"years":r=d*12*4*7*24*60*60*1000;break;}return r;},getUTCDate:function(){var n=new Date();var u=new Date(n.getTime()+n.getTimezoneOffset()*60000);return n;},isCacheValid:function(d,e,f,h,i){var j=sap.ushell.components.tiles.indicatorTileUtils.cache.getKpivalueById(d);if(!j){return false;}else if(!(f&&Number(f))){return true;}else{var k=this.getMillisecond(f,t[h]);if(jQuery.type(j.CachedTime)=="date"){var l=j.CachedTime&&j.CachedTime.getTime();}else{var l=j.CachedTime&&parseInt(j.CachedTime.substr(6),10);}var m=this.getUTCDate();return(l>=e&&k>=(m-l)&&!i);}},getMantissaLength:function(n){var N=n.toString();var i=0;if(n<0){i=1;}return(N.indexOf('.')===-1)?(n<0?N.length-1:N.length):N.substring(i,N.indexOf('.')).length;},getLocaleFormattedValue:function(n,s,d,i,e){jQuery.sap.require("sap.ui.core.format.NumberFormat");i=i||false;e=e||null;if(i){return sap.ui.core.format.NumberFormat.getCurrencyInstance({style:"short",showMeasure:false}).format(n,e);}var D=2;var f={style:"short"};var N;if(!(d==-1||d==null)){f.shortDecimals=Number(d);f.minFractionDigits=Number(d);f.maxFractionDigits=Number(d);}var v=sap.ui.core.format.NumberFormat.getInstance(f);if(s==-2){if(n>9999){N="????";}else if((n>-0.001&&n<0)||(n<0.001&&n>0)){N="0";}else{if(n.toString().indexOf('.')!=-1){N=Number(n).toFixed(4-n.toString().indexOf('.'));}else{N=Number(n);}N=v.format(N);}}else if(d==-1||d==null){var m=this.getMantissaLength(n);if(!(m%3)){D=1;}if(m%3===1){D=3;}if(m%3===2){D=2;}if(Math.abs(n)%Math.pow(10,m-1)==0){D=0;}else if((Math.abs(n)%Math.pow(10,m-1))<6*Math.pow(10,m-4)){D=0;}v=sap.ui.core.format.NumberFormat.getInstance({style:"short",shortDecimals:D});N=v.format(n);}else{N=v.format(n);}return N;},getPlatform:function(p){return(jQuery.sap.getUriParameters().get("sb_metadata")||p||"HANA").toUpperCase();},getTileTitleSubtitle:function(C){var d={};if(C.bag&&C.bag.getBagIds()&&C.bag.getBagIds().length){d.title=C.bag.getBag("sb_tileProperties").getText("title")||C.bag.getBag("sb_tileProperties").getProperty("title")||C.preview.getTitle();d.subTitle=C.bag.getBag("sb_tileProperties").getText("description")||C.bag.getBag("sb_tileProperties").getProperty("description")||C.preview.getDescription();}else{d.title=C.preview.getTitle();d.subTitle=C.preview.getDescription();}return d;},scheduleFetchDataJob:function(i){var d;if(this.getView().getViewName().indexOf("DualTile")!==-1){d=this.oKpiTileView.oConfig;}else{d=this.oConfig;}var k=d.TILE_PROPERTIES.id+"data";var r=sap.ushell.components.tiles.indicatorTileUtils.util.getScheduledJob(k);if(r){clearTimeout(r);r=undefined;}var t=sap.ushell.components.tiles.indicatorTileUtils.util.getTimeUnitMap();var e=sap.ushell.components.tiles.indicatorTileUtils.util.getCachingTime(d);var f=sap.ushell.components.tiles.indicatorTileUtils.util.getCachingTimeUnit(d);var h=sap.ushell.components.tiles.indicatorTileUtils.util.getMillisecond(e,t[f]);if(jQuery.type(this.cacheTime)=="date"){var j=this.cacheTime;}else{var j=new Date(parseInt(this.cacheTime.substr(6),10));}var l=h-(sap.ushell.components.tiles.indicatorTileUtils.util.getUTCDate()-j);if(l<=0){l=0;}else if(l>2147483646){l=2147483646;}if(!i){l=300000;}if(this.getView().getViewName().indexOf("DualTile")!==-1){r=setTimeout(this.refreshPress.bind(this),l);}else{r=setTimeout(this.refreshHandler.bind(this,false,true),l);sap.ushell.components.tiles.indicatorTileUtils.util.setScheduledJob(k,r);}this.updateDatajobScheduled=true;},scheduleTimeStampJob:function(i){var k=this.oConfig.TILE_PROPERTIES.id+"time";var r=sap.ushell.components.tiles.indicatorTileUtils.util.getScheduledJob(k);if(r){clearTimeout(r);r=undefined;}if(jQuery.type(this.cacheTime)=="date"){var d=this.cacheTime;}else{var d=new Date(parseInt(this.cacheTime.substr(6),10),13);}var e=sap.ushell.components.tiles.indicatorTileUtils.util.getTimeDifference(sap.ushell.components.tiles.indicatorTileUtils.util.getUTCDate()-d);r=setTimeout(this.setTimeStamp.bind(this,this.cacheTime),e.timer);sap.ushell.components.tiles.indicatorTileUtils.util.setScheduledJob(k,r);this.updateTimeStampjobScheduled=true;},getBoolValue:function(v){var r=false;if(typeof v=="boolean"&&v){r=true;}return r;},getSeconds:function(d){return(d/1000);},getMinutes:function(d){return(this.getSeconds(d)/60);},getHours:function(d){return(this.getMinutes(d)/60);},getDays:function(d){return(this.getHours(d)/24);},getWeeks:function(d){return(this.getDays(d)/7);},getMonths:function(d){return(this.getWeeks(d)/4);},getYears:function(d){return(this.getMonths(d)/12);},getTimeDifference:function(d){var r={};if(d){var m=this.getMinutes(d);var h=this.getHours(d);var e=this.getDays(d);if(m<5){r.time=0;r.unit="minutes";r.timer=Math.round(this.getMillisecond(5-m,"minutes"));}else if(m>=5&&m<60){if(m<10){r.time=5;}else{r.time=(m-(m%10));}r.unit="minutes";r.timer=Math.round(this.getMillisecond(10-(m%10),"minutes"));}else if(h>=1&&h<24){r.unit="hours";r.time=(h-(h%1));r.timer=Math.round(this.getMillisecond(1-(h%1),"hours"));}else if(e>=1&&e<2){r.unit="days";r.time=(e-(e%1));r.timer=Math.round(this.getMillisecond(1-(e%1),"days"));}else{r.unit="days";r.time=(e-(e%1));r.timer=this.getMillisecond(2,"days");}}else{r.timer=6000;r.unit="days";r.timer=2000;}return r;},getCachingTime:function(C){return((C.CACHINGTIME&&Number(C.CACHINGTIME))||(C.TILE_PROPERTIES.cachingTime&&Number(C.TILE_PROPERTIES.cachingTime)));},getCachingTimeUnit:function(C){return(C.CACHINGUNIT||C.TILE_PROPERTIES.cachingTimeUnit);},getFrontendCacheQuery:function(d,u,p,T){var e;try{var f=T.url.addSystemToServiceUrl('/sap/opu/odata/SSB/SMART_BUSINESS_RUNTIME_SRV');f=sap.ushell.components.tiles.smartBusinessUtil.cacheBustingMechanism(f);e=this.getODataModelByServiceUri(f);var f="/CacheParameters(P_CacheType=1)/Results";return{oModel:e,uri:f};}catch(h){jQuery.sap.log.error("FrontEnd cache Metadata failed");return null;}},isDualTile:function(C){var d=C&&C.TILE_PROPERTIES&&C.TILE_PROPERTIES.tileType;if(d.indexOf("DT-")==-1){return false;}return true;},writeFrontendCacheByChipAndUserId:function(T,d,e,u,f){var s=function(e){jQuery.sap.log.info("cache write successFully");f(e);};var h=function(){jQuery.sap.log.error("cache update failed");f(null);};try{var i=T.url.addSystemToServiceUrl("/sap/opu/odata/SSB/SMART_BUSINESS_RUNTIME_SRV/");i=sap.ushell.components.tiles.smartBusinessUtil.cacheBustingMechanism(i);var j=this.getODataModelByServiceUri(i);var k="/CacheData";j.create(k,e,{async:true,success:s,error:h});}catch(l){jQuery.sap.log.error(l);}},getKpiChipsOnPage:function(d,e){var f=[];var h=this;var l=sap.ushell.Container.getService("LaunchPage");l.getGroups().done(function(G){if(G&&G instanceof Array&&G.length){jQuery.sap.log.info("Group Chip fetch");}e(d,f);});},getFrontendCache:function(C,T){var d=this;var o=sap.ushell.components.tiles.indicatorTileUtils.cache.getFrontEndCacheDeferredObject(T.url.getApplicationSystem());var e;if(o){e=o;}else{e=jQuery.Deferred();}var f=C&&C.TILE_PROPERTIES&&C.TILE_PROPERTIES.id;var h=sap.ushell.components.tiles.indicatorTileUtils.cache.getKpivalueById(f);if(h){o.resolve(true);}else if(o){return o.promise();}else{sap.ushell.components.tiles.indicatorTileUtils.cache.setFrontEndCacheDefferedObject(T.url.getApplicationSystem(),e);o=e;this.getKpiChipsOnPage(f,function(f,p){if(p){var i=d.getFrontendCacheQuery(p,sap.ushell.Container.getUser().getId(),p,T);if(i){var j=i.oModel;var k=i.uri;var l=false;var m=j.read(k,null,null,true,function(n){if(n&&n.results&&n.results instanceof Array&&n.results.length){jQuery.each(n.results,function(q,r){sap.ushell.components.tiles.indicatorTileUtils.cache.setKpivalueById(r.ChipId,r);});}if(sap.ushell.components.tiles.indicatorTileUtils.cache.getKpivalueById(f)){l=true;}o.resolve(l);},function(n){if(n&&n.response){jQuery.sap.log.error(n.message+" : "+n.request.requestUri);}o.reject();});}else{o.reject();}}else{o.resolve(false);}});}return o.promise();},getModelerRuntimeServiceModel:function(){var u="/sap/hba/apps/kpi/s/odata/smart_business_runtime_services.xsodata";u=sap.ushell.components.tiles.smartBusinessUtil.cacheBustingMechanism(u);return this.getODataModelByServiceUri(u);},getSapFontErrorCode:function(){return String.fromCharCode(0xe0b1);},getSapFontBusyCode:function(){return String.fromCharCode(0xe1f2);},prepareFilterStructure:function(f,d){var v=[];if(d){f=f.concat(d);}for(var i=0;i<f.length;i++){var p={};p.comparator=f[i].OPERATOR;p.filterPropertyName=f[i].NAME;if(f[i].ID){p.id=f[i].ID;}p.type=f[i].TYPE;p.value=f[i].VALUE_1;p.valueTo=f[i].VALUE_2;v.push(p);}return v;},getODataModelByServiceUriFromChipAPI:function(s,T){s=T.url.addSystemToServiceUrl(s);if(!c[s]){var m=new sap.ui.model.odata.ODataModel(s,true);c[s]=m;}return c[s];},cacheBustingMechanism:function(u){if(window["sap-ushell-config"].cacheBusting.cacheBusterToken){var d=window["sap-ushell-config"].cacheBusting&&window["sap-ushell-config"].cacheBusting.cacheBusterToken;u=u+"?_="+d;}return u;},getRunTimeUri:function(p){var u="/sap/hba/r/sb/core/odata/runtime/SMART_BUSINESS.xsodata";var d="/sap/opu/odata/SSB/SMART_BUSINESS_RUNTIME_SRV";if(p.toUpperCase()=="HANA"){if(window["sap-ushell-config"].cacheBusting){u=sap.ushell.components.tiles.smartBusinessUtil.cacheBustingMechanism(u);}return u;}if(window["sap-ushell-config"].cacheBusting){d=sap.ushell.components.tiles.smartBusinessUtil.cacheBustingMechanism(d);}return d;},getFilterFromRunTimeService:function(C,T,s,e){var p=C.TILE_PROPERTIES.sb_metadata;var K=this.getODataModelByServiceUriFromChipAPI(this.getRunTimeUri(p),T);var f="ID eq '#EVALUATIONID'".replace("#EVALUATIONID",C.EVALUATION.ID);var k=K.read("/EVALUATION_FILTERS",null,{"$filter":f},true,function(d){var h=[];if(d.results.length){h=d.results;}s.call(this,h);},e);return k;},_getOData4AnalyticsObject:function(u){var m=null;if(u instanceof sap.ui.model.odata.ODataModel){m=u;}else if(typeof u=="string"){m=this.getODataModelByServiceUri(u);}else{throw new Error("Invalid Input to Create ODataModel Object : "+u);}var O=new sap.ui.model.analytics.odata4analytics.Model(sap.ui.model.analytics.odata4analytics.Model.ReferenceByModel(m));return O;},findTextPropertyForDimension:function(u,d,f){try{var o=this._getOData4AnalyticsObject(u);var q=o.findQueryResultByName(d);var D=q.findDimensionByName(f);if(D.getTextProperty()){return D.getTextProperty().name;}else{return f;}}catch(e){$.sap.log.error("Error Fetching Text Property for "+f+" : "+e.toString());}},getEvalValueMeasureName:function(C,d,r){var e=C.EVALUATION_VALUES;for(var i=0;i<e.length;i++){if(e[i].TYPE==d){if(r==="FIXED"){return e[i].FIXED;}else{return e[i].COLUMN_NAME;}}}},getSemanticColorName:function(d){var s="";if(d=="Error"){s="sb.error";}if(d=="Neutral"){s="sb.neutral";}if(d=="Critical"){s="sb.critical";}if(d=="Good"){s="sb.good";}return s;},setTooltipInTile:function(C,d,v){var e="";var r=sap.ushell.components.tiles.utils.getResourceBundleModel().getResourceBundle();if(d=="NT"||d=="DT"){if(v.status){e+=r.getText("sb.status")+": "+r.getText(v.status)+"\n";}if(v.actual){e+=r.getText("sb.actual")+": "+v.actual+"\n";}if(v.target){e+=r.getText("sb.target")+": "+v.target+"\n";}if(v.cH){e+=r.getText("sb.ch")+": "+v.cH+"\n";}if(v.wH){e+=r.getText("sb.wh")+": "+v.wH+"\n";}if(v.wL){e+=r.getText("sb.wl")+": "+v.wL+"\n";}if(v.cL){e+=r.getText("sb.cl")+": "+v.cL+"\n";}}if(d=="CONT"||d=="COMP"){if(v.measure&&d=="CONT"){if(v&&v.contributionTile.contributionTile&&v.contributionTile.contributionTile[1]==="asc"){e+=r.getText("sb.bottomn")+": "+v.contributionTile[0]+"\n";}else if(v&&v.contributionTile.contributionTile&&v.contributionTile.contributionTile.length){e+=r.getText("sb.topn")+": "+v.contributionTile[0]+"\n";}}if(v.m1&&((v.v1==undefined||v.v1==null)?false:v.v1.toString())&&v.c1){e+=v.m1+": "+v.v1+" "+r.getText(v.c1)+"\n";}if(v.m2&&((v.v2==undefined||v.v2==null)?false:v.v2.toString())&&v.c2){e+=v.m2+": "+v.v2+" "+r.getText(v.c2)+"\n";}if(v.m3&&((v.v3==undefined||v.v3==null)?false:v.v3.toString())&&v.c3){e+=v.m3+": "+v.v3+" "+r.getText(v.c3)+"\n";}}C&&C.setTooltip&&C.setTooltip(e);},_getFormattedTileProperties:function(d){d=d||{};var p=["sb_metadata","sb_navigation","sb_catalog"];var e=false;for(var i=0;!e&&i<p.length;i++){e=e||jQuery.sap.getUriParameters().get(p[i])||d[p[i]];}d.sb_metadata=(jQuery.sap.getUriParameters().get("sb_metadata")||d.sb_metadata||"HANA").toLowerCase();d.sb_navigation=(jQuery.sap.getUriParameters().get("sb_navigation")||d.sb_navigation||"abap").toLowerCase();d.sb_catalog=(jQuery.sap.getUriParameters().get("sb_catalog")||d.sb_catalog||"HANA").toLowerCase();d.isPlatformInfoPresent=e;return d;},getEvaluationDetailsFromRunTimeService:function(e,p,i,d){var K=this.getODataModelByServiceUri(this.getRunTimeUri(p));var f="ID eq '#EVALUATIONID'".replace("#EVALUATIONID",i);var k=K.read(e,null,{"$filter":f},true,function(h){var j=[];if(h.results.length){j=h.results;}d.call(this,j);});},getParsedChip:function(C,i,d){try{var p={};var e=JSON.parse(C);var f=JSON.parse(e.TILE_PROPERTIES).evaluationId||"";if(e.TILE_PROPERTIES){var h=JSON.parse(e.TILE_PROPERTIES);if(h&&(h.instanceId||h.catalogId)){return false;}}var j=this;if(e.blankTile){p["BLANKTILE"]=e.blankTile;}if(e.cachingTime){p["CACHINGTIME"]=e.cachingTime;}if(e.cachingTimeUnit){p["CACHINGUNIT"]=e.cachingTimeUnit;}if(e.TAGS){p["TAGS"]=JSON.parse(e.TAGS);}if(e.ADDITIONAL_FILTERS){p["ADDITIONAL_FILTERS"]=JSON.parse(e.ADDITIONAL_FILTERS);}if(e.ADDITIONAL_APP_PARAMETERS){p["ADDITIONAL_APP_PARAMETERS"]=JSON.parse(e.ADDITIONAL_APP_PARAMETERS);}p.TILE_PROPERTIES=this._getFormattedTileProperties(JSON.parse(e.TILE_PROPERTIES));var P=p.TILE_PROPERTIES.sb_metadata;if(e.EVALUATION_FILTERS){p["EVALUATION_FILTERS"]=JSON.parse(e.EVALUATION_FILTERS);if(e.EVALUATION_VALUES){p["EVALUATION_VALUES"]=JSON.parse(e.EVALUATION_VALUES);if(e.EVALUATION){p.EVALUATION=JSON.parse(e.EVALUATION);if(d){d(p);}else{return p;}}else{if(!i){j.getEvaluationDetailsFromRunTimeService("/EVALUATIONS",P,f,function(l){p.EVALUATION=l;if(d){d(p);}else{return p;}});}else{if(d){d(p);}else{return p;}}}}else{if(!i){j.getEvaluationDetailsFromRunTimeService("/EVALUATION_VALUES",P,f,function(l){p["EVALUATION_VALUES"]=l;if(e.EVALUATION){p.EVALUATION=JSON.parse(e.EVALUATION);if(d){d(p);}else{return p;}}else{j.getEvaluationDetailsFromRunTimeService("/EVALUATIONS",P,f,function(l){p.EVALUATION=l;if(d){d(p);}else{return p;}});}});}else{if(d){d(p);}else{return p;}}}}else if(i){if(d){d(p);}else{return p;}}else{j.getEvaluationDetailsFromRunTimeService("/EVALUATION_FILTERS",P,f,function(l){p["EVALUATION_FILTERS"]=l;if(e.EVALUATION_VALUES){p["EVALUATION_VALUES"]=JSON.parse(e.EVALUATION_VALUES);if(e.EVALUATION){p.EVALUATION=JSON.parse(e.EVALUATION);if(d){d(p);}else{return p;}}else{j.getEvaluationDetailsFromRunTimeService("/EVALUATIONS",P,f,function(l){p.EVALUATION=l;if(d){d(p);}else{return p;}});}}else{j.getEvaluationDetailsFromRunTimeService("/EVALUATION_VALUES",P,f,function(l){p["EVALUATION_VALUES"]=l;if(e.EVALUATION){p.EVALUATION=JSON.parse(e.EVALUATION);if(d){d(p);}else{return p;}}else{j.getEvaluationDetailsFromRunTimeService("/EVALUATIONS",P,f,function(l){p.EVALUATION=l;if(d){d(p);}else{return p;}});}});}});}}catch(k){return false;}},getNavigationTarget:function(C,s){var f=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService;var o=f&&f("CrossApplicationNavigation");var e;var p={};p["evaluationId"]=C.EVALUATION.ID;p["chipId"]=C.TILE_PROPERTIES.id;if(s){p["sap-system"]=s;}p["tileType"]=C.TILE_PROPERTIES.tileType;if(C.TILE_PROPERTIES.dimension){p["dimension"]=C.TILE_PROPERTIES.dimension;}if(C.TILE_PROPERTIES.storyId){p["storyId"]=C.TILE_PROPERTIES.storyId;}if(C.TILE_PROPERTIES.apfConfId){p["sap-apf-configuration-id"]=C.TILE_PROPERTIES.apfConfId;}if(C.TILE_PROPERTIES.isPlatformInfoPresent){p["sb_metadata"]=C.TILE_PROPERTIES.sb_metadata;p["sb_navigation"]=C.TILE_PROPERTIES.sb_navigation;p["sb_catalog"]=C.TILE_PROPERTIES.sb_catalog;}if(C.ADDITIONAL_APP_PARAMETERS){for(e in C.ADDITIONAL_APP_PARAMETERS){if(C.ADDITIONAL_APP_PARAMETERS.hasOwnProperty(e)){if(C.ADDITIONAL_APP_PARAMETERS[e].constructor==Array){var d=C.ADDITIONAL_APP_PARAMETERS[e];for(var i=0;i<d.length;i++){p[e]=d[i];}}else{p[e]=C.ADDITIONAL_APP_PARAMETERS[e];}}}}var h=o&&o.hrefForExternal({target:{semanticObject:C.TILE_PROPERTIES.semanticObject,action:C.TILE_PROPERTIES.semanticAction},params:p})||"";if(C.ADDITIONAL_FILTERS){var k=C.ADDITIONAL_FILTERS;var l="&";for(var j=0;j<k.length;j++){if(k[j].OPERATOR==="EQ"){l=l+"/"+k[j].NAME+"="+k[j].VALUE_1;}}h+=l;}return h;},getChipTitle:function(C){var d="";if(C){var e=C.EVALUATION||{};d=e.INDICATOR_TITLE||"";}return d;},getstringifyTileConfig:function(C){var s={};s.EVALUATION=JSON.stringify(C.EVALUATION);s.EVALUATION_FILTERS=JSON.stringify(C.EVALUATION_FILTERS);s.EVALUATION_VALUES=JSON.stringify(C.EVALUATION_VALUES);s.TILE_PROPERTIES=JSON.stringify(C.TILE_PROPERTIES);return JSON.stringify(s);},getChipSubTitle:function(C){var T="";if(C){var d=C.EVALUATION||{};T=d.TITLE||"";}return T;},getAllMeasures:function(u,d){var m=[];try{var o=this._getOData4AnalyticsObject(u);var q=o.findQueryResultByName(d);m=q.getAllMeasureNames();}catch(e){$.sap.log.error("Error Fetching All Measures : "+e.toString());}return m;},getFormattingMetadata:function(u,e,p){var f={};f._hasCurrency=false;f._hasSapText=false;var m=null;if(u instanceof sap.ui.model.odata.ODataModel){m=sap.ui.model.analytics.odata4analytics.Model.ReferenceByModel(u);}else{var d=this.getODataModelByServiceUri(u);m=sap.ui.model.analytics.odata4analytics.Model.ReferenceByModel(d);}var O=new sap.ui.model.analytics.odata4analytics.Model(m);var q=O.findQueryResultByName(e);var h=q.getAllMeasures();if(h[p]){var s=(h[p]._oTextProperty&&h[p]._oTextProperty.name)?h[p]._oTextProperty.name:"";if(s!=""){f._hasSapText=true;f._sapTextColumn=s;}else if(h[p].hasOwnProperty("_oUnitProperty")){var j=h[p]._oUnitProperty.extensions;for(var i=0;i<h[p]._oUnitProperty.extensions.length;i++){if(j[i].name==="semantics"&&j[i].value==="currency-code"){f._hasCurrency=true;f._currencyColumn=h[p]._oUnitProperty.name;}}}}return f;},getAllDimensions:function(u,d){function i(j,k){var l=0,m=0;var r=[];while(l<j.length&&m<k.length){if(j[l]<k[m]){l++;}else if(j[l]>k[m]){m++;}else{r.push(j[l]);l++;m++;}}return r;}var f=[];var F=[];try{var o=this._getOData4AnalyticsObject(u);var q=o.findQueryResultByName(d);var h=q.getEntityType();F=h.getFilterablePropertyNames();f=q.getAllDimensionNames();if(F&&F.length){f=i(F.sort(),f.sort());}}catch(e){$.sap.log.error("Error Fetching All Dimesions : "+e.toString());}return f;},prepareQueryServiceUri:function(u,d,m,f,v,o,h){function _(S){return S.replace(/'/g,"''");}var n=null;var p=function(){};var q=function(){};try{var r=null;if(u instanceof sap.ui.model.odata.ODataModel){r=sap.ui.model.analytics.odata4analytics.Model.ReferenceByModel(u);}else{var s=this.getODataModelByServiceUri(u);r=sap.ui.model.analytics.odata4analytics.Model.ReferenceByModel(s);}var O=new sap.ui.model.analytics.odata4analytics.Model(r);var Q=O.findQueryResultByName(d);var w=new sap.ui.model.analytics.odata4analytics.QueryResultRequest(Q);if(m){w.setMeasures(m.split(","));w.includeMeasureRawFormattedValueUnit(null,true,true,true);}if(f){if(typeof f=="string"){n=f;n=n.split(",");}for(var i=0;i<n.length;i++){w.addToAggregationLevel([n[i]]);var x=Q.getAllDimensions();if(x[n[i]].getTextProperty()!=null){w.includeDimensionKeyTextAttributes([n[i]],true,true,null);}}}if(v&&v.length){var A=[];var B=[];for(var i=0,l=v.length;i<l;i++){var C=v[i];if(C.type==="PA"){B.push(C);}else if(C.type==="FI"){A.push(C);}}p=function(S){var T=S.toJSON();var U=T.charAt(T.length-1).toUpperCase();if(U.charCodeAt(0)>=65&&U.charCodeAt(0)<=90){T=T.slice(0,-1);}return T;};q=function(S){if(S){try{if(S==+S){S=window.parseInt(S);}var T=new Date(S);var U=T.getTime();if(isNaN(U)){return S;}else{return p(T);}}catch(e){}}return S;};if(A.length){var F=w.getFilterExpression();for(var i=0,l=A.length;i<l;i++){var C=A[i];if(this.getEdmType(u,C.filterPropertyName)=="Edm.DateTime"){C.value=q(C.value);C.valueTo=q(C.valueTo);}if(C.comparator==sap.ui.model.FilterOperator.BT){F.addCondition(C.filterPropertyName,C.comparator,_(C.value),C.valueTo);}else{var D=C.value.split(",");for(var j=0,k=D.length;j<k;j++){F.addCondition(C.filterPropertyName,C.comparator,_(D[j].replace(/\^\|/g,",")),null);}}}}if(B.length){if(Q.getParameterization()){var P=new sap.ui.model.analytics.odata4analytics.ParameterizationRequest(Q.getParameterization());var E=Q.getParameterization();var G,H,I,J,K;for(var y=0,z=B.length;y<z;y++){G=B[y];H=E.findParameterByName(G.filterPropertyName);if(H.isIntervalBoundary()===true&&H.isLowerIntervalBoundary()===true){K=H.getPeerIntervalBoundaryParameter();for(var i=0,l=B.length;i<l;i++){if(B[i].filterPropertyName===K.getName()){J=_(B[i].value);break;}}I=_(G.value);if(J){P.setParameterValue(G.filterPropertyName,I,J);}}else if(H.isIntervalBoundary()===true&&H.isLowerIntervalBoundary()===false){jQuery.sap.log.info("Future development");}else{P.setParameterValue(G.filterPropertyName,_(G.value));}}w.setParameterizationRequest(P);}}}var L=w.getURIToQueryResultEntries();if(o&&o.length){L=L+"&$orderby=";for(var y=0,z=o.length;y<z;y++){var M=o[y].sortOrder||"asc";if(M){L+=o[y].element+" "+M+",";}}L=L.slice(0,L.length-1);}if(h){L=L+"&$top="+h;}var N=Q.getAllMeasures();var R=[];for(var i=0;i<m.split(",").length;i++){R.push(N[m.split(",")[i]].getUnitProperty());}return{uri:L,model:O.getODataModel(),unit:R};}catch(e){$.sap.log.error("Error Preparing Query Service Uri using OData4Analytics Library : "+e.toString());if(arguments.length){$.sap.log.error("Arguments Passed to this function");$.sap.log.error(arguments[0]+","+arguments[1]+","+arguments[2]+","+arguments[3]);}else{$.sap.log.error("NO Arguments passed to this function");}return null;}},getAllEntitySet:function(u){var d=[];try{var o=this._getOData4AnalyticsObject(u);d=o.getAllQueryResultNames();}catch(e){$.sap.log.error("Error fetching Enity Set : "+e.toString());}return d;},getAllMeasuresWithLabelText:function(u,d){var m=[];try{var o=this._getOData4AnalyticsObject(u);var q=o.findQueryResultByName(d);var f=q.getAllMeasureNames();for(var i=0;i<f.length;i++){var h=f[i];g.oMeasure=q.findMeasureByName(h);m.push({key:h,value:oMeasure.getLabelText()});}}catch(e){$.sap.log.error("Error Fetching All Measures : "+e.toString());}return m;},getAllDimensionsWithLabelText:function(u,d){var f=[];try{var o=this._getOData4AnalyticsObject(u);var q=o.findQueryResultByName(d);var h=q.getAllDimensionNames();for(var i=0;i<h.length;i++){var j=h[i];var D=q.findDimensionByName(j);var k=null;if(D.getTextProperty()!=null){k=D.getTextProperty().name;}f.push({key:j,value:D.getLabelText(),textProperty:k});}}catch(e){$.sap.log.error("Error Fetching All Dimesions : "+e.toString());}return f;},getAllInputParams:function(u,d){var i=[];try{var o=this._getOData4AnalyticsObject(u);var q=o.findQueryResultByName(d);if(q.getParameterization()){var p=q.getParameterization();i=p.getAllParameterNames();}}catch(e){$.sap.log.error("Error Fetching Input Params : "+e.toString());}return i;},getAllInputParamsWithFlag:function(u,d){var f=[];try{var o=this._getOData4AnalyticsObject(u);var q=o.findQueryResultByName(d);if(q.getParameterization()){var p=q.getParameterization();var h=p.getAllParameterNames();for(var i=0;i<h.length;i++){var j=h[i];var k=p.findParameterByName(j);f.push({name:j,optional:k.isOptional()});}}}catch(e){$.sap.log.error("Error Fetching Input Params : "+e.toString());}return f;},formatOdataObjectToString:function(v){if(v&&v.constructor==Object){if(v.__edmType=="Edm.Time"){var m=v.ms;var s=Math.floor((m/1000)%60);var d=Math.floor((m/60000)%60);var h=Math.floor((m/3600000)%24);return h+"H"+d+"M"+s+"S";}}return v;},generateCombinations:function(d){function e(h,s){while(s.length<h){s='0'+s;}return s;}var m=Math.pow(2,d.length);var r=[];var f=0;while(m>1){var s=(m-1).toString(2);s=e(d.length,s);r[f]=[];for(var i=0;i<s.length;i++){if(Number(s[i])){r[f].push(d[i]);}}m--;f++;}return r;},logError:function(e,C){if(e=="no data"&&C){var r=sap.ushell.components.tiles.utils.getResourceBundleModel().getResourceBundle();C.setFailedText(r.getText("sb.noData"));}jQuery.sap.log.error(e.toString());},numberOfLeadingZeros:function(n){n=String(n);var d=0;var e=n.indexOf('.');if(e==-1){return 0;}if(Number(n.split('.')[0])!=0){return 0;}var i=e+1;while(n[i++]=='0'){++d;}return d;},formatValue:function(v,s,M){M=M||3;var u={3:"K",6:"M",9:"B",12:"T",0:""};u["-3"]="m";u["-6"]="u";u["-9"]="n";u["-12"]="t";u["-2"]="%";var d,p,e;d=Number(v).toPrecision(M);var z=this.numberOfLeadingZeros(d);if(z>0&&s<0){p=d*Math.pow(10,z+M);e=-(z+M);}else{p=Number(d.split("e")[0]);e=Number(d.split("e")[1])||0;}if(!v&&v!=0){return{value:"",unitPrefix:""};}if(s>=0){if(e%3!=0){if(e%3==2){if(e+1==s){e=e+1;p=p/10;}else{e=e-2;p=p*100;}}else{if(e+2==s){e=e+2;p=p/100;}else{e--;p=p*10;}}}else if(e==15){p=p*1000;e=12;}}else{if(s=="-2"){var x=this.formatValue((v*100),0);}else if(e>=0&&v<10&&s=="-3"){p=v*Math.pow(10,3);e=-3;}else if(e>=0){return this.formatValue(v,0);}else{e=Math.abs(e);s=Math.abs(s);if(s>e){p=p/(Math.pow(10,e%3));e=e-(e%3);}else{var f=e-s;p=p/(Math.pow(10,f));e=e-f;}e=0-e;}}p+="";if(s=="-2"){var h=(x.unitPrefix=="")?Number(x.value+"").toFixed(4-(x.value+"").indexOf('.')):Number(x.value+"").toFixed(3-(x.value+"").indexOf('.'));return{value:Number(h),unitPrefix:(x.unitPrefix)+u[-2]};}p=Number(p).toFixed(4-p.indexOf('.'));return{value:Number(p),unitPrefix:u[e]};},isSmartbusinessChipAndCachable:function(d){var C=this.getParsedChip(d&&d.getConfigurationParameter("tileConfiguration"));return(C&&C.TILE_PROPERTIES&&C.TILE_PROPERTIES.tileType&&this.getCachingTime(C));},getHanaClient:function(){var e=function(d,s,x){h=d.sessionClient;sap.ushell.components.tiles.indicatorTileUtils.cache.setCacheHanaClient(h);sap.ushell.components.tiles.indicatorTileUtils.util.HANA_CLIENT_DEFERRED.resolve(h);};var f=function(d,k,l){jQuery.sap.log.error(d.responseText);jQuery.sap.log.error("session client call failed");sap.ushell.components.tiles.indicatorTileUtils.cache.setCacheHanaClient(null);sap.ushell.components.tiles.indicatorTileUtils.util.HANA_CLIENT_DEFERRED.reject();};var h;var i=sap.ushell.components.tiles.indicatorTileUtils.util.HANA_CLIENT_DEFERRED||jQuery.Deferred();var j=sap.ushell.components.tiles.indicatorTileUtils.cache.getCacheHanaClient();if(j!=undefined){h=j;sap.ushell.components.tiles.indicatorTileUtils.util.HANA_CLIENT_DEFERRED.resolve(h);}else if(sap.ushell.components.tiles.indicatorTileUtils.util.HANA_CLIENT_DEFERRED){return sap.ushell.components.tiles.indicatorTileUtils.util.HANA_CLIENT_DEFERRED.promise();}else{sap.ushell.components.tiles.indicatorTileUtils.util.HANA_CLIENT_DEFERRED=i;jQuery.ajax({type:"GET",async:false,dataType:"json",url:"/sap/hba/r/sb/core/logic/GetSessionClient.xsjs",success:e,error:f});}return sap.ushell.components.tiles.indicatorTileUtils.util.HANA_CLIENT_DEFERRED.promise();},abortPendingODataCalls:function(d){try{if(d){d.abort();}}catch(e){this.logError(e);}}};})(window,jQuery);sap.ushell.components.tiles.indicatorTileUtils.cache=(function(){var B={};var K={};var s="HANA_CLIENT";return{getCacheHanaClient:function(){return B[s];},setCacheHanaClient:function(d){B[s]=d;},getEvaluationByChipId:function(k){if(B[k]){return B[k];}return null;},getEvaluationById:function(k){return this.getEvaluationByChipId(k);},setEvaluationById:function(k,d){B[k]=d;},getFrontEndCacheDeferredObject:function(k){if(B[k]){return B[k];}return null;},setFrontEndCacheDefferedObject:function(k,d){B[k]=d;},getKpivalueById:function(k){if(K[k]){return K[k];}return null;},setKpivalueById:function(k,d){K[k]=d;}};})();},true);
