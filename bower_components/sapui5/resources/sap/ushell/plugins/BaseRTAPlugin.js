sap.ui.define(["sap/ui/core/Component","sap/ui/model/resource/ResourceModel","sap/m/MessageBox","sap/ui/core/BusyIndicator"],function(C,R,M,B){"use strict";var a=sap.ui.core.Component.extend("sap.ushell.plugins.BaseRTAPlugin",{_getRenderer:function(){var t=this,d=new jQuery.Deferred(),r;t._oShellContainer=jQuery.sap.getObject("sap.ushell.Container");if(!t._oShellContainer){d.reject("Illegal state: shell container not available; this component must be executed in a unified shell runtime context.");}else{r=t._oShellContainer.getRenderer();if(r){d.resolve(r);}else{t._onRendererCreated=function(e){r=e.getParameter("renderer");if(r){d.resolve(r);}else{d.reject("Illegal state: shell renderer not available after recieving 'rendererCreated' event.");}};t._oShellContainer.attachRendererCreatedEvent(t._onRendererCreated);}}return d.promise();},init:function(c){var t=this;this.mConfig=c;this.i18n=this.getModel("i18n").getResourceBundle();this._getRenderer().fail(function(e){jQuery.sap.log.error(e,undefined,this.mConfig.sComponentName);}).done(function(r){var A=sap.ushell.Container.getService("AppLifeCycle");var o=A.getCurrentApplication();if(o&&this._checkUI5App(o)){this._checkRestartRTA();}A.attachAppLoaded(function(e){if(this._checkUI5App(e.mParameters)){this._checkRestartRTA();}}.bind(this));var _=function(e){t._onAdapt(e);};r.addActionButton("sap.ushell.ui.launchpad.ActionItem",{id:this.mConfig.id,text:this.i18n.getText(this.mConfig.text),icon:this.mConfig.icon,press:_,visible:this.mConfig.visible},true,false,[r.LaunchpadState.App]);}.bind(this));},exit:function(){if(this._oShellContainer&&this._onRendererCreated){this._oShellContainer.detachRendererCreatedEvent(this._onRendererCreated);}},_onAdapt:function(e){var s=((sap.ui.Device.browser.msie&&sap.ui.Device.browser.version>10)||sap.ui.Device.browser.webkit||sap.ui.Device.browser.firefox||sap.ui.Device.browser.edge);if(!s){M.error(this.i18n.getText("MSG_UNSUPPORTED_BROWSER"),{title:this.i18n.getText("ERROR_TITLE"),onClose:null});}else{window.setTimeout(function(){this._switchToAdaptionMode();}.bind(this),0);}},_checkUI5App:function(c){c=c?c:this._getCurrentRunningApplication();var u=c&&c.applicationType==="UI5"&&!c.homePage;return u;},_checkRestartRTA:function(){var r=!!window.localStorage.getItem("sap.ui.rta.restart."+this.mConfig.layer);if(r){window.localStorage.removeItem("sap.ui.rta.restart."+this.mConfig.layer);this._switchToAdaptionMode();}},_getCurrentRunningApplication:function(){var A=sap.ushell.Container.getService("AppLifeCycle");var o=A.getCurrentApplication();return o;},_switchToDefaultMode:function(){if(this._oRTA){this._oRTA.destroy();this._oRTA=null;}},_switchToAdaptionMode:function(){var u=this._checkUI5App();if(!u){M.error(this.i18n.getText("MSG_UNSUPPORTED_APP"),{title:this.i18n.getText("ERROR_TITLE"),onClose:null});return;}var c=this._getCurrentRunningApplication();var r=c.componentInstance.getAggregation("rootControl");if(this._oRTA){this._startRta(r);}else{B.show(0);sap.ui.getCore().loadLibraries(["sap.ui.dt","sap.ui.rta"],{async:true}).then(function(){sap.ui.require(["sap/ui/rta/RuntimeAuthoring"],function(b){this._oRTA=new b({flexSettings:{layer:this.mConfig.layer,developerMode:this.mConfig.developerMode}});this._oRTA.attachEvent('start',function(e){B.hide();this._onStartHandler(e);},this);this._oRTA.attachEvent('failed',this._errorHandler,this);this._oRTA.attachEvent('stop',this._switchToDefaultMode,this);this._loadPlugins(this._oRTA).then(function(){this._startRta(r);}.bind(this));}.bind(this));}.bind(this));}},_startRta:function(r){this._oRTA.setRootControl(r);this._oRTA.start().catch(this._errorHandler.bind(this));},_errorHandler:function(e){this._switchToDefaultMode();B.hide();jQuery.sap.log.error("exception occured while starting sap.ui.rta",e.stack);M.error(this.i18n.getText("MSG_STARTUP_FAILED"),{title:this.i18n.getText("ERROR_TITLE"),onClose:null});},_onStartHandler:function(){},_loadPlugins:function(){return Promise.resolve();}});return a;},true);
