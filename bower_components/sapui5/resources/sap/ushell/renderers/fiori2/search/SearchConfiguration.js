(function(g){"use strict";sap.ui.define(['sap/ushell/renderers/fiori2/search/controls/SearchResultListSelectionHandler','sap/ushell/renderers/fiori2/search/esh/api/release/sina'],function(D){var a=D.getMetadata().getName();jQuery.sap.declare('sap.ushell.renderers.fiori2.search.SearchConfiguration');var u={multiSelect:{type:'bool'},sinaProvider:{type:'string'},odataProvider:{type:'bool'},searchBusinessObjects:{type:'bool'},charts:{type:'bool'},maps:{type:'bool'},newpie:{type:'bool'},personalizationStorage:{type:'string'}};var S=sap.ushell.renderers.fiori2.search.SearchConfiguration=function(){this.init.apply(this,arguments);};S.prototype={init:function(p){try{var c=g['sap-ushell-config'].renderers.fiori2.componentData.config.esearch;jQuery.extend(true,this,c);}catch(e){}this.handleOutdatedConfigurationParameters();this.setDefaults();this.readUrlParameters();this.setModulePaths();this.createDefaultDataSourceConfig();},setModulePaths:function(){if(!this.modulePaths){return;}for(var i=0;i<this.modulePaths.length;++i){var m=this.modulePaths[i];jQuery.sap.registerModulePath(m.moduleName,m.urlPrefix);}},handleOutdatedConfigurationParameters:function(){try{var c=g['sap-ushell-config'].renderers.fiori2.componentData.config;if(c.searchBusinessObjects!==undefined&&this.searchBusinessObjects===undefined){if(c.searchBusinessObjects==='hidden'||c.searchBusinessObjects===false){this.searchBusinessObjects=false;}else{this.searchBusinessObjects=true;}}if(c.enableSearch!==undefined&&this.enableSearch===undefined){this.enableSearch=c.enableSearch;}}catch(e){}},setDefaults:function(){if(this.searchBusinessObjects===undefined){this.searchBusinessObjects=true;}if(this.odataProvider===undefined){this.odataProvider=false;}if(this.multiSelect===undefined){this.multiSelect=true;}if(this.charts===undefined){this.charts=true;}if(this.maps===undefined){this.maps=false;}if(this.newpie===undefined){this.newpie=false;}if(this.dataSources===undefined){this.dataSources={};}if(this.enableSearch===undefined){this.enableSearch=true;}if(this.personalizationStorage===undefined){this.personalizationStorage='auto';}this.dataSourceConfigurations=this.semanticObjects||{};this.semanticObjects=undefined;this.dataSourceConfigurations['fileprocessorurl']=this.dataSourceConfigurations['fileprocessorurl']||{};this.dataSourceConfigurations['fileprocessorurl'].searchResultListItem=this.dataSourceConfigurations['fileprocessorurl'].searchResultListItem||'sap.ushell.renderers.fiori2.search.controls.SearchResultListItemDocument';this.dataSourceConfigurations['noteprocessorurl']=this.dataSourceConfigurations['noteprocessorurl']||{};this.dataSourceConfigurations['noteprocessorurl'].searchResultListItem=this.dataSourceConfigurations['noteprocessorurl'].searchResultListItem||'sap.ushell.renderers.fiori2.search.controls.SearchResultListItemNote';this.dataSourceConfigurations['noteprocessorurl'].searchResultListSelectionHandler=this.dataSourceConfigurations['noteprocessorurl'].searchResultListSelectionHandler||'sap.ushell.renderers.fiori2.search.controls.SearchResultListSelectionHandlerNote';},createDefaultDataSourceConfig:function(){this.defaultDataSourceConfig={searchResultListItem:undefined,searchResultListItemControl:undefined,searchResultListItemContent:undefined,searchResultListItemContentControl:undefined,searchResultListSelectionHandler:a,searchResultListSelectionHandlerControl:D};},readUrlParameters:function(){var p=this.parseUrlParameters();for(var b in p){if(b==='demoMode'){this.searchBusinessObjects=true;this.enableSearch=true;continue;}var c=u[b];if(!c){continue;}var v=p[b];switch(c.type){case'bool':v=(v==='true'||v==='');break;default:}this[b]=v;}},parseUrlParameters:function(){var U=sap.ushell.Container.getService("URLParsing");var p=U.parseParameters(g.location.search);var n={};for(var k in p){var v=p[k];if(v.length!==1){continue;}v=v[0];if(typeof v!=='string'){continue;}n[k]=v;}return n;},loadCustomModulesAsync:function(){var t=this;if(t._loadCustomModulesProm){return t._loadCustomModulesProm;}var d,b=[];for(var c in t.dataSourceConfigurations){d=t.loadCustomModulesForSemanticObjectAsync(c);b.push(d);}t._loadCustomModulesProm=Promise.all(b);return t._loadCustomModulesProm;},loadCustomModulesForDataSourcesAsync:function(d){var b=[];for(var i=0;i<d.length;i++){var c=this.loadCustomModulesForDataSourceAsync(d[i]);b.push(c);}return Promise.all(b);},loadCustomModulesForDataSourceAsync:function(d){var b=this._getSemanticObjectNameFromDataSource(d);return this.loadCustomModulesForSemanticObjectAsync(b);},loadCustomModulesForSemanticObjectAsync:function(b){if(!b){return Promise.resolve();}this._dataSourceLoadingProms=this._dataSourceLoadingProms||{};var d=this._dataSourceLoadingProms[b];if(!d){var c=[{moduleAttrName:"searchResultListItem",controlAttrName:"searchResultListItemControl"},{moduleAttrName:"searchResultListItemContent",controlAttrName:"searchResultListItemContentControl"},{moduleAttrName:"searchResultListSelectionHandler",controlAttrName:"searchResultListSelectionHandlerControl"}];var e=this.dataSourceConfigurations[b]||{};var f,h=[];for(var i=0;i<c.length;i++){f=this._doLoadCustomModulesAsync(b,e,c[i].moduleAttrName,c[i].controlAttrName);h.push(f);}d=Promise.all(h);d._resolvedOrFailed=false;d.then(function(){d._resolvedOrFailed=true;});this._dataSourceLoadingProms[b]=d;}return d;},_doLoadCustomModulesAsync:function(b,d,m,c){var t=this;return new Promise(function(r,f){if(d[m]&&(!d[c]||d[c]==t.defaultDataSourceConfig[c])){try{sap.ui.require([d[m].replace(/[.]/g,'/')],function(i){d[c]=i;r();});}catch(e){var h="Could not load custom module '"+d[m]+"' for data source with semantic object name '"+b+"'. ";h+="Falling back to default data source configuration.";jQuery.sap.log.warning(h,'sap.ushell.renderers.fiori2.search.SearchConfiguration');d[m]=t.defaultDataSourceConfig[m];d[c]=t.defaultDataSourceConfig[c];r();}}else{if(!d[c]){d[m]=t.defaultDataSourceConfig[m];d[c]=t.defaultDataSourceConfig[c];}r();}});},getDataSourceConfig:function(d){var b=this._getSemanticObjectNameFromDataSource(d);if(!b||(this._dataSourceLoadingProms&&this._dataSourceLoadingProms[b]&&!this._dataSourceLoadingProms[b]._resolvedOrFailed)){return this.defaultDataSourceConfig;}var c=this.dataSourceConfigurations[b];if(!c){c=this.defaultDataSourceConfig;this.dataSourceConfigurations[b]=c;}return c;},_getSemanticObjectNameFromDataSource:function(d){var b=d.semanticObjectType;if(!b&&d.semanticObjectTypes&&d.semanticObjectTypes.length==1){b=d.semanticObjectTypes[0];}return b;},isLaunchpad:function(){try{return!!sap.ushell.Container.getService("CrossApplicationNavigation");}catch(e){return false;}},getSina:function(){if(!this.isSinaRegistered){if(!this.odataProvider&&this.isLaunchpad()){sap.ushell.Container.addRemoteSystem(new sap.ushell.System({alias:"ENTERPRISE_SEARCH",platform:"abap",baseUrl:"/ENTERPRISE_SEARCH"}));this.sina=g.sina.getSina();}else{this.sina=g.sina.getSina({'impl_type':"odata2",'servicePath':window.location.pathname.slice(0,window.location.pathname.indexOf('/sap/ushell/renderers/fiori2/search/container/'))+'/es/odata/callbuildin.xsjs'});}}this.isSinaRegistered=true;return this.sina;}};var s;S.getInstance=function(){if(s){return s}s=new S();return s;};return S;});})(window);
