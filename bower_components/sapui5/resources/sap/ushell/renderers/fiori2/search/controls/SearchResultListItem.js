sap.ui.define(['sap/ushell/renderers/fiori2/search/controls/SearchText','sap/ushell/renderers/fiori2/search/controls/SearchLink','sap/ushell/renderers/fiori2/search/SearchHelper','sap/ushell/renderers/fiori2/search/controls/SearchRelatedObjectsToolbar'],function(S,a,b,c){"use strict";var n='\u2013';return sap.ui.core.Control.extend("sap.ushell.renderers.fiori2.search.controls.SearchResultListItem",{metadata:{properties:{title:"string",titleUrl:"string",titleNavigation:"object",type:"string",imageUrl:"string",suvlink:"string",containsThumbnail:"boolean",containsSuvFile:"boolean",attributes:{type:"object",multiple:true},navigationObjects:{type:"object",multiple:true},selected:"boolean",expanded:"boolean",parentListItem:"object"},aggregations:{_titleLink:{type:"sap.ushell.renderers.fiori2.search.controls.SearchLink",multiple:false,visibility:"hidden"},_typeText:{type:"sap.ushell.renderers.fiori2.search.controls.SearchText",multiple:false,visibility:"hidden"},_selectionCheckBox:{type:"sap.m.CheckBox",multiple:false,visibility:"hidden"},_expandButton:{type:"sap.m.Button",multiple:false,visibility:"hidden"},_attributeLabels:{type:"sap.m.Label",multiple:true,visibility:"hidden"},_attributeValues:{type:"sap.ushell.renderers.fiori2.search.controls.SearchText",multiple:true,visibility:"hidden"},_attributeValuesWithoutWhyfoundHiddenTexts:{type:"sap.ui.core.InvisibleText",multiple:true,visibility:"hidden"},_relatedObjectActionsToolbar:{type:"sap.ushell.renderers.fiori2.search.controls.SearchRelatedObjectsToolbar",multiple:false,visibility:"hidden"},_titleLabeledByText:{type:"sap.ui.core.InvisibleText",multiple:false,visibility:"hidden"}}},init:function(){var t=this;t.setAggregation("_titleLink",new a({}).addStyleClass("sapUshellSearchResultListItem-Title").addStyleClass("sapUshellSearchResultListItem-MightOverflow").attachPress(function(e){var p=t._getPhoneSize();var w=$(window).width();if(w<=p){e.preventDefault();}else{t._performOrTrackTitleNavigation(true);}}));t.setAggregation("_typeText",new S().addStyleClass("sapUshellSearchResultListItem-Category").addStyleClass("sapUshellSearchResultListItem-MightOverflow"));t.setAggregation("_selectionCheckBox",new sap.m.CheckBox({select:function(e){t.setProperty("selected",e.getParameters().selected,true);}}));t.setAggregation("_expandButton",new sap.m.Button({type:sap.m.ButtonType.Transparent,press:function(e){t.toggleDetails();}}));t.setAggregation("_relatedObjectActionsToolbar",new c().addStyleClass("sapUshellSearchResultListItem-RelatedObjectsToolbar"));t.setAggregation("_titleLabeledByText",new sap.ui.core.InvisibleText());},renderer:function(r,C){C._renderer(r);},_renderer:function(r){this._resetPrecalculatedValues();this._renderContainer(r);this._renderAccessibilityInformation(r);},_renderContainer:function(r){var t=this;r.write('<div');r.writeControlData(t);r.addClass("sapUshellSearchResultListItem-Container");r.writeClasses();r.write('>');t._renderContentContainer(r);t._renderExpandButtonContainer(r);r.write('</div>');},_renderContentContainer:function(r){r.write('<div class="sapUshellSearchResultListItem-Content">');this._renderTitleContainer(r);this._renderAttributesContainer(r);r.write('</div>');},_renderExpandButtonContainer:function(r){var t=this;r.write('<div class="sapUshellSearchResultListItem-ExpandButtonContainer">');r.write('<div class="sapUshellSearchResultListItem-ExpandButton">');var i,d;var e=t.getProperty("expanded");if(e){i=sap.ui.core.IconPool.getIconURI("slim-arrow-up");d=sap.ushell.resources.i18n.getText("hideDetailBtn_tooltip");}else{i=sap.ui.core.IconPool.getIconURI("slim-arrow-down");d=sap.ushell.resources.i18n.getText("showDetailBtn_tooltip");}var f=t.getAggregation("_expandButton");f.setIcon(i);f.setTooltip(d);f.onAfterRendering=function(){sap.m.Button.prototype.onAfterRendering.apply(this,arguments);t.setAriaExpandedState();};r.renderControl(f);r.write('</div>');r.write('</div>');},_renderTitleContainer:function(r){var t=this;r.write('<div class="sapUshellSearchResultListItem-TitleAndImageContainer">');r.write('<div class="sapUshellSearchResultListItem-TitleContainer">');t._renderCheckbox(r);var d="";var e;var f=t.getTitleNavigation();if(f){d=f.getHref();e=f.getTarget();}var g=t.getAggregation("_titleLink");g.setHref(d);g.setText(t.getTitle());if(e){g.setTarget(e);}if(d.length===0){g.setEnabled(false);}r.renderControl(g);var h=t.getAggregation("_typeText");h.setText(t.getType());r.renderControl(h);r.write('</div>');t._renderImageForPhone(r);r.write('</div>');},_renderCheckbox:function(r){var t=this;r.write('<div class="sapUshellSearchResultListItem-CheckboxExpandContainer">');r.write('<div class="sapUshellSearchResultListItem-CheckboxContainer">');r.write('<div class="sapUshellSearchResultListItem-CheckboxAlignmentContainer">');var d=t.getAggregation("_selectionCheckBox");var s=t.getProperty("selected");d.setSelected(s);r.renderControl(d);r.write('</div>');r.write('</div>');r.write('</div>');},_renderImageForPhone:function(r){var t=this;if(t.getImageUrl()){r.write('<div class="sapUshellSearchResultListItem-TitleImage">');r.write('<div class="sapUshellSearchResultListItem-ImageContainerAlignmentHelper"></div>');r.write('<img class="sapUshellSearchResultListItem-Image" src="');r.write(t.getImageUrl());r.write('">');r.write('</div>');}},_renderAttributesContainer:function(r){var t=this;r.write('<div class="sapUshellSearchResultListItem-AttributesExpandContainer');var e=t.getProperty("expanded");if(e){r.write(" sapUshellSearchResultListItem-AttributesExpanded");}r.write('">');r.write('<div class="sapUshellSearchResultListItem-AttributesAndActions">');r.write('<ul class="sapUshellSearchResultListItem-Attributes">');t._renderImageAttribute(r);var i=t.getAttributes();t._renderAllAttributes(r,i);r.write('<div class="sapUshellSearchResultListItem-ExpandSpacerAttribute" aria-hidden="true"></div>');r.write('</ul>');t._renderRelatedObjectsToolbar(r);r.write('</div>');r.write('</div>');},_renderAllAttributes:function(r,d){var t=this;var e;var l;var v;var f;var g,h;var k;var i=0,j=0;var m=12;if(t.getImageUrl()){m--;}t.destroyAggregation("_attributeLabels");t.destroyAggregation("_attributeValues");t.destroyAggregation("_attributeValuesWithoutWhyfoundHiddenTexts");for(;j<m&&i<d.length;i++){e=d[i];if(e.isTitle){continue;}l=e.name;v=e.value;f=e.valueWithoutWhyfound;if(l===undefined||v===undefined){continue;}if(!v||v===""){v=n;}r.write('<li class="sapUshellSearchResultListItem-GenericAttribute sapUshellSearchResultListItem-MainAttribute">');g=new sap.m.Label();g.setText(l);g.addStyleClass("sapUshellSearchResultListItem-AttributeKey");g.addStyleClass("sapUshellSearchResultListItem-MightOverflow");r.renderControl(g);h=new S();h.setText(v);h.addStyleClass("sapUshellSearchResultListItem-AttributeValue");h.addStyleClass("sapUshellSearchResultListItem-MightOverflow");if(f){k=new sap.ui.core.InvisibleText({});k.setText(f);h.data("tooltippedBy",k.getId(),true);h.onAfterRendering=function(){S.prototype.onAfterRendering.apply(this,arguments);var p=$(this.getDomRef());p.attr("aria-describedby",p.attr("data-tooltippedby"));};t.addAggregation("_attributeValuesWithoutWhyfoundHiddenTexts",k,true);r.renderControl(k);}r.renderControl(h);r.write('</li>');t.addAggregation("_attributeLabels",g,true);t.addAggregation("_attributeValues",h,true);j++;}var o=false;for(;i<d.length;i++){e=d[i];if(!e.whyfound){continue;}l=e.name;v=e.value;f=e.valueWithoutWhyfound;if(l===undefined||v===undefined){continue;}if(!v||v===""){v=n;}r.write('<li class="sapUshellSearchResultListItem-GenericAttribute sapUshellSearchResultListItem-WhyFoundAttribute">');g=new sap.m.Label();g.setText(l);g.addStyleClass("sapUshellSearchResultListItem-AttributeKey");g.addStyleClass("sapUshellSearchResultListItem-MightOverflow");r.renderControl(g);h=new S();h.setText(v);h.addStyleClass("sapUshellSearchResultListItem-AttributeValue");h.addStyleClass("sapUshellSearchResultListItem-MightOverflow");if(f){k=new sap.ui.core.InvisibleText({});k.setText(f);h.data("tooltippedBy",k.getId(),true);h.onAfterRendering=function(){S.prototype.onAfterRendering.apply(this,arguments);var p=$(this.getDomRef());p.attr("aria-describedby",p.attr("data-tooltippedby"));};t.addAggregation("_attributeValuesWithoutWhyfoundHiddenTexts",k,true);r.renderControl(k);}r.renderControl(h);r.write('</li>');t.addAggregation("_attributeLabels",g,true);t.addAggregation("_attributeValues",h,true);o=true;}if(o){r.write('<div class="sapUshellSearchResultListItem-GenericAttribute sapUshellSearchResultListItem-WhyFoundSpacerAttribute" aria-hidden="true"></div>');}},_renderImageAttribute:function(r){var t=this;if(!t.getImageUrl()){return;}r.write('<div class="sapUshellSearchResultListItem-GenericAttribute sapUshellSearchResultListItem-ImageAttribute');if(!t.getImageUrl()){r.write(' sapUshellSearchResultListItem-ImageAttributeHidden');}r.write('">');r.write('<div class="sapUshellSearchResultListItem-ImageContainer">');if(t.getImageUrl()){r.write('<img class="sapUshellSearchResultListItem-Image" src="');r.write(t.getImageUrl());r.write('">');}r.write('<div class="sapUshellSearchResultListItem-ImageContainerAlignmentHelper"></div>');r.write('</div>');r.write('</div>');},_renderRelatedObjectsToolbar:function(r){var t=this;var d=t.getNavigationObjects();if(!d||d.length===0){return;}t._showExpandButton=true;var e=t.getAggregation("_relatedObjectActionsToolbar");e.setProperty("navigationObjects",d);r.renderControl(e);},_renderAccessibilityInformation:function(r){var t=this;var p=t.getProperty("parentListItem");if(p){var l=t.getTitle()+", "+t.getType();var d=t.getAggregation("_titleLabeledByText");d.setText(l);r.renderControl(d);p.onAfterRendering=function(){sap.m.CustomListItem.prototype.onAfterRendering.apply(this,arguments);var e=$(this.getDomRef());e.attr("aria-labelledby",d.getId());};p.addEventDelegate({onsapspace:function(e){if(e.target===e.currentTarget){t.toggleDetails();}},onsapenter:function(e){if(e.target===e.currentTarget){var f=t.getTitleNavigation();if(f){f.performNavigation();}}}});}},_getExpandAreaObjectInfo:function(){var t=this;var r=$(t.getDomRef());var d=r.find(".sapUshellSearchResultListItem-AttributesExpandContainer");var e=r.find(".sapUshellSearchResultListItem-RelatedObjectsToolbar");var f=false;if(e.css("display")==="none"){e.css("display","block");f=true;}var g=d.height();var h=r.find(".sapUshellSearchResultListItem-AttributesAndActions").height();if(f){e.css("display","");}var i=[];r.find(".sapUshellSearchResultListItem-GenericAttribute").each(function(){var m=$(this);if(m.css("order")>2){i.push(this);}});var j=200;var k=j/10;var l={resultListItem:r,attributesExpandContainer:d,currentHeight:g,expandedHeight:h,elementsToFadeInOrOut:i,expandAnimationDuration:j,fadeInOrOutAnimationDuration:k,relatedObjectsToolbar:e};return l;},isShowingDetails:function(){var e=this._getExpandAreaObjectInfo();if(e.currentHeight<e.expandedHeight){return false;}return true;},showDetails:function(d){var t=this;if(t.isShowingDetails()){return;}var e=this._getExpandAreaObjectInfo();e.relatedObjectsToolbar.css("display","block");var r=t.getAggregation("_relatedObjectActionsToolbar");if(r){r._layoutToolbarElements();}e.attributesExpandContainer.animate({"height":e.expandedHeight},e.expandAnimationDuration,function(){t.setProperty("expanded",true,true);$(this).addClass("sapUshellSearchResultListItem-AttributesExpanded");$(this).css("height","");$(e.elementsToFadeInOrOut).css("opacity","");var i=sap.ui.core.IconPool.getIconURI("slim-arrow-up");var f=t.getAggregation("_expandButton");f.setTooltip(sap.ushell.resources.i18n.getText("hideDetailBtn_tooltip"));f.setIcon(i);f.rerender();e.relatedObjectsToolbar.css("display","");});$(e.elementsToFadeInOrOut).animate({"opacity":1},e.fadeInOrOutAnimationDuration);},hideDetails:function(d){var t=this;var r=$(t.getDomRef());if(!t.isShowingDetails()){return;}var e=this._getExpandAreaObjectInfo();var f=r.find(".sapUshellSearchResultListItem-MainAttribute").outerHeight(true)+r.find(".sapUshellSearchResultListItem-ExpandSpacerAttribute").outerHeight(true);var s=false;var g=e.attributesExpandContainer.animate({"height":f},{"duration":e.expandAnimationDuration,"progress":function(h,p,i){if(!s&&i<=e.fadeInOrOutAnimationDuration){s=true;var j=$(e.elementsToFadeInOrOut).animate({"opacity":0},e.fadeInOrOutAnimationDuration).promise();jQuery.when(g,j).done(function(){t.setProperty("expanded",false,true);e.attributesExpandContainer.removeClass("sapUshellSearchResultListItem-AttributesExpanded");$(e.elementsToFadeInOrOut).css("opacity","");var k=sap.ui.core.IconPool.getIconURI("slim-arrow-down");var l=t.getAggregation("_expandButton");l.setTooltip(sap.ushell.resources.i18n.getText("showDetailBtn_tooltip"));l.setIcon(k);l.rerender();});}}}).promise();},toggleDetails:function(d){if(this.isShowingDetails()){this.hideDetails(d);}else{this.showDetails(d);}},isSelectionModeEnabled:function(){var t=this;var i=false;var s=$(t.getDomRef()).find(".sapUshellSearchResultListItem-multiSelect-selectionBoxContainer");if(s){i=s.css("opacity")>0;}return i;},enableSelectionMode:function(d){var t=this;var s=$(t.getDomRef()).find(".sapUshellSearchResultListItem-multiSelect-innerContainer");var e=s.find(".sapUshellSearchResultListItem-multiSelect-selectionBoxContainer");var f=200;var g=false;s.animate({width:"2rem"},{"duration":f,"progress":function(h,p,r){if(!g&&p>0.5){e.css("display","");e.animate({opacity:"1.0"},f/2);g=true;}}});},disableSelectionMode:function(d){var t=this;var s=$(t.getDomRef()).find(".sapUshellSearchResultListItem-multiSelect-innerContainer");var e=s.find(".sapUshellSearchResultListItem-multiSelect-selectionBoxContainer");var f=200;e.animate({opacity:"0.0"},f/2,function(){e.css("display","none");});s.animate({width:"0"},f);},toggleSelectionMode:function(d){if(this.isSelectionModeEnabled()){this.disableSelectionMode(d);}else{this.enableSelectionMode(d);}},onAfterRendering:function(){var t=this;var d=$(t.getDomRef());t.showOrHideExpandButton();d.bind('click',function(){t._performOrTrackTitleNavigation();});if(t.getModel().config.odataProvider||!t.getModel().config.isLaunchpad()){t.getAggregation("_titleLink").setEnabled(true);$(t.getAggregation("_titleLink").getDomRef()).bind('click',function(){var e="";var f=t.getTitleNavigation();if(f){e=f.getHref();}if(!e||e.length===0){var q=new sap.m.QuickViewGroup();var B=t.getBindingContext().sPath+"/itemattributes";q.bindAggregation("elements",B,function(i,C){var T=sap.m.QuickViewGroupElementType.text;var g=C.oModel.getProperty(C.sPath);var u;if(g.key.toLowerCase().indexOf("email")!==-1){T=sap.m.QuickViewGroupElementType.email;}else if(g.key.toLowerCase().indexOf("url")!==-1){T=sap.m.QuickViewGroupElementType.link;u="http://"+g.value;}else if(g.key.toLowerCase().indexOf("telefon")!==-1){T=sap.m.QuickViewGroupElementType.phone;}var h=new sap.m.QuickViewGroupElement({visible:!g.isTitle&&!g.hidden,label:"{name}",value:"{value}",type:T,url:u});return h;});var Q=new sap.m.QuickViewPage({header:t.getTitle(),icon:t.getImageUrl(),groups:[q]});var o=new sap.m.QuickView({placement:sap.m.PlacementType.Auto,width:$(window).width()/3+"px",pages:[Q]});o.setModel(t.getModel());o.openBy(t.getAggregation("_titleLink"));o.addStyleClass("sapUshellSearchQuickView");sap.ushell.renderers.fiori2.search.SearchHelper.boldTagUnescaper(o.getDomRef());}});}t.forwardEllipsis(d.find(".sapUshellSearchResultListItem-Title, .sapUshellSearchResultListItem-AttributeKey, .sapUshellSearchResultListItem-AttributeValue"));b.attachEventHandlersForTooltip(t.getDomRef());},_getPhoneSize:function(){return 767;},_resetPrecalculatedValues:function(){this._visibleAttributes=undefined;this._detailsArea=undefined;this._showExpandButton=false;},showOrHideExpandButton:function(){var t=this;var e=$(t.getDomRef());var d=e.find(".sapUshellSearchResultListItem-ExpandButtonContainer");var i=d.css("visibility")!="hidden";var s=false;var f=e.find(".sapUshellSearchResultListItem-RelatedObjectsToolbar");s=f.length>0;if(!s){e.find(".sapUshellSearchResultListItem-MainAttribute,.sapUshellSearchResultListItem-WhyFoundAttribute").each(function(){if($(this).css("order")>2){s=true;return false;}});}if(i&&!s){d.css("visibility","hidden");d.attr("aria-hidden","true");t.setAriaExpandedState();}else if(!i&&s){d.css("visibility","");d.removeAttr("aria-hidden");t.setAriaExpandedState();}},setAriaExpandedState:function(){var t=this;var e=t.getAggregation("_expandButton");var d=$(e.getDomRef());var f=$(t.getDomRef());var g=t.getParentListItem()?$(t.getParentListItem().getDomRef()):f.closest("li");var h=f.find(".sapUshellSearchResultListItem-ExpandButtonContainer");if(h.css("visibility")=="hidden"){d.removeAttr("aria-expanded");g.removeAttr("aria-expanded");}else{var i=t.getProperty("expanded");if(i){d.attr("aria-expanded","true");g.attr("aria-expanded","true");}else{d.attr("aria-expanded","false");g.attr("aria-expanded","false");}}},_performOrTrackTitleNavigation:function(d){var t=this.getTitleNavigation();if(t){var p=this._getPhoneSize();var w=$(window).width();if(w<=p){t.performNavigation();}else if(d){t.trackNavigation();}}},forwardEllipsis:function(o){o.each(function(i,d){b.forwardEllipsis4Whyfound(d);});}});});
