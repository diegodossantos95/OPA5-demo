;(function(){
/*
     * sap-ina-sina - SAP HANA Simple Info Access API/Enterprise Search API
     * version 3.3.1 - 2017-08-17 

     * Copyright (c) 2017 SAP SE; All rights reserved
     */
/*
     * @file Simple info access (SINA) API: Filter Interface
     * @namespace sap.bc.ina.api.sina.base.filter
     * @copyright 2014 SAP SE. All rights reserved.
     */
var f,g,q,p,t,u,w,x,y,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,a1,b1,c1,d1,e1,f1,g1,h1,i1,j1,k1,l1;f=function(){var e={};if(typeof window!=='undefined'){e.removeHtmlTags=function(h){var d=document.createElement('div');d.innerHTML=h;return d.textContent||d.innerText||'';};e.extend=jQuery.extend;e.Deferred=jQuery.Deferred;e.ajax=jQuery.ajax;e.when=jQuery.when;}else{e.removeHtmlTags=function(h){var s=s;return s(h);};e.extend=extend;e.Deferred=jquery_deferred.Deferred;e.when=jquery_deferred.when;}e.getUrlParameter=function(n){if(typeof window!=='undefined'){var s=window.location.href;var v=(new RegExp(n+'='+'(.+?)(&|$|#)','i').exec(s)||[null])[1];if(!v){return v;}v=decodeURIComponent(v.replace(/\+/g,' '));return v;}return'';};e.createGuid=function(){return'xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx'.replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=='x'?r:r&3|8;return v.toString(16).toUpperCase();});};e.pad=function pad(n,a){var s='000000000'+n;return s.substr(s.length-a);};return e;}();g=function(){var e={};e.provider={};e.registerProvider=function(a){this.provider[a.impl_type]=a;};e.QueryOptions={FUZZY:'Fuzzy',VALUEHELP:'ValueHelpMode'};e.SuggestionType={HISTORY:'history',DATASOURCE:'datasource',OBJECTDATA:'objectdata'};e.FacetType={ATTRIBUTE:'attribute',DATASOURCE:'datasource',SEARCH:'searchresult'};e.ChartQueryType={ATTRIBUTE:'attribute',DATASOURCE:'datasource'};e.Sina=function(){this.init.apply(this,arguments);};e.Sina.prototype={init:function(a){a=a||{};if(a.system){this.setSystem(a.system);}if(a._provider.eventLoggingService){this.eventLoggingService=new a._provider.eventLoggingService({sina:this});}},_initQueryProperties:function(a){a=a||{};a.sina=this;a.system=a.system||this.getSystem();if(a.dataSource){a.dataSource=this.createDataSource(a.dataSource);}return a;},createChartQuery:function(a){a=this._initQueryProperties(a);return new this._provider.chartQuery(a);},createSearchQuery:function(a){a=this._initQueryProperties(a);return new this._provider.searchQuery(a);},createGroupBarChartQuery:function(a){a=this._initQueryProperties(a);return new this._provider.groupBarChartQuery(a);},createLineChartQuery:function(a){a=this._initQueryProperties(a);a.dimensions=[a.dimensionLine,a.dimensionX];a.measures=[{name:a.measureY.name,aggregationFunction:a.measureY.aggregationFunction}];return new this._provider.lineChartQuery(a);},createSuggestionQuery:function(a){a=this._initQueryProperties(a);return new this._provider.suggestionQuery(a);},createPerspectiveQuery:function(a){a=this._initQueryProperties(a);return new this._provider.perspectiveQuery(a);},createPerspectiveSearchQuery:function(a){a=this._initQueryProperties(a);return new this._provider.perspectiveSearchQuery(a);},createPerspectiveGetQuery:function(a){a=this._initQueryProperties(a);return new this._provider.perspectiveGetQuery(a);},sinaSystem:function(s){if(s){this.sys=s;}else{return this.sys;}return{};},getSystem:function(){if(this.sys){return this.sys;}return{};},setSystem:function(B){this.sys=B;},createFacet:function(a){a.sina=this;return new this._provider.Facet(a);},ResultElementKeyStatus:{OK:'ok',NO_KEY:'no_key',NO_VALUE:'no_value'},createFilter:function(a){a=a||{};a.sina=this;return new this._provider.Filter(a);},createFilterCondition:function(a,o,v,b,c,l){a=a||{};var d;if(typeof a==='object'){d=a;d.sina=this;}else{d={attribute:a,operator:o,value:v,sina:this,attributeLabel:b,valueLabel:c,label:l};}if(d&&d.conditions){return new this._provider.FilterConditionGroup(d);}return new this._provider.FilterCondition(d);},createFilterConditionGroup:function(a){a=a||{};a.sina=this;return new this._provider.FilterConditionGroup(a);},createDataSource:function(a){var o={};if(a){o=a;}o.sina=o.sina||this;return new this._provider.DataSource(o);},createDataSourceQuery:function(a){a=this._initQueryProperties(a);return new this._provider.DataSourceQuery(a);},getRootDataSource:function(){properties=this._initQueryProperties(properties);return this._provider.getRootDataSource(properties);},getSearchConfiguration:function(a){a=this._initQueryProperties(a);return new this._provider.searchConfiguration(a);},addUserHistoryEntry:function(o){var a={sina:this,system:this.getSystem()};a.oEntry=o;return this._provider.addUserHistoryEntry(a);},emptyUserHistory:function(a){a=this._initQueryProperties(a);return this._provider.emptyUserHistory(a);},getDataSources:function(a){a=this._initQueryProperties(a);return this._provider.metaDataService.getDataSources(a);},getDataSourcesSync:function(a){a=this._initQueryProperties(a);return this._provider.metaDataService.getDataSourcesSync(a);},getDataSource:function(d){properties=this._initQueryProperties();return this._provider.metaDataService.getDataSource(properties,d);},getDataSourceByBusinessObjectName:function(b){properties=this._initQueryProperties();return this._provider.metaDataService.getDataSourceByBusinessObjectName(properties,b);},getDataSourceSync:function(d){properties=this._initQueryProperties();return this._provider.metaDataService.getDataSourceSync(properties,d);},getDataSourceSyncByBusinessObjectName:function(b){var a=this._initQueryProperties();return this._provider.metaDataService.getDataSourceSyncByBusinessObjectName(a,b);},getBusinessObjectsMetaData:function(){var a=this._initQueryProperties();return this._provider.metaDataService.getBusinessObjectsMetaData(a);},getBusinessObjectsMetaDataSync:function(){var a=this._initQueryProperties();return this._provider.metaDataService.getBusinessObjectsMetaDataSync(a);},getBusinessObjectMetaData:function(d){var a=this._initQueryProperties();return this._provider.metaDataService.getBusinessObjectMetaData(a,d);},getBusinessObjectMetaDataByBusinessObjectName:function(b){var a=this._initQueryProperties();return this._provider.metaDataService.getBusinessObjectMetaDataByBusinessObjectName(a,b);},getBusinessObjectMetaDataSync:function(d){var a=this._initQueryProperties();return this._provider.metaDataService.getBusinessObjectMetaDataSync(a,d);},getBusinessObjectMetaDataSyncByBusinessObjectName:function(b){var a=this._initQueryProperties();return this._provider.metaDataService.getBusinessObjectMetaDataSyncByBusinessObjectName(a,b);},setBusinessObjectMetaDataSync:function(x,d){var a=this._initQueryProperties();return this._provider.metaDataService.setBusinessObjectMetaDataSync(a,x,d);},logEvent:function(a){if(this.eventLoggingService){this.eventLoggingService.logEvent(a);}},logEvents:function(a){if(this.eventLoggingService){this.eventLoggingService.logEvents(a);}},createEventLoggingTimestamp:function(){if(this.eventLoggingService){return this.eventLoggingService.createEventLoggingTimestamp();}}};e.SinaError=function(){this.init.apply(this,arguments);};e.SinaError.SEVERITY_ERROR=3;e.SinaError.SEVERITY_WARNING=2;e.SinaError.SEVERITY_INFO=1;e.SinaError.prototype={init:function(a){this.message=a.message||'';this.errorCode=a.errorCode||null;this.severity=a.severity||e.SinaError.SEVERITY_ERROR;},getErrorCode:function(){return this.errorCode;},getMessage:function(){return this.message;},getSeverity:function(){return this.severity;},setSeverity:function(s){this.severity=s;},toString:function(){var m='';switch(this.severity){case e.SinaError.SEVERITY_ERROR:m+='SINA ERROR: ';break;case e.SinaError.SEVERITY_WARNING:m+='SINA WARNING: ';break;case e.SinaError.SEVERITY_INFO:m+='SINA INFO: ';break;}m+=this.message;return m;}};return e;}();q=function(){var e={};var a=function(){};e.Query=function(){this.init.apply(this,arguments);};e.Query.prototype={init:function(b){b=b||{};this.sina=b.sina;this.system=b.system;this.onSuccess=b.onSuccess;this.onError=b.onError;this.options=[];this._responseJson=null;this.setTop(b.top||10);this.setSkip(b.skip||0);this.resultSetProperties=b;this.filter=this.filter||b.filter||this.sina.createFilter({dataSource:b.dataSource});this.datasource=this.datasource||b.dataSource;if(b.filterConditions&&b.filterConditions.length>0){for(var i=0,l=b.filterConditions.length;i<l;i++){var c=b.filterConditions[i];if(c&&c instanceof Array&&c.length>0){this.addFilterCondition(c[0],c[1],c[2]);}else if(c&&typeof c==='string'){this.addFilterCondition(b.filterConditions[0],b.filterConditions[1],b.filterConditions[2]);break;}}}this.setSearchTerms(b.searchTerms||'');},addOption:function(o){if(this.options.indexOf(o)===-1){this._resetResultSet();this.options.push(o);}},removeOption:function(o){if(this.options.indexOf(o)!==-1){this.options.splice(this.options.indexOf(o),1);this._resetResultSet();}},dataSource:function(n){if(n){this.setDataSource(n);return this;}else{return this.getDataSource();}},getDataSource:function(){return this.filter.getDataSource();},setDataSource:function(d){if(d===undefined){return this;}if(this.filter.getDataSource()===undefined){this.filter.setDataSource(d);this._resetResultSet();return this;}if(!this.filter.getDataSource().equals(d)){this.filter.setDataSource(d);this._resetResultSet();}return this;},setFacetOptions:function(o){this._resetResultSet();this.facetOptions=o;},getFacetOptions:function(){return this.facetOptions;},getFilter:function(){return this.filter;},setFilter:function(b){if(!this.filter.equals(b)){this._resetResultSet();}this.filter=b;return this;},setSearchTerms:function(b){if(this.filter.getSearchTerms()!==b){this.filter.setSearchTerms(b);this._resetResultSet();}return this;},getSearchTerms:function(){return this.filter.getSearchTerms();},skip:function(n){if(n!==undefined){this.setSkip(n);}else{return this._skip;}return this;},getSkip:function(){return this._skip;},setSkip:function(s){if(this._skip!==s){this._resetResultSet();}this._skip=s;return this;},top:function(n){if(n!==undefined){this.setTop(n);}else{return this._top;}return this;},getTop:function(){return this._top;},setTop:function(b){if(isNaN(b)){return false;}this._top=parseInt(this._top,10);if(this._top!==b){this._top=b;this._resetResultSet();}return this;},addFilterCondition:function(b,o,v){if(typeof b==='string'){b=this.sina.createFilterCondition(b,o,v);}if(this.filter.hasFilterCondition(b,o,v)===false){this.filter.addFilterCondition(b,o,v);this._resetResultSet();}return this;},removeFilterCondition:function(b,o,v){this.filter.removeFilterCondition(b,o,v);this._resetResultSet();return this;},resetFilterConditions:function(){this.filter.resetFilterConditions();this._resetResultSet();return this;},getResultSetSync:function(){this.resultSet=this.executeSync();return this.resultSet;},getResultSet:function(o,b){var c=this;o=o||this.onSuccess||a;b=b||this.onError||a;var r=this.execute();r.done(function(d){c.resultSet=d;o(d);});r.fail(function(d){b(d);});return r.promise();},_resetResultSet:function(){},resetResultSet:function(){this._resetResultSet();},execute:function(){},executeSync:function(){}};return e;}();p=function(f,q){var e={};e.SearchQuery=function(){this.init.apply(this,arguments);};e.SearchQuery.prototype=f.extend({},q.Query.prototype,{init:function(){q.Query.prototype.init.apply(this,arguments);}});return e;}(f,q);t=function(f){var e={};e.getDataSourceMetaDataRequest=function(){return f.extend({},{'DataSource':{},'Options':['SynchronousRun'],'Metadata':{'Context':'Search','Expand':['Cube']},'ServiceVersion':204});};e.getCatalogRequest=function(){return f.extend({},{'DataSource':{'ObjectName':'$$DataSources$$','PackageName':'ABAP'},'Options':['SynchronousRun'],'Search':{'Top':1000,'Skip':0,'OrderBy':[{'AttributeName':'Description','SortOrder':'ASC'},{'AttributeName':'ObjectName','SortOrder':'ASC'}],'Expand':['Grid','Items'],'Filter':{'Selection':{'Operator':{'Code':'And','SubSelections':[{'MemberOperand':{'AttributeName':'SupportedService','Comparison':'=','Value':'Search'}}]}}},'NamedValues':[{'AttributeName':'ObjectName','Name':'ObjectName'},{'AttributeName':'Description','Name':'Description'},{'AttributeName':'Type','Name':'Type'}]},'SearchTerms':'*','ServiceVersion':204});};e.getESHConnectorRequest=function(){return f.extend({},{'DataSource':{'SchemaName':'','PackageName':'ABAP','ObjectName':'~ESH_CONNECTOR~','Type':'Connector'},'Search':{'Top':1000,'Skip':0,'OrderBy':[{'AttributeName':'DESCRIPTION','SortOrder':'ASC'}],'Expand':['Grid','Items','TotalCount'],'Filter':{},'NamedValues':[{'AttributeName':'$$ResultItemAttributes$$','Name':'$$ResultItemAttributes$$'},{'AttributeName':'$$RelatedActions$$','Name':'$$RelatedActions$$'}],'SearchTerms':'*','SelectedValues':[]}});};e.getSuggestionRequest=function(){return f.extend({},{'DataSource':{},'Options':['SynchronousRun'],'Suggestions':{'Expand':['Grid','Items'],'Precalculated':false,'SearchTerms':'','AttributeNames':[]},'ServiceVersion':204});};e.getSuggestion2Request=function(){return f.extend({},{'DataSource':{},'Options':['SynchronousRun'],'Suggestions2':{'Expand':['Grid','Items'],'Precalculated':false,'AttributeNames':[]},'ServiceVersion':204});};e.getPerspectiveRequest=function(){return f.extend({},{'DataSource':{},'Options':['SynchronousRun'],'Search':{'Expand':['Grid','Items','ResultsetFacets','TotalCount'],'Filter':{'Selection':{'Operator':{'Code':'And','SubSelections':[{'MemberOperand':{'AttributeName':'$$RenderingTemplatePlatform$$','Comparison':'=','Value':'html'}},{'MemberOperand':{'AttributeName':'$$RenderingTemplateTechnology$$','Comparison':'=','Value':'Tempo'}},{'MemberOperand':{'AttributeName':'$$RenderingTemplateType$$','Comparison':'=','Value':'ResultItem'}}]}}},'Top':10,'Skip':0,'SearchTerms':'S*','NamedValues':[{'Function':'WhyFound','Name':'$$WhyFound$$'},{'Function':'RelatedActions','Name':'$$RelatedActions$$'}]},'ServiceVersion':204});};e.getPerspectiveSearchRequest=function(){return f.extend({},{'DataSource':{'ObjectName':'$$Perspectives$$','Type':'View'},'Options':['SynchronousRun'],'Search':{'Expand':['Grid','Items'],'Filter':{'Selection':{'Operator':{'Code':'Or','SubSelections':[{'MemberOperand':{'AttributeName':'SCHEMA_VERSION_NUMBER','Comparison':'=','Value':'3'}},{'MemberOperand':{'AttributeName':'SCHEMA_VERSION_NUMBER','Comparison':'=','Value':'4'}},{'MemberOperand':{'AttributeName':'SCHEMA_VERSION_NUMBER','Comparison':'=','Value':'5'}}]}}},'SearchTerms':'*','SelectedValues':[{'AttributeName':'PACKAGE_ID','Name':'PACKAGE_ID'},{'AttributeName':'PERSPECTIVE_ID','Name':'PERSPECTIVE_ID'},{'AttributeName':'TITLE_TEXT','Name':'TITLE_TEXT'},{'AttributeName':'SUMMARY_TEXT','Name':'SUMMARY_TEXT'}],'Skip':0,'Top':30}});};e.getPerspectiveRequestFactsheet=function(){return f.extend({},{'DataSource':{},'Options':['SynchronousRun'],'Search':{'Expand':['Grid','Items','ResultsetFacets','TotalCount'],'Filter':{'Selection':{'Operator':{'Code':'And','SubSelections':[{'MemberOperand':{'AttributeName':'$$RenderingTemplatePlatform$$','Comparison':'=','Value':'html'}},{'MemberOperand':{'AttributeName':'$$RenderingTemplateTechnology$$','Comparison':'=','Value':'Tempo'}},{'MemberOperand':{'AttributeName':'$$RenderingTemplateType$$','Comparison':'=','Value':'ResultItem'}}]}}},'Top':10,'Skip':0,'SearchTerms':'S*','NamedValues':[{'Function':'WhyFound','Name':'$$WhyFound$$'},{'AttributeName':'$$RelatedActions$$'},{'AttributeName':'$$RelatedActions.Proxy$$'}]},'ServiceVersion':204});};e.getSearchRequest=function(){return f.extend({},{'DataSource':{},'SearchTerms':'DUMMY','Search':{'Expand':['Grid','Items','TotalCount'],'Top':'DUMMY','Skip':'DUMMY','SelectedValues':'DUMMY','NamedValues':[{'AttributeName':'$$ResultItemAttributes$$','Name':'$$ResultItemAttributes$$'},{'AttributeName':'$$RelatedActions$$','Name':'$$RelatedActions$$'}]}});};e.getABAPChartRequest=function(){return f.extend({},{'DataSource':{},'Options':['SynchronousRun'],'Search':{'Expand':['Grid','ResultsetFacets','TotalCount'],'Filter':{},'Top':10,'Skip':0,'SearchTerms':'*','NamedValues':[{'Function':'WhyFound','Name':'$$WhyFound$$'},{'AttributeName':'$$RelatedActions$$'},{'AttributeName':'$$RelatedActions.Proxy$$'}],'OrderBy':[]},'ServiceVersion':204,'Facets':{'MaxNumberOfReturnValues':1000,'Attributes':[]}});};e.getChartRequest=function(){return f.extend({},{'DataSource':{},'Options':['SynchronousRun'],'SearchTerms':'','Analytics':{'Definition':{'Dimensions':[{'Axis':'Rows','Name':'CATEGORY','SortOrder':1,'Top':5},{'Axis':'Columns','Name':'CustomDimension1','Members':[{'Aggregation':'COUNT','AggregationDimension':'CATEGORY','MemberOperand':{'AttributeName':'Measures','Comparison':'=','Value':'COUNT'},'Name':'COUNT','SortOrder':2}]}],'Filter':{}}}});};e.getSearchConfigurationRequest=function(){return f.extend({},{'SearchConfiguration':{'Action':'Update','Data':{'PersonalizedSearch':{'PersonalizationPolicy':'','SessionUserActive':true,'ResetUserData':true},'NavigationEvent':{'SourceApplication':'','TargetApplication':'','Parameter':[]}}}});};return e;}(f);u=function(){var e={};e.Filter=function(){this.init.apply(this,arguments);};e.Condition=function(){this.init.apply(this,arguments);};e.ConditionGroup=function(){this.init.apply(this,arguments);};e.Filter.prototype={init:function(a){a=a||{};this.sina=a.sina;this.setDataSource(a.dataSource);this.conditionGroupsByAttribute={};this.defaultConditionGroup=this.sina.createFilterConditionGroup({label:'DefaultRoot',operator:'And'});this.searchTerms=a.searchTerms||'';},_findAttributeOfCondition:function(c){if(c instanceof e.Condition){return{attribute:c.attribute,attributeLabel:c.attributeLabel};}return this._findAttributeOfCondition(c.conditions[0]);},_findAttributeLabelOfGroup:function(a){if(!a||!a.conditions){return'';}for(var i=0;i<a.conditions.length;i++){var b=a.conditions[i];if(b instanceof e.Condition){return b.attributeLabel;}else if(b instanceof e.ConditionGroup){return this._findAttributeLabelOfGroup(b);}}},addFilterCondition:function(a,o,v,b,c){var d;var l;if(typeof a==='object'){if(a instanceof e.Condition){d=a;l=d.attribute;}else if(a instanceof e.ConditionGroup){d=a;l=this._findAttributeOfCondition(d).attribute;}else{var h=a;if(h.conditions){d=this.sina.createFilterConditionGroup(h);l=this._findAttributeOfGroup(d);}else{d=this.sina.createFilterCondition(h.attribute,h.operator,h.value,h.attributeLabel,h.valueLabel);l=h.attribute;}}}else{if(a===undefined||o===undefined||v===undefined){return this;}d=this.sina.createFilterCondition(a,o,v,b,c);l=d.attribute;}if(this.defaultConditionGroup.hasCondition(d)){return this;}if(this.conditionGroupsByAttribute[l]===undefined){this.conditionGroupsByAttribute[l]=this.sina.createFilterConditionGroup({operator:'OR',label:this._findAttributeOfCondition(d).attributeLabel||''});this.defaultConditionGroup.addCondition(this.conditionGroupsByAttribute[l]);}this.conditionGroupsByAttribute[l].addCondition(d);return this;},setDefaultConditionGroup:function(d){this.defaultConditionGroup=d;this._initConditionGroupsByAttribute();},_initConditionGroupsByAttribute:function(){this.conditionGroupsByAttribute={};var c=this.defaultConditionGroup.getConditions();for(var i=0;i<c.length;++i){var a=c[i];var b=this._findAttributeOfCondition(a).attribute;this.conditionGroupsByAttribute[b]=a;}},empty:function(){this.resetFilterConditions();this.searchTerms='';return this;},hasFilterCondition:function(a,o,v){if(typeof a==='string'){a=this.sina.createFilterCondition(a,o,v);}return this.defaultConditionGroup.hasCondition(a);},resetFilterConditions:function(){this.conditionGroupsByAttribute={};this.defaultConditionGroup=this.sina.createFilterConditionGroup({label:'DefaultRoot',operator:'And',sina:this.sina});return this;},removeFilterCondition:function(a,o,v,b,c){var d;var l;if(typeof a==='object'){if(a instanceof e.Condition){d=a;l=d.attribute;}else if(a instanceof e.ConditionGroup){d=a;l=this._findAttributeOfCondition(d).attribute;}else{var h=a;d=this.sina.createFilterCondition(h.attribute,h.operator,h.value,h.attributeLabel,h.valueLabel);l=h.attribute;}}else{if(a===undefined||o===undefined||v===undefined){return this;}d=this.sina.createFilterCondition(a,o,v,b,c);l=d.attribute;}this.defaultConditionGroup.removeCondition(d);var i=this.conditionGroupsByAttribute[l];if(i){i.removeCondition(d);if(i.conditions.length===0){delete this.conditionGroupsByAttribute[l];this.defaultConditionGroup.removeCondition(i);}}return this;},addFilterConditionGroup:function(c){this.addFilterCondition(c);},getFilterConditions:function(){return this.defaultConditionGroup;},getSearchTerms:function(){return this.searchTerms;},removeFilterConditionGroup:function(c){this.defaultConditionGroup.removeCondition(c);var a=c.conditions[0].attribute;if(this.conditionGroupsByAttribute[a]){this.conditionGroupsByAttribute[a].removeCondition(c);if(this.conditionGroupsByAttribute[a].conditions.length===0){delete this.conditionGroupsByAttribute[a];}}},setSearchTerms:function(s){this.searchTerms=s||'';},getDataSource:function(){return this.dataSource;},setDataSource:function(d){if(this.dataSource&&!this.dataSource.equals(d)){this.resetFilterConditions();}this.dataSource=d;},getJson:function(){return{dataSource:this.dataSource.getJson(),defaultConditionGroup:this.defaultConditionGroup.getJson(),searchTerms:this.searchTerms};},setJson:function(j){var d;this.empty();if(j.dataSource){var a=this.sina.createDataSource();a.setJson(j.dataSource);this.setDataSource(a);}this.setSearchTerms(j.searchTerms);if(typeof j.defaultConditionGroup==='object'){d=this.sina.createFilterConditionGroup(j.defaultConditionGroup);}if(d){this.setDefaultConditionGroup(d);}},clone:function(){var n=this.sina.createFilter();n.dataSource=this.dataSource;n.searchTerms=this.searchTerms;n.conditionGroupsByAttribute={};if(this.defaultConditionGroup&&this.defaultConditionGroup.clone){n.defaultConditionGroup=this.defaultConditionGroup.clone();for(var i=0;i<n.defaultConditionGroup.conditions.length;i++){var s=n.defaultConditionGroup.conditions[i];var a=this._getAttributeName(s);n.conditionGroupsByAttribute[a]=s;}}return n;},_getAttributeName:function(c){if(c.attribute){return c.attribute;}else{var s=c.conditions[0];return this._getAttributeName(s);}},equals:function(o){if(!(o instanceof e.Filter)){return false;}if(this.dataSource&&o.dataSource){if(!this.dataSource.equals(o.dataSource)){return false;}}else if(!this.dataSource&&o.dataSource){return false;}else if(this.dataSource&&!o.dataSource){return false;}if(this.searchTerms!==o.searchTerms){return false;}if(!this.defaultConditionGroup.equals(o.defaultConditionGroup)){return false;}return true;}};e.Condition.prototype={init:function(a,o,v,l1,b,c,l){if(typeof a==='object'){var d=a;a=d.attribute;o=d.operator;v=d.value;l1=d.sina;b=d.attributeLabel;c=d.valueLabel;l=d.label;}this.attribute=a||'';this.operator=o||'=';this.value=v;this.sina=l1;this.attributeLabel=b||'';this.valueLabel=c||'';this.label=l||'';},equals:function(o){if(!(o instanceof e.Condition)){return false;}return this.attribute===o.attribute&&this.operator===o.operator&&this.value===o.value;},toString:function(){return this.attributeLabel+this.operator+this.valueLabel+'';},getJson:function(){return{attribute:this.attribute,value:this.value,operator:this.operator,attributeLabel:this.attributeLabel,valueLabel:this.valueLabel,label:this.label};},setJson:function(j){if(!j.attribute||!j.value||!j.operator){throw'Following filter condition JSON does not have all necessary properties(attribute, value, operator): '+JSON.stringify(j);}this.attribute=j.attribute;this.value=j.value;this.operator=j.operator;this.attributeLabel=j.attributeLabel;this.valueLabel=j.valueLabel;this.label=j.label;},clone:function(){var n=this.sina.createFilterCondition();n.operator=this.operator;n.attribute=this.attribute;n.value=this.value;n.attributeLabel=this.attributeLabel;n.valueLabel=this.valueLabel;n.label=this.label;return n;}};e.ConditionGroup.prototype={init:function(a){a=a||{};this.label=a.label||'';this.setOperator(a.operator||'And');this.sina=a.sina;this.conditions=a.conditions||[];for(var i=0;i<this.conditions.length;i++){var b=this.conditions[i];if(typeof b==='object'){if(b.conditions){this.conditions[i]=this.sina.createFilterConditionGroup(b);}else{this.conditions[i]=this.sina.createFilterCondition(b);}}}},addCondition:function(c){if(c instanceof e.ConditionGroup||c instanceof e.Condition){this.conditions.push(c);return this;}throw'Condition of type '+typeof c+' can not be added to a filterConditionGroup';},equals:function(o){if(!(o instanceof e.ConditionGroup)){return false;}if(this.conditions.length!==o.conditions.length){return false;}for(var i=0,l=this.conditions.length;i<l;i++){var c=this.conditions[i];var a=false;for(var j=0,b=o.conditions.length;j<b;j++){var d=o.conditions[j];if(c.equals(d)){a=true;break;}}if(!a){return false;}}if(this.label!==o.label){return false;}return true;},getConditions:function(){return this.conditions;},getConditionsAsArray:function(a,c){c=c||[];a=a||this;for(var i=0;i<a.conditions.length;i++){if(a.conditions[i]instanceof e.ConditionGroup){this.getConditionsAsArray(a.conditions[i],c);}else{c.push(a.conditions[i]);}}return c;},hasCondition:function(c){for(var i=0,l=this.conditions.length;i<l;i++){var a=this.conditions[i];if(a instanceof e.ConditionGroup){if(c instanceof e.ConditionGroup){if(a.equals(c)){return true;}}else if(c instanceof e.Condition){if(a.hasCondition(c)){return true;}}}else if(a instanceof e.Condition){if(c instanceof e.ConditionGroup){if(c.hasCondition(a)){return true;}}else if(c instanceof e.Condition){if(a.equals(c)){return true;}}}}return false;},removeCondition:function(c){var a;for(var i=0,l=this.conditions.length;i<l;i++){a=this.conditions[i];if(a instanceof e.ConditionGroup){if(c instanceof e.ConditionGroup){if(a.equals(c)){this.conditions.splice(i,1);}}else if(c instanceof e.Condition){a.removeCondition(c);}}else if(a instanceof e.Condition){if(c instanceof e.ConditionGroup){c.removeCondition(a);}else if(c instanceof e.Condition){if(a.equals(c)){this.conditions.splice(i,1);}}}}for(var j=0,b=this.conditions.length;j<b;j++){a=this.conditions[j];if(a instanceof e.ConditionGroup&&a.conditions.length===0){this.conditions.splice(j,1);}}return this;},setLabel:function(l){this.label=l;return this;},setOperator:function(o){switch(o.toLowerCase()){case'or':o='Or';break;case'and':o='And';break;default:throw{message:'unknown operator for condition group: '+o};}this.operator=o;return this;},toString:function(){return this.label;},getJson:function(){var a=this;var b=function(){var c=[];for(var i=0;i<a.conditions.length;i++){c.push(a.conditions[i].getJson());}return c;};return{operator:this.operator,label:this.label,conditions:b()};},setJson:function(j){this.operator=j.operator;this.label=j.label||'';var a=j.conditions;for(var i=0;i<a.length;i++){var b=a[i];var c=null;if(b.attribute){c=this.sina.createFilterCondition();}else if(Object.prototype.toString.call(b.conditions)==='[object Array]'&&b.conditions.length>0){c=this.sina.createFilterConditionGroup();}else{throw'Following filter condition group JSON has neither attribute nor sub conditions:'+JSON.stringify(b);}c.setJson(b);this.conditions.push(c);}},clone:function(){var n=this.sina.createFilterConditionGroup();n.operator=this.operator;n.label=this.label;n.sina=this.sina;n.conditions=[];for(var i=0;i<this.conditions.length;i++){var c=this.conditions[i];n.conditions.push(c.clone());}return n;}};return e;}();w=function(u,f){var e={};e.Filter=function(){this.init.apply(this,arguments);};e.Condition=function(){this.init.apply(this,arguments);};e.ConditionGroup=function(){this.init.apply(this,arguments);};e.Filter.prototype=f.extend(Object.create(u.Filter.prototype),{init:function(a){u.Filter.prototype.init.apply(this,[a]);},getDataForRequest:function(){var r=[];this.defaultConditionGroup.getDataForRequest(r);r[0].Selection.Operator=r[0].Selection.Operator||{'Code':'And'};r[0].Selection.Operator.SubSelections=r[0].Selection.Operator.SubSelections||[];r[0].Selection.Operator.SubSelections.push({'MemberOperand':{'AttributeName':'$$RenderingTemplatePlatform$$','Comparison':'=','Value':'html'}});r[0].Selection.Operator.SubSelections.push({'MemberOperand':{'AttributeName':'$$RenderingTemplateTechnology$$','Comparison':'=','Value':'Tempo'}});r[0].Selection.Operator.SubSelections.push({'MemberOperand':{'AttributeName':'$$RenderingTemplateType$$','Comparison':'=','Value':'ResultItem'}});r[0].Selection.Operator.SubSelections.push({'MemberOperand':{'AttributeName':'$$RenderingTemplateType$$','Comparison':'=','Value':'ItemDetails'}});return r[0];},setJsonFromResponse:function(j){if(j.Selection===undefined){return;}var a=this.sina.createFilterConditionGroup();a.setJsonFromResponse(j);this.defaultConditionGroup.addCondition(a);}});e.Condition.prototype=f.extend(Object.create(u.Condition.prototype),{init:function(a,o,v,l1){u.Condition.prototype.init.apply(this,arguments);},getDataForRequest:function(a){var o;var j={};if(this.operator.toLowerCase()==='contains'){o='SearchOperand';}else{o='MemberOperand';}j[o]={'AttributeName':this.attribute,'Comparison':this.operator,'Value':this.value};if(o==='SearchOperand'){delete j[o].Comparison;}j[o]=f.extend({},j[o],this.inaV2_extended_properties);if(this.operator==='='&&this.value===null){j.MemberOperand.Comparison='IS NULL';j.MemberOperand.Value='';}a.push(j);},setJsonFromResponse:function(j){this.attribute=j.MemberOperand.AttributeName;this.operator=j.MemberOperand.Comparison;this.value=j.MemberOperand.Value;if(j.MemberOperand.Comparison==='IS NULL'&&j.MemberOperand.Value===''){this.operator='=';this.value=null;}}});e.ConditionGroup.prototype=f.extend(Object.create(u.ConditionGroup.prototype),{init:function(a){u.ConditionGroup.prototype.init.apply(this,[a]);},getDataForRequest:function(a){var r={Selection:{}};var c=[];if(this.conditions.length>0){for(var i=0;i<this.conditions.length;++i){this.conditions[i].getDataForRequest(c);}r.Selection={'Operator':{'Code':this.operator,'SubSelections':c}};}if(a){a.push(r);}else{return r;}},setJsonFromResponse:function(j){if(j.Selection===undefined&&j.Operator){j.Selection={};j.Selection.Operator=j.Operator;}this.setOperator(j.Selection.Operator.Code);var c=j.Selection.Operator.SubSelections;for(var i=0;i<c.length;i++){var a;if(c[i].Operator){a=this.sina.createFilterConditionGroup();}else{a=this.sina.createFilterCondition();}a.setJsonFromResponse(c[i]);this.addCondition(a);}}});return e;}(u,f);x=function(){var e={};e.DataSource=function(){this.init.apply(this,arguments);};e.DataSourceMetaData=function(){this.init.apply(this,arguments);};e.DataSourceMetaData.prototype={init:function(){}};e.DataSourceType={CATEGORY:'Category',BUSINESSOBJECT:'BusinessObject'};e.DataSourceType.DEFAULT=e.DataSourceType.CATEGORY;e.convertToSInAType=function(a){if(a.toLowerCase()===e.DataSourceType.BUSINESSOBJECT.toLowerCase()||a.toLowerCase()==='view'){return e.DataSourceType.BUSINESSOBJECT;}else{return e.DataSourceType.CATEGORY;}};e.convertToServerType=function(a){if(a.toLowerCase()===e.DataSourceType.BUSINESSOBJECT.toLowerCase()||a.toLowerCase()==='view'){return'View';}else{return e.DataSourceType.CATEGORY;}};e.DataSource.prototype={init:function(a){a=a||{};this.type=a.type||e.DataSourceType.DEFAULT;this.name=a.name||'';this.label=a.label||a.name;this.labelPlural=a.labelPlural||a.label;this.key='';this._constructKey();},equals:function(o){if(this.key!==o.key){return false;}return true;},clone:function(){},getMetaData:function(){if(this.equals(this.sina.getRootDataSource())){return null;}return this.sina.getBusinessObjectMetaData(this);},getMetaDataSync:function(){if(this.equals(this.sina.getRootDataSource())){return null;}return this.sina.getBusinessObjectMetaDataSync(this);},getType:function(){return this.type;},setType:function(a){this.type=a;},getLabel:function(){return this.label;},getLabelPlural:function(){return this.labelPlural;},getIdentifier:function(){},_constructKey:function(){this.key=this.type+'/'+this.name;},getJson:function(){return{'type':this.type,'name':this.name,'label':this.label,'labelPlural':this.labelPlural};},setJson:function(j){this.type=j.type||'';this.name=j.name||'';this.label=j.label||'';this.labelPlural=j.labelPlural||'';this._constructKey();}};return e;}();y=function(q,g,f){var e={};e.SuggestionQuery=function(){this.init.apply(this,arguments);};e.SuggestionQuery.prototype=f.extend({},q.Query.prototype,{init:function(){q.Query.prototype.init.apply(this,arguments);this.suggestionTypes=[g.SuggestionType.OBJECTDATA,g.SuggestionType.HISTORY,g.SuggestionType.DATASOURCE];},resetResultSet:function(){this._resetResultSet();return this;},setSuggestionTypes:function(s){this.suggestionTypes=s;this._resetResultSet();}});return e;}(q,g,f);A=function(f){var e={};e.Proxy=function(){this.init.apply(this,arguments);};e.inaReqResBuffer={};e.Proxy.prototype={init:function(a){this.properties=a||{};this.system=this.properties.system;this.xsrfToken='';this.xsrfService=this.properties.xsrfService;this.xsrfRetries=0;this.xsrfRequest={'headers':{'X-CSRF-Token':'Fetch'},'cache':false,'url':this.xsrfService};this.properties.httpMethod=this.properties.httpMethod||'post';this.properties.recordFile=this.properties.recordFile;this.properties.demoMode=this.properties.demoMode||'';if(typeof window!=='undefined'){this._checkRecordingURLValues();}},setSystem:function(B){this.system=B;},_checkRecordingURLValues:function(){function a(n){return decodeURI((new RegExp(n+'='+'(.+?)(&|$)').exec(window.location.search)||[null])[1]);}function h(n){if(window.location.search.toLowerCase().indexOf('&'+n.toLowerCase())!==-1){return true;}if(window.location.search.toLowerCase().indexOf('?'+n.toLowerCase())!==-1){return true;}return false;}if(h('record')){this.properties.recordFile=a('record');}if(h('demoMode')){this.properties.demoMode=a('demoMode');}},_requestHashValue:function(a,d){if(d){var b=a.indexOf('?')===-1?'?':'&';a=a+b+'Request=';if(typeof d==='string'){a+=d;}else{a+=JSON.stringify(d);}}return a;},_handleRequestFromRecords:function(r,a){var b=this;function c(h,j,k){if(typeof h==='string'){h=JSON.parse(h);}var l=h[b._requestHashValue(j,k)];if(l){return l;}else{var m=new Error('Could not find request hash '+b._requestHashValue(j,k)+' in record file '+a);if(r.async){return new f.Deferred().reject(m);}else{throw m;}}}if(r.async===false){if(!this.recordings){this.recordings=this._loadRecordings(a).responseText;this.recordings=JSON.parse(this.recordings);}var d={};if(Object.prototype.toString.call(this.recordings)==='[object Array]'){for(var i=0;i<this.recordings.length;i++){d[b._requestHashValue(this.recordings[i].requestUrl,this.recordings[i].requestData)]=this.recordings[i].responseData;}this.recordings=d;}return{responseText:JSON.stringify(c(this.recordings,r.url,r.data))};}return this._loadRecordingsAsync(r.async,a).then(function(h){return c(h,r.url,r.data);});},_loadRecordings:function(r){return this._ajax({async:false,dataType:'json',url:r});},_loadRecordingsAsync:function(a,r){var b=this;if(this.recordingsDefer){return this.recordingsDefer;}this.recordingsDefer=f.Deferred();var j=this._ajax({dataType:'json',url:r});j.done(function(c){var d={};if(Object.prototype.toString.call(c)==='[object Array]'){for(var i=0;i<c.length;i++){d[b._requestHashValue(c[i].requestUrl,c[i].requestData)]=c[i].responseData;}c=d;}b.recordingsDefer.resolve(c);});j.fail(function(c){b.recordingsDefer.resolve({});});return this.recordingsDefer;},_saveRecordingsAsync:function(r){var a=this;return this._ajax({type:'PUT',url:a.properties.recordFile,data:JSON.stringify(r)});},setXSRFService:function(a){this.xsrfService=a;this.xsrfRequest.url=a;},_getXSRFToken:function(){var a=this;if(!this.xsrfDeferred){this.xsrfRetries++;this.xsrfDeferred=this._ajax(this.xsrfRequest);this.xsrfDeferred.done(function(d){a.xsrfToken=a.xsrfDeferred.getResponseHeader('X-CSRF-Token')||a.xsrfToken||'';if(a.xsrfToken){a.xsrfRetries=0;}});}return this.xsrfDeferred.promise();},_requestWithXSRFToken:function(r){var a=this;if(r.async===false){if(this.xsrfDeferred&&this.xsrfDeferred.state()==='pending'){this.xsrfDeferred.abort();}this.xsrfRequest.async=false;this.xsrfDeferred=this._ajax(this.xsrfRequest);if(r.url===this.xsrfService){return this.xsrfDeferred;}this.xsrfToken=this.xsrfDeferred.getResponseHeader('X-CSRF-Token')||this.xsrfToken||'';r.headers={'X-CSRF-Token':this.xsrfToken};return this._ajax(r);}else{if(r.url===this.xsrfService){return this._getXSRFToken();}var d=f.Deferred();this._getXSRFToken().done(function(b){r.headers={'X-CSRF-Token':a.xsrfToken};a._ajax(r).done(function(b){d.resolve(b);}).fail(function(c,h,i){if(c.status===400){if(c.responseJSON&&c.responseJSON.Error&&c.responseJSON.Error.Code&&c.responseJSON.Error.Code===403){if(a.xsrfRetries<5){a.xsrfDeferred=null;a._requestWithXSRFToken(r).done(function(b){d.resolve(b);}).fail(function(c){d.reject(c);});}}else{d.reject(c);}}else{if(c.status>=200&&c.status<=299&&(h||i)){c.status=500;c.statusText=h;var s=h+': ';if(i&&i.stack){s=s+i.stack;}c.responseText=s;}d.reject(c);}});}).fail(function(b){d.reject(b);});return d.promise();}},_ajax:function(a){var d={async:true,dataType:'json',url:'',type:'GET',data:''};a=f.extend({},d,a);a.type=a.type.toUpperCase();if(this.system.user&&this.system.password&&this.system.host&&this.system.port){a.url=this.system.protocol+'://'+this.system.user+':'+this.system.password+'@'+this.system.host+':'+this.system.port+a.url;}if(typeof window==='undefined'){var b=this;var c=f.Deferred();c.getResponseHeader=function(n){n=n.toLowerCase();return b.responseHeaders[n];};var h=bluebird;var i=h.promisify(i);var j=f.extend({},{strictSSL:false,jar:true},this.system.requestOptions);i=i.defaults(j);h.promisifyAll(i);if(a.async===false){throw new Error('synchronous ajax calls are not supported by server side sina');}a.method=a.type;if(a.dataType==='json'){a.json=true;}if(a.method==='GET'){a.qs=a.data;}else if(a.method==='POST'){a.body=a.data;}var r=i(a);r.then(function(k){b.responseHeaders=k.headers;return c.resolve(k.body);});r.error(function(k){return c.reject(k);});return c;}else{if(a.type.toLowerCase()==='post'){a.data=JSON.stringify(a.data);}return f.ajax(a);}},ajax:function(r){var a=this;var j;if(this.properties.demoMode){j=this._handleRequestFromRecords(r,this.properties.demoMode);}else{r.processData=r.processData||false;r.type=r.type||this.properties.httpMethod||'POST';if(r.data&&!r.noXSRFToken){if(r.type.toLowerCase()==='get'){r.data='Request='+JSON.stringify(r.data);}}if(r.noXSRFToken){j=this._ajax(r);}else{j=this._requestWithXSRFToken(r);}}if(j&&j.done){j.done(function(b){if(a.properties.recordFile){a._recordResponseAsync(r,b,a.properties.recordFile);}});}return j;},_recordResponseAsync:function(r,a,b){a=f.extend(true,{},a);var c=this;this._loadRecordingsAsync(false,b).then(function(d){if(typeof d==='string'){d=JSON.parse(d);}d[c._requestHashValue(r.url,r.data)]=a;return d;}).then(function(d){if(b===c.properties.demoMode){throw'Recording: source file must not be the same as target file';}c._saveRecordingsAsync(d);});}};return e;}(f);B=function(A,f){var e={};e.System=function(){this.init.apply(this,arguments);};e.Service=function(){this.init.apply(this,arguments);};e.Capability=function(){this.init.apply(this,arguments);};e.Capability.prototype={init:function(a){this.properties=a||{};this.name=this.properties.Capability||'';this.minVersion=this.properties.MinVersion||0;this.maxVersion=this.properties.MaxVersion||0;}};e.Service.prototype={init:function(a){this.properties=a||{};this.name=this.properties.Service;this.minVersion=this.properties.MinVersion||0;this.maxVersion=this.properties.MaxVersion||0;this.capabilities={};for(var i=0;i<this.properties.Capabilities.length;i++){this.capabilities[this.properties.Capabilities[i].Capability]=new e.Capability(this.properties.Capabilities[i]);}},getCapability:function(n){return this.capabilities[n];},getCapabilities:function(){return this.capabilities;}};e.System.prototype={init:function(a){this.services={};this.host=a.host||'';this.port=a.port||'';this.user=a.user||'';this.password=a.password||'';this.protocol=a.protocol||'https';this.servicePath=a.servicePath||'';this.servicePath=a.servicePath||'';this.servicePath=a.servicePath||'';this.requestOptions=a.requestOptions||{};this.proxy=a.proxy||new A.Proxy({system:this});},_getUrlParameter:function(n){return f.getUrlParameter(n);},getService:function(n){return this.services[n];},getServices:function(){return this.services;},getSystemType:function(){return this.systemType;},_deleteServerInfo:function(){if(this.jqXHR){this.jqXHR=f.Deferred();}},_getServerInfo:function(i){var a=this;if(this.jqXHR&&i){return this.jqXHR.promise();}if(this.jqXHR&&i===false){if(this.jqXHR.state()==='resolved'){return this.properties;}if(this.jqXHR.state()==='pending'){this.deprecatedJqXHR=f.extend({},this.jqXHR);}}this.jqXHR=f.Deferred();var r={async:i,type:'GET',url:this.infoUrl,getServerInfo:true,processData:false,contentType:'application/json',dataType:'json',error:function(j,c,d){throw new Error('Error while fetching GetServerInfo: '+j.statusText);}};if(i===true){this.proxy.ajax(r).done(function(d){a.setServerInfo(d);a.jqXHR.resolve(a.properties);if(a.deprecatedJqXHR){a.deprecatedJqXHR.resolve(a.properties);}}).fail(function(c){a.jqXHR.reject(c);if(a.deprecatedJqXHR){a.deprecatedJqXHR.reject(c);}});return this.jqXHR.promise();}var b=this.proxy.ajax(r);this.setServerInfo(JSON.parse(b.responseText));return this.properties;},getServerInfo:function(){return this._getServerInfo(true);},getServerInfoSync:function(){return this._getServerInfo(false);}};return e;}(A,f);C=function(A,f){var e={};e.Proxy=function(){this.init.apply(this,arguments);};e.Proxy.prototype=f.extend({},A.Proxy.prototype,{init:function(a){var b=this;b.properties=a||{};A.Proxy.prototype.init.apply(this,[a]);}});return e;}(A,f);D=function(b,y,B,A,f){var e={};e.ABAPSystem=function(){this.init.apply(this,arguments);};e.HANASystem=function(){this.init.apply(this,arguments);};e.ABAPSystem.prototype=f.extend({},B.System.prototype,{init:function(a){a=a||{};this.systemType='ABAP';this.inaUrl=a.inaUrl||'/sap/es/ina/GetResponse';this.infoUrl=a.infoUrl||'/sap/es/ina/GetServerInfo';a.proxy=a.proxy||new A.Proxy({'xsrfService':this.infoUrl,system:this});this.noSapClientFromUrl=a.noSapClientFromUrl;B.System.prototype.init.apply(this,[a]);this.properties={};if(a.sapclient){this.sapclient(a.sapclient);}else if(typeof window!=='undefined'){var s=this._readSapClientFromUrl();this.sapclient(s);}if(a.saplanguage){this.saplanguage(a.saplanguage);}else{var c=this._getUrlParameter('sap-language');this.saplanguage(c);}},setSinaUrlParameter:function(n,v){v=''+v;if(n.toUpperCase()==='SAP-CLIENT'&&v.length<3){for(var i=0;i<2;i++){v='0'+v;}}var s=function(a){var c=(new RegExp(n+'='+'(.+?)(&|$|#)','i').exec(a)||[null])[1];if(!c){if(a.indexOf('?')===-1){a+='?'+encodeURIComponent(n)+'='+encodeURIComponent(v);}else{a+='&'+encodeURIComponent(n)+'='+encodeURIComponent(v);}}else{a=a.replace(n+'='+c,encodeURIComponent(n)+'='+encodeURIComponent(v));}return a;};this.infoUrl=s(this.infoUrl);this.inaUrl=s(this.inaUrl);},_readSapClientFromUrl:function(){if(typeof this.noSapClientFromUrl!=='undefined'&&this.noSapClientFromUrl===true){return'';}return this._getUrlParameter('sap-client');},sapclient:function(s){if(s){this.properties.sapclient=s;this.setSinaUrlParameter('sap-client',this.properties.sapclient);this._deleteServerInfo();}else{return this.properties.sapclient;}},saplanguage:function(l){if(l){this.properties.saplanguage=l;this.setSinaUrlParameter('sap-language',this.properties.saplanguage);}else{return this.properties.saplanguage;}},setServerInfo:function(j){this.properties.rawServerInfo=j;if(this instanceof e.ABAPSystem){this.properties.dbms=j.ServerInfo.DataBaseManagementSystem;this.properties.sapclient=j.ServerInfo.Client;this.properties.saplanguage=j.ServerInfo.UserLanguageCode;this.properties.systemid=j.ServerInfo.SystemId;}var s;for(var i=0;i<j.Services.length;i++){var a=j.Services[i];switch(a.Service){case'Suggestions2':a.Service='Suggestions';s=new e.SuggestionService(a);break;default:s=new B.Service(a);}this.services[a.Service]=s;}this.properties.services=this.services;}});e.HANASystem.prototype=f.extend({},B.System.prototype,{init:function(a){a=a||{};this.systemType='HANA';this.infoUrl=a.infoUrl||'/sap/bc/ina/service/v2/GetServerInfo';this.inaUrl=a.inaUrl||'/sap/bc/ina/service/v2/GetResponse';a.proxy=a.proxy||new A.Proxy({'xsrfService':this.infoUrl});B.System.prototype.init.apply(this,[a]);this._setUpAjaxErrorHandler();}});e.SuggestionService=function(){this.init.apply(this,arguments);};e.SuggestionService.prototype=f.extend(Object.create(B.Service.prototype),{init:function(s){B.Service.prototype.init.apply(this,arguments);var a=false;for(var j=0;j<s.Capabilities.length;++j){var c=s.Capabilities[j];if(c.Capability==='ScopeTypes'){a=true;}}if(a){this.suggestionTypes=[b.SuggestionType.OBJECTDATA,b.SuggestionType.HISTORY,b.SuggestionType.DATASOURCE];}else{this.suggestionTypes=[b.SuggestionType.OBJECTDATA];}}});return e;}(g,y,B,C,f);E=function(b,f){var e={};e.Query=function(){this.init.apply(this,arguments);};e.Query.prototype=f.extend({},{init:function(a){this.filter=a.filter||a.sina.createFilter({dataSource:a.dataSource});this.system=a.system;},_resetResultSet:function(){this.deferredResultSet=null;this.resultSet=null;this.jqXHR=null;},_getInAV2Error:function(d){var a=[];if(d&&d.error){a.push(new b.SinaError({message:'INA V2 Service Error '+d.error.code+': '+d.error.message,errorCode:d.error.code}));}if(d&&d.Messages){for(var i=0;i<d.Messages.length;i++){if(d.Messages[i].Type>=2){a.push(new b.SinaError({message:'INA V2 Service Error '+d.Messages[i].Number+': '+d.Messages[i].Text,errorCode:d.Messages[i].Number}));}}}return a;},setDataSource:function(d){if(d===undefined){return this;}d=this.sina.createDataSource(d);if(this.filter.getDataSource()===undefined){this.filter.setDataSource(d);this._resetResultSet();return this;}if(!this.filter.getDataSource().equals(d)){this.filter.setDataSource(d);this._resetResultSet();}return this;},execute:function(){var a=this;var j=a.createJsonRequest();var d=f.Deferred();this.serverInfojqXHR=this.system.getServerInfo();this.serverInfojqXHR.fail(function(c){d.reject(c);});this.serverInfojqXHR.done(function(s){if(a.sina.eventLoggingService){a.sina.eventLoggingService.addLoggingParametersToRequest(s,j);}if(!a.jqXHR){a.jqXHR=a._fireRequest(j,true);}a.jqXHR.done(function(c){var h=a._getInAV2Error(c);if(c&&h&&h.length>0){if(c.error){d.reject(h[0]);return;}else if(c.Messages){if(h.length>=c.Messages.length){d.reject(h);return;}}}a.resultSetProperties.sina=a.sina;a.resultSetProperties.query=a;var r=new a.resultSetClass(a.resultSetProperties);r.setJsonFromResponse(c);d.resolve(r);}).fail(function(c){d.reject(c);}).always(function(c){a._responseJson=c;});});return d.promise();},executeSync:function(){var a=this;if(a.resultSet!==null){return a.resultSet;}var j=a.createJsonRequest();var s=a.system.getServerInfoSync();a.sina.eventLoggingService.addLoggingParametersToRequest(s,j);var d=JSON.parse(a._fireRequest(j,false).responseText);a._responseJson=d;a.resultSet=new a.resultSetClass(a.resultSetProperties);if(d){var c=a._getInAV2Error(d);if(c&&c.length>0){throw c[0];}a.resultSet.setJsonFromResponse(d);}return a.resultSet;},_fireRequest:function(d,a,c){a=a===undefined?true:a;var r={async:a,url:this.system.inaUrl,contentType:'application/json',dataType:c||'json',data:d};var j=this.system.proxy.ajax(r);return j;},_assembleOrderBy:function(){var o=[];function a(d,s){var i={};if(d.toLowerCase()==='$$score$$'){i.Function='Score';}else{i.AttributeName=d;}i.SortOrder=s.toUpperCase();return i;}var c;if(Object.prototype.toString.call(this.orderBy)==='[object Array]'){for(var j=0;j<this.orderBy.length;j++){c=a(this.orderBy[j].orderBy,this.orderBy[j].sortOrder);o.push(c);}}else if(typeof this.orderBy==='object'&&this.orderBy.orderBy){c=a(this.orderBy.orderBy,this.orderBy.sortOrder);o.push(c);}return o;}});return e;}(g,f);F=function(g,p,a,b,d,f){var e={};e.SearchQuery=function(){this.init.apply(this,arguments);};e.SearchQuery.prototype=f.extend({},p.SearchQuery.prototype,b.Query.prototype,{init:function(c){c=c||{};b.Query.prototype.init.apply(this,[c]);p.SearchQuery.prototype.init.apply(this,[c]);this.sqlSearch=c.sqlSearch===undefined||c.sqlSearch===true?true:false;this.attributes=c.attributes||[];c.orderBy=c.orderBy||{};this.setOrderBy(c.orderBy);this.resultSetClass=e.SearchResultSet;},addResponseAttribute:function(c){this.attributes.push(c);this._resetResultSet();return this;},createJsonRequest:function(){var c=d.getSearchRequest();c.DataSource=this.filter.dataSource.getDataForRequest();if(this.system instanceof inaV2System.HANASystem){if(this.attributes.length===0){throw{message:'Add at least one response attribute to your query'};}if(this.sqlSearch===true){c.Options=['SqlSearch'];}}var s=[];for(var i=0;i<this.attributes.length;++i){var h=this.attributes[i];if(f.type(h)==='string'){s.push({Name:h,AttributeName:h});}else if(f.type(h)==='object'){var j={Name:h.name||h.attributeName,AttributeName:h.attributeName||h.name};if(h.highlighted===true){j.Function='Highlighted';}if(h.snippet===true){j.Function='Snippet';}if(h.startPosition!==undefined){j.StartPosition=h.startPosition;}if(h.maxLength!==undefined){j.MaxLength=h.maxLength;}s.push(j);}}c.Search.SelectedValues=s;var k=this.filter.getSearchTerms();if(!k){k='*';}c.SearchTerms=k;c.Search.Top=this._top;c.Search.Skip=this._skip;c.Search.Filter=this.filter.getDataForRequest();c.Search.OrderBy=this._assembleOrderBy();return c;},setOrderBy:function(o){this._resetResultSet();this.orderBy=o||{orderBy:'$$score$$',sortOrder:'DESC'};},getOrderBy:function(){return this.orderBy;}});e.SearchResultSet=function(){this.init.apply(this,arguments);};e.SearchResultSet.prototype={init:function(c){c=c||{};this.sina=c.sina;this.elements=[];this.totalcount=0;},toString:function(r){var c=this.elements;var h=[];var i;for(i=0;i<c.length;++i){var j=c[i];var k={};for(var l in j){if(l.slice(0,2)==='$$'||l.slice(0,1)==='_'){continue;}var m=j[l];if(!m.label||!m.value){continue;}var n={label:m.label,value:m.value};k[l]=n;}h.push(k);}return JSON.stringify(h);},setJsonFromResponse:function(h){var s=this;this.elements=[];function r(){this.type='';this.platform='';this.technology='';this.width='';this.height='';this.variant='';this.uri='';}r.prototype={_fromInaJson:function(k){this.type=k.Type||'';this.platform=k.Platform||'';this.technology=k.Technology||'';this.width=k.Width||'';this.height=k.Height||'';this.variant=k.Variant||'';this.uri=k.Uri||'';}};function v(){this.type='';this.description='';this.uri='';this.request=null;this.encodedJSON='';}v.prototype={_fromInaJson:function(k){var l=this;l.description=k.Description;l.uri=k.Uri;switch(k.Type){case'RelatedRequest':l.type='Search';var m={};m.dataSource=s.sina.createDataSource();m.dataSource.setJsonFromResponse(k.Request.DataSource);m.system=s.sina.getSystem();m.top=1;l.request=s.sina.createSearchQuery(m);l.request.filter.setJsonFromResponse(k.Request.Filter);if(k.Request.Filter.Selection===undefined){l.request.invalid=true;l.request.invalidMessage='Related request \''+l.description+'\' is invalid because of missing filter conditions.';}break;case'GeneralUri':l.type='Link';l.url=l.uri;break;case'SAPNavigation':l.type='Navigation';l.url=l.uri;break;}l.encodedJSON=encodeURIComponent(l);}};function m1(k){this.resultElementAttribute=k;this.correspondingSearchAttributeName='';this.description='';this.isTitle=false;this.presentationUsage=[];this.displayOrder=null;this.semanticObjectType='';this.isSortable=false;}m1.prototype={_fromInaJson:function(k){var l=this;l.correspondingSearchAttributeName=k.correspondingSearchAttributeName||'';l.dataType=k.DataType||'';l.description=k.Description||'';l.presentationUsage=k.presentationUsage||[];l.accessUsage=k.accessUsage||[];l.semanticObjectType=k.SemanticObjectType||'';l.isSortable=k.IsSortable||false;if(k.IsTitle!==undefined){l.isTitle=k.IsTitle;}l.isKey=k.IsKey;if(l.isTitle){if(!l.resultElementAttribute.resultElement.title){l.resultElementAttribute.resultElement.title=l.resultElementAttribute.resultElement.$$DataSourceMetaData$$.getLabel()+':';}l.resultElementAttribute.resultElement._registerPostProcessor(function(){l.resultElementAttribute.resultElement.title=l.resultElementAttribute.resultElement.title+' '+l.resultElementAttribute.value;});}if(l.isKey){if(!l.resultElementAttribute.resultElement.key){l.resultElementAttribute.resultElement.key=l.resultElementAttribute.resultElement.$$DataSourceMetaData$$.key+':';}l.resultElementAttribute.resultElement._registerPostProcessor(function(){if(l.resultElementAttribute.labelRaw&&l.resultElementAttribute.value){l.resultElementAttribute.resultElement.key=l.resultElementAttribute.resultElement.key+l.resultElementAttribute.labelRaw+'#'+l.resultElementAttribute.value+'/';}});}}};function n1(k){this.resultElement=k;this.$$MetaData$$=new m1(this);this.label='';this.labelRaw='';this.value='';this.valueRaw='';}n1.prototype={_fromInaJson:function(k){var l=this;l.labelRaw=this.$$MetaData$$.correspondingSearchAttributeName||k.Name||'';l.label=this.$$MetaData$$.description||k.Name||'';l.valueRaw=k.Value||'';l.value=k.ValueFormatted||'';},toString:function(){return this.value;}};function o1(){this.title='';this.$$DataSourceMetaData$$={};this.$$RelatedActions$$={};this.$$RenderingTemplateSpecification$$={};this.$$WhyFound$$=[];this.$$PostProcessors$$=[];}o1.prototype={_fromInaJson:function(x1){var D1=this;var E1=null;var F1=null;for(var k=0;k<x1.length;++k){var G1=x1[k];switch(G1.Name){case'$$DataSourceMetaData$$':var H1=G1.Value[0];E1=s.sina.createDataSource(f.extend(true,{},H1));D1.$$DataSourceMetaData$$=E1;break;case'$$AttributeMetadata$$':for(var m=0;m<G1.Value.length;++m){F1=G1.Value[m];if(!D1[F1.Name]){D1[F1.Name]=new n1(D1);}D1[F1.Name].$$MetaData$$._fromInaJson(F1);D1[F1.Name].$$MetaData$$.displayOrder=m;}break;case'$$ResultItemAttributes$$':for(var l=0;l<G1.Value.length;++l){var I1=G1.Value[l];if(!D1[I1.Name]){D1[I1.Name]=new n1(D1);}D1[I1.Name]._fromInaJson(I1);}break;case'$$RelatedActions$$':var J1={};for(var n=0;n<G1.Value.length;++n){var K1=G1.Value[n];var L1=new v();L1._fromInaJson(K1);J1[K1.ID]=L1;}D1.$$RelatedActions$$=J1;break;case'$$RenderingTemplateSpecification$$':for(var o=0;o<G1.Value.length;++o){var M1=new r();M1._fromInaJson(G1.Value[o]);if(M1.type==='ItemDetails'){D1._detailTemplate=M1;}else{D1.$$RenderingTemplateSpecification$$=M1;}}break;case'$$WhyFound$$':for(var z=0;z<G1.Value.length;++z){var N1={};N1.label=G1.Value[z].Description;N1.labelRaw=G1.Value[z].Name;N1.value=G1.Value[z].Value;N1.valueHighlighted=N1.value;N1.valueRaw=G1.Value[z].Value;D1.$$WhyFound$$.push(N1);}break;default:D1[G1.Name]=new n1();D1[G1.Name].label=G1.Name||'';D1[G1.Name].valueRaw=G1.Value||G1.ValueFormatted||null;D1[G1.Name].value=G1.ValueFormatted||G1.Value||null;}}for(var i=0;i<this.$$PostProcessors$$.length;i++){this.$$PostProcessors$$[i]();}var O1=g.Sina.prototype.ResultElementKeyStatus;if(this.key){if(this.key.indexOf(':')===this.key.length-1){this.keystatus=O1.NO_VALUE;}else{this.keystatus=O1.OK;}}else{this.keystatus=O1.NO_KEY;this.key='';}},_registerPostProcessor:function(k){this.$$PostProcessors$$.push(k);}};function p1(t1){if(t1._detailTemplate&&!t1.$$RelatedActions$$.$$DETAILS$$){t1.$$RelatedActions$$.$$DETAILS$$={request:s.sina.createSearchQuery(),description:'',encodedJSON:'',type:'Search',uri:''};}if(t1._detailTemplate&&t1.$$RelatedActions$$.$$DETAILS$$){var k=new e.SearchResultSet({sina:s.sina});k.elements[0]=f.extend(true,{},t1);k.elements[0].$$RenderingTemplateSpecification$$=t1._detailTemplate;k.totalcount=1;delete k.elements[0].$$RelatedActions$$.$$DETAILS$$;t1.$$RelatedActions$$.$$DETAILS$$.request.resultSet=k;return k.elements[0];}return{};}var q1={};if(!h.ItemLists){return{};}for(var i=0;i<h.ItemLists.length;i++){q1[h.ItemLists[i].Name]=h.ItemLists[i];if(h.ItemLists[i].Name.toLowerCase()==='searchresult'){this.totalcount=h.ItemLists[i].TotalCount.Value;}}var r1;if(h&&h.Grids&&h.Grids[0]&&h.Grids[0].Axes&&h.Grids[0].Axes[0]){r1=h.Grids[0].Axes[0];}else{return{};}for(var j=0;j<r1.Tuples.length;j++){var s1=r1.Tuples[j];if(s1===undefined){continue;}var t1=new o1();for(var c=s1.length-1;c>=0;c--){var u1=r1.Dimensions[c];var v1=s1[c];var w1=q1[u1.ItemListName];var x1=w1.Items[v1].NamedValues;t1._fromInaJson(x1);}if(r1&&r1.Dimensions[1]){var y1=r1.Dimensions[1];var z1=q1[y1.ItemListName];var A1=s1[1];if(z1&&z1.Items&&z1.Items[A1]){var B1=z1.Items[A1].NamedValues[2];if(B1){t1=this._postProcess4WhyFound(t1,B1.Value);}}}var C1=p1(t1);this._postProcessRelatedAction(t1);if(C1){this._postProcessRelatedAction(C1);}this.elements.push(t1);var x=t1.$$DataSourceMetaData$$;if(x&&x.getObjectName&&x.getObjectName().value!=='$$DataSources$$'&&x.getObjectName().value!=='$$All$$'){this.sina.setBusinessObjectMetaDataSync(x,t1);}}return{};},getElements:function(){return this.elements;},_postProcessRelatedAction:function(c){if(!c.$$RelatedActions$$){return;}for(var r in c.$$RelatedActions$$){var h=c.$$RelatedActions$$[r];if(h.type==='Search'){this.sina._postprocess(h,c.title);}}},_postProcess4WhyFound:function(c,m){if(c.$$WhyFound$$&&c.$$WhyFound$$.length>0){var i=c.$$WhyFound$$.length;while(i--){if(c[c.$$WhyFound$$[i].labelRaw]!==undefined&&m!==undefined){var j=m.length;while(j--){if(m[j].Name===c.$$WhyFound$$[i].labelRaw&&m[j].correspondingSearchAttributeName){c.$$WhyFound$$[i].labelRaw=m[j].correspondingSearchAttributeName;}}}}}return c;}};return e;}(g,p,D,E,t,f);G=function(p,x,s,j,f){var e={};e.DataSource=function(){this.init.apply(this,arguments);};e.DataSourceMetaData=function(){this.init.apply(this,arguments);};e.DataSourceQuery=function(){this.init.apply(this,arguments);};e.ESHConnectorDataSourceQuery=function(){this.init.apply(this,arguments);};e.DataSource.prototype=f.extend(Object.create(x.DataSource.prototype),{init:function(a){x.DataSource.prototype.init.apply(this,[a]);if(!a){return{};}var d;if(a.key){this.key=a.key;d=true;}a.schemaName=a.schemaName||a.SchemaName||{label:'',value:''};this.setSchemaName(a.schemaName,d);a.packageName=a.packageName||a.PackageName||'ABAP';this.setPackageName(a.packageName,d);a.objectName=a.objectName||a.ObjectName||{label:'',value:''};this.setObjectName(a.objectName,d);this.setType(a.type||a.Type||x.DataSourceType.DEFAULT,d);this.label=a.label||a.Label||a.Description||'';this.labelPlural=a.labelPlural||a.LabelPlural||a.DescriptionPlural||this.label||'';this.semanticObjectType=a.semanticObjectType||a.SemanticObjectType||'';this.systemId=a.systemId||a.SystemId||'';this.client=a.client||a.Client||'';this.sina=a.sina||null;if(a.metaData){this.setMetaData(a.metaData);}if(!this.key){throw'Datasource has no key'+JSON.stringify(a);}},setMetaData:function(d){this.metaData=d;},getIdentifier:function(){return this.key;},getSchemaName:function(){if(!this.schemaName){this.schemaName={label:'',value:''};}return this.schemaName;},_getSchemaNameAsString:function(){if(typeof this.schemaName==='object'){return this.schemaName.value;}if(typeof this.schemaName==='string'){return this.schemaName;}return'';},setSchemaName:function(a,d){if(!this.schemaName){this.schemaName={};}if(typeof a==='object'){this.schemaName.label=a.label||a.value||'';this.schemaName.value=a.value||'';}if(typeof a==='string'){this.schemaName.label=a;this.schemaName.value=a;}if(d!==true){this._constructKey();}},getPackageName:function(){if(!this.packageName){this.packageName={label:'',value:''};}return this.packageName;},getPackageNameAsString:function(){if(typeof this.packageName==='object'){return this.packageName.value;}if(typeof this.packageName==='string'){return this.packageName;}return'';},setPackageName:function(a,d){if(!this.packageName){this.packageName={};}if(typeof a==='object'){this.packageName.label=a.label||a.value||'';this.packageName.value=a.value||'';}if(typeof a==='string'){this.packageName.label=a;this.packageName.value=a;}if(d!==true){this._constructKey();}},getObjectName:function(){if(!this.objectName){this.objectName={label:'',value:''};}return this.objectName;},setObjectName:function(o,d){if(!this.objectName){this.objectName={};}if(typeof o==='object'){this.objectName.label=o.label||o.value||'';this.objectName.value=o.value||'';}if(typeof o==='string'){this.objectName.label=o;this.objectName.value=o;}if(d!==true){this._constructKey();}},_constructKey:function(){this.key=this.getTypeAsString()+'/'+this.getPackageNameAsString()+'/'+this.getObjectNameAsString();},setObjectNameValue:function(v,d){if(!this.objectName){this.objectName={};}this.objectName.value=v||'';if(d!==true){this._constructKey();}},setObjectNameLabel:function(l){if(!this.objectName){this.objectName={};}this.objectName.label=l||'';if(!this.label){this.setLabel(l);}if(!this.labelPlural){this.setLabelPlural(l);}},getObjectNameAsString:function(){if(typeof this.objectName==='object'){return this.objectName.value;}if(typeof this.objectName==='string'){return this.objectName;}return'';},setType:function(a,d){var v=x.DataSourceType.DEFAULT;if(typeof a==='object'){if(a.value.toLowerCase()==='view'||a.value.toLowerCase()==='businessobject'){v=x.DataSourceType.BUSINESSOBJECT;}else{v=x.DataSourceType.DEFAULT;}}else{if(a.toLowerCase()==='view'||a.toLowerCase()==='businessobject'){v=x.DataSourceType.BUSINESSOBJECT;}else{v=x.DataSourceType.DEFAULT;}}this.type=v;if(d!==true){this._constructKey();}},getTypeAsString:function(){if(typeof this.type==='object'){return this.type.value;}if(typeof this.type==='string'){return this.type;}return'';},getLabel:function(){if(typeof this.label!=='undefined'&&this.label!==''){return this.label;}if(typeof this.getObjectName().label!=='undefined'&&this.getObjectName().label!==''){return this.getObjectName().label;}if(typeof this.getObjectName().value!=='undefined'&&this.getObjectName().value!==''){return this.getObjectName().value;}return'';},setLabel:function(l){this.label=l||'';this.labelPlural=this.labelPlural||this.label;},getLabelPlural:function(){if(typeof this.labelPlural!=='undefined'&&this.labelPlural!==''){return this.labelPlural;}return this.getLabel();},setLabelPlural:function(l){this.labelPlural=l||'';},setJsonFromResponse:function(i){this.setSchemaName({value:i.SchemaName,label:i.SchemaLabel});this.setPackageName({value:i.PackageName,label:i.PackageLabel});this.setObjectName({value:i.ObjectName,label:i.ObjectLabel});this.setType({value:i.Type,label:''});},getDataForRequest:function(){var a={'SchemaName':this.getSchemaName().value,'PackageName':this.getPackageName().value,'ObjectName':this.getObjectName().value};if(this.getType()===x.DataSourceType.BUSINESSOBJECT){a.Type='View';}else{a.Type=this.getType();}return a;},clone:function(){var n=this.sina.createDataSource();n.setSchemaName(this.schemaName);n.setPackageName(this.packageName);n.setObjectName(this.objectName);n.setType(this.type);n.label=this.label;n.labelPlural=this.labelPlural;n.semanticObjectType=this.semanticObjectType;n.systemId=this.systemId;n.client=this.client;n.setMetaData(this.metaData);n.key=this.key;return n;},setJson:function(a){for(var b in a){if(a.hasOwnProperty(b)){a[b.toLowerCase()]=a[b];}}this.schemaName=a.schemaname;this.packageName=a.packagename;this.objectName=a.objectname;if(a.Type==='View'){this.setType(x.DataSourceType.BUSINESSOBJECT);}else{this.setType(a.type);}this.label=a.label;this.labelPlural=a.labelplural;this.semanticObjectType=undefined;this.systemId=undefined;this.client=undefined;this.metaData=undefined;this._constructKey();},getJson:function(){var a={'label':this.label,'labelPlural':this.labelPlural,'SchemaName':{'label':this.getSchemaName().label,'value':this.getSchemaName().value},'PackageName':{'label':this.getPackageName().label,'value':this.getPackageName().value},'ObjectName':{'label':this.getObjectName().label,'value':this.getObjectName().value}};a.Type=this.getType();return a;}});e.DataSourceQuery.prototype=f.extend({},p.SearchQuery.prototype,s.SearchQuery.prototype,{init:function(a){p.SearchQuery.prototype.init.apply(this,[a]);s.SearchQuery.prototype.init.apply(this,[a]);this.template=j.getCatalogRequest();this.template.SearchTerms=this.getSearchTerms()||'*';if(this._top===undefined){this.setTop(1000);}this.template.Search.Top=this.getTop();if(this._skip===undefined){this.setSkip(0);}this.template.Search.Skip=this.getSkip();var b={'MemberOperand':{'AttributeName':'Type','Comparison':'=','Value':'View'}};var c=a.system.getService('Search').getCapabilities();if(c&&c.PluralDescriptionForDataSource){this.template.Search.NamedValues.push({'AttributeName':'DescriptionPlural','Name':'DescriptionPlural'});}this.template.Search.Filter.Selection.Operator.SubSelections.push(b);},createJsonRequest:function(){return this.template;}});e.ESHConnectorDataSourceQuery.prototype=f.extend({},p.SearchQuery.prototype,s.SearchQuery.prototype,{init:function(a){p.SearchQuery.prototype.init.apply(this,[a]);s.SearchQuery.prototype.init.apply(this,[a]);this.template=j.getESHConnectorRequest();var b=this.system.getServerInfoSync();var c=b.rawServerInfo.ServerInfo.SystemId;var d=c+this.system.sapclient()+'~ESH_CONNECTOR~';var h=a.dataSource||{SchemaName:'',PackageName:'ABAP',ObjectName:d,type:'Connector'};this.template.DataSource=h;this.template.SearchTerms=this.getSearchTerms()||'*';if(this._top===undefined){this.setTop(1000);}this.template.Search.Top=this.getTop();if(this._skip===undefined){this.setSkip(0);}this.template.Search.Skip=this.getSkip();},createJsonRequest:function(){return this.template;}});return e;}(p,x,F,t,f);H=function(q,f){var e={};e.ChartQuery=function(){this.init.apply(this,arguments);};e.ChartQuery.prototype=f.extend({},q.Query.prototype,{init:function(){q.Query.prototype.init.apply(this,arguments);}});return e;}(q,f);I=function(g,a,q,y,f){var e={};e.Perspective=function(){this.init.apply(this,arguments);};e.Perspective.prototype={init:function(b){var c=this;c.sina=b.sina;c.chartFacets=[];c.searchFacet=null;c.layout=null;c.dataSource=b.dataSource||null;b=b||{};},getSearchResultSet:function(){return this.searchFacet.getQuery().getResultSetSync();},getChartFacets:function(){return this.chartFacets;},getSearchFacet:function(){return this.searchFacet;},getLayout:function(){return this.layout;}};e.PerspectiveQuery=function(){this.init.apply(this,arguments);};e.PerspectiveQuery.prototype=f.extend({},q.Query.prototype,{init:function(){q.Query.prototype.init.apply(this,arguments);this.facets=[];this.requestedEntities=['SearchResults','Facets','TotalCount'];this.facetLoader=new e.FacetLoader({sina:this.sina});this.includeFacetsWithFilters=false;},addFacet:function(b){this.facets.push(b);return this;},getFacets:function(){return this.facets;},setOrderBy:function(o){this._resetResultSet();this.orderBy=o||{orderBy:'$$score$$',sortOrder:'DESC'};return this;},getOrderBy:function(){return this.orderBy;},setRequestedEntities:function(r){if(JSON.stringify(r)===JSON.stringify(this.requestedEntities)){return;}this.requestedEntities=r;this._resetResultSet();},getRequestedEntities:function(){return this.requestedEntities;},setIncludeFacetsWithFilters:function(i){if(i===this.includeFacetsWithFilters){return;}this.includeFacetsWithFilters=i;this._resetResultSet();},_resetResultSet:function(){this.resultSetAndFacetsPromise=null;},getResultSet:function(o,b){var c=this;if(!this.includeFacetsWithFilters){return q.Query.prototype.getResultSet.apply(this,arguments);}if(c.resultSetAndFacetsPromise){if(o){c.resultSetAndFacetsPromise.done(o);}if(b){c.resultSetAndFacetsPromise.fail(b);}return c.resultSetAndFacetsPromise;}var d=q.Query.prototype.getResultSet.apply(this,[]);var h=this.facetLoader.loadFacets(this);c.resultSetAndFacetsPromise=f.when(d,h).then(function(i,j){c.addFacetsToPerspective(i,j);return i;});if(o){c.resultSetAndFacetsPromise.done(o);}if(b){c.resultSetAndFacetsPromise.fail(b);}return c.resultSetAndFacetsPromise;},addFacetsToPerspective:function(b,c){for(var i=0;i<c.length;++i){var d=c[i];var h=false;var j;for(j=0;j<b.chartFacets.length;++j){var k=b.chartFacets[j];if(k.getDimension()===d.getDimension()){h=true;break;}}if(h){d.title=b.chartFacets[j].title;b.chartFacets.splice(j,1,d);}else{b.chartFacets.push(d);}}}});e.FacetLoader=function(){this.init.apply(this,arguments);};e.FacetLoader.prototype={init:function(b){this.sina=b.sina;},loadFacets:function(b){var c=this;var u=b.filter;var d=b.options.indexOf(g.QueryOptions.FUZZY)>=0;var h=this.collectAttributes(u);h=h.filter(function(l){if(l.slice(0,2)==='$$'){return false;}return true;});var k=[];for(var i=0;i<h.length;++i){var l=h[i];k.push(this.createChartQuery(l,u,d));}var m=[];for(var j=0;j<k.length;j++){m.push(k[j].getResultSet());}return f.when.apply(f.Deferred,m).then(function(){var n=[];for(var i=0;i<arguments.length;++i){n.push(c.sina.createFacet({dimension:h[i],query:k[i],facetType:g.FacetType.ATTRIBUTE,sina:c.sina,title:k[i].getTitle()}));}return n;});},collectAttributes:function(u){var c=u.getFilterConditions();var b={};var d=[];this.doCollectAttributes(c,b);for(var h in b){if(b.hasOwnProperty(h)){d.push(h);}}return d;},doCollectAttributes:function(c,b){if(!(c instanceof a.ConditionGroup)){b[c.attribute]=true;}else{var d=c.getConditions();for(var i=0;i<d.length;++i){c=d[i];this.doCollectAttributes(c,b);}}},createChartQuery:function(b,u,i){u=u.clone();this.removeFilterConditionsByAttribute(u,b);var c=this.sina.createChartQuery();c.setFilter(u);c.addDimension(b);c.setAttributeLimit(5);if(i){c.addOption(g.QueryOptions.FUZZY);}return c;},removeFilterConditionsByAttribute:function(u,b){var c=u.getFilterConditions();if(!(c instanceof a.ConditionGroup)){if(c.attribute===b){u.resetFilterConditions();return;}else{return;}}this.doRemoveFilterConditionsByAttribute(b,c);},doRemoveFilterConditionsByAttribute:function(b,c){var d=c.getConditions();for(var i=0;i<d.length;++i){var h=d[i];if(!(h instanceof a.ConditionGroup)){if(h.attribute===b){d.splice(i,1);i--;}}else{this.doRemoveFilterConditionsByAttribute(b,h);}}}};return e;}(g,u,q,y,f);J=function(b){var e={};e.Facet=function(){this.init.apply(this,arguments);};e.Facet.prototype={init:function(a){a=a||{};this.sina=a.sina;this.dataSource=a.dataSource||null;this.title=a.title||'';this.query=a.query||null;this.dimension=a.dimension||null;a.facetType=a.facetType||'';this.facetType=a.facetType.toLowerCase();if(a.query){this.setQuery(a.query);}},getChartType:function(){},getTitle:function(){return this.title;},getDimension:function(){return this.dimension;},getQuery:function(){return this.query;},getLayout:function(){},getLayoutBinding:function(){},getColorPalette:function(){},setQuery:function(a){this.query=a;}};return e;}(g);K=function(g,q,I,J,a,b,f){var c={};c.PerspectiveQuery=function(){this.init.apply(this,arguments);};c.PerspectiveQuery.prototype=f.extend({},I.PerspectiveQuery.prototype,a.Query.prototype,{init:function(d){var e=this;e.chartFacets=[];e.searchFacet=null;e.searchresultset=null;e.layout=null;e.templateFactsheet=d.templateFactsheet||false;d=d||{};a.Query.prototype.init.apply(this,arguments);I.PerspectiveQuery.prototype.init.apply(this,arguments);d.orderBy=d.orderBy||{};this.setOrderBy(d.orderBy);this.resultSetClass=c.Perspective;this.resetFilterConditions();},_resetResultSet:function(){a.Query.prototype._resetResultSet.apply(this,arguments);I.PerspectiveQuery.prototype._resetResultSet.apply(this,arguments);},getExpand:function(){var e=[];for(var i=0;i<this.requestedEntities.length;i++){switch(this.requestedEntities[i]){case'SearchResults':e.push('Grid','Items');break;case'Facets':e.push('ResultsetFacets');break;case'TotalCount':e.push('TotalCount');break;default:throw'Unknown requested entity!';}}return e;},resetFilterConditions:function(){q.Query.prototype.resetFilterConditions.apply(this,arguments);},getLanguagePreferences:function(){var d=typeof InstallTrigger!=='undefined';var e=false||!!document.documentMode;var h=!e&&!!window.StyleMedia;var j=!!window.chrome&&!!window.chrome.webstore;var l=[];if(e||h){var k=window.navigator.browserLanguage||window.navigator.language;l.splice(0,0,this._getLanguageCountryObject(k));}else if(d||j){var m=window.navigator.language;var n=window.navigator.languages.slice();var o=n.indexOf(m);if(o>-1){n.splice(o,1);}l.splice(0,0,this._getLanguageCountryObject(m));for(var i=0;i<n.length;i++){var r=this._getLanguageCountryObject(n[i]);if(r){l.splice(l.length,0,r);}}}else{l.splice(0,0,this._getLanguageCountryObject(window.navigator.language));}return l;},_getLanguageCountryObject:function(l){var d,e;var h={};if(l.length===2){d=l;e='';}else if(l.length===5&&l.indexOf('-')===2){d=l.substr(0,2);e=l.substr(3);}else{return;}h.Language=d;h.Country=e;return h;},createJsonRequest:function(){var d=b.getPerspectiveRequest();if(this.templateFactsheet){d=b.getPerspectiveRequestFactsheet();}d.DataSource=this.filter.dataSource.getDataForRequest();var s=this.filter.getSearchTerms();d.Search.SearchTerms=s;d.Search.Top=this._top;d.Search.Skip=this._skip;d.Search.Filter=this.filter.getDataForRequest();d.Search.OrderBy=this._assembleOrderBy();d.Search.Expand=this.getExpand();if(this.facetOptions){d.Facets=this.facetOptions;}d.Options=d.Options.concat(this.options);var e=this.system.getService('Search').getCapabilities();if(e&&e.LanguagePreferences){d.LanguagePreferences=this.getLanguagePreferences();}return d;},getPerspective:function(o,d){this.getResultSet(o,d);},generatePerspectiveSync:function(){return this.getResultSetSync();}});c.Perspective=function(){this.init.apply(this,arguments);};c.Perspective.prototype=f.extend({},I.Perspective.prototype,{determineFacetType:function(r){try{if(r.ResultSet.ItemLists[0].Items[0].NamedValues[0].Name==='$$DataSource$$'){return g.FacetType.DATASOURCE;}else{return g.FacetType.ATTRIBUTE;}}catch(e){return g.FacetType.ATTRIBUTE;}},setJsonFromResponse:function(d){var e=this;e.searchFacet=this.sina.createFacet({'facetType':'searchresult'});e.searchFacet.setJsonFromResponse(d);if(d.ResultsetFacets&&d.ResultsetFacets.Elements){for(var j=0;j<d.ResultsetFacets.Elements.length;j++){var h=e.determineFacetType(d.ResultsetFacets.Elements[j]);var i=this.sina.createFacet({'facetType':h});i.setJsonFromResponse(d.ResultsetFacets.Elements[j]);e.chartFacets.push(i);}}}});c.PerspectiveGetQuery=function(){this.init.apply(this,arguments);};c.PerspectiveGetQuery.prototype=f.extend({},a.Query.prototype,{init:function(d){d=d||{};this.perspectiveId=d.perspectiveId;a.Query.prototype.init.apply(this,[d]);this.resultSetClass=module.Perspective2;},setPerspectiveId:function(d){this.perspectiveId=d;},getPerspective:function(o,d){var e=this;var r={async:true,url:'/sap/bc/ina/service/v2/Perspectives(\''+this.perspectiveId+'\')',type:'GET'};var j=this.system.proxy.ajax(r);j.done(function(h){if(h&&h.error){d(h.error);}e.resultSet=new e.resultSetClass(e.resultSetProperties);e.resultSet.setJsonFromResponse(h);if(o){o(e.resultSet);}}).fail(function(h){if(d){d(h);}});}});c.Perspective2=function(){this.init.apply(this,arguments);};c.Perspective2.prototype={init:function(d){d=d||{};},getFacetForID:function(d){var e=this;for(var j=0;j<e.facets.length;j++){if(e.facets[j].facetId===d){return e.facets[j];}}return undefined;},getDimensionForID:function(d){var e=this;for(var j=0;j<e.dimensions.length;j++){if(e.dimensions[j].Name===d){return e.dimensions[j];}}return undefined;},getPreviewDimension:function(){if(this.bindings['WIDGET-4']&&this.bindings['WIDGET-4'].dimension){return this.bindings['WIDGET-4'].dimension;}if(this.bindings['WIDGET-1']&&this.bindings['WIDGET-1'].dimension){return this.bindings['WIDGET-1'].dimension;}if(this.bindings['WIDGET-2']&&this.bindings['WIDGET-2'].dimension){return this.bindings['WIDGET-2'].dimension;}if(this.bindings['WIDGET-3']&&this.bindings['WIDGET-3'].dimension){return this.bindings['WIDGET-3'].dimension;}return undefined;},setJsonFromResponse:function(d){var e=this;e.rawdata=d;e.ChangedAt=d.ChangedAt;e.ChangedBy=d.ChangedBy;e.content=JSON.parse(d.Content);e.perspectiveId=d.Id;e.name=d.Name;e.packageName=d.Package;e.isActive=d.isActive;e.isGenerated=d.isGenerated;e.datasource=e.content.Model.Queries[0].Datasource;e.measures=[];var m=e.content.Model.Queries[0].CustomDimension1.Members;for(var k=0;k<m.length;k++){e.measures.push(m[k]);}e.dimensions=[];var h=e.content.Model.Queries[0].Dimensions;for(var j=0;j<h.length;j++){e.dimensions.push(h[j]);}e.facets=[];var n=e.content.Model.Facets;for(var i=0;i<n.length;i++){e.facets.push({isActive:n[i].Active,facetId:n[i].FacetId,dimension:e.getDimensionForID(n[i].SeriesChart.ScaleDimensions[0].DimensionName)});}e.bindings={};var o=e.content.Bindings;for(var l=0;l<o.length;l++){var r=o[l];e.bindings[r.WidgetId]=e.getFacetForID(r.FacetId);}}};c.PerspectiveSearchQuery=function(){this.init.apply(this,arguments);};c.PerspectiveSearchQuery.prototype=f.extend({},a.Query.prototype,{init:function(d){d=d||{};a.Query.prototype.init.apply(this,[d]);this.filter.searchTerms=d.searchTerms||'*';this.resultSetClass=module.PerspectiveSearchResultSet;},createJsonRequest:function(){var d=b.getPerspectiveSearchRequest();d.Search.SearchTerms=this.filter.searchTerms;d.Search.Top=this._top;d.Search.Skip=this._skip;return d;},getPerspectiveResults:function(o,d){this.getResultSet(o,d);}});c.PerspectiveSearchResultSet=function(){this.init.apply(this,arguments);};c.PerspectiveSearchResultSet.prototype={init:function(d){var e=this;e.perspectives=[];d=d||{};},getPerspectiveSearchResultSet:function(){return this.perspectives;},setJsonFromResponse:function(d){var e=this;var h=d['ItemLists'][0]['Items'];for(var i=0;i<h.length;i++){var n=h[i]['NamedValues'];var j={packageId:n[0].Value,perspectiveId:n[0].Value+'/'+n[1].Value,perspectiveDescription:n[3].Value,title:n[2].Value};e.perspectives.push(j);}}};return c;}(g,q,I,J,E,t,f);L=function(H,b,e,l,f){var m={};m.ResultSetParser=function(){this.init.apply(this,arguments);};m.ResultSetParser.prototype={init:function(o){this.resultSet=o.resultSet;},parse:function(){this.enhance(this.resultSet);var a=this.resultSet.Grids[0];var r=a.Axes[0];var c=a.Axes[1];var k=function(o1){return o1.__key;};var d=function(o1){var p1;var q1;var r1;for(var s1 in o1){switch(s1){case'Name':q1=o1[s1];break;case'Value':p1=o1[s1];break;default:if(!r1){r1={};}r1[s1]=o1[s1];}}if(r1){r1.Value=p1;return{name:q1,value:r1};}else{return{name:q1,value:p1};}};var h=function(o1){if(!o1.NamedValues){return o1;}var p1={};for(var i=0;i<o1.NamedValues.length;++i){var q1=o1.NamedValues[i];var r1=d(q1);p1[r1.name]=r1.value;}return p1;};var j=new n({keyFunction:k,formatFunction:h});for(var i=0;i<a.Cells.length;++i){var o=a.Cells[i];var s=o.Index[0];var v=this.resolve(r,s);var z=o.Index[1];var m1=this.resolve(c,z);m1=[f.extend({},m1[0])];m1[0].cell=o;var n1=v;n1.push.apply(n1,m1);j.insert(n1);}return j;},resolve:function(a,c){var d=[];if(a.Tuples.length===0){return d;}var h=a.Tuples[c];for(var i=0;i<h.length;++i){var j=h[i];var k=a.Dimensions[i].ItemList.Items[j];k.__key=j;d.push(k);}return d;},enhance:function(r){var a={};for(var i=0;i<r.ItemLists.length;++i){var c=r.ItemLists[i];a[c.Name]=c;}for(var h=0;h<r.Grids.length;++h){var d=r.Grids[h];for(var j=0;j<d.Axes.length;++j){var o=d.Axes[j];for(var k=0;k<o.Dimensions.length;++k){var s=o.Dimensions[k];s.ItemList=a[s.ItemListName];}}}}};var n=function(){this.init.apply(this,arguments);};n.prototype={init:function(o){this.root={data:'root',subTree:{},children:[]};if(o&&o.keyFunction){this.keyFunction=o.keyFunction;}else{this.keyFunction=function(a){return a;};}if(o&&o.formatFunction){this.formatFunction=o.formatFunction;}else{this.formatFunction=function(a){return a;};}},insert:function(a){var c=this.root;for(var i=0;i<a.length;++i){var d=a[i];var k=this.keyFunction(d);var h=this.formatFunction(d);if(!c.subTree.hasOwnProperty(k)){var j={subTree:{},children:[],data:d,dataFormatted:h};c.subTree[k]=j;c.children.push(j);}c=c.subTree[k];}},toString:function(){var s=[];this.toStringHelper(this.root,[],s);return s.join('');},toStringHelper:function(a,c,s){var d=null;if(a===this.root){d=a.data;}else{d=this.keyFunction(a.data);}c.push(d);var h=false;for(var i in a.subTree){if(a.subTree.hasOwnProperty(i)){h=true;var j=a.subTree[i];var k=c.slice(0);this.toStringHelper(j,k,s);}}if(!h){s.push(c.toString()+'\n');}}};m.ABAPChartQuery=function(){this.init.apply(this,arguments);};m.ABAPChartQuery.prototype=f.extend({},H.ChartQuery.prototype,e.Query.prototype,{init:function(a){a=a||{};e.Query.prototype.init.apply(this,[a]);H.ChartQuery.prototype.init.apply(this,[a]);this.dimensions=[];this.attributeLimit=a.attributeLimit||1000;if(Object.prototype.toString.call(a.dimensions)==='[object Array]'){this.dimensions=a.dimensions;}else if(a.dimension){this.dimensions.push(a.dimension);}this.resultSetClass=m.ABAPChartResultSet;},getTitle:function(){if(this.resultSet&&this.resultSet.title){return this.resultSet.title;}else{return'unkown title';}},addDimension:function(d){this.dimensions.push(d);},setAttributeLimit:function(a){this.attributeLimit=a;},createJsonRequest:function(){var a=b.getABAPChartRequest();a.DataSource=this.filter.dataSource.getDataForRequest();a.Search.SearchTerms=this.filter.getSearchTerms();a.Search.Filter=this.filter.getDataForRequest();a.Search.Top=this.getTop();a.Search.Skip=this.getSkip();a.Facets.Attributes=this.dimensions;a.Facets.MaxNumberOfReturnValues=this.attributeLimit;a.Options=a.Options.concat(this.options);return a;}});m.ABAPChartResultSet=function(){this.init.apply(this,arguments);};m.ABAPChartResultSet.prototype={init:function(a){this.properties=a||{};this.dimensions=[];this.elements=[];},setJsonFromResponse:function(d){var a=new l.Perspective(this.properties);a.setJsonFromResponse(d);for(var i=0;i<a.chartFacets.length;i++){if(a.chartFacets[i].dimension==='$$DataSources$$')continue;this.dimensions.push(a.chartFacets[i].dimension);this.elements.push.apply(this.elements,a.chartFacets[i].query.resultSet.elements);this.title=a.chartFacets[i].title;break;}}};m.ChartQuery=function(){this.init.apply(this,arguments);};m.ChartQuery.prototype=f.extend({},H.ChartQuery.prototype,e.Query.prototype,{init:function(a){a=a||{};e.Query.prototype.init.apply(this,[a]);H.ChartQuery.prototype.init.apply(this,[a]);this.dimensions={};this.dimensions.CustomDimension1={Axis:'Columns',Name:'CustomDimension1',Members:[]};a.dimensions=a.dimensions||{};if(Object.prototype.toString.call(a.dimensions)==='[object Array]'){for(var i=0;i<a.dimensions.length;i++){this.addDimension(a.dimensions[i]);}}else if(typeof a.dimensions==='string'||typeof a.dimensions==='object'){this.addDimension(a.dimensions);}a.measures=a.measures||{};if(Object.prototype.toString.call(a.measures)==='[object Array]'){for(var j=0;j<a.measures.length;j++){this.addMeasure(a.measures[j]);}}else if(typeof a.measures==='object'){this.addMeasure(a.measures);}this.resultSetClass=m.ChartResultSet;},createJsonRequest:function(){var a=b.getChartRequest();a.DataSource=this.filter.dataSource.getDataForRequest();a.SearchTerms=this.filter.getSearchTerms();a.Analytics.Definition.Filter=this.filter.getDataForRequest();a.Analytics.Definition.Dimensions=[];for(var d in this.dimensions){a.Analytics.Definition.Dimensions.push(this.dimensions[d]);}return a;},count:function(d){this.addMeasure({name:d,aggregationFunction:'COUNT'});return this;},addMeasure:function(a){if(Object.keys(a).length===0){return{};}var c;if(a.aggregationFunction.toUpperCase()==='COUNT'||a.aggregationFunction.toUpperCase()==='AVG'){c=this._createAggregationDimension(a.aggregationFunction,a.name,a.aggregationFunction,a.sortOrder||undefined,a.top||undefined);}else{c=this._createAggregationDimension(a.aggregationFunction,'',a.name,a.sortOrder,a.top);delete c.AggregationDimension;delete c.Name;delete c.SortOrder;}this.dimensions.CustomDimension1.Members.push(c);return this;},addDimension:function(d,s,a){if(typeof d==='object'){if(Object.keys(d).length===0){return{};}this.dimensions[d.name]=this._createDimension(d.name,null,d.sortOrder,d.top);}else if(typeof d==='string'){if(!d){return{};}this.dimensions[d]=this._createDimension(d,null,s,a);}return this;},_createDimension:function(d,a,s,c){return{'Axis':a||'Rows','Name':d,'SortOrder':s||1,'Top':c||5};},_createAggregationDimension:function(a,c,d,s){return{'Aggregation':a,'AggregationDimension':c,'MemberOperand':{'AttributeName':'Measures','Comparison':'=','Value':d},'Name':d,'SortOrder':s||2};}});m.ChartResultSet=function(){this.init.apply(this,arguments);};m.ChartResultSet.prototype={init:function(a){a=a||{};this.type=a.type;this.elements=[];this.sina=a.sina;},_parseNamedValues:function(a,c,d){var h=this;for(var i=0;i<c.length;i++){var j=c[i].Name;var v=c[i].Value;a.label=c[i].ValueFormatted;a.labelRaw=c[i].Value;switch(j){case'$$DataSource$$':h._parseNamedValuesForDataSource(a,v);break;case'$$AttributeValue$$':h._parseNamedValuesForRange(a,v,d);break;}}},_parseNamedValuesForRange:function(a,v,c){var h,i,j;for(var d=0;d<v.length;++d){var k=v[d];switch(k.Name){case'ValueID':a.label=k.ValueFormatted;h=k.Value;break;case'Value1':if(c.Cube.ObjectName&&k.Value!==undefined){i=this.sina.createFilterCondition(c.Cube.ObjectName,'>=',k.Value,c.Cube.Description,k.ValueFormatted,k.ValueFormatted);}break;case'Value2':if(c.Cube.ObjectName&&k.Value!==undefined){j=this.sina.createFilterCondition(c.Cube.ObjectName,'<=',k.Value,c.Cube.Description,k.ValueFormatted,k.ValueFormatted);}break;case'Order':break;}}if(h){if(i&&j){var o=this.sina.createFilterConditionGroup();o.setOperator('AND');o.setLabel(a.label);if(i.value){o.addCondition(i);}if(j.value){o.addCondition(j);}a.labelRaw=o;}else if(i&&i.value&&!j){i.operator='=';a.labelRaw=i;}else if(j&&j.value&&!i){j.operator='=';a.labelRaw=j;}}},_parseNamedValuesForDataSource:function(a,v){a.dataSource=this.sina.createDataSource();for(var d=0;d<v.length;++d){var c=v[d];switch(c.Name){case'ObjectName':var h=c.ValueFormatted;a.dataSource.setLabel(h);a.dataSource.setObjectName(c.Value,c.ValueFormatted);break;case'PackageName':a.dataSource.setPackageName(c.Value,c.ValueFormatted);break;case'SchemaName':a.dataSource.setSchemaName(c.Value,c.ValueFormatted);break;case'Type':a.dataSource.setType(c.Value,c.ValueFormatted);break;default:a[c.Name]=c.Value;break;}}},setJsonFromResponse:function(d){this.elements=[];var h;if(d.Metadata){h=d.Metadata;}if(d.ResultSet){d=d.ResultSet;}var k={};for(var i=0;i<d.ItemLists.length;i++){k[d.ItemLists[i].Name]=d.ItemLists[i];}for(var a=0;a<d.Grids.length;a++){var o=d.Grids[a].Axes;var r=d.Grids[a].Cells;for(var s=0;s<r.length;++s){if(o[0].Dimensions.length===1){var v=r[s];var z={valueRaw:v.Value||v.ValueFormatted||null,value:v.ValueFormatted||v.Value||null};for(var j=0;j<1;j++){var m1=v.Index[j];var n1=o[j].Tuples[m1];if(n1===undefined){continue;}for(var c=0;c<n1.length;c++){var o1=o[j].Dimensions[c];var p1=n1[c];var q1=k[o1.ItemListName];var r1=q1.Items[p1].NamedValues;this._parseNamedValues(z,r1,h);}}this.elements.push(z);}}}},getElements:function(){return this.elements;}};m.GroupBarChartQuery=function(){this.init.apply(this,arguments);};m.GroupBarChartQuery.prototype=f.extend({},m.ChartQuery.prototype,{init:function(a){a=a||{};m.ChartQuery.prototype.init.apply(this,[a]);this.resultSetClass=m.GroupBarChartResultSet;}});m.GroupBarChartResultSet=function(){this.init.apply(this,arguments);};m.GroupBarChartResultSet.prototype={init:function(a){a=a||{};this.elements=[];},setJsonFromResponse:function(d){var a=this;this.elements=[];var r=new ResultSetParser({resultSet:d});var c=r.parse();function h(s,i){for(var j in s){var k=s[j];var o={label:k.data.NamedValues[0].ValueFormatted,value:[]};if(k.data.cell){o.value={value:k.data.cell.ValueFormatted,valueRaw:k.data.cell.Value};}if(i){i.value.push(o);}else{a.elements.push(o);}if(k.subTree){h(k.subTree,o);}}}h(c.root.subTree);},getElements:function(){return this.elements;}};m.LineChartQuery=function(){this.init.apply(this,arguments);};m.LineChartQuery.prototype=f.extend({},m.ChartQuery.prototype,{init:function(a){a=a||{};m.ChartQuery.prototype.init.apply(this,[a]);this.resultSetClass=m.LineChartResultSet;}});m.LineChartResultSet=function(){this.init.apply(this,arguments);};m.LineChartResultSet.prototype=f.extend({},m.GroupBarChartResultSet.prototype,{init:function(a){a=a||{};this.elements=[];},setJsonFromResponse:function(d){var a=this;this.elements=[];var r=new ResultSetParser({resultSet:d});var c=r.parse();function h(s,i){for(var j in s){var k=s[j];var o={label:k.data.NamedValues[0].ValueFormatted,value:[]};for(var v in k.subTree){var z=k.subTree[v];var m1={x:z.data.NamedValues[0].ValueFormatted};for(var n1 in z.subTree){var o1=z.subTree[n1];m1.y=o1.data.cell.Value;}o.value.push(m1);}a.elements.push(o);}}h(c.root.subTree);},getElements:function(){return this.elements;}});return m;}(H,t,E,K,f);M=function(g,y,c,e,h,m,n,f){var r={};var s=function(a){switch(a){case g.SuggestionType.HISTORY:return'SuggestSearchHistory';case g.SuggestionType.OBJECTDATA:return'SuggestObjectData';case g.SuggestionType.DATASOURCE:return'SuggestDataSources';default:throw'Unknown suggestion type '+a;}};var v=function(a){switch(a){case'SearchHistory':return g.SuggestionType.HISTORY;case'ObjectData':return g.SuggestionType.OBJECTDATA;case'DataSources':return g.SuggestionType.DATASOURCE;default:return g.SuggestionType.OBJECTDATA;}};r.Suggestion=function(){this.init.apply(this,arguments);};r.SuggestionAutoQuery=function(a){if(a.system instanceof m.ABAPSystem){f.extend(this,r.Suggestion2Query.prototype);}if(a.system instanceof m.HANASystem){f.extend(this,r.SuggestionQuery.prototype);}this.init.apply(this,arguments);};r.SuggestionQuery=function(){this.init.apply(this,arguments);};r.SuggestionQuery.prototype=f.extend({},y.SuggestionQuery.prototype,h.Query.prototype,{init:function(a){a=a||{};this.attributes=a.attributes||[];h.Query.prototype.init.apply(this,arguments);y.SuggestionQuery.prototype.init.apply(this,arguments);this.resultSetClass=r.SuggestionResultSet;},addResponseAttribute:function(a){this.attributes.push(a);this._resetResultSet();return this;},setResponseAttributes:function(a){this.attributes=a;this._resetResultSet();return this;},createJsonRequest:function(){var a=e.getSuggestionRequest();a.Suggestions.Precalculated=false;var b=this.filter.getSearchTerms();if(this.attributes.length===0){throw'add at least one response attribute to your query';}a.Suggestions.SearchTerms=b;a.Suggestions.AttributeNames=this.attributes;a.DataSource=this.filter.dataSource.getDataForRequest();a.Suggestions.Top=this._top;var u=this.filter.getDataForRequest();if(u&&u.Selection){a.Suggestions.Filter=u;}return a;}});r.SuggestionResultSet=function(){this.init.apply(this,arguments);};r.SuggestionResultSet.prototype={init:function(){this.suggestions=[];},setJsonFromResponse:function(j){this.suggestions=[];var k={};for(var i=0;i<j.ItemLists.length;i++){k[j.ItemLists[i].Name]=j.ItemLists[i];}for(var a=0;a<k.Suggestions.Items.length;a++){var l=k.Suggestions.Items[a],z='',m1='',n1='';var o1={};for(var d=0;d<l.NamedValues.length;++d){var p1=l.NamedValues[d];switch(p1.Name){case'Term':z=p1.Value;o1.label=z;break;case'AttributeName':m1=p1.Value;o1.attribute=m1;break;case'$$AttributeDescription$$':n1=p1.Value;o1.attributeDescription=n1;break;case'Score':var q1=p1.Value;o1.score=parseInt(q1,10);break;}}this.suggestions.push(o1);}this.suggestions.sort(function(a,b){return b.score-a.score;});for(var o=this.suggestions.length-1;o>=0;o--){delete this.suggestions[o].score;}},getElements:function(){return this.suggestions;}};r.Suggestion2Query=function(){this.init.apply(this,arguments);};r.Suggestion2Query.prototype=f.extend({},y.SuggestionQuery.prototype,h.Query.prototype,{init:function(a){a=a||{};this.attributes=a.attributes||[];h.Query.prototype.init.apply(this,[a]);y.SuggestionQuery.prototype.init.apply(this,[a]);this.resultSetClass=r.Suggestion2ResultSet;this.suggestionTerm=a.suggestionTerm||'';this.options=[];},addResponseAttribute:function(a){this.attributes.push(a);this._resetResultSet();return this;},setSuggestionTerm:function(a){if(this.suggestionTerm!==a){this.suggestionTerm=a;this._resetResultSet();}return this;},setResponseAttributes:function(a){this.attributes=a;this._resetResultSet();return this;},createJsonRequest:function(){var a=e.getSuggestion2Request();a.Suggestions2.Precalculated=false;a.Suggestions2.NamedValues=[];for(var i=0;i<this.attributes.length;i++){a.Suggestions2.NamedValues.push({AttributeName:this.attributes[i],Name:this.attributes[i]});}a.DataSource=this.filter.dataSource.getDataForRequest();a.Suggestions2.Top=this.getTop();a.Suggestions2.Skip=this.getSkip();var b=this.sina.createFilterConditionGroup();this.splittedSuggestionTerm=this.splitSuggestionTerm(this.suggestionTerm);if(this.splittedSuggestionTerm.searchTerm){var d=this.sina.createFilterCondition('$$SearchTerms$$','contains',this.splittedSuggestionTerm.searchTerm);b.addCondition(d);}var k=this.sina.createFilterCondition('$$SuggestionTerms$$','contains',this.splittedSuggestionTerm.suggestionTerm);b.addCondition(k);b.addCondition(this.getFilter().getFilterConditions());a.Suggestions2.Filter=b.getDataForRequest();a.Options=this.options.slice();var l=[];for(var j=0;j<this.suggestionTypes.length;j++){l.push(s(this.suggestionTypes[j]));}a.Options.push.apply(a.Options,l);return a;},splitSuggestionTerm:function(a){var b=a.lastIndexOf(' ');if(b<0){return{searchTerm:null,suggestionTerm:a};}var d=a.slice(0,b);d=d.replace(/\s+$/,'');if(d.length===0){return{searchTerm:null,suggestionTerm:a};}var i=a.slice(b);i=i.replace(/^\s+/,'');if(i.length===0){return{searchTerm:null,suggestionTerm:a};}return{searchTerm:d,suggestionTerm:i};}});r.Suggestion2ResultSet=function(){this.init.apply(this,arguments);};r.Suggestion2ResultSet.prototype={init:function(a){this.datasources={};this.suggestions=[];this.sina=a.sina;this.query=a.query;},parseSuggestion:function(a,b){var d={label:b.dataFormatted.$$Term$$.ValueFormatted,labelRaw:b.dataFormatted.$$Term$$.Value,dataSource:this.query.getDataSource(),type:a,children:[]};if(this.query.getDataSource().type==='Category'||a===g.SuggestionType.HISTORY){this.suggestions.push(d);}if(a===g.SuggestionType.HISTORY){return;}for(var j=1;j<b.children.length;++j){var i=b.children[j];var k=this.sina.createDataSource({type:c.DataSourceType.BUSINESSOBJECT,objectName:i.dataFormatted.$$DataSource$$,label:i.dataFormatted.$$DataSourceDescription$$});var l={label:b.dataFormatted.$$Term$$.ValueFormatted,labelRaw:b.dataFormatted.$$Term$$.Value,dataSource:k,type:d.type};if(this.query.getDataSource().type==='Category'){d.children.push(l);}else{this.suggestions.push(l);}}},parseDataSourceSuggestion:function(a){var d=this.sina.createDataSource({type:c.DataSourceType.BUSINESSOBJECT,objectName:a.dataFormatted.$$Term$$.Value,label:f.removeHtmlTags(a.dataFormatted.$$Term$$.ValueFormatted)});var b={label:a.dataFormatted.$$Term$$.ValueFormatted,labelRaw:d,dataSource:d,type:g.SuggestionType.DATASOURCE,children:[]};this.suggestions.push(b);},setJsonFromResponse:function(d){if(!d.Grids||!d.Grids[0]||!d.Grids[0].Axes){return;}var a=new n.ResultSetParser({resultSet:d});var b=a.parse();for(var i=0;i<b.root.children.length;++i){var j=b.root.children[i];var k=v(j.dataFormatted.$$Term$$.Scope);switch(k){case g.SuggestionType.OBJECTDATA:this.parseSuggestion(k,j);break;case g.SuggestionType.HISTORY:this.parseSuggestion(k,j);break;case g.SuggestionType.DATASOURCE:this.parseDataSourceSuggestion(j);break;}}},getElements:function(){this.concatenateSearchTerm(this.suggestions,this.query.splittedSuggestionTerm);return this.suggestions;},escapeRegExp:function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,'\\$&');},concatenateSearchTerm:function(a,b){var d=this;if(!b.searchTerm){return;}var o=[];var z=b.searchTerm.split(' ');for(var k=0;k<z.length;k++){var m1=z[k];m1=m1.trim();o.push({term:m1,regExp:new RegExp(d.escapeRegExp(m1),'i')});}for(var i=0;i<a.length;++i){var n1=a[i];var o1=[];for(var j=0;j<o.length;++j){var p1=o[j];if(!p1.regExp.test(n1.labelRaw)){o1.push(p1.term);}}var q1=[];var r1=o1.join(' ');for(var l=0;l<o1.length;l++){var m1=o1[l];q1.push('<b>'+m1+'</b>');}q1=q1.join(' ');n1.label=q1+' '+n1.label;n1.labelRaw=r1+' '+n1.labelRaw;if(n1.children&&n1.children.length>0){this.concatenateSearchTerm(n1.children,b);}}}};return r;}(g,y,x,t,E,D,L,f);N=function(g,J,c,s,f){var e={};e.Facet=function(){this.init.apply(this,arguments);};e.Facet.prototype=f.extend({},J.Facet.prototype,{setJsonFromResponse:function(d){if(this.facetType===g.FacetType.DATASOURCE){this.query=this.sina.createChartQuery();this.query.resultSet=new c.ChartResultSet({sina:this.sina});}else if(this.facetType===g.FacetType.ATTRIBUTE){this.query=this.sina.createChartQuery();this.query.resultSet=new c.ChartResultSet({sina:this.sina});}else if(this.facetType===g.FacetType.SEARCH){this.query=this.sina.createSearchQuery();this.query.resultSet=new s.SearchResultSet({sina:this.sina});}this.query.resultSet.setJsonFromResponse(d);this._parseServerSideFacetMetaData(d.Metadata);},_parseServerSideFacetMetaData:function(d){if(d&&d.Cube){this.title=d.Cube.Description;this.dimension=d.Cube.ObjectName;}}});return e;}(g,J,L,F,f);O=function(x,f){var e={};e.MetaDataService=function(){this.init.apply(this,arguments);};e.MetaDataService.prototype={init:function(a){a=a||{};this.allInOneMap={};this.allInOneMap.dataSourceList=[];this.allInOneMap.dataSourceMap={};this.dataSourcesDeferred=null;this.allInOneMap.businessObjectList=[];this.allInOneMap.businessObjectMap={};this.businessObjectsDeferred=null;},getDataSources:function(a){var b=this;return b._fillDataSourcesBuffer(a).then(function(){return b.allInOneMap.dataSourceList;});},getDataSourcesSync:function(a){var b=this;b._fillDataSourcesBufferSync(a);return b.allInOneMap.dataSourceList;},getDataSource:function(a,d){var b=this;if(!d){throw'data source is missing';}if(!d.objectName){throw'data source\'s objectName is missing';}if(!d.packageName){throw'data source\'s packageName is missing';}if(!d.type){throw'data source\'s type is missing';}return b._fillDataSourcesBuffer(a).then(function(){return b.allInOneMap.dataSourceMap[d.key];});},getDataSourceByBusinessObjectName:function(a,d){var b=this;if(!d){throw'datasource key missing';}return b._fillDataSourcesBuffer(a).then(function(){return b.allInOneMap.dataSourceMap[d];});},getDataSourceSync:function(a,d){var b=this;if(!d){throw'data source is missing';}if(!d.objectName){throw'data source\'s objectName is missing';}if(!d.packageName){throw'data source\'s packageName is missing';}if(!d.type){throw'data source\'s type is missing';}b._fillDataSourcesBufferSync(a);return b.allInOneMap.dataSourceMap[d.key];},getDataSourceSyncByBusinessObjectName:function(a,d){var b=this;if(!d){throw'datasource key missing';}b._fillDataSourcesBufferSync(a);return b.allInOneMap.dataSourceMap[d];},_fillDataSourcesBuffer:function(a){var b=this;if(b.dataSourcesDeferred){return b.dataSourcesDeferred;}b.dataSourcesDeferred=f.Deferred();if(b.allInOneMap.dataSourceList.length!==0){b.dataSourcesDeferred.resolve(b.allInOneMap.dataSourceList);return b.dataSourcesDeferred;}a.top=a.top||1000;var d=new x.DataSourceQuery(a);var c=d.getResultSet();c.done(function(r){b._extractDataSources(a,r);b.dataSourcesDeferred.resolve(b.allInOneMap.dataSourceList);});c.fail(function(h){d=new x.ESHConnectorDataSourceQuery(a);d.getResultSet().then(function(r){b._extractESHConnectorDataSources(a,r);b.dataSourcesDeferred.resolve(b.allInOneMap.dataSourceList);},function(h){b.dataSourcesDeferred.reject(h);b.dataSourcesDeferred=null;});});return b.dataSourcesDeferred;},_fillDataSourcesBufferSync:function(a){var b=this;if(b.allInOneMap.dataSourceList.length!==0){return;}a.top=a.top||1000;var d=new x.DataSourceQuery(a);var r=d.getResultSetSync();if(r.elements.length!==0){b._extractDataSources(a,r);}else{d=new x.ESHConnectorDataSourceQuery(a);r=d.getResultSetSync();b._extractESHConnectorDataSources(a,r);}},_extractDataSources:function(a,r){var b=this;var c=r.getElements();for(var i=0;i<c.length;++i){var d=c[i];if(d.Type.value.toLowerCase()!=='category'){var l=d.Description.value===null?d.ObjectName.value:d.Description.value;var h=d.DescriptionPlural===undefined||d.DescriptionPlural.value===null?l:d.DescriptionPlural.value;var j=a.sina.createDataSource({objectName:{label:d.ObjectName.value,value:d.ObjectName.value},packageName:{label:'ABAP',value:'ABAP'},schemaName:'',type:'View',label:l,labelPlural:h});var k=j.key;if(!(k in b.allInOneMap.dataSourceMap)){b.allInOneMap.dataSourceList.push(j);b.allInOneMap.dataSourceMap[k]=j;}}}b._setRemoteSystemName();},_extractESHConnectorDataSources:function(a,r){var b=this;var c=r.getElements();for(var i=0;i<c.length;++i){var d=c[i];if(d.$$DataSourceMetaData$$.type.toLowerCase()!=='category'){var l=d.DESCRIPTION.value===null?d.OBJECT_NAME.value:d.DESCRIPTION.value;var h=d.DESCRIPTIONPLURAL===undefined||d.DESCRIPTIONPLURAL.value===null?l:d.DESCRIPTIONPLURAL.value;var j=a.sina.createDataSource({objectName:{label:d.OBJECT_NAME.value,value:d.OBJECT_NAME.value},packageName:{label:'ABAP',value:'ABAP'},schemaName:'',type:'View',label:l,labelPlural:h});var k=j.key;if(!(k in b.allInOneMap.dataSourceMap)){b.allInOneMap.dataSourceList.push(j);b.allInOneMap.dataSourceMap[k]=j;}}}b._setRemoteSystemName();},_setRemoteSystemName:function(){var a=this;var k='';var b='';var l='';var c='';var d='';var h='';var s='';var j='';var m='';var n='';for(var i=0;i<a.allInOneMap.dataSourceList.length-1;i++){if(a.allInOneMap.dataSourceList[i].labelPlural===a.allInOneMap.dataSourceList[i+1].labelPlural){if(!a.allInOneMap.dataSourceList[i].isLabelProcessed){k=a.allInOneMap.dataSourceList[i].key;l=a.allInOneMap.dataSourceList[i].label;c=a.allInOneMap.dataSourceList[i].labelPlural;s=a.allInOneMap.dataSourceList[i].objectName.value.substr(0,3);m=a.allInOneMap.dataSourceList[i].objectName.value.substr(3,3);}if(!a.allInOneMap.dataSourceList[i+1].isLabelProcessed){b=a.allInOneMap.dataSourceList[i+1].key;d=a.allInOneMap.dataSourceList[i+1].label;h=a.allInOneMap.dataSourceList[i+1].labelPlural;j=a.allInOneMap.dataSourceList[i+1].objectName.value.substr(0,3);n=a.allInOneMap.dataSourceList[i+1].objectName.value.substr(3,3);}if(s!==j){l=l+' ('+s+')';c=c+' ('+s+')';d=d+' ('+j+')';h=h+' ('+j+')';}else{l=l+' ('+s+':'+m+')';c=c+' ('+s+' '+m+')';d=d+' ('+j+':'+n+')';h=h+' ('+j+' '+n+')';}if(!a.allInOneMap.dataSourceList[i].isLabelProcessed){a.allInOneMap.dataSourceList[i].label=l;a.allInOneMap.dataSourceList[i].labelPlural=c;a.allInOneMap.dataSourceList[i].isLabelProcessed=true;a.allInOneMap.dataSourceMap[k].label=l;a.allInOneMap.dataSourceMap[k].labelPlural=c;a.allInOneMap.dataSourceMap[k].isLabelProcessed=true;}if(!a.allInOneMap.dataSourceList[i+1].isLabelProcessed){a.allInOneMap.dataSourceList[i+1].label=d;a.allInOneMap.dataSourceList[i+1].labelPlural=h;a.allInOneMap.dataSourceList[i+1].isLabelProcessed=true;a.allInOneMap.dataSourceMap[b].label=d;a.allInOneMap.dataSourceMap[b].labelPlural=h;a.allInOneMap.dataSourceMap[b].isLabelProcessed=true;}}}},getBusinessObjectsMetaData:function(a){var b=this;return b.getDataSources(a).then(function(){return b._fillBusinessObjectsBuffer().then(function(){return b.allInOneMap.businessObjectList;});});},getBusinessObjectsMetaDataSync:function(a){var b=this;b.getDataSourcesSync(a);b._fillBusinessObjectsBufferSync();return this.allInOneMap.businessObjectList;},getBusinessObjectMetaData:function(a,d){var b=this;if(!d){throw'data source is missing';}if(!d.objectName){throw'data source\'s objectName is missing';}if(!d.packageName){throw'data source\'s packageName is missing';}if(!d.type){throw'data source\'s type is missing';}return b.getDataSource(a,d).then(function(){return b._fillBusinessObjectBuffer(a,d.key).then(function(){return b.allInOneMap.businessObjectMap[d.key];});});},getBusinessObjectMetaDataByBusinessObjectName:function(d){var a=this;if(!d){throw'datasource key missing';}return a.getDataSourceByBusinessObjectName(d).then(function(){return a._fillBusinessObjectBuffer(properties,d).then(function(){return a.allInOneMap.businessObjectMap[d];});});},getBusinessObjectMetaDataSync:function(a,d){var b=this;if(!d){throw'data source is missing';}if(!d.objectName){throw'data source\'s objectName is missing';}if(!d.packageName){throw'data source\'s packageName is missing';}if(!d.type){throw'data source\'s type is missing';}b.getDataSourceSync(a,d);b._fillBusinessObjectBufferSync(a,d.key);return b.allInOneMap.businessObjectMap[d.key];},getBusinessObjectMetaDataSyncByBusinessObjectName:function(a,d){var b=this;if(!d){throw'datasource key missing';}b.getDataSourceSyncByBusinessObjectName(a,d);b._fillBusinessObjectBufferSync(a,d);return b.allInOneMap.businessObjectMap[d];},_fillBusinessObjectsBuffer:function(a){var b=this;if(b.businessObjectsDeferred){return b.businessObjectsDeferred;}b.businessObjectsDeferred=f.Deferred();if(b.allInOneMap.businessObjectList.length!==0){b.dataSourcesDeferred.resolve(b.allInOneMap.businessObjectList);return b.dataSourcesDeferred;}var d=b.allInOneMap.dataSourceList;var c=[];for(var i=0;i<d.length;i++){c.push(b._businessObjectDeffered(a,d[i].key));}f.when.apply(null,c).then(function(){b.businessObjectsDeferred.resolve(b.allInOneMap.businessObjectList);},function(h){b.businessObjectsDeferred=null;b.businessObjectsDeferred.reject(h);});return b.businessObjectsDeferred;},_businessObjectDeffered:function(a,k){var b=this;var j=a.sina.getSystem().proxy.ajax(b._parseMetaDataRequest(a,true,b.allInOneMap.dataSourceMap[k]));return j.then(function(r){var c=b._parseMetaDataResponse(r);b._setMetaData(k,c);return f.when(true);},function(c){return f.when(false);});},_fillBusinessObjectsBufferSync:function(a){var b=this;if(b.allInOneMap.businessObjectList.length!==0){return;}var d=b.allInOneMap.dataSourceList;for(var i=0;i<d.length;i++){if(!(d[i].key in b.allInOneMap.businessObjectMap)){b._fillBusinessObjectBufferSync(a,d[i].key);}}},_fillBusinessObjectBuffer:function(a,k){var b=this;var c=f.Deferred();if(b.allInOneMap.businessObjectMap[k]!==undefined&&b.allInOneMap.businessObjectMap[k].hasFulltextIndex!==undefined){c.resolve(b.allInOneMap.businessObjectMap[k]);return c;}var j=a.sina.getSystem().proxy.ajax(b._parseMetaDataRequest(a,true,b.allInOneMap.dataSourceMap[k]));j.then(function(r){var d=b._parseMetaDataResponse(r);b._setMetaData(k,d);c.resolve(b.allInOneMap.businessObjectMap[k]);},function(d){c=null;c.reject(d);});return c;},_fillBusinessObjectBufferSync:function(a,k){var b=this;var r=false;if(b.allInOneMap.businessObjectMap[k]===undefined){r=true;}else if(b.allInOneMap.businessObjectMap[k].fullTextIndexChecked===undefined||b.allInOneMap.businessObjectMap[k].fullTextIndexChecked===false){r=true;b.allInOneMap.businessObjectMap[k].fullTextIndexChecked=true;}else{r=false;}if(!r){return;}var d=b.allInOneMap.dataSourceMap[k];var j=a.sina.getSystem().proxy.ajax(b._parseMetaDataRequest(a,false,d));var c=$.parseJSON(j.responseText);if(!c.Error){var h=b._parseMetaDataResponse(c);b._setMetaData(d.key,h);}},_parseMetaDataRequest:function(a,i,d){var b={ObjectName:d.objectName.value,PackageName:d.packageName.value,SchemaName:d.schemaName.value,Type:d.type.value};var r={async:i,url:a.sina.getSystem().inaUrl,processData:false,contentType:'application/json',dataType:'json',data:{'DataSource':b,'Options':['SynchronousRun'],'Metadata':{'Context':'Search','Expand':['Cube']},'ServiceVersion':204},success:function(c){}};return r;},_parseMetaDataResponse:function(a){var b={};if(!a.Cube||!a.Cube.Dimensions){return b;}for(var i=0;i<a.Cube.Dimensions.length;i++){for(var j=0;j<a.Cube.Dimensions[i].Attributes.length;j++){var k=a.Cube.Dimensions[i].Attributes[j].Name;if(k===undefined||k===''||k.indexOf('$$')>-1){continue;}b[k]={displayOrder:a.Cube.Dimensions[i].Attributes[j].DisplayOrder||0,isTitle:$.inArray('Title',a.Cube.Dimensions[i].Attributes[j].presentationUsage)>-1?true:false,isKey:a.Cube.Dimensions[i].Attributes[j].IsKey,label:a.Cube.Dimensions[i].Attributes[j].Description||'',labelRaw:k,presentationUsage:a.Cube.Dimensions[i].Attributes[j].presentationUsage||[],accessUsage:a.Cube.Dimensions[i].Attributes[j].accessUsage||[],type:a.Cube.Dimensions[i].Attributes[j].DataType||'',hasFulltextIndex:a.Cube.Dimensions[i].Attributes[j].hasFulltextIndex||undefined};var h=b[k].hasFulltextIndex||false;if(h){b[k].type='Text';}}}return b;},setBusinessObjectMetaDataSync:function(x,d){var a=this;if(a.allInOneMap.businessObjectMap[x.key]){return;}var b={};for(var c in d){if(c.indexOf('$$')>-1||c==='title'||typeof d[c]==='function'||!d[c]||!d[c].$$MetaData$$){continue;}var h=d[c];var m=h.$$MetaData$$;var n={labelRaw:c,label:m.description,type:m.dataType,isTitle:m.isTitle,isKey:m.isKey,presentationUsage:m.presentationUsage,accessUsage:m.accessUsage,displayOrder:m.displayOrder,hasFulltextIndex:m.hasFulltextIndex||undefined};var i=n.hasFulltextIndex||false;if(i){n.type='Text';}b[c]=n;}a._setMetaData(x.key,b);},_setMetaData:function(k,a){var b=this;var c;if(b.allInOneMap.businessObjectMap[k]&&b.allInOneMap.businessObjectMap[k].fullTextIndexChecked!==undefined){c=b.allInOneMap.businessObjectMap[k].fullTextIndexChecked;}else{c=false;}b.allInOneMap.businessObjectMap[k]={attributeMap:{},fullTextIndexChecked:c};b.allInOneMap.businessObjectMap[k].attributeMap=a;b.allInOneMap.businessObjectList.push(a);}};return e;}(G,f);P=function(f){var e={};e.EventLoggingService=function(){this.init.apply(this,arguments);};e.EventLoggingService.prototype={init:function(a){a=a||{};this.sina=a.sina;},logEvent:function(a){},logEvents:function(a){},createEventLoggingTimestamp:function(){var d=new Date();return''+d.getUTCFullYear()+f.pad(d.getUTCMonth()+1,2)+f.pad(d.getUTCDate(),2)+f.pad(d.getUTCHours(),2)+f.pad(d.getUTCMinutes(),2)+f.pad(d.getUTCSeconds(),2)+f.pad(d.getUTCMilliseconds(),3);}};return e;}(f);Q=function(e,f){var a={};a.EventLoggingService=function(){this.init.apply(this,arguments);};a.EventLoggingService.prototype=f.extend({},e.EventLoggingService.prototype,{init:function(b){e.EventLoggingService.prototype.init.apply(this,arguments);this.sessionId=f.createGuid();this.logEvent({type:'SESSION_START'});},logEvent:function(b){if(!b.timestamp){b.timestamp=this.createEventLoggingTimestamp();}this.logEvents([b]);},formatEvent:function(b){if(!b.timestamp){throw'timestamp missing for logging event!';}if(!b.type){throw'type missing for logging event!';}var r={Type:b.type,Timestamp:b.timestamp,ParameterList:[]};if(b.executionId){r.executionID=b.executionId;}for(var n in b){if(['executionId','type','timestamp'].indexOf(n)>=0){continue;}r.ParameterList.push({Name:n,Value:b[n]});}return r;},logEvents:function(b){var c=this;var r=[];for(var i=0;i<b.length;++i){var d=b[i];r.push(this.formatEvent(d));}this.sina.getSystem().getServerInfo().then(function(s){if(!c.isEnabled(s)){return;}c.sina.getSystem().proxy.ajax({async:true,url:c.sina.getSystem().inaUrl,contentType:'application/json',dataType:'json',data:{SearchInteractionLogging:{SessionID:c.sessionId,EventList:r}}});});},isEnabled:function(s){if(s&&s.services&&s.services.SearchInteractionLogging){return true;}return false;},isSessionHandlingEnabled:function(s){if(s&&s.services&&s.services.Search&&s.services.Search.capabilities&&s.services.Search.capabilities.SessionHandling){return true;}return false;},addLoggingParametersToRequest:function(s,r){if(!this.isSessionHandlingEnabled(s)){return;}r.SessionID=this.sessionId;r.SessionTimestamp=parseInt(this.createEventLoggingTimestamp(),10);}});return a;}(P,f);R=function(f,b,p,q,j,u,x,s,c,a,d,e,B,m,P,h){var k={};k.Sina=function(){this.init.apply(this,arguments);};k.CatalogQuery=function(){this.init.apply(this,arguments);};k.SearchConfiguration=function(){this.init.apply(this,arguments);};k.UserHistory=function(){this.init.apply(this,arguments);};var l='INAV2';b.registerProvider({impl_type:l,sina:k.Sina,chartQuery:function(i){if(i.sina.getSystem()instanceof B.HANASystem){return new c.ChartQuery(i);}else{return new c.ABAPChartQuery(i);}},searchQuery:s.SearchQuery,groupBarChartQuery:c.GroupBarChartQuery,lineChartQuery:c.LineChartQuery,suggestionQuery:a.SuggestionAutoQuery,perspectiveQuery:d.PerspectiveQuery,perspectiveSearchQuery:d.PerspectiveSearchQuery,perspectiveGetQuery:d.PerspectiveGetQuery,Facet:e.Facet,DataSource:x.DataSource,metaDataService:new m.MetaDataService(),eventLoggingService:P.EventLoggingService,Filter:u.Filter,FilterCondition:u.Condition,FilterConditionGroup:u.ConditionGroup,DataSourceQuery:x.DataSourceQuery,searchConfiguration:k.SearchConfiguration,addUserHistoryEntry:function(i){var n=new k.UserHistory(i);return n.addUserHistoryEntry(i.oEntry);},emptyUserHistory:function(i){var n=new k.UserHistory(i);return n.emptyUserHistory();}});k.Sina.prototype=f.extend({},b.Sina.prototype,{init:function(i){i=i||{};b.Sina.prototype.init.apply(this,arguments);},getRootDataSource:function(i){return new x.DataSource({objectName:'$$ALL$$',packageName:'ABAP',schemaName:'',sina:this});},sapclient:function(i){var n;if(i){if(i<0){n=new B.HANASystem();}else{n=new B.ABAPSystem({'sapclient':i});}this.setSystem(n);}else{return this.getSystem().properties.sapclient();}return{};},_registerPostProcessor:function(i){if(!this.postProcessor){this.postProcessor=[];}this.postProcessor.push(i);},_postprocess:function(n,o){if(this.postProcessor){for(var i=0;i<this.postProcessor.length;i++){this.postProcessor[i](n,o);}}}});k.CatalogQuery.prototype=f.extend({},h.Query.prototype,{init:function(i){i=i||{};this.resultSetClass=SearchResultSet;},createJsonRequest:function(){return j.getCatalogRequest();}});k.UserHistory.prototype=f.extend({},q.Query.prototype,h.Query.prototype,{init:function(i){i=i||{};q.Query.prototype.init.apply(this,[i]);h.Query.prototype.init.apply(this,[i]);},addUserHistoryEntry:function(n,i){var o={'SearchConfiguration':{'Action':'Update','ClientEvent':n}};return this._fireRequest(o,i,'text');},emptyUserHistory:function(i){var n={'SearchConfiguration':{'Action':'Update','Data':{'PersonalizedSearch':{'ResetUserData':true}}}};return this._fireRequest(n,i,'text');}});k.SearchConfiguration.prototype=f.extend({},q.Query.prototype,h.Query.prototype,{init:function(i){i=i||{};q.Query.prototype.init.apply(this,[i]);h.Query.prototype.init.apply(this,[i]);},load:function(i){var n={'SearchConfiguration':{'Action':'Get','Data':{'PersonalizedSearch':{}}}};return this._fireRequest(n,i);},save:function(o,i){return this._fireRequest(o,i,'text');}});return k;}(f,g,p,q,t,w,G,F,L,M,K,N,D,O,Q,E);S=function(f,b,B,A){var e={};e.System=function(){this.init.apply(this,arguments);};e.System.prototype=f.extend({},B.System.prototype,{init:function(a){a=a||{};a.servicePath=a.servicePath||'/es/odata/callbuildin.xsjs';a.proxy=a.proxy||new A.Proxy({system:this});B.System.prototype.init.apply(this,[a]);},getServerInfo:function(){return f.when({rawServerInfo:{Services:[{Service:'Search',Capabilities:[{Capability:'SemanticObjectType'}]},{Service:'Suggestions2',Capabilities:[{Capability:'ScopeTypes'}]}]},services:{Suggestions:{suggestionTypes:['objectdata']},Search:{capabilities:['SemanticObjectType']}}});}});return e;}(f,g,B,A);T=function(u,f){var e={};var n=function(o){o=o.toLowerCase();switch(o){case'=':o='eq';break;case'!=':o='ne';break;case'>':o='gt';break;case'>=':o='ge';break;case'<':o='lt';break;case'<=':o='le';break;}return o;};e.Filter=function(){this.init.apply(this,arguments);};e.Filter.prototype=f.extend({},u.Filter.prototype,{init:function(a){u.Filter.prototype.init.apply(this,[a]);},getDataForRequest:function(){return this.defaultConditionGroup.getDataForRequest();},getDataForRequestValueHelp:function(){var r={searchQuery:'',filterString:''};return this.defaultConditionGroup.getDataForRequestValueHelp(r);}});e.Condition=function(){this.init.apply(this,arguments);};e.Condition.prototype=f.extend(Object.create(u.Condition.prototype),{init:function(a,o,v,l1){u.Condition.prototype.init.apply(this,arguments);},getDataForRequest:function(){return this.attribute+' '+n(this.operator)+' \''+this.value+'\'';},getDataForRequestValueHelp:function(r){r.filterString='';if(this.operator==='='&&this.value.indexOf('*')>-1){r.searchQuery+=' '+this.attribute+':'+this.value;}else{r.filterString=this.attribute+' '+n(this.operator)+' \''+this.value+'\'';}return r;}});e.ConditionGroup=function(){this.init.apply(this,arguments);};e.ConditionGroup.prototype=f.extend(Object.create(u.ConditionGroup.prototype),{init:function(a){u.ConditionGroup.prototype.init.apply(this,[a]);},getDataForRequest:function(){var r=[];for(var i=0;i<this.conditions.length;i++){var c=this.conditions[i];var a=c.getDataForRequest();if(a){r.push(a);}}var b=r.join(' '+n(this.operator)+' ');if(r.length>1){b='('+b+')';}return b;},getDataForRequestValueHelp:function(r){var a=[];for(var i=0;i<this.conditions.length;i++){var c=this.conditions[i];var b=c.getDataForRequestValueHelp(r).filterString;if(b){a.push(b);}}var d=a.join(' '+n(this.operator)+' ');if(a.length>1){d='('+d+')';}r.filterString=d;return r;}});return e;}(u,f);U=function(x,f){var e={};e.DataSource=function(){this.init.apply(this,arguments);};e.DataSource.prototype=f.extend({},x.DataSource.prototype,{init:function(a){a=a||{};x.DataSource.prototype.init.apply(this,arguments);this.type=a.type||x.DataSourceType.BUSINESSOBJECT;this.entityType=a.entityType||a.name;this.name=a.name||'';this.schema=a.schema||'';this.label=a.label||'icognito datasource';this.labelPlural=a.labelPlural||'icognito datasource plural';this.sina=a.sina||null;this.constructKey();if(!this.key){throw'Datasource has no key!! '+JSON.stringify(a);}},constructKey:function(){this.key=this.type+'/'+this.entityType;},getIdentifier:function(){return this.name;},getType:function(){return this.type;},getEntityType:function(){return this.entityType;},getLabel:function(){return this.label;},getSchema:function(){return this.schema;},getLabelPlural:function(){return this.labelPlural;},getName:function(){return this.name;},clone:function(){var n=this.sina.createDataSource();n.type=this.type;n.entityType=this.entityType;n.name=this.name;n.schema=this.schema;n.label=this.label;n.labelPlural=this.labelPlural;n.key=this.key;return n;},setJson:function(j){this.type=j.type;this.entityType=j.entityType;this.schema=j.schema;this.label=j.label;this.labelPlural=j.labelPlural;this.name=j.name;this.constructKey();},getJson:function(){return{type:this.type,entityType:this.entityType,schema:this.schema,label:this.label,labelPlural:this.labelPlural,name:this.name};}});return e;}(x,f);V=function(b,f){var e={};e.ChartQuery=function(){this.init.apply(this,arguments);};e.ChartQuery.prototype=f.extend({},b.ChartQuery.prototype,{init:function(a){a=a||{};b.ChartQuery.prototype.init.apply(this,[a]);this.dimensions=[];this.attributeLimit=1000;},executeSync:function(){return this.resultSet;},addDimension:function(d){if(!d){return;}if(typeof d==='object'){if(!d.name){return;}this.dimensions.push(d.name);}else if(typeof d==='string'){this.dimensions.push(d);}},setAttributeLimit:function(l){this.attributeLimit=l;},getTitle:function(d){if(d===undefined&&this.filter.dataSource&&this.filter.dataSource.name){d=this.filter.dataSource.name;}if(!d||d==='$$ALL$$'){return'Default Title';}var m=this.sina.getBusinessObjectMetaDataSyncByBusinessObjectName(d).attributeMap;var l=m[this.dimensions[0]].label;return l;},execute:function(){var a=this;var s=a.filter.searchTerms;var d=a.filter.dataSource;var c=this.attributeLimit||5;var h=0;var i=a.dimensions[0];var j='Search.search(query=\'';if(!d.equals(a.sina.getRootDataSource())){j+='scope:'+d.name+' ';}var k='';var l='';if(a.options&&Array.isArray(a.options)&&a.options.indexOf('ValueHelpMode')>-1){var o=a.filter.getDataForRequestValueHelp();l=o.filterString;j+=s+o.searchQuery+'\')';}else{j+=s+'\')';l=a.filter.getDataForRequest();}if(l){k=k+' and '+l;}var m='';if(i){m='/groupby(('+i+'),aggregate($count as _Count))';}var n='filter('+j+k+')'+m;var r={$count:true,$top:c,$skip:h,$apply:n};var v=this.system.servicePath+'/$all';var z={method:'GET',type:'GET',noXSRFToken:true,data:r,processData:true,url:v};return this.system.proxy.ajax(z).then(function(r){var m1=new e.ChartResultSet({dimensions:a.dimensions,sina:a.sina,datasource:a.filter.dataSource});return m1.setJsonFromResponseGroupBy(r);});}});e.ChartResultSet=function(){this.init.apply(this,arguments);};e.ChartResultSet.prototype={init:function(a){a=a||{};this.type=a.type;this.sina=a.sina;this.datasource=a.datasource;this.elements=[];this.dimensions=a.dimensions;},setJsonFromResponse:function(d){var a=d['@com.sap.vocabularies.Search.v1.Facet'].PropertyName||d['@com.sap.vocabularies.Search.v1.Facet'].Dimensions[0].PropertyName;var c=d['@com.sap.vocabularies.Search.v1.Facet'].isConnectorFacet;this.elements=[];for(var i=0;i<d.Items.length;++i){var h=d.Items[i];var j={};if(c===true){var k=this.sina.getDataSourceSyncByBusinessObjectName('BusinessObject/'+h[a]+'Type');j={dataSource:k,label:k.getLabel(),labelRaw:h[a],value:h._Count,valueRaw:h._Count};}else{var l=h[a];j={label:l,labelRaw:this.sina.createFilterCondition(a,'=',h[a],this.datasource.getMetaDataSync().attributeMap[a].label,l,l),value:h._Count,valueRaw:h._Count};}this.elements.push(j);}},setJsonFromResponseGroupBy:function(d){var a=this;var c=a.dimensions[0];var l=c;var r=d.value;for(var i=0;i<r.length;++i){var h=r[i];var j={label:h[l],labelRaw:this.sina.createFilterCondition(c,'=',h[c],this.datasource.getMetaDataSync().attributeMap[c].label,h[l],h[l]),value:h._Count,valueRaw:h._Count};a.elements.push(j);}return a;},getElements:function(){return this.elements;}};return e;}(H,f);W=function(g,b,f){var e={};e.SearchQuery=function(){this.init.apply(this,arguments);};e.SearchQuery.prototype=f.extend({},b.SearchQuery.prototype,{init:function(){b.SearchQuery.prototype.init.apply(this,arguments);this.resultSet=new e.SearchResultSet({sina:this.sina});},executeSync:function(){return this.resultSet;}});e.SearchResultSet=function(){this.init.apply(this,arguments);};e.SearchResultSet.prototype={init:function(a){a=a||{};this.sina=a.sina;this.elements=[];this.totalcount=0;this.dataSource=a.dataSource;},getElements:function(){return this.elements;},createEmptyElement:function(d){return{$$RelatedActions$$:[],$$WhyFound$$:[],$$DataSourceMetaData$$:d};},createAttribute:function(a,c,d,h){var i;if(h){var j=function(c,k){var o;if(isNaN(c)){o=new Date(Date.parse(c));}else{o=new Date(parseInt(c,10));}if(o==='Invalid Date'||isNaN(o)){c='Invalid Format: '+c;}else{var l;switch(k){case'date':l=sap.ui.core.format.DateFormat.getDateInstance({style:'medium'},sap.ui.getCore().getConfiguration().getLocale());break;case'time':l=sap.ui.core.format.DateFormat.getTimeInstance({style:'medium'},sap.ui.getCore().getConfiguration().getLocale());break;default:l=sap.ui.core.format.DateFormat.getDateTimeInstance({style:'medium'},sap.ui.getCore().getConfiguration().getLocale());}c=l.format(o);}return c;};switch(h.type){case'Edm.DateTime':case'Edm.DateTimeOffset':c=j(c,'datetime');break;case'Edm.Date':c=j(c,'date');break;case'Edm.TimeOfDay':case'Edm.Time':c=j(c,'time');break;case'Edm.Decimal':case'Edm.Double':case'Edm.Int16':case'Edm.Int32':case'Edm.Int64':case'Edm.Single':if(c){c=c.toString();}break;default:if(c){c=c.toString();}}i={$$MetaData$$:{presentationUsage:h.presentationUsage,displayOrder:h.displayOrder},label:h.label,labelRaw:h.labelRaw,value:c,valueRaw:c};}else{i={$$MetaData$$:{presentationUsage:[],displayOrder:d},label:a,labelRaw:a,value:c,valueRaw:c};}return i;},parseRecord:function(r){var a=this;var c=r['@odata.context']||a.dataSource.entityType;var d=c.lastIndexOf('#');if(d>-1){c=c.slice(d+1);}var h=r['@com.sap.vocabularies.Search.v1.WhyFound']||{};return a.sina.getBusinessObjectMetaDataByBusinessObjectName(c).then(function(m){var i=a.createEmptyElement(m.dataSource);var j=0;for(var k in r){if(k[0]==='@'||k[0]==='_'){continue;}var l=r[k];for(var n in h){if(n===k&&h[n][0]){l=h[n][0];delete h[n];}}i[k]=a.createAttribute(k,l,++j,m.attributeMap[k]);}if(Object.keys(h).length>0){i.$$WhyFound$$=[];var o={};for(var s in h){o={label:s,labelRaw:s,value:h[s],valueHighlighted:h[s],valueRaw:h[s]};i.$$WhyFound$$.push(o);}}i.keystatus=g.Sina.prototype.ResultElementKeyStatus.OK;return i;});},setJsonFromResponse:function(d){var a=this;a.totalcount=d['@odata.count']||0;a.totalcount=parseInt(a.totalcount,10);var r=d.value||d.d.results;var c=[];a.elements=[];for(var i=0;i<r.length;++i){var h=r[i];c.push(this.parseRecord(h).done(function(j){a.elements.push(j);}));}return f.when.apply(null,c).then(function(){return arguments;});}};return e;}(g,p,f);X=function(g,J,f,c,s){var e={};e.Facet=function(){this.init.apply(this,arguments);};e.Facet.prototype=f.extend({},J.Facet.prototype,{setJsonFromResponse:function(d){if(this.facetType===g.FacetType.DATASOURCE){this.query=this.sina.createChartQuery();this.query.resultSet=new c.ChartResultSet({sina:this.sina});}else if(this.facetType===g.FacetType.ATTRIBUTE){this.query=this.sina.createChartQuery();this.query.resultSet=new c.ChartResultSet({sina:this.sina,datasource:this.dataSource});}else if(this.facetType===g.FacetType.SEARCH){this.query=this.sina.createSearchQuery();this.query.resultSet=new s.SearchResultSet({sina:this.sina});}if(this.facetType===g.FacetType.ATTRIBUTE){this.dimension=d['@com.sap.vocabularies.Search.v1.Facet'].Dimensions[0].PropertyName;this.query.addDimension(this.dimension);this.title=this.query.getTitle(this.dataSource.name);}return this.query.resultSet.setJsonFromResponse(d);}});return e;}(g,J,f,V,W);Y=function(f,b,y,x){var e={};e.SuggestionQuery=function(){this.init.apply(this,arguments);};e.SuggestionQuery.prototype=f.extend({},y.SuggestionQuery.prototype,{init:function(){y.SuggestionQuery.prototype.init.apply(this,arguments);this.suggestionTerm=null;this.options=[];this.deferredResultSet=null;},setOptions:function(o){this.options=o;this._resetResultSet();},setSuggestionTerm:function(a){if(this.suggestionTerm!==a){this.suggestionTerm=a;this._resetResultSet();}return this;},_resetResultSet:function(){this.deferredResultSet=null;},execute:function(){var a=this;var c=5;var d=a.filter.dataSource;if(this.deferredResultSet){return this.deferredResultSet;}if(this.suggestionTypes.indexOf(b.SuggestionType.OBJECTDATA)<0){this.deferredResultSet=f.when(new e.SuggestionResultSet({sina:this.sina}));return this.deferredResultSet;}var s=this.sina.getSystem().servicePath+'/$all/GetSuggestion(term=\'';if(!d.equals(a.sina.getRootDataSource())){s+='scope:'+d.name+' ';}var h=s+this.suggestionTerm+'\')';this.deferredResultSet=this.system.proxy.ajax({method:'GET',type:'GET',noXSRFToken:true,$top:c,url:h}).then(function(i){var r=new e.SuggestionResultSet({sina:a.sina});return r.setJsonFromResponse(i);});return this.deferredResultSet;}});e.SuggestionResultSet=function(){this.init.apply(this,arguments);};e.SuggestionResultSet.prototype=f.extend({},y.SuggestionQuery.prototype,{init:function(a){this.sina=a.sina;this.elements=[];},setJsonFromResponse:function(d){var a=this;return a.sina.getDataSources().then(function(c){var s=d.value;for(var i=0;i<s.length;++i){var h=s[i];var j={children:[],label:h.term,labelRaw:h.term,value:0,valueRaw:0,dataSource:a.sina.getRootDataSource(),type:b.SuggestionType.OBJECTDATA,attribute:{value:'$$AllAttributes$$'}};a.elements.push(j);j={children:[],label:h.term,labelRaw:h.term,value:0,valueRaw:0,dataSource:a.sina.getDataSourceSyncByBusinessObjectName('BusinessObject/'+h.scope+'Type'),type:b.SuggestionType.OBJECTDATA,attribute:{value:'$$AllAttributes$$'}};a.elements.push(j);}return a;});},getElements:function(){return this.elements;}});return e;}(f,g,y,U);Z=function(g,f,b,J,q){var e={};e.PerspectiveQuery=function(){this.init.apply(this,arguments);};e.PerspectiveQuery.prototype=f.extend({},q.Query.prototype,b.PerspectiveQuery.prototype,{init:function(){q.Query.prototype.init.apply(this,arguments);b.PerspectiveQuery.prototype.init.apply(this,arguments);},_resetResultSet:function(){b.PerspectiveQuery.prototype._resetResultSet.apply(this,arguments);this.deferredResultSet=null;this.resultSet=null;this.jqXHR=null;},execute:function(){var a=this;var s=a.filter.searchTerms;var c;var d=a.filter.dataSource;var h=a.top()||10;var i=a.skip()||0;var j=5;var k='Search.search(query=\'';if(!d.equals(a.sina.getRootDataSource())){k+='scope:'+d.name+' ';}k+=s+'\')';var l='';var m=a.filter.getDataForRequest();if(m){l=l+' and '+m;}var n='filter('+k+l+')';var o={$count:true,$top:h,$skip:i,$apply:n,whyfound:true};var r=this.system.servicePath+'/$all';if(this.requestedEntities.indexOf('Facets')>-1){o.facets='all';o.facetlimit=j;}var v={method:'GET',type:'GET',noXSRFToken:true,data:o,processData:true,url:r};return this.system.proxy.ajax(v).then(function(o){c=new e.Perspective({sina:a.sina,dataSource:a.filter.dataSource});return c.setJsonFromResponse(o);});}});e.Perspective=function(){this.init.apply(this,arguments);};e.Perspective.prototype=f.extend({},b.Perspective.prototype,{setJsonFromResponse:function(d){var a=this;a.searchFacet=this.sina.createFacet({'facetType':g.FacetType.SEARCH});var r=a.searchFacet.setJsonFromResponse(d);a.chartFacets=[];var c=d['@com.sap.vocabularies.Search.v1.Facets'];if(c){for(var i=0;i<c.length;++i){var h=c[i];var j=h['@com.sap.vocabularies.Search.v1.Facet'].isConnectorFacet;var k=this.sina.createFacet({'facetType':j===true?g.FacetType.DATASOURCE:g.FacetType.ATTRIBUTE,dataSource:a.dataSource});k.setJsonFromResponse(h);a.chartFacets.push(k);}}return f.when([r]).then(function(){return a;});}});return e;}(g,f,I,J,q);_=function(f){var e={};e.MetaDataService=function(){this.init.apply(this,arguments);};e.MetaDataService.prototype={init:function(a){a=a||{};this.sina=a.sina||null;this.allInOneMap={};this.allInOneMapDeferred=null;this.presentationUsageConversionMap={TITLE:'Title',SUMMARY:'Summary',DETAIL:'Detail',IMAGE:'Image',THUMBNAIL:'Thumbnail',HIDDEN:'Hidden'};this.accessUsageConversionMap={AUTO_FACET:'AutoFacet',SUGGESTION:'Suggestion'};},getDataSources:function(a){var b=this;return b._fillInternalBuffer(a.sina).then(function(){return b.allInOneMap.dataSourcesList;});},getDataSourcesSync:function(a){this._fillInternalBufferSync(a.sina);return this.allInOneMap.dataSourcesList;},getDataSource:function(a,d){var b=this;var c=d.getName();if(!c){throw'EntitySetName missing';}return b._fillInternalBuffer(a.sina).then(function(){return b.allInOneMap.dataSourceMap[c];});},getDataSourceByBusinessObjectName:function(a,b){var c=this;if(!b){throw'EntitySetName missing';}return c._fillInternalBuffer(a.sina).then(function(){return c.allInOneMap.dataSourceMap[b];});},getDataSourceSync:function(a,d){var b=d.getName();if(!b){throw'EntitySetName missing';}this._fillInternalBufferSync();return this.allInOneMap.dataSourceMap[b];},getDataSourceSyncByBusinessObjectName:function(a,b){if(!b){throw'EntitySetName missing';}this._fillInternalBufferSync();return this.allInOneMap.dataSourceMap[b];},getBusinessObjectsMetaData:function(a){var b=this;return b._fillInternalBuffer(a.sina).then(function(){return b.allInOneMap.businessObjectList;});},getBusinessObjectsMetaDataSync:function(a){this._fillInternalBufferSync();return this.allInOneMap.businessObjectList;},getBusinessObjectMetaData:function(a,d){var b=this;var c=d.getName();if(!c){throw'EntitySetName missing';}return b._fillInternalBuffer(a.sina).then(function(){return b.allInOneMap.businessObjectMap[c];});},getBusinessObjectMetaDataByBusinessObjectName:function(a,b){var c=this;if(!b){throw'EntitySetName missing';}return c._fillInternalBuffer(a.sina).then(function(){return c.allInOneMap.businessObjectMap[b];});},getBusinessObjectMetaDataSync:function(a,d){var b=d.getName();if(!b){throw'EntitySetName missing';}this._fillInternalBufferSync();return this.allInOneMap.businessObjectMap[b];},getBusinessObjectMetaDataSyncByBusinessObjectName:function(a,b){if(!b){throw'EntitySetName missing';}this._fillInternalBufferSync();return this.allInOneMap.businessObjectMap[b];},_fillInternalBufferSync:function(l1){if(this.allInOneMap&&Object.keys(this.allInOneMap).length>0){return;}this.allInOneMap=this._fireMetaRequest(l1,false);},_fillInternalBuffer:function(l1){var a=this;if(this.allInOneMapDeferred){return this.allInOneMapDeferred;}a.allInOneMapDeferred=a._fireMetaRequest(l1).then(function(b){a.allInOneMap=b;});return a.allInOneMapDeferred;},_getWindow:function(){var a=this;if(!this.windowDeferred){this.windowDeferred=f.Deferred();}if(typeof window==='undefined'){var j=j;var b=b;var c=b.readFileSync('./node_modules/jquery/dist/jquery.js','utf-8');j.env({html:'<html><body></body></html>',src:[c],done:function(d,h){if(!d){a.windowDeferred.resolve(h);}else{a.windowDeferred.reject(d);}}});}else{this.windowDeferred.resolve(window);}return this.windowDeferred.promise();},_parseEntityType:function(s,a){var b=this;var h={};s=a.$(s);s.find('EntityType').each(function(){var c=a.$(this).attr('Name');var d={schema:s.attr('Namespace'),keys:[],attributeMap:{}};h[c]=d;a.$(this).find('Key>PropertyRef').each(function(){d.keys.push(a.$(this).attr('Name'));});a.$(this).find('Property').each(function(i){var j=a.$(this).attr('Name');var k={labelRaw:j,label:null,type:a.$(this).attr('Type'),isTitle:false,presentationUsage:[],accessUsage:[],displayOrder:i,unknownAnnotation:[]};d.attributeMap[j]=k;a.$(this).find('Annotation').each(function(){switch(a.$(this).attr('Term')){case'SAP.Common.Label':k.label=a.$(this).attr('String');break;case'EnterpriseSearch.key':k.enterprisesearchkey=a.$(this).attr('Bool')=='true'?true:false;break;case'EnterpriseSearch.presentationMode':a.$(this).find('Collection>String').each(function(){var l=a.$(this).text();l=b.presentationUsageConversionMap[l];if(l){k.presentationUsage.push(l);if(l.toLocaleLowerCase()==='title'){k.isTitle=true;}}});break;case'EnterpriseSearch.usageMode':a.$(this).find('Collection>String').each(function(){var l=a.$(this).text();l=b.accessUsageConversionMap[l];if(l){k.accessUsage.push(l);}});break;case'EnterpriseSearch.displayOrder':k.displayOrder=a.$(this).attr('Int');break;default:k.unknownAnnotation.push(a.$(this));}});});});return h;},_parseEntityContainer:function(l1,s,h,a,b){s.find('EntityContainer>EntitySet').each(function(){if(b.$(this).attr('Name')&&b.$(this).attr('EntityType')){var n=b.$(this).attr('Name');var c=b.$(this).attr('EntityType');var d=c.slice(0,c.lastIndexOf('.'));var i=c.slice(c.lastIndexOf('.')+1);var j=l1.createDataSource({label:n,labelPlural:n,entityType:i,name:n,schema:d,sina:l1});a.dataSourceMap[j.key]=j;a.dataSourcesList.push(j);var k=h[i];if(k===undefined){throw'EntityType '+i+' has no corresponding meta data!';}k.name=n;k.dataSource=j;a.businessObjectMap[n]=k;a.businessObjectList.push(k);}});},_parseResponse:function(l1,m,d){var a=this;var b={businessObjectMap:{},businessObjectList:[],dataSourceMap:{},dataSourcesList:[]};var c=f.Deferred();this._getWindow().then(function(h){h.$(m).find('Schema').each(function(){var i=h.$(this);var j=a._parseEntityType(i,h);a._parseEntityContainer(l1,i,j,b,h);});c.resolve(b);});return c.promise();},_fireMetaRequest:function(l1,a){var b=this;var c=l1.getSystem().servicePath+'/$metadata';var r={async:a===undefined?true:a,method:'GET',type:'GET',url:c,processData:false,dataType:'xml',noXSRFToken:true};var d=f.Deferred();var m=l1.getSystem().proxy.ajax(r);if(r.async){m.done(function(h){b._parseResponse(l1,h).then(function(i){d.resolve(i);});});return d.promise();}else{var h=m.responseXML;return b._parseResponse(l1,h);}}};return e;}(f);a1=function(f,b,B,u,x,A,d,a,s,c,e,h,m){var i={};i.Sina=function(){this.init.apply(this,arguments);};i.Sina.prototype=f.extend({},b.Sina.prototype,{init:function(){b.Sina.prototype.init.apply(this,arguments);this.rootDataSource=new x.DataSource({label:'All',labelPlural:'All',name:'$$ALL$$',type:d.DataSourceType.CATEGORY,sina:this});},getRootDataSource:function(){return this.rootDataSource;}});i.IMPL_TYPE='ODATA2';b.registerProvider({impl_type:i.IMPL_TYPE,sina:i.Sina,Facet:a.Facet,chartQuery:e.ChartQuery,searchQuery:s.SearchQuery,suggestionQuery:c.SuggestionQuery,perspectiveQuery:h.PerspectiveQuery,metaDataService:new m.MetaDataService(),Filter:u.Filter,FilterCondition:u.Condition,FilterConditionGroup:u.ConditionGroup,DataSource:x.DataSource});return i;}(f,g,S,T,U,A,x,X,W,Y,V,Z,_);b1=function(f,b,B,A){var e={};e.System=function(){this.init.apply(this,arguments);};e.System.prototype=f.extend({},B.System.prototype,{init:function(a){this.infoUrl='/sap/opu/odata/sap/ESH_SEARCH_SRV/';a=a||{};a.proxy=a.proxy||new A.Proxy({system:this});B.System.prototype.init.apply(this,[a]);},getServerInfo:function(){var a=this;if(this.jqXHR){return this.jqXHR.promise();}this.jqXHR=f.Deferred();var r={async:true,method:'GET',type:'GET',url:a.infoUrl+'ServerInfos?$expand=Services/Capabilities',contentType:'application/json',dataType:'json',noXSRFToken:false};this.proxy.ajax(r).done(function(d){a.setJsonFromResponse(d);a.jqXHR.resolve(a);});return this.jqXHR.promise();},setJsonFromResponse:function(d){this.user=d.d.results[0].CurrentUserName;this.system=d.d.results[0].SystemId;this.client=d.d.results[0].Client;this.rawServerInfo={Services:[{Service:'Search',Capabilities:[{Capability:'SemanticObjectType'}]},{Service:'PersonalizedSearch',Capabilities:[{Capability:'SetUserStatus',Description:'Set user status for Personalized Search'},{Capability:'ResetUserData',Description:'Reset collected user data'}]}]};this.services={Suggestions:{suggestionTypes:['objectdata','history','datasource']},Search:{capabilities:['SemanticObjectType']},PersonalizedSearch:{properties:{Capabilities:[{Capability:'SetUserStatus',Description:'Set user status for Personalized Search'},{Capability:'ResetUserData',Description:'Reset collected user data'}],Service:'PersonalizedSearch'},name:'PersonalizedSearch',minVersion:0,maxVersion:0,capabilities:{SetUserStatus:{properties:{Capability:'SetUserStatus',Description:'Set user status for Personalized Search'},name:'SetUserStatus',minVersion:0,maxVersion:0},ResetUserData:{properties:{Capability:'ResetUserData',Description:'Reset collected user data'},name:'ResetUserData',minVersion:0,maxVersion:0}}}};}});return e;}(f,g,B,A);c1=function(u,f){var e={};var c=function(o){switch(o.toLowerCase()){case'<':return'LT';break;case'<=':return'LE';break;case'>':return'GT';break;case'>=':return'GE';break;case'=':return'EQ';break;case'and':return'AND';break;case'or':return'OR';break;default:return o;}};e.Filter=function(){this.init.apply(this,arguments);};e.Filter.prototype=f.extend({},u.Filter.prototype,{init:function(a){u.Filter.prototype.init.apply(this,[a]);},getDataForRequest:function(){return this.defaultConditionGroup.getDataForRequest();}});e.Condition=function(){this.init.apply(this,arguments);};e.Condition.prototype=f.extend(Object.create(u.Condition.prototype),{init:function(a,o,v,l1){u.Condition.prototype.init.apply(this,arguments);},getDataForRequest:function(){var a={'Id':1,'ConditionAttribute':this.attribute,'ConditionOperator':c(this.operator),'ConditionValue':this.value.toString()};return a;}});e.ConditionGroup=function(){this.init.apply(this,arguments);};e.ConditionGroup.prototype=f.extend(Object.create(u.ConditionGroup.prototype),{init:function(a){u.ConditionGroup.prototype.init.apply(this,[a]);},getDataForRequest:function(){var r=[];for(var i=0;i<this.conditions.length;i++){var a=this.conditions[i];var b=a.getDataForRequest();if(b){r.push(a.getDataForRequest());}}var d=null;if(r.length>=1){d={'Id':1,'OperatorType':c(this.operator),'SubFilters':r};}return d;}});return e;}(u,f);d1=function(x,f){var e={};e.DataSource=function(){this.init.apply(this,arguments);};e.DataSource.prototype=f.extend({},x.DataSource.prototype,{init:function(a){a=a||{};x.DataSource.prototype.init.apply(this,arguments);this.type=a.type||x.DataSourceType.BUSINESSOBJECT;this.name=a.name||'';this.id=this.name;this.objectName=this.name;this.semanticObjectType=a.semanticObjectType||a.SemanticObjectType||'';this.label=a.label||'icognito datasource';this.labelPlural=a.labelPlural||'icognito datasource plural';this.systemId=a.systemId||a.SystemId||'';this.client=a.client||a.Client||'';this.sina=a.sina||null;this._constructKey();},getLabel:function(){return this.label;},getLabelPlural:function(){return this.labelPlural;},_constructKey:function(){this.key=this.name;},getIdentifier:function(){return this.key;},getType:function(){return this.type;},getName:function(){return this.name;},clone:function(){var n=this.sina.createDataSource();n.type=this.type;n.name=this.name;n.semanticObjectType=this.semanticObjectType;n.label=this.label;n.labelPlural=this.labelPlural;n.systemId=this.systemId;n.client=this.client;n.key=this.key;return n;}});return e;}(x,f);e1=function(b,d,f){var e={};e.ChartQuery=function(){this.init.apply(this,arguments);};e.ChartQuery.prototype=f.extend({},b.ChartQuery.prototype,{init:function(a){a=a||{};b.ChartQuery.prototype.init.apply(this,[a]);this.dimensions=[];this.attributeLimit=1000;},executeSync:function(){return this.resultSet;},addDimension:function(a){if(!a){return;}if(typeof a==='object'){if(!a.name){return;}this.dimensions.push(a.name);}else if(typeof a==='string'){this.dimensions.push(a);}},setAttributeLimit:function(l){this.attributeLimit=l;},getTitle:function(a){if(a===undefined&&this.filter.dataSource&&this.filter.dataSource.name){a=this.filter.dataSource.name;}if(!a){return'Default Title';}var m=this.sina.getBusinessObjectMetaDataSyncByBusinessObjectName(a).attributeMap;var l=m[this.dimensions[0]].label;return l;},execute:function(){var a=this;var s=a.filter.searchTerms;var c=a.filter.dataSource;var h=this.attributeLimit||5;var j=0;var k=a.filter.getDataForRequest();var l=[];for(var i=0;i<a.dimensions.length;i++){l.push({'DataSourceAttribute':a.dimensions[i]});}var m={'d':{'Id':'1','MaxFacetValues':h,'QueryOptions':{'SearchTerms':s,'Skip':j},'DataSources':[{'Id':c.name,'Type':d.convertToServerType(c.type)}],'FacetRequests':l,'Facets':[{'Values':[]}],'ResultList':{'SearchResults':[{'HitAttributes':[],'Attributes':[]}]}}};if(k!==null){m.d.Filter=k;}var r={method:'POST',type:'POST',noXSRFToken:false,data:m,contentType:'application/json',url:a.sina.getSystem().infoUrl+'SearchQueries/'};return this.system.proxy.ajax(r).then(function(m){var n=new e.ChartResultSet({dimensions:a.dimensions,sina:a.sina,datasource:a.filter.dataSource});return n.setJsonFromAttributeFacetResponse(m);});}});e.ChartResultSet=function(){this.init.apply(this,arguments);};e.ChartResultSet.prototype={init:function(a){a=a||{};this.type=a.type;this.sina=a.sina;this.datasource=a.datasource;this.elements=[];this.dimensions=a.dimensions;},setJsonFromResponse:function(a){var c=this;var h=a.Id==='DataSource';c.elements=[];for(var i=0;i<a.Values.results.length;++i){var j=a.Values.results[i];var k={};if(h===true){var l=c.sina.getDataSourceSyncByBusinessObjectName(j.ValueLow);if(l){k={dataSource:l,label:l.getLabel(),labelRaw:j.ValueLow,value:j.NumberOfObjects,valueRaw:j.NumberOfObjects};}else{k={dataSource:c.sina.createDataSource({type:j.Type,name:j.ValueLow,label:j.Description,labelPlural:j.Description,sina:c.sina,systemId:j.SourceSystem,client:j.SourceClient}),label:j.Description,labelRaw:j.ValueLow,value:j.NumberOfObjects,valueRaw:j.NumberOfObjects};}}else{k=c._formatAttributeFacetElement(a.Id,a.Name,a.Type,j);}c.elements.push(k);}},setJsonFromAttributeFacetResponse:function(a){var c=this;var h=c.dimensions[0];var k;var l;var m;var n;if(a.d.Facets){for(var j=0;j<a.d.Facets.results.length;j++){if(a.d.Facets.results[j].Id===h){k=a.d.Facets.results[j].Id;l=a.d.Facets.results[j].Name;m=a.d.Facets.results[j].Type;n=a.d.Facets.results[j].Values.results;break;}}}if(n!==undefined){for(var i=0;i<n.length;++i){var o=n[i];var r=c._formatAttributeFacetElement(k,l,m,o);c.elements.push(r);}}return c;},_formatAttributeFacetElement:function(a,c,h,i){var j=this;var k;var l;var m;if(h==='AttributeRange'){k=j.sina.createFilterConditionGroup();k.setOperator('AND');k.setLabel(i.Description);var v;var n;if(i.ValueHigh){v=j.sina.createFilterCondition(a,'<=',i.ValueHigh,c,i.ValueHighFormatted,i.ValueHighFormatted);k.addCondition(v);}if(i.ValueLow){n=j.sina.createFilterCondition(a,'>=',i.ValueLow,c,i.ValueLowFormatted,i.ValueLowFormatted);k.addCondition(n);}m={label:i.Description,labelRaw:k,value:i.NumberOfObjects,valueRaw:i.NumberOfObjects};}else{l=j.sina.createFilterCondition(a,'=',i.ValueLow,c,i.ValueLowFormatted,i.ValueLowFormatted);m={label:i.ValueLowFormatted,labelRaw:l,value:i.NumberOfObjects,valueRaw:i.NumberOfObjects};}return m;},getElements:function(){return this.elements;}};return e;}(H,x,f);f1=function(g,d,b,f){var e={};e.SearchQuery=function(){this.init.apply(this,arguments);};e.SearchQuery.prototype=f.extend({},b.SearchQuery.prototype,{init:function(){b.SearchQuery.prototype.init.apply(this,arguments);this.resultSet=new e.SearchResultSet({sina:this.sina});},executeSync:function(){return this.resultSet;}});e.SearchResultSet=function(){this.init.apply(this,arguments);};e.SearchResultSet.prototype={init:function(a){a=a||{};this.sina=a.sina;this.elements=[];this.totalcount=0;this.dataSource=a.dataSource;},getElements:function(){return this.elements;},createEmptyElement:function(a){return{$$RelatedActions$$:[],$$WhyFound$$:[],$$DataSourceMetaData$$:a};},setJsonFromResponse:function(a){var c=this;c.totalcount=parseInt(a.d.ResultList.TotalHits,10);var r=a.d.ResultList.SearchResults?a.d.ResultList.SearchResults.results:[];var h=[];c.elements=[];for(var i=0;i<r.length;++i){var j=r[i];h.push(this.parseRecord(j).done(function(k){c.elements.push(k);}));}return f.when.apply(null,h).then(function(){return arguments;});},parseRecord:function(r){var a=this;var c=r.DataSourceId;var h=r.Attributes.results;var i=r.HitAttributes!==null?r.HitAttributes.results:[];return a.sina.getBusinessObjectMetaDataByBusinessObjectName(c).then(function(m){var j=a.createEmptyElement(m.dataSource);var k=0;h.forEach(function(o){j[o.Id]=a._createAttribute(o.Id,o.Value,o.Snippet,++k,m.attributeMap[o.Id]);});if(i.length!==0){j.$$WhyFound$$=a._createWhyFound(i,m.attributeMap);}j.key=a._createKey(h,r.DataSourceId);if(j.key.length>0){j.keystatus=g.Sina.prototype.ResultElementKeyStatus.OK;}else{j.keystatus=g.Sina.prototype.ResultElementKeyStatus.NO_KEY;}j.title=a._createTitle(h,r.DataSourceId);return j;});},_createAttribute:function(a,c,h,i,j){var k;if(j){k={$$MetaData$$:{presentationUsage:j.presentationUsage,displayOrder:j.displayOrder,semanticObjectType:j.semanticObjectType,isSortable:j.isSortable,isTitle:j.presentationUsage.indexOf('Title')!==-1,description:j.label},label:j.label,labelRaw:j.labelRaw,value:h!==''?h:c,valueRaw:c};}else{k={$$MetaData$$:{presentationUsage:[],displayOrder:i,semanticObjectType:'',isSortable:false},label:a,labelRaw:a,value:h!==''?h:c,valueRaw:c};}return k;},_createWhyFound:function(s,a){var c=[];for(var i in s){if(a[s[i].Id]){c.push({label:a[s[i].Id].label,labelRaw:a[s[i].Id].labelRaw,value:s[i].Snippet,valueHighlighted:s[i].Snippet,valueRaw:s[i].Snippet});}}return c;},_createKey:function(s,a){var c=this;var k='';var m=c.sina.getBusinessObjectMetaDataSyncByBusinessObjectName(a).attributeMap;for(var i=0;i<s.length;i++){if(m[s[i].Id]&&m[s[i].Id].isKey){k=k+':'+s[i].Value.toString();}}if(k.length>0){k=a+k;}return k;},_createTitle:function(s,a){var c=this;var h='';var m=c.sina.getBusinessObjectMetaDataSyncByBusinessObjectName(a).attributeMap;for(var i=0;i<s.length;i++){if(m[s[i].Id]&&m[s[i].Id].presentationUsage&&m[s[i].Id].presentationUsage.indexOf('Title')!==-1){h=h+' '+s[i].Value.toString();}}return h;}};return e;}(g,x,p,f);g1=function(g,J,f,c,s){var e={};e.Facet=function(){this.init.apply(this,arguments);};e.Facet.prototype=f.extend({},J.Facet.prototype,{setJsonFromResponse:function(d){if(this.facetType===g.FacetType.DATASOURCE){this.query=this.sina.createChartQuery();this.query.resultSet=new c.ChartResultSet({sina:this.sina});}else if(this.facetType===g.FacetType.ATTRIBUTE){this.query=this.sina.createChartQuery();this.query.resultSet=new c.ChartResultSet({sina:this.sina,datasource:this.dataSource});}else if(this.facetType===g.FacetType.SEARCH){this.query=this.sina.createSearchQuery();this.query.resultSet=new s.SearchResultSet({sina:this.sina});}if(this.facetType===g.FacetType.ATTRIBUTE){this.dimension=d.Id;this.query.addDimension(this.dimension);this.title=d.Name;}return this.query.resultSet.setJsonFromResponse(d);}});return e;}(g,J,f,e1,f1);h1=function(f,d,b,y){var e={};var c=function(a){switch(a){case'H':return b.SuggestionType.HISTORY;break;case'A':return b.SuggestionType.OBJECTDATA;break;case'M':return b.SuggestionType.DATASOURCE;break;default:return b.SuggestionType.OBJECTDATA;}};e.SuggestionQuery=function(){this.init.apply(this,arguments);};e.SuggestionQuery.prototype=f.extend({},y.SuggestionQuery.prototype,{init:function(){y.SuggestionQuery.prototype.init.apply(this,arguments);this.suggestionTerm=null;this.options=[];this.deferredResultSet=null;},setOptions:function(o){this.options=o;this._resetResultSet();},setSuggestionTerm:function(a){if(this.suggestionTerm!==a){this.suggestionTerm=a;this._resetResultSet();}return this;},_resetResultSet:function(){this.deferredResultSet=null;},execute:function(){var a=this;var h=5;var j=a.filter.dataSource;if(a.deferredResultSet){return a.deferredResultSet;}var k={'d':{'Id':'1','SuggestionInput':a.splitSuggestionTerm(a.suggestionTerm).suggestionTerm,'IncludeAttributeSuggestions':false,'IncludeHistorySuggestions':false,'IncludeDataSourceSuggestions':false,'DetailLevel':1,'QueryOptions':{'Top':h,'Skip':0,'SearchTerms':a.splitSuggestionTerm(a.suggestionTerm).searchTerm!==null?a.splitSuggestionTerm(a.suggestionTerm).searchTerm:''},'DataSources':[{'Id':j.name,'Type':d.convertToServerType(j.type)}],'Suggestions':[],'ExecutionDetails':[]}};if(a.filter.getDataForRequest()){k.d.Filter=a.filter.getDataForRequest();}for(var i=0;i<a.suggestionTypes.length;i++){switch(a.suggestionTypes[i]){case b.SuggestionType.HISTORY:k.d.IncludeHistorySuggestions=true;break;case b.SuggestionType.DATASOURCE:k.d.IncludeDataSourceSuggestions=true;break;case b.SuggestionType.OBJECTDATA:k.d.IncludeAttributeSuggestions=true;break;default:k.d.IncludeAttributeSuggestions=true;}}a.deferredResultSet=a.system.proxy.ajax({method:'POST',type:'POST',noXSRFToken:false,data:k,contentType:'application/json',url:a.sina.getSystem().infoUrl+'SuggestionsQueries/'}).then(function(k){var r=new e.SuggestionResultSet({sina:a.sina,queryDataSource:j});return r.setJsonFromResponse(k);});return a.deferredResultSet;},splitSuggestionTerm:function(a){var s=a.lastIndexOf(' ');if(s<0){return{searchTerm:null,suggestionTerm:a};}var h=a.slice(0,s);h=h.replace(/\s+$/,'');if(h.length===0){return{searchTerm:null,suggestionTerm:a};}var i=a.slice(s);i=i.replace(/^\s+/,'');if(i.length===0){return{searchTerm:null,suggestionTerm:a};}return{searchTerm:h,suggestionTerm:i};}});e.SuggestionResultSet=function(){this.init.apply(this,arguments);};e.SuggestionResultSet.prototype=f.extend({},y.SuggestionQuery.prototype,{init:function(a){this.sina=a.sina;this.elements=[];this.queryDataSource=a.queryDataSource;},setJsonFromResponse:function(a){var h=this;h.elements=[];return h.sina.getDataSources().then(function(j){var r=a.d.Suggestions?a.d.Suggestions.results:[];for(var i=0;i<r.length;++i){var s=r[i];var k=c(s.Type);var l={};var m={};switch(k){case b.SuggestionType.HISTORY:m={type:k,label:s.SearchTermsHighlighted,labelRaw:s.SearchTerms,dataSource:h.queryDataSource,children:[]};h.elements.push(m);break;case b.SuggestionType.OBJECTDATA:h._pushOrMergeObjectDataSuggestion(s);break;case b.SuggestionType.DATASOURCE:if(h.sina.getDataSourceSyncByBusinessObjectName(s.FromDataSource)){l=h.sina.getDataSourceSyncByBusinessObjectName(s.FromDataSource);}else{l=h.sina.getRootDataSource();}m={type:k,key:l.key,label:s.SearchTermsHighlighted,labelRaw:l,dataSource:l,children:[]};h.elements.push(m);break;}}return h;});},_pushOrMergeObjectDataSuggestion:function(s){var a=this;var h=false;var j;if(a.sina.getDataSourceSyncByBusinessObjectName(s.FromDataSource)){j=a.sina.getDataSourceSyncByBusinessObjectName(s.FromDataSource);}else{j=a.sina.getRootDataSource();}for(var i=0;i<a.elements.length;i++){if(a.elements[i].labelRaw===s.SearchTerms){a.elements[i].children.push({label:s.SearchTermsHighlighted,labelRaw:s.SearchTerms,type:a.elements[i].type,dataSource:j});h=true;break;}}if(!h){a.elements.push({type:b.SuggestionType.OBJECTDATA,label:s.SearchTermsHighlighted,labelRaw:s.SearchTerms,dataSource:a.queryDataSource,children:[{label:s.SearchTermsHighlighted,labelRaw:s.SearchTerms,type:b.SuggestionType.OBJECTDATA,dataSource:j}]});}},getElements:function(){return this.elements;}});return e;}(f,x,g,y);i1=function(g,d,f,b,J,q){var e={};e.PerspectiveQuery=function(){this.init.apply(this,arguments);};e.PerspectiveQuery.prototype=f.extend({},q.Query.prototype,b.PerspectiveQuery.prototype,{init:function(){b.PerspectiveQuery.prototype.init.apply(this,arguments);},_isAllDataSource:function(a){return JSON.stringify(this.sina.rootDataSource)===JSON.stringify(a);},_resetResultSet:function(){b.PerspectiveQuery.prototype._resetResultSet.apply(this,arguments);this.deferredResultSet=null;this.resultSet=null;this.jqXHR=null;},execute:function(){var a=this;var s=a.filter.searchTerms;var c=a.filter.dataSource;var h=a.top()||10;var i=a.skip()||0;var o=a.orderBy.orderBy===undefined?[]:[{'AttributeId':a.orderBy.orderBy,'SortOrder':a.orderBy.sortOrder.toLowerCase()}];var j=a.filter.getDataForRequest();var k;var l={'d':{'Id':'1','MaxFacetValues':5,'QueryOptions':{'SearchTerms':s,'Top':h,'Skip':i},'DataSources':[{'Id':c.name,'Type':d.convertToServerType(c.type)}],'OrderBy':o,'Facets':[{'Values':[]}],'ResultList':{'SearchResults':[{'HitAttributes':[],'Attributes':[]}]}}};if(j!==null){l.d.Filter=j;}var r={method:'POST',type:'POST',noXSRFToken:false,data:l,contentType:'application/json',url:a.sina.getSystem().infoUrl+'SearchQueries/'};return this.system.proxy.ajax(r).then(function(l){k=new e.Perspective({sina:a.sina,dataSource:a.filter.dataSource});return k.setJsonFromResponse(l);});}});e.Perspective=function(){this.init.apply(this,arguments);};e.Perspective.prototype=f.extend({},b.Perspective.prototype,{setJsonFromResponse:function(a){var c=this;c.searchFacet=this.sina.createFacet({'facetType':g.FacetType.SEARCH});var r=c.searchFacet.setJsonFromResponse(a);c.chartFacets=[];var h=a.d.Facets?a.d.Facets.results:[];if(h){for(var i=0;i<h.length;++i){var j=h[i];var k=j.Id==='DataSource';var l=this.sina.createFacet({'facetType':k===true?g.FacetType.DATASOURCE:g.FacetType.ATTRIBUTE,dataSource:c.dataSource});l.setJsonFromResponse(j);c.chartFacets.push(l);}}return f.when([r]).then(function(){return c;});}});return e;}(g,x,f,I,J,q);j1=function(f,d){var e={};var c=function(a,b){var h='';switch(a){case'Edm.Binary':h='String';break;case'Edm.Boolean':h='String';break;case'Edm.Byte':h='String';break;case'Edm.Guid':h='String';break;case'Edm.String':h='String';break;case'Edm.Decimal':h='Double';break;case'Edm.Double':h='Double';break;case'Edm.Float':h='Double';break;case'Edm.Int16':h='Double';break;case'Edm.Int32':h='Double';break;case'Edm.Int64':h='Double';break;case'Edm.DateTime':h='Timestamp';break;case'Edm.DateTimeOffset':h='Timestamp';break;case'Edm.Time':h='Timestamp';break;default:h='String';}if(h==='String'&&b){h='Text';}return h;};e.MetaDataService=function(){this.init.apply(this,arguments);};e.MetaDataService.prototype={init:function(a){a=a||{};this.sina=a.sina||null;this.allInOneMap={};this.allInOneMapDeferred=null;this.presentationUsageConversionMap={TITLE:'Title',SUMMARY:'Summary',DETAILS:'Detail',DETAILIMAGE:'Image',PREVIEWIMAGE:'Thumbnail',FACTSHEET:'Factsheet',HIDDEN:'Hidden',LONGTEXT:'Hidden'};this.accessUsageConversionMap={AUTO_FACET:'AutoFacet',SUGGESTION:'Suggestion'};},getDataSources:function(a){var b=this;return b._fillInternalBuffer(a.sina).then(function(){return b.allInOneMap.dataSourcesList;});},getDataSourcesSync:function(a){this._fillInternalBufferSync(a.sina);return this.allInOneMap.dataSourcesList;},getDataSourceSyncByBusinessObjectName:function(a,b){var h=this;if(!b){throw'EntitySetName missing';}h._fillInternalBufferSync(a.sina);return h.allInOneMap.dataSourceMap[b];},getBusinessObjectMetaData:function(a,b){var h=this;var i=b.getName();if(!i){throw'EntitySetName missing';}return h._fillInternalBuffer(a.sina).then(function(){return h.allInOneMap.businessObjectMap[i];});},getBusinessObjectMetaDataByBusinessObjectName:function(a,b){var h=this;if(!b){throw'EntitySetName missing';}return h._fillInternalBuffer(a.sina).then(function(){return h.allInOneMap.businessObjectMap[b];});},getBusinessObjectMetaDataSync:function(a,b){var h=b.getName();if(!h){throw'EntitySetName missing';}this._fillInternalBufferSync(a.sina);return this.allInOneMap.businessObjectMap[h];},getBusinessObjectMetaDataSyncByBusinessObjectName:function(a,b){if(!b){throw'EntitySetName missing';}this._fillInternalBufferSync(a.sina);return this.allInOneMap.businessObjectMap[b];},_fillInternalBuffer:function(l1){var a=this;if(this.allInOneMapDeferred){return this.allInOneMapDeferred;}a.allInOneMapDeferred=a._fireMetaRequest(l1).then(function(b){a.allInOneMap=b;});return a.allInOneMapDeferred;},_fillInternalBufferSync:function(l1){if(this.allInOneMap&&Object.keys(this.allInOneMap).length>0){return;}this.allInOneMap=this._fireMetaRequest(l1,false);},_fireMetaRequest:function(l1,a){var b=this;var h=l1.sys.infoUrl+'DataSources?$expand=Attributes/UIAreas&$filter=Type eq \'View\'';var r={async:a===undefined?true:a,method:'GET',type:'GET',url:h};var i=f.Deferred();var m=l1.getSystem().proxy.ajax(r);if(r.async){m.done(function(j){var k=b._buildAllInOneMap(l1,j);i.resolve(k);});return i.promise();}else{return b._buildAllInOneMap(l1,m.responseJSON);}},_buildAllInOneMap:function(l1,m){var a=this;var b={businessObjectMap:{},businessObjectList:[],dataSourceMap:{},dataSourcesList:[]};var r=m.d.results;r.forEach(function(h,i){var j=l1.createDataSource({label:h.Name,labelPlural:h.NamePlural,name:h.Id,SemanticObjectType:h.SemanticObjectTypeId,type:d.DataSourceType.BUSINESSOBJECT,systemId:h.SourceSystem,client:h.SourceClient});var k={};h.Attributes.results.forEach(function(h,i){k[h.Id]={displayOrder:h.Displayed&&h.DisplayOrder?h.DisplayOrder:1,label:h.Name,labelRaw:h.Id,type:c(h.EDMType,h.TextIndexed),presentationUsage:h.UIAreas?a._parsePresentationUsage(h.UIAreas.results):[],accessUsage:h.Facet?['AutoFacet']:[],isSortable:h.Sortable,semanticObjectType:h.SemanticObjectTypeId,isKey:h.Key};});var l={attributeMap:k,dataSource:j};b.dataSourceMap[j.key]=j;b.dataSourcesList.push(j);b.businessObjectMap[j.key]=l;b.businessObjectList.push(l);});return b;},_parsePresentationUsage:function(a){var b=this;var h=[];a.forEach(function(i){var j=b.presentationUsageConversionMap[i.Id.toUpperCase()];if(j){h.push(j);}});return h;}};return e;}(f,x);k1=function(f,g,B,u,x,A,d,a,s,b,c,e,m,q){var h={};h.Sina=function(){this.init.apply(this,arguments);};h.Sina.prototype=f.extend({},g.Sina.prototype,{init:function(){g.Sina.prototype.init.apply(this,arguments);this.rootDataSource=new x.DataSource({label:'All',labelPlural:'All',name:'<All>',type:d.DataSourceType.CATEGORY,sina:this});},getRootDataSource:function(){return this.rootDataSource;}});h.SearchConfiguration=function(){this.init.apply(this,arguments);};h.UserHistory=function(){this.init.apply(this,arguments);};h.IMPL_TYPE='ODATA3';g.registerProvider({impl_type:h.IMPL_TYPE,sina:h.Sina,Facet:a.Facet,chartQuery:c.ChartQuery,searchQuery:s.SearchQuery,suggestionQuery:b.SuggestionQuery,perspectiveQuery:e.PerspectiveQuery,metaDataService:new m.MetaDataService(),Filter:u.Filter,FilterCondition:u.Condition,FilterConditionGroup:u.ConditionGroup,DataSource:x.DataSource,searchConfiguration:h.SearchConfiguration,addUserHistoryEntry:function(i){var j=new h.UserHistory(i);return j.addUserHistoryEntry(i.oEntry);},emptyUserHistory:function(i){var j=new h.UserHistory(i);return j.emptyUserHistory();}});h.UserHistory.prototype=f.extend({},q.Query.prototype,{init:function(i){i=i||{};q.Query.prototype.init.apply(this,[i]);},addUserHistoryEntry:function(n,i){var j=n.NavigationEventList[1].TargetApplication;var k={'SemanticObjectType':j.SemanticObjectType,'Intent':j.Intent,'Parameters':j.ParameterList};if(j.System&&j.Client){k.System=j.System;k.Client=j.Client;}var i=i===undefined?true:i;var r={async:i,method:'POST',type:'POST',url:this.sina.getSystem().infoUrl+'NavigationEvents/',contentType:'application/json',dataType:'json',noXSRFToken:false,data:k};return this.system.proxy.ajax(r);},emptyUserHistory:function(i){var i=i===undefined?true:i;var r={async:i,method:'MERGE',type:'POST',url:this.sina.getSystem().infoUrl+'Users(\'<current>\')/',contentType:'application/json',dataType:'json',noXSRFToken:false,data:{'ClearPersonalizedSearchHistory':true}};return this.system.proxy.ajax(r);}});h.SearchConfiguration.prototype=f.extend({},q.Query.prototype,{init:function(i){i=i||{};q.Query.prototype.init.apply(this,[i]);},load:function(i){var j=this;var k={Data:{PersonalizedSearch:{PersonalizationPolicy:'Disabled',SessionUserActive:false}}};var i=i===undefined?true:i;var r={async:i,method:'GET',type:'GET',url:j.sina.getSystem().infoUrl+'PersonalizedSearchMainSwitches?$filter=Selected eq true',contentType:'application/json',dataType:'json',noXSRFToken:false,data:{}};return j.system.proxy.ajax(r).then(function(l){switch(l.d.results[0].MainSwitch){case 1:k.Data.PersonalizedSearch.PersonalizationPolicy='Disabled';break;case 2:k.Data.PersonalizedSearch.PersonalizationPolicy='Enforced';break;case 3:k.Data.PersonalizedSearch.PersonalizationPolicy='Opt-In';break;case 4:k.Data.PersonalizedSearch.PersonalizationPolicy='Opt-Out';break;}r.url=j.sina.getSystem().infoUrl+'Users(\'<current>\')/';return j.system.proxy.ajax(r).then(function(l){if(l.d.IsEnabledForPersonalizedSearch){k.Data.PersonalizedSearch.SessionUserActive=true;}return k;});});},save:function(o,i){var i=i===undefined?true:i;var r={async:i,method:'MERGE',type:'POST',url:this.sina.getSystem().infoUrl+'Users(\'<current>\')/',contentType:'application/json',dataType:'json',noXSRFToken:false,data:{'IsEnabledForPersonalizedSearch':o.SearchConfiguration.Data.PersonalizedSearch.SessionUserActive}};return this.system.proxy.ajax(r);}});return h;}(f,g,b1,c1,d1,A,x,g1,f1,h1,e1,i1,j1,q);l1=function(f,i,a,b,c,d,o,e,h,j){var k={};k.getSina=function(l){var A;l=l||{};l.impl_type=l.impl_type||'INAV2';var s=f.getUrlParameter('sinaProvider');if(s&&s.length>0){l.impl_type=s;}l.impl_type=l.impl_type.toUpperCase();if(l.impl_type==='INAV2'){if(!l.system){A=new a.Proxy(l);if(l.systemType&&l.systemType.toUpperCase()==='HANA'){l.system=new b.HANASystem();}else{l.system=new b.ABAPSystem();}A.setSystem(l.system);A.setXSRFService(l.system.infoUrl);}}else if(l.impl_type==='ODATA2'){if(!l.system){l.system=new e.System(l);}}else if(l.impl_type==='ODATA3'){if(!l.system){l.system=new j.System(l);A=l.system.proxy;A.setSystem(l.system);A.setXSRFService(l.system.infoUrl);}}else{throw new Error('Unknown provider type: '+l.impl_type);}l._provider=c.provider[l.impl_type];var l1=new c.provider[l.impl_type].sina(l);l1._provider=l._provider;return l1;};return k;}(f,R,C,D,g,A,a1,S,k1,b1);window.sina=l1;window.sinabase=g;window.filter=u;}());
