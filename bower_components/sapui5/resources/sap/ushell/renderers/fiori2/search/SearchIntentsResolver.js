sap.ui.define(['sap/ushell/renderers/fiori2/search/SearchNavigationIntentObject'],function(S){"use strict";jQuery.sap.declare('sap.ushell.renderers.fiori2.search.SearchIntentsResolver');var m=sap.ushell.renderers.fiori2.search.SearchIntentsResolver=function(){this.init.apply(this,arguments);};m.prototype={init:function(a){this._launchpadNavigation=sap.ushell&&sap.ushell.Container&&(sap.ushell.Container.getService("SmartNavigation")||sap.ushell.Container.getService("CrossApplicationNavigation"));this._model=a;},resolveIntents:function(r){var t=this;var o=new Promise(function(a,b){if(!t._launchpadNavigation){a();return;}if(!m._semanticObjectTypeSupportedPromise){m._semanticObjectTypeSupportedPromise=t._model.sina.sinaSystem().getServerInfo().then(function(s){m._semanticObjectTypeSupported=false;if(s&&s.rawServerInfo&&s.rawServerInfo.Services){for(var i=0;i<s.rawServerInfo.Services.length;++i){var c=s.rawServerInfo.Services[i];if(c.Service==='Search'){for(var j=0;j<c.Capabilities.length;++j){var d=c.Capabilities[j];if(d.Capability==='SemanticObjectType'){m._semanticObjectTypeSupported=true;break;}}break;}}}else{m._semanticObjectTypeSupported=true;}});}m._semanticObjectTypeSupportedPromise.then(function(){if(!m._semanticObjectTypeSupported){a();}else{t.fioriFrontendSystemInfo={systemId:sap.ushell.Container.getLogonSystem().getName(),client:sap.ushell.Container.getLogonSystem().getClient()};var p=[];for(var k=0;k<r.length;k++){var c=r[k];if(c.semanticObjectType&&c.semanticObjectType.length>0){var d=t._doResolveIntents(c);p.push(d);}}Promise.all(p).then(function(){a();});}});});return o;},resolveIntentsGetDeferred:function(r){var p=this.resolveIntents(r);var d=new $.Deferred();p.then(function(){d.resolve();});return d.promise();},_doResolveIntents:function(r){var t=this;if(r.titleNavigationIsOldURL){r.titleNavigation=undefined;}var s;if(r.systemId&&r.client&&!(t.fioriFrontendSystemInfo.systemId==r.systemId&&t.fioriFrontendSystemInfo.client==r.client)){s="sap-system=sid("+r.systemId+"."+r.client+")";}var o=new Promise(function(a,b){var p=$.Deferred();if(t._launchpadNavigation.getPrimaryIntent){t._launchpadNavigation.getPrimaryIntent(r.semanticObjectType,r.semanticObjectTypeAttrs).done(function(e){p.resolve(e);}).fail(function(){p.resolve();});}else{p.resolve();}var c,d=$.Deferred();if(t._launchpadNavigation.getLinks){c=t._launchpadNavigation.getLinks({semanticObject:r.semanticObjectType,params:r.semanticObjectTypeAttrs,withAtLeastOneUsedParam:true,sortResultOnTexts:true});}else{c=t._launchpadNavigation.getSemanticObjectLinks(r.semanticObjectType,r.semanticObjectTypeAttrs);}c.done(function(i){d.resolve(i);}).fail(function(){d.resolve();});$.when(p,d).done(function(e,f){var g;if(e){g=t._getNavigationObjectForIntent(e,s);r.uri=g.getHref();g.setLoggingType(t._model.eventLogger.ITEM_NAVIGATE);r.titleNavigation=g;}var h="-displayFactSheet";var j=r.titleNavigation!==undefined;r.intents=[];if(!r.navigationObjects){r.navigationObjects=[];}for(var i=0;i<f.length;i++){var k=f[i];var n=t._getNavigationObjectForIntent(k,s);if(!j&&k.intent.substring(k.intent.indexOf("-"),k.intent.indexOf("?"))===h){r.uri=n.getHref();n.setLoggingType(t._model.eventLogger.ITEM_NAVIGATE);r.titleNavigation=n;j=true;}else if(!g||!n.isEqualTo(g)){k.target=n.getTarget();k.externalHash=n.getHref();r.intents.push(k);n.setLoggingType(t._model.eventLogger.ITEM_NAVIGATE_RELATED_OBJECT);r.navigationObjects.push(n);}}a();}).fail(function(e){a();});});return o;},_getNavigationObjectForIntent:function(i,s){var t=this;var a=i.intent;if(s){var w=a.indexOf('?');if(w===-1){a+="?"+s;}else{w+=1;var p=a.substring(0,w);var b=a.substring(w);a=p+s;if(b&&b.length>0){a+="&"+b;}}}var e={target:{shellHash:a}};var c=t._launchpadNavigation.hrefForExternal(e);var n=new S({text:i.text,href:c,externalTarget:e});return n;}};return m;});
