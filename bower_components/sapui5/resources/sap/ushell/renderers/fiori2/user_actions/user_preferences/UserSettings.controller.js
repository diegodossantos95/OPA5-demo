sap.ui.define(['sap/ushell/ui/launchpad/AccessibilityCustomData'],function(A){"use strict";sap.ui.controller("sap.ushell.renderers.fiori2.user_actions.user_preferences.UserSettings",{onInit:function(){var v=this.getView(),t=this;this.navBackButton=new sap.m.ToggleButton({icon:sap.ui.Device.system.phone?"sap-icon://nav-back":"sap-icon://menu2",press:function(e){if(sap.ui.Device.system.phone){v.getSplitApp().backDetail();t._handleNavButton();this.setPressed(false);}else{if(v.getSplitApp().isMasterShown()){v.getSplitApp().hideMaster();this.setTooltip(sap.ushell.resources.i18n.getText("ToggleButtonShow"));this.setPressed(false);}else{v.getSplitApp().showMaster();this.setTooltip(sap.ushell.resources.i18n.getText("ToggleButtonHide"));this.setPressed(true);}}},tooltip:sap.ushell.resources.i18n.getText("ToggleButtonShow")});if(v&&v.getSplitApp()){v.getSplitApp().attachAfterMasterClose(t,function(){t._handleNavButton.apply(t);});v.getSplitApp().attachAfterMasterOpen(t,function(){t._handleNavButton.apply(t);});}},_handleNavButton:function(){var v=this.getView();if(v&&v.getSplitApp()&&v.getSplitApp().getCurrentDetailPage()){if(!v.getSplitApp().isMasterShown()){v.splitAppHeaderBar.addContentLeft(this.navBackButton);}else{if(sap.ui.Device.system.phone||sap.ui.Device.orientation.landscape){v.splitAppHeaderBar.removeAllContentLeft();}}}},getOriginalDialogContent:function(){if(!this.oInitialContent){var e;e=this.getEntryListControl();this.oInitialContent=new sap.ui.layout.VerticalLayout('userPreferencesLayout',{content:[e]}).addStyleClass("sapUshellUserSettingLayout");this.aDanglingControls.push(this.oInitialContent);}return this.oInitialContent;},createDetailPage:function(e,a,t,c){var b=this,v=b.getView(),o=new sap.m.ObjectHeader({title:t,backgroundDesign:sap.m.BackgroundDesign.Solid}).addStyleClass("sapUshellUserSettingDetailHeader");if(e==="userAccountEntry"){o.setIcon(b.getUserImage(sap.ui.core.IconPool.getIconURI("sap-icon://person-placeholder")));o.setTitle(sap.ushell.Container.getUser().getFullName());}var p=new sap.m.Page('detail'+c.getId(),{content:[o,c],showHeader:false});p.addStyleClass("sapUsheUserSettingDetaildPage");p.onAfterRendering=function(){b._handleNavButton();};v.aDanglingControls.push(p);v.getModel().setProperty(a+"/contentResult",p);v.getSplitApp().addDetailPage(p);b.navToDetail(p.getId());},getUserImage:function(d){var u=sap.ushell.Container.getUser().getImage();return u?u:d;},getListPressHandler:function(s,a){var t=this,i=true,b=s.getBindingContext().getPath(),v=this.getView(),c=v.getModel().getProperty(b+"/contentResult"),B=null,S=true,I=false,d=v.getModel().getProperty(b),f=d.contentFunc,C,k;if(sap.ui.Device.system.phone){s.setSelected(false);}if(c){t.navToDetail(c.getId(),a);t._handleNavButton();}else{if(typeof f==="function"){v.getModel().setProperty(b+"/isDirty",true);C=f();C.done(function(e){S=false;if(I===true){B.destroy();}if(e instanceof sap.ui.core.Control){t.createDetailPage.apply(t,[d.entryHelpID,b,d.title,e]);}else{i=false;}});C.fail(function(){S=false;if(I===true){B.destroy();}i=false;});C.always(function(){if(i===false){var e=new sap.m.FlexBox("userPrefErrorFlexBox",{height:"5rem",alignItems:sap.m.FlexAlignItems.Center,justifyContent:sap.m.FlexJustifyContent.Center,items:[new sap.m.Text("userPrefErrorText",{text:v.translationBundle.getText("loadingErrorMessage")})]});v.aDanglingControls.push(e);v.getModel().setProperty(b+"/contentResult",e);v.getSplitApp().addDetailPage(e);t.navToDetail(e.getId());}});if(S===true){B=new sap.m.BusyIndicator('userPrefLoadingBusyIndicator',{size:"2rem"});this.aDanglingControls.push(B);I=true;}}else{d.valueArgument().done(function(V){k=t._getKeyValueContent(d,V);t.createDetailPage(d.entryHelpID,b,d.title,k);}).fail(function(e){k=t._getKeyValueContent(d);t.createDetailPage(d.entryHelpID,b,d.title,k);});}}},_getKeyValueContent:function(e,E){var k,v,b,V=E?E:" ",f=sap.ui.Device.system.phone?'Start':'Center',F=sap.ui.Device.system.phone?'Wrap':'NoWrap',s=sap.ui.Device.system.phone?'Column':'Row';k=new sap.m.Label({text:e.title+":"}).addStyleClass('sapUshellUserSettingsDetailsKey');v=new sap.m.Input({value:V,editable:false}).addStyleClass('sapUshellUserSettingsDetailsValue');b=new sap.m.FlexBox({alignItems:f,wrap:F,direction:s,items:[k,v]});return b;},createMasterPages:function(){var t=this,e=t.getUserSettingsEntryTemplate();this.aDanglingControls=this.getView().aDanglingControls;this.oMasterEntryList=new sap.m.List('userSettingEnteryList',{items:{path:"/userPreferences/entries",template:e},mode:"SingleSelectMaster",select:function(a){t.getListPressHandler(a.getSource().getSelectedItem(),a.getId());}});var o=this.oMasterEntryList.onAfterRendering;this.oMasterEntryList.onAfterRendering=function(){var E=this.getItems();var a;o.apply(this,arguments);for(var i=0;i<E.length;i++){a=E[i].getBindingContext().getPath();t._setEntryValueResult(a);}if(!sap.ui.Device.system.phone){this.setSelectedItem(this.getItems()[0]);t.getListPressHandler(this.getSelectedItem());}};var p=new sap.m.Page("userSettingMaster",{showHeader:false,content:[this.oMasterEntryList]}).addStyleClass("sapUshellUserSettingMaster");t.aDanglingControls.push(this.oMasterEntryList,p);return p;},_setEntryValueResult:function(e){var v=this.getView(),m=v.getModel(),i=m.getProperty(e+"/editable"),a=m.getProperty(e+"/valueArgument"),V;if(typeof a==="function"){m.setProperty(e+"/valueResult",v.translationBundle.getText("genericLoading"));m.setProperty(e+"/editable",false);V=a();if(V){V.done(function(b){m.setProperty(e+"/editable",i);var c=true;if(m.getProperty(e+"/visible")!==undefined){c=m.getProperty(e+"/visible");}else if(m.getProperty(e+"/defaultVisibility")!==undefined){c=m.getProperty(e+"/defaultVisibility");}m.setProperty(e+"/visible",typeof(b)==='object'?!!b.value:c);m.setProperty(e+"/valueResult",typeof(b)==='object'?b.displayText:b);});V.fail(function(){m.setProperty(e+"/valueResult",v.translationBundle.getText("loadingErrorMessage"));});}}else if(!!a){m.setProperty(e+"/valueResult",a);m.setProperty(e+"/editable",i);}else{m.setProperty(e+"/valueResult",v.translationBundle.getText("loadingErrorMessage"));}},getUserSettingsEntryTemplate:function(){var t=this,i=new sap.m.StandardListItem({title:"{title}",description:"{valueResult}",icon:{path:"icon",formatter:function(e){if(e==="sap-icon://account"){e=t.getUserImage("sap-icon://account");}return e?e:"sap-icon://action-settings";}},type:sap.ui.Device.system.phone?"Navigation":"Inactive",visible:{parts:[{path:'visible'},{path:'defaultVisibility'},{path:'/userPreferences/profiling/length'}],formatter:function(v,d){if(this.getTitle()===sap.ushell.resources.i18n.getText("userProfiling")){var p=this.getModel().getProperty("/userPreferences/profiling");p.forEach(function(e,a){if(e.entryHelpID==="usageAnalytics"){if(!sap.ushell.Container.getService("UsageAnalytics").systemEnabled()||!sap.ushell.Container.getService("UsageAnalytics").isSetUsageAnalyticsPermitted()){p.splice(a,1);}}},this);return(p!==undefined&&p.length>0);}else{if(v!==undefined){return v;}else{return(d!==undefined)?d:true;}}}},customData:new A({key:"aria-label",value:{parts:[{path:'title'},{path:'valueResult'}],formatter:function(T,v){v=v?v:"";return T+" "+v;}},writeToDom:true})}).addStyleClass("sapUshellUserSettingMasterListItem");return i;},navToDetail:function(i,e){var v=this.getView(),s=v.getSplitApp();s.toDetail(i);if(e==="select"){this.applyFocus(i);}if(s.getMode()==="ShowHideMode"){s.hideMaster();}},applyFocus:function(i){if(!sap.ui.Device.system.phone){var e=jQuery.sap.byId(i).firstFocusableDomRef();if(e){jQuery.sap.focus(e);}}},onExit:function(){this.getView().aDanglingControls.forEach(function(c){if(c){if(c.destroyContent){c.destroyContent();}c.destroy();}});}});},false);
