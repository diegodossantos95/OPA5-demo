// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(function(){"use strict";sap.ui.controller("sap.ushell.renderers.fiori2.compactCozy_selector.CompactCozySelector",{onInit:function(){try{this.userInfoService=sap.ushell.Container.getService("UserInfo");this.oUser=this.userInfoService.getUser();}catch(e){jQuery.sap.log.error("Getting UserInfo service failed.");this.oUser=sap.ushell.Container.getUser();}this.translationBundle=sap.ushell.resources.i18n;this.oModel=new sap.ui.model.json.JSONModel({options:[{id:"cozy",name:this.translationBundle.getText("cozy"),isSelected:true},{id:"compact",name:this.translationBundle.getText("compact"),isSelected:false}]});this.getView().setModel(this.oModel);this.currentContentDensity=this.oUser.getContentDensity();this.origContentDensity=this.currentContentDensity;this.isContentLoaded=false;},getContent:function(){var o=this.oModel.getProperty("/options");for(var i=0;i<o.length;i++){if(o[i].id==this.currentContentDensity){o[i].isSelected=true;}else{o[i].isSelected=false;}}this.oModel.setProperty("/options",o);return jQuery.Deferred().resolve(this.getView());},getValue:function(){return jQuery.Deferred().resolve(this._getModeNameById(this.currentContentDensity));},onCancel:function(){this.currentContentDensity=this.oUser.getContentDensity();},onSave:function(){var d=jQuery.Deferred();var u;if(this.oUser.getContentDensity()!=this.currentContentDensity){if(this.currentContentDensity){this.oUser.setContentDensity(this.currentContentDensity);u=this.userInfoService.updateUserPreferences(this.oUser);u.done(function(){this.oUser.resetChangedProperties();this.origContentDensity=this.currentContentDensity;sap.ui.getCore().getEventBus().publish("launchpad","toggleContentDensity",{contentDensity:this.currentContentDensity});d.resolve();}.bind(this));u.fail(function(e){this.oUser.setContentDensity(this.origContentDensity);this.oUser.resetChangedProperties();this.currentContentDensity=this.origContentDensity;jQuery.sap.log.error(e);d.reject(e);}.bind(this));}else{d.reject("Could not find mode: "+this.currentContentDensity);}}else{d.resolve();}return d.promise();},getCurrentContentDensity:function(){return this.currentContentDensity;},setCurrentContentDensity:function(n){this.currentContentDensity=n;},_getModeNameById:function(c){var d=this.getModel().getProperty('/options');for(var i=0;i<d.length;i++){if(d[i].id==c){return d[i].name;}}return c;},getModel:function(){return this.oModel;}});},true);
